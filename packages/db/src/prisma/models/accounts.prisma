// Better Auth models for Prisma

model User {
  id               Int                @id @default(autoincrement())
  name             String
  email            String
  emailVerified    Boolean            @default(false) @map("email_verified")
  image            String?
  createdAt        DateTime           @default(now()) @map("created_at")
  updatedAt        DateTime           @updatedAt @map("updated_at")
  role             String?
  banned           Boolean?           @default(false)
  banReason        String?            @map("ban_reason")
  banExpires       DateTime?          @map("ban_expires")
  stripeCustomerId String?            @map("stripe_customer_id")
  sessions         Session[]
  accounts         Account[]
  members          Member[]
  invitations      Invitation[]
  courses          CourseUser[]
  activityProgress ActivityProgress[]
  stepAttempts     StepAttempt[]
  progress         UserProgress?
  dailyProgress    DailyProgress[]

  @@unique([email])
  @@map("users")
}

model Session {
  id                   Int      @id @default(autoincrement())
  expiresAt            DateTime @map("expires_at")
  token                String
  createdAt            DateTime @default(now()) @map("created_at")
  updatedAt            DateTime @updatedAt @map("updated_at")
  ipAddress            String?  @map("ip_address")
  userAgent            String?  @map("user_agent")
  userId               Int      @map("user_id")
  user                 User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  impersonatedBy       String?  @map("impersonated_by")
  activeOrganizationId String?  @map("active_organization_id")

  @@unique([token])
  @@index([userId])
  @@map("sessions")
}

model Account {
  id                    Int       @id @default(autoincrement())
  accountId             String    @map("account_id")
  providerId            String    @map("provider_id")
  userId                Int       @map("user_id")
  user                  User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  accessToken           String?   @map("access_token")
  refreshToken          String?   @map("refresh_token")
  idToken               String?   @map("id_token")
  accessTokenExpiresAt  DateTime? @map("access_token_expires_at")
  refreshTokenExpiresAt DateTime? @map("refresh_token_expires_at")
  scope                 String?
  password              String?
  createdAt             DateTime  @default(now()) @map("created_at")
  updatedAt             DateTime  @updatedAt @map("updated_at")

  @@index([userId])
  @@map("accounts")
}

model Verification {
  id         Int      @id @default(autoincrement())
  identifier String
  value      String
  expiresAt  DateTime @map("expires_at")
  createdAt  DateTime @default(now()) @map("created_at")
  updatedAt  DateTime @updatedAt @map("updated_at")

  @@index([identifier])
  @@map("verifications")
}

model Organization {
  id               Int             @id @default(autoincrement())
  name             String
  slug             String
  logo             String?
  createdAt        DateTime        @default(now()) @map("created_at")
  metadata         String?
  kind             String          @default("brand")
  members          Member[]
  invitations      Invitation[]
  courses          Course[]
  chapters         Chapter[]
  lessons          Lesson[]
  activities       Activity[]
  stepAttempts     StepAttempt[]
  dailyProgress    DailyProgress[]
  stripeCustomerId String?         @map("stripe_customer_id")
  words            Word[]
  sentences        Sentence[]

  @@unique([slug])
  @@map("organizations")
}

model Member {
  id             Int          @id @default(autoincrement())
  organizationId Int          @map("organization_id")
  organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  userId         Int          @map("user_id")
  user           User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  role           String       @default("member")
  createdAt      DateTime     @default(now()) @map("created_at")

  @@index([organizationId])
  @@index([userId])
  @@map("members")
}

model Invitation {
  id             Int          @id @default(autoincrement())
  organizationId Int          @map("organization_id")
  organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  email          String
  role           String?
  status         String       @default("pending")
  expiresAt      DateTime     @map("expires_at")
  createdAt      DateTime     @default(now()) @map("created_at")
  inviterId      Int          @map("inviter_id")
  user           User         @relation(fields: [inviterId], references: [id], onDelete: Cascade)

  @@index([organizationId])
  @@index([email])
  @@map("invitations")
}

model Subscription {
  id                   Int       @id @default(autoincrement())
  plan                 String
  referenceId          String    @map("reference_id")
  stripeCustomerId     String?   @map("stripe_customer_id")
  stripeSubscriptionId String?   @map("stripe_subscription_id")
  status               String?   @default("incomplete")
  periodStart          DateTime? @map("period_start")
  periodEnd            DateTime? @map("period_end")
  trialStart           DateTime? @map("trial_start")
  trialEnd             DateTime? @map("trial_end")
  cancelAtPeriodEnd    Boolean?  @default(false) @map("cancel_at_period_end")
  cancelAt             DateTime? @map("cancel_at")
  canceledAt           DateTime? @map("canceled_at")
  endedAt              DateTime? @map("ended_at")
  seats                Int?

  @@map("subscriptions")
}

model RateLimit {
  id          Int     @id @default(autoincrement())
  key         String?
  count       Int?
  lastRequest BigInt? @map("last_request")

  @@map("rate_limits")
}
