model SearchPrompt {
  id          Int                      @id @default(autoincrement())
  language    String                   @db.VarChar(10)
  prompt      String
  suggestions SearchPromptSuggestion[]
  createdAt   DateTime                 @default(now()) @map("created_at")
  updatedAt   DateTime                 @default(now()) @updatedAt @map("updated_at")

  @@unique([language, prompt], name: "languagePrompt")
  @@map("search_prompts")
}

model CourseSuggestion {
  id               Int                      @id @default(autoincrement())
  language         String                   @db.VarChar(10)
  slug             String
  title            String
  description      String
  targetLanguage   String?                  @map("target_language") @db.VarChar(10)
  generationStatus GenerationStatus         @default(pending) @map("generation_status")
  generationRunId  String?                  @map("generation_run_id")
  prompts          SearchPromptSuggestion[]
  createdAt        DateTime                 @default(now()) @map("created_at")
  updatedAt        DateTime                 @default(now()) @updatedAt @map("updated_at")

  @@unique([language, slug], name: "languageSlug")
  @@map("course_suggestions")
}

model SearchPromptSuggestion {
  id                 Int              @id @default(autoincrement())
  searchPromptId     Int              @map("search_prompt_id")
  searchPrompt       SearchPrompt     @relation(fields: [searchPromptId], references: [id], onDelete: Cascade)
  courseSuggestionId Int              @map("course_suggestion_id")
  courseSuggestion   CourseSuggestion @relation(fields: [courseSuggestionId], references: [id], onDelete: Cascade)
  position           Int              @default(0)
  createdAt          DateTime         @default(now()) @map("created_at")

  @@unique([searchPromptId, courseSuggestionId], name: "promptSuggestion")
  @@index([searchPromptId])
  @@index([courseSuggestionId])
  @@map("search_prompt_suggestions")
}

model Course {
  id                Int                      @id @default(autoincrement())
  organizationId    Int?                     @map("organization_id")
  organization      Organization?            @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  userId            Int?                     @map("user_id")
  user              User?                    @relation(fields: [userId], references: [id], onDelete: Cascade)
  mode              CourseMode               @default(full)
  completedAt       DateTime?                @map("completed_at")
  isPublished       Boolean                  @default(false) @map("is_published")
  language          String                   @db.VarChar(10)
  slug              String
  title             String
  normalizedTitle   String                   @map("normalized_title")
  description       String?
  targetLanguage    String?                  @map("target_language") @db.VarChar(10)
  generationStatus  GenerationStatus         @default(completed) @map("generation_status")
  generationRunId   String?                  @map("generation_run_id")
  imageUrl          String?                  @map("image_url")
  createdAt         DateTime                 @default(now()) @map("created_at")
  updatedAt         DateTime                 @default(now()) @updatedAt @map("updated_at")
  alternativeTitles CourseAlternativeTitle[]
  categories        CourseCategory[]
  chapters          Chapter[]
  users             CourseUser[]

  @@unique([organizationId, language, slug], name: "orgSlug")
  @@unique([userId, language, slug], name: "userSlug")
  @@index([organizationId, language, isPublished])
  @@index([organizationId, normalizedTitle])
  @@index([userId])
  @@index([userId, mode])
  @@map("courses")
}

model CourseAlternativeTitle {
  id        Int      @id @default(autoincrement())
  courseId  Int      @map("course_id")
  course    Course   @relation(fields: [courseId], references: [id], onDelete: Cascade)
  slug      String
  language  String   @db.VarChar(10)
  createdAt DateTime @default(now()) @map("created_at")

  @@unique([language, slug], name: "languageSlug")
  @@index([courseId])
  @@map("course_alternative_titles")
}

model CourseCategory {
  id        Int      @id @default(autoincrement())
  courseId  Int      @map("course_id")
  course    Course   @relation(fields: [courseId], references: [id], onDelete: Cascade)
  category  String   @db.VarChar(50)
  createdAt DateTime @default(now()) @map("created_at")

  @@unique([courseId, category], name: "courseCategory")
  @@index([category])
  @@map("course_categories")
}

model CourseUser {
  id        Int      @id @default(autoincrement())
  courseId  Int      @map("course_id")
  course    Course   @relation(fields: [courseId], references: [id], onDelete: Cascade)
  userId    Int      @map("user_id")
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  startedAt DateTime @default(now()) @map("started_at")

  @@unique([courseId, userId], name: "courseUser")
  @@index([courseId])
  @@index([userId])
  @@map("course_users")
}
