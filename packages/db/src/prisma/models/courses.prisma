model CourseSuggestion {
  id          Int      @id @default(autoincrement())
  locale      String   @db.VarChar(10)
  prompt      String
  suggestions Json
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @default(now()) @updatedAt @map("updated_at")

  @@unique([locale, prompt], name: "localePrompt")
  @@map("course_suggestions")
}

model Course {
  id                Int                      @id @default(autoincrement())
  organizationId    Int                      @map("organization_id")
  organization      Organization             @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  isPublished       Boolean                  @default(false) @map("is_published")
  language          String                   @db.VarChar(10)
  slug              String
  title             String
  normalizedTitle   String                   @map("normalized_title")
  description       String?
  generationStatus  String                   @default("completed") @map("generation_status") @db.VarChar(20)
  imageUrl          String?                  @map("image_url")
  createdAt         DateTime                 @default(now()) @map("created_at")
  updatedAt         DateTime                 @default(now()) @updatedAt @map("updated_at")
  alternativeTitles CourseAlternativeTitle[]
  categories        CourseCategory[]
  chapters          Chapter[]
  users             CourseUser[]

  @@unique([organizationId, language, slug], name: "orgSlug")
  @@index([organizationId, language, isPublished])
  @@index([organizationId, normalizedTitle])
  @@map("courses")
}

model CourseAlternativeTitle {
  id        Int      @id @default(autoincrement())
  courseId  Int      @map("course_id")
  course    Course   @relation(fields: [courseId], references: [id], onDelete: Cascade)
  slug      String
  locale    String   @db.VarChar(10)
  createdAt DateTime @default(now()) @map("created_at")

  @@unique([locale, slug], name: "localeSlug")
  @@index([courseId])
  @@map("course_alternative_titles")
}

model CourseCategory {
  id        Int      @id @default(autoincrement())
  courseId  Int      @map("course_id")
  course    Course   @relation(fields: [courseId], references: [id], onDelete: Cascade)
  category  String   @db.VarChar(50)
  createdAt DateTime @default(now()) @map("created_at")

  @@unique([courseId, category], name: "courseCategory")
  @@index([category])
  @@map("course_categories")
}

model CourseUser {
  id        Int      @id @default(autoincrement())
  courseId  Int      @map("course_id")
  course    Course   @relation(fields: [courseId], references: [id], onDelete: Cascade)
  userId    Int      @map("user_id")
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  startedAt DateTime @default(now()) @map("started_at")

  @@unique([courseId, userId], name: "courseUser")
  @@index([courseId])
  @@index([userId])
  @@map("course_users")
}
