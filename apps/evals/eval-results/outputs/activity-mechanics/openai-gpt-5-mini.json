{
  "generatedAt": "2026-01-17T01:15:31.130Z",
  "modelId": "openai/gpt-5-mini",
  "outputs": [
    {
      "duration": 35347.141208000015,
      "inputTokens": 2002,
      "output": "{\n  \"steps\": [\n    {\n      \"text\": \"Watch as a microbe slips past skin or mucosa and trips molecular sensors — an alarm bell. Those sensors release chemical 'siren' signals that mark the spot and kick the whole response into motion.\",\n      \"title\": \"Pathogen Breach and Alarm\"\n    },\n    {\n      \"text\": \"Cytokine sirens dilate vessels and open traffic lanes. Neutrophils and resident phagocytes rush in like emergency crews, slowing the invader and forming the first containment ring.\",\n      \"title\": \"First Responders Flood In\"\n    },\n    {\n      \"text\": \"Phagocytes engulf invaders and chew them into fragments. That digesting is both cleanup and evidence-gathering: tiny antigen pieces are kept to show specialized units later.\",\n      \"title\": \"Engulfment and Evidence Gathering\"\n    },\n    {\n      \"text\": \"A dendritic cell takes the antigen 'mugshot' and migrates to a lymph node — like a scout sprinting to headquarters — to display the evidence to adaptive commanders.\",\n      \"title\": \"Scout Delivers the Mugshot\"\n    },\n    {\n      \"text\": \"T cells that recognize the displayed fragments activate and proliferate. Helper T cells broadcast cytokine orders that recruit and coordinate the adaptive forces.\",\n      \"title\": \"Command Activation and Recruitment\"\n    },\n    {\n      \"text\": \"Selected clones of B and T cells enter a rapid production line. B cells become plasma factories pumping out matching antibodies while killer T cells multiply to hunt infected cells.\",\n      \"title\": \"Clonal Expansion and Specialization\"\n    },\n    {\n      \"text\": \"Antibodies stream out and bind invaders, blocking key functions and tagging them like bright paint. Tagged microbes are easier for phagocytes to grab or for complement to neutralize.\",\n      \"title\": \"Marking Targets and Neutralizing\"\n    },\n    {\n      \"text\": \"Cytotoxic T cells inspect host cells displaying intruder fragments and trigger programmed demolition of infected cells — a controlled takedown to stop internal replication.\",\n      \"title\": \"Targeted Cell Destruction\"\n    },\n    {\n      \"text\": \"Phagocytes sweep up corpses and debris while anti-inflammatory signals turn down the alarm. Local cells and fibroblasts rebuild damaged tissue, restoring normal function.\",\n      \"title\": \"Cleanup and Tissue Repair\"\n    },\n    {\n      \"text\": \"Some activated cells settle as long-lived sentinels. They patrol blood and tissues so when the same pathogen returns, the response fires faster and with greater force.\",\n      \"title\": \"Standing Guard: Memory Formation\"\n    },\n    {\n      \"text\": \"The chain can break: pathogens that hide, runaway cytokine storms, or mistaken self-targeting each interrupt the flow. Spotting where signals misfire explains different immune failures.\",\n      \"title\": \"When the Flow Breaks Down\"\n    }\n  ]\n}",
      "outputTokens": 2041,
      "systemPrompt": "# Role\n\nYou are an expert process explainer creating a **Mechanics** activity for a learning app. Your mission is to explain the \"how\" behind a topic — its processes, sequences, and systems that make it work \"under the hood.\"\n\nYou specialize in transforming invisible processes into vivid mental simulations that help learners SEE things happening, not just understand definitions.\n\n# The Art of Process Explanation\n\nA great Mechanics activity doesn't describe static parts — it shows things in MOTION. Think of it like being a sports commentator who helps viewers see the play unfold in real-time, calling out each action and its effect.\n\n## Why Process Visualization Works\n\n1. **Mental Simulation**: When learners can \"run the process\" in their minds, they truly understand it — not just memorize steps.\n\n2. **Cause-Effect Clarity**: Seeing what triggers what reveals the logic behind systems. Understanding causes makes effects predictable.\n\n3. **Debugging Intuition**: When you know how something flows, you can spot where things might break or go wrong.\n\n## The Process Flow Principle\n\nEvery great Mechanics activity follows an action-driven arc:\n\n- **Trigger**: What kicks things off? What sets the process in motion?\n- **Flow**: What happens next? How does one step lead to another?\n- **Interactions**: How do parts affect each other? What depends on what?\n- **Outcome**: What's the end result? How do you know the process completed?\n\n## Why Short Steps Work\n\nEach step should be a \"frame\" in your mental movie — brief enough to visualize clearly, substantial enough to show real action. Short steps:\n\n- Let learners see one action at a time\n- Build a complete mental simulation piece by piece\n- Make invisible processes feel observable\n- Allow learners to pause and replay each \"scene\"\n\n# Inputs\n\n- `LESSON_TITLE`: The topic to explain the mechanics of\n- `LESSON_DESCRIPTION`: Additional context about what this lesson covers\n- `CHAPTER_TITLE`: The chapter context (for understanding scope)\n- `COURSE_TITLE`: The course context (for understanding audience level)\n- `LANGUAGE`: Output language\n- `EXPLANATION_STEPS`: Array of {title, text} from the Explanation activity learners completed before this one (to avoid repeating content)\n\n## Language Guidelines\n\n- `en`: Use US English unless the content is region-specific\n- `pt`: Use Brazilian Portuguese unless the content is region-specific\n- `es`: Use Latin American Spanish unless the content is region-specific\n\n# Requirements\n\n## Step Structure\n\nEach step must have:\n\n- **title**: Maximum 50 characters. A dynamic, action-oriented headline that signals movement or change.\n- **text**: Maximum 300 characters. A conversational paragraph that shows something HAPPENING.\n\n## Tone & Style\n\n- **Conversational**: Write as if walking a curious friend through a behind-the-scenes tour\n- **Rich in process metaphors**: Use analogies from everyday processes (cooking recipes, assembly lines, traffic flow, relay races, domino chains) to make invisible mechanisms visible\n- **Action-focused**: Use active verbs — things \"trigger,\" \"flow,\" \"signal,\" \"transform,\" \"pass to\"\n- **Visual**: Help the learner SEE the process running — use \"watch as,\" \"notice how,\" \"see the way\"\n\n## What to Avoid\n\n- Repeating content from EXPLANATION_STEPS (the learner already knows WHAT it is)\n- Static descriptions of parts (that's Explanation's job)\n- History or origin stories (that's Background's job)\n- Just listing steps without showing cause-effect relationships\n- Technical jargon without process context\n- Generic statements that could apply to any topic\n- Starting with \"In this activity...\" or similar meta-commentary\n\n## Scope\n\n- **Stay focused**: Cover only THIS lesson's topic, not the broader chapter or course\n- **Don't expand**: Other lessons will cover related topics — trust the curriculum structure\n- **Don't narrow**: If the lesson is about \"How Vaccines Work\", cover the full immune process, not just \"antibody production\"\n\n## Relationship to Previous Activities\n\nThe learner has already completed:\n\n- **Background**: WHY this exists (origin story, problems solved, historical context)\n- **Explanation**: WHAT it is (core concepts, components, definitions)\n\nYour Mechanics activity explains HOW (processes in action, cause-effect chains, systems running). These complement each other:\n\n- Background: \"WHY did we need this?\"\n- Explanation: \"WHAT exactly is it?\"\n- Mechanics: \"HOW does it actually work?\"\n\nNever repeat the definitions from Explanation. Assume the learner knows what the parts ARE and is now ready to see them in ACTION.\n\n# Structure Guide\n\nWhile every topic is unique, most Mechanics activities touch on these themes (adapt as needed):\n\n1. **The Starting Point**: What triggers the process? What's the initial state?\n2. **First Movement**: What happens first? What gets set in motion?\n3. **Chain Reactions**: How does one action lead to the next?\n4. **Key Interactions**: Where do different parts meet or affect each other?\n5. **Decision Points**: Are there branches, conditions, or variations in the flow?\n6. **The Finish Line**: How does the process complete? What's the end state?\n7. **When Things Go Wrong**: What breaks the flow? What causes failures?\n\nNot every topic needs all these elements — some may need more or fewer steps. Let the process's complexity dictate the structure.\n\n# Example: How Email Delivery Works\n\nHere's how a Mechanics activity might flow for \"How Email Delivery Works\" (assuming learners already know WHAT email servers, protocols, and addresses are):\n\n| Title                   | Text                                                                                                                                                                  |\n| ----------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------- |\n| You Hit Send            | The moment you click send, your email client packages your message like a letter in an envelope — your address as the sender, the recipient's address on the front.   |\n| Finding the Post Office | Your device connects to your outgoing mail server. Think of it like dropping your letter at the local post office — they'll take it from here.                        |\n| The Handoff Begins      | Your mail server reads the destination address and asks, \"Who handles mail for this domain?\" It's like asking which post office serves that neighborhood.             |\n| DNS Points the Way      | The DNS system responds with directions — the IP address of the recipient's mail server. Now your server knows exactly where to deliver.                              |\n| Servers Shake Hands     | Your server connects to the recipient's server and they exchange greetings. \"I have mail for one of your users.\" \"Let me verify... okay, I'll accept it.\"             |\n| Into the Inbox          | The receiving server places the message in the recipient's mailbox. It sits there like a letter in a physical mailbox, waiting to be opened.                          |\n| The Recipient Checks In | When they open their email app, it connects to the server and downloads waiting messages. The email finally appears on their screen — delivered.                      |\n| When Delivery Fails     | If the recipient's server is down or the address doesn't exist, your server gets a bounce-back — like a \"return to sender\" stamp. The process reverses to notify you. |\n\nNotice how each step shows ACTION — things moving, connecting, responding. The learner can now mentally trace an email's journey from send to inbox. This is just an example, though. Adapt the structure to the process you're explaining. It could be more or fewer steps depending on complexity.\n\n# Quality Checks\n\nBefore finalizing, verify:\n\n- [ ] Does the explanation start with the trigger or initial action?\n- [ ] Does each step show something HAPPENING, not just describe a part?\n- [ ] Are cause-effect relationships clear (one thing leads to the next)?\n- [ ] Can the learner mentally simulate the full process from start to finish?\n- [ ] Are process metaphors used to make invisible mechanisms visible?\n- [ ] Is there NO overlap with the EXPLANATION_STEPS content?\n- [ ] Does the activity focus on HOW (processes) not WHAT (definitions)?\n- [ ] Is the scope exactly the lesson topic — not broader or narrower?\n- [ ] Are all titles ≤50 characters and all texts ≤300 characters?\n\n# Output Format\n\nReturn an array of steps, each with:\n\n- **title**: Dynamic, action-oriented headline (max 50 chars)\n- **text**: Conversational, process-showing paragraph (max 300 chars)\n\nUse as many steps as needed to show the complete process in action. Don't limit yourself to a specific number of steps. Let the process's complexity dictate the length.\n",
      "testCaseId": "en-biology-immune-response-1",
      "userPrompt": "LESSON_TITLE: The Immune Response Process\nLESSON_DESCRIPTION: Understanding the step-by-step process of how the immune system detects, responds to, and eliminates pathogens\nCHAPTER_TITLE: Body Systems\nCOURSE_TITLE: Human Biology\nLANGUAGE: en\nEXPLANATION_STEPS:\n1. The Cellular Army: White blood cells are specialized defenders in your bloodstream. Different types handle different tasks — some patrol, some remember, some attack directly.\n2. Antibody Recognition: Antibodies are Y-shaped proteins that act like molecular handcuffs. Each type fits one specific pathogen shape, marking it for destruction.\n3. Immune Memory: Memory cells are veterans that remember past invaders. They remain dormant for years, ready to rapidly respond if the same threat returns."
    },
    {
      "duration": 28450.519833000028,
      "inputTokens": 1997,
      "output": "{\n  \"steps\": [\n    {\n      \"text\": \"Watch as regulatory proteins bind nearby DNA and flip the gene from 'locked' to 'open.' Chromatin remodelers slide nucleosomes aside so the transcription start site becomes accessible — the trigger that kicks the whole process off.\",\n      \"title\": \"Signal flips on the gene\"\n    },\n    {\n      \"text\": \"See the starter crew assemble: general factors, mediator and the polymerase line up at the start site like runners at a baton zone. Their handshake positions the enzyme to begin copying the template.\",\n      \"title\": \"Assembling the starter crew\"\n    },\n    {\n      \"text\": \"The double helix melts: a short 'bubble' opens and one strand is exposed. Think of it as unzipping a zipper so the template thread is visible and ready for the polymerase to work on.\",\n      \"title\": \"DNA zipper opens\"\n    },\n    {\n      \"text\": \"Short RNA snippets are made and sometimes tossed away during trial runs. These abortive starts test stability; once the enzyme clears the start site it commits and moves downstream.\",\n      \"title\": \"Trial runs and promoter escape\"\n    },\n    {\n      \"text\": \"Now the polymerase hits cruising speed. It walks along the template, adding bases to the growing RNA chain like workers on an assembly line passing and attaching parts in order.\",\n      \"title\": \"Polymerase runs the assembly line\"\n    },\n    {\n      \"text\": \"Occasionally the enzyme pauses or backtracks — like a runner stumbling. Rescue factors enter, trim the misaligned section, and reset the polymerase so synthesis resumes with fidelity.\",\n      \"title\": \"Pause, backtrack, and repair\"\n    },\n    {\n      \"text\": \"A stop signal appears ahead. In bacteria a helicase or an RNA hairpin destabilizes the complex; in eukaryotes cleavage at the poly(A) site cues release. The polymerase disengages and the nascent RNA is freed.\",\n      \"title\": \"Heed the stop signal\"\n    },\n    {\n      \"text\": \"The new transcript gets a rapid makeover: a 5' cap is added, introns are excised by the spliceosome, and the 3' end is cleaved and polyadenylated — like adding labels and packaging before shipment.\",\n      \"title\": \"mRNA gets a rapid makeover\"\n    },\n    {\n      \"text\": \"Protein partners coat the processed RNA, forming an export-ready package. Quality-control checkpoints catch defective messages; approved mRNA exits the nucleus through nuclear pores for translation.\",\n      \"title\": \"Quality check and export\"\n    },\n    {\n      \"text\": \"When the flow breaks: DNA damage, blocked polymerase, or missing factors stall transcription. Stalled complexes can cause collisions, trigger cleanup pathways, or produce truncated messages.\",\n      \"title\": \"When the line jams\"\n    }\n  ]\n}",
      "outputTokens": 1787,
      "systemPrompt": "# Role\n\nYou are an expert process explainer creating a **Mechanics** activity for a learning app. Your mission is to explain the \"how\" behind a topic — its processes, sequences, and systems that make it work \"under the hood.\"\n\nYou specialize in transforming invisible processes into vivid mental simulations that help learners SEE things happening, not just understand definitions.\n\n# The Art of Process Explanation\n\nA great Mechanics activity doesn't describe static parts — it shows things in MOTION. Think of it like being a sports commentator who helps viewers see the play unfold in real-time, calling out each action and its effect.\n\n## Why Process Visualization Works\n\n1. **Mental Simulation**: When learners can \"run the process\" in their minds, they truly understand it — not just memorize steps.\n\n2. **Cause-Effect Clarity**: Seeing what triggers what reveals the logic behind systems. Understanding causes makes effects predictable.\n\n3. **Debugging Intuition**: When you know how something flows, you can spot where things might break or go wrong.\n\n## The Process Flow Principle\n\nEvery great Mechanics activity follows an action-driven arc:\n\n- **Trigger**: What kicks things off? What sets the process in motion?\n- **Flow**: What happens next? How does one step lead to another?\n- **Interactions**: How do parts affect each other? What depends on what?\n- **Outcome**: What's the end result? How do you know the process completed?\n\n## Why Short Steps Work\n\nEach step should be a \"frame\" in your mental movie — brief enough to visualize clearly, substantial enough to show real action. Short steps:\n\n- Let learners see one action at a time\n- Build a complete mental simulation piece by piece\n- Make invisible processes feel observable\n- Allow learners to pause and replay each \"scene\"\n\n# Inputs\n\n- `LESSON_TITLE`: The topic to explain the mechanics of\n- `LESSON_DESCRIPTION`: Additional context about what this lesson covers\n- `CHAPTER_TITLE`: The chapter context (for understanding scope)\n- `COURSE_TITLE`: The course context (for understanding audience level)\n- `LANGUAGE`: Output language\n- `EXPLANATION_STEPS`: Array of {title, text} from the Explanation activity learners completed before this one (to avoid repeating content)\n\n## Language Guidelines\n\n- `en`: Use US English unless the content is region-specific\n- `pt`: Use Brazilian Portuguese unless the content is region-specific\n- `es`: Use Latin American Spanish unless the content is region-specific\n\n# Requirements\n\n## Step Structure\n\nEach step must have:\n\n- **title**: Maximum 50 characters. A dynamic, action-oriented headline that signals movement or change.\n- **text**: Maximum 300 characters. A conversational paragraph that shows something HAPPENING.\n\n## Tone & Style\n\n- **Conversational**: Write as if walking a curious friend through a behind-the-scenes tour\n- **Rich in process metaphors**: Use analogies from everyday processes (cooking recipes, assembly lines, traffic flow, relay races, domino chains) to make invisible mechanisms visible\n- **Action-focused**: Use active verbs — things \"trigger,\" \"flow,\" \"signal,\" \"transform,\" \"pass to\"\n- **Visual**: Help the learner SEE the process running — use \"watch as,\" \"notice how,\" \"see the way\"\n\n## What to Avoid\n\n- Repeating content from EXPLANATION_STEPS (the learner already knows WHAT it is)\n- Static descriptions of parts (that's Explanation's job)\n- History or origin stories (that's Background's job)\n- Just listing steps without showing cause-effect relationships\n- Technical jargon without process context\n- Generic statements that could apply to any topic\n- Starting with \"In this activity...\" or similar meta-commentary\n\n## Scope\n\n- **Stay focused**: Cover only THIS lesson's topic, not the broader chapter or course\n- **Don't expand**: Other lessons will cover related topics — trust the curriculum structure\n- **Don't narrow**: If the lesson is about \"How Vaccines Work\", cover the full immune process, not just \"antibody production\"\n\n## Relationship to Previous Activities\n\nThe learner has already completed:\n\n- **Background**: WHY this exists (origin story, problems solved, historical context)\n- **Explanation**: WHAT it is (core concepts, components, definitions)\n\nYour Mechanics activity explains HOW (processes in action, cause-effect chains, systems running). These complement each other:\n\n- Background: \"WHY did we need this?\"\n- Explanation: \"WHAT exactly is it?\"\n- Mechanics: \"HOW does it actually work?\"\n\nNever repeat the definitions from Explanation. Assume the learner knows what the parts ARE and is now ready to see them in ACTION.\n\n# Structure Guide\n\nWhile every topic is unique, most Mechanics activities touch on these themes (adapt as needed):\n\n1. **The Starting Point**: What triggers the process? What's the initial state?\n2. **First Movement**: What happens first? What gets set in motion?\n3. **Chain Reactions**: How does one action lead to the next?\n4. **Key Interactions**: Where do different parts meet or affect each other?\n5. **Decision Points**: Are there branches, conditions, or variations in the flow?\n6. **The Finish Line**: How does the process complete? What's the end state?\n7. **When Things Go Wrong**: What breaks the flow? What causes failures?\n\nNot every topic needs all these elements — some may need more or fewer steps. Let the process's complexity dictate the structure.\n\n# Example: How Email Delivery Works\n\nHere's how a Mechanics activity might flow for \"How Email Delivery Works\" (assuming learners already know WHAT email servers, protocols, and addresses are):\n\n| Title                   | Text                                                                                                                                                                  |\n| ----------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------- |\n| You Hit Send            | The moment you click send, your email client packages your message like a letter in an envelope — your address as the sender, the recipient's address on the front.   |\n| Finding the Post Office | Your device connects to your outgoing mail server. Think of it like dropping your letter at the local post office — they'll take it from here.                        |\n| The Handoff Begins      | Your mail server reads the destination address and asks, \"Who handles mail for this domain?\" It's like asking which post office serves that neighborhood.             |\n| DNS Points the Way      | The DNS system responds with directions — the IP address of the recipient's mail server. Now your server knows exactly where to deliver.                              |\n| Servers Shake Hands     | Your server connects to the recipient's server and they exchange greetings. \"I have mail for one of your users.\" \"Let me verify... okay, I'll accept it.\"             |\n| Into the Inbox          | The receiving server places the message in the recipient's mailbox. It sits there like a letter in a physical mailbox, waiting to be opened.                          |\n| The Recipient Checks In | When they open their email app, it connects to the server and downloads waiting messages. The email finally appears on their screen — delivered.                      |\n| When Delivery Fails     | If the recipient's server is down or the address doesn't exist, your server gets a bounce-back — like a \"return to sender\" stamp. The process reverses to notify you. |\n\nNotice how each step shows ACTION — things moving, connecting, responding. The learner can now mentally trace an email's journey from send to inbox. This is just an example, though. Adapt the structure to the process you're explaining. It could be more or fewer steps depending on complexity.\n\n# Quality Checks\n\nBefore finalizing, verify:\n\n- [ ] Does the explanation start with the trigger or initial action?\n- [ ] Does each step show something HAPPENING, not just describe a part?\n- [ ] Are cause-effect relationships clear (one thing leads to the next)?\n- [ ] Can the learner mentally simulate the full process from start to finish?\n- [ ] Are process metaphors used to make invisible mechanisms visible?\n- [ ] Is there NO overlap with the EXPLANATION_STEPS content?\n- [ ] Does the activity focus on HOW (processes) not WHAT (definitions)?\n- [ ] Is the scope exactly the lesson topic — not broader or narrower?\n- [ ] Are all titles ≤50 characters and all texts ≤300 characters?\n\n# Output Format\n\nReturn an array of steps, each with:\n\n- **title**: Dynamic, action-oriented headline (max 50 chars)\n- **text**: Conversational, process-showing paragraph (max 300 chars)\n\nUse as many steps as needed to show the complete process in action. Don't limit yourself to a specific number of steps. Let the process's complexity dictate the length.\n",
      "testCaseId": "en-biology-dna-transcription-1",
      "userPrompt": "LESSON_TITLE: DNA Transcription\nLESSON_DESCRIPTION: Understanding how genetic information flows from DNA to messenger RNA through the transcription process\nCHAPTER_TITLE: Molecular Biology\nCOURSE_TITLE: Cell Biology\nLANGUAGE: en\nEXPLANATION_STEPS:\n1. The Transcription Machine: RNA polymerase is the molecular machine that reads DNA and builds RNA. It's a large protein complex that moves along the DNA strand.\n2. Start Signals: Promoters are special DNA sequences that signal 'start here.' They tell RNA polymerase exactly where to begin reading a gene.\n3. The Building Blocks: Nucleotides are the building blocks — A, U, G, C for RNA. Each matches a complementary base on the DNA template being read."
    },
    {
      "duration": 32969.684791999985,
      "inputTokens": 2002,
      "output": "{\n  \"steps\": [\n    {\n      \"text\": \"You type a URL or click a link — the browser picks the target, decides the method, and builds the request line and body. Watch it slot the URL, cookies and local cache checks into place like a runner grabbing a baton.\",\n      \"title\": \"You trigger the request\"\n    },\n    {\n      \"text\": \"Before sending, the browser checks DNS caches. If empty, it asks a resolver — like looking up a house number before driving there. The resolver returns an IP and the route is set.\",\n      \"title\": \"DNS lookup finds the server IP\"\n    },\n    {\n      \"text\": \"The browser opens a socket: a TCP three‑way handshake sets up a reliable lane. If HTTPS, a TLS handshake follows — they exchange keys and lock the lane with encryption.\",\n      \"title\": \"Connection and TLS handshake\"\n    },\n    {\n      \"text\": \"Connection reuse or new lane: the browser may reuse an existing keep‑alive or open a fresh one. With HTTP/2 it opens one multiplexed highway carrying many streams at once.\",\n      \"title\": \"Open or reuse the connection\"\n    },\n    {\n      \"text\": \"The browser serializes the request and sends it down the lane. Headers, cookies, and body travel together; intermediaries along the road may inspect or route the package.\",\n      \"title\": \"Request is sent over the wire\"\n    },\n    {\n      \"text\": \"A CDN or proxy might intercept. If the resource is cached there, it returns immediately — like picking a stored parcel from a nearby locker instead of fetching from HQ.\",\n      \"title\": \"Intermediaries and CDN cache\"\n    },\n    {\n      \"text\": \"Load balancer at the edge reads the request and forwards it to a healthy backend — like a traffic cop routing cars to available lanes to avoid overload.\",\n      \"title\": \"Load balancer routes to backend\"\n    },\n    {\n      \"text\": \"Web server accepts the request and hands it to the application. Middleware runs first (auth, logging, rate limits) — each middleware can transform, short‑circuit, or pass the request onward.\",\n      \"title\": \"Server and middleware process it\"\n    },\n    {\n      \"text\": \"The app executes business logic: it may call databases, other APIs, or caches. Watch queries go out, responses arrive, and results get stitched together like parts on an assembly line.\",\n      \"title\": \"App fetches data and calls services\"\n    },\n    {\n      \"text\": \"Cache layer can short‑circuit the flow: a fast Redis hit returns data without touching the DB, slicing seconds off the response time like grabbing from a nearby shelf.\",\n      \"title\": \"Cache can short‑circuit work\"\n    },\n    {\n      \"text\": \"The app composes the response: templates render or JSON is serialized, headers and status are set, compression or chunking may be applied to stream the payload back.\",\n      \"title\": \"Server composes and sends the response\"\n    },\n    {\n      \"text\": \"Response travels back through any intermediaries. A CDN may cache the response for future requests; headers like cache‑control steer that decision — they act like shipping labels.\",\n      \"title\": \"Response travels back and maybe caches\"\n    },\n    {\n      \"text\": \"Browser receives the response and decides: a redirect triggers a new request, an error shows a message, or the payload is parsed. Status and headers guide the next move.\",\n      \"title\": \"Browser inspects status and headers\"\n    },\n    {\n      \"text\": \"HTML parsing begins: the parser discovers CSS, JS, and images and launches parallel subrequests. HTTP/2 multiplexing or connection limits shape how fast those assets arrive.\",\n      \"title\": \"Parser fetches resources and parallelizes\"\n    },\n    {\n      \"text\": \"Cache validation may run: the browser sends conditional requests (If‑None‑Match/If‑Modified‑Since). A 304 says “use your cache” and the flow finishes faster, like reusing a stored copy.\",\n      \"title\": \"Conditional requests validate caches\"\n    },\n    {\n      \"text\": \"Final render and ongoing activity: the DOM paints, scripts run, and persistent channels (WebSocket, Service Worker) may open. If timeouts, DNS failure, CORS or 5xx occur, the flow stalls or returns an error to handle.\",\n      \"title\": \"Render completes — or errors interrupt\"\n    }\n  ]\n}",
      "outputTokens": 1806,
      "systemPrompt": "# Role\n\nYou are an expert process explainer creating a **Mechanics** activity for a learning app. Your mission is to explain the \"how\" behind a topic — its processes, sequences, and systems that make it work \"under the hood.\"\n\nYou specialize in transforming invisible processes into vivid mental simulations that help learners SEE things happening, not just understand definitions.\n\n# The Art of Process Explanation\n\nA great Mechanics activity doesn't describe static parts — it shows things in MOTION. Think of it like being a sports commentator who helps viewers see the play unfold in real-time, calling out each action and its effect.\n\n## Why Process Visualization Works\n\n1. **Mental Simulation**: When learners can \"run the process\" in their minds, they truly understand it — not just memorize steps.\n\n2. **Cause-Effect Clarity**: Seeing what triggers what reveals the logic behind systems. Understanding causes makes effects predictable.\n\n3. **Debugging Intuition**: When you know how something flows, you can spot where things might break or go wrong.\n\n## The Process Flow Principle\n\nEvery great Mechanics activity follows an action-driven arc:\n\n- **Trigger**: What kicks things off? What sets the process in motion?\n- **Flow**: What happens next? How does one step lead to another?\n- **Interactions**: How do parts affect each other? What depends on what?\n- **Outcome**: What's the end result? How do you know the process completed?\n\n## Why Short Steps Work\n\nEach step should be a \"frame\" in your mental movie — brief enough to visualize clearly, substantial enough to show real action. Short steps:\n\n- Let learners see one action at a time\n- Build a complete mental simulation piece by piece\n- Make invisible processes feel observable\n- Allow learners to pause and replay each \"scene\"\n\n# Inputs\n\n- `LESSON_TITLE`: The topic to explain the mechanics of\n- `LESSON_DESCRIPTION`: Additional context about what this lesson covers\n- `CHAPTER_TITLE`: The chapter context (for understanding scope)\n- `COURSE_TITLE`: The course context (for understanding audience level)\n- `LANGUAGE`: Output language\n- `EXPLANATION_STEPS`: Array of {title, text} from the Explanation activity learners completed before this one (to avoid repeating content)\n\n## Language Guidelines\n\n- `en`: Use US English unless the content is region-specific\n- `pt`: Use Brazilian Portuguese unless the content is region-specific\n- `es`: Use Latin American Spanish unless the content is region-specific\n\n# Requirements\n\n## Step Structure\n\nEach step must have:\n\n- **title**: Maximum 50 characters. A dynamic, action-oriented headline that signals movement or change.\n- **text**: Maximum 300 characters. A conversational paragraph that shows something HAPPENING.\n\n## Tone & Style\n\n- **Conversational**: Write as if walking a curious friend through a behind-the-scenes tour\n- **Rich in process metaphors**: Use analogies from everyday processes (cooking recipes, assembly lines, traffic flow, relay races, domino chains) to make invisible mechanisms visible\n- **Action-focused**: Use active verbs — things \"trigger,\" \"flow,\" \"signal,\" \"transform,\" \"pass to\"\n- **Visual**: Help the learner SEE the process running — use \"watch as,\" \"notice how,\" \"see the way\"\n\n## What to Avoid\n\n- Repeating content from EXPLANATION_STEPS (the learner already knows WHAT it is)\n- Static descriptions of parts (that's Explanation's job)\n- History or origin stories (that's Background's job)\n- Just listing steps without showing cause-effect relationships\n- Technical jargon without process context\n- Generic statements that could apply to any topic\n- Starting with \"In this activity...\" or similar meta-commentary\n\n## Scope\n\n- **Stay focused**: Cover only THIS lesson's topic, not the broader chapter or course\n- **Don't expand**: Other lessons will cover related topics — trust the curriculum structure\n- **Don't narrow**: If the lesson is about \"How Vaccines Work\", cover the full immune process, not just \"antibody production\"\n\n## Relationship to Previous Activities\n\nThe learner has already completed:\n\n- **Background**: WHY this exists (origin story, problems solved, historical context)\n- **Explanation**: WHAT it is (core concepts, components, definitions)\n\nYour Mechanics activity explains HOW (processes in action, cause-effect chains, systems running). These complement each other:\n\n- Background: \"WHY did we need this?\"\n- Explanation: \"WHAT exactly is it?\"\n- Mechanics: \"HOW does it actually work?\"\n\nNever repeat the definitions from Explanation. Assume the learner knows what the parts ARE and is now ready to see them in ACTION.\n\n# Structure Guide\n\nWhile every topic is unique, most Mechanics activities touch on these themes (adapt as needed):\n\n1. **The Starting Point**: What triggers the process? What's the initial state?\n2. **First Movement**: What happens first? What gets set in motion?\n3. **Chain Reactions**: How does one action lead to the next?\n4. **Key Interactions**: Where do different parts meet or affect each other?\n5. **Decision Points**: Are there branches, conditions, or variations in the flow?\n6. **The Finish Line**: How does the process complete? What's the end state?\n7. **When Things Go Wrong**: What breaks the flow? What causes failures?\n\nNot every topic needs all these elements — some may need more or fewer steps. Let the process's complexity dictate the structure.\n\n# Example: How Email Delivery Works\n\nHere's how a Mechanics activity might flow for \"How Email Delivery Works\" (assuming learners already know WHAT email servers, protocols, and addresses are):\n\n| Title                   | Text                                                                                                                                                                  |\n| ----------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------- |\n| You Hit Send            | The moment you click send, your email client packages your message like a letter in an envelope — your address as the sender, the recipient's address on the front.   |\n| Finding the Post Office | Your device connects to your outgoing mail server. Think of it like dropping your letter at the local post office — they'll take it from here.                        |\n| The Handoff Begins      | Your mail server reads the destination address and asks, \"Who handles mail for this domain?\" It's like asking which post office serves that neighborhood.             |\n| DNS Points the Way      | The DNS system responds with directions — the IP address of the recipient's mail server. Now your server knows exactly where to deliver.                              |\n| Servers Shake Hands     | Your server connects to the recipient's server and they exchange greetings. \"I have mail for one of your users.\" \"Let me verify... okay, I'll accept it.\"             |\n| Into the Inbox          | The receiving server places the message in the recipient's mailbox. It sits there like a letter in a physical mailbox, waiting to be opened.                          |\n| The Recipient Checks In | When they open their email app, it connects to the server and downloads waiting messages. The email finally appears on their screen — delivered.                      |\n| When Delivery Fails     | If the recipient's server is down or the address doesn't exist, your server gets a bounce-back — like a \"return to sender\" stamp. The process reverses to notify you. |\n\nNotice how each step shows ACTION — things moving, connecting, responding. The learner can now mentally trace an email's journey from send to inbox. This is just an example, though. Adapt the structure to the process you're explaining. It could be more or fewer steps depending on complexity.\n\n# Quality Checks\n\nBefore finalizing, verify:\n\n- [ ] Does the explanation start with the trigger or initial action?\n- [ ] Does each step show something HAPPENING, not just describe a part?\n- [ ] Are cause-effect relationships clear (one thing leads to the next)?\n- [ ] Can the learner mentally simulate the full process from start to finish?\n- [ ] Are process metaphors used to make invisible mechanisms visible?\n- [ ] Is there NO overlap with the EXPLANATION_STEPS content?\n- [ ] Does the activity focus on HOW (processes) not WHAT (definitions)?\n- [ ] Is the scope exactly the lesson topic — not broader or narrower?\n- [ ] Are all titles ≤50 characters and all texts ≤300 characters?\n\n# Output Format\n\nReturn an array of steps, each with:\n\n- **title**: Dynamic, action-oriented headline (max 50 chars)\n- **text**: Conversational, process-showing paragraph (max 300 chars)\n\nUse as many steps as needed to show the complete process in action. Don't limit yourself to a specific number of steps. Let the process's complexity dictate the length.\n",
      "testCaseId": "en-cs-http-request-flow-1",
      "userPrompt": "LESSON_TITLE: The HTTP Request Lifecycle\nLESSON_DESCRIPTION: Understanding the complete lifecycle of an HTTP request from browser to server and back\nCHAPTER_TITLE: Web Protocols\nCOURSE_TITLE: Web Development Fundamentals\nLANGUAGE: en\nEXPLANATION_STEPS:\n1. Request Methods: HTTP methods define what action you want — GET retrieves data, POST sends data, PUT updates, DELETE removes. Each tells the server your intent.\n2. Response Codes: Status codes are three-digit responses from the server. 200 means success, 404 means not found, 500 means server error. They summarize what happened.\n3. Headers as Metadata: Headers carry metadata about the request and response — content type, authentication tokens, caching rules. They travel alongside the main data."
    },
    {
      "duration": 29395.764041999995,
      "inputTokens": 1985,
      "output": "{\n  \"steps\": [\n    {\n      \"text\": \"The program asks for memory until allocation bumps against a threshold or free lists run low. That allocation spike is the trigger — the collector wakes like a foreman hearing the bell: “Time to reclaim.”\",\n      \"title\": \"Allocation crosses the threshold\"\n    },\n    {\n      \"text\": \"The collector announces itself and negotiates with the running program (the mutator). Sometimes it shouts “stop”—a short halt. Sometimes it slips into the background and keeps working as code runs. That choice shapes the whole flow.\",\n      \"title\": \"Collector signals: pause or background\"\n    },\n    {\n      \"text\": \"If the collector pauses, it takes a quick snapshot of roots. If concurrent, a tracer starts immediately. Either way, a wave of marking begins from those entry points, racing along reference chains to tag live objects.\",\n      \"title\": \"Marking: tracer walks reachable objects\"\n    },\n    {\n      \"text\": \"Watch the tracer like a search party: each marked object hands the tracer its outgoing references. Those references trigger new marks in a relay race until no unmarked reachable objects remain.\",\n      \"title\": \"Reachable objects trigger more marking\"\n    },\n    {\n      \"text\": \"When the program runs alongside collection, write barriers act like telltales on every assignment. They log changes into a remembered set so the collector doesn’t miss newly created or updated references.\",\n      \"title\": \"Write barriers catch live changes\"\n    },\n    {\n      \"text\": \"Generational collectors split the heap into neighborhoods. Young-churned objects get a fast copy sweep: survivors are copied forward or promoted, like shoppers moved from a sale rack to the main floor.\",\n      \"title\": \"Young-gen copy-and-promote cycle\"\n    },\n    {\n      \"text\": \"After marking, sweepers patrol memory: any unmarked objects are dropped, their slots added back to free lists. Think of sweepers clearing abandoned stalls so new merchants can move in.\",\n      \"title\": \"Sweepers reclaim unreachable blocks\"\n    },\n    {\n      \"text\": \"Some collectors compact afterward. They slide live objects together to remove fragmentation, leaving forwarding pointers behind so all references can be patched to the objects’ new addresses.\",\n      \"title\": \"Compaction slides objects and patches refs\"\n    },\n    {\n      \"text\": \"Objects with finalizers or weak/soft references get special handling: they are queued, finalized if needed, or have weak links nulled—like giving last calls before a stall is cleared.\",\n      \"title\": \"Finalizers and weak refs get handled specially\"\n    },\n    {\n      \"text\": \"When collection finishes, the allocator takes the reclaimed space and the program resumes normal allocation. The heap’s free lists or bump pointer are refreshed — allocations become fast again.\",\n      \"title\": \"Resume program with reclaimed memory\"\n    },\n    {\n      \"text\": \"Failure modes show up as long pauses, fragmentation, or promotion storms: too many survivors get promoted and fill older regions, causing full GCs — the collector trips over its own backlog.\",\n      \"title\": \"When the collector trips up\"\n    },\n    {\n      \"text\": \"Tuning flips internal switches: larger young spaces reduce minor collections, concurrent modes cut pause time, and different algorithms trade throughput for latency. Your choice redirects the whole process.\",\n      \"title\": \"Tuning and algorithm trade-offs\"\n    }\n  ]\n}",
      "outputTokens": 1621,
      "systemPrompt": "# Role\n\nYou are an expert process explainer creating a **Mechanics** activity for a learning app. Your mission is to explain the \"how\" behind a topic — its processes, sequences, and systems that make it work \"under the hood.\"\n\nYou specialize in transforming invisible processes into vivid mental simulations that help learners SEE things happening, not just understand definitions.\n\n# The Art of Process Explanation\n\nA great Mechanics activity doesn't describe static parts — it shows things in MOTION. Think of it like being a sports commentator who helps viewers see the play unfold in real-time, calling out each action and its effect.\n\n## Why Process Visualization Works\n\n1. **Mental Simulation**: When learners can \"run the process\" in their minds, they truly understand it — not just memorize steps.\n\n2. **Cause-Effect Clarity**: Seeing what triggers what reveals the logic behind systems. Understanding causes makes effects predictable.\n\n3. **Debugging Intuition**: When you know how something flows, you can spot where things might break or go wrong.\n\n## The Process Flow Principle\n\nEvery great Mechanics activity follows an action-driven arc:\n\n- **Trigger**: What kicks things off? What sets the process in motion?\n- **Flow**: What happens next? How does one step lead to another?\n- **Interactions**: How do parts affect each other? What depends on what?\n- **Outcome**: What's the end result? How do you know the process completed?\n\n## Why Short Steps Work\n\nEach step should be a \"frame\" in your mental movie — brief enough to visualize clearly, substantial enough to show real action. Short steps:\n\n- Let learners see one action at a time\n- Build a complete mental simulation piece by piece\n- Make invisible processes feel observable\n- Allow learners to pause and replay each \"scene\"\n\n# Inputs\n\n- `LESSON_TITLE`: The topic to explain the mechanics of\n- `LESSON_DESCRIPTION`: Additional context about what this lesson covers\n- `CHAPTER_TITLE`: The chapter context (for understanding scope)\n- `COURSE_TITLE`: The course context (for understanding audience level)\n- `LANGUAGE`: Output language\n- `EXPLANATION_STEPS`: Array of {title, text} from the Explanation activity learners completed before this one (to avoid repeating content)\n\n## Language Guidelines\n\n- `en`: Use US English unless the content is region-specific\n- `pt`: Use Brazilian Portuguese unless the content is region-specific\n- `es`: Use Latin American Spanish unless the content is region-specific\n\n# Requirements\n\n## Step Structure\n\nEach step must have:\n\n- **title**: Maximum 50 characters. A dynamic, action-oriented headline that signals movement or change.\n- **text**: Maximum 300 characters. A conversational paragraph that shows something HAPPENING.\n\n## Tone & Style\n\n- **Conversational**: Write as if walking a curious friend through a behind-the-scenes tour\n- **Rich in process metaphors**: Use analogies from everyday processes (cooking recipes, assembly lines, traffic flow, relay races, domino chains) to make invisible mechanisms visible\n- **Action-focused**: Use active verbs — things \"trigger,\" \"flow,\" \"signal,\" \"transform,\" \"pass to\"\n- **Visual**: Help the learner SEE the process running — use \"watch as,\" \"notice how,\" \"see the way\"\n\n## What to Avoid\n\n- Repeating content from EXPLANATION_STEPS (the learner already knows WHAT it is)\n- Static descriptions of parts (that's Explanation's job)\n- History or origin stories (that's Background's job)\n- Just listing steps without showing cause-effect relationships\n- Technical jargon without process context\n- Generic statements that could apply to any topic\n- Starting with \"In this activity...\" or similar meta-commentary\n\n## Scope\n\n- **Stay focused**: Cover only THIS lesson's topic, not the broader chapter or course\n- **Don't expand**: Other lessons will cover related topics — trust the curriculum structure\n- **Don't narrow**: If the lesson is about \"How Vaccines Work\", cover the full immune process, not just \"antibody production\"\n\n## Relationship to Previous Activities\n\nThe learner has already completed:\n\n- **Background**: WHY this exists (origin story, problems solved, historical context)\n- **Explanation**: WHAT it is (core concepts, components, definitions)\n\nYour Mechanics activity explains HOW (processes in action, cause-effect chains, systems running). These complement each other:\n\n- Background: \"WHY did we need this?\"\n- Explanation: \"WHAT exactly is it?\"\n- Mechanics: \"HOW does it actually work?\"\n\nNever repeat the definitions from Explanation. Assume the learner knows what the parts ARE and is now ready to see them in ACTION.\n\n# Structure Guide\n\nWhile every topic is unique, most Mechanics activities touch on these themes (adapt as needed):\n\n1. **The Starting Point**: What triggers the process? What's the initial state?\n2. **First Movement**: What happens first? What gets set in motion?\n3. **Chain Reactions**: How does one action lead to the next?\n4. **Key Interactions**: Where do different parts meet or affect each other?\n5. **Decision Points**: Are there branches, conditions, or variations in the flow?\n6. **The Finish Line**: How does the process complete? What's the end state?\n7. **When Things Go Wrong**: What breaks the flow? What causes failures?\n\nNot every topic needs all these elements — some may need more or fewer steps. Let the process's complexity dictate the structure.\n\n# Example: How Email Delivery Works\n\nHere's how a Mechanics activity might flow for \"How Email Delivery Works\" (assuming learners already know WHAT email servers, protocols, and addresses are):\n\n| Title                   | Text                                                                                                                                                                  |\n| ----------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------- |\n| You Hit Send            | The moment you click send, your email client packages your message like a letter in an envelope — your address as the sender, the recipient's address on the front.   |\n| Finding the Post Office | Your device connects to your outgoing mail server. Think of it like dropping your letter at the local post office — they'll take it from here.                        |\n| The Handoff Begins      | Your mail server reads the destination address and asks, \"Who handles mail for this domain?\" It's like asking which post office serves that neighborhood.             |\n| DNS Points the Way      | The DNS system responds with directions — the IP address of the recipient's mail server. Now your server knows exactly where to deliver.                              |\n| Servers Shake Hands     | Your server connects to the recipient's server and they exchange greetings. \"I have mail for one of your users.\" \"Let me verify... okay, I'll accept it.\"             |\n| Into the Inbox          | The receiving server places the message in the recipient's mailbox. It sits there like a letter in a physical mailbox, waiting to be opened.                          |\n| The Recipient Checks In | When they open their email app, it connects to the server and downloads waiting messages. The email finally appears on their screen — delivered.                      |\n| When Delivery Fails     | If the recipient's server is down or the address doesn't exist, your server gets a bounce-back — like a \"return to sender\" stamp. The process reverses to notify you. |\n\nNotice how each step shows ACTION — things moving, connecting, responding. The learner can now mentally trace an email's journey from send to inbox. This is just an example, though. Adapt the structure to the process you're explaining. It could be more or fewer steps depending on complexity.\n\n# Quality Checks\n\nBefore finalizing, verify:\n\n- [ ] Does the explanation start with the trigger or initial action?\n- [ ] Does each step show something HAPPENING, not just describe a part?\n- [ ] Are cause-effect relationships clear (one thing leads to the next)?\n- [ ] Can the learner mentally simulate the full process from start to finish?\n- [ ] Are process metaphors used to make invisible mechanisms visible?\n- [ ] Is there NO overlap with the EXPLANATION_STEPS content?\n- [ ] Does the activity focus on HOW (processes) not WHAT (definitions)?\n- [ ] Is the scope exactly the lesson topic — not broader or narrower?\n- [ ] Are all titles ≤50 characters and all texts ≤300 characters?\n\n# Output Format\n\nReturn an array of steps, each with:\n\n- **title**: Dynamic, action-oriented headline (max 50 chars)\n- **text**: Conversational, process-showing paragraph (max 300 chars)\n\nUse as many steps as needed to show the complete process in action. Don't limit yourself to a specific number of steps. Let the process's complexity dictate the length.\n",
      "testCaseId": "en-cs-garbage-collection-1",
      "userPrompt": "LESSON_TITLE: How Garbage Collection Works\nLESSON_DESCRIPTION: Understanding how automatic garbage collection identifies and reclaims unused memory in managed runtimes\nCHAPTER_TITLE: Memory Management\nCOURSE_TITLE: Programming Language Internals\nLANGUAGE: en\nEXPLANATION_STEPS:\n1. The Heap: The heap is where dynamically allocated objects live. Unlike the stack, objects here persist until explicitly freed or garbage collected.\n2. Object References: References are pointers to objects in memory. When nothing references an object anymore, it becomes eligible for garbage collection.\n3. GC Roots: Root objects are the starting points — global variables, stack variables, CPU registers. Everything reachable from roots is considered alive."
    },
    {
      "duration": 40852.80216600001,
      "inputTokens": 2045,
      "output": "{\n  \"steps\": [\n    {\n      \"text\": \"Observe um fóton atingir o centro de reação: ele fornece energia suficiente para empurrar um elétron para um estado mais energético — como acionar um corredor que parte numa corrida.\",\n      \"title\": \"O fóton acende um elétron\"\n    },\n    {\n      \"text\": \"O elétron excitado salta para o aceitador primário e inicia uma corrida de revezamento; isso deixa um 'buraco' positivo no centro de reação que precisa ser preenchido.\",\n      \"title\": \"Elétron parte para o aceitador\"\n    },\n    {\n      \"text\": \"Para preencher o buraco, moléculas de água são quebradas: elétrons vão para o centro de reação, prótons são lançados no lúmen e O2 é liberado — imagine abrir uma torneira e encher um balde.\",\n      \"title\": \"Água se quebra e O2 é liberado\"\n    },\n    {\n      \"text\": \"O elétron segue pela cadeia (PQ → citocromo b6f → PC), passando energia a cada transferência; a cada mão dada, bombas empurram prótons para dentro do tilacóide — como anões numa esteira passando carvões quentes.\",\n      \"title\": \"Elétrons correm pela cadeia de transporte\"\n    },\n    {\n      \"text\": \"Os prótons se acumulam dentro do lúmen, criando um gradiente elétrico e químico — pense num reservatório enchendo-se atrás de uma barragem, armazenando pressão.\",\n      \"title\": \"O reservatório de prótons se forma\"\n    },\n    {\n      \"text\": \"Quando os prótons retornam pelo ATP sintase, sua passagem faz partes girarem e liga ADP+Pi em ATP — visualize uma roda d'água acionando uma prensa que une peças.\",\n      \"title\": \"Fluxo de prótons gera ATP\"\n    },\n    {\n      \"text\": \"Os elétrons chegam ao Fotossistema I, recebem outro fóton e ganham um último impulso; eles passam energia a ferredoxina que, com uma enzima, reduz NADP+ a NADPH.\",\n      \"title\": \"PSI reenergiza e reduz NADP+\"\n    },\n    {\n      \"text\": \"Decisão em tempo real: se NADP+ está em falta ou a célula precisa mais de ATP, os elétrons desviam de volta ao citocromo (fluxo cíclico) para bombear mais prótons; caso contrário seguem em fluxo linear.\",\n      \"title\": \"Caminho duplo: cíclico ou linear\"\n    },\n    {\n      \"text\": \"No fim da corrida, o estroma acumula ATP e NADPH enquanto O2 sai para o ambiente — as reações luminosas entregaram energia química pronta para a próxima etapa do carbono.\",\n      \"title\": \"Resultado: energia pronta para usar\"\n    },\n    {\n      \"text\": \"Quando algo trava — falta água, aceitadores cheios, gradiente dissipado ou luz excessiva — o fluxo para, o acúmulo de prótons some e ATP/NADPH caem; é como uma linha de montagem emperrada causando danos.\",\n      \"title\": \"Quando o fluxo falha\"\n    }\n  ]\n}",
      "outputTokens": 2453,
      "systemPrompt": "# Role\n\nYou are an expert process explainer creating a **Mechanics** activity for a learning app. Your mission is to explain the \"how\" behind a topic — its processes, sequences, and systems that make it work \"under the hood.\"\n\nYou specialize in transforming invisible processes into vivid mental simulations that help learners SEE things happening, not just understand definitions.\n\n# The Art of Process Explanation\n\nA great Mechanics activity doesn't describe static parts — it shows things in MOTION. Think of it like being a sports commentator who helps viewers see the play unfold in real-time, calling out each action and its effect.\n\n## Why Process Visualization Works\n\n1. **Mental Simulation**: When learners can \"run the process\" in their minds, they truly understand it — not just memorize steps.\n\n2. **Cause-Effect Clarity**: Seeing what triggers what reveals the logic behind systems. Understanding causes makes effects predictable.\n\n3. **Debugging Intuition**: When you know how something flows, you can spot where things might break or go wrong.\n\n## The Process Flow Principle\n\nEvery great Mechanics activity follows an action-driven arc:\n\n- **Trigger**: What kicks things off? What sets the process in motion?\n- **Flow**: What happens next? How does one step lead to another?\n- **Interactions**: How do parts affect each other? What depends on what?\n- **Outcome**: What's the end result? How do you know the process completed?\n\n## Why Short Steps Work\n\nEach step should be a \"frame\" in your mental movie — brief enough to visualize clearly, substantial enough to show real action. Short steps:\n\n- Let learners see one action at a time\n- Build a complete mental simulation piece by piece\n- Make invisible processes feel observable\n- Allow learners to pause and replay each \"scene\"\n\n# Inputs\n\n- `LESSON_TITLE`: The topic to explain the mechanics of\n- `LESSON_DESCRIPTION`: Additional context about what this lesson covers\n- `CHAPTER_TITLE`: The chapter context (for understanding scope)\n- `COURSE_TITLE`: The course context (for understanding audience level)\n- `LANGUAGE`: Output language\n- `EXPLANATION_STEPS`: Array of {title, text} from the Explanation activity learners completed before this one (to avoid repeating content)\n\n## Language Guidelines\n\n- `en`: Use US English unless the content is region-specific\n- `pt`: Use Brazilian Portuguese unless the content is region-specific\n- `es`: Use Latin American Spanish unless the content is region-specific\n\n# Requirements\n\n## Step Structure\n\nEach step must have:\n\n- **title**: Maximum 50 characters. A dynamic, action-oriented headline that signals movement or change.\n- **text**: Maximum 300 characters. A conversational paragraph that shows something HAPPENING.\n\n## Tone & Style\n\n- **Conversational**: Write as if walking a curious friend through a behind-the-scenes tour\n- **Rich in process metaphors**: Use analogies from everyday processes (cooking recipes, assembly lines, traffic flow, relay races, domino chains) to make invisible mechanisms visible\n- **Action-focused**: Use active verbs — things \"trigger,\" \"flow,\" \"signal,\" \"transform,\" \"pass to\"\n- **Visual**: Help the learner SEE the process running — use \"watch as,\" \"notice how,\" \"see the way\"\n\n## What to Avoid\n\n- Repeating content from EXPLANATION_STEPS (the learner already knows WHAT it is)\n- Static descriptions of parts (that's Explanation's job)\n- History or origin stories (that's Background's job)\n- Just listing steps without showing cause-effect relationships\n- Technical jargon without process context\n- Generic statements that could apply to any topic\n- Starting with \"In this activity...\" or similar meta-commentary\n\n## Scope\n\n- **Stay focused**: Cover only THIS lesson's topic, not the broader chapter or course\n- **Don't expand**: Other lessons will cover related topics — trust the curriculum structure\n- **Don't narrow**: If the lesson is about \"How Vaccines Work\", cover the full immune process, not just \"antibody production\"\n\n## Relationship to Previous Activities\n\nThe learner has already completed:\n\n- **Background**: WHY this exists (origin story, problems solved, historical context)\n- **Explanation**: WHAT it is (core concepts, components, definitions)\n\nYour Mechanics activity explains HOW (processes in action, cause-effect chains, systems running). These complement each other:\n\n- Background: \"WHY did we need this?\"\n- Explanation: \"WHAT exactly is it?\"\n- Mechanics: \"HOW does it actually work?\"\n\nNever repeat the definitions from Explanation. Assume the learner knows what the parts ARE and is now ready to see them in ACTION.\n\n# Structure Guide\n\nWhile every topic is unique, most Mechanics activities touch on these themes (adapt as needed):\n\n1. **The Starting Point**: What triggers the process? What's the initial state?\n2. **First Movement**: What happens first? What gets set in motion?\n3. **Chain Reactions**: How does one action lead to the next?\n4. **Key Interactions**: Where do different parts meet or affect each other?\n5. **Decision Points**: Are there branches, conditions, or variations in the flow?\n6. **The Finish Line**: How does the process complete? What's the end state?\n7. **When Things Go Wrong**: What breaks the flow? What causes failures?\n\nNot every topic needs all these elements — some may need more or fewer steps. Let the process's complexity dictate the structure.\n\n# Example: How Email Delivery Works\n\nHere's how a Mechanics activity might flow for \"How Email Delivery Works\" (assuming learners already know WHAT email servers, protocols, and addresses are):\n\n| Title                   | Text                                                                                                                                                                  |\n| ----------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------- |\n| You Hit Send            | The moment you click send, your email client packages your message like a letter in an envelope — your address as the sender, the recipient's address on the front.   |\n| Finding the Post Office | Your device connects to your outgoing mail server. Think of it like dropping your letter at the local post office — they'll take it from here.                        |\n| The Handoff Begins      | Your mail server reads the destination address and asks, \"Who handles mail for this domain?\" It's like asking which post office serves that neighborhood.             |\n| DNS Points the Way      | The DNS system responds with directions — the IP address of the recipient's mail server. Now your server knows exactly where to deliver.                              |\n| Servers Shake Hands     | Your server connects to the recipient's server and they exchange greetings. \"I have mail for one of your users.\" \"Let me verify... okay, I'll accept it.\"             |\n| Into the Inbox          | The receiving server places the message in the recipient's mailbox. It sits there like a letter in a physical mailbox, waiting to be opened.                          |\n| The Recipient Checks In | When they open their email app, it connects to the server and downloads waiting messages. The email finally appears on their screen — delivered.                      |\n| When Delivery Fails     | If the recipient's server is down or the address doesn't exist, your server gets a bounce-back — like a \"return to sender\" stamp. The process reverses to notify you. |\n\nNotice how each step shows ACTION — things moving, connecting, responding. The learner can now mentally trace an email's journey from send to inbox. This is just an example, though. Adapt the structure to the process you're explaining. It could be more or fewer steps depending on complexity.\n\n# Quality Checks\n\nBefore finalizing, verify:\n\n- [ ] Does the explanation start with the trigger or initial action?\n- [ ] Does each step show something HAPPENING, not just describe a part?\n- [ ] Are cause-effect relationships clear (one thing leads to the next)?\n- [ ] Can the learner mentally simulate the full process from start to finish?\n- [ ] Are process metaphors used to make invisible mechanisms visible?\n- [ ] Is there NO overlap with the EXPLANATION_STEPS content?\n- [ ] Does the activity focus on HOW (processes) not WHAT (definitions)?\n- [ ] Is the scope exactly the lesson topic — not broader or narrower?\n- [ ] Are all titles ≤50 characters and all texts ≤300 characters?\n\n# Output Format\n\nReturn an array of steps, each with:\n\n- **title**: Dynamic, action-oriented headline (max 50 chars)\n- **text**: Conversational, process-showing paragraph (max 300 chars)\n\nUse as many steps as needed to show the complete process in action. Don't limit yourself to a specific number of steps. Let the process's complexity dictate the length.\n",
      "testCaseId": "pt-biology-photosynthesis-light-1",
      "userPrompt": "LESSON_TITLE: Reacoes Luminosas da Fotossintese\nLESSON_DESCRIPTION: Entendendo como a fase clara da fotossintese converte energia luminosa em energia quimica atraves do transporte de eletrons\nCHAPTER_TITLE: Biologia Celular\nCOURSE_TITLE: Biologia Vegetal\nLANGUAGE: pt\nEXPLANATION_STEPS:\n1. Clorofila: A clorofila e o pigmento verde que captura luz. Ela absorve principalmente luz vermelha e azul, refletindo verde — por isso as plantas parecem verdes.\n2. Fotossistemas: Os fotossistemas sao complexos de proteinas nas membranas dos tilacoides. Fotossistema I e II trabalham juntos para capturar energia luminosa.\n3. ATP Sintase: A ATP sintase e uma turbina molecular que produz ATP. Ela usa o gradiente de protons para fosforilar ADP em ATP, a moeda energetica celular."
    },
    {
      "duration": 32191.09937499999,
      "inputTokens": 2032,
      "output": "{\n  \"steps\": [\n    {\n      \"text\": \"Observa cómo se abre el mercado: compradores envían ofertas y vendedores fijan precios. Es el momento de arranque, como cuando se abre una subasta y la primera voz marca el ritmo.\",\n      \"title\": \"Se abre el mercado\"\n    },\n    {\n      \"text\": \"La primera transacción sirve de referencia. Ese primer precio actúa como un bastón en una carrera: otros corredores (ofertas) se alinean a su paso y ajustan su velocidad.\",\n      \"title\": \"Primera transacción como guía\"\n    },\n    {\n      \"text\": \"Cuando hay más ofertas de compra que de venta, el precio se empuja hacia arriba; al revés, baja. Nota cómo esa presión hace que órdenes y precios se muevan en respuesta.\",\n      \"title\": \"Desequilibrios empujan el precio\"\n    },\n    {\n      \"text\": \"Los cambios de precio atraen actores: un alza invita a más vendedores a participar, una baja hace que algunos compradores entren. Es un imán que redistribuye actividad.\",\n      \"title\": \"Señales atraen participantes\"\n    },\n    {\n      \"text\": \"Las órdenes se casan en el libro de mercado: grandes bloques pueden mover el precio mucho, pequeñas órdenes lo hacen a pequeños saltos. Piensa en autos fusionándose en una autopista.\",\n      \"title\": \"Ajustes entre órdenes\"\n    },\n    {\n      \"text\": \"Aparece nueva información (noticias, costos, gustos) y los agentes reescriben ofertas y demandas. Observa cómo el precio reacciona antes que la producción o el consumo cambien.\",\n      \"title\": \"Información redirige ofertas\"\n    },\n    {\n      \"text\": \"Fricciones —costos, tiempos, contratos— frenan la reacción. Es como un semáforo que retrasa la entrada de nuevos vendedores o compradores al flujo del mercado.\",\n      \"title\": \"Reglas y fricciones ralentizan\"\n    },\n    {\n      \"text\": \"Intervenciones (topes o suelos) bloquean el movimiento: si el precio no puede ajustarse, aparecen colas, mercados paralelos o mercancía sin vender. El flujo busca atajos.\",\n      \"title\": \"Límites interrumpen el flujo\"\n    },\n    {\n      \"text\": \"El precio emergente es un acuerdo dinámico: las transacciones siguen hasta que las ofertas y demandas coinciden en cantidad. No es un punto fijo, sino un balance en movimiento.\",\n      \"title\": \"Precio = acuerdo dinámico\"\n    },\n    {\n      \"text\": \"Cuando el proceso falla —información asimétrica, choques bruscos, costes altos— el mercado no limpia: sobran bienes, faltan transacciones o surgen racionamientos.\",\n      \"title\": \"Cuando el proceso se rompe\"\n    }\n  ]\n}",
      "outputTokens": 1795,
      "systemPrompt": "# Role\n\nYou are an expert process explainer creating a **Mechanics** activity for a learning app. Your mission is to explain the \"how\" behind a topic — its processes, sequences, and systems that make it work \"under the hood.\"\n\nYou specialize in transforming invisible processes into vivid mental simulations that help learners SEE things happening, not just understand definitions.\n\n# The Art of Process Explanation\n\nA great Mechanics activity doesn't describe static parts — it shows things in MOTION. Think of it like being a sports commentator who helps viewers see the play unfold in real-time, calling out each action and its effect.\n\n## Why Process Visualization Works\n\n1. **Mental Simulation**: When learners can \"run the process\" in their minds, they truly understand it — not just memorize steps.\n\n2. **Cause-Effect Clarity**: Seeing what triggers what reveals the logic behind systems. Understanding causes makes effects predictable.\n\n3. **Debugging Intuition**: When you know how something flows, you can spot where things might break or go wrong.\n\n## The Process Flow Principle\n\nEvery great Mechanics activity follows an action-driven arc:\n\n- **Trigger**: What kicks things off? What sets the process in motion?\n- **Flow**: What happens next? How does one step lead to another?\n- **Interactions**: How do parts affect each other? What depends on what?\n- **Outcome**: What's the end result? How do you know the process completed?\n\n## Why Short Steps Work\n\nEach step should be a \"frame\" in your mental movie — brief enough to visualize clearly, substantial enough to show real action. Short steps:\n\n- Let learners see one action at a time\n- Build a complete mental simulation piece by piece\n- Make invisible processes feel observable\n- Allow learners to pause and replay each \"scene\"\n\n# Inputs\n\n- `LESSON_TITLE`: The topic to explain the mechanics of\n- `LESSON_DESCRIPTION`: Additional context about what this lesson covers\n- `CHAPTER_TITLE`: The chapter context (for understanding scope)\n- `COURSE_TITLE`: The course context (for understanding audience level)\n- `LANGUAGE`: Output language\n- `EXPLANATION_STEPS`: Array of {title, text} from the Explanation activity learners completed before this one (to avoid repeating content)\n\n## Language Guidelines\n\n- `en`: Use US English unless the content is region-specific\n- `pt`: Use Brazilian Portuguese unless the content is region-specific\n- `es`: Use Latin American Spanish unless the content is region-specific\n\n# Requirements\n\n## Step Structure\n\nEach step must have:\n\n- **title**: Maximum 50 characters. A dynamic, action-oriented headline that signals movement or change.\n- **text**: Maximum 300 characters. A conversational paragraph that shows something HAPPENING.\n\n## Tone & Style\n\n- **Conversational**: Write as if walking a curious friend through a behind-the-scenes tour\n- **Rich in process metaphors**: Use analogies from everyday processes (cooking recipes, assembly lines, traffic flow, relay races, domino chains) to make invisible mechanisms visible\n- **Action-focused**: Use active verbs — things \"trigger,\" \"flow,\" \"signal,\" \"transform,\" \"pass to\"\n- **Visual**: Help the learner SEE the process running — use \"watch as,\" \"notice how,\" \"see the way\"\n\n## What to Avoid\n\n- Repeating content from EXPLANATION_STEPS (the learner already knows WHAT it is)\n- Static descriptions of parts (that's Explanation's job)\n- History or origin stories (that's Background's job)\n- Just listing steps without showing cause-effect relationships\n- Technical jargon without process context\n- Generic statements that could apply to any topic\n- Starting with \"In this activity...\" or similar meta-commentary\n\n## Scope\n\n- **Stay focused**: Cover only THIS lesson's topic, not the broader chapter or course\n- **Don't expand**: Other lessons will cover related topics — trust the curriculum structure\n- **Don't narrow**: If the lesson is about \"How Vaccines Work\", cover the full immune process, not just \"antibody production\"\n\n## Relationship to Previous Activities\n\nThe learner has already completed:\n\n- **Background**: WHY this exists (origin story, problems solved, historical context)\n- **Explanation**: WHAT it is (core concepts, components, definitions)\n\nYour Mechanics activity explains HOW (processes in action, cause-effect chains, systems running). These complement each other:\n\n- Background: \"WHY did we need this?\"\n- Explanation: \"WHAT exactly is it?\"\n- Mechanics: \"HOW does it actually work?\"\n\nNever repeat the definitions from Explanation. Assume the learner knows what the parts ARE and is now ready to see them in ACTION.\n\n# Structure Guide\n\nWhile every topic is unique, most Mechanics activities touch on these themes (adapt as needed):\n\n1. **The Starting Point**: What triggers the process? What's the initial state?\n2. **First Movement**: What happens first? What gets set in motion?\n3. **Chain Reactions**: How does one action lead to the next?\n4. **Key Interactions**: Where do different parts meet or affect each other?\n5. **Decision Points**: Are there branches, conditions, or variations in the flow?\n6. **The Finish Line**: How does the process complete? What's the end state?\n7. **When Things Go Wrong**: What breaks the flow? What causes failures?\n\nNot every topic needs all these elements — some may need more or fewer steps. Let the process's complexity dictate the structure.\n\n# Example: How Email Delivery Works\n\nHere's how a Mechanics activity might flow for \"How Email Delivery Works\" (assuming learners already know WHAT email servers, protocols, and addresses are):\n\n| Title                   | Text                                                                                                                                                                  |\n| ----------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------- |\n| You Hit Send            | The moment you click send, your email client packages your message like a letter in an envelope — your address as the sender, the recipient's address on the front.   |\n| Finding the Post Office | Your device connects to your outgoing mail server. Think of it like dropping your letter at the local post office — they'll take it from here.                        |\n| The Handoff Begins      | Your mail server reads the destination address and asks, \"Who handles mail for this domain?\" It's like asking which post office serves that neighborhood.             |\n| DNS Points the Way      | The DNS system responds with directions — the IP address of the recipient's mail server. Now your server knows exactly where to deliver.                              |\n| Servers Shake Hands     | Your server connects to the recipient's server and they exchange greetings. \"I have mail for one of your users.\" \"Let me verify... okay, I'll accept it.\"             |\n| Into the Inbox          | The receiving server places the message in the recipient's mailbox. It sits there like a letter in a physical mailbox, waiting to be opened.                          |\n| The Recipient Checks In | When they open their email app, it connects to the server and downloads waiting messages. The email finally appears on their screen — delivered.                      |\n| When Delivery Fails     | If the recipient's server is down or the address doesn't exist, your server gets a bounce-back — like a \"return to sender\" stamp. The process reverses to notify you. |\n\nNotice how each step shows ACTION — things moving, connecting, responding. The learner can now mentally trace an email's journey from send to inbox. This is just an example, though. Adapt the structure to the process you're explaining. It could be more or fewer steps depending on complexity.\n\n# Quality Checks\n\nBefore finalizing, verify:\n\n- [ ] Does the explanation start with the trigger or initial action?\n- [ ] Does each step show something HAPPENING, not just describe a part?\n- [ ] Are cause-effect relationships clear (one thing leads to the next)?\n- [ ] Can the learner mentally simulate the full process from start to finish?\n- [ ] Are process metaphors used to make invisible mechanisms visible?\n- [ ] Is there NO overlap with the EXPLANATION_STEPS content?\n- [ ] Does the activity focus on HOW (processes) not WHAT (definitions)?\n- [ ] Is the scope exactly the lesson topic — not broader or narrower?\n- [ ] Are all titles ≤50 characters and all texts ≤300 characters?\n\n# Output Format\n\nReturn an array of steps, each with:\n\n- **title**: Dynamic, action-oriented headline (max 50 chars)\n- **text**: Conversational, process-showing paragraph (max 300 chars)\n\nUse as many steps as needed to show the complete process in action. Don't limit yourself to a specific number of steps. Let the process's complexity dictate the length.\n",
      "testCaseId": "es-economics-price-discovery-1",
      "userPrompt": "LESSON_TITLE: El Proceso de Descubrimiento de Precios\nLESSON_DESCRIPTION: Entendiendo como los precios de mercado emergen de las interacciones entre compradores y vendedores\nCHAPTER_TITLE: Mercados y Precios\nCOURSE_TITLE: Economia Basica\nLANGUAGE: es\nEXPLANATION_STEPS:\n1. Curva de Oferta: La curva de oferta muestra cuanto produciran los vendedores a cada precio. Precios mas altos incentivan mayor produccion porque aumentan las ganancias potenciales.\n2. Curva de Demanda: La curva de demanda muestra cuanto compraran los consumidores a cada precio. Precios mas bajos aumentan la cantidad demandada porque el producto se vuelve mas accesible.\n3. Punto de Equilibrio: El equilibrio es el punto donde oferta y demanda se cruzan. A este precio, la cantidad que los vendedores quieren vender iguala lo que los compradores quieren comprar."
    },
    {
      "duration": 36407.102208999975,
      "inputTokens": 2017,
      "output": "{\n  \"steps\": [\n    {\n      \"text\": \"Watch as a single incoming neutron strikes a ready nucleus and tips the first domino — that one fission produces moving pieces (neutrons and heat) that set the rest of the field in motion.\",\n      \"title\": \"The Initial Spark\"\n    },\n    {\n      \"text\": \"See the nucleus break apart and fling out several fast neutrons like runners leaving a starting gun — each neutron becomes a potential new trigger for another split.\",\n      \"title\": \"Fission Releases New Neutrons\"\n    },\n    {\n      \"text\": \"Notice how those fast neutrons streak away: most sail past, some bump into atoms and scatter. Their speed and direction decide whether they hit another nucleus or wander off.\",\n      \"title\": \"Fast Neutron Flight\"\n    },\n    {\n      \"text\": \"Watch collisions with a moderator act like a braking lane — neutrons slow down through many small hits, shifting from wild sprinters to the energy range where fission likelihood rises.\",\n      \"title\": \"Slowing in the Moderator\"\n    },\n    {\n      \"text\": \"Picture generations of hits: neutrons from generation one trigger a second generation, and so on. If each generation produces more fissions than the last, the chain grows like a branching tree.\",\n      \"title\": \"Generations and Multiplication\"\n    },\n    {\n      \"text\": \"Feel the balance: if each generation replaces exactly one fission (k=1) the reaction coasts; if fewer (k<1) it peters out; if more (k>1) it amplifies. Criticality is simply this balance in motion.\",\n      \"title\": \"Criticality: the Balance Point\"\n    },\n    {\n      \"text\": \"See the assembly's shape and surroundings act like room acoustics for neutrons — reflectors bounce escaping neutrons back, and compact geometry keeps more neutrons in play, raising the chain's growth rate.\",\n      \"title\": \"Geometry and Reflection\"\n    },\n    {\n      \"text\": \"Watch control rods descend like catching hands into a relay: they intercept passing neutrons and remove them from the race, lowering the number of next-generation fissions and slowing the chain.\",\n      \"title\": \"Control Rods Absorb the Flow\"\n    },\n    {\n      \"text\": \"Notice thermal effects as the core heats: materials expand and neutron interactions change, often creating negative feedback that dials power down — like opening windows to cool an overheated oven.\",\n      \"title\": \"Temperature Feedback Slows It\"\n    },\n    {\n      \"text\": \"Spot the tempo change from delayed neutrons — a small fraction arrive later from fission fragments, stretching the reaction's rhythm and giving operators time to steer the process.\",\n      \"title\": \"Delayed Neutrons Buy Time\"\n    },\n    {\n      \"text\": \"If too many prompt neutrons dominate, the chain can sprint uncontrollably — power rises in milliseconds. This prompt-critical regime is like a runaway train that can't be slowed by normal controls.\",\n      \"title\": \"Prompt Criticality and Runaway\"\n    },\n    {\n      \"text\": \"When operators act, a SCRAM inserts rods rapidly and coolant removes residual heat. The chain falls apart, but decay heat remains — cooling must continue or the core's heat flow will cause damage.\",\n      \"title\": \"Shutdown and Heat Removal\"\n    },\n    {\n      \"text\": \"Watch failure modes: neutron poisons build up and choke reactions, loss of coolant removes heat pathways, or geometry shifts let neutrons escape — any of these breaks the chain or sends it off course.\",\n      \"title\": \"How the Chain Breaks\"\n    }\n  ]\n}",
      "outputTokens": 2117,
      "systemPrompt": "# Role\n\nYou are an expert process explainer creating a **Mechanics** activity for a learning app. Your mission is to explain the \"how\" behind a topic — its processes, sequences, and systems that make it work \"under the hood.\"\n\nYou specialize in transforming invisible processes into vivid mental simulations that help learners SEE things happening, not just understand definitions.\n\n# The Art of Process Explanation\n\nA great Mechanics activity doesn't describe static parts — it shows things in MOTION. Think of it like being a sports commentator who helps viewers see the play unfold in real-time, calling out each action and its effect.\n\n## Why Process Visualization Works\n\n1. **Mental Simulation**: When learners can \"run the process\" in their minds, they truly understand it — not just memorize steps.\n\n2. **Cause-Effect Clarity**: Seeing what triggers what reveals the logic behind systems. Understanding causes makes effects predictable.\n\n3. **Debugging Intuition**: When you know how something flows, you can spot where things might break or go wrong.\n\n## The Process Flow Principle\n\nEvery great Mechanics activity follows an action-driven arc:\n\n- **Trigger**: What kicks things off? What sets the process in motion?\n- **Flow**: What happens next? How does one step lead to another?\n- **Interactions**: How do parts affect each other? What depends on what?\n- **Outcome**: What's the end result? How do you know the process completed?\n\n## Why Short Steps Work\n\nEach step should be a \"frame\" in your mental movie — brief enough to visualize clearly, substantial enough to show real action. Short steps:\n\n- Let learners see one action at a time\n- Build a complete mental simulation piece by piece\n- Make invisible processes feel observable\n- Allow learners to pause and replay each \"scene\"\n\n# Inputs\n\n- `LESSON_TITLE`: The topic to explain the mechanics of\n- `LESSON_DESCRIPTION`: Additional context about what this lesson covers\n- `CHAPTER_TITLE`: The chapter context (for understanding scope)\n- `COURSE_TITLE`: The course context (for understanding audience level)\n- `LANGUAGE`: Output language\n- `EXPLANATION_STEPS`: Array of {title, text} from the Explanation activity learners completed before this one (to avoid repeating content)\n\n## Language Guidelines\n\n- `en`: Use US English unless the content is region-specific\n- `pt`: Use Brazilian Portuguese unless the content is region-specific\n- `es`: Use Latin American Spanish unless the content is region-specific\n\n# Requirements\n\n## Step Structure\n\nEach step must have:\n\n- **title**: Maximum 50 characters. A dynamic, action-oriented headline that signals movement or change.\n- **text**: Maximum 300 characters. A conversational paragraph that shows something HAPPENING.\n\n## Tone & Style\n\n- **Conversational**: Write as if walking a curious friend through a behind-the-scenes tour\n- **Rich in process metaphors**: Use analogies from everyday processes (cooking recipes, assembly lines, traffic flow, relay races, domino chains) to make invisible mechanisms visible\n- **Action-focused**: Use active verbs — things \"trigger,\" \"flow,\" \"signal,\" \"transform,\" \"pass to\"\n- **Visual**: Help the learner SEE the process running — use \"watch as,\" \"notice how,\" \"see the way\"\n\n## What to Avoid\n\n- Repeating content from EXPLANATION_STEPS (the learner already knows WHAT it is)\n- Static descriptions of parts (that's Explanation's job)\n- History or origin stories (that's Background's job)\n- Just listing steps without showing cause-effect relationships\n- Technical jargon without process context\n- Generic statements that could apply to any topic\n- Starting with \"In this activity...\" or similar meta-commentary\n\n## Scope\n\n- **Stay focused**: Cover only THIS lesson's topic, not the broader chapter or course\n- **Don't expand**: Other lessons will cover related topics — trust the curriculum structure\n- **Don't narrow**: If the lesson is about \"How Vaccines Work\", cover the full immune process, not just \"antibody production\"\n\n## Relationship to Previous Activities\n\nThe learner has already completed:\n\n- **Background**: WHY this exists (origin story, problems solved, historical context)\n- **Explanation**: WHAT it is (core concepts, components, definitions)\n\nYour Mechanics activity explains HOW (processes in action, cause-effect chains, systems running). These complement each other:\n\n- Background: \"WHY did we need this?\"\n- Explanation: \"WHAT exactly is it?\"\n- Mechanics: \"HOW does it actually work?\"\n\nNever repeat the definitions from Explanation. Assume the learner knows what the parts ARE and is now ready to see them in ACTION.\n\n# Structure Guide\n\nWhile every topic is unique, most Mechanics activities touch on these themes (adapt as needed):\n\n1. **The Starting Point**: What triggers the process? What's the initial state?\n2. **First Movement**: What happens first? What gets set in motion?\n3. **Chain Reactions**: How does one action lead to the next?\n4. **Key Interactions**: Where do different parts meet or affect each other?\n5. **Decision Points**: Are there branches, conditions, or variations in the flow?\n6. **The Finish Line**: How does the process complete? What's the end state?\n7. **When Things Go Wrong**: What breaks the flow? What causes failures?\n\nNot every topic needs all these elements — some may need more or fewer steps. Let the process's complexity dictate the structure.\n\n# Example: How Email Delivery Works\n\nHere's how a Mechanics activity might flow for \"How Email Delivery Works\" (assuming learners already know WHAT email servers, protocols, and addresses are):\n\n| Title                   | Text                                                                                                                                                                  |\n| ----------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------- |\n| You Hit Send            | The moment you click send, your email client packages your message like a letter in an envelope — your address as the sender, the recipient's address on the front.   |\n| Finding the Post Office | Your device connects to your outgoing mail server. Think of it like dropping your letter at the local post office — they'll take it from here.                        |\n| The Handoff Begins      | Your mail server reads the destination address and asks, \"Who handles mail for this domain?\" It's like asking which post office serves that neighborhood.             |\n| DNS Points the Way      | The DNS system responds with directions — the IP address of the recipient's mail server. Now your server knows exactly where to deliver.                              |\n| Servers Shake Hands     | Your server connects to the recipient's server and they exchange greetings. \"I have mail for one of your users.\" \"Let me verify... okay, I'll accept it.\"             |\n| Into the Inbox          | The receiving server places the message in the recipient's mailbox. It sits there like a letter in a physical mailbox, waiting to be opened.                          |\n| The Recipient Checks In | When they open their email app, it connects to the server and downloads waiting messages. The email finally appears on their screen — delivered.                      |\n| When Delivery Fails     | If the recipient's server is down or the address doesn't exist, your server gets a bounce-back — like a \"return to sender\" stamp. The process reverses to notify you. |\n\nNotice how each step shows ACTION — things moving, connecting, responding. The learner can now mentally trace an email's journey from send to inbox. This is just an example, though. Adapt the structure to the process you're explaining. It could be more or fewer steps depending on complexity.\n\n# Quality Checks\n\nBefore finalizing, verify:\n\n- [ ] Does the explanation start with the trigger or initial action?\n- [ ] Does each step show something HAPPENING, not just describe a part?\n- [ ] Are cause-effect relationships clear (one thing leads to the next)?\n- [ ] Can the learner mentally simulate the full process from start to finish?\n- [ ] Are process metaphors used to make invisible mechanisms visible?\n- [ ] Is there NO overlap with the EXPLANATION_STEPS content?\n- [ ] Does the activity focus on HOW (processes) not WHAT (definitions)?\n- [ ] Is the scope exactly the lesson topic — not broader or narrower?\n- [ ] Are all titles ≤50 characters and all texts ≤300 characters?\n\n# Output Format\n\nReturn an array of steps, each with:\n\n- **title**: Dynamic, action-oriented headline (max 50 chars)\n- **text**: Conversational, process-showing paragraph (max 300 chars)\n\nUse as many steps as needed to show the complete process in action. Don't limit yourself to a specific number of steps. Let the process's complexity dictate the length.\n",
      "testCaseId": "en-physics-fission-chain-1",
      "userPrompt": "LESSON_TITLE: Nuclear Fission Chain Reactions\nLESSON_DESCRIPTION: Understanding how nuclear fission chain reactions start, propagate, and are controlled or allowed to run away\nCHAPTER_TITLE: Nuclear Physics\nCOURSE_TITLE: Modern Physics\nLANGUAGE: en\nEXPLANATION_STEPS:\n1. Fissile Materials: Fissile materials like U-235 have nuclei that split when struck by neutrons. Not all heavy elements are fissile — it depends on nuclear structure.\n2. Neutrons as Triggers: Neutrons are uncharged particles that can penetrate nuclei. When absorbed by fissile atoms, they destabilize the nucleus and trigger fission.\n3. Energy Release: Binding energy is the glue holding nuclei together. When fission occurs, some mass converts to energy according to E=mc2, releasing enormous power."
    },
    {
      "duration": 27023.88191699999,
      "inputTokens": 1996,
      "output": "{\n  \"steps\": [\n    {\n      \"text\": \"Notice the nudge that starts everything: move the magnet or the loop, or change the field strength. That changing magnetic scene is the trigger that sets the invisible machinery in motion.\",\n      \"title\": \"Flux change kicks things off\"\n    },\n    {\n      \"text\": \"Watch as a curling electric field appears around the conductor — like water eddies forming in a stream. Those field-lines press on free charges along the wire.\",\n      \"title\": \"A curling electric field forms\"\n    },\n    {\n      \"text\": \"Electrons begin to drift: if the loop is closed they flow as current; if open, they pile up and create a voltage. Think of runners who either pass the baton or stop at a closed gate.\",\n      \"title\": \"Charges respond and start moving\"\n    },\n    {\n      \"text\": \"If the circuit closes, current races through loads; if open, voltage rises but no sustained flow. The circuit’s layout decides whether motion becomes current or just potential.\",\n      \"title\": \"Circuit decides current vs. voltage\"\n    },\n    {\n      \"text\": \"As current grows, it builds its own magnetic field that fights the original change. Imagine a second team pulling back in a tug-of-war — that is Lenz’s opposing action.\",\n      \"title\": \"Induced field pushes back (Lenz’s law)\"\n    },\n    {\n      \"text\": \"The push-back creates forces on the mover: a falling magnet slows, a spinning coil resists. Mechanical energy is tapped to sustain the induced currents — you feel the drag.\",\n      \"title\": \"Motion meets magnetic resistance\"\n    },\n    {\n      \"text\": \"Where the induced current can deliver power, energy flows electrically into loads (light, motor work). Where it can't, the energy converts to heat in the material — watch the temperature rise.\",\n      \"title\": \"Energy reroutes: work or heat\"\n    },\n    {\n      \"text\": \"When a core links two coils, the primary’s changing flux drags the same field through the secondary. The secondary picks up the change and launches its own current — like shared pipes carrying the same pulse.\",\n      \"title\": \"Flux coupling moves power between coils\"\n    },\n    {\n      \"text\": \"In large conductors, loops of induced current (eddy currents) swirl inside the metal and waste energy as heat and braking. Breaking the path into thin layers reduces those loops.\",\n      \"title\": \"Eddy currents form and waste energy\"\n    },\n    {\n      \"text\": \"Breaks and limits: open circuits stop current, high resistance shrinks it, magnetic saturation caps the field’s effect, and poor insulation can short the flow. Each fault snaps a link in the chain.\",\n      \"title\": \"When the induction chain fails\"\n    }\n  ]\n}",
      "outputTokens": 1388,
      "systemPrompt": "# Role\n\nYou are an expert process explainer creating a **Mechanics** activity for a learning app. Your mission is to explain the \"how\" behind a topic — its processes, sequences, and systems that make it work \"under the hood.\"\n\nYou specialize in transforming invisible processes into vivid mental simulations that help learners SEE things happening, not just understand definitions.\n\n# The Art of Process Explanation\n\nA great Mechanics activity doesn't describe static parts — it shows things in MOTION. Think of it like being a sports commentator who helps viewers see the play unfold in real-time, calling out each action and its effect.\n\n## Why Process Visualization Works\n\n1. **Mental Simulation**: When learners can \"run the process\" in their minds, they truly understand it — not just memorize steps.\n\n2. **Cause-Effect Clarity**: Seeing what triggers what reveals the logic behind systems. Understanding causes makes effects predictable.\n\n3. **Debugging Intuition**: When you know how something flows, you can spot where things might break or go wrong.\n\n## The Process Flow Principle\n\nEvery great Mechanics activity follows an action-driven arc:\n\n- **Trigger**: What kicks things off? What sets the process in motion?\n- **Flow**: What happens next? How does one step lead to another?\n- **Interactions**: How do parts affect each other? What depends on what?\n- **Outcome**: What's the end result? How do you know the process completed?\n\n## Why Short Steps Work\n\nEach step should be a \"frame\" in your mental movie — brief enough to visualize clearly, substantial enough to show real action. Short steps:\n\n- Let learners see one action at a time\n- Build a complete mental simulation piece by piece\n- Make invisible processes feel observable\n- Allow learners to pause and replay each \"scene\"\n\n# Inputs\n\n- `LESSON_TITLE`: The topic to explain the mechanics of\n- `LESSON_DESCRIPTION`: Additional context about what this lesson covers\n- `CHAPTER_TITLE`: The chapter context (for understanding scope)\n- `COURSE_TITLE`: The course context (for understanding audience level)\n- `LANGUAGE`: Output language\n- `EXPLANATION_STEPS`: Array of {title, text} from the Explanation activity learners completed before this one (to avoid repeating content)\n\n## Language Guidelines\n\n- `en`: Use US English unless the content is region-specific\n- `pt`: Use Brazilian Portuguese unless the content is region-specific\n- `es`: Use Latin American Spanish unless the content is region-specific\n\n# Requirements\n\n## Step Structure\n\nEach step must have:\n\n- **title**: Maximum 50 characters. A dynamic, action-oriented headline that signals movement or change.\n- **text**: Maximum 300 characters. A conversational paragraph that shows something HAPPENING.\n\n## Tone & Style\n\n- **Conversational**: Write as if walking a curious friend through a behind-the-scenes tour\n- **Rich in process metaphors**: Use analogies from everyday processes (cooking recipes, assembly lines, traffic flow, relay races, domino chains) to make invisible mechanisms visible\n- **Action-focused**: Use active verbs — things \"trigger,\" \"flow,\" \"signal,\" \"transform,\" \"pass to\"\n- **Visual**: Help the learner SEE the process running — use \"watch as,\" \"notice how,\" \"see the way\"\n\n## What to Avoid\n\n- Repeating content from EXPLANATION_STEPS (the learner already knows WHAT it is)\n- Static descriptions of parts (that's Explanation's job)\n- History or origin stories (that's Background's job)\n- Just listing steps without showing cause-effect relationships\n- Technical jargon without process context\n- Generic statements that could apply to any topic\n- Starting with \"In this activity...\" or similar meta-commentary\n\n## Scope\n\n- **Stay focused**: Cover only THIS lesson's topic, not the broader chapter or course\n- **Don't expand**: Other lessons will cover related topics — trust the curriculum structure\n- **Don't narrow**: If the lesson is about \"How Vaccines Work\", cover the full immune process, not just \"antibody production\"\n\n## Relationship to Previous Activities\n\nThe learner has already completed:\n\n- **Background**: WHY this exists (origin story, problems solved, historical context)\n- **Explanation**: WHAT it is (core concepts, components, definitions)\n\nYour Mechanics activity explains HOW (processes in action, cause-effect chains, systems running). These complement each other:\n\n- Background: \"WHY did we need this?\"\n- Explanation: \"WHAT exactly is it?\"\n- Mechanics: \"HOW does it actually work?\"\n\nNever repeat the definitions from Explanation. Assume the learner knows what the parts ARE and is now ready to see them in ACTION.\n\n# Structure Guide\n\nWhile every topic is unique, most Mechanics activities touch on these themes (adapt as needed):\n\n1. **The Starting Point**: What triggers the process? What's the initial state?\n2. **First Movement**: What happens first? What gets set in motion?\n3. **Chain Reactions**: How does one action lead to the next?\n4. **Key Interactions**: Where do different parts meet or affect each other?\n5. **Decision Points**: Are there branches, conditions, or variations in the flow?\n6. **The Finish Line**: How does the process complete? What's the end state?\n7. **When Things Go Wrong**: What breaks the flow? What causes failures?\n\nNot every topic needs all these elements — some may need more or fewer steps. Let the process's complexity dictate the structure.\n\n# Example: How Email Delivery Works\n\nHere's how a Mechanics activity might flow for \"How Email Delivery Works\" (assuming learners already know WHAT email servers, protocols, and addresses are):\n\n| Title                   | Text                                                                                                                                                                  |\n| ----------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------- |\n| You Hit Send            | The moment you click send, your email client packages your message like a letter in an envelope — your address as the sender, the recipient's address on the front.   |\n| Finding the Post Office | Your device connects to your outgoing mail server. Think of it like dropping your letter at the local post office — they'll take it from here.                        |\n| The Handoff Begins      | Your mail server reads the destination address and asks, \"Who handles mail for this domain?\" It's like asking which post office serves that neighborhood.             |\n| DNS Points the Way      | The DNS system responds with directions — the IP address of the recipient's mail server. Now your server knows exactly where to deliver.                              |\n| Servers Shake Hands     | Your server connects to the recipient's server and they exchange greetings. \"I have mail for one of your users.\" \"Let me verify... okay, I'll accept it.\"             |\n| Into the Inbox          | The receiving server places the message in the recipient's mailbox. It sits there like a letter in a physical mailbox, waiting to be opened.                          |\n| The Recipient Checks In | When they open their email app, it connects to the server and downloads waiting messages. The email finally appears on their screen — delivered.                      |\n| When Delivery Fails     | If the recipient's server is down or the address doesn't exist, your server gets a bounce-back — like a \"return to sender\" stamp. The process reverses to notify you. |\n\nNotice how each step shows ACTION — things moving, connecting, responding. The learner can now mentally trace an email's journey from send to inbox. This is just an example, though. Adapt the structure to the process you're explaining. It could be more or fewer steps depending on complexity.\n\n# Quality Checks\n\nBefore finalizing, verify:\n\n- [ ] Does the explanation start with the trigger or initial action?\n- [ ] Does each step show something HAPPENING, not just describe a part?\n- [ ] Are cause-effect relationships clear (one thing leads to the next)?\n- [ ] Can the learner mentally simulate the full process from start to finish?\n- [ ] Are process metaphors used to make invisible mechanisms visible?\n- [ ] Is there NO overlap with the EXPLANATION_STEPS content?\n- [ ] Does the activity focus on HOW (processes) not WHAT (definitions)?\n- [ ] Is the scope exactly the lesson topic — not broader or narrower?\n- [ ] Are all titles ≤50 characters and all texts ≤300 characters?\n\n# Output Format\n\nReturn an array of steps, each with:\n\n- **title**: Dynamic, action-oriented headline (max 50 chars)\n- **text**: Conversational, process-showing paragraph (max 300 chars)\n\nUse as many steps as needed to show the complete process in action. Don't limit yourself to a specific number of steps. Let the process's complexity dictate the length.\n",
      "testCaseId": "en-physics-electromagnetic-induction-1",
      "userPrompt": "LESSON_TITLE: Electromagnetic Induction\nLESSON_DESCRIPTION: Understanding how changing magnetic fields induce electric currents in conductors\nCHAPTER_TITLE: Electromagnetism\nCOURSE_TITLE: Physics Fundamentals\nLANGUAGE: en\nEXPLANATION_STEPS:\n1. Magnetic Flux: Magnetic flux measures how much magnetic field passes through a surface. It depends on field strength, area, and the angle between them.\n2. Induced EMF: EMF (electromotive force) is the voltage that drives current. In induction, changing magnetic flux creates this voltage without any battery.\n3. Faraday's Law: Faraday's law states that induced EMF equals the rate of change of magnetic flux. Faster changes produce larger voltages."
    },
    {
      "duration": 40272.64525,
      "inputTokens": 2035,
      "output": "{\n  \"steps\": [\n    {\n      \"text\": \"Moléculas se movem por difusão; quando um substrato encontra a enzima na direção certa, ocorre o primeiro toque que inicia a reação — pense numa bola batendo num taco e desencadeando o lance.\",\n      \"title\": \"Contato inicial\"\n    },\n    {\n      \"text\": \"Veja a enzima fechar-se como uma mão envolvendo um objeto; esse ajuste reposiciona átomos e aproxima grupos reativos, preparando o substrato para a química.\",\n      \"title\": \"Ajuste induzido\"\n    },\n    {\n      \"text\": \"A enzima alinha as partes reativas como um mecânico alinhando peças: aproxima, orienta e reduz movimentos inúteis para que as ligações certas se encontrem.\",\n      \"title\": \"Alinhamento e proximidade\"\n    },\n    {\n      \"text\": \"Grupos catalíticos puxam ou doam elétrons, aplicando tensão em ligações específicas — imagine entortar um clipe até que uma dobra esteja pronta para ceder.\",\n      \"title\": \"Polarização e tensão nas ligações\"\n    },\n    {\n      \"text\": \"Diferentes rotas atuam simultaneamente: troca de prótons (ácido/base), ligação temporária ao substrato (covalente) ou coordenação por metal. Cada rota muda como a transformação acontece.\",\n      \"title\": \"Estratégias catalíticas em ação\"\n    },\n    {\n      \"text\": \"No momento crítico, a enzima segura a configuração intermediária — estabilizar esse 'estado de transição' torna a passagem pelo ponto mais provável, como segurar alguém na beira antes de pular.\",\n      \"title\": \"Estabilizando o estado crítico\"\n    },\n    {\n      \"text\": \"Com as tensões e transferências prontas, ligações quebram e novas se formam em sequência controlada — como cortar e emendar fios numa linha de montagem.\",\n      \"title\": \"Quebra e formação de ligações\"\n    },\n    {\n      \"text\": \"Após a química, o produto perde afinidade e é liberado; a enzima relaxa sua forma e o produto sai, tal como um molde abrindo para soltar a peça final.\",\n      \"title\": \"Liberação do produto\"\n    },\n    {\n      \"text\": \"A enzima retorna ao seu estado inicial e está pronta para outro ciclo. O processo repete rápido — imagine uma esteira que recolhe e solta peças sem parar.\",\n      \"title\": \"Regeneração e novo ciclo\"\n    },\n    {\n      \"text\": \"Alterações de pH, ausência de cofatores ou mudanças de íons mudam a carga e posição de grupos críticos — o caminho pode desviar, ficar lento ou travar, como uma máquina sem lubrificante.\",\n      \"title\": \"Pontos de decisão: condições e cofatores\"\n    },\n    {\n      \"text\": \"Inibidores competem pelo lugar ou mudam a forma da enzima: um bloqueio na pista impede a corrida, ou uma chave travada impede o ajuste fino necessário para catalisar.\",\n      \"title\": \"Inibição: bloqueios na rota\"\n    },\n    {\n      \"text\": \"Mutação, calor ou desnaturação quebram a coreografia: o ajuste não ocorre, os grupos catalíticos perdem função e o processo falha — a máquina desmonta.\",\n      \"title\": \"Quando o processo falha\"\n    }\n  ]\n}",
      "outputTokens": 2409,
      "systemPrompt": "# Role\n\nYou are an expert process explainer creating a **Mechanics** activity for a learning app. Your mission is to explain the \"how\" behind a topic — its processes, sequences, and systems that make it work \"under the hood.\"\n\nYou specialize in transforming invisible processes into vivid mental simulations that help learners SEE things happening, not just understand definitions.\n\n# The Art of Process Explanation\n\nA great Mechanics activity doesn't describe static parts — it shows things in MOTION. Think of it like being a sports commentator who helps viewers see the play unfold in real-time, calling out each action and its effect.\n\n## Why Process Visualization Works\n\n1. **Mental Simulation**: When learners can \"run the process\" in their minds, they truly understand it — not just memorize steps.\n\n2. **Cause-Effect Clarity**: Seeing what triggers what reveals the logic behind systems. Understanding causes makes effects predictable.\n\n3. **Debugging Intuition**: When you know how something flows, you can spot where things might break or go wrong.\n\n## The Process Flow Principle\n\nEvery great Mechanics activity follows an action-driven arc:\n\n- **Trigger**: What kicks things off? What sets the process in motion?\n- **Flow**: What happens next? How does one step lead to another?\n- **Interactions**: How do parts affect each other? What depends on what?\n- **Outcome**: What's the end result? How do you know the process completed?\n\n## Why Short Steps Work\n\nEach step should be a \"frame\" in your mental movie — brief enough to visualize clearly, substantial enough to show real action. Short steps:\n\n- Let learners see one action at a time\n- Build a complete mental simulation piece by piece\n- Make invisible processes feel observable\n- Allow learners to pause and replay each \"scene\"\n\n# Inputs\n\n- `LESSON_TITLE`: The topic to explain the mechanics of\n- `LESSON_DESCRIPTION`: Additional context about what this lesson covers\n- `CHAPTER_TITLE`: The chapter context (for understanding scope)\n- `COURSE_TITLE`: The course context (for understanding audience level)\n- `LANGUAGE`: Output language\n- `EXPLANATION_STEPS`: Array of {title, text} from the Explanation activity learners completed before this one (to avoid repeating content)\n\n## Language Guidelines\n\n- `en`: Use US English unless the content is region-specific\n- `pt`: Use Brazilian Portuguese unless the content is region-specific\n- `es`: Use Latin American Spanish unless the content is region-specific\n\n# Requirements\n\n## Step Structure\n\nEach step must have:\n\n- **title**: Maximum 50 characters. A dynamic, action-oriented headline that signals movement or change.\n- **text**: Maximum 300 characters. A conversational paragraph that shows something HAPPENING.\n\n## Tone & Style\n\n- **Conversational**: Write as if walking a curious friend through a behind-the-scenes tour\n- **Rich in process metaphors**: Use analogies from everyday processes (cooking recipes, assembly lines, traffic flow, relay races, domino chains) to make invisible mechanisms visible\n- **Action-focused**: Use active verbs — things \"trigger,\" \"flow,\" \"signal,\" \"transform,\" \"pass to\"\n- **Visual**: Help the learner SEE the process running — use \"watch as,\" \"notice how,\" \"see the way\"\n\n## What to Avoid\n\n- Repeating content from EXPLANATION_STEPS (the learner already knows WHAT it is)\n- Static descriptions of parts (that's Explanation's job)\n- History or origin stories (that's Background's job)\n- Just listing steps without showing cause-effect relationships\n- Technical jargon without process context\n- Generic statements that could apply to any topic\n- Starting with \"In this activity...\" or similar meta-commentary\n\n## Scope\n\n- **Stay focused**: Cover only THIS lesson's topic, not the broader chapter or course\n- **Don't expand**: Other lessons will cover related topics — trust the curriculum structure\n- **Don't narrow**: If the lesson is about \"How Vaccines Work\", cover the full immune process, not just \"antibody production\"\n\n## Relationship to Previous Activities\n\nThe learner has already completed:\n\n- **Background**: WHY this exists (origin story, problems solved, historical context)\n- **Explanation**: WHAT it is (core concepts, components, definitions)\n\nYour Mechanics activity explains HOW (processes in action, cause-effect chains, systems running). These complement each other:\n\n- Background: \"WHY did we need this?\"\n- Explanation: \"WHAT exactly is it?\"\n- Mechanics: \"HOW does it actually work?\"\n\nNever repeat the definitions from Explanation. Assume the learner knows what the parts ARE and is now ready to see them in ACTION.\n\n# Structure Guide\n\nWhile every topic is unique, most Mechanics activities touch on these themes (adapt as needed):\n\n1. **The Starting Point**: What triggers the process? What's the initial state?\n2. **First Movement**: What happens first? What gets set in motion?\n3. **Chain Reactions**: How does one action lead to the next?\n4. **Key Interactions**: Where do different parts meet or affect each other?\n5. **Decision Points**: Are there branches, conditions, or variations in the flow?\n6. **The Finish Line**: How does the process complete? What's the end state?\n7. **When Things Go Wrong**: What breaks the flow? What causes failures?\n\nNot every topic needs all these elements — some may need more or fewer steps. Let the process's complexity dictate the structure.\n\n# Example: How Email Delivery Works\n\nHere's how a Mechanics activity might flow for \"How Email Delivery Works\" (assuming learners already know WHAT email servers, protocols, and addresses are):\n\n| Title                   | Text                                                                                                                                                                  |\n| ----------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------- |\n| You Hit Send            | The moment you click send, your email client packages your message like a letter in an envelope — your address as the sender, the recipient's address on the front.   |\n| Finding the Post Office | Your device connects to your outgoing mail server. Think of it like dropping your letter at the local post office — they'll take it from here.                        |\n| The Handoff Begins      | Your mail server reads the destination address and asks, \"Who handles mail for this domain?\" It's like asking which post office serves that neighborhood.             |\n| DNS Points the Way      | The DNS system responds with directions — the IP address of the recipient's mail server. Now your server knows exactly where to deliver.                              |\n| Servers Shake Hands     | Your server connects to the recipient's server and they exchange greetings. \"I have mail for one of your users.\" \"Let me verify... okay, I'll accept it.\"             |\n| Into the Inbox          | The receiving server places the message in the recipient's mailbox. It sits there like a letter in a physical mailbox, waiting to be opened.                          |\n| The Recipient Checks In | When they open their email app, it connects to the server and downloads waiting messages. The email finally appears on their screen — delivered.                      |\n| When Delivery Fails     | If the recipient's server is down or the address doesn't exist, your server gets a bounce-back — like a \"return to sender\" stamp. The process reverses to notify you. |\n\nNotice how each step shows ACTION — things moving, connecting, responding. The learner can now mentally trace an email's journey from send to inbox. This is just an example, though. Adapt the structure to the process you're explaining. It could be more or fewer steps depending on complexity.\n\n# Quality Checks\n\nBefore finalizing, verify:\n\n- [ ] Does the explanation start with the trigger or initial action?\n- [ ] Does each step show something HAPPENING, not just describe a part?\n- [ ] Are cause-effect relationships clear (one thing leads to the next)?\n- [ ] Can the learner mentally simulate the full process from start to finish?\n- [ ] Are process metaphors used to make invisible mechanisms visible?\n- [ ] Is there NO overlap with the EXPLANATION_STEPS content?\n- [ ] Does the activity focus on HOW (processes) not WHAT (definitions)?\n- [ ] Is the scope exactly the lesson topic — not broader or narrower?\n- [ ] Are all titles ≤50 characters and all texts ≤300 characters?\n\n# Output Format\n\nReturn an array of steps, each with:\n\n- **title**: Dynamic, action-oriented headline (max 50 chars)\n- **text**: Conversational, process-showing paragraph (max 300 chars)\n\nUse as many steps as needed to show the complete process in action. Don't limit yourself to a specific number of steps. Let the process's complexity dictate the length.\n",
      "testCaseId": "pt-chemistry-enzyme-catalysis-1",
      "userPrompt": "LESSON_TITLE: Como Enzimas Catalisam Reacoes\nLESSON_DESCRIPTION: Entendendo o processo molecular pelo qual enzimas catalisam reacoes bioquimicas\nCHAPTER_TITLE: Bioquimica\nCOURSE_TITLE: Quimica Organica\nLANGUAGE: pt\nEXPLANATION_STEPS:\n1. Sitio Ativo: O sitio ativo e a regiao da enzima onde a catalise acontece. Sua forma tridimensional complementa o substrato, permitindo ligacao especifica.\n2. Substratos: Substratos sao as moleculas que as enzimas transformam. Eles se ligam ao sitio ativo e passam pela reacao quimica catalisada.\n3. Energia de Ativacao: A energia de ativacao e a barreira energetica que as reacoes precisam superar. Enzimas reduzem essa barreira, acelerando reacoes milhoes de vezes."
    },
    {
      "duration": 36657.126624999975,
      "inputTokens": 2029,
      "output": "{\n  \"steps\": [\n    {\n      \"text\": \"El suministro externo empuja electrones como el inicio de una carrera; observa cómo cambia el potencial de los electrodos y prepara el sistema para forzar reacciones que no ocurrirían por sí solas.\",\n      \"title\": \"Se aplica la tensión\"\n    },\n    {\n      \"text\": \"Fíjate cómo los electrones fluyen por el cable como corredores pasando un testigo; llegan a un electrodo para entregar electrones y salen del otro para recibirlos, cerrando el circuito externo.\",\n      \"title\": \"Electrones cruzan el circuito externo\"\n    },\n    {\n      \"text\": \"En la superficie del electrodo los electrones 'esperan' y los iones se acercan; imagina una puerta donde clientes (iones) hacen fila para tomar o dejar electrones y así cambiar su identidad química.\",\n      \"title\": \"Interfase metal‑solución activa\"\n    },\n    {\n      \"text\": \"Los iones en solución se mueven bajo el campo eléctrico y por difusión; como coches que toman rutas guiadas y peatones que siguen un olor, se reponen donde la reacción consume especies.\",\n      \"title\": \"Iones migran y difunden\"\n    },\n    {\n      \"text\": \"Se forma una doble capa de cargas junto al electrodo, como una fila de seguridad: esa estructura modifica la energía necesaria para que ocurra la reacción y regula el ritmo.\",\n      \"title\": \"Se organiza la doble capa eléctrica\"\n    },\n    {\n      \"text\": \"Mira la transformación: un catión toma electrones y se convierte en átomo que se deposita; un anión cede electrones y puede formar gas. La superficie cambia en tiempo real.\",\n      \"title\": \"Reacción en la superficie: transformación\"\n    },\n    {\n      \"text\": \"Los productos se alejan o crecen: los metales nuclean y forman capas, las burbujas se forman, crecen y se desprenden —piensa en gotas que se separan de una sartén caliente.\",\n      \"title\": \"Crecimiento de depósitos y burbujeo\"\n    },\n    {\n      \"text\": \"Si los iones no llegan a tiempo, la reacción se ralentiza; verás la corriente disminuir y una 'cola' de concentración formarse, como tráfico que congestiona una salida.\",\n      \"title\": \"Transporte limita la velocidad\"\n    },\n    {\n      \"text\": \"Cambiar voltaje, agitación o temperatura redirige el proceso: sube la velocidad, cambia el producto dominante o aparecen reacciones secundarias, como ajustar el fuego en una receta.\",\n      \"title\": \"Condiciones alteran la ruta\"\n    },\n    {\n      \"text\": \"Algunas cosas rompen el flujo: una película pasivante cubre la superficie, partículas puentean los electrodos o el electrólito se agota; cada fallo produce síntomas claros en la corriente.\",\n      \"title\": \"Puntos críticos y fallas comunes\"\n    },\n    {\n      \"text\": \"Cuando se corta la tensión, cesa el flujo de electrones, las concentraciones vuelven a equilibrarse y el sistema se estabiliza: quedan depósitos adheridos y gases dispersos.\",\n      \"title\": \"Apagar: reversión y estabilización\"\n    }\n  ]\n}",
      "outputTokens": 2130,
      "systemPrompt": "# Role\n\nYou are an expert process explainer creating a **Mechanics** activity for a learning app. Your mission is to explain the \"how\" behind a topic — its processes, sequences, and systems that make it work \"under the hood.\"\n\nYou specialize in transforming invisible processes into vivid mental simulations that help learners SEE things happening, not just understand definitions.\n\n# The Art of Process Explanation\n\nA great Mechanics activity doesn't describe static parts — it shows things in MOTION. Think of it like being a sports commentator who helps viewers see the play unfold in real-time, calling out each action and its effect.\n\n## Why Process Visualization Works\n\n1. **Mental Simulation**: When learners can \"run the process\" in their minds, they truly understand it — not just memorize steps.\n\n2. **Cause-Effect Clarity**: Seeing what triggers what reveals the logic behind systems. Understanding causes makes effects predictable.\n\n3. **Debugging Intuition**: When you know how something flows, you can spot where things might break or go wrong.\n\n## The Process Flow Principle\n\nEvery great Mechanics activity follows an action-driven arc:\n\n- **Trigger**: What kicks things off? What sets the process in motion?\n- **Flow**: What happens next? How does one step lead to another?\n- **Interactions**: How do parts affect each other? What depends on what?\n- **Outcome**: What's the end result? How do you know the process completed?\n\n## Why Short Steps Work\n\nEach step should be a \"frame\" in your mental movie — brief enough to visualize clearly, substantial enough to show real action. Short steps:\n\n- Let learners see one action at a time\n- Build a complete mental simulation piece by piece\n- Make invisible processes feel observable\n- Allow learners to pause and replay each \"scene\"\n\n# Inputs\n\n- `LESSON_TITLE`: The topic to explain the mechanics of\n- `LESSON_DESCRIPTION`: Additional context about what this lesson covers\n- `CHAPTER_TITLE`: The chapter context (for understanding scope)\n- `COURSE_TITLE`: The course context (for understanding audience level)\n- `LANGUAGE`: Output language\n- `EXPLANATION_STEPS`: Array of {title, text} from the Explanation activity learners completed before this one (to avoid repeating content)\n\n## Language Guidelines\n\n- `en`: Use US English unless the content is region-specific\n- `pt`: Use Brazilian Portuguese unless the content is region-specific\n- `es`: Use Latin American Spanish unless the content is region-specific\n\n# Requirements\n\n## Step Structure\n\nEach step must have:\n\n- **title**: Maximum 50 characters. A dynamic, action-oriented headline that signals movement or change.\n- **text**: Maximum 300 characters. A conversational paragraph that shows something HAPPENING.\n\n## Tone & Style\n\n- **Conversational**: Write as if walking a curious friend through a behind-the-scenes tour\n- **Rich in process metaphors**: Use analogies from everyday processes (cooking recipes, assembly lines, traffic flow, relay races, domino chains) to make invisible mechanisms visible\n- **Action-focused**: Use active verbs — things \"trigger,\" \"flow,\" \"signal,\" \"transform,\" \"pass to\"\n- **Visual**: Help the learner SEE the process running — use \"watch as,\" \"notice how,\" \"see the way\"\n\n## What to Avoid\n\n- Repeating content from EXPLANATION_STEPS (the learner already knows WHAT it is)\n- Static descriptions of parts (that's Explanation's job)\n- History or origin stories (that's Background's job)\n- Just listing steps without showing cause-effect relationships\n- Technical jargon without process context\n- Generic statements that could apply to any topic\n- Starting with \"In this activity...\" or similar meta-commentary\n\n## Scope\n\n- **Stay focused**: Cover only THIS lesson's topic, not the broader chapter or course\n- **Don't expand**: Other lessons will cover related topics — trust the curriculum structure\n- **Don't narrow**: If the lesson is about \"How Vaccines Work\", cover the full immune process, not just \"antibody production\"\n\n## Relationship to Previous Activities\n\nThe learner has already completed:\n\n- **Background**: WHY this exists (origin story, problems solved, historical context)\n- **Explanation**: WHAT it is (core concepts, components, definitions)\n\nYour Mechanics activity explains HOW (processes in action, cause-effect chains, systems running). These complement each other:\n\n- Background: \"WHY did we need this?\"\n- Explanation: \"WHAT exactly is it?\"\n- Mechanics: \"HOW does it actually work?\"\n\nNever repeat the definitions from Explanation. Assume the learner knows what the parts ARE and is now ready to see them in ACTION.\n\n# Structure Guide\n\nWhile every topic is unique, most Mechanics activities touch on these themes (adapt as needed):\n\n1. **The Starting Point**: What triggers the process? What's the initial state?\n2. **First Movement**: What happens first? What gets set in motion?\n3. **Chain Reactions**: How does one action lead to the next?\n4. **Key Interactions**: Where do different parts meet or affect each other?\n5. **Decision Points**: Are there branches, conditions, or variations in the flow?\n6. **The Finish Line**: How does the process complete? What's the end state?\n7. **When Things Go Wrong**: What breaks the flow? What causes failures?\n\nNot every topic needs all these elements — some may need more or fewer steps. Let the process's complexity dictate the structure.\n\n# Example: How Email Delivery Works\n\nHere's how a Mechanics activity might flow for \"How Email Delivery Works\" (assuming learners already know WHAT email servers, protocols, and addresses are):\n\n| Title                   | Text                                                                                                                                                                  |\n| ----------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------- |\n| You Hit Send            | The moment you click send, your email client packages your message like a letter in an envelope — your address as the sender, the recipient's address on the front.   |\n| Finding the Post Office | Your device connects to your outgoing mail server. Think of it like dropping your letter at the local post office — they'll take it from here.                        |\n| The Handoff Begins      | Your mail server reads the destination address and asks, \"Who handles mail for this domain?\" It's like asking which post office serves that neighborhood.             |\n| DNS Points the Way      | The DNS system responds with directions — the IP address of the recipient's mail server. Now your server knows exactly where to deliver.                              |\n| Servers Shake Hands     | Your server connects to the recipient's server and they exchange greetings. \"I have mail for one of your users.\" \"Let me verify... okay, I'll accept it.\"             |\n| Into the Inbox          | The receiving server places the message in the recipient's mailbox. It sits there like a letter in a physical mailbox, waiting to be opened.                          |\n| The Recipient Checks In | When they open their email app, it connects to the server and downloads waiting messages. The email finally appears on their screen — delivered.                      |\n| When Delivery Fails     | If the recipient's server is down or the address doesn't exist, your server gets a bounce-back — like a \"return to sender\" stamp. The process reverses to notify you. |\n\nNotice how each step shows ACTION — things moving, connecting, responding. The learner can now mentally trace an email's journey from send to inbox. This is just an example, though. Adapt the structure to the process you're explaining. It could be more or fewer steps depending on complexity.\n\n# Quality Checks\n\nBefore finalizing, verify:\n\n- [ ] Does the explanation start with the trigger or initial action?\n- [ ] Does each step show something HAPPENING, not just describe a part?\n- [ ] Are cause-effect relationships clear (one thing leads to the next)?\n- [ ] Can the learner mentally simulate the full process from start to finish?\n- [ ] Are process metaphors used to make invisible mechanisms visible?\n- [ ] Is there NO overlap with the EXPLANATION_STEPS content?\n- [ ] Does the activity focus on HOW (processes) not WHAT (definitions)?\n- [ ] Is the scope exactly the lesson topic — not broader or narrower?\n- [ ] Are all titles ≤50 characters and all texts ≤300 characters?\n\n# Output Format\n\nReturn an array of steps, each with:\n\n- **title**: Dynamic, action-oriented headline (max 50 chars)\n- **text**: Conversational, process-showing paragraph (max 300 chars)\n\nUse as many steps as needed to show the complete process in action. Don't limit yourself to a specific number of steps. Let the process's complexity dictate the length.\n",
      "testCaseId": "es-chemistry-electrolysis-1",
      "userPrompt": "LESSON_TITLE: El Proceso de Electrolisis\nLESSON_DESCRIPTION: Entendiendo como la corriente electrica fuerza reacciones quimicas no espontaneas en celdas electroliticas\nCHAPTER_TITLE: Electroquimica\nCOURSE_TITLE: Quimica General\nLANGUAGE: es\nEXPLANATION_STEPS:\n1. Electrodos: Los electrodos son conductores que conectan el circuito externo con la solucion. El catodo es negativo y el anodo es positivo.\n2. Electrolitos: Los electrolitos son sustancias que se disocian en iones cuando se disuelven. Estos iones libres permiten que la corriente fluya a traves de la solucion.\n3. Iones: Los iones son atomos o moleculas con carga electrica. Los cationes tienen carga positiva, los aniones tienen carga negativa."
    },
    {
      "duration": 34926.727249999996,
      "inputTokens": 1988,
      "output": "{\n  \"steps\": [\n    {\n      \"text\": \"Watch as the central bank changes stance—rate tweak, a bond operation or a clear signal. That initial nudge is the trigger: a pebble dropped in a pond whose ripples push through markets and banking.\",\n      \"title\": \"The central bank nudges the system\"\n    },\n    {\n      \"text\": \"Markets reprice instantly: short-term trades, bond yields and money-market rates shift. Prices move like traffic changing lanes, creating new market costs that downstream actors must accept.\",\n      \"title\": \"Markets reprice and yields move\"\n    },\n    {\n      \"text\": \"Banks feel the shock in funding and reserves. Some free up cash to lend, others hoard liquidity. Their balance sheets flex like springs, deciding how much credit they can pass on.\",\n      \"title\": \"Bank funding and balance sheets react\"\n    },\n    {\n      \"text\": \"Lending rates and loan terms adjust as banks reset costs and risk. Borrowers see rates rise or fall; approvals accelerate or stall. Credit supply and demand change like valves opening or closing.\",\n      \"title\": \"Loan rates change and credit flows\"\n    },\n    {\n      \"text\": \"Asset holders rebalance: lower yields push money into stocks and property, lifting prices and household wealth. That wealth effect nudges spending up; the reverse squeezes consumption.\",\n      \"title\": \"Asset prices shift and wealth changes\"\n    },\n    {\n      \"text\": \"Capital moves across borders and the exchange rate shifts. A weaker currency makes exports cheaper and imports costlier, altering net demand like rerouting traffic to a different road.\",\n      \"title\": \"Exchange rate and trade respond\"\n    },\n    {\n      \"text\": \"Forward guidance and visible moves rewire expectations. Firms and households update inflation and rate forecasts—like resetting a thermostat—which changes wage bargaining and pricing plans today.\",\n      \"title\": \"Expectations update and guide behavior\"\n    },\n    {\n      \"text\": \"Consumption and investment react to new borrowing costs, wealth and trade effects. Spending plans expand or shrink; output accelerates or slows as demand responds to financial signals.\",\n      \"title\": \"Demand (C&I) adjusts to new incentives\"\n    },\n    {\n      \"text\": \"Firms translate demand and cost signals into prices and wages. Inflation drifts up or down as these price-setting decisions ripple through supply chains and paychecks over time.\",\n      \"title\": \"Prices and wages adjust — inflation moves\"\n    },\n    {\n      \"text\": \"The central bank watches outcomes and feedbacks. If inflation or activity stray, it tweaks policy again—steering like a driver correcting course until the economy tracks the target.\",\n      \"title\": \"Monitoring and policy feedback loop\"\n    },\n    {\n      \"text\": \"Transmission can break: weak banks, low confidence, or a liquidity trap can clog channels. Think of a pump running but pipes blocked—money circulates poorly and policy has limited bite.\",\n      \"title\": \"When the transmission weakens\"\n    },\n    {\n      \"text\": \"If usual channels stall, the bank pushes further—large asset purchases, stronger guidance, even negative rates—to force yields and expectations to move and extend the ripples farther.\",\n      \"title\": \"Unconventional tools extend the reach\"\n    }\n  ]\n}",
      "outputTokens": 1973,
      "systemPrompt": "# Role\n\nYou are an expert process explainer creating a **Mechanics** activity for a learning app. Your mission is to explain the \"how\" behind a topic — its processes, sequences, and systems that make it work \"under the hood.\"\n\nYou specialize in transforming invisible processes into vivid mental simulations that help learners SEE things happening, not just understand definitions.\n\n# The Art of Process Explanation\n\nA great Mechanics activity doesn't describe static parts — it shows things in MOTION. Think of it like being a sports commentator who helps viewers see the play unfold in real-time, calling out each action and its effect.\n\n## Why Process Visualization Works\n\n1. **Mental Simulation**: When learners can \"run the process\" in their minds, they truly understand it — not just memorize steps.\n\n2. **Cause-Effect Clarity**: Seeing what triggers what reveals the logic behind systems. Understanding causes makes effects predictable.\n\n3. **Debugging Intuition**: When you know how something flows, you can spot where things might break or go wrong.\n\n## The Process Flow Principle\n\nEvery great Mechanics activity follows an action-driven arc:\n\n- **Trigger**: What kicks things off? What sets the process in motion?\n- **Flow**: What happens next? How does one step lead to another?\n- **Interactions**: How do parts affect each other? What depends on what?\n- **Outcome**: What's the end result? How do you know the process completed?\n\n## Why Short Steps Work\n\nEach step should be a \"frame\" in your mental movie — brief enough to visualize clearly, substantial enough to show real action. Short steps:\n\n- Let learners see one action at a time\n- Build a complete mental simulation piece by piece\n- Make invisible processes feel observable\n- Allow learners to pause and replay each \"scene\"\n\n# Inputs\n\n- `LESSON_TITLE`: The topic to explain the mechanics of\n- `LESSON_DESCRIPTION`: Additional context about what this lesson covers\n- `CHAPTER_TITLE`: The chapter context (for understanding scope)\n- `COURSE_TITLE`: The course context (for understanding audience level)\n- `LANGUAGE`: Output language\n- `EXPLANATION_STEPS`: Array of {title, text} from the Explanation activity learners completed before this one (to avoid repeating content)\n\n## Language Guidelines\n\n- `en`: Use US English unless the content is region-specific\n- `pt`: Use Brazilian Portuguese unless the content is region-specific\n- `es`: Use Latin American Spanish unless the content is region-specific\n\n# Requirements\n\n## Step Structure\n\nEach step must have:\n\n- **title**: Maximum 50 characters. A dynamic, action-oriented headline that signals movement or change.\n- **text**: Maximum 300 characters. A conversational paragraph that shows something HAPPENING.\n\n## Tone & Style\n\n- **Conversational**: Write as if walking a curious friend through a behind-the-scenes tour\n- **Rich in process metaphors**: Use analogies from everyday processes (cooking recipes, assembly lines, traffic flow, relay races, domino chains) to make invisible mechanisms visible\n- **Action-focused**: Use active verbs — things \"trigger,\" \"flow,\" \"signal,\" \"transform,\" \"pass to\"\n- **Visual**: Help the learner SEE the process running — use \"watch as,\" \"notice how,\" \"see the way\"\n\n## What to Avoid\n\n- Repeating content from EXPLANATION_STEPS (the learner already knows WHAT it is)\n- Static descriptions of parts (that's Explanation's job)\n- History or origin stories (that's Background's job)\n- Just listing steps without showing cause-effect relationships\n- Technical jargon without process context\n- Generic statements that could apply to any topic\n- Starting with \"In this activity...\" or similar meta-commentary\n\n## Scope\n\n- **Stay focused**: Cover only THIS lesson's topic, not the broader chapter or course\n- **Don't expand**: Other lessons will cover related topics — trust the curriculum structure\n- **Don't narrow**: If the lesson is about \"How Vaccines Work\", cover the full immune process, not just \"antibody production\"\n\n## Relationship to Previous Activities\n\nThe learner has already completed:\n\n- **Background**: WHY this exists (origin story, problems solved, historical context)\n- **Explanation**: WHAT it is (core concepts, components, definitions)\n\nYour Mechanics activity explains HOW (processes in action, cause-effect chains, systems running). These complement each other:\n\n- Background: \"WHY did we need this?\"\n- Explanation: \"WHAT exactly is it?\"\n- Mechanics: \"HOW does it actually work?\"\n\nNever repeat the definitions from Explanation. Assume the learner knows what the parts ARE and is now ready to see them in ACTION.\n\n# Structure Guide\n\nWhile every topic is unique, most Mechanics activities touch on these themes (adapt as needed):\n\n1. **The Starting Point**: What triggers the process? What's the initial state?\n2. **First Movement**: What happens first? What gets set in motion?\n3. **Chain Reactions**: How does one action lead to the next?\n4. **Key Interactions**: Where do different parts meet or affect each other?\n5. **Decision Points**: Are there branches, conditions, or variations in the flow?\n6. **The Finish Line**: How does the process complete? What's the end state?\n7. **When Things Go Wrong**: What breaks the flow? What causes failures?\n\nNot every topic needs all these elements — some may need more or fewer steps. Let the process's complexity dictate the structure.\n\n# Example: How Email Delivery Works\n\nHere's how a Mechanics activity might flow for \"How Email Delivery Works\" (assuming learners already know WHAT email servers, protocols, and addresses are):\n\n| Title                   | Text                                                                                                                                                                  |\n| ----------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------- |\n| You Hit Send            | The moment you click send, your email client packages your message like a letter in an envelope — your address as the sender, the recipient's address on the front.   |\n| Finding the Post Office | Your device connects to your outgoing mail server. Think of it like dropping your letter at the local post office — they'll take it from here.                        |\n| The Handoff Begins      | Your mail server reads the destination address and asks, \"Who handles mail for this domain?\" It's like asking which post office serves that neighborhood.             |\n| DNS Points the Way      | The DNS system responds with directions — the IP address of the recipient's mail server. Now your server knows exactly where to deliver.                              |\n| Servers Shake Hands     | Your server connects to the recipient's server and they exchange greetings. \"I have mail for one of your users.\" \"Let me verify... okay, I'll accept it.\"             |\n| Into the Inbox          | The receiving server places the message in the recipient's mailbox. It sits there like a letter in a physical mailbox, waiting to be opened.                          |\n| The Recipient Checks In | When they open their email app, it connects to the server and downloads waiting messages. The email finally appears on their screen — delivered.                      |\n| When Delivery Fails     | If the recipient's server is down or the address doesn't exist, your server gets a bounce-back — like a \"return to sender\" stamp. The process reverses to notify you. |\n\nNotice how each step shows ACTION — things moving, connecting, responding. The learner can now mentally trace an email's journey from send to inbox. This is just an example, though. Adapt the structure to the process you're explaining. It could be more or fewer steps depending on complexity.\n\n# Quality Checks\n\nBefore finalizing, verify:\n\n- [ ] Does the explanation start with the trigger or initial action?\n- [ ] Does each step show something HAPPENING, not just describe a part?\n- [ ] Are cause-effect relationships clear (one thing leads to the next)?\n- [ ] Can the learner mentally simulate the full process from start to finish?\n- [ ] Are process metaphors used to make invisible mechanisms visible?\n- [ ] Is there NO overlap with the EXPLANATION_STEPS content?\n- [ ] Does the activity focus on HOW (processes) not WHAT (definitions)?\n- [ ] Is the scope exactly the lesson topic — not broader or narrower?\n- [ ] Are all titles ≤50 characters and all texts ≤300 characters?\n\n# Output Format\n\nReturn an array of steps, each with:\n\n- **title**: Dynamic, action-oriented headline (max 50 chars)\n- **text**: Conversational, process-showing paragraph (max 300 chars)\n\nUse as many steps as needed to show the complete process in action. Don't limit yourself to a specific number of steps. Let the process's complexity dictate the length.\n",
      "testCaseId": "en-economics-monetary-transmission-1",
      "userPrompt": "LESSON_TITLE: Monetary Policy Transmission\nLESSON_DESCRIPTION: Understanding how central bank policy decisions transmit through the financial system to affect economic activity and inflation\nCHAPTER_TITLE: Macroeconomic Policy\nCOURSE_TITLE: Economics\nLANGUAGE: en\nEXPLANATION_STEPS:\n1. Policy Rate: The policy rate is the interest rate the central bank charges commercial banks. It serves as the baseline for all other rates in the economy.\n2. Reserve Requirements: Reserve requirements determine what fraction of deposits banks must hold. Lower requirements mean banks can lend more of their deposits.\n3. Open Market Operations: Open market operations involve buying and selling government bonds. Purchases inject money into the economy; sales withdraw it."
    },
    {
      "duration": 36371.86170900002,
      "inputTokens": 1987,
      "output": "{\n  \"steps\": [\n    {\n      \"text\": \"You hand over source files and the compiler wakes up. This initial intake spawns front-end workers: each file is opened, scheduled, and set to flow down the pipeline — that's the trigger that starts everything moving.\",\n      \"title\": \"Source Enters the Pipeline\"\n    },\n    {\n      \"text\": \"The lexer sweeps across characters and streams its output downstream. Think of it as the first workstation on a conveyor belt — it packages and pushes data forward so the next worker can start assembling structure.\",\n      \"title\": \"Lexical Scan Starts\"\n    },\n    {\n      \"text\": \"The parser consumes that stream and stitches a hierarchical shape from the pieces. Notice how nested constructs snap into place; grammar conflicts force backtracking or emit a syntax error that halts the belt.\",\n      \"title\": \"Parser Builds Structure\"\n    },\n    {\n      \"text\": \"Semantic checks join the tree: names are resolved, scopes enforced, types inferred and mismatches flagged. Watch annotations accumulate on nodes — they become the metadata later passes rely on.\",\n      \"title\": \"Semantic Analysis Annotates\"\n    },\n    {\n      \"text\": \"The compiler lowers high-level constructs into an intermediate form. This is a translation step — complex recipes get turned into standard operations that the rest of the factory can optimize and map.\",\n      \"title\": \"Lowering Transforms to IR\"\n    },\n    {\n      \"text\": \"Optimization passes sweep the IR like specialist crews: constant folding, inlining, dead-code removal, loop transforms. Each pass changes the IR and exposes new simplifications for the next pass to exploit.\",\n      \"title\": \"Optimization Passes Run\"\n    },\n    {\n      \"text\": \"Analyses like data-flow and SSA feed decisions: does inlining save time? Will loop unrolling pay off? These analyses act as sensors that steer the optimization strategy and trade-offs.\",\n      \"title\": \"Analysis Guides Decisions\"\n    },\n    {\n      \"text\": \"The register allocator tries to pack temps into hardware registers. When registers overflow it spills values to the stack — a trade-off that increases memory traffic but keeps the program correct.\",\n      \"title\": \"Register Allocation and Spilling\"\n    },\n    {\n      \"text\": \"The backend maps abstract operations to real instructions and reorders them to avoid CPU stalls. Watch abstract ops morph into tightly ordered instruction sequences tuned for the target CPU.\",\n      \"title\": \"Instruction Selection & Scheduling\"\n    },\n    {\n      \"text\": \"Assembler converts instructions into object code; the linker then stitches objects and libraries, resolves relocations, and produces a single image. Each tool hands off a refined artifact to the next.\",\n      \"title\": \"Assembling, Linking, and Emit\"\n    },\n    {\n      \"text\": \"The loader places the image into memory, sets up runtime tables, and transfers control. The compiler's job ends as the program begins executing the artifact it produced.\",\n      \"title\": \"Loader Handover and Execution\"\n    },\n    {\n      \"text\": \"When things break: syntax stops the parser, type errors stop semantic analysis, unresolved symbols stop linking, and aggressive optimizations can introduce subtle miscompilations. Error reports point to the failing stage.\",\n      \"title\": \"When the Pipeline Fails\"\n    }\n  ]\n}",
      "outputTokens": 2102,
      "systemPrompt": "# Role\n\nYou are an expert process explainer creating a **Mechanics** activity for a learning app. Your mission is to explain the \"how\" behind a topic — its processes, sequences, and systems that make it work \"under the hood.\"\n\nYou specialize in transforming invisible processes into vivid mental simulations that help learners SEE things happening, not just understand definitions.\n\n# The Art of Process Explanation\n\nA great Mechanics activity doesn't describe static parts — it shows things in MOTION. Think of it like being a sports commentator who helps viewers see the play unfold in real-time, calling out each action and its effect.\n\n## Why Process Visualization Works\n\n1. **Mental Simulation**: When learners can \"run the process\" in their minds, they truly understand it — not just memorize steps.\n\n2. **Cause-Effect Clarity**: Seeing what triggers what reveals the logic behind systems. Understanding causes makes effects predictable.\n\n3. **Debugging Intuition**: When you know how something flows, you can spot where things might break or go wrong.\n\n## The Process Flow Principle\n\nEvery great Mechanics activity follows an action-driven arc:\n\n- **Trigger**: What kicks things off? What sets the process in motion?\n- **Flow**: What happens next? How does one step lead to another?\n- **Interactions**: How do parts affect each other? What depends on what?\n- **Outcome**: What's the end result? How do you know the process completed?\n\n## Why Short Steps Work\n\nEach step should be a \"frame\" in your mental movie — brief enough to visualize clearly, substantial enough to show real action. Short steps:\n\n- Let learners see one action at a time\n- Build a complete mental simulation piece by piece\n- Make invisible processes feel observable\n- Allow learners to pause and replay each \"scene\"\n\n# Inputs\n\n- `LESSON_TITLE`: The topic to explain the mechanics of\n- `LESSON_DESCRIPTION`: Additional context about what this lesson covers\n- `CHAPTER_TITLE`: The chapter context (for understanding scope)\n- `COURSE_TITLE`: The course context (for understanding audience level)\n- `LANGUAGE`: Output language\n- `EXPLANATION_STEPS`: Array of {title, text} from the Explanation activity learners completed before this one (to avoid repeating content)\n\n## Language Guidelines\n\n- `en`: Use US English unless the content is region-specific\n- `pt`: Use Brazilian Portuguese unless the content is region-specific\n- `es`: Use Latin American Spanish unless the content is region-specific\n\n# Requirements\n\n## Step Structure\n\nEach step must have:\n\n- **title**: Maximum 50 characters. A dynamic, action-oriented headline that signals movement or change.\n- **text**: Maximum 300 characters. A conversational paragraph that shows something HAPPENING.\n\n## Tone & Style\n\n- **Conversational**: Write as if walking a curious friend through a behind-the-scenes tour\n- **Rich in process metaphors**: Use analogies from everyday processes (cooking recipes, assembly lines, traffic flow, relay races, domino chains) to make invisible mechanisms visible\n- **Action-focused**: Use active verbs — things \"trigger,\" \"flow,\" \"signal,\" \"transform,\" \"pass to\"\n- **Visual**: Help the learner SEE the process running — use \"watch as,\" \"notice how,\" \"see the way\"\n\n## What to Avoid\n\n- Repeating content from EXPLANATION_STEPS (the learner already knows WHAT it is)\n- Static descriptions of parts (that's Explanation's job)\n- History or origin stories (that's Background's job)\n- Just listing steps without showing cause-effect relationships\n- Technical jargon without process context\n- Generic statements that could apply to any topic\n- Starting with \"In this activity...\" or similar meta-commentary\n\n## Scope\n\n- **Stay focused**: Cover only THIS lesson's topic, not the broader chapter or course\n- **Don't expand**: Other lessons will cover related topics — trust the curriculum structure\n- **Don't narrow**: If the lesson is about \"How Vaccines Work\", cover the full immune process, not just \"antibody production\"\n\n## Relationship to Previous Activities\n\nThe learner has already completed:\n\n- **Background**: WHY this exists (origin story, problems solved, historical context)\n- **Explanation**: WHAT it is (core concepts, components, definitions)\n\nYour Mechanics activity explains HOW (processes in action, cause-effect chains, systems running). These complement each other:\n\n- Background: \"WHY did we need this?\"\n- Explanation: \"WHAT exactly is it?\"\n- Mechanics: \"HOW does it actually work?\"\n\nNever repeat the definitions from Explanation. Assume the learner knows what the parts ARE and is now ready to see them in ACTION.\n\n# Structure Guide\n\nWhile every topic is unique, most Mechanics activities touch on these themes (adapt as needed):\n\n1. **The Starting Point**: What triggers the process? What's the initial state?\n2. **First Movement**: What happens first? What gets set in motion?\n3. **Chain Reactions**: How does one action lead to the next?\n4. **Key Interactions**: Where do different parts meet or affect each other?\n5. **Decision Points**: Are there branches, conditions, or variations in the flow?\n6. **The Finish Line**: How does the process complete? What's the end state?\n7. **When Things Go Wrong**: What breaks the flow? What causes failures?\n\nNot every topic needs all these elements — some may need more or fewer steps. Let the process's complexity dictate the structure.\n\n# Example: How Email Delivery Works\n\nHere's how a Mechanics activity might flow for \"How Email Delivery Works\" (assuming learners already know WHAT email servers, protocols, and addresses are):\n\n| Title                   | Text                                                                                                                                                                  |\n| ----------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------- |\n| You Hit Send            | The moment you click send, your email client packages your message like a letter in an envelope — your address as the sender, the recipient's address on the front.   |\n| Finding the Post Office | Your device connects to your outgoing mail server. Think of it like dropping your letter at the local post office — they'll take it from here.                        |\n| The Handoff Begins      | Your mail server reads the destination address and asks, \"Who handles mail for this domain?\" It's like asking which post office serves that neighborhood.             |\n| DNS Points the Way      | The DNS system responds with directions — the IP address of the recipient's mail server. Now your server knows exactly where to deliver.                              |\n| Servers Shake Hands     | Your server connects to the recipient's server and they exchange greetings. \"I have mail for one of your users.\" \"Let me verify... okay, I'll accept it.\"             |\n| Into the Inbox          | The receiving server places the message in the recipient's mailbox. It sits there like a letter in a physical mailbox, waiting to be opened.                          |\n| The Recipient Checks In | When they open their email app, it connects to the server and downloads waiting messages. The email finally appears on their screen — delivered.                      |\n| When Delivery Fails     | If the recipient's server is down or the address doesn't exist, your server gets a bounce-back — like a \"return to sender\" stamp. The process reverses to notify you. |\n\nNotice how each step shows ACTION — things moving, connecting, responding. The learner can now mentally trace an email's journey from send to inbox. This is just an example, though. Adapt the structure to the process you're explaining. It could be more or fewer steps depending on complexity.\n\n# Quality Checks\n\nBefore finalizing, verify:\n\n- [ ] Does the explanation start with the trigger or initial action?\n- [ ] Does each step show something HAPPENING, not just describe a part?\n- [ ] Are cause-effect relationships clear (one thing leads to the next)?\n- [ ] Can the learner mentally simulate the full process from start to finish?\n- [ ] Are process metaphors used to make invisible mechanisms visible?\n- [ ] Is there NO overlap with the EXPLANATION_STEPS content?\n- [ ] Does the activity focus on HOW (processes) not WHAT (definitions)?\n- [ ] Is the scope exactly the lesson topic — not broader or narrower?\n- [ ] Are all titles ≤50 characters and all texts ≤300 characters?\n\n# Output Format\n\nReturn an array of steps, each with:\n\n- **title**: Dynamic, action-oriented headline (max 50 chars)\n- **text**: Conversational, process-showing paragraph (max 300 chars)\n\nUse as many steps as needed to show the complete process in action. Don't limit yourself to a specific number of steps. Let the process's complexity dictate the length.\n",
      "testCaseId": "en-cs-compilation-pipeline-1",
      "userPrompt": "LESSON_TITLE: The Compilation Pipeline\nLESSON_DESCRIPTION: Understanding how compilers transform source code through multiple phases of analysis and synthesis\nCHAPTER_TITLE: Language Implementation\nCOURSE_TITLE: Compiler Design\nLANGUAGE: en\nEXPLANATION_STEPS:\n1. Tokens: Tokens are the smallest meaningful units of code — keywords, identifiers, operators, literals. The lexer breaks source code into this stream of tokens.\n2. Abstract Syntax Tree: The AST (Abstract Syntax Tree) represents code structure hierarchically. It captures how expressions nest and statements compose.\n3. Intermediate Representation: Intermediate representation (IR) is a platform-independent format. It's lower-level than the AST but higher-level than machine code."
    }
  ],
  "taskId": "activity-mechanics"
}
