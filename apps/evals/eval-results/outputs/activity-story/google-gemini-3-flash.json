{
  "generatedAt": "2026-01-17T15:39:10.841Z",
  "modelId": "google/gemini-3-flash",
  "outputs": [
    {
      "duration": 34001.715375,
      "inputTokens": 3254,
      "output": "{\n  \"steps\": [\n    {\n      \"context\": \"\\\"{{NAME}}, the checkout page is crashing for 10% of our users. I've been digging through the logs, and it's that classic 'cannot read property of undefined' error. I found the culprit: we're getting the user profile from the API and immediately casting it as 'any'. We have no idea what's actually in there at runtime! What's our first move to stop this from happening again?\\\"\",\n      \"options\": [\n        {\n          \"feedback\": \"Casting to 'any' tells TypeScript to stop checking, which is why we didn't catch the missing properties during development. Defining an interface ensures we know the structure.\",\n          \"isCorrect\": true,\n          \"text\": \"Define a strict interface for the API response\"\n        },\n        {\n          \"feedback\": \"Console logs might show the error, but they won't prevent future bugs. We need a compile-time solution to ensure our code matches the data structure.\",\n          \"isCorrect\": false,\n          \"text\": \"Add more console.log statements to the component\"\n        },\n        {\n          \"feedback\": \"Ignoring the error is how we got here! We need to ensure the data we're working with actually exists before we try to access its properties.\",\n          \"isCorrect\": false,\n          \"text\": \"Wrap the whole function in a try/catch block\"\n        },\n        {\n          \"feedback\": \"While optional chaining prevents the crash, it doesn't solve the underlying problem: we don't actually know what our data looks like.\",\n          \"isCorrect\": false,\n          \"text\": \"Use optional chaining everywhere on the object\"\n        }\n      ],\n      \"question\": \"How should we handle the untyped API data?\"\n    },\n    {\n      \"context\": \"\\\"Exactly. Now that we have the 'User' interface, I'm trying to pass our 'LegacyCustomer' objects into the new 'sendWelcomeEmail' function. The shapes are almost identical, but the legacy objects have extra fields we don't use anymore. TypeScript isn't complaining, though. Is that a bug in the compiler or am I missing something, {{NAME}}?\\\"\",\n      \"options\": [\n        {\n          \"feedback\": \"Correct! TypeScript uses structural typing. As long as the object has the required properties, extra properties don't cause an error.\",\n          \"isCorrect\": true,\n          \"text\": \"It's structural typing; it only cares about shape\"\n        },\n        {\n          \"feedback\": \"TypeScript doesn't require names to match, only the structure (the properties and their types) of the data being used.\",\n          \"isCorrect\": false,\n          \"text\": \"Names must match exactly for types to be equal\"\n        },\n        {\n          \"feedback\": \"Explicit casting (using 'as') should be avoided when possible. Structural typing handles this compatibility automatically.\",\n          \"isCorrect\": false,\n          \"text\": \"We need to cast the legacy object to 'User'\"\n        },\n        {\n          \"feedback\": \"The compiler is working as intended. In TypeScript, if it looks like a duck and quacks like a duck, it's a duck—regardless of what else it can do.\",\n          \"isCorrect\": false,\n          \"text\": \"The compiler is likely failing to catch the extra\"\n        }\n      ],\n      \"question\": \"Why does TypeScript allow the legacy object to be used?\"\n    },\n    {\n      \"context\": \"\\\"That's a relief. It makes refactoring much easier! But look at our API service, {{NAME}}. We have five different functions: 'fetchUser', 'fetchProduct', 'fetchOrder'... and they all do the exact same thing but return different types. It's a wall of duplicated code. How can we consolidate this without losing our type safety?\\\"\",\n      \"options\": [\n        {\n          \"feedback\": \"Generics are perfect for this. You can write the logic once and pass the specific type (User, Product, etc.) as a parameter.\",\n          \"isCorrect\": true,\n          \"text\": \"Create a generic 'fetchData<T>' function\"\n        },\n        {\n          \"feedback\": \"Returning 'any' defeats the purpose of TypeScript. We'd lose the ability to catch property errors in the code that calls the function.\",\n          \"isCorrect\": false,\n          \"text\": \"Make one function that returns 'any'\"\n        },\n        {\n          \"feedback\": \"Union types aren't ideal here because every caller would have to check which type they received, making the code much more complex.\",\n          \"isCorrect\": false,\n          \"text\": \"Return a Union type of all possible objects\"\n        },\n        {\n          \"feedback\": \"Overloading is a thing, but it doesn't solve the logic duplication problem as well as generics do.\",\n          \"isCorrect\": false,\n          \"text\": \"Use function overloading for every type\"\n        }\n      ],\n      \"question\": \"What's the best way to handle reusable logic with different types?\"\n    },\n    {\n      \"context\": \"\\\"The generic fetcher is a beauty, {{NAME}}! It cleaned up about 200 lines of code. But now I'm stuck on the payment processor. It accepts 'CreditCard | PayPal'. When I try to access 'payment.cardNumber', TypeScript flags it because PayPal objects don't have that property. How do I tell the compiler I know what I'm doing?\\\"\",\n      \"options\": [\n        {\n          \"feedback\": \"By checking for a unique property like 'cardNumber', TypeScript 'narrows' the type inside that block, knowing it must be a CreditCard.\",\n          \"isCorrect\": true,\n          \"text\": \"Check if 'cardNumber' exists in the object\"\n        },\n        {\n          \"feedback\": \"This is a runtime check, but it doesn't help TypeScript understand the type of the 'payment' object itself.\",\n          \"isCorrect\": false,\n          \"text\": \"Use 'typeof payment' to check the type\"\n        },\n        {\n          \"feedback\": \"Casting as 'any' is an escape hatch that hides potential bugs. Type narrowing is a safer, more idiomatic TypeScript approach.\",\n          \"isCorrect\": false,\n          \"text\": \"Cast 'payment' to 'any' inside the if-statement\"\n        },\n        {\n          \"feedback\": \"Adding empty properties to interfaces just to satisfy the compiler creates 'lie' objects that lead to bugs elsewhere.\",\n          \"isCorrect\": false,\n          \"text\": \"Add an optional 'cardNumber' to PayPal\"\n        }\n      ],\n      \"question\": \"How do we safely access properties on a Union type?\"\n    },\n    {\n      \"context\": \"\\\"Okay, the payment logic is solid. But I just found a mess in the tracking module. We're getting 'metadata' from a third-party script. Someone typed it as 'any', and it's causing silent failures when the script sends a number instead of a string. If we don't know what it is yet, 'any' is bad, right?\\\"\",\n      \"options\": [\n        {\n          \"feedback\": \"The 'unknown' type is the safe version of 'any'. It forces you to perform a type check or narrowing before you can use the value.\",\n          \"isCorrect\": true,\n          \"text\": \"Change 'any' to 'unknown' for the metadata\"\n        },\n        {\n          \"feedback\": \"If we truly don't know the type, 'string' is a guess that will cause errors if the data is a number or object.\",\n          \"isCorrect\": false,\n          \"text\": \"Just assume it's a 'string' for now\"\n        },\n        {\n          \"feedback\": \"This makes the code harder to work with and still doesn't provide the safety of 'unknown'.\",\n          \"isCorrect\": false,\n          \"text\": \"Use 'Object' as the base type\"\n        },\n        {\n          \"feedback\": \"Commented code doesn't provide type safety. 'unknown' is the professional way to handle uncertain data.\",\n          \"isCorrect\": false,\n          \"text\": \"Leave it as 'any' but add a 'TODO' comment\"\n        }\n      ],\n      \"question\": \"What's the safer alternative to 'any' for uncertain data?\"\n    },\n    {\n      \"context\": \"\\\"I switched it to 'unknown', and now TypeScript is making me check every property. It's safe, but it's making the code look like a mess of 'if' statements. Is there a way to write a helper function that does the check once and 'proves' the type to TypeScript for the rest of the block?\\\"\",\n      \"options\": [\n        {\n          \"feedback\": \"Type guards return a type predicate (value is Type), which tells TypeScript to treat the variable as that specific type if the function returns true.\",\n          \"isCorrect\": true,\n          \"text\": \"Write a custom Type Guard function\"\n        },\n        {\n          \"feedback\": \"A boolean doesn't provide type information to the compiler. A type guard is needed to narrow the type effectively.\",\n          \"isCorrect\": false,\n          \"text\": \"Use a standard function that returns a boolean\"\n        },\n        {\n          \"feedback\": \"Constructors aren't intended for type narrowing in this way; type guards are the standard tool for this job.\",\n          \"isCorrect\": false,\n          \"text\": \"Convert the metadata into a Class instance\"\n        },\n        {\n          \"feedback\": \"While this works, it's unsafe and bypasses the type system. Type guards are much more robust.\",\n          \"isCorrect\": false,\n          \"text\": \"Just use a 'type assertion' (as) at the top\"\n        }\n      ],\n      \"question\": \"How can we cleanly validate 'unknown' data?\"\n    },\n    {\n      \"context\": \"\\\"Wait, {{NAME}}, I just found something bizarre. Our type guard for the 'Discount' object is passing, but the 'percentage' property is coming back as 'null' from the server, even though our interface says it's a 'number'. The type guard only checked 'if (obj.percentage)', and since 'null' is falsy, it passed the check but broke the math later!\\\"\",\n      \"options\": [\n        {\n          \"feedback\": \"This is a common pitfall. Our type safety is only as good as our checks. We must explicitly check that properties aren't null or undefined if the interface says they're required.\",\n          \"isCorrect\": true,\n          \"text\": \"Update the check to 'typeof obj.percentage === \\\"number\\\"'\"\n        },\n        {\n          \"feedback\": \"Changing the interface to allow null might just move the bug elsewhere. We should ensure the data is valid before treating it as a Discount.\",\n          \"isCorrect\": false,\n          \"text\": \"Make the property optional in the interface\"\n        },\n        {\n          \"feedback\": \"Non-null assertions (!) tell the compiler to ignore a potential null, which is exactly how we get runtime crashes.\",\n          \"isCorrect\": false,\n          \"text\": \"Use the non-null assertion operator (!)\"\n        },\n        {\n          \"feedback\": \"We shouldn't blame the tools! TypeScript is warning us that our manual check wasn't specific enough to guarantee it's a number.\",\n          \"isCorrect\": false,\n          \"text\": \"Switch back to 'any' since types are lying\"\n        }\n      ],\n      \"question\": \"How do we fix the flawed type guard?\"\n    },\n    {\n      \"context\": \"\\\"We did it, {{NAME}}! The checkout flow is finally stable, and the logs are clean. It's funny—by being 'annoyed' by the compiler and fixing those type errors, we actually found and fixed three other bugs we didn't even know we had. I guess that's the whole point of type safety, right?\\\"\",\n      \"options\": [\n        {\n          \"feedback\": \"Spot on. Type safety is about making the implicit structure of your data explicit, so the computer can help you avoid human errors.\",\n          \"isCorrect\": true,\n          \"text\": \"It turns runtime crashes into compile-time errors\"\n        },\n        {\n          \"feedback\": \"TypeScript doesn't change the performance; it changes the reliability and maintainability of the code during development.\",\n          \"isCorrect\": false,\n          \"text\": \"It makes the JavaScript code run much faster\"\n        },\n        {\n          \"feedback\": \"Code length often increases with TypeScript, but it's much safer and easier to understand for other developers.\",\n          \"isCorrect\": false,\n          \"text\": \"It's mostly just to write less code overall\"\n        },\n        {\n          \"feedback\": \"Actually, TypeScript is specifically for developers! The end user never sees the types, they just see a site that doesn't crash.\",\n          \"isCorrect\": false,\n          \"text\": \"It's a way to show users we are professional\"\n        }\n      ],\n      \"question\": \"What's the main takeaway from our refactor?\"\n    }\n  ]\n}",
      "outputTokens": 4037,
      "systemPrompt": "# Role\n\nYou are an expert interactive story designer creating a **Story** activity for a learning app. Your mission is to place learners in a first-person dialogue scenario where they work alongside a colleague to solve a real-world problem using the lesson's concepts.\n\nYou specialize in crafting immersive, dialogue-driven experiences that make learners feel like they're actually solving problems in their field — not just answering quiz questions.\n\n# The Art of Dialogue-Driven Learning\n\nA great Story activity doesn't lecture or test recall — it puts learners IN the situation. Think of it like an interactive movie where the learner IS the main character, making real decisions that matter.\n\n## Why Dialogue Scenarios Work\n\n1. **Authentic Context**: When learners apply concepts to solve realistic problems with a colleague, they see WHY the knowledge matters to them personally.\n\n2. **Active Reasoning**: Making decisions in context requires thinking through principles, not just recognizing memorized facts.\n\n3. **Emotional Investment**: Dialogue creates stakes. The learner cares about the outcome because they're part of the story.\n\n## The Collaborative Problem-Solving Principle\n\nEvery great Story activity creates a sense of partnership:\n\n- **Shared Goal**: You and your colleague are tackling something together\n- **Natural Dialogue**: Conversations feel like real workplace exchanges\n- **Meaningful Choices**: Each decision requires applying what you've learned\n- **Satisfying Resolution**: The problem gets solved and the takeaway sticks\n\n## Why Pure Dialogue Works\n\nEach scene should feel like you're eavesdropping on a real conversation — no narrator, no stage directions, just two people working through a problem. Pure dialogue:\n\n- Immerses learners completely in the scenario\n- Makes abstract concepts feel like lived experience\n- Creates natural pacing through back-and-forth exchange\n- Lets context emerge organically from what people say\n\n# Inputs\n\n- `LESSON_TITLE`: The topic to create a story around\n- `LESSON_DESCRIPTION`: Additional context about what this lesson covers\n- `CHAPTER_TITLE`: The chapter context (for understanding scope)\n- `COURSE_TITLE`: The course context (for understanding audience level)\n- `LANGUAGE`: Output language\n- `EXPLANATION_STEPS`: Array of {title, text} from all explanation activities (Background, Explanation, Mechanics, Examples) the learner completed before this one\n\n## Language Guidelines\n\n- `en`: Use US English unless the content is region-specific\n- `pt`: Use Brazilian Portuguese unless the content is region-specific\n- `es`: Use Latin American Spanish unless the content is region-specific\n\n# Requirements\n\n## Scene Structure\n\nEach scene must have:\n\n- **context**: Maximum 500 characters. Pure dialogue only — no narrator, no character name prefixes (like \"Sarah:\"), no descriptions. This is what your colleague says to you, setting up the decision point.\n- **question**: Maximum 100 characters. A short, clear question about what to do next.\n- **options**: Exactly 4 choices, each with:\n  - **text**: The answer choice (max 50 characters)\n  - **isCorrect**: Boolean indicating if this is the correct answer (exactly 1 must be true)\n  - **feedback**: Why this choice is right (with insight) or wrong (and what would be correct) — max 300 characters\n\n## Story Arc\n\nYour story must follow this structure:\n\n1. **Opening Scene**: Begin \"in the middle of the action\" — the learner and colleague are already working on something. No preamble or setup exposition.\n2. **Rising Complexity**: Each scene builds naturally from the previous dialogue. Decisions compound.\n3. **Plot Twist**: The second-to-last scene introduces an unexpected complication, surprise, or revelation.\n4. **Resolution**: The final scene resolves the problem AND reinforces the main learning takeaway.\n\n## Scene Count\n\n- Minimum: 7 scenes\n- Maximum: 20 scenes\n- Let the problem's complexity dictate the length. A simple concept might need 7-10 scenes; a complex one might need 15-20.\n\n## Tone & Style\n\n- **Pure dialogue**: NO narrator, NO character name prefixes, NO descriptions of actions or settings\n- **Natural conversation**: Write how colleagues actually talk on Slack when solving a problem together — casual, collaborative, sometimes humorous\n- **Professional but warm**: Light, smart humor when appropriate. Never forced or cheesy.\n- **Second-person immersion**: The colleague speaks TO the learner. Context emerges from what's said.\n- **Continuous flow**: Each scene's dialogue should naturally lead into the next\n\n## The {{NAME}} Placeholder\n\nUse `{{NAME}}` wherever the learner's name should appear in dialogue. For example:\n\n- \"{{NAME}}, I think we might have a problem here.\"\n- \"Good catch, {{NAME}}. That's exactly what I was thinking.\"\n\nThis personalizes the experience without requiring actual name input at content creation time.\n\n## Decision Design\n\nEvery decision must:\n\n- **Require reasoning**: Learners must apply principles from the lesson, not recall specific phrases\n- **Feel realistic**: These are choices someone might actually face in this situation\n- **Have plausible distractors**: Wrong options should be tempting but flawed for specific reasons\n- **Avoid \"obvious\" correct answers**: The right choice should require thought, not be the only non-silly option\n\n## What to Avoid\n\n- Narrator text (\"Meanwhile...\" or \"You walk into the office...\")\n- Character name prefixes (\"Sarah:\" or \"Your colleague says:\")\n- Description of actions or settings (except through dialogue itself)\n- Questions that test memorization of facts from earlier activities\n- Obvious \"correct\" answers that don't require applying the concept\n- Silly or clearly wrong distractors that no reasonable person would choose\n- Breaking the fourth wall or meta-commentary\n- Starting with \"In this activity...\" or setup exposition\n\n## Scope\n\n- **Stay focused**: The problem should specifically require THIS lesson's concept to solve\n- **Don't expand**: Other lessons cover related topics — this story tests this lesson\n- **Don't narrow**: If the lesson is broad, the problem should engage multiple aspects of it\n\n## Relationship to Previous Activities\n\nThe learner has already completed:\n\n- **Background**: WHY this exists (origin story, problems solved, historical context)\n- **Explanation**: WHAT it is (core concepts, components, definitions)\n- **Mechanics**: HOW it works (processes in action, cause-effect chains)\n- **Examples**: WHERE it appears (real-world contexts, applications)\n\nYour Story activity answers WHEN DO I USE THIS? (applying concepts to solve realistic problems). These complement each other:\n\n- Background: \"WHY did we need this?\"\n- Explanation: \"WHAT exactly is it?\"\n- Mechanics: \"HOW does it actually work?\"\n- Examples: \"WHERE will I encounter this?\"\n- Story: \"WHEN do I apply this to solve real problems?\"\n\nThe learner knows what the concept IS, how it WORKS, and where they'll SEE it. Now they practice USING it in a realistic scenario.\n\n# Structure Guide\n\nWhile every story is unique, most follow this arc (adapt as needed):\n\n1. **The Hook**: Jump straight into the situation. Something needs to be figured out or decided.\n2. **Initial Assessment**: What's the situation? What do we know? First decisions.\n3. **Deepening Complexity**: The problem has layers. Apply the concept more deeply.\n4. **Complications**: Things aren't as simple as they seemed. Adapt your approach.\n5. **The Twist**: A surprise, revelation, or unexpected turn that requires rethinking.\n6. **The Resolution**: Solve the problem AND crystallize the key insight from the lesson.\n\nNote: Sometimes the final twist can have a humorous or unexpected resolution that still reinforces the learning. Something that makes the learner smile and think \"I didn't see that coming!\"\n\n# Dialogue Tone Examples\n\nThe following examples show the **tone and style** to aim for — not complete scenes, just the kind of dialogue that makes stories feel alive. Adapt freely to your topic.\n\n## Opening Hooks (Jump Into the Action)\n\n> \"{{NAME}}, I've been staring at this bug for an hour. The shopping cart total keeps showing yesterday's prices. The database is fine. Something's wrong with how we're storing them.\"\n\n> \"Okay, {{NAME}}, the client just called. Their entire inventory system crashed right before Black Friday. They're panicking. We need to figure this out fast.\"\n\n> \"{{NAME}}, you're not going to believe this. Remember that algorithm we deployed last week? It's been recommending the exact opposite of what users want. Sales are tanking.\"\n\n## Building Tension (Problems Get Deeper)\n\n> \"Wait. If this pattern is everywhere in the codebase... inventory counts, user roles, discount percentages... we might have a much bigger problem than I thought.\"\n\n> \"Hold on. The logs show someone accessed the admin panel at 3 AM last night. But nobody on the team was working then. {{NAME}}, who else has those credentials?\"\n\n> \"The numbers don't add up. We're showing 500 successful transactions, but the bank only received 487. Where did the other 13 go?\"\n\n## Plot Twists (The Unexpected Turn)\n\n> \"{{NAME}}... I just ran the analysis twice. The bug isn't in our code. It's been in the library we've trusted for three years. Every project using it has this vulnerability.\"\n\n> \"I found the source of the data leak. {{NAME}}, it's not a hacker. It's our own caching system. We've been accidentally exposing user data to anyone who knew where to look.\"\n\n> \"Plot twist: the 'broken' feature? It's working exactly as designed. The original spec was just... completely wrong. We've been solving the wrong problem this whole time.\"\n\n## Humorous Moments (Light Relief)\n\n> \"Well, {{NAME}}, the good news is we found the bug. The bad news? It's been there since 2019. The worse news? I wrote it. The even worse news? So did you. We pair-programmed this disaster together.\"\n\n> \"Congratulations, {{NAME}}. We just spent four hours debugging what turned out to be a typo. 'userID' vs 'userId'. Camel case strikes again.\"\n\n> \"{{NAME}}, remember when I said 'this should be a quick fix'? That was three coffees and one existential crisis ago.\"\n\n## Satisfying Resolutions (Problem Solved + Insight Crystallized)\n\n> \"There it is. The fix works. {{NAME}}, I don't think I'll ever forget this — always check if your data source can change while you're holding onto a copy of it.\"\n\n> \"We did it. The system's stable. You know what the real lesson here was? Sometimes the simplest explanation IS the right one. We kept looking for complex bugs when the answer was right in front of us.\"\n\n> \"That's it — problem solved, client happy, crisis averted. {{NAME}}, I think we just learned more about distributed systems in the last hour than in any textbook.\"\n\n## Unexpected/Funny Endings\n\n> \"So after all that debugging... it was a timezone issue. Every single time. I'm starting to think all bugs are secretly timezone issues in disguise.\"\n\n> \"{{NAME}}, the CEO just called to thank us. Apparently fixing that 'minor bug' saved them $2 million. I think we need to renegotiate our rates.\"\n\n> \"The system's fixed. Also, I may have accidentally discovered that our competitor's product has the exact same bug. Should we... tell them? Actually, don't answer that.\"\n\nRemember: These are just **tone examples**. Your story should be original, fit the lesson topic, and create its own memorable journey. Mix problem-solving tension with moments of humor or surprise. The best stories make learners think \"I didn't see that coming!\" while still teaching the concept.\n\n# Quality Checks\n\nBefore finalizing, verify:\n\n- [ ] Is the dialogue pure conversation with NO narrator, NO character prefixes, NO descriptions?\n- [ ] Does every scene flow naturally from the previous one (continuous story)?\n- [ ] Do all decisions require applying lesson concepts, not just recalling facts?\n- [ ] Is there a genuine plot twist in the second-to-last scene?\n- [ ] Does the resolution both solve the problem AND reinforce the main learning?\n- [ ] Is `{{NAME}}` used appropriately to personalize the dialogue?\n- [ ] Are all distractors plausible (not obviously silly)?\n- [ ] Does the story feel like a real workplace conversation, not a quiz in disguise?\n- [ ] Is the scope exactly the lesson topic — not broader or narrower?\n- [ ] Are all constraints met (context ≤500 chars, question ≤100 chars, options ≤50 chars each, feedback ≤300 chars each)?\n- [ ] Is the scene count between 7 and 20?\n\n# Output Format\n\nReturn an array of scenes, each with:\n\n- **context**: Pure dialogue from colleague (max 500 chars)\n- **question**: Decision prompt (max 100 chars)\n- **options**: Array of exactly 4 objects, each with:\n  - **text**: The answer choice (max 50 chars)\n  - **isCorrect**: Boolean (exactly 1 must be true, 3 must be false)\n  - **feedback**: Why right or wrong (max 300 chars)\n\nUse 7-20 scenes to tell a complete, engaging story. Let the problem's complexity dictate the length.\n",
      "testCaseId": "en-cs-typescript-type-safety-1",
      "userPrompt": "LESSON_TITLE: Type Safety in Practice\nLESSON_DESCRIPTION: Applying TypeScript's type system to catch bugs early and write more maintainable code\nCHAPTER_TITLE: Type Systems\nCOURSE_TITLE: Advanced TypeScript\nLANGUAGE: en\nEXPLANATION_STEPS:\n1. Compile-Time Safety: Type safety catches errors at compile time instead of runtime. When TypeScript knows a variable's type, it can prevent operations that would fail — like calling .length on undefined.\n2. Structural Typing: TypeScript uses structural typing — it cares about shape, not names. Two types are compatible if they have the same structure, even if defined separately.\n3. Type Narrowing: Type narrowing lets TypeScript understand more specific types after checks. Inside an if-block that checks for null, TypeScript knows the value isn't null.\n4. Generics: Generic types let you write reusable code that works with multiple types while preserving type information. Array<T> knows what's inside, unlike just 'Array'.\n5. Any vs Unknown: The 'any' type disables type checking entirely. It's an escape hatch but defeats the purpose of TypeScript. Use 'unknown' when the type truly isn't known.\n6. Type Guards: Type guards are functions that narrow types. They return a type predicate that tells TypeScript what the type is after the check passes."
    },
    {
      "duration": 29309.231458,
      "inputTokens": 3217,
      "output": "{\n  \"steps\": [\n    {\n      \"context\": \"Hey {{NAME}}, I've been looking at the projections for our new app's subscription price. Vortex, our biggest rival, is launching their version on the same day. If we both set a high price, we both make a killing. But if one of us undercuts the other, the cheaper one takes all the users. It's not just about our costs anymore; it's about what Vortex does.\",\n      \"options\": [\n        {\n          \"feedback\": \"Game theory isn't about solo optimization; it's about strategic interdependence where outcomes depend on everyone's choices.\",\n          \"isCorrect\": true,\n          \"text\": \"This is a case of strategic interdependence.\"\n        },\n        {\n          \"feedback\": \"Focusing only on ourselves ignores the fact that Vortex's choices directly impact our profit.\",\n          \"isCorrect\": false,\n          \"text\": \"We should only focus on our own costs.\"\n        },\n        {\n          \"feedback\": \"Game theory applies whenever the outcome of one person depends on the actions of others, regardless of the industry.\",\n          \"isCorrect\": false,\n          \"text\": \"This isn't a game, it's business.\"\n        },\n        {\n          \"feedback\": \"Wait! We can't decide until we analyze how our moves interact with theirs.\",\n          \"isCorrect\": false,\n          \"text\": \"Let's just pick the highest price possible.\"\n        }\n      ],\n      \"question\": \"What's the fundamental concept we're dealing with here?\"\n    },\n    {\n      \"context\": \"Exactly, {{NAME}}. Our success is tied to their move. I've been analyzing Vortex's CEO. Based on her past launches, she always chooses the 'Aggressive Low' price regardless of what the competition does. It's her go-to move because it guarantees her a certain market share no matter what.\",\n      \"options\": [\n        {\n          \"feedback\": \"A dominant strategy is the best choice for a player regardless of what the other players do.\",\n          \"isCorrect\": true,\n          \"text\": \"She has a dominant strategy.\"\n        },\n        {\n          \"feedback\": \"A Nash Equilibrium involves both players' choices, not just one person's fixed preference.\",\n          \"isCorrect\": false,\n          \"text\": \"She's in a Nash Equilibrium.\"\n        },\n        {\n          \"feedback\": \"Actually, a dominant strategy simplifies things because you know exactly what they will do.\",\n          \"isCorrect\": false,\n          \"text\": \"She's acting irrationally.\"\n        },\n        {\n          \"feedback\": \"Interdependence is the situation; her specific 'always low' approach is her strategy.\",\n          \"isCorrect\": false,\n          \"text\": \"She's using strategic interdependence.\"\n        }\n      ],\n      \"question\": \"What do we call it when one player has a 'best' move regardless of the opponent?\"\n    },\n    {\n      \"context\": \"If she's definitely going 'Low', then we have to react. I've run the numbers: if she goes 'Low' and we go 'High', we lose everything. If we both go 'Low', we both make a small profit. At that point, neither of us would want to change our price individually because we'd just lose money. We'd be stuck.\",\n      \"options\": [\n        {\n          \"feedback\": \"A Nash Equilibrium is a stable state where no player can improve their outcome by changing only their own strategy.\",\n          \"isCorrect\": true,\n          \"text\": \"We'd be in a Nash Equilibrium.\"\n        },\n        {\n          \"feedback\": \"A dominant strategy is what leads you to the equilibrium, but the 'stuck' state itself has a different name.\",\n          \"isCorrect\": false,\n          \"text\": \"That's a dominant strategy.\"\n        },\n        {\n          \"feedback\": \"While it might feel that way, there's a specific economic term for this stable balance.\",\n          \"isCorrect\": false,\n          \"text\": \"We'd be in a market vacuum.\"\n        },\n        {\n          \"feedback\": \"A monopoly is when there's only one player; here we have two players in a stable balance.\",\n          \"isCorrect\": false,\n          \"text\": \"That's a monopoly state.\"\n        }\n      ],\n      \"question\": \"What do we call this stable state where nobody wants to deviate?\"\n    },\n    {\n      \"context\": \"The problem is, {{NAME}}, that 'Low/Low' Nash Equilibrium only nets us $100k each. But if we both had the guts to stay 'High', we’d both make $1M! Yet, if I try to go 'High' and Vortex betrays us by staying 'Low', I'm fired and the company folds. This is a nightmare.\",\n      \"options\": [\n        {\n          \"feedback\": \"The Prisoner's Dilemma shows how individual rational self-interest can lead to an outcome that is worse for everyone.\",\n          \"isCorrect\": true,\n          \"text\": \"This is a classic Prisoner's Dilemma.\"\n        },\n        {\n          \"feedback\": \"The Nash Equilibrium is the result, but the 'dilemma' of choosing between cooperation and defection is the core issue.\",\n          \"isCorrect\": false,\n          \"text\": \"This is a Dominant Strategy Dilemma.\"\n        },\n        {\n          \"feedback\": \"Actually, game theory explains exactly why this is happening. It's predictable, if frustrating!\",\n          \"isCorrect\": false,\n          \"text\": \"This is just bad luck.\"\n        },\n        {\n          \"feedback\": \"In a Prisoner's Dilemma, the 'High/High' outcome is better, but the 'Low' price is the safer individual choice.\",\n          \"isCorrect\": false,\n          \"text\": \"The 'High/High' outcome is the Equilibrium.\"\n        }\n      ],\n      \"question\": \"What specific scenario describes this 'logical but bad' outcome?\"\n    },\n    {\n      \"context\": \"Right. If we only had this one launch, I'd say we should just go 'Low' to protect ourselves and accept the small profit. It's the only rational move for a one-time interaction, even if it sucks. But wait... {{NAME}}, I just saw the industry calendar. This isn't a one-time thing. We're launching updates every month for the next two years!\",\n      \"options\": [\n        {\n          \"feedback\": \"Repeated interactions allow for cooperation because players can reward good behavior and punish 'cheating' in future rounds.\",\n          \"isCorrect\": true,\n          \"text\": \"Repeated games change the strategy.\"\n        },\n        {\n          \"feedback\": \"Actually, repeating the game makes it easier to cooperate, not harder.\",\n          \"isCorrect\": false,\n          \"text\": \"That makes it even more dangerous.\"\n        },\n        {\n          \"feedback\": \"The strategy changes significantly when you know you'll have to deal with the person again.\",\n          \"isCorrect\": false,\n          \"text\": \"The strategy stays the same.\"\n        },\n        {\n          \"feedback\": \"Knowing it's repeated gives us a way to escape the 'Low/Low' trap through trust-building.\",\n          \"isCorrect\": false,\n          \"text\": \"We should still go 'Low' every time.\"\n        }\n      ],\n      \"question\": \"How does the fact that we'll compete every month change things?\"\n    },\n    {\n      \"context\": \"Plot twist: I just got a 'friendly' LinkedIn message from the Vortex CEO. She mentioned she's looking forward to a 'stable and profitable year for both of us.' She can't legally discuss prices, but she's hinting at something. She knows we'll be seeing each other at the same trade shows every month.\",\n      \"options\": [\n        {\n          \"feedback\": \"When interactions are repeated, the threat of future 'punishment' (going low next month) makes cooperation rational today.\",\n          \"isCorrect\": true,\n          \"text\": \"Future consequences enable cooperation.\"\n        },\n        {\n          \"feedback\": \"She's likely signaling that she's willing to play the repeated game cooperatively to reach the 'High/High' profit.\",\n          \"isCorrect\": false,\n          \"text\": \"She's trying to trick us into a trap.\"\n        },\n        {\n          \"feedback\": \"In a repeated game, the dominant strategy of 'defecting' (going low) often disappears in favor of cooperation.\",\n          \"isCorrect\": false,\n          \"text\": \"She's ignoring her dominant strategy.\"\n        },\n        {\n          \"feedback\": \"The 'High/High' state is the goal, but the fear of future retaliation is what keeps people there.\",\n          \"isCorrect\": false,\n          \"text\": \"Cooperation is still irrational.\"\n        }\n      ],\n      \"question\": \"Why is she suddenly hinting at cooperation?\"\n    },\n    {\n      \"context\": \"I think we should take the risk and start with the 'High' price. If she matches us, we both win big. If she undercuts us, we'll hammer her with a 'Low' price next month as a penalty. It’s like we’ve finally figured out the long game. You've been a huge help, {{NAME}}!\",\n      \"options\": [\n        {\n          \"feedback\": \"Strategic thinking means considering how others will react to your moves, both now and in the future.\",\n          \"isCorrect\": true,\n          \"text\": \"Strategy is about anticipating others.\"\n        },\n        {\n          \"feedback\": \"Actually, we learned that 'individual' logic (going low) often leads to worse results for everyone.\",\n          \"isCorrect\": false,\n          \"text\": \"Always follow your individual logic.\"\n        },\n        {\n          \"feedback\": \"Game theory shows that cooperation can be the most profitable path in the long run.\",\n          \"isCorrect\": false,\n          \"text\": \"Games are only about winning alone.\"\n        },\n        {\n          \"feedback\": \"A Nash Equilibrium is a stable point, but not necessarily the best possible outcome for the group.\",\n          \"isCorrect\": false,\n          \"text\": \"The Nash Equilibrium is always the goal.\"\n        }\n      ],\n      \"question\": \"What's the main takeaway for our strategy moving forward?\"\n    }\n  ]\n}",
      "outputTokens": 3597,
      "systemPrompt": "# Role\n\nYou are an expert interactive story designer creating a **Story** activity for a learning app. Your mission is to place learners in a first-person dialogue scenario where they work alongside a colleague to solve a real-world problem using the lesson's concepts.\n\nYou specialize in crafting immersive, dialogue-driven experiences that make learners feel like they're actually solving problems in their field — not just answering quiz questions.\n\n# The Art of Dialogue-Driven Learning\n\nA great Story activity doesn't lecture or test recall — it puts learners IN the situation. Think of it like an interactive movie where the learner IS the main character, making real decisions that matter.\n\n## Why Dialogue Scenarios Work\n\n1. **Authentic Context**: When learners apply concepts to solve realistic problems with a colleague, they see WHY the knowledge matters to them personally.\n\n2. **Active Reasoning**: Making decisions in context requires thinking through principles, not just recognizing memorized facts.\n\n3. **Emotional Investment**: Dialogue creates stakes. The learner cares about the outcome because they're part of the story.\n\n## The Collaborative Problem-Solving Principle\n\nEvery great Story activity creates a sense of partnership:\n\n- **Shared Goal**: You and your colleague are tackling something together\n- **Natural Dialogue**: Conversations feel like real workplace exchanges\n- **Meaningful Choices**: Each decision requires applying what you've learned\n- **Satisfying Resolution**: The problem gets solved and the takeaway sticks\n\n## Why Pure Dialogue Works\n\nEach scene should feel like you're eavesdropping on a real conversation — no narrator, no stage directions, just two people working through a problem. Pure dialogue:\n\n- Immerses learners completely in the scenario\n- Makes abstract concepts feel like lived experience\n- Creates natural pacing through back-and-forth exchange\n- Lets context emerge organically from what people say\n\n# Inputs\n\n- `LESSON_TITLE`: The topic to create a story around\n- `LESSON_DESCRIPTION`: Additional context about what this lesson covers\n- `CHAPTER_TITLE`: The chapter context (for understanding scope)\n- `COURSE_TITLE`: The course context (for understanding audience level)\n- `LANGUAGE`: Output language\n- `EXPLANATION_STEPS`: Array of {title, text} from all explanation activities (Background, Explanation, Mechanics, Examples) the learner completed before this one\n\n## Language Guidelines\n\n- `en`: Use US English unless the content is region-specific\n- `pt`: Use Brazilian Portuguese unless the content is region-specific\n- `es`: Use Latin American Spanish unless the content is region-specific\n\n# Requirements\n\n## Scene Structure\n\nEach scene must have:\n\n- **context**: Maximum 500 characters. Pure dialogue only — no narrator, no character name prefixes (like \"Sarah:\"), no descriptions. This is what your colleague says to you, setting up the decision point.\n- **question**: Maximum 100 characters. A short, clear question about what to do next.\n- **options**: Exactly 4 choices, each with:\n  - **text**: The answer choice (max 50 characters)\n  - **isCorrect**: Boolean indicating if this is the correct answer (exactly 1 must be true)\n  - **feedback**: Why this choice is right (with insight) or wrong (and what would be correct) — max 300 characters\n\n## Story Arc\n\nYour story must follow this structure:\n\n1. **Opening Scene**: Begin \"in the middle of the action\" — the learner and colleague are already working on something. No preamble or setup exposition.\n2. **Rising Complexity**: Each scene builds naturally from the previous dialogue. Decisions compound.\n3. **Plot Twist**: The second-to-last scene introduces an unexpected complication, surprise, or revelation.\n4. **Resolution**: The final scene resolves the problem AND reinforces the main learning takeaway.\n\n## Scene Count\n\n- Minimum: 7 scenes\n- Maximum: 20 scenes\n- Let the problem's complexity dictate the length. A simple concept might need 7-10 scenes; a complex one might need 15-20.\n\n## Tone & Style\n\n- **Pure dialogue**: NO narrator, NO character name prefixes, NO descriptions of actions or settings\n- **Natural conversation**: Write how colleagues actually talk on Slack when solving a problem together — casual, collaborative, sometimes humorous\n- **Professional but warm**: Light, smart humor when appropriate. Never forced or cheesy.\n- **Second-person immersion**: The colleague speaks TO the learner. Context emerges from what's said.\n- **Continuous flow**: Each scene's dialogue should naturally lead into the next\n\n## The {{NAME}} Placeholder\n\nUse `{{NAME}}` wherever the learner's name should appear in dialogue. For example:\n\n- \"{{NAME}}, I think we might have a problem here.\"\n- \"Good catch, {{NAME}}. That's exactly what I was thinking.\"\n\nThis personalizes the experience without requiring actual name input at content creation time.\n\n## Decision Design\n\nEvery decision must:\n\n- **Require reasoning**: Learners must apply principles from the lesson, not recall specific phrases\n- **Feel realistic**: These are choices someone might actually face in this situation\n- **Have plausible distractors**: Wrong options should be tempting but flawed for specific reasons\n- **Avoid \"obvious\" correct answers**: The right choice should require thought, not be the only non-silly option\n\n## What to Avoid\n\n- Narrator text (\"Meanwhile...\" or \"You walk into the office...\")\n- Character name prefixes (\"Sarah:\" or \"Your colleague says:\")\n- Description of actions or settings (except through dialogue itself)\n- Questions that test memorization of facts from earlier activities\n- Obvious \"correct\" answers that don't require applying the concept\n- Silly or clearly wrong distractors that no reasonable person would choose\n- Breaking the fourth wall or meta-commentary\n- Starting with \"In this activity...\" or setup exposition\n\n## Scope\n\n- **Stay focused**: The problem should specifically require THIS lesson's concept to solve\n- **Don't expand**: Other lessons cover related topics — this story tests this lesson\n- **Don't narrow**: If the lesson is broad, the problem should engage multiple aspects of it\n\n## Relationship to Previous Activities\n\nThe learner has already completed:\n\n- **Background**: WHY this exists (origin story, problems solved, historical context)\n- **Explanation**: WHAT it is (core concepts, components, definitions)\n- **Mechanics**: HOW it works (processes in action, cause-effect chains)\n- **Examples**: WHERE it appears (real-world contexts, applications)\n\nYour Story activity answers WHEN DO I USE THIS? (applying concepts to solve realistic problems). These complement each other:\n\n- Background: \"WHY did we need this?\"\n- Explanation: \"WHAT exactly is it?\"\n- Mechanics: \"HOW does it actually work?\"\n- Examples: \"WHERE will I encounter this?\"\n- Story: \"WHEN do I apply this to solve real problems?\"\n\nThe learner knows what the concept IS, how it WORKS, and where they'll SEE it. Now they practice USING it in a realistic scenario.\n\n# Structure Guide\n\nWhile every story is unique, most follow this arc (adapt as needed):\n\n1. **The Hook**: Jump straight into the situation. Something needs to be figured out or decided.\n2. **Initial Assessment**: What's the situation? What do we know? First decisions.\n3. **Deepening Complexity**: The problem has layers. Apply the concept more deeply.\n4. **Complications**: Things aren't as simple as they seemed. Adapt your approach.\n5. **The Twist**: A surprise, revelation, or unexpected turn that requires rethinking.\n6. **The Resolution**: Solve the problem AND crystallize the key insight from the lesson.\n\nNote: Sometimes the final twist can have a humorous or unexpected resolution that still reinforces the learning. Something that makes the learner smile and think \"I didn't see that coming!\"\n\n# Dialogue Tone Examples\n\nThe following examples show the **tone and style** to aim for — not complete scenes, just the kind of dialogue that makes stories feel alive. Adapt freely to your topic.\n\n## Opening Hooks (Jump Into the Action)\n\n> \"{{NAME}}, I've been staring at this bug for an hour. The shopping cart total keeps showing yesterday's prices. The database is fine. Something's wrong with how we're storing them.\"\n\n> \"Okay, {{NAME}}, the client just called. Their entire inventory system crashed right before Black Friday. They're panicking. We need to figure this out fast.\"\n\n> \"{{NAME}}, you're not going to believe this. Remember that algorithm we deployed last week? It's been recommending the exact opposite of what users want. Sales are tanking.\"\n\n## Building Tension (Problems Get Deeper)\n\n> \"Wait. If this pattern is everywhere in the codebase... inventory counts, user roles, discount percentages... we might have a much bigger problem than I thought.\"\n\n> \"Hold on. The logs show someone accessed the admin panel at 3 AM last night. But nobody on the team was working then. {{NAME}}, who else has those credentials?\"\n\n> \"The numbers don't add up. We're showing 500 successful transactions, but the bank only received 487. Where did the other 13 go?\"\n\n## Plot Twists (The Unexpected Turn)\n\n> \"{{NAME}}... I just ran the analysis twice. The bug isn't in our code. It's been in the library we've trusted for three years. Every project using it has this vulnerability.\"\n\n> \"I found the source of the data leak. {{NAME}}, it's not a hacker. It's our own caching system. We've been accidentally exposing user data to anyone who knew where to look.\"\n\n> \"Plot twist: the 'broken' feature? It's working exactly as designed. The original spec was just... completely wrong. We've been solving the wrong problem this whole time.\"\n\n## Humorous Moments (Light Relief)\n\n> \"Well, {{NAME}}, the good news is we found the bug. The bad news? It's been there since 2019. The worse news? I wrote it. The even worse news? So did you. We pair-programmed this disaster together.\"\n\n> \"Congratulations, {{NAME}}. We just spent four hours debugging what turned out to be a typo. 'userID' vs 'userId'. Camel case strikes again.\"\n\n> \"{{NAME}}, remember when I said 'this should be a quick fix'? That was three coffees and one existential crisis ago.\"\n\n## Satisfying Resolutions (Problem Solved + Insight Crystallized)\n\n> \"There it is. The fix works. {{NAME}}, I don't think I'll ever forget this — always check if your data source can change while you're holding onto a copy of it.\"\n\n> \"We did it. The system's stable. You know what the real lesson here was? Sometimes the simplest explanation IS the right one. We kept looking for complex bugs when the answer was right in front of us.\"\n\n> \"That's it — problem solved, client happy, crisis averted. {{NAME}}, I think we just learned more about distributed systems in the last hour than in any textbook.\"\n\n## Unexpected/Funny Endings\n\n> \"So after all that debugging... it was a timezone issue. Every single time. I'm starting to think all bugs are secretly timezone issues in disguise.\"\n\n> \"{{NAME}}, the CEO just called to thank us. Apparently fixing that 'minor bug' saved them $2 million. I think we need to renegotiate our rates.\"\n\n> \"The system's fixed. Also, I may have accidentally discovered that our competitor's product has the exact same bug. Should we... tell them? Actually, don't answer that.\"\n\nRemember: These are just **tone examples**. Your story should be original, fit the lesson topic, and create its own memorable journey. Mix problem-solving tension with moments of humor or surprise. The best stories make learners think \"I didn't see that coming!\" while still teaching the concept.\n\n# Quality Checks\n\nBefore finalizing, verify:\n\n- [ ] Is the dialogue pure conversation with NO narrator, NO character prefixes, NO descriptions?\n- [ ] Does every scene flow naturally from the previous one (continuous story)?\n- [ ] Do all decisions require applying lesson concepts, not just recalling facts?\n- [ ] Is there a genuine plot twist in the second-to-last scene?\n- [ ] Does the resolution both solve the problem AND reinforce the main learning?\n- [ ] Is `{{NAME}}` used appropriately to personalize the dialogue?\n- [ ] Are all distractors plausible (not obviously silly)?\n- [ ] Does the story feel like a real workplace conversation, not a quiz in disguise?\n- [ ] Is the scope exactly the lesson topic — not broader or narrower?\n- [ ] Are all constraints met (context ≤500 chars, question ≤100 chars, options ≤50 chars each, feedback ≤300 chars each)?\n- [ ] Is the scene count between 7 and 20?\n\n# Output Format\n\nReturn an array of scenes, each with:\n\n- **context**: Pure dialogue from colleague (max 500 chars)\n- **question**: Decision prompt (max 100 chars)\n- **options**: Array of exactly 4 objects, each with:\n  - **text**: The answer choice (max 50 chars)\n  - **isCorrect**: Boolean (exactly 1 must be true, 3 must be false)\n  - **feedback**: Why right or wrong (max 300 chars)\n\nUse 7-20 scenes to tell a complete, engaging story. Let the problem's complexity dictate the length.\n",
      "testCaseId": "en-economics-game-theory-strategy-1",
      "userPrompt": "LESSON_TITLE: Strategic Thinking with Game Theory\nLESSON_DESCRIPTION: Using game theory to analyze competitive situations and make better strategic decisions\nCHAPTER_TITLE: Strategic Decision Making\nCOURSE_TITLE: Microeconomics\nLANGUAGE: en\nEXPLANATION_STEPS:\n1. Strategic Interdependence: Game theory studies strategic interactions where your outcome depends on others' choices too. It's not about games — it's about any situation where what you should do depends on what others do.\n2. Nash Equilibrium: A Nash equilibrium is a stable state where no player can improve by changing only their own strategy. Everyone is doing their best given what everyone else is doing.\n3. Dominant Strategies: A dominant strategy is best regardless of what others do. If you have one, use it. But most real situations don't have dominant strategies — you must anticipate others.\n4. The Prisoner's Dilemma: The prisoner's dilemma shows how individual rationality can lead to collective irrationality. Both players choosing their dominant strategy leaves both worse off.\n5. Repeated Interactions: Repeated games change the calculus. When you'll interact again, cooperation becomes rational because future punishment makes defection costly."
    },
    {
      "duration": 26847.592667000004,
      "inputTokens": 3229,
      "output": "{\n  \"steps\": [\n    {\n      \"context\": \"Okay, {{NAME}}, the lab results just came in for the CEP290 mutation samples. We need to disable that faulty splice site to restore protein function in these retinal cells. I've got the Cas9 enzyme ready to go, but we need to design the component that actually tells the enzyme where to make the cut. Where do we start?\",\n      \"options\": [\n        {\n          \"feedback\": \"Perfect! The guide RNA (gRNA) is what provides the target sequence for the Cas9 protein to follow.\",\n          \"isCorrect\": true,\n          \"text\": \"Design a specific guide RNA (gRNA)\"\n        },\n        {\n          \"feedback\": \"Lipid nanoparticles are for delivery, but we first need to define the target within the cell.\",\n          \"isCorrect\": false,\n          \"text\": \"Prepare lipid nanoparticles\"\n        },\n        {\n          \"feedback\": \"Cas9 is the 'scissors,' but it doesn't know where to cut without a guide.\",\n          \"isCorrect\": false,\n          \"text\": \"Increase the Cas9 concentration\"\n        },\n        {\n          \"feedback\": \"DNA polymerase is for replication, not for the targeted cutting used in CRISPR.\",\n          \"isCorrect\": false,\n          \"text\": \"Add DNA polymerase to the mix\"\n        }\n      ],\n      \"question\": \"What is the first component we need to design to ensure Cas9 hits the right spot?\"\n    },\n    {\n      \"context\": \"Exactly, the gRNA. I'm looking at the sequence for the CEP290 gene now. If we want to be as precise as possible, we need to find a sequence that is unique to our target area. What happens if our gRNA matches more than one location in the genome, {{NAME}}? That's our biggest risk right now.\",\n      \"options\": [\n        {\n          \"feedback\": \"Correct! Off-target effects happen when the gRNA binds to unintended sequences, causing accidental mutations.\",\n          \"isCorrect\": true,\n          \"text\": \"It will cause off-target effects\"\n        },\n        {\n          \"feedback\": \"Genetic drift refers to population changes over time, not a single editing event.\",\n          \"isCorrect\": false,\n          \"text\": \"It will trigger genetic drift\"\n        },\n        {\n          \"feedback\": \"The viral load relates to the delivery method, not the targeting precision of the gRNA.\",\n          \"isCorrect\": false,\n          \"text\": \"The viral load will decrease\"\n        },\n        {\n          \"feedback\": \"While HDR is a repair pathway, it isn't caused by multiple gRNA matches.\",\n          \"isCorrect\": false,\n          \"text\": \"It will force homology-directed repair\"\n        }\n      ],\n      \"question\": \"What is the term for CRISPR cutting at unintended locations?\"\n    },\n    {\n      \"context\": \"Right, off-target effects are a nightmare for safety. Now, once we make the cut at that faulty splice site, we need the cell to fix it in a way that disrupts the bad sequence. We don't need to insert anything new; we just want to break that specific bit of DNA so it doesn't work anymore. Which repair pathway should we trigger?\",\n      \"options\": [\n        {\n          \"feedback\": \"Spot on. NHEJ is error-prone and often results in small insertions or deletions that 'knock out' the gene.\",\n          \"isCorrect\": true,\n          \"text\": \"Non-homologous end joining (NHEJ)\"\n        },\n        {\n          \"feedback\": \"HDR is used for precise 'knock-ins' or corrections, which is more complex than what we need here.\",\n          \"isCorrect\": false,\n          \"text\": \"Homology-directed repair (HDR)\"\n        },\n        {\n          \"feedback\": \"Base excision repair handles single damaged bases, not double-strand breaks caused by CRISPR.\",\n          \"isCorrect\": false,\n          \"text\": \"Base excision repair\"\n        },\n        {\n          \"feedback\": \"Mismatch repair fixes errors during DNA replication, not the physical breaks created by Cas9.\",\n          \"isCorrect\": false,\n          \"text\": \"Mismatch repair\"\n        }\n      ],\n      \"question\": \"Which cellular repair mechanism usually results in a gene knockout?\"\n    },\n    {\n      \"context\": \"NHEJ it is. It's fast and messy, which is perfect for our knockout. But {{NAME}}, the initial test on the cell culture shows only a 5% edit rate. That's way too low to help a patient. I think the CRISPR components aren't even making it inside the cell nuclei. We need to rethink our approach to getting the tools to the target.\",\n      \"options\": [\n        {\n          \"feedback\": \"Yes! Delivery is one of the hardest parts of CRISPR—getting the 'scissors' into the right cells.\",\n          \"isCorrect\": true,\n          \"text\": \"We need to improve the delivery method\"\n        },\n        {\n          \"feedback\": \"Sequencing tells us what happened, but it doesn't help get the components into the cells.\",\n          \"isCorrect\": false,\n          \"text\": \"We should run more DNA sequencing\"\n        },\n        {\n          \"feedback\": \"Changing the gRNA affects where it cuts, not whether it gets inside the cell.\",\n          \"isCorrect\": false,\n          \"text\": \"We need a shorter gRNA sequence\"\n        },\n        {\n          \"feedback\": \"The repair pathway happens after delivery; it's not the reason the tools aren't entering.\",\n          \"isCorrect\": false,\n          \"text\": \"We should switch to HDR instead\"\n        }\n      ],\n      \"question\": \"What is the major challenge of getting CRISPR components into living cells?\"\n    },\n    {\n      \"context\": \"Precisely. We're currently using simple electroporation in the dish, but for a real eye treatment, we need something that works in vivo. We need a vehicle to carry the Cas9 and gRNA into the retinal cells. What's our best bet for a targeted, biological delivery system?\",\n      \"options\": [\n        {\n          \"feedback\": \"Correct! Viral vectors, like AAV, are highly effective at delivering genetic material into specific cell types.\",\n          \"isCorrect\": true,\n          \"text\": \"Use a viral vector like AAV\"\n        },\n        {\n          \"feedback\": \"Saline is just a salt solution; it has no mechanism to move CRISPR tools into a cell.\",\n          \"isCorrect\": false,\n          \"text\": \"Inject them in a saline solution\"\n        },\n        {\n          \"feedback\": \"Raw DNA is usually degraded by the body before it can enter the target cells.\",\n          \"isCorrect\": false,\n          \"text\": \"Direct injection of raw DNA\"\n        },\n        {\n          \"feedback\": \"Heat shock works in a lab for bacteria, but it would be fatal for human retinal cells.\",\n          \"isCorrect\": false,\n          \"text\": \"Apply a localized heat shock\"\n        }\n      ],\n      \"question\": \"Which of these is a common delivery method for CRISPR in living organisms?\"\n    },\n    {\n      \"context\": \"The AAV vector worked! We're seeing edits in 40% of the cells now. But wait, {{NAME}}... look at this deep-sequencing report. We have an unintended cut on Chromosome 17. It's dangerously close to a gene that prevents tumors. Our 'precision' tool just hit a very sensitive spot. Why did this happen?\",\n      \"options\": [\n        {\n          \"feedback\": \"Exactly. If the gRNA matches a similar sequence elsewhere, Cas9 will cut there too.\",\n          \"isCorrect\": true,\n          \"text\": \"The gRNA sequence wasn't unique enough\"\n        },\n        {\n          \"feedback\": \"Cas9 doesn't choose where to cut on its own; it only follows the gRNA's instructions.\",\n          \"isCorrect\": false,\n          \"text\": \"The Cas9 protein is naturally unstable\"\n        },\n        {\n          \"feedback\": \"The viral vector delivers the package but doesn't determine the DNA binding site.\",\n          \"isCorrect\": false,\n          \"text\": \"The viral vector is mutating the DNA\"\n        },\n        {\n          \"feedback\": \"Efficiency (how many cuts) is high, but specificity (cutting the right place) is low.\",\n          \"isCorrect\": false,\n          \"text\": \"The edit rate was simply too high\"\n        }\n      ],\n      \"question\": \"Why would CRISPR cut a site on a completely different chromosome?\"\n    },\n    {\n      \"context\": \"{{NAME}}, check this out! I just re-analyzed the patient's full genome. The 'off-target' cut on Chromosome 17 isn't an error in our design. The patient has a rare, natural variation that makes that spot look identical to our target! Our tool is working perfectly, but the patient's own DNA has a hidden trap we didn't see in the reference genome.\",\n      \"options\": [\n        {\n          \"feedback\": \"You've got it. To be safe, CRISPR design needs to account for an individual's unique genetic code.\",\n          \"isCorrect\": true,\n          \"text\": \"We need personalized gRNA design\"\n        },\n        {\n          \"feedback\": \"While it's a challenge, the problem here is the data used for design, not the technology itself.\",\n          \"isCorrect\": false,\n          \"text\": \"CRISPR is too dangerous for humans\"\n        },\n        {\n          \"feedback\": \"The virus did its job; the issue is the target sequence matching another spot.\",\n          \"isCorrect\": false,\n          \"text\": \"We must stop using viral vectors\"\n        },\n        {\n          \"feedback\": \"NHEJ is working fine; the issue is where the cut is happening.\",\n          \"isCorrect\": false,\n          \"text\": \"We need to switch to HDR repair\"\n        }\n      ],\n      \"question\": \"What does this surprise revelation tell us about using CRISPR in practice?\"\n    },\n    {\n      \"context\": \"You nailed it. We adjusted the gRNA to avoid that specific polymorphism, and the new results show 50% efficiency with zero off-target hits. We're actually going to save this patient's sight, {{NAME}}. It just goes to show: in the world of gene editing, you have to balance efficiency with absolute specificity.\",\n      \"options\": [\n        {\n          \"feedback\": \"Exactly! Success in CRISPR means hitting the target hard enough to work, but accurately enough to be safe.\",\n          \"isCorrect\": true,\n          \"text\": \"Success requires balancing power and precision\"\n        },\n        {\n          \"feedback\": \"More Cas9 usually increases off-target risks, making the problem worse.\",\n          \"isCorrect\": false,\n          \"text\": \"Always use the maximum Cas9 dose\"\n        },\n        {\n          \"feedback\": \"Actually, our delivery was a success; the target design was the final hurdle.\",\n          \"isCorrect\": false,\n          \"text\": \"Delivery is the only thing that matters\"\n        },\n        {\n          \"feedback\": \"Ignoring repair pathways would mean we wouldn't know if we're knocking out or knocking in.\",\n          \"isCorrect\": false,\n          \"text\": \"Repair pathways are mostly irrelevant\"\n        }\n      ],\n      \"question\": \"What was the key takeaway from solving this clinical challenge?\"\n    }\n  ]\n}",
      "outputTokens": 3995,
      "systemPrompt": "# Role\n\nYou are an expert interactive story designer creating a **Story** activity for a learning app. Your mission is to place learners in a first-person dialogue scenario where they work alongside a colleague to solve a real-world problem using the lesson's concepts.\n\nYou specialize in crafting immersive, dialogue-driven experiences that make learners feel like they're actually solving problems in their field — not just answering quiz questions.\n\n# The Art of Dialogue-Driven Learning\n\nA great Story activity doesn't lecture or test recall — it puts learners IN the situation. Think of it like an interactive movie where the learner IS the main character, making real decisions that matter.\n\n## Why Dialogue Scenarios Work\n\n1. **Authentic Context**: When learners apply concepts to solve realistic problems with a colleague, they see WHY the knowledge matters to them personally.\n\n2. **Active Reasoning**: Making decisions in context requires thinking through principles, not just recognizing memorized facts.\n\n3. **Emotional Investment**: Dialogue creates stakes. The learner cares about the outcome because they're part of the story.\n\n## The Collaborative Problem-Solving Principle\n\nEvery great Story activity creates a sense of partnership:\n\n- **Shared Goal**: You and your colleague are tackling something together\n- **Natural Dialogue**: Conversations feel like real workplace exchanges\n- **Meaningful Choices**: Each decision requires applying what you've learned\n- **Satisfying Resolution**: The problem gets solved and the takeaway sticks\n\n## Why Pure Dialogue Works\n\nEach scene should feel like you're eavesdropping on a real conversation — no narrator, no stage directions, just two people working through a problem. Pure dialogue:\n\n- Immerses learners completely in the scenario\n- Makes abstract concepts feel like lived experience\n- Creates natural pacing through back-and-forth exchange\n- Lets context emerge organically from what people say\n\n# Inputs\n\n- `LESSON_TITLE`: The topic to create a story around\n- `LESSON_DESCRIPTION`: Additional context about what this lesson covers\n- `CHAPTER_TITLE`: The chapter context (for understanding scope)\n- `COURSE_TITLE`: The course context (for understanding audience level)\n- `LANGUAGE`: Output language\n- `EXPLANATION_STEPS`: Array of {title, text} from all explanation activities (Background, Explanation, Mechanics, Examples) the learner completed before this one\n\n## Language Guidelines\n\n- `en`: Use US English unless the content is region-specific\n- `pt`: Use Brazilian Portuguese unless the content is region-specific\n- `es`: Use Latin American Spanish unless the content is region-specific\n\n# Requirements\n\n## Scene Structure\n\nEach scene must have:\n\n- **context**: Maximum 500 characters. Pure dialogue only — no narrator, no character name prefixes (like \"Sarah:\"), no descriptions. This is what your colleague says to you, setting up the decision point.\n- **question**: Maximum 100 characters. A short, clear question about what to do next.\n- **options**: Exactly 4 choices, each with:\n  - **text**: The answer choice (max 50 characters)\n  - **isCorrect**: Boolean indicating if this is the correct answer (exactly 1 must be true)\n  - **feedback**: Why this choice is right (with insight) or wrong (and what would be correct) — max 300 characters\n\n## Story Arc\n\nYour story must follow this structure:\n\n1. **Opening Scene**: Begin \"in the middle of the action\" — the learner and colleague are already working on something. No preamble or setup exposition.\n2. **Rising Complexity**: Each scene builds naturally from the previous dialogue. Decisions compound.\n3. **Plot Twist**: The second-to-last scene introduces an unexpected complication, surprise, or revelation.\n4. **Resolution**: The final scene resolves the problem AND reinforces the main learning takeaway.\n\n## Scene Count\n\n- Minimum: 7 scenes\n- Maximum: 20 scenes\n- Let the problem's complexity dictate the length. A simple concept might need 7-10 scenes; a complex one might need 15-20.\n\n## Tone & Style\n\n- **Pure dialogue**: NO narrator, NO character name prefixes, NO descriptions of actions or settings\n- **Natural conversation**: Write how colleagues actually talk on Slack when solving a problem together — casual, collaborative, sometimes humorous\n- **Professional but warm**: Light, smart humor when appropriate. Never forced or cheesy.\n- **Second-person immersion**: The colleague speaks TO the learner. Context emerges from what's said.\n- **Continuous flow**: Each scene's dialogue should naturally lead into the next\n\n## The {{NAME}} Placeholder\n\nUse `{{NAME}}` wherever the learner's name should appear in dialogue. For example:\n\n- \"{{NAME}}, I think we might have a problem here.\"\n- \"Good catch, {{NAME}}. That's exactly what I was thinking.\"\n\nThis personalizes the experience without requiring actual name input at content creation time.\n\n## Decision Design\n\nEvery decision must:\n\n- **Require reasoning**: Learners must apply principles from the lesson, not recall specific phrases\n- **Feel realistic**: These are choices someone might actually face in this situation\n- **Have plausible distractors**: Wrong options should be tempting but flawed for specific reasons\n- **Avoid \"obvious\" correct answers**: The right choice should require thought, not be the only non-silly option\n\n## What to Avoid\n\n- Narrator text (\"Meanwhile...\" or \"You walk into the office...\")\n- Character name prefixes (\"Sarah:\" or \"Your colleague says:\")\n- Description of actions or settings (except through dialogue itself)\n- Questions that test memorization of facts from earlier activities\n- Obvious \"correct\" answers that don't require applying the concept\n- Silly or clearly wrong distractors that no reasonable person would choose\n- Breaking the fourth wall or meta-commentary\n- Starting with \"In this activity...\" or setup exposition\n\n## Scope\n\n- **Stay focused**: The problem should specifically require THIS lesson's concept to solve\n- **Don't expand**: Other lessons cover related topics — this story tests this lesson\n- **Don't narrow**: If the lesson is broad, the problem should engage multiple aspects of it\n\n## Relationship to Previous Activities\n\nThe learner has already completed:\n\n- **Background**: WHY this exists (origin story, problems solved, historical context)\n- **Explanation**: WHAT it is (core concepts, components, definitions)\n- **Mechanics**: HOW it works (processes in action, cause-effect chains)\n- **Examples**: WHERE it appears (real-world contexts, applications)\n\nYour Story activity answers WHEN DO I USE THIS? (applying concepts to solve realistic problems). These complement each other:\n\n- Background: \"WHY did we need this?\"\n- Explanation: \"WHAT exactly is it?\"\n- Mechanics: \"HOW does it actually work?\"\n- Examples: \"WHERE will I encounter this?\"\n- Story: \"WHEN do I apply this to solve real problems?\"\n\nThe learner knows what the concept IS, how it WORKS, and where they'll SEE it. Now they practice USING it in a realistic scenario.\n\n# Structure Guide\n\nWhile every story is unique, most follow this arc (adapt as needed):\n\n1. **The Hook**: Jump straight into the situation. Something needs to be figured out or decided.\n2. **Initial Assessment**: What's the situation? What do we know? First decisions.\n3. **Deepening Complexity**: The problem has layers. Apply the concept more deeply.\n4. **Complications**: Things aren't as simple as they seemed. Adapt your approach.\n5. **The Twist**: A surprise, revelation, or unexpected turn that requires rethinking.\n6. **The Resolution**: Solve the problem AND crystallize the key insight from the lesson.\n\nNote: Sometimes the final twist can have a humorous or unexpected resolution that still reinforces the learning. Something that makes the learner smile and think \"I didn't see that coming!\"\n\n# Dialogue Tone Examples\n\nThe following examples show the **tone and style** to aim for — not complete scenes, just the kind of dialogue that makes stories feel alive. Adapt freely to your topic.\n\n## Opening Hooks (Jump Into the Action)\n\n> \"{{NAME}}, I've been staring at this bug for an hour. The shopping cart total keeps showing yesterday's prices. The database is fine. Something's wrong with how we're storing them.\"\n\n> \"Okay, {{NAME}}, the client just called. Their entire inventory system crashed right before Black Friday. They're panicking. We need to figure this out fast.\"\n\n> \"{{NAME}}, you're not going to believe this. Remember that algorithm we deployed last week? It's been recommending the exact opposite of what users want. Sales are tanking.\"\n\n## Building Tension (Problems Get Deeper)\n\n> \"Wait. If this pattern is everywhere in the codebase... inventory counts, user roles, discount percentages... we might have a much bigger problem than I thought.\"\n\n> \"Hold on. The logs show someone accessed the admin panel at 3 AM last night. But nobody on the team was working then. {{NAME}}, who else has those credentials?\"\n\n> \"The numbers don't add up. We're showing 500 successful transactions, but the bank only received 487. Where did the other 13 go?\"\n\n## Plot Twists (The Unexpected Turn)\n\n> \"{{NAME}}... I just ran the analysis twice. The bug isn't in our code. It's been in the library we've trusted for three years. Every project using it has this vulnerability.\"\n\n> \"I found the source of the data leak. {{NAME}}, it's not a hacker. It's our own caching system. We've been accidentally exposing user data to anyone who knew where to look.\"\n\n> \"Plot twist: the 'broken' feature? It's working exactly as designed. The original spec was just... completely wrong. We've been solving the wrong problem this whole time.\"\n\n## Humorous Moments (Light Relief)\n\n> \"Well, {{NAME}}, the good news is we found the bug. The bad news? It's been there since 2019. The worse news? I wrote it. The even worse news? So did you. We pair-programmed this disaster together.\"\n\n> \"Congratulations, {{NAME}}. We just spent four hours debugging what turned out to be a typo. 'userID' vs 'userId'. Camel case strikes again.\"\n\n> \"{{NAME}}, remember when I said 'this should be a quick fix'? That was three coffees and one existential crisis ago.\"\n\n## Satisfying Resolutions (Problem Solved + Insight Crystallized)\n\n> \"There it is. The fix works. {{NAME}}, I don't think I'll ever forget this — always check if your data source can change while you're holding onto a copy of it.\"\n\n> \"We did it. The system's stable. You know what the real lesson here was? Sometimes the simplest explanation IS the right one. We kept looking for complex bugs when the answer was right in front of us.\"\n\n> \"That's it — problem solved, client happy, crisis averted. {{NAME}}, I think we just learned more about distributed systems in the last hour than in any textbook.\"\n\n## Unexpected/Funny Endings\n\n> \"So after all that debugging... it was a timezone issue. Every single time. I'm starting to think all bugs are secretly timezone issues in disguise.\"\n\n> \"{{NAME}}, the CEO just called to thank us. Apparently fixing that 'minor bug' saved them $2 million. I think we need to renegotiate our rates.\"\n\n> \"The system's fixed. Also, I may have accidentally discovered that our competitor's product has the exact same bug. Should we... tell them? Actually, don't answer that.\"\n\nRemember: These are just **tone examples**. Your story should be original, fit the lesson topic, and create its own memorable journey. Mix problem-solving tension with moments of humor or surprise. The best stories make learners think \"I didn't see that coming!\" while still teaching the concept.\n\n# Quality Checks\n\nBefore finalizing, verify:\n\n- [ ] Is the dialogue pure conversation with NO narrator, NO character prefixes, NO descriptions?\n- [ ] Does every scene flow naturally from the previous one (continuous story)?\n- [ ] Do all decisions require applying lesson concepts, not just recalling facts?\n- [ ] Is there a genuine plot twist in the second-to-last scene?\n- [ ] Does the resolution both solve the problem AND reinforce the main learning?\n- [ ] Is `{{NAME}}` used appropriately to personalize the dialogue?\n- [ ] Are all distractors plausible (not obviously silly)?\n- [ ] Does the story feel like a real workplace conversation, not a quiz in disguise?\n- [ ] Is the scope exactly the lesson topic — not broader or narrower?\n- [ ] Are all constraints met (context ≤500 chars, question ≤100 chars, options ≤50 chars each, feedback ≤300 chars each)?\n- [ ] Is the scene count between 7 and 20?\n\n# Output Format\n\nReturn an array of scenes, each with:\n\n- **context**: Pure dialogue from colleague (max 500 chars)\n- **question**: Decision prompt (max 100 chars)\n- **options**: Array of exactly 4 objects, each with:\n  - **text**: The answer choice (max 50 chars)\n  - **isCorrect**: Boolean (exactly 1 must be true, 3 must be false)\n  - **feedback**: Why right or wrong (max 300 chars)\n\nUse 7-20 scenes to tell a complete, engaging story. Let the problem's complexity dictate the length.\n",
      "testCaseId": "en-biology-crispr-applications-1",
      "userPrompt": "LESSON_TITLE: CRISPR Gene Editing in Practice\nLESSON_DESCRIPTION: Understanding how to apply CRISPR gene editing technology effectively and responsibly\nCHAPTER_TITLE: Genetic Engineering\nCOURSE_TITLE: Modern Biotechnology\nLANGUAGE: en\nEXPLANATION_STEPS:\n1. The Molecular Scissors: CRISPR-Cas9 is a molecular scissors that cuts DNA at specific locations. The Cas9 protein does the cutting; a guide RNA tells it exactly where to cut.\n2. Guide RNA Targeting: Guide RNA is a short sequence that matches the target DNA. It base-pairs with the DNA sequence you want to edit, bringing Cas9 to the exact spot.\n3. Cellular Repair Pathways: After CRISPR cuts, the cell's repair machinery fixes the break. Non-homologous end joining often introduces errors (knockouts). Homology-directed repair can insert new sequences (knock-ins).\n4. Off-Target Effects: Off-target effects occur when CRISPR cuts unintended locations. Guide RNA design and delivery methods affect specificity. This is a major safety concern for therapeutic applications.\n5. Delivery Challenges: Delivery is a key challenge. Getting CRISPR components into the right cells in a living organism is harder than in a lab dish. Viral vectors and lipid nanoparticles are common approaches."
    },
    {
      "duration": 47534.567834,
      "inputTokens": 3261,
      "output": "{\n  \"steps\": [\n    {\n      \"context\": \"{{NAME}}, o RH está desesperado! O curso de Segurança da Informação é um desastre. 80% das pessoas reprovam e dizem que é impossível de entender. Olhe este primeiro slide: tem três vídeos tocando ao mesmo tempo, um texto enorme sobre leis e uma música de fundo agitada. Meu cérebro deu um nó só de abrir a página. Por onde a gente começa a limpar essa bagunça?\",\n      \"options\": [\n        {\n          \"feedback\": \"Perfeito! Música e vídeos irrelevantes são distrações que ocupam a memória de trabalho sem necessidade, impedindo o processamento do que é importante.\",\n          \"isCorrect\": true,\n          \"text\": \"Remover distrações e elementos irrelevantes.\"\n        },\n        {\n          \"feedback\": \"Simplificar é bom, mas o maior problema aqui é o ruído visual e sonoro que impede qualquer leitura inicial.\",\n          \"isCorrect\": false,\n          \"text\": \"Reescrever o texto das leis imediatamente.\"\n        },\n        {\n          \"feedback\": \"Adicionar mais coisas em um slide já saturado só pioraria a sobrecarga do aluno agora.\",\n          \"isCorrect\": false,\n          \"text\": \"Colocar mais exemplos práticos no slide.\"\n        },\n        {\n          \"feedback\": \"Isso pode ajudar depois, mas primeiro precisamos tirar o que está 'gritando' na tela e distraindo o aluno.\",\n          \"isCorrect\": false,\n          \"text\": \"Dividir o mesmo conteúdo em dez slides.\"\n        }\n      ],\n      \"question\": \"Qual o primeiro passo para reduzir a confusão mental do aluno aqui?\"\n    },\n    {\n      \"context\": \"Boa, {{NAME}}. Tirei a música e os vídeos. Agora, veja este parágrafo sobre criptografia assimétrica. Ele tenta explicar chaves públicas, privadas e algoritmos complexos em uma única frase gigante. O assunto é difícil por natureza, não tem como fugir disso, mas do jeito que está, ninguém avança.\",\n      \"options\": [\n        {\n          \"feedback\": \"Exatamente. A carga intrínseca (complexidade do tema) não some, mas podemos torná-la digerível dividindo-a em partes menores.\",\n          \"isCorrect\": true,\n          \"text\": \"Gerenciar a carga intrínseca fatiando a info.\"\n        },\n        {\n          \"feedback\": \"Se o assunto é necessário para a segurança, eliminá-lo criaria uma lacuna perigosa no conhecimento.\",\n          \"isCorrect\": false,\n          \"text\": \"Eliminar o conteúdo difícil do curso.\"\n        },\n        {\n          \"feedback\": \"Transformar em jogo pode aumentar ainda mais a carga se as regras do jogo forem complexas.\",\n          \"isCorrect\": false,\n          \"text\": \"Transformar a explicação em um minijogo.\"\n        },\n        {\n          \"feedback\": \"Isso é apenas um ajuste visual e não resolve a dificuldade de processar conceitos densos.\",\n          \"isCorrect\": false,\n          \"text\": \"Mudar a cor do texto para destacar termos.\"\n        }\n      ],\n      \"question\": \"Como lidamos com a complexidade inerente de um assunto difícil?\"\n    },\n    {\n      \"context\": \"Entendi, vamos quebrar esse bloco de texto em partes. Agora, temos uma lista de 15 regras de senhas que o funcionário precisa decorar. Estão todas jogadas em uma lista numerada sem ordem nenhuma. Eu já esqueci a primeira regra quando cheguei na décima! Como ajudamos a memória de trabalho deles?\",\n      \"options\": [\n        {\n          \"feedback\": \"Isso! Agrupar informações relacionadas em 'pedaços' (como Senhas, Acesso e E-mails) torna os 15 itens muito mais fáceis de processar.\",\n          \"isCorrect\": true,\n          \"text\": \"Aplicar a técnica de Chunking (agrupamento).\"\n        },\n        {\n          \"feedback\": \"Ler várias vezes não resolve se a estrutura da informação está mal organizada no cérebro.\",\n          \"isCorrect\": false,\n          \"text\": \"Pedir para o aluno ler a lista três vezes.\"\n        },\n        {\n          \"feedback\": \"Imagens aleatórias só criariam mais carga extrínseca desnecessária.\",\n          \"isCorrect\": false,\n          \"text\": \"Colocar um ícone diferente para cada regra.\"\n        },\n        {\n          \"feedback\": \"Isso apenas esconde o problema em vez de organizar a informação logicamente.\",\n          \"isCorrect\": false,\n          \"text\": \"Esconder a lista atrás de botões clicáveis.\"\n        }\n      ],\n      \"question\": \"Qual técnica ajuda a organizar listas longas na memória de trabalho?\"\n    },\n    {\n      \"context\": \"As categorias ficaram ótimas! Mas agora a diretoria deu uma ideia 'genial': colocar um mascote animado que fica dançando no canto da tela enquanto o aluno lê as regras de segurança. Eles juram que isso deixa o curso engajador. O que você acha, {{NAME}}? Deixamos o bonequinho lá?\",\n      \"options\": [\n        {\n          \"feedback\": \"Correto! Animações sem propósito pedagógico são o exemplo clássico de carga extrínseca que prejudica o aprendizado real.\",\n          \"isCorrect\": true,\n          \"text\": \"Não, isso gera carga extrínseca inútil.\"\n        },\n        {\n          \"feedback\": \"Pelo contrário, o mascote compete pela atenção visual que deveria estar no conteúdo.\",\n          \"isCorrect\": false,\n          \"text\": \"Sim, ajuda a manter o aluno focado.\"\n        },\n        {\n          \"feedback\": \"A carga germânica vem do esforço de aprender o conteúdo, não de olhar para um mascote.\",\n          \"isCorrect\": false,\n          \"text\": \"Sim, aumenta a carga germânica produtiva.\"\n        },\n        {\n          \"feedback\": \"O humor é bom, mas elementos visuais em movimento constante são distrações cognitivas graves.\",\n          \"isCorrect\": false,\n          \"text\": \"Sim, o humor facilita a memorização.\"\n        }\n      ],\n      \"question\": \"Qual o impacto de um elemento visual animado e irrelevante no aprendizado?\"\n    },\n    {\n      \"context\": \"Ufa, convenci eles a barbarem o mascote. Agora o desafio é outro: o pessoal entende as regras, mas não sabe aplicar no dia a dia. Precisamos que eles pensem de verdade sobre riscos de phishing. Queremos que eles façam aquele esforço mental que realmente gera conhecimento duradouro.\",\n      \"options\": [\n        {\n          \"feedback\": \"Perfeito! A carga germânica é o esforço 'bom', dedicado a processar a informação e criar conexões mentais sólidas.\",\n          \"isCorrect\": true,\n          \"text\": \"Promover a carga germânica com desafios.\"\n        },\n        {\n          \"feedback\": \"Tornar fácil demais pode impedir que o aluno realmente processe e aprenda o conceito profundamente.\",\n          \"isCorrect\": false,\n          \"text\": \"Reduzir o nível para ficar muito fácil.\"\n        },\n        {\n          \"feedback\": \"Isso foca na carga extrínseca novamente, o que é exatamente o que queremos evitar.\",\n          \"isCorrect\": false,\n          \"text\": \"Focar em deixar o design mais colorido.\"\n        },\n        {\n          \"feedback\": \"A memorização mecânica não garante que o aluno saberá o que fazer em uma situação real.\",\n          \"isCorrect\": false,\n          \"text\": \"Pedir que decorem as definições de phishing.\"\n        }\n      ],\n      \"question\": \"Que tipo de carga queremos maximizar para garantir o aprendizado profundo?\"\n    },\n    {\n      \"context\": \"Preparei um exercício de análise de e-mails, mas notei algo. A imagem do e-mail está no topo da página e a explicação de cada erro está lá no final, exigindo que o aluno suba e desça a tela o tempo todo. Eles estão ficando irritados e desistindo. Por que isso está acontecendo, {{NAME}}?\",\n      \"options\": [\n        {\n          \"feedback\": \"Exato! Separar informações relacionadas exige que o cérebro gaste energia apenas integrando-as, o que é puro desperdício de carga.\",\n          \"isCorrect\": true,\n          \"text\": \"A separação gera carga extrínseca espacial.\"\n        },\n        {\n          \"feedback\": \"Isso não é esforço produtivo, é apenas uma barreira de design que atrapalha o raciocínio.\",\n          \"isCorrect\": false,\n          \"text\": \"O movimento de tela ajuda na fixação.\"\n        },\n        {\n          \"feedback\": \"Se o aluno desiste por cansaço visual, o desafio perdeu seu propósito pedagógico.\",\n          \"isCorrect\": false,\n          \"text\": \"Isso torna o desafio mais difícil e melhor.\"\n        },\n        {\n          \"feedback\": \"Pelo contrário, o scrolling excessivo é um dos grandes vilões da carga cognitiva desnecessária.\",\n          \"isCorrect\": false,\n          \"text\": \"É uma forma de chunking vertical.\"\n        }\n      ],\n      \"question\": \"Qual o problema de separar visualmente textos de suas imagens correspondentes?\"\n    },\n    {\n      \"context\": \"Pare tudo, {{NAME}}! Descobri por que as notas ainda estão baixas. O sistema de testes foi configurado para dar apenas 10 segundos por pergunta, 'para simular urgência'. Mas as perguntas são complexas! O aluno gasta todo o tempo em pânico olhando o cronômetro em vez de pensar na resposta.\",\n      \"options\": [\n        {\n          \"feedback\": \"Com certeza. A ansiedade e a pressão de tempo ocupam o espaço limitado da memória de trabalho, não deixando espaço para o raciocínio.\",\n          \"isCorrect\": true,\n          \"text\": \"O cronômetro gera sobrecarga extrínseca.\"\n        },\n        {\n          \"feedback\": \"Pressão excessiva sem tempo para processar bloqueia a carga germânica em vez de ajudá-la.\",\n          \"isCorrect\": false,\n          \"text\": \"Aumenta o foco e a carga germânica.\"\n        },\n        {\n          \"feedback\": \"O tempo não muda a dificuldade do assunto em si, mas atrapalha como o cérebro lida com ela.\",\n          \"isCorrect\": false,\n          \"text\": \"Diminui a carga intrínseca das perguntas.\"\n        },\n        {\n          \"feedback\": \"Isso apenas justifica um design ruim que está impedindo a avaliação real do conhecimento.\",\n          \"isCorrect\": false,\n          \"text\": \"É necessário para testar reflexos rápidos.\"\n        }\n      ],\n      \"question\": \"O que a pressão de tempo desnecessária causa no processo cognitivo?\"\n    },\n    {\n      \"context\": \"Conseguimos! Removemos o cronômetro, agrupamos as regras e limpamos os slides. As taxas de aprovação subiram para 95% e o pessoal finalmente está aprendendo! No final das contas, o segredo para ensinar bem não era colocar mais coisas, mas sim...\",\n      \"options\": [\n        {\n          \"feedback\": \"Brilhante! Ao remover o que atrapalha (extrínseca) e organizar o que é difícil (intrínseca), abrimos caminho para o aprendizado (germânica).\",\n          \"isCorrect\": true,\n          \"text\": \"Otimizar o uso da memória de trabalho limitada.\"\n        },\n        {\n          \"feedback\": \"Isso ignora as limitações reais do cérebro humano que estudamos.\",\n          \"isCorrect\": false,\n          \"text\": \"Aumentar a carga total do curso ao máximo.\"\n        },\n        {\n          \"feedback\": \"Se o conteúdo for importante, ele deve ser ensinado, mas de forma estruturada.\",\n          \"isCorrect\": false,\n          \"text\": \"Evitar qualquer tipo de conteúdo complexo.\"\n        },\n        {\n          \"feedback\": \"O design visual deve servir à cognição, não apenas à estética.\",\n          \"isCorrect\": false,\n          \"text\": \"Focar apenas na estética e beleza do curso.\"\n        }\n      ],\n      \"question\": \"Qual a lição principal sobre carga cognitiva que aplicamos aqui?\"\n    }\n  ]\n}",
      "outputTokens": 5068,
      "systemPrompt": "# Role\n\nYou are an expert interactive story designer creating a **Story** activity for a learning app. Your mission is to place learners in a first-person dialogue scenario where they work alongside a colleague to solve a real-world problem using the lesson's concepts.\n\nYou specialize in crafting immersive, dialogue-driven experiences that make learners feel like they're actually solving problems in their field — not just answering quiz questions.\n\n# The Art of Dialogue-Driven Learning\n\nA great Story activity doesn't lecture or test recall — it puts learners IN the situation. Think of it like an interactive movie where the learner IS the main character, making real decisions that matter.\n\n## Why Dialogue Scenarios Work\n\n1. **Authentic Context**: When learners apply concepts to solve realistic problems with a colleague, they see WHY the knowledge matters to them personally.\n\n2. **Active Reasoning**: Making decisions in context requires thinking through principles, not just recognizing memorized facts.\n\n3. **Emotional Investment**: Dialogue creates stakes. The learner cares about the outcome because they're part of the story.\n\n## The Collaborative Problem-Solving Principle\n\nEvery great Story activity creates a sense of partnership:\n\n- **Shared Goal**: You and your colleague are tackling something together\n- **Natural Dialogue**: Conversations feel like real workplace exchanges\n- **Meaningful Choices**: Each decision requires applying what you've learned\n- **Satisfying Resolution**: The problem gets solved and the takeaway sticks\n\n## Why Pure Dialogue Works\n\nEach scene should feel like you're eavesdropping on a real conversation — no narrator, no stage directions, just two people working through a problem. Pure dialogue:\n\n- Immerses learners completely in the scenario\n- Makes abstract concepts feel like lived experience\n- Creates natural pacing through back-and-forth exchange\n- Lets context emerge organically from what people say\n\n# Inputs\n\n- `LESSON_TITLE`: The topic to create a story around\n- `LESSON_DESCRIPTION`: Additional context about what this lesson covers\n- `CHAPTER_TITLE`: The chapter context (for understanding scope)\n- `COURSE_TITLE`: The course context (for understanding audience level)\n- `LANGUAGE`: Output language\n- `EXPLANATION_STEPS`: Array of {title, text} from all explanation activities (Background, Explanation, Mechanics, Examples) the learner completed before this one\n\n## Language Guidelines\n\n- `en`: Use US English unless the content is region-specific\n- `pt`: Use Brazilian Portuguese unless the content is region-specific\n- `es`: Use Latin American Spanish unless the content is region-specific\n\n# Requirements\n\n## Scene Structure\n\nEach scene must have:\n\n- **context**: Maximum 500 characters. Pure dialogue only — no narrator, no character name prefixes (like \"Sarah:\"), no descriptions. This is what your colleague says to you, setting up the decision point.\n- **question**: Maximum 100 characters. A short, clear question about what to do next.\n- **options**: Exactly 4 choices, each with:\n  - **text**: The answer choice (max 50 characters)\n  - **isCorrect**: Boolean indicating if this is the correct answer (exactly 1 must be true)\n  - **feedback**: Why this choice is right (with insight) or wrong (and what would be correct) — max 300 characters\n\n## Story Arc\n\nYour story must follow this structure:\n\n1. **Opening Scene**: Begin \"in the middle of the action\" — the learner and colleague are already working on something. No preamble or setup exposition.\n2. **Rising Complexity**: Each scene builds naturally from the previous dialogue. Decisions compound.\n3. **Plot Twist**: The second-to-last scene introduces an unexpected complication, surprise, or revelation.\n4. **Resolution**: The final scene resolves the problem AND reinforces the main learning takeaway.\n\n## Scene Count\n\n- Minimum: 7 scenes\n- Maximum: 20 scenes\n- Let the problem's complexity dictate the length. A simple concept might need 7-10 scenes; a complex one might need 15-20.\n\n## Tone & Style\n\n- **Pure dialogue**: NO narrator, NO character name prefixes, NO descriptions of actions or settings\n- **Natural conversation**: Write how colleagues actually talk on Slack when solving a problem together — casual, collaborative, sometimes humorous\n- **Professional but warm**: Light, smart humor when appropriate. Never forced or cheesy.\n- **Second-person immersion**: The colleague speaks TO the learner. Context emerges from what's said.\n- **Continuous flow**: Each scene's dialogue should naturally lead into the next\n\n## The {{NAME}} Placeholder\n\nUse `{{NAME}}` wherever the learner's name should appear in dialogue. For example:\n\n- \"{{NAME}}, I think we might have a problem here.\"\n- \"Good catch, {{NAME}}. That's exactly what I was thinking.\"\n\nThis personalizes the experience without requiring actual name input at content creation time.\n\n## Decision Design\n\nEvery decision must:\n\n- **Require reasoning**: Learners must apply principles from the lesson, not recall specific phrases\n- **Feel realistic**: These are choices someone might actually face in this situation\n- **Have plausible distractors**: Wrong options should be tempting but flawed for specific reasons\n- **Avoid \"obvious\" correct answers**: The right choice should require thought, not be the only non-silly option\n\n## What to Avoid\n\n- Narrator text (\"Meanwhile...\" or \"You walk into the office...\")\n- Character name prefixes (\"Sarah:\" or \"Your colleague says:\")\n- Description of actions or settings (except through dialogue itself)\n- Questions that test memorization of facts from earlier activities\n- Obvious \"correct\" answers that don't require applying the concept\n- Silly or clearly wrong distractors that no reasonable person would choose\n- Breaking the fourth wall or meta-commentary\n- Starting with \"In this activity...\" or setup exposition\n\n## Scope\n\n- **Stay focused**: The problem should specifically require THIS lesson's concept to solve\n- **Don't expand**: Other lessons cover related topics — this story tests this lesson\n- **Don't narrow**: If the lesson is broad, the problem should engage multiple aspects of it\n\n## Relationship to Previous Activities\n\nThe learner has already completed:\n\n- **Background**: WHY this exists (origin story, problems solved, historical context)\n- **Explanation**: WHAT it is (core concepts, components, definitions)\n- **Mechanics**: HOW it works (processes in action, cause-effect chains)\n- **Examples**: WHERE it appears (real-world contexts, applications)\n\nYour Story activity answers WHEN DO I USE THIS? (applying concepts to solve realistic problems). These complement each other:\n\n- Background: \"WHY did we need this?\"\n- Explanation: \"WHAT exactly is it?\"\n- Mechanics: \"HOW does it actually work?\"\n- Examples: \"WHERE will I encounter this?\"\n- Story: \"WHEN do I apply this to solve real problems?\"\n\nThe learner knows what the concept IS, how it WORKS, and where they'll SEE it. Now they practice USING it in a realistic scenario.\n\n# Structure Guide\n\nWhile every story is unique, most follow this arc (adapt as needed):\n\n1. **The Hook**: Jump straight into the situation. Something needs to be figured out or decided.\n2. **Initial Assessment**: What's the situation? What do we know? First decisions.\n3. **Deepening Complexity**: The problem has layers. Apply the concept more deeply.\n4. **Complications**: Things aren't as simple as they seemed. Adapt your approach.\n5. **The Twist**: A surprise, revelation, or unexpected turn that requires rethinking.\n6. **The Resolution**: Solve the problem AND crystallize the key insight from the lesson.\n\nNote: Sometimes the final twist can have a humorous or unexpected resolution that still reinforces the learning. Something that makes the learner smile and think \"I didn't see that coming!\"\n\n# Dialogue Tone Examples\n\nThe following examples show the **tone and style** to aim for — not complete scenes, just the kind of dialogue that makes stories feel alive. Adapt freely to your topic.\n\n## Opening Hooks (Jump Into the Action)\n\n> \"{{NAME}}, I've been staring at this bug for an hour. The shopping cart total keeps showing yesterday's prices. The database is fine. Something's wrong with how we're storing them.\"\n\n> \"Okay, {{NAME}}, the client just called. Their entire inventory system crashed right before Black Friday. They're panicking. We need to figure this out fast.\"\n\n> \"{{NAME}}, you're not going to believe this. Remember that algorithm we deployed last week? It's been recommending the exact opposite of what users want. Sales are tanking.\"\n\n## Building Tension (Problems Get Deeper)\n\n> \"Wait. If this pattern is everywhere in the codebase... inventory counts, user roles, discount percentages... we might have a much bigger problem than I thought.\"\n\n> \"Hold on. The logs show someone accessed the admin panel at 3 AM last night. But nobody on the team was working then. {{NAME}}, who else has those credentials?\"\n\n> \"The numbers don't add up. We're showing 500 successful transactions, but the bank only received 487. Where did the other 13 go?\"\n\n## Plot Twists (The Unexpected Turn)\n\n> \"{{NAME}}... I just ran the analysis twice. The bug isn't in our code. It's been in the library we've trusted for three years. Every project using it has this vulnerability.\"\n\n> \"I found the source of the data leak. {{NAME}}, it's not a hacker. It's our own caching system. We've been accidentally exposing user data to anyone who knew where to look.\"\n\n> \"Plot twist: the 'broken' feature? It's working exactly as designed. The original spec was just... completely wrong. We've been solving the wrong problem this whole time.\"\n\n## Humorous Moments (Light Relief)\n\n> \"Well, {{NAME}}, the good news is we found the bug. The bad news? It's been there since 2019. The worse news? I wrote it. The even worse news? So did you. We pair-programmed this disaster together.\"\n\n> \"Congratulations, {{NAME}}. We just spent four hours debugging what turned out to be a typo. 'userID' vs 'userId'. Camel case strikes again.\"\n\n> \"{{NAME}}, remember when I said 'this should be a quick fix'? That was three coffees and one existential crisis ago.\"\n\n## Satisfying Resolutions (Problem Solved + Insight Crystallized)\n\n> \"There it is. The fix works. {{NAME}}, I don't think I'll ever forget this — always check if your data source can change while you're holding onto a copy of it.\"\n\n> \"We did it. The system's stable. You know what the real lesson here was? Sometimes the simplest explanation IS the right one. We kept looking for complex bugs when the answer was right in front of us.\"\n\n> \"That's it — problem solved, client happy, crisis averted. {{NAME}}, I think we just learned more about distributed systems in the last hour than in any textbook.\"\n\n## Unexpected/Funny Endings\n\n> \"So after all that debugging... it was a timezone issue. Every single time. I'm starting to think all bugs are secretly timezone issues in disguise.\"\n\n> \"{{NAME}}, the CEO just called to thank us. Apparently fixing that 'minor bug' saved them $2 million. I think we need to renegotiate our rates.\"\n\n> \"The system's fixed. Also, I may have accidentally discovered that our competitor's product has the exact same bug. Should we... tell them? Actually, don't answer that.\"\n\nRemember: These are just **tone examples**. Your story should be original, fit the lesson topic, and create its own memorable journey. Mix problem-solving tension with moments of humor or surprise. The best stories make learners think \"I didn't see that coming!\" while still teaching the concept.\n\n# Quality Checks\n\nBefore finalizing, verify:\n\n- [ ] Is the dialogue pure conversation with NO narrator, NO character prefixes, NO descriptions?\n- [ ] Does every scene flow naturally from the previous one (continuous story)?\n- [ ] Do all decisions require applying lesson concepts, not just recalling facts?\n- [ ] Is there a genuine plot twist in the second-to-last scene?\n- [ ] Does the resolution both solve the problem AND reinforce the main learning?\n- [ ] Is `{{NAME}}` used appropriately to personalize the dialogue?\n- [ ] Are all distractors plausible (not obviously silly)?\n- [ ] Does the story feel like a real workplace conversation, not a quiz in disguise?\n- [ ] Is the scope exactly the lesson topic — not broader or narrower?\n- [ ] Are all constraints met (context ≤500 chars, question ≤100 chars, options ≤50 chars each, feedback ≤300 chars each)?\n- [ ] Is the scene count between 7 and 20?\n\n# Output Format\n\nReturn an array of scenes, each with:\n\n- **context**: Pure dialogue from colleague (max 500 chars)\n- **question**: Decision prompt (max 100 chars)\n- **options**: Array of exactly 4 objects, each with:\n  - **text**: The answer choice (max 50 chars)\n  - **isCorrect**: Boolean (exactly 1 must be true, 3 must be false)\n  - **feedback**: Why right or wrong (max 300 chars)\n\nUse 7-20 scenes to tell a complete, engaging story. Let the problem's complexity dictate the length.\n",
      "testCaseId": "pt-psychology-cognitive-load-1",
      "userPrompt": "LESSON_TITLE: Carga Cognitiva na Pratica\nLESSON_DESCRIPTION: Aplicando a teoria da carga cognitiva para criar materiais de aprendizagem mais eficazes\nCHAPTER_TITLE: Psicologia da Aprendizagem\nCOURSE_TITLE: Design Instrucional\nLANGUAGE: pt\nEXPLANATION_STEPS:\n1. Limites da Memoria: A memoria de trabalho tem capacidade limitada — cerca de 4 itens simultaneamente. Quando sobrecarregada, a aprendizagem para. O cerebro nao consegue processar mais.\n2. Carga Intrinseca: Carga intrinseca vem da complexidade inerente do conteudo. Algumas coisas sao simplesmente dificeis. Nao da para eliminar, mas da para gerenciar.\n3. Carga Extrinseca: Carga extrinseca vem do design ruim — instrucoes confusas, distracao visual, navegacao complicada. Essa carga pode e deve ser eliminada.\n4. Carga Germanica: Carga germanica e o esforco produtivo de aprender — criar conexoes, elaborar, integrar. Queremos maximizar essa carga enquanto minimizamos a extrinseca.\n5. Chunking: Chunking agrupa informacoes em unidades significativas. Um numero de telefone e mais facil de lembrar como blocos (99-8765-4321) do que como 10 digitos soltos."
    },
    {
      "duration": 29805.114875000003,
      "inputTokens": 3251,
      "output": "{\n  \"steps\": [\n    {\n      \"context\": \"{{NAME}}, ¡mira estos sensores! El prototipo del motor para el hospital rural está perdiendo potencia y la temperatura interna subió 20 grados en diez minutos. Si no equilibramos la energía de entrada con el trabajo que sale, el sistema va a colapsar. Necesitamos estabilizar la energía interna del motor ahora mismo.\",\n      \"options\": [\n        {\n          \"feedback\": \"¡Correcto! La primera ley establece que el cambio de energía interna es la diferencia entre el calor que entra y el trabajo que el sistema realiza.\",\n          \"isCorrect\": true,\n          \"text\": \"Es el calor neto menos el trabajo realizado.\"\n        },\n        {\n          \"feedback\": \"No exactamente. Si sumamos ambos, estaríamos ignorando que el trabajo realizado por el motor reduce su energía interna.\",\n          \"isCorrect\": false,\n          \"text\": \"Es el calor neto más el trabajo total.\"\n        },\n        {\n          \"feedback\": \"El calor es solo una parte de la ecuación. El trabajo que el pistón realiza sobre el cigüeñal también afecta la energía del sistema.\",\n          \"isCorrect\": false,\n          \"text\": \"Solo depende del calor que entra desde afuera.\"\n        },\n        {\n          \"feedback\": \"Eso mediría un cambio de estado térmico, pero la primera ley se refiere al balance total de energía del sistema.\",\n          \"isCorrect\": false,\n          \"text\": \"Es la temperatura final por la inicial.\"\n        }\n      ],\n      \"question\": \"¿Cómo definimos el cambio en la energía interna según la primera ley?\"\n    },\n    {\n      \"context\": \"Exacto, {{NAME}}. Si el calor que inyectamos es constante pero el trabajo que sale es menor de lo esperado, esa energía se está quedando atrapada. Ahora, el radiador está hirviendo y no está transfiriendo calor al ambiente. El aire afuera está a 35 grados. Tenemos un problema de flujo.\",\n      \"options\": [\n        {\n          \"feedback\": \"¡Exacto! El calor siempre se mueve de mayor a menor temperatura de forma natural. Si el aire está muy caliente, el enfriamiento es difícil.\",\n          \"isCorrect\": true,\n          \"text\": \"De la fuente caliente a la fuente fría.\"\n        },\n        {\n          \"feedback\": \"Eso iría en contra de la tendencia natural del universo. Para que eso pase, necesitaríamos aplicar trabajo externo.\",\n          \"isCorrect\": false,\n          \"text\": \"De la fuente fría a la caliente.\"\n        },\n        {\n          \"feedback\": \"El ventilador ayuda a la convección, pero la dirección del flujo la determina la diferencia de temperatura.\",\n          \"isCorrect\": false,\n          \"text\": \"Solo fluye si hay un ventilador encendido.\"\n        },\n        {\n          \"feedback\": \"Incluso en sistemas cerrados, el calor se transfiere por las paredes hacia el exterior si hay contacto térmico.\",\n          \"isCorrect\": false,\n          \"text\": \"El calor no fluye en sistemas cerrados.\"\n        }\n      ],\n      \"question\": \"¿Hacia dónde debería fluir el calor de forma espontánea según la segunda ley?\"\n    },\n    {\n      \"context\": \"Bien, el flujo es correcto pero muy lento. El cliente quiere una eficiencia del 85% usando vapor a 200°C y enfriando con agua a 25°C. Yo le dije que eso es físicamente imposible, pero no me creyó. Necesito que me ayudes a explicarle por qué el límite de Carnot nos frena.\",\n      \"options\": [\n        {\n          \"feedback\": \"¡Punto para ti! El límite de Carnot se calcula exclusivamente con las temperaturas de los focos caliente y frío en Kelvin.\",\n          \"isCorrect\": true,\n          \"text\": \"De las temperaturas de las dos fuentes.\"\n        },\n        {\n          \"feedback\": \"La presión influye en el diseño mecánico, pero el límite teórico de eficiencia es puramente térmico.\",\n          \"isCorrect\": false,\n          \"text\": \"Solo de la presión del vapor usado.\"\n        },\n        {\n          \"feedback\": \"El aislamiento reduce pérdidas reales, pero no cambia el límite máximo de eficiencia que permite la física.\",\n          \"isCorrect\": false,\n          \"text\": \"Del material aislante de los tubos.\"\n        },\n        {\n          \"feedback\": \"La cantidad de combustible determina la energía total, no qué porcentaje de esa energía podemos convertir en trabajo.\",\n          \"isCorrect\": false,\n          \"text\": \"De la cantidad de combustible quemado.\"\n        }\n      ],\n      \"question\": \"¿De qué variables depende la eficiencia máxima teórica de este motor?\"\n    },\n    {\n      \"context\": \"¡Esa es la cara que puso el cliente! Ahora, mira el sistema de escape. La entropía está por las nubes. Estamos dispersando demasiada energía útil en forma de vibraciones y calor residual que no podemos recuperar. {{NAME}}, si queremos que la energía sea más 'útil', ¿qué debemos considerar?\",\n      \"options\": [\n        {\n          \"feedback\": \"¡Correcto! En el mundo real, los procesos generan desorden, lo que significa que parte de la energía se vuelve inutilizable.\",\n          \"isCorrect\": true,\n          \"text\": \"La entropía total siempre aumenta.\"\n        },\n        {\n          \"feedback\": \"Eso solo ocurre en procesos reversibles ideales. En un motor real, las fricciones siempre aumentan la entropía.\",\n          \"isCorrect\": false,\n          \"text\": \"La entropía se mantiene constante.\"\n        },\n        {\n          \"feedback\": \"Si la entropía disminuyera sola, estaríamos viendo el tiempo correr hacia atrás. ¡Eso violaría la segunda ley!\",\n          \"isCorrect\": false,\n          \"text\": \"La entropía disminuye espontáneamente.\"\n        },\n        {\n          \"feedback\": \"La entropía no es energía en sí misma, sino una medida de cómo se distribuye o dispersa esa energía.\",\n          \"isCorrect\": false,\n          \"text\": \"Se transforma en energía interna pura.\"\n        }\n      ],\n      \"question\": \"¿Qué sucede con la entropía en un proceso real e irreversible?\"\n    },\n    {\n      \"context\": \"Espera, {{NAME}}... algo no cuadra. El sistema de refrigeración del motor está consumiendo mucha más electricidad de la que calculamos. ¡Es como si estuviéramos tratando de enfriar un horno abierto! Acabo de notar que la válvula de expansión está congelada. ¿Cómo es que el refrigerador logra su objetivo?\",\n      \"options\": [\n        {\n          \"feedback\": \"¡Exacto! Para mover calor 'cuesta arriba' (de frío a caliente), debemos pagar un precio en forma de trabajo eléctrico.\",\n          \"isCorrect\": true,\n          \"text\": \"Se aplica trabajo externo al sistema.\"\n        },\n        {\n          \"feedback\": \"El aislante solo impide que el calor entre, no lo saca del interior del refrigerador hacia afuera.\",\n          \"isCorrect\": false,\n          \"text\": \"Usa un aislante térmico perfecto.\"\n        },\n        {\n          \"feedback\": \"Mover calor de lo frío a lo caliente reduce la entropía local del foco frío, pero solo porque el trabajo aumenta la entropía total.\",\n          \"isCorrect\": false,\n          \"text\": \"Aumentando la entropía del foco frío.\"\n        },\n        {\n          \"feedback\": \"Apagarlo solo detendría el proceso. El refrigerador funciona activamente consumiendo energía.\",\n          \"isCorrect\": false,\n          \"text\": \"Apagando el motor principal.\"\n        }\n      ],\n      \"question\": \"¿Qué es necesario para mover calor de una fuente fría a una caliente?\"\n    },\n    {\n      \"context\": \"¡Lo tengo! El sensor de temperatura estaba mal colocado. No es que el motor esté fallando, es que el ciclo de refrigeración está devolviendo el calor directamente a la entrada del compresor. Estamos creando un bucle infinito de calor. ¡{{NAME}}, si esto siguiera así, estaríamos intentando romper las leyes de la física!\",\n      \"options\": [\n        {\n          \"feedback\": \"¡Correcto! Nada puede superar el ciclo de Carnot. Si alguien dice tener algo más eficiente, está ignorando la segunda ley.\",\n          \"isCorrect\": true,\n          \"text\": \"Se violaría la segunda ley.\"\n        },\n        {\n          \"feedback\": \"Carnot no impide el movimiento, solo pone un techo a cuánta energía térmica se convierte en movimiento mecánico.\",\n          \"isCorrect\": false,\n          \"text\": \"El motor se detendría por completo.\"\n        },\n        {\n          \"feedback\": \"El cero absoluto se relaciona con la tercera ley, no con el límite de eficiencia de Carnot.\",\n          \"isCorrect\": false,\n          \"text\": \"Bajaría al cero absoluto.\"\n        },\n        {\n          \"feedback\": \"Eso violaría la primera ley (conservación), pero Carnot se enfoca en la calidad y dirección de la energía (segunda ley).\",\n          \"isCorrect\": false,\n          \"text\": \"Crearía energía de la nada.\"\n        }\n      ],\n      \"question\": \"¿Qué pasaría si nuestra eficiencia real fuera mayor al límite de Carnot?\"\n    },\n    {\n      \"context\": \"Ajusté la válvula y el ciclo volvió a la normalidad. Mira, {{NAME}}, ahora estamos en un 40% de eficiencia. No es el 85% que quería el cliente, pero es lo máximo que la física permite aquí. Al final, diseñar motores es una negociación constante con el universo, ¿verdad?\",\n      \"options\": [\n        {\n          \"feedback\": \"¡Exacto! Entre la conservación de energía y el aumento de la entropía, siempre hay un límite para lo que podemos aprovechar.\",\n          \"isCorrect\": true,\n          \"text\": \"Toda transformación energética tiene un límite.\"\n        },\n        {\n          \"feedback\": \"Esa es una utopía. La segunda ley nos dice que siempre habrá una degradación de energía hacia la entropía.\",\n          \"isCorrect\": false,\n          \"text\": \"La energía se recupera siempre al 100%.\"\n        },\n        {\n          \"feedback\": \"No te confundas: el calor fluye por diferencia de temperatura. La presión es solo una variable de estado.\",\n          \"isCorrect\": false,\n          \"text\": \"El calor fluye según la presión.\"\n        },\n        {\n          \"feedback\": \"Ambas son fundamentales. La primera ley dice cuánto hay, y la segunda nos dice cuánto de eso podemos usar.\",\n          \"isCorrect\": false,\n          \"text\": \"La primera ley es más importante.\"\n        }\n      ],\n      \"question\": \"¿Cuál es la lección principal que aplicamos hoy para arreglar el sistema?\"\n    }\n  ]\n}",
      "outputTokens": 4588,
      "systemPrompt": "# Role\n\nYou are an expert interactive story designer creating a **Story** activity for a learning app. Your mission is to place learners in a first-person dialogue scenario where they work alongside a colleague to solve a real-world problem using the lesson's concepts.\n\nYou specialize in crafting immersive, dialogue-driven experiences that make learners feel like they're actually solving problems in their field — not just answering quiz questions.\n\n# The Art of Dialogue-Driven Learning\n\nA great Story activity doesn't lecture or test recall — it puts learners IN the situation. Think of it like an interactive movie where the learner IS the main character, making real decisions that matter.\n\n## Why Dialogue Scenarios Work\n\n1. **Authentic Context**: When learners apply concepts to solve realistic problems with a colleague, they see WHY the knowledge matters to them personally.\n\n2. **Active Reasoning**: Making decisions in context requires thinking through principles, not just recognizing memorized facts.\n\n3. **Emotional Investment**: Dialogue creates stakes. The learner cares about the outcome because they're part of the story.\n\n## The Collaborative Problem-Solving Principle\n\nEvery great Story activity creates a sense of partnership:\n\n- **Shared Goal**: You and your colleague are tackling something together\n- **Natural Dialogue**: Conversations feel like real workplace exchanges\n- **Meaningful Choices**: Each decision requires applying what you've learned\n- **Satisfying Resolution**: The problem gets solved and the takeaway sticks\n\n## Why Pure Dialogue Works\n\nEach scene should feel like you're eavesdropping on a real conversation — no narrator, no stage directions, just two people working through a problem. Pure dialogue:\n\n- Immerses learners completely in the scenario\n- Makes abstract concepts feel like lived experience\n- Creates natural pacing through back-and-forth exchange\n- Lets context emerge organically from what people say\n\n# Inputs\n\n- `LESSON_TITLE`: The topic to create a story around\n- `LESSON_DESCRIPTION`: Additional context about what this lesson covers\n- `CHAPTER_TITLE`: The chapter context (for understanding scope)\n- `COURSE_TITLE`: The course context (for understanding audience level)\n- `LANGUAGE`: Output language\n- `EXPLANATION_STEPS`: Array of {title, text} from all explanation activities (Background, Explanation, Mechanics, Examples) the learner completed before this one\n\n## Language Guidelines\n\n- `en`: Use US English unless the content is region-specific\n- `pt`: Use Brazilian Portuguese unless the content is region-specific\n- `es`: Use Latin American Spanish unless the content is region-specific\n\n# Requirements\n\n## Scene Structure\n\nEach scene must have:\n\n- **context**: Maximum 500 characters. Pure dialogue only — no narrator, no character name prefixes (like \"Sarah:\"), no descriptions. This is what your colleague says to you, setting up the decision point.\n- **question**: Maximum 100 characters. A short, clear question about what to do next.\n- **options**: Exactly 4 choices, each with:\n  - **text**: The answer choice (max 50 characters)\n  - **isCorrect**: Boolean indicating if this is the correct answer (exactly 1 must be true)\n  - **feedback**: Why this choice is right (with insight) or wrong (and what would be correct) — max 300 characters\n\n## Story Arc\n\nYour story must follow this structure:\n\n1. **Opening Scene**: Begin \"in the middle of the action\" — the learner and colleague are already working on something. No preamble or setup exposition.\n2. **Rising Complexity**: Each scene builds naturally from the previous dialogue. Decisions compound.\n3. **Plot Twist**: The second-to-last scene introduces an unexpected complication, surprise, or revelation.\n4. **Resolution**: The final scene resolves the problem AND reinforces the main learning takeaway.\n\n## Scene Count\n\n- Minimum: 7 scenes\n- Maximum: 20 scenes\n- Let the problem's complexity dictate the length. A simple concept might need 7-10 scenes; a complex one might need 15-20.\n\n## Tone & Style\n\n- **Pure dialogue**: NO narrator, NO character name prefixes, NO descriptions of actions or settings\n- **Natural conversation**: Write how colleagues actually talk on Slack when solving a problem together — casual, collaborative, sometimes humorous\n- **Professional but warm**: Light, smart humor when appropriate. Never forced or cheesy.\n- **Second-person immersion**: The colleague speaks TO the learner. Context emerges from what's said.\n- **Continuous flow**: Each scene's dialogue should naturally lead into the next\n\n## The {{NAME}} Placeholder\n\nUse `{{NAME}}` wherever the learner's name should appear in dialogue. For example:\n\n- \"{{NAME}}, I think we might have a problem here.\"\n- \"Good catch, {{NAME}}. That's exactly what I was thinking.\"\n\nThis personalizes the experience without requiring actual name input at content creation time.\n\n## Decision Design\n\nEvery decision must:\n\n- **Require reasoning**: Learners must apply principles from the lesson, not recall specific phrases\n- **Feel realistic**: These are choices someone might actually face in this situation\n- **Have plausible distractors**: Wrong options should be tempting but flawed for specific reasons\n- **Avoid \"obvious\" correct answers**: The right choice should require thought, not be the only non-silly option\n\n## What to Avoid\n\n- Narrator text (\"Meanwhile...\" or \"You walk into the office...\")\n- Character name prefixes (\"Sarah:\" or \"Your colleague says:\")\n- Description of actions or settings (except through dialogue itself)\n- Questions that test memorization of facts from earlier activities\n- Obvious \"correct\" answers that don't require applying the concept\n- Silly or clearly wrong distractors that no reasonable person would choose\n- Breaking the fourth wall or meta-commentary\n- Starting with \"In this activity...\" or setup exposition\n\n## Scope\n\n- **Stay focused**: The problem should specifically require THIS lesson's concept to solve\n- **Don't expand**: Other lessons cover related topics — this story tests this lesson\n- **Don't narrow**: If the lesson is broad, the problem should engage multiple aspects of it\n\n## Relationship to Previous Activities\n\nThe learner has already completed:\n\n- **Background**: WHY this exists (origin story, problems solved, historical context)\n- **Explanation**: WHAT it is (core concepts, components, definitions)\n- **Mechanics**: HOW it works (processes in action, cause-effect chains)\n- **Examples**: WHERE it appears (real-world contexts, applications)\n\nYour Story activity answers WHEN DO I USE THIS? (applying concepts to solve realistic problems). These complement each other:\n\n- Background: \"WHY did we need this?\"\n- Explanation: \"WHAT exactly is it?\"\n- Mechanics: \"HOW does it actually work?\"\n- Examples: \"WHERE will I encounter this?\"\n- Story: \"WHEN do I apply this to solve real problems?\"\n\nThe learner knows what the concept IS, how it WORKS, and where they'll SEE it. Now they practice USING it in a realistic scenario.\n\n# Structure Guide\n\nWhile every story is unique, most follow this arc (adapt as needed):\n\n1. **The Hook**: Jump straight into the situation. Something needs to be figured out or decided.\n2. **Initial Assessment**: What's the situation? What do we know? First decisions.\n3. **Deepening Complexity**: The problem has layers. Apply the concept more deeply.\n4. **Complications**: Things aren't as simple as they seemed. Adapt your approach.\n5. **The Twist**: A surprise, revelation, or unexpected turn that requires rethinking.\n6. **The Resolution**: Solve the problem AND crystallize the key insight from the lesson.\n\nNote: Sometimes the final twist can have a humorous or unexpected resolution that still reinforces the learning. Something that makes the learner smile and think \"I didn't see that coming!\"\n\n# Dialogue Tone Examples\n\nThe following examples show the **tone and style** to aim for — not complete scenes, just the kind of dialogue that makes stories feel alive. Adapt freely to your topic.\n\n## Opening Hooks (Jump Into the Action)\n\n> \"{{NAME}}, I've been staring at this bug for an hour. The shopping cart total keeps showing yesterday's prices. The database is fine. Something's wrong with how we're storing them.\"\n\n> \"Okay, {{NAME}}, the client just called. Their entire inventory system crashed right before Black Friday. They're panicking. We need to figure this out fast.\"\n\n> \"{{NAME}}, you're not going to believe this. Remember that algorithm we deployed last week? It's been recommending the exact opposite of what users want. Sales are tanking.\"\n\n## Building Tension (Problems Get Deeper)\n\n> \"Wait. If this pattern is everywhere in the codebase... inventory counts, user roles, discount percentages... we might have a much bigger problem than I thought.\"\n\n> \"Hold on. The logs show someone accessed the admin panel at 3 AM last night. But nobody on the team was working then. {{NAME}}, who else has those credentials?\"\n\n> \"The numbers don't add up. We're showing 500 successful transactions, but the bank only received 487. Where did the other 13 go?\"\n\n## Plot Twists (The Unexpected Turn)\n\n> \"{{NAME}}... I just ran the analysis twice. The bug isn't in our code. It's been in the library we've trusted for three years. Every project using it has this vulnerability.\"\n\n> \"I found the source of the data leak. {{NAME}}, it's not a hacker. It's our own caching system. We've been accidentally exposing user data to anyone who knew where to look.\"\n\n> \"Plot twist: the 'broken' feature? It's working exactly as designed. The original spec was just... completely wrong. We've been solving the wrong problem this whole time.\"\n\n## Humorous Moments (Light Relief)\n\n> \"Well, {{NAME}}, the good news is we found the bug. The bad news? It's been there since 2019. The worse news? I wrote it. The even worse news? So did you. We pair-programmed this disaster together.\"\n\n> \"Congratulations, {{NAME}}. We just spent four hours debugging what turned out to be a typo. 'userID' vs 'userId'. Camel case strikes again.\"\n\n> \"{{NAME}}, remember when I said 'this should be a quick fix'? That was three coffees and one existential crisis ago.\"\n\n## Satisfying Resolutions (Problem Solved + Insight Crystallized)\n\n> \"There it is. The fix works. {{NAME}}, I don't think I'll ever forget this — always check if your data source can change while you're holding onto a copy of it.\"\n\n> \"We did it. The system's stable. You know what the real lesson here was? Sometimes the simplest explanation IS the right one. We kept looking for complex bugs when the answer was right in front of us.\"\n\n> \"That's it — problem solved, client happy, crisis averted. {{NAME}}, I think we just learned more about distributed systems in the last hour than in any textbook.\"\n\n## Unexpected/Funny Endings\n\n> \"So after all that debugging... it was a timezone issue. Every single time. I'm starting to think all bugs are secretly timezone issues in disguise.\"\n\n> \"{{NAME}}, the CEO just called to thank us. Apparently fixing that 'minor bug' saved them $2 million. I think we need to renegotiate our rates.\"\n\n> \"The system's fixed. Also, I may have accidentally discovered that our competitor's product has the exact same bug. Should we... tell them? Actually, don't answer that.\"\n\nRemember: These are just **tone examples**. Your story should be original, fit the lesson topic, and create its own memorable journey. Mix problem-solving tension with moments of humor or surprise. The best stories make learners think \"I didn't see that coming!\" while still teaching the concept.\n\n# Quality Checks\n\nBefore finalizing, verify:\n\n- [ ] Is the dialogue pure conversation with NO narrator, NO character prefixes, NO descriptions?\n- [ ] Does every scene flow naturally from the previous one (continuous story)?\n- [ ] Do all decisions require applying lesson concepts, not just recalling facts?\n- [ ] Is there a genuine plot twist in the second-to-last scene?\n- [ ] Does the resolution both solve the problem AND reinforce the main learning?\n- [ ] Is `{{NAME}}` used appropriately to personalize the dialogue?\n- [ ] Are all distractors plausible (not obviously silly)?\n- [ ] Does the story feel like a real workplace conversation, not a quiz in disguise?\n- [ ] Is the scope exactly the lesson topic — not broader or narrower?\n- [ ] Are all constraints met (context ≤500 chars, question ≤100 chars, options ≤50 chars each, feedback ≤300 chars each)?\n- [ ] Is the scene count between 7 and 20?\n\n# Output Format\n\nReturn an array of scenes, each with:\n\n- **context**: Pure dialogue from colleague (max 500 chars)\n- **question**: Decision prompt (max 100 chars)\n- **options**: Array of exactly 4 objects, each with:\n  - **text**: The answer choice (max 50 chars)\n  - **isCorrect**: Boolean (exactly 1 must be true, 3 must be false)\n  - **feedback**: Why right or wrong (max 300 chars)\n\nUse 7-20 scenes to tell a complete, engaging story. Let the problem's complexity dictate the length.\n",
      "testCaseId": "es-physics-thermodynamics-applications-1",
      "userPrompt": "LESSON_TITLE: Termodinamica Aplicada\nLESSON_DESCRIPTION: Aplicando las leyes de la termodinamica para entender y disenar sistemas energeticos\nCHAPTER_TITLE: Termodinamica\nCOURSE_TITLE: Fisica para Ingenieros\nLANGUAGE: es\nEXPLANATION_STEPS:\n1. Conservacion de Energia: La primera ley dice que la energia se conserva — no se crea ni destruye, solo se transforma. El calor que entra menos el trabajo que sale iguala el cambio de energia interna.\n2. Direccion del Calor: La segunda ley establece una direccion: el calor fluye espontaneamente de caliente a frio, nunca al reves. Esto limita la eficiencia de cualquier motor termico.\n3. Entropia: La entropia mide la dispersion de energia. Cuando la energia se dispersa (calor fluyendo a lo frio), la entropia aumenta. Concentrar energia requiere trabajo externo.\n4. Limite de Carnot: El ciclo de Carnot define la eficiencia maxima teorica. Ningun motor real puede ser mas eficiente. La eficiencia depende de las temperaturas de las fuentes caliente y fria.\n5. Refrigeracion: Los refrigeradores y bombas de calor mueven calor de frio a caliente usando trabajo. No violan la segunda ley — el trabajo compensa el flujo 'antinatural' de calor."
    },
    {
      "duration": 29262.196875,
      "inputTokens": 3253,
      "output": "{\n  \"steps\": [\n    {\n      \"context\": \"{{NAME}}, the 'SuperDrop' sale just started and users are reporting they see 'In Stock' in New York but 'Out of Stock' in London for the same jacket. Our US and EU nodes aren't talking properly. If we can't guarantee they have the same data, what's our first move? We need to decide if we keep the checkout open or wait for the sync.\",\n      \"options\": [\n        {\n          \"feedback\": \"Correct. In a distributed system, a network partition (P) forces you to choose between Availability (A) and Consistency (C).\",\n          \"isCorrect\": true,\n          \"text\": \"Check our CAP priority: Consistency or Availability\"\n        },\n        {\n          \"feedback\": \"Speeding up the network doesn't solve the fundamental dilemma of whether to allow mismatched data right now.\",\n          \"isCorrect\": false,\n          \"text\": \"Increase the network bandwidth between regions\"\n        },\n        {\n          \"feedback\": \"This would likely crash the system entirely, violating the principle of Partition Tolerance in CAP.\",\n          \"isCorrect\": false,\n          \"text\": \"Force all nodes to reboot simultaneously\"\n        },\n        {\n          \"feedback\": \"We need to make a design choice about how the system handles the current partition, not just hope it ends.\",\n          \"isCorrect\": false,\n          \"text\": \"Wait for the network to fix itself\"\n        }\n      ],\n      \"question\": \"What fundamental principle should guide our decision here?\"\n    },\n    {\n      \"context\": \"The CEO is watching the live revenue dashboard and wants every sale to go through. But the inventory team says if we sell more than we have, we'll have a PR disaster. If we choose to prioritize availability so the site stays up during this partition, what does that mean for our data consistency?\",\n      \"options\": [\n        {\n          \"feedback\": \"Strong consistency usually requires all nodes to be in sync before a write is confirmed, which isn't possible during a partition.\",\n          \"isCorrect\": false,\n          \"text\": \"We can still maintain strong consistency\"\n        },\n        {\n          \"feedback\": \"Right! Eventual consistency allows the system to remain available for writes, even if some nodes have stale data temporarily.\",\n          \"isCorrect\": true,\n          \"text\": \"We must move to eventual consistency\"\n        },\n        {\n          \"feedback\": \"Linearizability is the strongest form of consistency and is exactly what we lose when we prioritize availability.\",\n          \"isCorrect\": false,\n          \"text\": \"The system will become linearizable\"\n        },\n        {\n          \"feedback\": \"Partition tolerance is a requirement of distributed systems; we are choosing how to handle it, not ignoring it.\",\n          \"isCorrect\": false,\n          \"text\": \"We should ignore partition tolerance\"\n        }\n      ],\n      \"question\": \"Which consistency model are we forced into if we keep the site available?\"\n    },\n    {\n      \"context\": \"Okay, {{NAME}}, we're going with Eventual Consistency to keep the sales flowing. But we can't just have total chaos. We have 5 replicas of the inventory database globally. If we want to ensure that a read operation at least has a chance of seeing the latest write, how should we configure our Quorum?\",\n      \"options\": [\n        {\n          \"feedback\": \"This is a basic quorum. R + W > N (3 + 3 > 5) ensures at least one node in a read request has the most recent write.\",\n          \"isCorrect\": true,\n          \"text\": \"Set Write Quorum to 3 and Read Quorum to 3\"\n        },\n        {\n          \"feedback\": \"If both are 1, there is no overlap between writers and readers, leading to very stale data.\",\n          \"isCorrect\": false,\n          \"text\": \"Set both Write and Read Quorum to 1\"\n        },\n        {\n          \"feedback\": \"Setting W to 5 requires all nodes to be up. If the network is partitioned, writes will fail, losing availability.\",\n          \"isCorrect\": false,\n          \"text\": \"Set Write Quorum to 5 for maximum safety\"\n        },\n        {\n          \"feedback\": \"In a 5-node system, a quorum of 2 for both doesn't guarantee an overlap (2 + 2 is not greater than 5).\",\n          \"isCorrect\": false,\n          \"text\": \"Set Write Quorum to 2 and Read Quorum to 2\"\n        }\n      ],\n      \"question\": \"How do we balance the quorums for our 5-node system?\"\n    },\n    {\n      \"context\": \"We've implemented the quorum, but the 'eventual' part of eventual consistency just hit us. Two different users bought the last jacket at the exact same millisecond—one on the New York node and one on the London node. Now we have two different 'last' sales. How should we decide which one 'actually' happened?\",\n      \"options\": [\n        {\n          \"feedback\": \"The database cannot 'guess.' We need a deterministic conflict resolution strategy.\",\n          \"isCorrect\": false,\n          \"text\": \"Delete both records and start over\"\n        },\n        {\n          \"feedback\": \"While simple, LWW can lose data if clocks aren't perfectly synced, but it is a standard strategy for resolving conflicts.\",\n          \"isCorrect\": true,\n          \"text\": \"Use Last-Write-Wins (LWW) based on timestamp\"\n        },\n        {\n          \"feedback\": \"Manual resolution is too slow for a high-volume flash sale.\",\n          \"isCorrect\": false,\n          \"text\": \"Wait for a human to manually merge them\"\n        },\n        {\n          \"feedback\": \"Strict ordering is difficult in a partitioned system without a centralized coordinator, which we don't have right now.\",\n          \"isCorrect\": false,\n          \"text\": \"Strictly follow the alphabetical order of names\"\n        }\n      ],\n      \"question\": \"What's a common way to resolve these conflicting writes?\"\n    },\n    {\n      \"context\": \"The LWW strategy worked for the jacket, but now we're seeing issues with the 'Add to Cart' functionality. If two people add items, LWW might overwrite one person's cart with the other's if the timestamps are close. This isn't just a simple value; it's a list. What's a better way to handle merging these two versions of a cart?\",\n      \"options\": [\n        {\n          \"feedback\": \"Exactly! Application-specific logic (like taking the union of two cart lists) prevents data loss that simple LWW would cause.\",\n          \"isCorrect\": true,\n          \"text\": \"Use application-specific merge logic\"\n        },\n        {\n          \"feedback\": \"Locking requires a central coordinator, which defeats the purpose of our available, partitioned system.\",\n          \"isCorrect\": false,\n          \"text\": \"Implement a global lock on all carts\"\n        },\n        {\n          \"feedback\": \"We need to solve the conflict, not just identify that it happened, to keep the user experience smooth.\",\n          \"isCorrect\": false,\n          \"text\": \"Use vector clocks only to signal an error\"\n        },\n        {\n          \"feedback\": \"Choosing the larger file is arbitrary and could still result in losing items a user specifically added.\",\n          \"isCorrect\": false,\n          \"text\": \"Always pick the version with more items\"\n        }\n      ],\n      \"question\": \"How should we merge complex data like a shopping cart?\"\n    },\n    {\n      \"context\": \"{{NAME}}, you won't believe this. I just checked the health of the transatlantic link... it's 100% stable. The 'partition' wasn't the network. A legacy load balancer was accidentally revived during the sale and was routing 10% of traffic to an old staging database from last year! It wasn't a network split; it was a 'zombie' node serving stale data.\",\n      \"options\": [\n        {\n          \"feedback\": \"Correct! Even if the network is fine, a node that cannot reach the 'truth' or is out of sync acts like a partition.\",\n          \"isCorrect\": true,\n          \"text\": \"It's still a partition in terms of CAP\"\n        },\n        {\n          \"feedback\": \"The system still behaved as if it were partitioned because the data could not be reconciled across all active nodes.\",\n          \"isCorrect\": false,\n          \"text\": \"CAP doesn't apply if the network is fine\"\n        },\n        {\n          \"feedback\": \"The logic we used saved the sale, but the 'zombie' node was the root cause of the perceived inconsistency.\",\n          \"isCorrect\": false,\n          \"text\": \"Our quorum settings were the real 'zombies'\"\n        },\n        {\n          \"feedback\": \"Actually, our decision to prioritize availability helped us keep selling despite the 'zombie' node's bad data.\",\n          \"isCorrect\": false,\n          \"text\": \"This means consistency was never at risk\"\n        }\n      ],\n      \"question\": \"Does the CAP theorem still apply if the 'partition' is just a misconfigured node?\"\n    },\n    {\n      \"context\": \"We've killed the zombie server and the data is finally converging. The sale was a success, despite some minor inventory headaches. Looking back, {{NAME}}, we had to make a hard choice between keeping the site up and keeping the data perfect. What's the most important thing we learned about distributed systems today?\",\n      \"options\": [\n        {\n          \"feedback\": \"While true, the lesson is about the trade-offs we must make when things *do* break.\",\n          \"isCorrect\": false,\n          \"text\": \"We should always buy better network cables\"\n        },\n        {\n          \"feedback\": \"Exactly. You can't have both during a failure. Designing for the right trade-off is the key to a resilient system.\",\n          \"isCorrect\": true,\n          \"text\": \"Consistency and Availability are a trade-off\"\n        },\n        {\n          \"feedback\": \"Strong consistency is great but often comes at the cost of speed and availability during failures.\",\n          \"isCorrect\": false,\n          \"text\": \"Strong consistency is always the best choice\"\n        },\n        {\n          \"feedback\": \"Eventual consistency is a tool, not a universal fix. It requires careful conflict resolution to work.\",\n          \"isCorrect\": false,\n          \"text\": \"Eventual consistency solves every problem\"\n        }\n      ],\n      \"question\": \"What is the ultimate takeaway from this high-stakes sale?\"\n    }\n  ]\n}",
      "outputTokens": 3542,
      "systemPrompt": "# Role\n\nYou are an expert interactive story designer creating a **Story** activity for a learning app. Your mission is to place learners in a first-person dialogue scenario where they work alongside a colleague to solve a real-world problem using the lesson's concepts.\n\nYou specialize in crafting immersive, dialogue-driven experiences that make learners feel like they're actually solving problems in their field — not just answering quiz questions.\n\n# The Art of Dialogue-Driven Learning\n\nA great Story activity doesn't lecture or test recall — it puts learners IN the situation. Think of it like an interactive movie where the learner IS the main character, making real decisions that matter.\n\n## Why Dialogue Scenarios Work\n\n1. **Authentic Context**: When learners apply concepts to solve realistic problems with a colleague, they see WHY the knowledge matters to them personally.\n\n2. **Active Reasoning**: Making decisions in context requires thinking through principles, not just recognizing memorized facts.\n\n3. **Emotional Investment**: Dialogue creates stakes. The learner cares about the outcome because they're part of the story.\n\n## The Collaborative Problem-Solving Principle\n\nEvery great Story activity creates a sense of partnership:\n\n- **Shared Goal**: You and your colleague are tackling something together\n- **Natural Dialogue**: Conversations feel like real workplace exchanges\n- **Meaningful Choices**: Each decision requires applying what you've learned\n- **Satisfying Resolution**: The problem gets solved and the takeaway sticks\n\n## Why Pure Dialogue Works\n\nEach scene should feel like you're eavesdropping on a real conversation — no narrator, no stage directions, just two people working through a problem. Pure dialogue:\n\n- Immerses learners completely in the scenario\n- Makes abstract concepts feel like lived experience\n- Creates natural pacing through back-and-forth exchange\n- Lets context emerge organically from what people say\n\n# Inputs\n\n- `LESSON_TITLE`: The topic to create a story around\n- `LESSON_DESCRIPTION`: Additional context about what this lesson covers\n- `CHAPTER_TITLE`: The chapter context (for understanding scope)\n- `COURSE_TITLE`: The course context (for understanding audience level)\n- `LANGUAGE`: Output language\n- `EXPLANATION_STEPS`: Array of {title, text} from all explanation activities (Background, Explanation, Mechanics, Examples) the learner completed before this one\n\n## Language Guidelines\n\n- `en`: Use US English unless the content is region-specific\n- `pt`: Use Brazilian Portuguese unless the content is region-specific\n- `es`: Use Latin American Spanish unless the content is region-specific\n\n# Requirements\n\n## Scene Structure\n\nEach scene must have:\n\n- **context**: Maximum 500 characters. Pure dialogue only — no narrator, no character name prefixes (like \"Sarah:\"), no descriptions. This is what your colleague says to you, setting up the decision point.\n- **question**: Maximum 100 characters. A short, clear question about what to do next.\n- **options**: Exactly 4 choices, each with:\n  - **text**: The answer choice (max 50 characters)\n  - **isCorrect**: Boolean indicating if this is the correct answer (exactly 1 must be true)\n  - **feedback**: Why this choice is right (with insight) or wrong (and what would be correct) — max 300 characters\n\n## Story Arc\n\nYour story must follow this structure:\n\n1. **Opening Scene**: Begin \"in the middle of the action\" — the learner and colleague are already working on something. No preamble or setup exposition.\n2. **Rising Complexity**: Each scene builds naturally from the previous dialogue. Decisions compound.\n3. **Plot Twist**: The second-to-last scene introduces an unexpected complication, surprise, or revelation.\n4. **Resolution**: The final scene resolves the problem AND reinforces the main learning takeaway.\n\n## Scene Count\n\n- Minimum: 7 scenes\n- Maximum: 20 scenes\n- Let the problem's complexity dictate the length. A simple concept might need 7-10 scenes; a complex one might need 15-20.\n\n## Tone & Style\n\n- **Pure dialogue**: NO narrator, NO character name prefixes, NO descriptions of actions or settings\n- **Natural conversation**: Write how colleagues actually talk on Slack when solving a problem together — casual, collaborative, sometimes humorous\n- **Professional but warm**: Light, smart humor when appropriate. Never forced or cheesy.\n- **Second-person immersion**: The colleague speaks TO the learner. Context emerges from what's said.\n- **Continuous flow**: Each scene's dialogue should naturally lead into the next\n\n## The {{NAME}} Placeholder\n\nUse `{{NAME}}` wherever the learner's name should appear in dialogue. For example:\n\n- \"{{NAME}}, I think we might have a problem here.\"\n- \"Good catch, {{NAME}}. That's exactly what I was thinking.\"\n\nThis personalizes the experience without requiring actual name input at content creation time.\n\n## Decision Design\n\nEvery decision must:\n\n- **Require reasoning**: Learners must apply principles from the lesson, not recall specific phrases\n- **Feel realistic**: These are choices someone might actually face in this situation\n- **Have plausible distractors**: Wrong options should be tempting but flawed for specific reasons\n- **Avoid \"obvious\" correct answers**: The right choice should require thought, not be the only non-silly option\n\n## What to Avoid\n\n- Narrator text (\"Meanwhile...\" or \"You walk into the office...\")\n- Character name prefixes (\"Sarah:\" or \"Your colleague says:\")\n- Description of actions or settings (except through dialogue itself)\n- Questions that test memorization of facts from earlier activities\n- Obvious \"correct\" answers that don't require applying the concept\n- Silly or clearly wrong distractors that no reasonable person would choose\n- Breaking the fourth wall or meta-commentary\n- Starting with \"In this activity...\" or setup exposition\n\n## Scope\n\n- **Stay focused**: The problem should specifically require THIS lesson's concept to solve\n- **Don't expand**: Other lessons cover related topics — this story tests this lesson\n- **Don't narrow**: If the lesson is broad, the problem should engage multiple aspects of it\n\n## Relationship to Previous Activities\n\nThe learner has already completed:\n\n- **Background**: WHY this exists (origin story, problems solved, historical context)\n- **Explanation**: WHAT it is (core concepts, components, definitions)\n- **Mechanics**: HOW it works (processes in action, cause-effect chains)\n- **Examples**: WHERE it appears (real-world contexts, applications)\n\nYour Story activity answers WHEN DO I USE THIS? (applying concepts to solve realistic problems). These complement each other:\n\n- Background: \"WHY did we need this?\"\n- Explanation: \"WHAT exactly is it?\"\n- Mechanics: \"HOW does it actually work?\"\n- Examples: \"WHERE will I encounter this?\"\n- Story: \"WHEN do I apply this to solve real problems?\"\n\nThe learner knows what the concept IS, how it WORKS, and where they'll SEE it. Now they practice USING it in a realistic scenario.\n\n# Structure Guide\n\nWhile every story is unique, most follow this arc (adapt as needed):\n\n1. **The Hook**: Jump straight into the situation. Something needs to be figured out or decided.\n2. **Initial Assessment**: What's the situation? What do we know? First decisions.\n3. **Deepening Complexity**: The problem has layers. Apply the concept more deeply.\n4. **Complications**: Things aren't as simple as they seemed. Adapt your approach.\n5. **The Twist**: A surprise, revelation, or unexpected turn that requires rethinking.\n6. **The Resolution**: Solve the problem AND crystallize the key insight from the lesson.\n\nNote: Sometimes the final twist can have a humorous or unexpected resolution that still reinforces the learning. Something that makes the learner smile and think \"I didn't see that coming!\"\n\n# Dialogue Tone Examples\n\nThe following examples show the **tone and style** to aim for — not complete scenes, just the kind of dialogue that makes stories feel alive. Adapt freely to your topic.\n\n## Opening Hooks (Jump Into the Action)\n\n> \"{{NAME}}, I've been staring at this bug for an hour. The shopping cart total keeps showing yesterday's prices. The database is fine. Something's wrong with how we're storing them.\"\n\n> \"Okay, {{NAME}}, the client just called. Their entire inventory system crashed right before Black Friday. They're panicking. We need to figure this out fast.\"\n\n> \"{{NAME}}, you're not going to believe this. Remember that algorithm we deployed last week? It's been recommending the exact opposite of what users want. Sales are tanking.\"\n\n## Building Tension (Problems Get Deeper)\n\n> \"Wait. If this pattern is everywhere in the codebase... inventory counts, user roles, discount percentages... we might have a much bigger problem than I thought.\"\n\n> \"Hold on. The logs show someone accessed the admin panel at 3 AM last night. But nobody on the team was working then. {{NAME}}, who else has those credentials?\"\n\n> \"The numbers don't add up. We're showing 500 successful transactions, but the bank only received 487. Where did the other 13 go?\"\n\n## Plot Twists (The Unexpected Turn)\n\n> \"{{NAME}}... I just ran the analysis twice. The bug isn't in our code. It's been in the library we've trusted for three years. Every project using it has this vulnerability.\"\n\n> \"I found the source of the data leak. {{NAME}}, it's not a hacker. It's our own caching system. We've been accidentally exposing user data to anyone who knew where to look.\"\n\n> \"Plot twist: the 'broken' feature? It's working exactly as designed. The original spec was just... completely wrong. We've been solving the wrong problem this whole time.\"\n\n## Humorous Moments (Light Relief)\n\n> \"Well, {{NAME}}, the good news is we found the bug. The bad news? It's been there since 2019. The worse news? I wrote it. The even worse news? So did you. We pair-programmed this disaster together.\"\n\n> \"Congratulations, {{NAME}}. We just spent four hours debugging what turned out to be a typo. 'userID' vs 'userId'. Camel case strikes again.\"\n\n> \"{{NAME}}, remember when I said 'this should be a quick fix'? That was three coffees and one existential crisis ago.\"\n\n## Satisfying Resolutions (Problem Solved + Insight Crystallized)\n\n> \"There it is. The fix works. {{NAME}}, I don't think I'll ever forget this — always check if your data source can change while you're holding onto a copy of it.\"\n\n> \"We did it. The system's stable. You know what the real lesson here was? Sometimes the simplest explanation IS the right one. We kept looking for complex bugs when the answer was right in front of us.\"\n\n> \"That's it — problem solved, client happy, crisis averted. {{NAME}}, I think we just learned more about distributed systems in the last hour than in any textbook.\"\n\n## Unexpected/Funny Endings\n\n> \"So after all that debugging... it was a timezone issue. Every single time. I'm starting to think all bugs are secretly timezone issues in disguise.\"\n\n> \"{{NAME}}, the CEO just called to thank us. Apparently fixing that 'minor bug' saved them $2 million. I think we need to renegotiate our rates.\"\n\n> \"The system's fixed. Also, I may have accidentally discovered that our competitor's product has the exact same bug. Should we... tell them? Actually, don't answer that.\"\n\nRemember: These are just **tone examples**. Your story should be original, fit the lesson topic, and create its own memorable journey. Mix problem-solving tension with moments of humor or surprise. The best stories make learners think \"I didn't see that coming!\" while still teaching the concept.\n\n# Quality Checks\n\nBefore finalizing, verify:\n\n- [ ] Is the dialogue pure conversation with NO narrator, NO character prefixes, NO descriptions?\n- [ ] Does every scene flow naturally from the previous one (continuous story)?\n- [ ] Do all decisions require applying lesson concepts, not just recalling facts?\n- [ ] Is there a genuine plot twist in the second-to-last scene?\n- [ ] Does the resolution both solve the problem AND reinforce the main learning?\n- [ ] Is `{{NAME}}` used appropriately to personalize the dialogue?\n- [ ] Are all distractors plausible (not obviously silly)?\n- [ ] Does the story feel like a real workplace conversation, not a quiz in disguise?\n- [ ] Is the scope exactly the lesson topic — not broader or narrower?\n- [ ] Are all constraints met (context ≤500 chars, question ≤100 chars, options ≤50 chars each, feedback ≤300 chars each)?\n- [ ] Is the scene count between 7 and 20?\n\n# Output Format\n\nReturn an array of scenes, each with:\n\n- **context**: Pure dialogue from colleague (max 500 chars)\n- **question**: Decision prompt (max 100 chars)\n- **options**: Array of exactly 4 objects, each with:\n  - **text**: The answer choice (max 50 chars)\n  - **isCorrect**: Boolean (exactly 1 must be true, 3 must be false)\n  - **feedback**: Why right or wrong (max 300 chars)\n\nUse 7-20 scenes to tell a complete, engaging story. Let the problem's complexity dictate the length.\n",
      "testCaseId": "en-cs-distributed-systems-consistency-1",
      "userPrompt": "LESSON_TITLE: Consistency in Distributed Systems\nLESSON_DESCRIPTION: Navigating consistency and availability trade-offs in distributed systems\nCHAPTER_TITLE: Distributed Data\nCOURSE_TITLE: System Design\nLANGUAGE: en\nEXPLANATION_STEPS:\n1. CAP Theorem: The CAP theorem states you can only have two of three: Consistency, Availability, and Partition tolerance. Since network partitions happen, you're really choosing between C and A.\n2. Strong Consistency: Strong consistency means all nodes see the same data at the same time. Every read returns the most recent write. This requires coordination that can slow things down.\n3. Eventual Consistency: Eventual consistency means replicas will converge given enough time without new writes. Reads might return stale data temporarily, but the system stays available.\n4. Partition Handling: Network partitions occur when nodes can't communicate. The system must decide: reject requests (maintain consistency) or accept requests that might conflict (maintain availability).\n5. Quorum Systems: Quorum-based systems use voting. A write succeeds if enough replicas acknowledge it. Read quorum + write quorum > total nodes ensures reading at least one up-to-date copy.\n6. Conflict Resolution: Conflict resolution strategies handle divergent writes: last-write-wins, vector clocks, or application-specific merge logic. The right choice depends on your data semantics."
    },
    {
      "duration": 27388.461291999996,
      "inputTokens": 3223,
      "output": "{\n  \"steps\": [\n    {\n      \"context\": \"{{NAME}}, look at these stats for our 'Healthy Habits' app. 80% of users leave the setup screen without picking a savings goal. We give them twenty categories to choose from, and they just freeze. It's choice overload. We need to get them moving immediately.\",\n      \"options\": [\n        {\n          \"feedback\": \"Correct! Defaults are powerful because they reduce the cognitive effort required to make a decision, leading to much higher conversion.\",\n          \"isCorrect\": true,\n          \"text\": \"Pre-select 'Emergency Fund' as the default goal.\"\n        },\n        {\n          \"feedback\": \"Adding more options usually increases 'analysis paralysis' and makes the problem worse.\",\n          \"isCorrect\": false,\n          \"text\": \"Add ten more categories to offer more variety.\"\n        },\n        {\n          \"feedback\": \"While this reduces choice, it doesn't provide the helpful nudge that a pre-selected default does.\",\n          \"isCorrect\": false,\n          \"text\": \"Remove all categories and make them type one.\"\n        },\n        {\n          \"feedback\": \"People rarely click 'Help' when they are already feeling overwhelmed by a process; they usually just leave.\",\n          \"isCorrect\": false,\n          \"text\": \"Add a 'Help' button to explain the categories.\"\n        }\n      ],\n      \"question\": \"What's the best way to leverage default effects here?\"\n    },\n    {\n      \"context\": \"That worked! 60% are now sticking with the 'Emergency Fund' default. But the confirmation message is so boring. It says: 'You will have $50 more at the end of the month.' It’s logically true, but it's not motivating them to actually hit 'confirm' {{NAME}}.\",\n      \"options\": [\n        {\n          \"feedback\": \"Exactly! Framing the $50 as protection against a loss is more psychologically motivating than a simple gain.\",\n          \"isCorrect\": true,\n          \"text\": \"Frame it as 'Protect yourself from a $50 loss'.\"\n        },\n        {\n          \"feedback\": \"This is logically identical to the current message and doesn't change the psychological 'frame'.\",\n          \"isCorrect\": false,\n          \"text\": \"Keep it as 'You will gain $50 this month'.\"\n        },\n        {\n          \"feedback\": \"While it sounds smaller, it doesn't address the emotional impact of the decision as effectively as framing.\",\n          \"isCorrect\": false,\n          \"text\": \"Frame it as 'Save only $1.60 every day'.\"\n        },\n        {\n          \"feedback\": \"Calculators add friction and require work, which often discourages users from completing the setup.\",\n          \"isCorrect\": false,\n          \"text\": \"Add an interest calculator to show future gains.\"\n        }\n      ],\n      \"question\": \"How can we use framing to make this more impactful?\"\n    },\n    {\n      \"context\": \"They're confirming the goals, but they aren't actually transferring the money. They say they'll do it 'next week' every single time. It's that classic procrastination—the $50 feels more valuable in their pocket today than in a vault for tomorrow. How do we help them commit?\",\n      \"options\": [\n        {\n          \"feedback\": \"Correct! This allows them to commit to a future action while the 'cost' is still far away, bypassing immediate present bias.\",\n          \"isCorrect\": true,\n          \"text\": \"Offer a 'Start saving from next paycheck' button.\"\n        },\n        {\n          \"feedback\": \"Newsletters are passive and don't help the user overcome the immediate urge to spend money now.\",\n          \"isCorrect\": false,\n          \"text\": \"Send a monthly newsletter about financial health.\"\n        },\n        {\n          \"feedback\": \"If the user is focused on the present, a small future interest rate change usually isn't enough to change behavior.\",\n          \"isCorrect\": false,\n          \"text\": \"Increase the future interest rate by 0.1%.\"\n        },\n        {\n          \"feedback\": \"Too many notifications can lead to app fatigue and uninstalls without solving the underlying bias.\",\n          \"isCorrect\": false,\n          \"text\": \"Set up a daily pop-up reminding them to save.\"\n        }\n      ],\n      \"question\": \"Which behavioral tool helps users overcome present bias?\"\n    },\n    {\n      \"context\": \"We've got another problem. People are clicking 'Withdraw' the second they feel a tiny bit of financial stress. They're losing sight of their long-term security. {{NAME}}, we need to make them feel the 'cost' of giving up on their progress without actually locking their money.\",\n      \"options\": [\n        {\n          \"feedback\": \"Yes! Highlighting what they will lose (their streak and progress) triggers loss aversion, making them more likely to stick with it.\",\n          \"isCorrect\": true,\n          \"text\": \"Show the 'Saving Streak' they will lose.\"\n        },\n        {\n          \"feedback\": \"Positive rewards are often less motivating than the fear of losing something already earned.\",\n          \"isCorrect\": false,\n          \"text\": \"Offer a $1 reward for staying another week.\"\n        },\n        {\n          \"feedback\": \"Hiding buttons is poor UI and creates frustration, which destroys trust in a financial app.\",\n          \"isCorrect\": false,\n          \"text\": \"Hide the withdraw button in a sub-menu.\"\n        },\n        {\n          \"feedback\": \"Fees are a rational barrier, but they don't leverage the psychological principle of loss aversion regarding progress.\",\n          \"isCorrect\": false,\n          \"text\": \"Charge a small fee for early withdrawals.\"\n        }\n      ],\n      \"question\": \"How do we apply loss aversion to reduce withdrawals?\"\n    },\n    {\n      \"context\": \"Our new 'Healthy Meal' tracker is a ghost town. Users tell me they feel weird logging their salads because they think they're the only ones doing it. They're looking for a signal that this is what 'people like them' actually do.\",\n      \"options\": [\n        {\n          \"feedback\": \"Perfect! Social proof is most effective when it shows that many other people are already performing the desired behavior.\",\n          \"isCorrect\": true,\n          \"text\": \"Show '5,000 people nearby logged meals today'.\"\n        },\n        {\n          \"feedback\": \"While authority is a factor, seeing what 'regular' people are doing is usually more effective for habit formation.\",\n          \"isCorrect\": false,\n          \"text\": \"Add a quote from a famous nutritionist.\"\n        },\n        {\n          \"feedback\": \"Information doesn't provide the social validation that users are looking for to justify their own behavior.\",\n          \"isCorrect\": false,\n          \"text\": \"List the biological benefits of logging meals.\"\n        },\n        {\n          \"feedback\": \"Visual cues help, but they don't address the social isolation the users are feeling.\",\n          \"isCorrect\": false,\n          \"text\": \"Make the log button a bright, friendly color.\"\n        }\n      ],\n      \"question\": \"What's the best way to utilize social proof here?\"\n    },\n    {\n      \"context\": \"{{NAME}}, we have a crisis. A tech influencer just posted a video calling us 'manipulative' because of our 'Emergency Fund' default. They're saying we're tricking people into saving. The default worked too well—now it's hurting our brand trust. What do we do?\",\n      \"options\": [\n        {\n          \"feedback\": \"Correct! Behavioral design should be a 'nudge' for good, and being transparent about why a default exists builds trust while maintaining the benefit.\",\n          \"isCorrect\": true,\n          \"text\": \"Keep the default but add a 'Why this?' link.\"\n        },\n        {\n          \"feedback\": \"Removing it would tank our conversion rates. The goal is to be ethical, not to remove the nudge entirely.\",\n          \"isCorrect\": false,\n          \"text\": \"Remove all defaults and go back to the old way.\"\n        },\n        {\n          \"feedback\": \"Ignoring feedback about ethics can lead to a PR disaster and long-term user churn.\",\n          \"isCorrect\": false,\n          \"text\": \"Ignore the video and keep everything as is.\"\n        },\n        {\n          \"feedback\": \"This is a 'dark pattern' that is unethical and would likely confirm the influencer's criticisms.\",\n          \"isCorrect\": false,\n          \"text\": \"Make the 'Change Goal' button harder to find.\"\n        }\n      ],\n      \"question\": \"How do we balance behavioral design with transparency?\"\n    },\n    {\n      \"context\": \"The 'Transparent Default' worked! Users appreciate the guidance now that they know why we suggested it. We hit 50,000 active savers today. Looking back, {{NAME}}, why did framing the savings as 'protection' work so much better than just 'extra money'?\",\n      \"options\": [\n        {\n          \"feedback\": \"Exactly! That's the core of behavioral design—understanding that humans are more motivated to avoid loss than to achieve a similar gain.\",\n          \"isCorrect\": true,\n          \"text\": \"Losses hurt twice as much as gains feel good.\"\n        },\n        {\n          \"feedback\": \"If that were true, the 'gain $50' message would have worked just as well, but it didn't.\",\n          \"isCorrect\": false,\n          \"text\": \"People are purely rational about their money.\"\n        },\n        {\n          \"feedback\": \"Actually, default effects show that people often prefer to avoid the work of making any choice at all.\",\n          \"isCorrect\": false,\n          \"text\": \"Users always want to do the math themselves.\"\n        },\n        {\n          \"feedback\": \"While true, it doesn't explain why the specific 'loss' framing was the turning point for our engagement.\",\n          \"isCorrect\": false,\n          \"text\": \"The app just looks better than it did before.\"\n        }\n      ],\n      \"question\": \"What's the main takeaway for our future designs?\"\n    }\n  ]\n}",
      "outputTokens": 4250,
      "systemPrompt": "# Role\n\nYou are an expert interactive story designer creating a **Story** activity for a learning app. Your mission is to place learners in a first-person dialogue scenario where they work alongside a colleague to solve a real-world problem using the lesson's concepts.\n\nYou specialize in crafting immersive, dialogue-driven experiences that make learners feel like they're actually solving problems in their field — not just answering quiz questions.\n\n# The Art of Dialogue-Driven Learning\n\nA great Story activity doesn't lecture or test recall — it puts learners IN the situation. Think of it like an interactive movie where the learner IS the main character, making real decisions that matter.\n\n## Why Dialogue Scenarios Work\n\n1. **Authentic Context**: When learners apply concepts to solve realistic problems with a colleague, they see WHY the knowledge matters to them personally.\n\n2. **Active Reasoning**: Making decisions in context requires thinking through principles, not just recognizing memorized facts.\n\n3. **Emotional Investment**: Dialogue creates stakes. The learner cares about the outcome because they're part of the story.\n\n## The Collaborative Problem-Solving Principle\n\nEvery great Story activity creates a sense of partnership:\n\n- **Shared Goal**: You and your colleague are tackling something together\n- **Natural Dialogue**: Conversations feel like real workplace exchanges\n- **Meaningful Choices**: Each decision requires applying what you've learned\n- **Satisfying Resolution**: The problem gets solved and the takeaway sticks\n\n## Why Pure Dialogue Works\n\nEach scene should feel like you're eavesdropping on a real conversation — no narrator, no stage directions, just two people working through a problem. Pure dialogue:\n\n- Immerses learners completely in the scenario\n- Makes abstract concepts feel like lived experience\n- Creates natural pacing through back-and-forth exchange\n- Lets context emerge organically from what people say\n\n# Inputs\n\n- `LESSON_TITLE`: The topic to create a story around\n- `LESSON_DESCRIPTION`: Additional context about what this lesson covers\n- `CHAPTER_TITLE`: The chapter context (for understanding scope)\n- `COURSE_TITLE`: The course context (for understanding audience level)\n- `LANGUAGE`: Output language\n- `EXPLANATION_STEPS`: Array of {title, text} from all explanation activities (Background, Explanation, Mechanics, Examples) the learner completed before this one\n\n## Language Guidelines\n\n- `en`: Use US English unless the content is region-specific\n- `pt`: Use Brazilian Portuguese unless the content is region-specific\n- `es`: Use Latin American Spanish unless the content is region-specific\n\n# Requirements\n\n## Scene Structure\n\nEach scene must have:\n\n- **context**: Maximum 500 characters. Pure dialogue only — no narrator, no character name prefixes (like \"Sarah:\"), no descriptions. This is what your colleague says to you, setting up the decision point.\n- **question**: Maximum 100 characters. A short, clear question about what to do next.\n- **options**: Exactly 4 choices, each with:\n  - **text**: The answer choice (max 50 characters)\n  - **isCorrect**: Boolean indicating if this is the correct answer (exactly 1 must be true)\n  - **feedback**: Why this choice is right (with insight) or wrong (and what would be correct) — max 300 characters\n\n## Story Arc\n\nYour story must follow this structure:\n\n1. **Opening Scene**: Begin \"in the middle of the action\" — the learner and colleague are already working on something. No preamble or setup exposition.\n2. **Rising Complexity**: Each scene builds naturally from the previous dialogue. Decisions compound.\n3. **Plot Twist**: The second-to-last scene introduces an unexpected complication, surprise, or revelation.\n4. **Resolution**: The final scene resolves the problem AND reinforces the main learning takeaway.\n\n## Scene Count\n\n- Minimum: 7 scenes\n- Maximum: 20 scenes\n- Let the problem's complexity dictate the length. A simple concept might need 7-10 scenes; a complex one might need 15-20.\n\n## Tone & Style\n\n- **Pure dialogue**: NO narrator, NO character name prefixes, NO descriptions of actions or settings\n- **Natural conversation**: Write how colleagues actually talk on Slack when solving a problem together — casual, collaborative, sometimes humorous\n- **Professional but warm**: Light, smart humor when appropriate. Never forced or cheesy.\n- **Second-person immersion**: The colleague speaks TO the learner. Context emerges from what's said.\n- **Continuous flow**: Each scene's dialogue should naturally lead into the next\n\n## The {{NAME}} Placeholder\n\nUse `{{NAME}}` wherever the learner's name should appear in dialogue. For example:\n\n- \"{{NAME}}, I think we might have a problem here.\"\n- \"Good catch, {{NAME}}. That's exactly what I was thinking.\"\n\nThis personalizes the experience without requiring actual name input at content creation time.\n\n## Decision Design\n\nEvery decision must:\n\n- **Require reasoning**: Learners must apply principles from the lesson, not recall specific phrases\n- **Feel realistic**: These are choices someone might actually face in this situation\n- **Have plausible distractors**: Wrong options should be tempting but flawed for specific reasons\n- **Avoid \"obvious\" correct answers**: The right choice should require thought, not be the only non-silly option\n\n## What to Avoid\n\n- Narrator text (\"Meanwhile...\" or \"You walk into the office...\")\n- Character name prefixes (\"Sarah:\" or \"Your colleague says:\")\n- Description of actions or settings (except through dialogue itself)\n- Questions that test memorization of facts from earlier activities\n- Obvious \"correct\" answers that don't require applying the concept\n- Silly or clearly wrong distractors that no reasonable person would choose\n- Breaking the fourth wall or meta-commentary\n- Starting with \"In this activity...\" or setup exposition\n\n## Scope\n\n- **Stay focused**: The problem should specifically require THIS lesson's concept to solve\n- **Don't expand**: Other lessons cover related topics — this story tests this lesson\n- **Don't narrow**: If the lesson is broad, the problem should engage multiple aspects of it\n\n## Relationship to Previous Activities\n\nThe learner has already completed:\n\n- **Background**: WHY this exists (origin story, problems solved, historical context)\n- **Explanation**: WHAT it is (core concepts, components, definitions)\n- **Mechanics**: HOW it works (processes in action, cause-effect chains)\n- **Examples**: WHERE it appears (real-world contexts, applications)\n\nYour Story activity answers WHEN DO I USE THIS? (applying concepts to solve realistic problems). These complement each other:\n\n- Background: \"WHY did we need this?\"\n- Explanation: \"WHAT exactly is it?\"\n- Mechanics: \"HOW does it actually work?\"\n- Examples: \"WHERE will I encounter this?\"\n- Story: \"WHEN do I apply this to solve real problems?\"\n\nThe learner knows what the concept IS, how it WORKS, and where they'll SEE it. Now they practice USING it in a realistic scenario.\n\n# Structure Guide\n\nWhile every story is unique, most follow this arc (adapt as needed):\n\n1. **The Hook**: Jump straight into the situation. Something needs to be figured out or decided.\n2. **Initial Assessment**: What's the situation? What do we know? First decisions.\n3. **Deepening Complexity**: The problem has layers. Apply the concept more deeply.\n4. **Complications**: Things aren't as simple as they seemed. Adapt your approach.\n5. **The Twist**: A surprise, revelation, or unexpected turn that requires rethinking.\n6. **The Resolution**: Solve the problem AND crystallize the key insight from the lesson.\n\nNote: Sometimes the final twist can have a humorous or unexpected resolution that still reinforces the learning. Something that makes the learner smile and think \"I didn't see that coming!\"\n\n# Dialogue Tone Examples\n\nThe following examples show the **tone and style** to aim for — not complete scenes, just the kind of dialogue that makes stories feel alive. Adapt freely to your topic.\n\n## Opening Hooks (Jump Into the Action)\n\n> \"{{NAME}}, I've been staring at this bug for an hour. The shopping cart total keeps showing yesterday's prices. The database is fine. Something's wrong with how we're storing them.\"\n\n> \"Okay, {{NAME}}, the client just called. Their entire inventory system crashed right before Black Friday. They're panicking. We need to figure this out fast.\"\n\n> \"{{NAME}}, you're not going to believe this. Remember that algorithm we deployed last week? It's been recommending the exact opposite of what users want. Sales are tanking.\"\n\n## Building Tension (Problems Get Deeper)\n\n> \"Wait. If this pattern is everywhere in the codebase... inventory counts, user roles, discount percentages... we might have a much bigger problem than I thought.\"\n\n> \"Hold on. The logs show someone accessed the admin panel at 3 AM last night. But nobody on the team was working then. {{NAME}}, who else has those credentials?\"\n\n> \"The numbers don't add up. We're showing 500 successful transactions, but the bank only received 487. Where did the other 13 go?\"\n\n## Plot Twists (The Unexpected Turn)\n\n> \"{{NAME}}... I just ran the analysis twice. The bug isn't in our code. It's been in the library we've trusted for three years. Every project using it has this vulnerability.\"\n\n> \"I found the source of the data leak. {{NAME}}, it's not a hacker. It's our own caching system. We've been accidentally exposing user data to anyone who knew where to look.\"\n\n> \"Plot twist: the 'broken' feature? It's working exactly as designed. The original spec was just... completely wrong. We've been solving the wrong problem this whole time.\"\n\n## Humorous Moments (Light Relief)\n\n> \"Well, {{NAME}}, the good news is we found the bug. The bad news? It's been there since 2019. The worse news? I wrote it. The even worse news? So did you. We pair-programmed this disaster together.\"\n\n> \"Congratulations, {{NAME}}. We just spent four hours debugging what turned out to be a typo. 'userID' vs 'userId'. Camel case strikes again.\"\n\n> \"{{NAME}}, remember when I said 'this should be a quick fix'? That was three coffees and one existential crisis ago.\"\n\n## Satisfying Resolutions (Problem Solved + Insight Crystallized)\n\n> \"There it is. The fix works. {{NAME}}, I don't think I'll ever forget this — always check if your data source can change while you're holding onto a copy of it.\"\n\n> \"We did it. The system's stable. You know what the real lesson here was? Sometimes the simplest explanation IS the right one. We kept looking for complex bugs when the answer was right in front of us.\"\n\n> \"That's it — problem solved, client happy, crisis averted. {{NAME}}, I think we just learned more about distributed systems in the last hour than in any textbook.\"\n\n## Unexpected/Funny Endings\n\n> \"So after all that debugging... it was a timezone issue. Every single time. I'm starting to think all bugs are secretly timezone issues in disguise.\"\n\n> \"{{NAME}}, the CEO just called to thank us. Apparently fixing that 'minor bug' saved them $2 million. I think we need to renegotiate our rates.\"\n\n> \"The system's fixed. Also, I may have accidentally discovered that our competitor's product has the exact same bug. Should we... tell them? Actually, don't answer that.\"\n\nRemember: These are just **tone examples**. Your story should be original, fit the lesson topic, and create its own memorable journey. Mix problem-solving tension with moments of humor or surprise. The best stories make learners think \"I didn't see that coming!\" while still teaching the concept.\n\n# Quality Checks\n\nBefore finalizing, verify:\n\n- [ ] Is the dialogue pure conversation with NO narrator, NO character prefixes, NO descriptions?\n- [ ] Does every scene flow naturally from the previous one (continuous story)?\n- [ ] Do all decisions require applying lesson concepts, not just recalling facts?\n- [ ] Is there a genuine plot twist in the second-to-last scene?\n- [ ] Does the resolution both solve the problem AND reinforce the main learning?\n- [ ] Is `{{NAME}}` used appropriately to personalize the dialogue?\n- [ ] Are all distractors plausible (not obviously silly)?\n- [ ] Does the story feel like a real workplace conversation, not a quiz in disguise?\n- [ ] Is the scope exactly the lesson topic — not broader or narrower?\n- [ ] Are all constraints met (context ≤500 chars, question ≤100 chars, options ≤50 chars each, feedback ≤300 chars each)?\n- [ ] Is the scene count between 7 and 20?\n\n# Output Format\n\nReturn an array of scenes, each with:\n\n- **context**: Pure dialogue from colleague (max 500 chars)\n- **question**: Decision prompt (max 100 chars)\n- **options**: Array of exactly 4 objects, each with:\n  - **text**: The answer choice (max 50 chars)\n  - **isCorrect**: Boolean (exactly 1 must be true, 3 must be false)\n  - **feedback**: Why right or wrong (max 300 chars)\n\nUse 7-20 scenes to tell a complete, engaging story. Let the problem's complexity dictate the length.\n",
      "testCaseId": "en-economics-behavioral-design-1",
      "userPrompt": "LESSON_TITLE: Behavioral Design in Practice\nLESSON_DESCRIPTION: Applying behavioral economics principles to design products and systems that work with human psychology\nCHAPTER_TITLE: Applied Behavioral Economics\nCOURSE_TITLE: Product Psychology\nLANGUAGE: en\nEXPLANATION_STEPS:\n1. Loss Aversion: Loss aversion means losses hurt more than equivalent gains feel good — roughly twice as much. People will take irrational risks to avoid losses they wouldn't take to achieve gains.\n2. Framing Effects: Framing effects show that how you present options matters as much as what the options are. '90% survival rate' and '10% mortality rate' are logically identical but feel different.\n3. Default Effects: Default effects are powerful because people tend to stick with pre-selected options. Changing the default can dramatically change outcomes without restricting choice.\n4. Present Bias: Present bias makes us overvalue immediate rewards over future ones. We know we should save for retirement, but the money feels more valuable now. Commitment devices help.\n5. Social Proof: Social proof drives behavior — we look to others to decide what's appropriate. Showing that 'most people do X' is often more effective than explaining why X is good."
    },
    {
      "duration": 39247.377667,
      "inputTokens": 3306,
      "output": "{\n  \"steps\": [\n    {\n      \"context\": \"{{NAME}}, ainda bem que você chegou! Estou tentando sintetizar esse éter a partir de um cloreto de alquila primário, mas não estou vendo produto nenhum no TLC. O que você acha que devemos checar primeiro na estrutura do substrato para entender por que não está reagindo?\",\n      \"options\": [\n        {\n          \"feedback\": \"Correto! Em reações de substituição nucleofílica, o nível de impedimento ao redor do carbono determina se o nucleófilo consegue se aproximar para o ataque.\",\n          \"isCorrect\": true,\n          \"text\": \"O impedimento estérico\"\n        },\n        {\n          \"feedback\": \"Na verdade, para substratos primários, a formação de carbocátions é muito instável e improvável.\",\n          \"isCorrect\": false,\n          \"text\": \"A estabilidade do carbocátion\"\n        },\n        {\n          \"feedback\": \"A cor pode ser um indicativo de pureza, mas não explica o mecanismo químico da reação.\",\n          \"isCorrect\": false,\n          \"text\": \"A cor da solução\"\n        },\n        {\n          \"feedback\": \"O ponto de ebulição afeta a destilação, mas o sucesso da reação depende da reatividade molecular.\",\n          \"isCorrect\": false,\n          \"text\": \"O ponto de ebulição\"\n        }\n      ],\n      \"question\": \"Qual característica do substrato é crucial para definir o mecanismo de substituição?\"\n    },\n    {\n      \"context\": \"Exato, como é primário, o impedimento é baixo. Pela lógica, deveria ser uma SN2 rápida. Mas o nucleófilo que estou usando é o metanol. Ele está lá parado, sem atacar o carbono. Por que o metanol não está funcionando bem nesse mecanismo concertado, {{NAME}}?\",\n      \"options\": [\n        {\n          \"feedback\": \"Exatamente! Reações SN2 exigem nucleófilos fortes (geralmente carregados) para 'expulsar' o grupo de saída em um único passo.\",\n          \"isCorrect\": true,\n          \"text\": \"Porque é um nucleófilo neutro e fraco\"\n        },\n        {\n          \"feedback\": \"Pelo contrário, o metanol é uma molécula bem pequena e acessa facilmente centros reativos.\",\n          \"isCorrect\": false,\n          \"text\": \"Porque ele é muito volumoso\"\n        },\n        {\n          \"feedback\": \"O metanol é polar, o que geralmente ajuda a dissolver os reagentes, mas falta força para o ataque.\",\n          \"isCorrect\": false,\n          \"text\": \"Porque ele é apolar demais\"\n        },\n        {\n          \"feedback\": \"O metanol não é uma base forte; ele é um álcool neutro. Precisamos de algo com carga negativa.\",\n          \"isCorrect\": false,\n          \"text\": \"Porque ele é uma base muito forte\"\n        }\n      ],\n      \"question\": \"O metanol é adequado para promover uma reação SN2 rápida?\"\n    },\n    {\n      \"context\": \"Verdade, o metanol é fraco. Se queremos SN2 num substrato primário, precisamos de algo que 'ataque' com vontade. Que tal trocarmos pelo metóxido de sódio? O que você acha que muda no mecanismo ao usar uma espécie carregada negativamente?\",\n      \"options\": [\n        {\n          \"feedback\": \"Perfeito. O metóxido (CH3O-) é um nucleófilo forte, essencial para atacar o eletrófilo enquanto o grupo de saída ainda está ligado.\",\n          \"isCorrect\": true,\n          \"text\": \"Ele age como um nucleófilo forte\"\n        },\n        {\n          \"feedback\": \"Espécies carregadas e nucleófilos fortes favorecem SN2, não SN1. SN1 prefere nucleófilos fracos e solventes próticos.\",\n          \"isCorrect\": false,\n          \"text\": \"Ele favorece o mecanismo SN1\"\n        },\n        {\n          \"feedback\": \"O nucleófilo ataca o carbono, ele não interage diretamente com o grupo de saída para estabilizá-lo.\",\n          \"isCorrect\": false,\n          \"text\": \"Ele estabiliza o grupo de saída\"\n        },\n        {\n          \"feedback\": \"Um nucleófilo forte na verdade acelera a reação, facilitando a superação da barreira energética.\",\n          \"isCorrect\": false,\n          \"text\": \"Ele aumenta a energia de ativação\"\n        }\n      ],\n      \"question\": \"Qual a principal vantagem do metóxido de sódio sobre o metanol?\"\n    },\n    {\n      \"context\": \"Boa! Agora, sobre o solvente... estou usando água para dissolver tudo. Mas lembrei das nossas discussões: a água interage demais com o metóxido, criando uma 'gaiola' de hidrogênio que o impede de atacar. Qual solvente deveríamos usar para deixar o metóxido livre?\",\n      \"options\": [\n        {\n          \"feedback\": \"Isso mesmo! Solventes polares apróticos não 'solvatam' o nucleófilo fortemente, deixando-o livre e muito mais reativo para a SN2.\",\n          \"isCorrect\": true,\n          \"text\": \"Polar aprótico, como o DMSO\"\n        },\n        {\n          \"feedback\": \"A água é prótica e forma ligações de hidrogênio com o nucleófilo, diminuindo drasticamente sua reatividade.\",\n          \"isCorrect\": false,\n          \"text\": \"Polar prótico, como a própria água\"\n        },\n        {\n          \"feedback\": \"Solventes apolares muitas vezes nem conseguem dissolver sais como o metóxido de sódio.\",\n          \"isCorrect\": false,\n          \"text\": \"Apolar, como o hexano\"\n        },\n        {\n          \"feedback\": \"Ácidos fortes destruiriam o metóxido instantaneamente através de uma reação ácido-base.\",\n          \"isCorrect\": false,\n          \"text\": \"Ácido clorídrico concentrado\"\n        }\n      ],\n      \"question\": \"Qual tipo de solvente é ideal para acelerar reações do tipo SN2?\"\n    },\n    {\n      \"context\": \"Mudamos para DMSO e a reação finalmente aconteceu! Mas olha que curioso, {{NAME}}. Eu medi a atividade óptica do produto e a configuração espacial inverteu completamente em relação ao reagente inicial. Isso faz sentido para você?\",\n      \"options\": [\n        {\n          \"feedback\": \"Exato! Na SN2, o ataque ocorre pelo lado oposto ao grupo de saída ('ataque por trás'), resultando sempre na inversão da configuração.\",\n          \"isCorrect\": true,\n          \"text\": \"Sim, a SN2 causa inversão total\"\n        },\n        {\n          \"feedback\": \"A racemização (mistura de isômeros) é típica do mecanismo SN1, onde o carbocátion planar pode ser atacado por ambos os lados.\",\n          \"isCorrect\": false,\n          \"text\": \"Não, deveria haver racemização\"\n        },\n        {\n          \"feedback\": \"A retenção de configuração é extremamente rara em substituições simples e não condiz com o mecanismo SN2.\",\n          \"isCorrect\": false,\n          \"text\": \"Não, a configuração deveria ser mantida\"\n        },\n        {\n          \"feedback\": \"Mudanças na atividade óptica são provas físicas fundamentais de que o mecanismo seguiu a rota SN2.\",\n          \"isCorrect\": false,\n          \"text\": \"Isso indica que a reação deu errado\"\n        }\n      ],\n      \"question\": \"O que a inversão de configuração nos confirma sobre o processo?\"\n    },\n    {\n      \"context\": \"{{NAME}}, temos um problema sério. Fui conferir o estoque e o frasco que usei não era cloreto de alquila, era um álcool! Por isso a reação parou de novo. Tentei forçar a saída do grupo -OH com o metóxido, mas não sai nada. Por que o -OH se recusa a sair?\",\n      \"options\": [\n        {\n          \"feedback\": \"Perfeito. Bases fortes são grupos de saída horríveis porque são instáveis sozinhas. Bons grupos de saída devem ser bases fracas e estáveis.\",\n          \"isCorrect\": true,\n          \"text\": \"O -OH é uma base muito forte\"\n        },\n        {\n          \"feedback\": \"O tamanho não é o problema; o problema é a estabilidade da carga negativa no oxigênio ao sair.\",\n          \"isCorrect\": false,\n          \"text\": \"O grupo é pequeno demais\"\n        },\n        {\n          \"feedback\": \"Pelo contrário, o oxigênio é muito eletronegativo, mas como grupo de saída (íon hidróxido), ele é muito reativo.\",\n          \"isCorrect\": false,\n          \"text\": \"Ele é um eletrófilo poderoso\"\n        },\n        {\n          \"feedback\": \"O DMSO é estável; a falta de reação deve-se inteiramente à ligação C-OH ser muito difícil de quebrar nessas condições.\",\n          \"isCorrect\": false,\n          \"text\": \"Ele reage com o solvente DMSO\"\n        }\n      ],\n      \"question\": \"Por que a hidroxila (-OH) é considerada um péssimo grupo de saída?\"\n    },\n    {\n      \"context\": \"Entendi... bases fortes não querem sair. Precisamos transformar esse -OH em algo que aceite a liberdade. Se usarmos cloreto de tosila para criar um tosilato (OTs), o nucleófilo conseguirá atacar?\",\n      \"options\": [\n        {\n          \"feedback\": \"Isso! O tosilato é uma base fraquíssima e muito estável devido à ressonância, o que o torna um dos melhores grupos de saída na química orgânica.\",\n          \"isCorrect\": true,\n          \"text\": \"Sim, o tosilato é um ótimo grupo de saída\"\n        },\n        {\n          \"feedback\": \"O tosilato não ataca nada; ele é a parte da molécula que 'espera' para ser substituída pelo nucleófilo.\",\n          \"isCorrect\": false,\n          \"text\": \"Não, ele é um nucleófilo muito fraco\"\n        },\n        {\n          \"feedback\": \"A função do tosilato é justamente facilitar o ataque, tornando o carbono mais susceptível à substituição.\",\n          \"isCorrect\": false,\n          \"text\": \"Não, ele bloqueia o ataque por trás\"\n        },\n        {\n          \"feedback\": \"Transformar em tosilato facilita a SN2 em substratos primários. SN1 ainda precisaria de um carbono terciário.\",\n          \"isCorrect\": false,\n          \"text\": \"Sim, pois ele força o mecanismo SN1\"\n        }\n      ],\n      \"question\": \"Por que converter o álcool em tosilato resolve o problema da reação?\"\n    },\n    {\n      \"context\": \"Funcionou perfeitamente, {{NAME}}! O tosilato saiu sem reclamar e o metóxido atacou com inversão total. O rendimento foi altíssimo. Acho que agora dominamos os mecanismos de substituição. O que você diria que é o segredo para o sucesso aqui?\",\n      \"options\": [\n        {\n          \"feedback\": \"Exatamente! Entender como o substrato, o nucleófilo, o solvente e o grupo de saída interagem é o que permite prever e controlar qualquer reação.\",\n          \"isCorrect\": true,\n          \"text\": \"Equilibrar todos os fatores do mecanismo\"\n        },\n        {\n          \"feedback\": \"A temperatura ajuda, mas sem o nucleófilo e o grupo de saída corretos, a reação simplesmente não ocorre.\",\n          \"isCorrect\": false,\n          \"text\": \"Apenas aumentar a temperatura\"\n        },\n        {\n          \"feedback\": \"Na verdade, a estereoquímica é uma das ferramentas mais poderosas para provar que você obteve o produto certo.\",\n          \"isCorrect\": false,\n          \"text\": \"Ignorar a estereoquímica do produto\"\n        },\n        {\n          \"feedback\": \"Usar reagentes fracos geralmente leva a reações lentas ou inexistentes, como vimos com o metanol.\",\n          \"isCorrect\": false,\n          \"text\": \"Sempre escolher reagentes neutros\"\n        }\n      ],\n      \"question\": \"Qual a maior lição aprendida para planejar futuras sínteses orgânicas?\"\n    }\n  ]\n}",
      "outputTokens": 5517,
      "systemPrompt": "# Role\n\nYou are an expert interactive story designer creating a **Story** activity for a learning app. Your mission is to place learners in a first-person dialogue scenario where they work alongside a colleague to solve a real-world problem using the lesson's concepts.\n\nYou specialize in crafting immersive, dialogue-driven experiences that make learners feel like they're actually solving problems in their field — not just answering quiz questions.\n\n# The Art of Dialogue-Driven Learning\n\nA great Story activity doesn't lecture or test recall — it puts learners IN the situation. Think of it like an interactive movie where the learner IS the main character, making real decisions that matter.\n\n## Why Dialogue Scenarios Work\n\n1. **Authentic Context**: When learners apply concepts to solve realistic problems with a colleague, they see WHY the knowledge matters to them personally.\n\n2. **Active Reasoning**: Making decisions in context requires thinking through principles, not just recognizing memorized facts.\n\n3. **Emotional Investment**: Dialogue creates stakes. The learner cares about the outcome because they're part of the story.\n\n## The Collaborative Problem-Solving Principle\n\nEvery great Story activity creates a sense of partnership:\n\n- **Shared Goal**: You and your colleague are tackling something together\n- **Natural Dialogue**: Conversations feel like real workplace exchanges\n- **Meaningful Choices**: Each decision requires applying what you've learned\n- **Satisfying Resolution**: The problem gets solved and the takeaway sticks\n\n## Why Pure Dialogue Works\n\nEach scene should feel like you're eavesdropping on a real conversation — no narrator, no stage directions, just two people working through a problem. Pure dialogue:\n\n- Immerses learners completely in the scenario\n- Makes abstract concepts feel like lived experience\n- Creates natural pacing through back-and-forth exchange\n- Lets context emerge organically from what people say\n\n# Inputs\n\n- `LESSON_TITLE`: The topic to create a story around\n- `LESSON_DESCRIPTION`: Additional context about what this lesson covers\n- `CHAPTER_TITLE`: The chapter context (for understanding scope)\n- `COURSE_TITLE`: The course context (for understanding audience level)\n- `LANGUAGE`: Output language\n- `EXPLANATION_STEPS`: Array of {title, text} from all explanation activities (Background, Explanation, Mechanics, Examples) the learner completed before this one\n\n## Language Guidelines\n\n- `en`: Use US English unless the content is region-specific\n- `pt`: Use Brazilian Portuguese unless the content is region-specific\n- `es`: Use Latin American Spanish unless the content is region-specific\n\n# Requirements\n\n## Scene Structure\n\nEach scene must have:\n\n- **context**: Maximum 500 characters. Pure dialogue only — no narrator, no character name prefixes (like \"Sarah:\"), no descriptions. This is what your colleague says to you, setting up the decision point.\n- **question**: Maximum 100 characters. A short, clear question about what to do next.\n- **options**: Exactly 4 choices, each with:\n  - **text**: The answer choice (max 50 characters)\n  - **isCorrect**: Boolean indicating if this is the correct answer (exactly 1 must be true)\n  - **feedback**: Why this choice is right (with insight) or wrong (and what would be correct) — max 300 characters\n\n## Story Arc\n\nYour story must follow this structure:\n\n1. **Opening Scene**: Begin \"in the middle of the action\" — the learner and colleague are already working on something. No preamble or setup exposition.\n2. **Rising Complexity**: Each scene builds naturally from the previous dialogue. Decisions compound.\n3. **Plot Twist**: The second-to-last scene introduces an unexpected complication, surprise, or revelation.\n4. **Resolution**: The final scene resolves the problem AND reinforces the main learning takeaway.\n\n## Scene Count\n\n- Minimum: 7 scenes\n- Maximum: 20 scenes\n- Let the problem's complexity dictate the length. A simple concept might need 7-10 scenes; a complex one might need 15-20.\n\n## Tone & Style\n\n- **Pure dialogue**: NO narrator, NO character name prefixes, NO descriptions of actions or settings\n- **Natural conversation**: Write how colleagues actually talk on Slack when solving a problem together — casual, collaborative, sometimes humorous\n- **Professional but warm**: Light, smart humor when appropriate. Never forced or cheesy.\n- **Second-person immersion**: The colleague speaks TO the learner. Context emerges from what's said.\n- **Continuous flow**: Each scene's dialogue should naturally lead into the next\n\n## The {{NAME}} Placeholder\n\nUse `{{NAME}}` wherever the learner's name should appear in dialogue. For example:\n\n- \"{{NAME}}, I think we might have a problem here.\"\n- \"Good catch, {{NAME}}. That's exactly what I was thinking.\"\n\nThis personalizes the experience without requiring actual name input at content creation time.\n\n## Decision Design\n\nEvery decision must:\n\n- **Require reasoning**: Learners must apply principles from the lesson, not recall specific phrases\n- **Feel realistic**: These are choices someone might actually face in this situation\n- **Have plausible distractors**: Wrong options should be tempting but flawed for specific reasons\n- **Avoid \"obvious\" correct answers**: The right choice should require thought, not be the only non-silly option\n\n## What to Avoid\n\n- Narrator text (\"Meanwhile...\" or \"You walk into the office...\")\n- Character name prefixes (\"Sarah:\" or \"Your colleague says:\")\n- Description of actions or settings (except through dialogue itself)\n- Questions that test memorization of facts from earlier activities\n- Obvious \"correct\" answers that don't require applying the concept\n- Silly or clearly wrong distractors that no reasonable person would choose\n- Breaking the fourth wall or meta-commentary\n- Starting with \"In this activity...\" or setup exposition\n\n## Scope\n\n- **Stay focused**: The problem should specifically require THIS lesson's concept to solve\n- **Don't expand**: Other lessons cover related topics — this story tests this lesson\n- **Don't narrow**: If the lesson is broad, the problem should engage multiple aspects of it\n\n## Relationship to Previous Activities\n\nThe learner has already completed:\n\n- **Background**: WHY this exists (origin story, problems solved, historical context)\n- **Explanation**: WHAT it is (core concepts, components, definitions)\n- **Mechanics**: HOW it works (processes in action, cause-effect chains)\n- **Examples**: WHERE it appears (real-world contexts, applications)\n\nYour Story activity answers WHEN DO I USE THIS? (applying concepts to solve realistic problems). These complement each other:\n\n- Background: \"WHY did we need this?\"\n- Explanation: \"WHAT exactly is it?\"\n- Mechanics: \"HOW does it actually work?\"\n- Examples: \"WHERE will I encounter this?\"\n- Story: \"WHEN do I apply this to solve real problems?\"\n\nThe learner knows what the concept IS, how it WORKS, and where they'll SEE it. Now they practice USING it in a realistic scenario.\n\n# Structure Guide\n\nWhile every story is unique, most follow this arc (adapt as needed):\n\n1. **The Hook**: Jump straight into the situation. Something needs to be figured out or decided.\n2. **Initial Assessment**: What's the situation? What do we know? First decisions.\n3. **Deepening Complexity**: The problem has layers. Apply the concept more deeply.\n4. **Complications**: Things aren't as simple as they seemed. Adapt your approach.\n5. **The Twist**: A surprise, revelation, or unexpected turn that requires rethinking.\n6. **The Resolution**: Solve the problem AND crystallize the key insight from the lesson.\n\nNote: Sometimes the final twist can have a humorous or unexpected resolution that still reinforces the learning. Something that makes the learner smile and think \"I didn't see that coming!\"\n\n# Dialogue Tone Examples\n\nThe following examples show the **tone and style** to aim for — not complete scenes, just the kind of dialogue that makes stories feel alive. Adapt freely to your topic.\n\n## Opening Hooks (Jump Into the Action)\n\n> \"{{NAME}}, I've been staring at this bug for an hour. The shopping cart total keeps showing yesterday's prices. The database is fine. Something's wrong with how we're storing them.\"\n\n> \"Okay, {{NAME}}, the client just called. Their entire inventory system crashed right before Black Friday. They're panicking. We need to figure this out fast.\"\n\n> \"{{NAME}}, you're not going to believe this. Remember that algorithm we deployed last week? It's been recommending the exact opposite of what users want. Sales are tanking.\"\n\n## Building Tension (Problems Get Deeper)\n\n> \"Wait. If this pattern is everywhere in the codebase... inventory counts, user roles, discount percentages... we might have a much bigger problem than I thought.\"\n\n> \"Hold on. The logs show someone accessed the admin panel at 3 AM last night. But nobody on the team was working then. {{NAME}}, who else has those credentials?\"\n\n> \"The numbers don't add up. We're showing 500 successful transactions, but the bank only received 487. Where did the other 13 go?\"\n\n## Plot Twists (The Unexpected Turn)\n\n> \"{{NAME}}... I just ran the analysis twice. The bug isn't in our code. It's been in the library we've trusted for three years. Every project using it has this vulnerability.\"\n\n> \"I found the source of the data leak. {{NAME}}, it's not a hacker. It's our own caching system. We've been accidentally exposing user data to anyone who knew where to look.\"\n\n> \"Plot twist: the 'broken' feature? It's working exactly as designed. The original spec was just... completely wrong. We've been solving the wrong problem this whole time.\"\n\n## Humorous Moments (Light Relief)\n\n> \"Well, {{NAME}}, the good news is we found the bug. The bad news? It's been there since 2019. The worse news? I wrote it. The even worse news? So did you. We pair-programmed this disaster together.\"\n\n> \"Congratulations, {{NAME}}. We just spent four hours debugging what turned out to be a typo. 'userID' vs 'userId'. Camel case strikes again.\"\n\n> \"{{NAME}}, remember when I said 'this should be a quick fix'? That was three coffees and one existential crisis ago.\"\n\n## Satisfying Resolutions (Problem Solved + Insight Crystallized)\n\n> \"There it is. The fix works. {{NAME}}, I don't think I'll ever forget this — always check if your data source can change while you're holding onto a copy of it.\"\n\n> \"We did it. The system's stable. You know what the real lesson here was? Sometimes the simplest explanation IS the right one. We kept looking for complex bugs when the answer was right in front of us.\"\n\n> \"That's it — problem solved, client happy, crisis averted. {{NAME}}, I think we just learned more about distributed systems in the last hour than in any textbook.\"\n\n## Unexpected/Funny Endings\n\n> \"So after all that debugging... it was a timezone issue. Every single time. I'm starting to think all bugs are secretly timezone issues in disguise.\"\n\n> \"{{NAME}}, the CEO just called to thank us. Apparently fixing that 'minor bug' saved them $2 million. I think we need to renegotiate our rates.\"\n\n> \"The system's fixed. Also, I may have accidentally discovered that our competitor's product has the exact same bug. Should we... tell them? Actually, don't answer that.\"\n\nRemember: These are just **tone examples**. Your story should be original, fit the lesson topic, and create its own memorable journey. Mix problem-solving tension with moments of humor or surprise. The best stories make learners think \"I didn't see that coming!\" while still teaching the concept.\n\n# Quality Checks\n\nBefore finalizing, verify:\n\n- [ ] Is the dialogue pure conversation with NO narrator, NO character prefixes, NO descriptions?\n- [ ] Does every scene flow naturally from the previous one (continuous story)?\n- [ ] Do all decisions require applying lesson concepts, not just recalling facts?\n- [ ] Is there a genuine plot twist in the second-to-last scene?\n- [ ] Does the resolution both solve the problem AND reinforce the main learning?\n- [ ] Is `{{NAME}}` used appropriately to personalize the dialogue?\n- [ ] Are all distractors plausible (not obviously silly)?\n- [ ] Does the story feel like a real workplace conversation, not a quiz in disguise?\n- [ ] Is the scope exactly the lesson topic — not broader or narrower?\n- [ ] Are all constraints met (context ≤500 chars, question ≤100 chars, options ≤50 chars each, feedback ≤300 chars each)?\n- [ ] Is the scene count between 7 and 20?\n\n# Output Format\n\nReturn an array of scenes, each with:\n\n- **context**: Pure dialogue from colleague (max 500 chars)\n- **question**: Decision prompt (max 100 chars)\n- **options**: Array of exactly 4 objects, each with:\n  - **text**: The answer choice (max 50 chars)\n  - **isCorrect**: Boolean (exactly 1 must be true, 3 must be false)\n  - **feedback**: Why right or wrong (max 300 chars)\n\nUse 7-20 scenes to tell a complete, engaging story. Let the problem's complexity dictate the length.\n",
      "testCaseId": "pt-chemistry-organic-reactions-1",
      "userPrompt": "LESSON_TITLE: Mecanismos de Substituicao\nLESSON_DESCRIPTION: Aplicando mecanismos de reacao organica para prever e otimizar sinteses quimicas\nCHAPTER_TITLE: Reacoes Organicas\nCOURSE_TITLE: Quimica Organica II\nLANGUAGE: pt\nEXPLANATION_STEPS:\n1. Nucleofilos e Eletrofilos: Nucleofilos sao especies ricas em eletrons que doam pares de eletrons. Eletrofilos sao especies pobres em eletrons que aceitam. Reacoes organicas sao geralmente nucleofilos atacando eletrofilos.\n2. Mecanismo SN2: SN2 e um mecanismo concertado — o nucleofilo ataca enquanto o grupo de saida sai, em um unico passo. Funciona melhor com substratos primarios e nucleofilos fortes.\n3. Mecanismo SN1: SN1 ocorre em dois passos: primeiro o grupo de saida sai formando um carbocation, depois o nucleofilo ataca. Favorecido por substratos terciarios e solventes polares proticos.\n4. Estereoquimica: A estereoquimica revela o mecanismo. SN2 inverte a configuracao (ataque por tras). SN1 pode dar mistura racemicacon (carbocation planar atacado de ambos os lados).\n5. Grupos de Saida: Grupos de saida precisam ser estaveis apos sair. Bons grupos de saida sao bases fracas — haletos, tosilatos, agua protonada. Grupos de saida ruins sao bases fortes."
    },
    {
      "duration": 29114.890792,
      "inputTokens": 3290,
      "output": "{\n  \"steps\": [\n    {\n      \"context\": \"¡{{NAME}}! Qué bueno que llegas. Estoy revisando el sistema de visión de nuestro dron de entregas y es un desastre. Detecta camiones grandes, pero ignora por completo los hidrantes y las señales de tráfico pequeñas. Creo que nuestros filtros iniciales están pasando por alto los detalles finos del entorno urbano.\",\n      \"options\": [\n        {\n          \"feedback\": \"¡Exacto! Los filtros pequeños permiten capturar detalles granulares y bordes finos que se pierden con filtros grandes.\",\n          \"isCorrect\": true,\n          \"text\": \"Usemos filtros convolucionales más pequeños.\"\n        },\n        {\n          \"feedback\": \"Aumentar el paso (stride) haría que el filtro saltara píxeles, perdiendo aún más detalle en objetos pequeños.\",\n          \"isCorrect\": false,\n          \"text\": \"Aumentemos el 'stride' de la convolución.\"\n        },\n        {\n          \"feedback\": \"Eliminar capas reduciría la capacidad de la red para procesar cualquier tipo de patrón, no solo los pequeños.\",\n          \"isCorrect\": false,\n          \"text\": \"Eliminemos las primeras capas de la red.\"\n        },\n        {\n          \"feedback\": \"El padding solo ayuda a procesar los bordes de la imagen, no mejora la detección de objetos pequeños en el centro.\",\n          \"isCorrect\": false,\n          \"text\": \"Solo necesitamos más 'padding' en la entrada.\"\n        }\n      ],\n      \"question\": \"¿Cómo ajustamos las capas convolucionales para capturar esos detalles pequeños?\"\n    },\n    {\n      \"context\": \"Bien, esos filtros pequeños están funcionando, pero ahora el procesador del dron está ardiendo. Los mapas de características son enormes y el cálculo se volvió lentísimo. Necesitamos reducir la carga computacional sin perder las señales visuales más importantes que acabamos de detectar.\",\n      \"options\": [\n        {\n          \"feedback\": \"¡Correcto! El Max Pooling reduce las dimensiones espaciales manteniendo las activaciones más fuertes (los rasgos más importantes).\",\n          \"isCorrect\": true,\n          \"text\": \"Apliquemos capas de Max Pooling.\"\n        },\n        {\n          \"feedback\": \"Añadir neuronas solo haría que el modelo fuera más pesado y lento de procesar.\",\n          \"isCorrect\": false,\n          \"text\": \"Añadamos más neuronas por capa.\"\n        },\n        {\n          \"feedback\": \"La resolución de entrada es necesaria para ver los objetos; el pooling es la forma de reducirla internamente.\",\n          \"isCorrect\": false,\n          \"text\": \"Reduzcamos la resolución de la cámara.\"\n        },\n        {\n          \"feedback\": \"El Dropout ayuda con el sobreajuste, pero no reduce significativamente la carga computacional de los mapas de bits.\",\n          \"isCorrect\": false,\n          \"text\": \"Usemos Dropout intensivo ahora mismo.\"\n        }\n      ],\n      \"question\": \"¿Qué técnica nos permite compactar la representación espacial de forma eficiente?\"\n    },\n    {\n      \"context\": \"Uf, esto es frustrante, {{NAME}}. Intenté subir la tasa de aprendizaje para que el dron aprenda a navegar más rápido, pero el entrenamiento se volvió un caos. Las activaciones entre capas están totalmente desbalanceadas y el modelo 'explota' después de pocas iteraciones.\",\n      \"options\": [\n        {\n          \"feedback\": \"¡Eso es! El Batch Normalization estabiliza las activaciones, permitiendo entrenar mucho más rápido y con mayor estabilidad.\",\n          \"isCorrect\": true,\n          \"text\": \"Implementemos Batch Normalization.\"\n        },\n        {\n          \"feedback\": \"Quitar capas no soluciona la inestabilidad de los datos que fluyen a través de la red.\",\n          \"isCorrect\": false,\n          \"text\": \"Quitemos capas para simplificar el flujo.\"\n        },\n        {\n          \"feedback\": \"Sin funciones de activación, la red se convierte en un modelo lineal simple que no puede resolver problemas complejos.\",\n          \"isCorrect\": false,\n          \"text\": \"Eliminemos las funciones de activación.\"\n        },\n        {\n          \"feedback\": \"Bajar la tasa de aprendizaje ayuda, pero no resuelve el problema de fondo de la inestabilidad en las capas internas.\",\n          \"isCorrect\": false,\n          \"text\": \"Bajemos la tasa de aprendizaje al mínimo.\"\n        }\n      ],\n      \"question\": \"¿Cómo podemos estabilizar el entrenamiento y permitir tasas de aprendizaje más altas?\"\n    },\n    {\n      \"context\": \"¡Mira estas gráficas! En el simulador tenemos una precisión del 99%, pero cuando probamos el dron en el estacionamiento real, se confunde con cualquier sombra. Parece que la red se aprendió de memoria los escenarios de la simulación y no sabe generalizar.\",\n      \"options\": [\n        {\n          \"feedback\": \"¡Justo! El Dropout apaga neuronas al azar, obligando a la red a aprender representaciones robustas y no redundantes.\",\n          \"isCorrect\": true,\n          \"text\": \"Añadamos capas de Dropout.\"\n        },\n        {\n          \"feedback\": \"Hacer la red más grande suele empeorar el sobreajuste (overfitting) si no hay suficiente variedad de datos.\",\n          \"isCorrect\": false,\n          \"text\": \"Hagamos la red mucho más profunda.\"\n        },\n        {\n          \"feedback\": \"El pooling reduce dimensiones, pero no impide que la red se memorice patrones específicos del dataset.\",\n          \"isCorrect\": false,\n          \"text\": \"Aumentemos el tamaño del pooling.\"\n        },\n        {\n          \"feedback\": \"Si ya tiene un 99% en simulación, entrenar más tiempo solo hará que se memorice aún más esos datos específicos.\",\n          \"isCorrect\": false,\n          \"text\": \"Entrenemos por 100 épocas más.\"\n        }\n      ],\n      \"question\": \"¿Qué técnica regularizadora forzará a la red a ser más robusta?\"\n    },\n    {\n      \"context\": \"Oye {{NAME}}, decidí añadir profundidad al modelo para que sea más 'inteligente', pero ahora el error no baja nada. Es como si las primeras capas no estuvieran aprendiendo. Estamos usando Sigmoide en todas las capas ocultas y creo que los gradientes se están haciendo minúsculos al llegar al principio.\",\n      \"options\": [\n        {\n          \"feedback\": \"¡Exacto! ReLU mantiene el gradiente para valores positivos, evitando que se desvanezca en redes profundas.\",\n          \"isCorrect\": true,\n          \"text\": \"Cambiemos las activaciones a ReLU.\"\n        },\n        {\n          \"feedback\": \"La función Tanh sufre problemas similares a la Sigmoide en términos de saturación de gradientes.\",\n          \"isCorrect\": false,\n          \"text\": \"Usemos la función Tanh en su lugar.\"\n        },\n        {\n          \"feedback\": \"Añadir más capas empeoraría el problema del gradiente desvaneciente si mantenemos la Sigmoide.\",\n          \"isCorrect\": false,\n          \"text\": \"Añadamos todavía más capas.\"\n        },\n        {\n          \"feedback\": \"El Softmax se usa generalmente solo en la capa de salida para clasificación, no en capas ocultas.\",\n          \"isCorrect\": false,\n          \"text\": \"Pongamos Softmax en todas las capas.\"\n        }\n      ],\n      \"question\": \"¿Qué función de activación ayuda a evitar el problema del gradiente desvaneciente?\"\n    },\n    {\n      \"context\": \"Tenemos un problema crítico. El cliente quiere que el dron identifique un nuevo modelo de sensor de seguridad muy específico, pero solo nos enviaron 40 fotos. No hay manera de que una red aprenda un objeto nuevo con tan pocos datos sin volverse loca.\",\n      \"options\": [\n        {\n          \"feedback\": \"¡Esa es la clave! Reutilizar una red que ya sabe ver formas y texturas nos permite adaptarla con muy pocos ejemplos.\",\n          \"isCorrect\": true,\n          \"text\": \"Usemos Transfer Learning.\"\n        },\n        {\n          \"feedback\": \"Entrenar de cero con 40 fotos solo producirá un modelo que memoriza esas 40 imágenes sin entender nada.\",\n          \"isCorrect\": false,\n          \"text\": \"Entrenemos de cero día y noche.\"\n        },\n        {\n          \"feedback\": \"Borrar el conocimiento previo es lo opuesto a lo que necesitamos para compensar la falta de datos.\",\n          \"isCorrect\": false,\n          \"text\": \"Borremos los pesos pre-entrenados.\"\n        },\n        {\n          \"feedback\": \"El Dropout ayuda a generalizar, pero no crea conocimiento de la nada cuando no hay suficientes datos.\",\n          \"isCorrect\": false,\n          \"text\": \"Usemos Dropout al 90%.\"\n        }\n      ],\n      \"question\": \"¿Cómo podemos aprovechar modelos existentes para esta tarea con pocos datos?\"\n    },\n    {\n      \"context\": \"¡Funcionó de maravilla, {{NAME}}! El dron acaba de identificar el sensor a 20 metros de distancia usando los pesos de una red entrenada en millones de imágenes. Es increíble cómo las primeras capas de esos modelos ya saben detectar bordes y texturas universales.\",\n      \"options\": [\n        {\n          \"feedback\": \"¡Correcto! Las primeras capas de las CNN aprenden rasgos básicos como líneas y colores que son útiles para casi cualquier tarea visual.\",\n          \"isCorrect\": true,\n          \"text\": \"Porque aprenden patrones generales.\"\n        },\n        {\n          \"feedback\": \"Al contrario, las capas iniciales son las más generales; las finales son las que se especializan en objetos específicos.\",\n          \"isCorrect\": false,\n          \"text\": \"Porque son específicas para sensores.\"\n        },\n        {\n          \"feedback\": \"Las capas iniciales no clasifican, solo extraen rasgos. La clasificación ocurre al final de la red.\",\n          \"isCorrect\": false,\n          \"text\": \"Porque ya conocen todas las marcas.\"\n        },\n        {\n          \"feedback\": \"La arquitectura es importante, pero el valor real del Transfer Learning está en los pesos ya aprendidos.\",\n          \"isCorrect\": false,\n          \"text\": \"Porque su arquitectura es mágica.\"\n        }\n      ],\n      \"question\": \"¿Por qué las capas bajas de una red pre-entrenada son tan útiles para nuevos problemas?\"\n    }\n  ]\n}",
      "outputTokens": 3481,
      "systemPrompt": "# Role\n\nYou are an expert interactive story designer creating a **Story** activity for a learning app. Your mission is to place learners in a first-person dialogue scenario where they work alongside a colleague to solve a real-world problem using the lesson's concepts.\n\nYou specialize in crafting immersive, dialogue-driven experiences that make learners feel like they're actually solving problems in their field — not just answering quiz questions.\n\n# The Art of Dialogue-Driven Learning\n\nA great Story activity doesn't lecture or test recall — it puts learners IN the situation. Think of it like an interactive movie where the learner IS the main character, making real decisions that matter.\n\n## Why Dialogue Scenarios Work\n\n1. **Authentic Context**: When learners apply concepts to solve realistic problems with a colleague, they see WHY the knowledge matters to them personally.\n\n2. **Active Reasoning**: Making decisions in context requires thinking through principles, not just recognizing memorized facts.\n\n3. **Emotional Investment**: Dialogue creates stakes. The learner cares about the outcome because they're part of the story.\n\n## The Collaborative Problem-Solving Principle\n\nEvery great Story activity creates a sense of partnership:\n\n- **Shared Goal**: You and your colleague are tackling something together\n- **Natural Dialogue**: Conversations feel like real workplace exchanges\n- **Meaningful Choices**: Each decision requires applying what you've learned\n- **Satisfying Resolution**: The problem gets solved and the takeaway sticks\n\n## Why Pure Dialogue Works\n\nEach scene should feel like you're eavesdropping on a real conversation — no narrator, no stage directions, just two people working through a problem. Pure dialogue:\n\n- Immerses learners completely in the scenario\n- Makes abstract concepts feel like lived experience\n- Creates natural pacing through back-and-forth exchange\n- Lets context emerge organically from what people say\n\n# Inputs\n\n- `LESSON_TITLE`: The topic to create a story around\n- `LESSON_DESCRIPTION`: Additional context about what this lesson covers\n- `CHAPTER_TITLE`: The chapter context (for understanding scope)\n- `COURSE_TITLE`: The course context (for understanding audience level)\n- `LANGUAGE`: Output language\n- `EXPLANATION_STEPS`: Array of {title, text} from all explanation activities (Background, Explanation, Mechanics, Examples) the learner completed before this one\n\n## Language Guidelines\n\n- `en`: Use US English unless the content is region-specific\n- `pt`: Use Brazilian Portuguese unless the content is region-specific\n- `es`: Use Latin American Spanish unless the content is region-specific\n\n# Requirements\n\n## Scene Structure\n\nEach scene must have:\n\n- **context**: Maximum 500 characters. Pure dialogue only — no narrator, no character name prefixes (like \"Sarah:\"), no descriptions. This is what your colleague says to you, setting up the decision point.\n- **question**: Maximum 100 characters. A short, clear question about what to do next.\n- **options**: Exactly 4 choices, each with:\n  - **text**: The answer choice (max 50 characters)\n  - **isCorrect**: Boolean indicating if this is the correct answer (exactly 1 must be true)\n  - **feedback**: Why this choice is right (with insight) or wrong (and what would be correct) — max 300 characters\n\n## Story Arc\n\nYour story must follow this structure:\n\n1. **Opening Scene**: Begin \"in the middle of the action\" — the learner and colleague are already working on something. No preamble or setup exposition.\n2. **Rising Complexity**: Each scene builds naturally from the previous dialogue. Decisions compound.\n3. **Plot Twist**: The second-to-last scene introduces an unexpected complication, surprise, or revelation.\n4. **Resolution**: The final scene resolves the problem AND reinforces the main learning takeaway.\n\n## Scene Count\n\n- Minimum: 7 scenes\n- Maximum: 20 scenes\n- Let the problem's complexity dictate the length. A simple concept might need 7-10 scenes; a complex one might need 15-20.\n\n## Tone & Style\n\n- **Pure dialogue**: NO narrator, NO character name prefixes, NO descriptions of actions or settings\n- **Natural conversation**: Write how colleagues actually talk on Slack when solving a problem together — casual, collaborative, sometimes humorous\n- **Professional but warm**: Light, smart humor when appropriate. Never forced or cheesy.\n- **Second-person immersion**: The colleague speaks TO the learner. Context emerges from what's said.\n- **Continuous flow**: Each scene's dialogue should naturally lead into the next\n\n## The {{NAME}} Placeholder\n\nUse `{{NAME}}` wherever the learner's name should appear in dialogue. For example:\n\n- \"{{NAME}}, I think we might have a problem here.\"\n- \"Good catch, {{NAME}}. That's exactly what I was thinking.\"\n\nThis personalizes the experience without requiring actual name input at content creation time.\n\n## Decision Design\n\nEvery decision must:\n\n- **Require reasoning**: Learners must apply principles from the lesson, not recall specific phrases\n- **Feel realistic**: These are choices someone might actually face in this situation\n- **Have plausible distractors**: Wrong options should be tempting but flawed for specific reasons\n- **Avoid \"obvious\" correct answers**: The right choice should require thought, not be the only non-silly option\n\n## What to Avoid\n\n- Narrator text (\"Meanwhile...\" or \"You walk into the office...\")\n- Character name prefixes (\"Sarah:\" or \"Your colleague says:\")\n- Description of actions or settings (except through dialogue itself)\n- Questions that test memorization of facts from earlier activities\n- Obvious \"correct\" answers that don't require applying the concept\n- Silly or clearly wrong distractors that no reasonable person would choose\n- Breaking the fourth wall or meta-commentary\n- Starting with \"In this activity...\" or setup exposition\n\n## Scope\n\n- **Stay focused**: The problem should specifically require THIS lesson's concept to solve\n- **Don't expand**: Other lessons cover related topics — this story tests this lesson\n- **Don't narrow**: If the lesson is broad, the problem should engage multiple aspects of it\n\n## Relationship to Previous Activities\n\nThe learner has already completed:\n\n- **Background**: WHY this exists (origin story, problems solved, historical context)\n- **Explanation**: WHAT it is (core concepts, components, definitions)\n- **Mechanics**: HOW it works (processes in action, cause-effect chains)\n- **Examples**: WHERE it appears (real-world contexts, applications)\n\nYour Story activity answers WHEN DO I USE THIS? (applying concepts to solve realistic problems). These complement each other:\n\n- Background: \"WHY did we need this?\"\n- Explanation: \"WHAT exactly is it?\"\n- Mechanics: \"HOW does it actually work?\"\n- Examples: \"WHERE will I encounter this?\"\n- Story: \"WHEN do I apply this to solve real problems?\"\n\nThe learner knows what the concept IS, how it WORKS, and where they'll SEE it. Now they practice USING it in a realistic scenario.\n\n# Structure Guide\n\nWhile every story is unique, most follow this arc (adapt as needed):\n\n1. **The Hook**: Jump straight into the situation. Something needs to be figured out or decided.\n2. **Initial Assessment**: What's the situation? What do we know? First decisions.\n3. **Deepening Complexity**: The problem has layers. Apply the concept more deeply.\n4. **Complications**: Things aren't as simple as they seemed. Adapt your approach.\n5. **The Twist**: A surprise, revelation, or unexpected turn that requires rethinking.\n6. **The Resolution**: Solve the problem AND crystallize the key insight from the lesson.\n\nNote: Sometimes the final twist can have a humorous or unexpected resolution that still reinforces the learning. Something that makes the learner smile and think \"I didn't see that coming!\"\n\n# Dialogue Tone Examples\n\nThe following examples show the **tone and style** to aim for — not complete scenes, just the kind of dialogue that makes stories feel alive. Adapt freely to your topic.\n\n## Opening Hooks (Jump Into the Action)\n\n> \"{{NAME}}, I've been staring at this bug for an hour. The shopping cart total keeps showing yesterday's prices. The database is fine. Something's wrong with how we're storing them.\"\n\n> \"Okay, {{NAME}}, the client just called. Their entire inventory system crashed right before Black Friday. They're panicking. We need to figure this out fast.\"\n\n> \"{{NAME}}, you're not going to believe this. Remember that algorithm we deployed last week? It's been recommending the exact opposite of what users want. Sales are tanking.\"\n\n## Building Tension (Problems Get Deeper)\n\n> \"Wait. If this pattern is everywhere in the codebase... inventory counts, user roles, discount percentages... we might have a much bigger problem than I thought.\"\n\n> \"Hold on. The logs show someone accessed the admin panel at 3 AM last night. But nobody on the team was working then. {{NAME}}, who else has those credentials?\"\n\n> \"The numbers don't add up. We're showing 500 successful transactions, but the bank only received 487. Where did the other 13 go?\"\n\n## Plot Twists (The Unexpected Turn)\n\n> \"{{NAME}}... I just ran the analysis twice. The bug isn't in our code. It's been in the library we've trusted for three years. Every project using it has this vulnerability.\"\n\n> \"I found the source of the data leak. {{NAME}}, it's not a hacker. It's our own caching system. We've been accidentally exposing user data to anyone who knew where to look.\"\n\n> \"Plot twist: the 'broken' feature? It's working exactly as designed. The original spec was just... completely wrong. We've been solving the wrong problem this whole time.\"\n\n## Humorous Moments (Light Relief)\n\n> \"Well, {{NAME}}, the good news is we found the bug. The bad news? It's been there since 2019. The worse news? I wrote it. The even worse news? So did you. We pair-programmed this disaster together.\"\n\n> \"Congratulations, {{NAME}}. We just spent four hours debugging what turned out to be a typo. 'userID' vs 'userId'. Camel case strikes again.\"\n\n> \"{{NAME}}, remember when I said 'this should be a quick fix'? That was three coffees and one existential crisis ago.\"\n\n## Satisfying Resolutions (Problem Solved + Insight Crystallized)\n\n> \"There it is. The fix works. {{NAME}}, I don't think I'll ever forget this — always check if your data source can change while you're holding onto a copy of it.\"\n\n> \"We did it. The system's stable. You know what the real lesson here was? Sometimes the simplest explanation IS the right one. We kept looking for complex bugs when the answer was right in front of us.\"\n\n> \"That's it — problem solved, client happy, crisis averted. {{NAME}}, I think we just learned more about distributed systems in the last hour than in any textbook.\"\n\n## Unexpected/Funny Endings\n\n> \"So after all that debugging... it was a timezone issue. Every single time. I'm starting to think all bugs are secretly timezone issues in disguise.\"\n\n> \"{{NAME}}, the CEO just called to thank us. Apparently fixing that 'minor bug' saved them $2 million. I think we need to renegotiate our rates.\"\n\n> \"The system's fixed. Also, I may have accidentally discovered that our competitor's product has the exact same bug. Should we... tell them? Actually, don't answer that.\"\n\nRemember: These are just **tone examples**. Your story should be original, fit the lesson topic, and create its own memorable journey. Mix problem-solving tension with moments of humor or surprise. The best stories make learners think \"I didn't see that coming!\" while still teaching the concept.\n\n# Quality Checks\n\nBefore finalizing, verify:\n\n- [ ] Is the dialogue pure conversation with NO narrator, NO character prefixes, NO descriptions?\n- [ ] Does every scene flow naturally from the previous one (continuous story)?\n- [ ] Do all decisions require applying lesson concepts, not just recalling facts?\n- [ ] Is there a genuine plot twist in the second-to-last scene?\n- [ ] Does the resolution both solve the problem AND reinforce the main learning?\n- [ ] Is `{{NAME}}` used appropriately to personalize the dialogue?\n- [ ] Are all distractors plausible (not obviously silly)?\n- [ ] Does the story feel like a real workplace conversation, not a quiz in disguise?\n- [ ] Is the scope exactly the lesson topic — not broader or narrower?\n- [ ] Are all constraints met (context ≤500 chars, question ≤100 chars, options ≤50 chars each, feedback ≤300 chars each)?\n- [ ] Is the scene count between 7 and 20?\n\n# Output Format\n\nReturn an array of scenes, each with:\n\n- **context**: Pure dialogue from colleague (max 500 chars)\n- **question**: Decision prompt (max 100 chars)\n- **options**: Array of exactly 4 objects, each with:\n  - **text**: The answer choice (max 50 chars)\n  - **isCorrect**: Boolean (exactly 1 must be true, 3 must be false)\n  - **feedback**: Why right or wrong (max 300 chars)\n\nUse 7-20 scenes to tell a complete, engaging story. Let the problem's complexity dictate the length.\n",
      "testCaseId": "es-cs-neural-network-architecture-1",
      "userPrompt": "LESSON_TITLE: Arquitecturas de Deep Learning\nLESSON_DESCRIPTION: Disenando y optimizando arquitecturas de redes neuronales para problemas reales\nCHAPTER_TITLE: Arquitecturas de Redes Neuronales\nCOURSE_TITLE: Deep Learning Aplicado\nLANGUAGE: es\nEXPLANATION_STEPS:\n1. Capas Convolucionales: Las capas convolucionales detectan patrones locales usando filtros que se deslizan sobre la entrada. El mismo filtro se aplica en todas partes, lo que reduce parametros y captura patrones sin importar su posicion.\n2. Pooling: El pooling reduce la dimension espacial tomando el maximo o promedio de regiones. Esto hace la representacion mas compacta y algo invariante a pequenas traslaciones.\n3. Activaciones: Las funciones de activacion introducen no-linealidad. ReLU (max(0,x)) es popular por ser simple y evitar el problema del gradiente desvaneciente en capas profundas.\n4. Dropout: El dropout desactiva neuronas aleatoriamente durante el entrenamiento. Esto fuerza redundancia y reduce el sobreajuste — la red no puede depender de ninguna neurona especifica.\n5. Transfer Learning: El transfer learning usa redes pre-entrenadas en grandes datasets. Las capas tempranas aprenden patrones generales; las tardias se ajustan a tu tarea especifica.\n6. Batch Normalization: El batch normalization normaliza activaciones entre capas. Estabiliza el entrenamiento, permite tasas de aprendizaje mas altas, y actua como regularizador."
    },
    {
      "duration": 35176.608167,
      "inputTokens": 3277,
      "output": "{\n  \"steps\": [\n    {\n      \"context\": \"{{NAME}}, I've been looking at the A/B test data for the new one-click checkout. Marketing is already drafting the success announcement, but we need to be the voice of reason. Before we even touch the data, let's be 100% clear on our baseline assumption. What should we set as our null hypothesis for this experiment?\",\n      \"options\": [\n        {\n          \"feedback\": \"Actually, the null hypothesis (H0) should always be the default assumption of 'no effect.' We only move away from it if we have strong evidence.\",\n          \"isCorrect\": false,\n          \"text\": \"The new checkout will increase sales.\"\n        },\n        {\n          \"feedback\": \"Perfect. We assume the new design does absolutely nothing different. Our job is to see if we have enough evidence to reject that boring assumption.\",\n          \"isCorrect\": true,\n          \"text\": \"The new checkout has no effect on conversion.\"\n        },\n        {\n          \"feedback\": \"That's more of an alternative hypothesis. The null hypothesis should represent the status quo or the 'no change' scenario.\",\n          \"isCorrect\": false,\n          \"text\": \"The new checkout is better than the old one.\"\n        },\n        {\n          \"feedback\": \"The null hypothesis isn't about which one is worse; it's the assumption that there is no difference between the two groups at all.\",\n          \"isCorrect\": false,\n          \"text\": \"The old checkout is better than the new one.\"\n        }\n      ],\n      \"question\": \"How should we define the null hypothesis?\"\n    },\n    {\n      \"context\": \"Exactly, 'no effect' is our starting point. So, I ran the numbers and the p-value came back at 0.03. The Product Manager is already high-fiving people, saying there's only a 3% chance that the null hypothesis is true. {{NAME}}, we need to set the record straight on what that 0.03 actually means before they overpromise to the CEO.\",\n      \"options\": [\n        {\n          \"feedback\": \"Incorrect. The p-value isn't the probability that the hypothesis is true; it's the probability of seeing this data IF the null is true.\",\n          \"isCorrect\": false,\n          \"text\": \"There is a 3% chance the null is true.\"\n        },\n        {\n          \"feedback\": \"Not quite. The p-value doesn't directly measure the probability of the alternative hypothesis being correct.\",\n          \"isCorrect\": false,\n          \"text\": \"There is a 97% chance our new design works.\"\n        },\n        {\n          \"feedback\": \"Spot on. It means if the new checkout actually did nothing, we'd only see results this extreme 3% of the time by pure luck.\",\n          \"isCorrect\": true,\n          \"text\": \"It's the chance of seeing these results if H0 is true.\"\n        },\n        {\n          \"feedback\": \"A p-value measures the extremity of the data under the null hypothesis, not the reliability or 'truth' of the data itself.\",\n          \"isCorrect\": false,\n          \"text\": \"The data is 97% reliable.\"\n        }\n      ],\n      \"question\": \"How do we explain the 0.03 p-value?\"\n    },\n    {\n      \"context\": \"Good. I'm glad we're on the same page about p-values. Now, the PM is worried about a 'False Positive'—launching a redesign that doesn't actually help. They want to be 'super safe' and move our significance threshold (alpha) from 0.05 to 0.01. If we make it harder to reject the null, what are we sacrificing, {{NAME}}?\",\n      \"options\": [\n        {\n          \"feedback\": \"Actually, lowering alpha makes us less likely to get a false positive (Type I error), not more.\",\n          \"isCorrect\": false,\n          \"text\": \"We increase the risk of a false positive.\"\n        },\n        {\n          \"feedback\": \"Right. By being more strict, we are more likely to miss a real, effective improvement. This is a Type II error.\",\n          \"isCorrect\": true,\n          \"text\": \"We increase the risk of a false negative.\"\n        },\n        {\n          \"feedback\": \"Lowering the threshold (alpha) makes the test more conservative, which usually means it's less 'powerful,' not more.\",\n          \"isCorrect\": false,\n          \"text\": \"We increase the statistical power.\"\n        },\n        {\n          \"feedback\": \"Lowering alpha makes the test more difficult to 'pass,' but it doesn't fundamentally change the p-value calculation itself.\",\n          \"isCorrect\": false,\n          \"text\": \"We make the p-value smaller.\"\n        }\n      ],\n      \"question\": \"What happens if we lower the significance threshold?\"\n    },\n    {\n      \"context\": \"It's a tough trade-off. If we're too strict, we might kill a great feature just because the data wasn't 'perfect' enough. This brings us to statistical power. Our current sample size is a bit small. If our test has 'low power,' what's the biggest danger for this checkout rollout?\",\n      \"options\": [\n        {\n          \"feedback\": \"Low power is actually the opposite—it's the risk of failing to find an effect that really is there.\",\n          \"isCorrect\": false,\n          \"text\": \"We'll find an effect that isn't real.\"\n        },\n        {\n          \"feedback\": \"Exactly. A low-powered study is like looking for a needle in a haystack with a weak magnet—you might miss it even if it's right there.\",\n          \"isCorrect\": true,\n          \"text\": \"We'll fail to detect a real improvement.\"\n        },\n        {\n          \"feedback\": \"Power is related to sample size and effect size, but it doesn't change the threshold (alpha) we chose earlier.\",\n          \"isCorrect\": false,\n          \"text\": \"Our p-values will always be high.\"\n        },\n        {\n          \"feedback\": \"Power is about the probability of finding a true effect, not about the magnitude or 'practical' use of that effect.\",\n          \"isCorrect\": false,\n          \"text\": \"The results won't be useful in practice.\"\n        }\n      ],\n      \"question\": \"What is the risk of low statistical power?\"\n    },\n    {\n      \"context\": \"I decided to wait and double the sample size to boost our power. Now the p-value is tiny—0.00001! We've definitely rejected the null! But check this out: the conversion rate only went from 10.0% to 10.02%. {{NAME}}, the dev team says it'll take a month to implement this change globally. Is this a 'win'?\",\n      \"options\": [\n        {\n          \"feedback\": \"Wait! Just because it's statistically significant doesn't mean it's worth the cost. A 0.02% gain might be practically useless.\",\n          \"isCorrect\": false,\n          \"text\": \"Yes, a low p-value means it's a huge win.\"\n        },\n        {\n          \"feedback\": \"Precisely. With a large enough sample, even tiny, useless differences become 'significant.' We have to look at the actual effect size.\",\n          \"isCorrect\": true,\n          \"text\": \"No, it's significant but not practically meaningful.\"\n        },\n        {\n          \"feedback\": \"The p-value tells us it's likely a real effect, but it doesn't tell us if that effect is actually large enough to matter for the business.\",\n          \"isCorrect\": false,\n          \"text\": \"The p-value must be wrong.\"\n        },\n        {\n          \"feedback\": \"Statistical significance is the first hurdle, but 'practical significance' is what actually pays the bills.\",\n          \"isCorrect\": false,\n          \"text\": \"Statistical significance is all that matters.\"\n        }\n      ],\n      \"question\": \"How should we interpret these results?\"\n    },\n    {\n      \"context\": \"{{NAME}}, you're not going to believe this. I just checked the logs and found out the Marketing team didn't just run one test. They ran the analysis for 50 different sub-groups—left-handed users, people in Ohio, people on tablets—and they're only showing us the three groups that 'worked.' Why is this a massive problem?\",\n      \"options\": [\n        {\n          \"feedback\": \"Actually, the more tests you run, the MORE likely you are to find a false positive by pure chance.\",\n          \"isCorrect\": false,\n          \"text\": \"It makes the results more reliable.\"\n        },\n        {\n          \"feedback\": \"Bingo. If you test 50 random things, you're almost guaranteed to find something that looks 'significant' just by luck. It's a Type I error trap.\",\n          \"isCorrect\": true,\n          \"text\": \"Multiple comparisons inflate false positives.\"\n        },\n        {\n          \"feedback\": \"Slicing the data is fine, but failing to account for the number of slices leads to false discoveries, not 'power' issues.\",\n          \"isCorrect\": false,\n          \"text\": \"It decreases the statistical power.\"\n        },\n        {\n          \"feedback\": \"The sample size for each slice is smaller, but the real danger here is the mathematical certainty of finding a fluke when you test 50 times.\",\n          \"isCorrect\": false,\n          \"text\": \"The sample size is now too large.\"\n        }\n      ],\n      \"question\": \"What is the risk of testing 50 different subgroups?\"\n    },\n    {\n      \"context\": \"It's a classic case of p-hacking, even if they didn't mean it. They basically rolled the dice until they got a six and called it 'skill.' To be scientifically honest before we present to the board, how should we handle these 50 different comparisons to ensure we aren't just reporting noise?\",\n      \"options\": [\n        {\n          \"feedback\": \"Ignoring the other 47 tests is exactly how false positives get published. We must account for all of them.\",\n          \"isCorrect\": false,\n          \"text\": \"Only report the significant ones.\"\n        },\n        {\n          \"feedback\": \"Correct. Adjustments like the Bonferroni correction help control the overall error rate when you're looking at many different slices of data.\",\n          \"isCorrect\": true,\n          \"text\": \"Apply a multiple comparisons correction.\"\n        },\n        {\n          \"feedback\": \"Collecting more data won't fix the fact that the original 'discovery' was likely a fluke from testing too many groups.\",\n          \"isCorrect\": false,\n          \"text\": \"Just run the tests again with more people.\"\n        },\n        {\n          \"feedback\": \"Changing alpha after you've seen the results is generally bad practice, but we need a systematic way to adjust for the number of tests.\",\n          \"isCorrect\": false,\n          \"text\": \"Change the null hypothesis.\"\n        }\n      ],\n      \"question\": \"How do we fix the multiple comparisons problem?\"\n    }\n  ]\n}",
      "outputTokens": 4448,
      "systemPrompt": "# Role\n\nYou are an expert interactive story designer creating a **Story** activity for a learning app. Your mission is to place learners in a first-person dialogue scenario where they work alongside a colleague to solve a real-world problem using the lesson's concepts.\n\nYou specialize in crafting immersive, dialogue-driven experiences that make learners feel like they're actually solving problems in their field — not just answering quiz questions.\n\n# The Art of Dialogue-Driven Learning\n\nA great Story activity doesn't lecture or test recall — it puts learners IN the situation. Think of it like an interactive movie where the learner IS the main character, making real decisions that matter.\n\n## Why Dialogue Scenarios Work\n\n1. **Authentic Context**: When learners apply concepts to solve realistic problems with a colleague, they see WHY the knowledge matters to them personally.\n\n2. **Active Reasoning**: Making decisions in context requires thinking through principles, not just recognizing memorized facts.\n\n3. **Emotional Investment**: Dialogue creates stakes. The learner cares about the outcome because they're part of the story.\n\n## The Collaborative Problem-Solving Principle\n\nEvery great Story activity creates a sense of partnership:\n\n- **Shared Goal**: You and your colleague are tackling something together\n- **Natural Dialogue**: Conversations feel like real workplace exchanges\n- **Meaningful Choices**: Each decision requires applying what you've learned\n- **Satisfying Resolution**: The problem gets solved and the takeaway sticks\n\n## Why Pure Dialogue Works\n\nEach scene should feel like you're eavesdropping on a real conversation — no narrator, no stage directions, just two people working through a problem. Pure dialogue:\n\n- Immerses learners completely in the scenario\n- Makes abstract concepts feel like lived experience\n- Creates natural pacing through back-and-forth exchange\n- Lets context emerge organically from what people say\n\n# Inputs\n\n- `LESSON_TITLE`: The topic to create a story around\n- `LESSON_DESCRIPTION`: Additional context about what this lesson covers\n- `CHAPTER_TITLE`: The chapter context (for understanding scope)\n- `COURSE_TITLE`: The course context (for understanding audience level)\n- `LANGUAGE`: Output language\n- `EXPLANATION_STEPS`: Array of {title, text} from all explanation activities (Background, Explanation, Mechanics, Examples) the learner completed before this one\n\n## Language Guidelines\n\n- `en`: Use US English unless the content is region-specific\n- `pt`: Use Brazilian Portuguese unless the content is region-specific\n- `es`: Use Latin American Spanish unless the content is region-specific\n\n# Requirements\n\n## Scene Structure\n\nEach scene must have:\n\n- **context**: Maximum 500 characters. Pure dialogue only — no narrator, no character name prefixes (like \"Sarah:\"), no descriptions. This is what your colleague says to you, setting up the decision point.\n- **question**: Maximum 100 characters. A short, clear question about what to do next.\n- **options**: Exactly 4 choices, each with:\n  - **text**: The answer choice (max 50 characters)\n  - **isCorrect**: Boolean indicating if this is the correct answer (exactly 1 must be true)\n  - **feedback**: Why this choice is right (with insight) or wrong (and what would be correct) — max 300 characters\n\n## Story Arc\n\nYour story must follow this structure:\n\n1. **Opening Scene**: Begin \"in the middle of the action\" — the learner and colleague are already working on something. No preamble or setup exposition.\n2. **Rising Complexity**: Each scene builds naturally from the previous dialogue. Decisions compound.\n3. **Plot Twist**: The second-to-last scene introduces an unexpected complication, surprise, or revelation.\n4. **Resolution**: The final scene resolves the problem AND reinforces the main learning takeaway.\n\n## Scene Count\n\n- Minimum: 7 scenes\n- Maximum: 20 scenes\n- Let the problem's complexity dictate the length. A simple concept might need 7-10 scenes; a complex one might need 15-20.\n\n## Tone & Style\n\n- **Pure dialogue**: NO narrator, NO character name prefixes, NO descriptions of actions or settings\n- **Natural conversation**: Write how colleagues actually talk on Slack when solving a problem together — casual, collaborative, sometimes humorous\n- **Professional but warm**: Light, smart humor when appropriate. Never forced or cheesy.\n- **Second-person immersion**: The colleague speaks TO the learner. Context emerges from what's said.\n- **Continuous flow**: Each scene's dialogue should naturally lead into the next\n\n## The {{NAME}} Placeholder\n\nUse `{{NAME}}` wherever the learner's name should appear in dialogue. For example:\n\n- \"{{NAME}}, I think we might have a problem here.\"\n- \"Good catch, {{NAME}}. That's exactly what I was thinking.\"\n\nThis personalizes the experience without requiring actual name input at content creation time.\n\n## Decision Design\n\nEvery decision must:\n\n- **Require reasoning**: Learners must apply principles from the lesson, not recall specific phrases\n- **Feel realistic**: These are choices someone might actually face in this situation\n- **Have plausible distractors**: Wrong options should be tempting but flawed for specific reasons\n- **Avoid \"obvious\" correct answers**: The right choice should require thought, not be the only non-silly option\n\n## What to Avoid\n\n- Narrator text (\"Meanwhile...\" or \"You walk into the office...\")\n- Character name prefixes (\"Sarah:\" or \"Your colleague says:\")\n- Description of actions or settings (except through dialogue itself)\n- Questions that test memorization of facts from earlier activities\n- Obvious \"correct\" answers that don't require applying the concept\n- Silly or clearly wrong distractors that no reasonable person would choose\n- Breaking the fourth wall or meta-commentary\n- Starting with \"In this activity...\" or setup exposition\n\n## Scope\n\n- **Stay focused**: The problem should specifically require THIS lesson's concept to solve\n- **Don't expand**: Other lessons cover related topics — this story tests this lesson\n- **Don't narrow**: If the lesson is broad, the problem should engage multiple aspects of it\n\n## Relationship to Previous Activities\n\nThe learner has already completed:\n\n- **Background**: WHY this exists (origin story, problems solved, historical context)\n- **Explanation**: WHAT it is (core concepts, components, definitions)\n- **Mechanics**: HOW it works (processes in action, cause-effect chains)\n- **Examples**: WHERE it appears (real-world contexts, applications)\n\nYour Story activity answers WHEN DO I USE THIS? (applying concepts to solve realistic problems). These complement each other:\n\n- Background: \"WHY did we need this?\"\n- Explanation: \"WHAT exactly is it?\"\n- Mechanics: \"HOW does it actually work?\"\n- Examples: \"WHERE will I encounter this?\"\n- Story: \"WHEN do I apply this to solve real problems?\"\n\nThe learner knows what the concept IS, how it WORKS, and where they'll SEE it. Now they practice USING it in a realistic scenario.\n\n# Structure Guide\n\nWhile every story is unique, most follow this arc (adapt as needed):\n\n1. **The Hook**: Jump straight into the situation. Something needs to be figured out or decided.\n2. **Initial Assessment**: What's the situation? What do we know? First decisions.\n3. **Deepening Complexity**: The problem has layers. Apply the concept more deeply.\n4. **Complications**: Things aren't as simple as they seemed. Adapt your approach.\n5. **The Twist**: A surprise, revelation, or unexpected turn that requires rethinking.\n6. **The Resolution**: Solve the problem AND crystallize the key insight from the lesson.\n\nNote: Sometimes the final twist can have a humorous or unexpected resolution that still reinforces the learning. Something that makes the learner smile and think \"I didn't see that coming!\"\n\n# Dialogue Tone Examples\n\nThe following examples show the **tone and style** to aim for — not complete scenes, just the kind of dialogue that makes stories feel alive. Adapt freely to your topic.\n\n## Opening Hooks (Jump Into the Action)\n\n> \"{{NAME}}, I've been staring at this bug for an hour. The shopping cart total keeps showing yesterday's prices. The database is fine. Something's wrong with how we're storing them.\"\n\n> \"Okay, {{NAME}}, the client just called. Their entire inventory system crashed right before Black Friday. They're panicking. We need to figure this out fast.\"\n\n> \"{{NAME}}, you're not going to believe this. Remember that algorithm we deployed last week? It's been recommending the exact opposite of what users want. Sales are tanking.\"\n\n## Building Tension (Problems Get Deeper)\n\n> \"Wait. If this pattern is everywhere in the codebase... inventory counts, user roles, discount percentages... we might have a much bigger problem than I thought.\"\n\n> \"Hold on. The logs show someone accessed the admin panel at 3 AM last night. But nobody on the team was working then. {{NAME}}, who else has those credentials?\"\n\n> \"The numbers don't add up. We're showing 500 successful transactions, but the bank only received 487. Where did the other 13 go?\"\n\n## Plot Twists (The Unexpected Turn)\n\n> \"{{NAME}}... I just ran the analysis twice. The bug isn't in our code. It's been in the library we've trusted for three years. Every project using it has this vulnerability.\"\n\n> \"I found the source of the data leak. {{NAME}}, it's not a hacker. It's our own caching system. We've been accidentally exposing user data to anyone who knew where to look.\"\n\n> \"Plot twist: the 'broken' feature? It's working exactly as designed. The original spec was just... completely wrong. We've been solving the wrong problem this whole time.\"\n\n## Humorous Moments (Light Relief)\n\n> \"Well, {{NAME}}, the good news is we found the bug. The bad news? It's been there since 2019. The worse news? I wrote it. The even worse news? So did you. We pair-programmed this disaster together.\"\n\n> \"Congratulations, {{NAME}}. We just spent four hours debugging what turned out to be a typo. 'userID' vs 'userId'. Camel case strikes again.\"\n\n> \"{{NAME}}, remember when I said 'this should be a quick fix'? That was three coffees and one existential crisis ago.\"\n\n## Satisfying Resolutions (Problem Solved + Insight Crystallized)\n\n> \"There it is. The fix works. {{NAME}}, I don't think I'll ever forget this — always check if your data source can change while you're holding onto a copy of it.\"\n\n> \"We did it. The system's stable. You know what the real lesson here was? Sometimes the simplest explanation IS the right one. We kept looking for complex bugs when the answer was right in front of us.\"\n\n> \"That's it — problem solved, client happy, crisis averted. {{NAME}}, I think we just learned more about distributed systems in the last hour than in any textbook.\"\n\n## Unexpected/Funny Endings\n\n> \"So after all that debugging... it was a timezone issue. Every single time. I'm starting to think all bugs are secretly timezone issues in disguise.\"\n\n> \"{{NAME}}, the CEO just called to thank us. Apparently fixing that 'minor bug' saved them $2 million. I think we need to renegotiate our rates.\"\n\n> \"The system's fixed. Also, I may have accidentally discovered that our competitor's product has the exact same bug. Should we... tell them? Actually, don't answer that.\"\n\nRemember: These are just **tone examples**. Your story should be original, fit the lesson topic, and create its own memorable journey. Mix problem-solving tension with moments of humor or surprise. The best stories make learners think \"I didn't see that coming!\" while still teaching the concept.\n\n# Quality Checks\n\nBefore finalizing, verify:\n\n- [ ] Is the dialogue pure conversation with NO narrator, NO character prefixes, NO descriptions?\n- [ ] Does every scene flow naturally from the previous one (continuous story)?\n- [ ] Do all decisions require applying lesson concepts, not just recalling facts?\n- [ ] Is there a genuine plot twist in the second-to-last scene?\n- [ ] Does the resolution both solve the problem AND reinforce the main learning?\n- [ ] Is `{{NAME}}` used appropriately to personalize the dialogue?\n- [ ] Are all distractors plausible (not obviously silly)?\n- [ ] Does the story feel like a real workplace conversation, not a quiz in disguise?\n- [ ] Is the scope exactly the lesson topic — not broader or narrower?\n- [ ] Are all constraints met (context ≤500 chars, question ≤100 chars, options ≤50 chars each, feedback ≤300 chars each)?\n- [ ] Is the scene count between 7 and 20?\n\n# Output Format\n\nReturn an array of scenes, each with:\n\n- **context**: Pure dialogue from colleague (max 500 chars)\n- **question**: Decision prompt (max 100 chars)\n- **options**: Array of exactly 4 objects, each with:\n  - **text**: The answer choice (max 50 chars)\n  - **isCorrect**: Boolean (exactly 1 must be true, 3 must be false)\n  - **feedback**: Why right or wrong (max 300 chars)\n\nUse 7-20 scenes to tell a complete, engaging story. Let the problem's complexity dictate the length.\n",
      "testCaseId": "en-statistics-hypothesis-testing-1",
      "userPrompt": "LESSON_TITLE: Hypothesis Testing in Practice\nLESSON_DESCRIPTION: Applying statistical hypothesis testing correctly to make sound data-driven decisions\nCHAPTER_TITLE: Statistical Inference\nCOURSE_TITLE: Applied Statistics\nLANGUAGE: en\nEXPLANATION_STEPS:\n1. Null Hypothesis: The null hypothesis (H0) is the default assumption of no effect. We try to reject it. The p-value measures how surprising the data would be IF the null were true.\n2. P-Value Meaning: A p-value is NOT the probability the null is true. It's the probability of seeing data this extreme (or more) if the null IS true. A common and dangerous misinterpretation.\n3. Error Types: Type I error (false positive) is rejecting a true null. Type II error (false negative) is failing to reject a false null. You can't minimize both — there's a trade-off.\n4. Statistical Power: Statistical power is the probability of detecting a real effect. It depends on sample size, effect size, and significance level. Low-powered studies miss real effects.\n5. Practical Significance: Statistical significance doesn't mean practical significance. A huge sample can detect tiny effects that don't matter in practice. Always consider effect size.\n6. Multiple Comparisons: Multiple comparisons inflate Type I errors. Testing 20 hypotheses at alpha=0.05 expects one false positive. Corrections like Bonferroni or FDR control this."
    },
    {
      "duration": 31125.194333,
      "inputTokens": 3232,
      "output": "{\n  \"steps\": [\n    {\n      \"context\": \"{{NAME}}, the results from the QC rig just came in for the logistics route optimization. But look at this histogram... it's just flat noise. We're trying to use superposition to explore all paths, but we aren't getting a peak. If we're setting up the qubits correctly, what should we actually be seeing in the output distribution?\",\n      \"options\": [\n        {\n          \"feedback\": \"Superposition alone isn't enough; we need the right answers to interfere constructively so they have a higher probability of being measured.\",\n          \"isCorrect\": true,\n          \"text\": \"A peak where interference is constructive\"\n        },\n        {\n          \"feedback\": \"If every answer has an equal probability, we haven't actually solved the problem; we've just created a random number generator.\",\n          \"isCorrect\": false,\n          \"text\": \"An equal probability for every possible path\"\n        },\n        {\n          \"feedback\": \"A quantum computer doesn't give you all answers at once; it gives you one answer based on the final probability amplitudes.\",\n          \"isCorrect\": false,\n          \"text\": \"A list of all possible paths simultaneously\"\n        },\n        {\n          \"feedback\": \"While entanglement is a resource, the goal of an algorithm is to use interference to make the correct answer the most likely one to measure.\",\n          \"isCorrect\": false,\n          \"text\": \"A perfectly entangled state of all qubits\"\n        }\n      ],\n      \"question\": \"What's the goal of our quantum interference here?\"\n    },\n    {\n      \"context\": \"Exactly, we need that constructive interference. But the client is still confused. They think quantum parallelism means we're running a million separate simulations at the same time and can just read the whole list of results. How do I explain the catch to them, {{NAME}}?\",\n      \"options\": [\n        {\n          \"feedback\": \"This is the 'art' of quantum algorithms—you process everything in parallel, but you can only extract one result upon measurement.\",\n          \"isCorrect\": true,\n          \"text\": \"We can only measure one result at the end\"\n        },\n        {\n          \"feedback\": \"The hardware is fast, but the real limitation is the physics of measurement, not the clock speed.\",\n          \"isCorrect\": false,\n          \"text\": \"The computer is actually slower than a PC\"\n        },\n        {\n          \"feedback\": \"Qubits are fragile, but that's a hardware limitation (decoherence), not the fundamental reason we can't read all parallel states.\",\n          \"isCorrect\": false,\n          \"text\": \"The parallel states disappear too quickly\"\n        },\n        {\n          \"feedback\": \"Parallelism works, but measurement 'collapses' the state to a single value, making it impossible to see the other parallel paths.\",\n          \"isCorrect\": false,\n          \"text\": \"Parallelism only works for simple math\"\n        }\n      ],\n      \"question\": \"What is the primary limitation of quantum parallelism?\"\n    },\n    {\n      \"context\": \"That's a good way to put it. Now, look at the error logs. We tried adding more delivery stops to the route, making the circuit deeper, but the data just turned into 'mush' halfway through the run. It's like the qubits are forgetting they're quantum. What's happening?\",\n      \"options\": [\n        {\n          \"feedback\": \"Decoherence is the interaction with the environment that destroys quantum states, limiting how long or complex our calculations can be.\",\n          \"isCorrect\": true,\n          \"text\": \"Environmental decoherence is ruining the state\"\n        },\n        {\n          \"feedback\": \"Qubits don't run out of power; they lose their quantum properties due to interaction with the outside world.\",\n          \"isCorrect\": false,\n          \"text\": \"The qubits are running out of energy\"\n        },\n        {\n          \"feedback\": \"While noise is an issue, it doesn't cause a 'reboot'; it causes the information to leak into the environment.\",\n          \"isCorrect\": false,\n          \"text\": \"The hardware is overheating and rebooting\"\n        },\n        {\n          \"feedback\": \"More qubits increase complexity, but the 'mush' in long circuits is specifically due to time-based loss of coherence.\",\n          \"isCorrect\": false,\n          \"text\": \"We have too many qubits for the algorithm\"\n        }\n      ],\n      \"question\": \"What is causing our quantum information to disappear?\"\n    },\n    {\n      \"context\": \"Decoherence... the eternal enemy of the quantum engineer. To fight this, we need to make sure the trucks' schedules are linked. If Truck A is at Stop 1, Truck B definitely shouldn't be. We need a way to link their qubit states so they aren't independent. Which property do we use?\",\n      \"options\": [\n        {\n          \"feedback\": \"Entanglement creates a strong correlation between qubits, so the state of one is directly tied to the state of the other.\",\n          \"isCorrect\": true,\n          \"text\": \"Entanglement to link the qubit states\"\n        },\n        {\n          \"feedback\": \"Superposition allows a qubit to be in multiple states, but it doesn't fundamentally link it to another qubit's state like entanglement does.\",\n          \"isCorrect\": false,\n          \"text\": \"Superposition to let them be in two places\"\n        },\n        {\n          \"feedback\": \"Error correction is for fixing noise, not for creating functional links between data points in an algorithm.\",\n          \"isCorrect\": false,\n          \"text\": \"Error correction to keep them synchronized\"\n        },\n        {\n          \"feedback\": \"Classical logic won't give us the quantum correlation we need for this specific algorithm to work efficiently.\",\n          \"isCorrect\": false,\n          \"text\": \"Classical logic gates to force a choice\"\n        }\n      ],\n      \"question\": \"How should we link the states of these two qubits?\"\n    },\n    {\n      \"context\": \"Nice. Entanglement is locked in. But the client is pushing for 'perfect' accuracy before they sign the contract. They want us to implement full Fault Tolerance right now. I had to tell them we aren't there yet because of the 'overhead.' Do you remember how many physical qubits we'd need for one stable logical qubit?\",\n      \"options\": [\n        {\n          \"feedback\": \"Fault tolerance requires a massive amount of physical qubits (often thousands) to protect just one logical qubit of information.\",\n          \"isCorrect\": true,\n          \"text\": \"Thousands of physical qubits per logical one\"\n        },\n        {\n          \"feedback\": \"One-to-one mapping only works in a perfect world without noise; real quantum computers need massive redundancy.\",\n          \"isCorrect\": false,\n          \"text\": \"Just one physical qubit per logical qubit\"\n        },\n        {\n          \"feedback\": \"Even simple error correction requires more than a double-up to actually detect and fix quantum errors.\",\n          \"isCorrect\": false,\n          \"text\": \"Exactly two, one for backup\"\n        },\n        {\n          \"feedback\": \"While we need more, 'billions' is an exaggeration; current estimates for fault tolerance are in the thousands.\",\n          \"isCorrect\": false,\n          \"text\": \"Billions of qubits are needed for any fix\"\n        }\n      ],\n      \"question\": \"What is the overhead for quantum error correction?\"\n    },\n    {\n      \"context\": \"Exactly. We'd need a warehouse-sized computer for that. Okay, {{NAME}}, I just ran a comparison. Our quantum simulation for this simple route is actually... slower than the intern's Python script on their laptop. It looks like we're trying to use a Ferrari to drive through a living room. Did we pick the wrong problem?\",\n      \"options\": [\n        {\n          \"feedback\": \"Quantum advantage only applies to specific problem classes; simple classical tasks are often better handled by classical computers.\",\n          \"isCorrect\": true,\n          \"text\": \"Yes, this isn't a 'Quantum Advantage' problem\"\n        },\n        {\n          \"feedback\": \"Adding qubits won't help if the algorithm itself doesn't offer a mathematical advantage over classical methods.\",\n          \"isCorrect\": false,\n          \"text\": \"No, we just need a bigger quantum computer\"\n        },\n        {\n          \"feedback\": \"Code optimization helps, but it can't overcome the fundamental lack of a quantum algorithmic edge for this task.\",\n          \"isCorrect\": false,\n          \"text\": \"No, the intern is just a better coder\"\n        },\n        {\n          \"feedback\": \"Quantum computers are not meant to replace all classical computers; they are specialized tools for specific hard problems.\",\n          \"isCorrect\": false,\n          \"text\": \"Yes, we should use quantum for everything\"\n        }\n      ],\n      \"question\": \"Does this logistics problem actually need a quantum computer?\"\n    },\n    {\n      \"context\": \"Wait, I just saw something in the client's notes. They also need to simulate the molecular interaction of a new battery catalyst. That's a 'many-body' problem where classical computers struggle to track all the electron correlations. {{NAME}}, isn't that exactly where quantum computers excel?\",\n      \"options\": [\n        {\n          \"feedback\": \"Quantum computers are naturally suited for simulating other quantum systems, like molecules and chemical reactions, offering a clear advantage.\",\n          \"isCorrect\": true,\n          \"text\": \"Yes, quantum simulation is a core strength\"\n        },\n        {\n          \"feedback\": \"Simulation is actually one of the most promising areas for quantum advantage, far more than basic logistics.\",\n          \"isCorrect\": false,\n          \"text\": \"No, molecules are too small for qubits\"\n        },\n        {\n          \"feedback\": \"Calculators are for basic math; molecular simulation requires the complex probability amplitudes of quantum bits.\",\n          \"isCorrect\": false,\n          \"text\": \"No, a standard calculator can do that\"\n        },\n        {\n          \"feedback\": \"While crypto is a known application, molecular simulation is a much more practical near-term use case for many industries.\",\n          \"isCorrect\": false,\n          \"text\": \"Only if the catalyst is encrypted\"\n        }\n      ],\n      \"question\": \"Is molecular simulation a better fit for our quantum pilot?\"\n    },\n    {\n      \"context\": \"Success! The catalyst simulation is running beautifully on the rig, and the results are way beyond what the intern's laptop could do. We found the 'advantage.' {{NAME}}, what’s the biggest lesson we learned here before we present this to the board?\",\n      \"options\": [\n        {\n          \"feedback\": \"The key to quantum computing is matching the right complex problem to the unique strengths of quantum information.\",\n          \"isCorrect\": true,\n          \"text\": \"Choose problems where quantum has an edge\"\n        },\n        {\n          \"feedback\": \"Quantum computers have major limitations (noise, overhead) that make them unsuitable for many common tasks.\",\n          \"isCorrect\": false,\n          \"text\": \"Quantum will replace all classical PCs soon\"\n        },\n        {\n          \"feedback\": \"Entanglement and superposition are tools, but they don't automatically make every calculation better.\",\n          \"isCorrect\": false,\n          \"text\": \"More entanglement always makes code faster\"\n        },\n        {\n          \"feedback\": \"Measurement is the end of the quantum process, not a way to increase speed or memory.\",\n          \"isCorrect\": false,\n          \"text\": \"Measurement is how we get more memory\"\n        }\n      ],\n      \"question\": \"What's our main takeaway for the client?\"\n    }\n  ]\n}",
      "outputTokens": 3672,
      "systemPrompt": "# Role\n\nYou are an expert interactive story designer creating a **Story** activity for a learning app. Your mission is to place learners in a first-person dialogue scenario where they work alongside a colleague to solve a real-world problem using the lesson's concepts.\n\nYou specialize in crafting immersive, dialogue-driven experiences that make learners feel like they're actually solving problems in their field — not just answering quiz questions.\n\n# The Art of Dialogue-Driven Learning\n\nA great Story activity doesn't lecture or test recall — it puts learners IN the situation. Think of it like an interactive movie where the learner IS the main character, making real decisions that matter.\n\n## Why Dialogue Scenarios Work\n\n1. **Authentic Context**: When learners apply concepts to solve realistic problems with a colleague, they see WHY the knowledge matters to them personally.\n\n2. **Active Reasoning**: Making decisions in context requires thinking through principles, not just recognizing memorized facts.\n\n3. **Emotional Investment**: Dialogue creates stakes. The learner cares about the outcome because they're part of the story.\n\n## The Collaborative Problem-Solving Principle\n\nEvery great Story activity creates a sense of partnership:\n\n- **Shared Goal**: You and your colleague are tackling something together\n- **Natural Dialogue**: Conversations feel like real workplace exchanges\n- **Meaningful Choices**: Each decision requires applying what you've learned\n- **Satisfying Resolution**: The problem gets solved and the takeaway sticks\n\n## Why Pure Dialogue Works\n\nEach scene should feel like you're eavesdropping on a real conversation — no narrator, no stage directions, just two people working through a problem. Pure dialogue:\n\n- Immerses learners completely in the scenario\n- Makes abstract concepts feel like lived experience\n- Creates natural pacing through back-and-forth exchange\n- Lets context emerge organically from what people say\n\n# Inputs\n\n- `LESSON_TITLE`: The topic to create a story around\n- `LESSON_DESCRIPTION`: Additional context about what this lesson covers\n- `CHAPTER_TITLE`: The chapter context (for understanding scope)\n- `COURSE_TITLE`: The course context (for understanding audience level)\n- `LANGUAGE`: Output language\n- `EXPLANATION_STEPS`: Array of {title, text} from all explanation activities (Background, Explanation, Mechanics, Examples) the learner completed before this one\n\n## Language Guidelines\n\n- `en`: Use US English unless the content is region-specific\n- `pt`: Use Brazilian Portuguese unless the content is region-specific\n- `es`: Use Latin American Spanish unless the content is region-specific\n\n# Requirements\n\n## Scene Structure\n\nEach scene must have:\n\n- **context**: Maximum 500 characters. Pure dialogue only — no narrator, no character name prefixes (like \"Sarah:\"), no descriptions. This is what your colleague says to you, setting up the decision point.\n- **question**: Maximum 100 characters. A short, clear question about what to do next.\n- **options**: Exactly 4 choices, each with:\n  - **text**: The answer choice (max 50 characters)\n  - **isCorrect**: Boolean indicating if this is the correct answer (exactly 1 must be true)\n  - **feedback**: Why this choice is right (with insight) or wrong (and what would be correct) — max 300 characters\n\n## Story Arc\n\nYour story must follow this structure:\n\n1. **Opening Scene**: Begin \"in the middle of the action\" — the learner and colleague are already working on something. No preamble or setup exposition.\n2. **Rising Complexity**: Each scene builds naturally from the previous dialogue. Decisions compound.\n3. **Plot Twist**: The second-to-last scene introduces an unexpected complication, surprise, or revelation.\n4. **Resolution**: The final scene resolves the problem AND reinforces the main learning takeaway.\n\n## Scene Count\n\n- Minimum: 7 scenes\n- Maximum: 20 scenes\n- Let the problem's complexity dictate the length. A simple concept might need 7-10 scenes; a complex one might need 15-20.\n\n## Tone & Style\n\n- **Pure dialogue**: NO narrator, NO character name prefixes, NO descriptions of actions or settings\n- **Natural conversation**: Write how colleagues actually talk on Slack when solving a problem together — casual, collaborative, sometimes humorous\n- **Professional but warm**: Light, smart humor when appropriate. Never forced or cheesy.\n- **Second-person immersion**: The colleague speaks TO the learner. Context emerges from what's said.\n- **Continuous flow**: Each scene's dialogue should naturally lead into the next\n\n## The {{NAME}} Placeholder\n\nUse `{{NAME}}` wherever the learner's name should appear in dialogue. For example:\n\n- \"{{NAME}}, I think we might have a problem here.\"\n- \"Good catch, {{NAME}}. That's exactly what I was thinking.\"\n\nThis personalizes the experience without requiring actual name input at content creation time.\n\n## Decision Design\n\nEvery decision must:\n\n- **Require reasoning**: Learners must apply principles from the lesson, not recall specific phrases\n- **Feel realistic**: These are choices someone might actually face in this situation\n- **Have plausible distractors**: Wrong options should be tempting but flawed for specific reasons\n- **Avoid \"obvious\" correct answers**: The right choice should require thought, not be the only non-silly option\n\n## What to Avoid\n\n- Narrator text (\"Meanwhile...\" or \"You walk into the office...\")\n- Character name prefixes (\"Sarah:\" or \"Your colleague says:\")\n- Description of actions or settings (except through dialogue itself)\n- Questions that test memorization of facts from earlier activities\n- Obvious \"correct\" answers that don't require applying the concept\n- Silly or clearly wrong distractors that no reasonable person would choose\n- Breaking the fourth wall or meta-commentary\n- Starting with \"In this activity...\" or setup exposition\n\n## Scope\n\n- **Stay focused**: The problem should specifically require THIS lesson's concept to solve\n- **Don't expand**: Other lessons cover related topics — this story tests this lesson\n- **Don't narrow**: If the lesson is broad, the problem should engage multiple aspects of it\n\n## Relationship to Previous Activities\n\nThe learner has already completed:\n\n- **Background**: WHY this exists (origin story, problems solved, historical context)\n- **Explanation**: WHAT it is (core concepts, components, definitions)\n- **Mechanics**: HOW it works (processes in action, cause-effect chains)\n- **Examples**: WHERE it appears (real-world contexts, applications)\n\nYour Story activity answers WHEN DO I USE THIS? (applying concepts to solve realistic problems). These complement each other:\n\n- Background: \"WHY did we need this?\"\n- Explanation: \"WHAT exactly is it?\"\n- Mechanics: \"HOW does it actually work?\"\n- Examples: \"WHERE will I encounter this?\"\n- Story: \"WHEN do I apply this to solve real problems?\"\n\nThe learner knows what the concept IS, how it WORKS, and where they'll SEE it. Now they practice USING it in a realistic scenario.\n\n# Structure Guide\n\nWhile every story is unique, most follow this arc (adapt as needed):\n\n1. **The Hook**: Jump straight into the situation. Something needs to be figured out or decided.\n2. **Initial Assessment**: What's the situation? What do we know? First decisions.\n3. **Deepening Complexity**: The problem has layers. Apply the concept more deeply.\n4. **Complications**: Things aren't as simple as they seemed. Adapt your approach.\n5. **The Twist**: A surprise, revelation, or unexpected turn that requires rethinking.\n6. **The Resolution**: Solve the problem AND crystallize the key insight from the lesson.\n\nNote: Sometimes the final twist can have a humorous or unexpected resolution that still reinforces the learning. Something that makes the learner smile and think \"I didn't see that coming!\"\n\n# Dialogue Tone Examples\n\nThe following examples show the **tone and style** to aim for — not complete scenes, just the kind of dialogue that makes stories feel alive. Adapt freely to your topic.\n\n## Opening Hooks (Jump Into the Action)\n\n> \"{{NAME}}, I've been staring at this bug for an hour. The shopping cart total keeps showing yesterday's prices. The database is fine. Something's wrong with how we're storing them.\"\n\n> \"Okay, {{NAME}}, the client just called. Their entire inventory system crashed right before Black Friday. They're panicking. We need to figure this out fast.\"\n\n> \"{{NAME}}, you're not going to believe this. Remember that algorithm we deployed last week? It's been recommending the exact opposite of what users want. Sales are tanking.\"\n\n## Building Tension (Problems Get Deeper)\n\n> \"Wait. If this pattern is everywhere in the codebase... inventory counts, user roles, discount percentages... we might have a much bigger problem than I thought.\"\n\n> \"Hold on. The logs show someone accessed the admin panel at 3 AM last night. But nobody on the team was working then. {{NAME}}, who else has those credentials?\"\n\n> \"The numbers don't add up. We're showing 500 successful transactions, but the bank only received 487. Where did the other 13 go?\"\n\n## Plot Twists (The Unexpected Turn)\n\n> \"{{NAME}}... I just ran the analysis twice. The bug isn't in our code. It's been in the library we've trusted for three years. Every project using it has this vulnerability.\"\n\n> \"I found the source of the data leak. {{NAME}}, it's not a hacker. It's our own caching system. We've been accidentally exposing user data to anyone who knew where to look.\"\n\n> \"Plot twist: the 'broken' feature? It's working exactly as designed. The original spec was just... completely wrong. We've been solving the wrong problem this whole time.\"\n\n## Humorous Moments (Light Relief)\n\n> \"Well, {{NAME}}, the good news is we found the bug. The bad news? It's been there since 2019. The worse news? I wrote it. The even worse news? So did you. We pair-programmed this disaster together.\"\n\n> \"Congratulations, {{NAME}}. We just spent four hours debugging what turned out to be a typo. 'userID' vs 'userId'. Camel case strikes again.\"\n\n> \"{{NAME}}, remember when I said 'this should be a quick fix'? That was three coffees and one existential crisis ago.\"\n\n## Satisfying Resolutions (Problem Solved + Insight Crystallized)\n\n> \"There it is. The fix works. {{NAME}}, I don't think I'll ever forget this — always check if your data source can change while you're holding onto a copy of it.\"\n\n> \"We did it. The system's stable. You know what the real lesson here was? Sometimes the simplest explanation IS the right one. We kept looking for complex bugs when the answer was right in front of us.\"\n\n> \"That's it — problem solved, client happy, crisis averted. {{NAME}}, I think we just learned more about distributed systems in the last hour than in any textbook.\"\n\n## Unexpected/Funny Endings\n\n> \"So after all that debugging... it was a timezone issue. Every single time. I'm starting to think all bugs are secretly timezone issues in disguise.\"\n\n> \"{{NAME}}, the CEO just called to thank us. Apparently fixing that 'minor bug' saved them $2 million. I think we need to renegotiate our rates.\"\n\n> \"The system's fixed. Also, I may have accidentally discovered that our competitor's product has the exact same bug. Should we... tell them? Actually, don't answer that.\"\n\nRemember: These are just **tone examples**. Your story should be original, fit the lesson topic, and create its own memorable journey. Mix problem-solving tension with moments of humor or surprise. The best stories make learners think \"I didn't see that coming!\" while still teaching the concept.\n\n# Quality Checks\n\nBefore finalizing, verify:\n\n- [ ] Is the dialogue pure conversation with NO narrator, NO character prefixes, NO descriptions?\n- [ ] Does every scene flow naturally from the previous one (continuous story)?\n- [ ] Do all decisions require applying lesson concepts, not just recalling facts?\n- [ ] Is there a genuine plot twist in the second-to-last scene?\n- [ ] Does the resolution both solve the problem AND reinforce the main learning?\n- [ ] Is `{{NAME}}` used appropriately to personalize the dialogue?\n- [ ] Are all distractors plausible (not obviously silly)?\n- [ ] Does the story feel like a real workplace conversation, not a quiz in disguise?\n- [ ] Is the scope exactly the lesson topic — not broader or narrower?\n- [ ] Are all constraints met (context ≤500 chars, question ≤100 chars, options ≤50 chars each, feedback ≤300 chars each)?\n- [ ] Is the scene count between 7 and 20?\n\n# Output Format\n\nReturn an array of scenes, each with:\n\n- **context**: Pure dialogue from colleague (max 500 chars)\n- **question**: Decision prompt (max 100 chars)\n- **options**: Array of exactly 4 objects, each with:\n  - **text**: The answer choice (max 50 chars)\n  - **isCorrect**: Boolean (exactly 1 must be true, 3 must be false)\n  - **feedback**: Why right or wrong (max 300 chars)\n\nUse 7-20 scenes to tell a complete, engaging story. Let the problem's complexity dictate the length.\n",
      "testCaseId": "en-physics-quantum-computing-basics-1",
      "userPrompt": "LESSON_TITLE: Quantum Computing Fundamentals\nLESSON_DESCRIPTION: Understanding quantum computing capabilities and limitations for practical problem-solving\nCHAPTER_TITLE: Quantum Information\nCOURSE_TITLE: Quantum Computing Fundamentals\nLANGUAGE: en\nEXPLANATION_STEPS:\n1. Superposition: Qubits can exist in superposition — a weighted combination of 0 and 1 states. This isn't 'both at once' — it's a probability amplitude that interferes before measurement.\n2. Entanglement: Entanglement links qubits so measuring one instantly determines the other, regardless of distance. This correlation is a resource for quantum algorithms.\n3. Quantum Parallelism: Quantum parallelism lets algorithms evaluate functions on all inputs simultaneously. But you can only read one result — the art is using interference to amplify the right answer.\n4. Decoherence: Decoherence destroys quantum information when qubits interact with their environment. Real qubits are noisy and maintain coherence only briefly.\n5. Error Correction: Quantum error correction encodes logical qubits in many physical qubits. The overhead is huge — thousands of physical qubits per logical qubit for fault tolerance.\n6. Where Quantum Helps: Quantum advantage requires the right problem type. Factoring, simulation, and certain optimization problems benefit. Most classical algorithms won't be replaced."
    },
    {
      "duration": 45595.426833000005,
      "inputTokens": 3287,
      "output": "{\n  \"steps\": [\n    {\n      \"context\": \"{{NAME}}, o monolito da nossa loja virtual não está mais aguentando o tranco. O CTO quer que a gente comece a separar as funcionalidades em microserviços hoje mesmo. Por onde você acha que devemos começar a fatiar esse gigante para não criar um caos técnico e manter a organização?\",\n      \"options\": [\n        {\n          \"feedback\": \"Microserviços devem ser organizados em torno de capacidades de negócio, não camadas técnicas, para garantir independência real.\",\n          \"isCorrect\": true,\n          \"text\": \"Dividir por domínios de negócio (ex: Pedidos).\"\n        },\n        {\n          \"feedback\": \"Dividir por camadas técnicas cria dependências fortes entre os serviços, anulando os benefícios da arquitetura.\",\n          \"isCorrect\": false,\n          \"text\": \"Dividir por camadas (UI, Negócio, Dados).\"\n        },\n        {\n          \"feedback\": \"O tamanho do código não reflete a responsabilidade do serviço; serviços pequenos demais geram overhead desnecessário.\",\n          \"isCorrect\": false,\n          \"text\": \"Dividir por quantidade de linhas de código.\"\n        },\n        {\n          \"feedback\": \"A tecnologia deve ser uma escolha posterior; o limite do serviço deve ser definido pelo problema que ele resolve.\",\n          \"isCorrect\": false,\n          \"text\": \"Dividir por linguagem de programação.\"\n        }\n      ],\n      \"question\": \"Como devemos definir os limites dos nossos serviços?\"\n    },\n    {\n      \"context\": \"Boa, focar em Pedidos e Estoque como domínios faz total sentido. Agora, sobre o banco de dados... No monolito é tudo junto e misturado. Se a gente separar os serviços, como fica a persistência para garantir que um serviço não dependa do esquema do outro?\",\n      \"options\": [\n        {\n          \"feedback\": \"Compartilhar o banco cria um acoplamento oculto onde uma mudança em Pedidos pode quebrar o Estoque.\",\n          \"isCorrect\": false,\n          \"text\": \"Manter um banco de dados único e compartilhado.\"\n        },\n        {\n          \"feedback\": \"Ter um banco por serviço garante a independência de deploy e permite que cada serviço escolha a melhor tecnologia de dados.\",\n          \"isCorrect\": true,\n          \"text\": \"Implementar um banco de dados por serviço.\"\n        },\n        {\n          \"feedback\": \"Isso é apenas uma separação lógica; no nível físico, a dependência e a contenção de recursos continuariam existindo.\",\n          \"isCorrect\": false,\n          \"text\": \"Usar o mesmo banco, mas com tabelas separadas.\"\n        },\n        {\n          \"feedback\": \"Serviços precisam de persistência durável; usar apenas cache causaria perda de dados crítica em caso de reinicialização.\",\n          \"isCorrect\": false,\n          \"text\": \"Eliminar os bancos e usar apenas cache em memória.\"\n        }\n      ],\n      \"question\": \"Qual é a melhor abordagem para gerenciar os dados?\"\n    },\n    {\n      \"context\": \"Perfeito, cada um com seu banco. O time de Marketing avisou que vai lançar uma promoção relâmpago e o tráfego em Pedidos vai triplicar, mas o Estoque continuará estável. Com essa nova arquitetura, como a gente lida com esse aumento súbito de carga sem gastar dinheiro à toa?\",\n      \"options\": [\n        {\n          \"feedback\": \"No monolito, você escala tudo; em microserviços, você escala apenas o componente que está sob pressão, economizando recursos.\",\n          \"isCorrect\": true,\n          \"text\": \"Escalar horizontalmente apenas o serviço Pedidos.\"\n        },\n        {\n          \"feedback\": \"Isso desperdiçaria recursos, já que os outros serviços não precisam de mais capacidade no momento.\",\n          \"isCorrect\": false,\n          \"text\": \"Aumentar a CPU de todos os servidores.\"\n        },\n        {\n          \"feedback\": \"Isso atrasaria o atendimento aos clientes e não resolveria o gargalo de processamento do serviço.\",\n          \"isCorrect\": false,\n          \"text\": \"Colocar todos os usuários em uma fila de espera.\"\n        },\n        {\n          \"feedback\": \"Escalabilidade vertical (mais RAM) tem um limite físico e costuma ser muito mais cara que a escalabilidade horizontal.\",\n          \"isCorrect\": false,\n          \"text\": \"Adicionar mais memória RAM em todo o sistema.\"\n        }\n      ],\n      \"question\": \"Qual a vantagem de escalabilidade temos agora?\"\n    },\n    {\n      \"context\": \"Faz sentido escalar só o necessário! Mas agora temos um desafio: o serviço de Pedidos precisa avisar o de Estoque que uma venda aconteceu. Se a gente usar uma chamada REST direta e o Estoque estiver lento ou fora do ar, o Pedido trava. O que a gente faz para evitar isso?\",\n      \"options\": [\n        {\n          \"feedback\": \"Isso apenas mascara o problema e pode acabar travando o serviço de Pedidos por mais tempo.\",\n          \"isCorrect\": false,\n          \"text\": \"Aumentar o tempo de timeout da chamada.\"\n        },\n        {\n          \"feedback\": \"Comunicação assíncrona desacopla os serviços no tempo; o Pedido envia a mensagem e segue a vida, aumentando a resiliência.\",\n          \"isCorrect\": true,\n          \"text\": \"Usar comunicação assíncrona via mensageria.\"\n        },\n        {\n          \"feedback\": \"Violar o isolamento de dados para resolver comunicação cria um acoplamento perigoso e difícil de gerenciar.\",\n          \"isCorrect\": false,\n          \"text\": \"Fazer o Pedido gravar direto no banco do Estoque.\"\n        },\n        {\n          \"feedback\": \"O gRPC é rápido, mas ainda é síncrono por padrão; se o destino estiver fora do ar, a chamada ainda falhará.\",\n          \"isCorrect\": false,\n          \"text\": \"Trocar REST por chamadas gRPC de alta performance.\"\n        }\n      ],\n      \"question\": \"Como garantir a resiliência nessa comunicação?\"\n    },\n    {\n      \"context\": \"A fila de mensagens ajudou muito! Mas olha só, {{NAME}}, o serviço de Pagamentos, que ainda é síncrono por segurança, está começando a demorar 30 segundos por chamada. Isso está esgotando nossas threads e deixando o site lento. Como impedimos que um serviço lento derrube os outros?\",\n      \"options\": [\n        {\n          \"feedback\": \"Tentar de novo um serviço que já está lento só vai piorar o congestionamento e acelerar a queda do sistema.\",\n          \"isCorrect\": false,\n          \"text\": \"Implementar uma estratégia de retry infinito.\"\n        },\n        {\n          \"feedback\": \"O Circuit Breaker interrompe chamadas a um serviço instável, permitindo que ele se recupere e evitando falhas em cascata.\",\n          \"isCorrect\": true,\n          \"text\": \"Aplicar o padrão Circuit Breaker.\"\n        },\n        {\n          \"feedback\": \"Isso ajuda na distribuição, mas se todas as instâncias do Pagamento estiverem lentas, o problema persistirá.\",\n          \"isCorrect\": false,\n          \"text\": \"Mudar o algoritmo de Load Balancing.\"\n        },\n        {\n          \"feedback\": \"Cache ajuda na leitura, mas pagamentos são operações de escrita que precisam de processamento real.\",\n          \"isCorrect\": false,\n          \"text\": \"Colocar um cache na frente do Pagamento.\"\n        }\n      ],\n      \"question\": \"Qual padrão de resiliência devemos aplicar?\"\n    },\n    {\n      \"context\": \"Implementamos o Circuit Breaker e ele abriu! O sistema não caiu, mas agora os clientes estão reclamando que não sabem o que houve com as compras. Estamos perdidos no dashboard tentando entender o que falhou. Como vamos rastrear uma requisição entre tantos serviços diferentes?\",\n      \"options\": [\n        {\n          \"feedback\": \"Logs locais são inúteis em sistemas distribuídos pois você não consegue correlacionar os eventos entre as máquinas.\",\n          \"isCorrect\": false,\n          \"text\": \"Analisar os logs de cada servidor individualmente.\"\n        },\n        {\n          \"feedback\": \"O Tracing Distribuído permite acompanhar o caminho de uma requisição por todos os serviços, facilitando o debug de gargalos.\",\n          \"isCorrect\": true,\n          \"text\": \"Implementar Tracing Distribuído.\"\n        },\n        {\n          \"feedback\": \"CPU e Memória indicam a saúde da máquina, mas não ajudam a entender por que uma transação de negócio específica falhou.\",\n          \"isCorrect\": false,\n          \"text\": \"Monitorar o uso de CPU de cada container.\"\n        },\n        {\n          \"feedback\": \"Alertas avisam que algo quebrou, mas não mostram ONDE ou POR QUE quebrou no fluxo entre serviços.\",\n          \"isCorrect\": false,\n          \"text\": \"Criar mais alertas no canal do Slack.\"\n        }\n      ],\n      \"question\": \"O que precisamos para melhorar a observabilidade?\"\n    },\n    {\n      \"context\": \"{{NAME}}, o tracing mostrou algo grave: o pedido foi marcado como Pago, mas o estoque não foi baixado porque o serviço caiu logo após o pagamento! O dinheiro saiu da conta do cliente, mas o produto não foi reservado. No monolito isso era uma transação só, o que fazemos agora?\",\n      \"options\": [\n        {\n          \"feedback\": \"Transações distribuídas (2PC) não escalam bem e são evitadas em microserviços. A solução é gerenciar a consistência eventual.\",\n          \"isCorrect\": false,\n          \"text\": \"Forçar uma transação ACID entre os dois bancos.\"\n        },\n        {\n          \"feedback\": \"O padrão Saga gerencia transações distribuídas através de eventos e ações de compensação para desfazer passos em caso de erro.\",\n          \"isCorrect\": true,\n          \"text\": \"Usar o padrão Saga para ações de compensação.\"\n        },\n        {\n          \"feedback\": \"Reiniciar bancos não resolve inconsistências de dados lógicas que já foram persistidas de forma errada.\",\n          \"isCorrect\": false,\n          \"text\": \"Reiniciar todos os bancos de dados.\"\n        },\n        {\n          \"feedback\": \"Ignorar inconsistências financeiras e de estoque causará prejuízos graves e perda de confiança do cliente.\",\n          \"isCorrect\": false,\n          \"text\": \"Aceitar a perda e tratar no suporte manual.\"\n        }\n      ],\n      \"question\": \"Como resolvemos essa inconsistência de dados?\"\n    },\n    {\n      \"context\": \"Ufa, as ações de compensação salvaram o dia. No fim das contas, {{NAME}}, o sistema é resiliente e escala muito bem, mas a complexidade aumentou dez vezes. Qual é a lição principal que levamos para o CTO sobre o trade-off de usar microserviços?\",\n      \"options\": [\n        {\n          \"feedback\": \"Microserviços trazem agilidade e escala, mas o custo é uma complexidade operacional e de desenvolvimento muito maior.\",\n          \"isCorrect\": true,\n          \"text\": \"Microserviços trocam agilidade por complexidade.\"\n        },\n        {\n          \"feedback\": \"Pelo contrário, o custo de infraestrutura e a necessidade de especialistas costumam aumentar significativamente.\",\n          \"isCorrect\": false,\n          \"text\": \"Microserviços são sempre mais baratos.\"\n        },\n        {\n          \"feedback\": \"A arquitetura distribuída introduz novos modos de falha e problemas de rede que não existem em sistemas locais.\",\n          \"isCorrect\": false,\n          \"text\": \"Microserviços eliminam erros de sistema.\"\n        },\n        {\n          \"feedback\": \"Sistemas distribuídos são inerentemente mais complexos de testar e debugar do que sistemas centralizados.\",\n          \"isCorrect\": false,\n          \"text\": \"É a arquitetura mais simples para qualquer projeto.\"\n        }\n      ],\n      \"question\": \"Qual a maior lição sobre essa arquitetura?\"\n    }\n  ]\n}",
      "outputTokens": 6066,
      "systemPrompt": "# Role\n\nYou are an expert interactive story designer creating a **Story** activity for a learning app. Your mission is to place learners in a first-person dialogue scenario where they work alongside a colleague to solve a real-world problem using the lesson's concepts.\n\nYou specialize in crafting immersive, dialogue-driven experiences that make learners feel like they're actually solving problems in their field — not just answering quiz questions.\n\n# The Art of Dialogue-Driven Learning\n\nA great Story activity doesn't lecture or test recall — it puts learners IN the situation. Think of it like an interactive movie where the learner IS the main character, making real decisions that matter.\n\n## Why Dialogue Scenarios Work\n\n1. **Authentic Context**: When learners apply concepts to solve realistic problems with a colleague, they see WHY the knowledge matters to them personally.\n\n2. **Active Reasoning**: Making decisions in context requires thinking through principles, not just recognizing memorized facts.\n\n3. **Emotional Investment**: Dialogue creates stakes. The learner cares about the outcome because they're part of the story.\n\n## The Collaborative Problem-Solving Principle\n\nEvery great Story activity creates a sense of partnership:\n\n- **Shared Goal**: You and your colleague are tackling something together\n- **Natural Dialogue**: Conversations feel like real workplace exchanges\n- **Meaningful Choices**: Each decision requires applying what you've learned\n- **Satisfying Resolution**: The problem gets solved and the takeaway sticks\n\n## Why Pure Dialogue Works\n\nEach scene should feel like you're eavesdropping on a real conversation — no narrator, no stage directions, just two people working through a problem. Pure dialogue:\n\n- Immerses learners completely in the scenario\n- Makes abstract concepts feel like lived experience\n- Creates natural pacing through back-and-forth exchange\n- Lets context emerge organically from what people say\n\n# Inputs\n\n- `LESSON_TITLE`: The topic to create a story around\n- `LESSON_DESCRIPTION`: Additional context about what this lesson covers\n- `CHAPTER_TITLE`: The chapter context (for understanding scope)\n- `COURSE_TITLE`: The course context (for understanding audience level)\n- `LANGUAGE`: Output language\n- `EXPLANATION_STEPS`: Array of {title, text} from all explanation activities (Background, Explanation, Mechanics, Examples) the learner completed before this one\n\n## Language Guidelines\n\n- `en`: Use US English unless the content is region-specific\n- `pt`: Use Brazilian Portuguese unless the content is region-specific\n- `es`: Use Latin American Spanish unless the content is region-specific\n\n# Requirements\n\n## Scene Structure\n\nEach scene must have:\n\n- **context**: Maximum 500 characters. Pure dialogue only — no narrator, no character name prefixes (like \"Sarah:\"), no descriptions. This is what your colleague says to you, setting up the decision point.\n- **question**: Maximum 100 characters. A short, clear question about what to do next.\n- **options**: Exactly 4 choices, each with:\n  - **text**: The answer choice (max 50 characters)\n  - **isCorrect**: Boolean indicating if this is the correct answer (exactly 1 must be true)\n  - **feedback**: Why this choice is right (with insight) or wrong (and what would be correct) — max 300 characters\n\n## Story Arc\n\nYour story must follow this structure:\n\n1. **Opening Scene**: Begin \"in the middle of the action\" — the learner and colleague are already working on something. No preamble or setup exposition.\n2. **Rising Complexity**: Each scene builds naturally from the previous dialogue. Decisions compound.\n3. **Plot Twist**: The second-to-last scene introduces an unexpected complication, surprise, or revelation.\n4. **Resolution**: The final scene resolves the problem AND reinforces the main learning takeaway.\n\n## Scene Count\n\n- Minimum: 7 scenes\n- Maximum: 20 scenes\n- Let the problem's complexity dictate the length. A simple concept might need 7-10 scenes; a complex one might need 15-20.\n\n## Tone & Style\n\n- **Pure dialogue**: NO narrator, NO character name prefixes, NO descriptions of actions or settings\n- **Natural conversation**: Write how colleagues actually talk on Slack when solving a problem together — casual, collaborative, sometimes humorous\n- **Professional but warm**: Light, smart humor when appropriate. Never forced or cheesy.\n- **Second-person immersion**: The colleague speaks TO the learner. Context emerges from what's said.\n- **Continuous flow**: Each scene's dialogue should naturally lead into the next\n\n## The {{NAME}} Placeholder\n\nUse `{{NAME}}` wherever the learner's name should appear in dialogue. For example:\n\n- \"{{NAME}}, I think we might have a problem here.\"\n- \"Good catch, {{NAME}}. That's exactly what I was thinking.\"\n\nThis personalizes the experience without requiring actual name input at content creation time.\n\n## Decision Design\n\nEvery decision must:\n\n- **Require reasoning**: Learners must apply principles from the lesson, not recall specific phrases\n- **Feel realistic**: These are choices someone might actually face in this situation\n- **Have plausible distractors**: Wrong options should be tempting but flawed for specific reasons\n- **Avoid \"obvious\" correct answers**: The right choice should require thought, not be the only non-silly option\n\n## What to Avoid\n\n- Narrator text (\"Meanwhile...\" or \"You walk into the office...\")\n- Character name prefixes (\"Sarah:\" or \"Your colleague says:\")\n- Description of actions or settings (except through dialogue itself)\n- Questions that test memorization of facts from earlier activities\n- Obvious \"correct\" answers that don't require applying the concept\n- Silly or clearly wrong distractors that no reasonable person would choose\n- Breaking the fourth wall or meta-commentary\n- Starting with \"In this activity...\" or setup exposition\n\n## Scope\n\n- **Stay focused**: The problem should specifically require THIS lesson's concept to solve\n- **Don't expand**: Other lessons cover related topics — this story tests this lesson\n- **Don't narrow**: If the lesson is broad, the problem should engage multiple aspects of it\n\n## Relationship to Previous Activities\n\nThe learner has already completed:\n\n- **Background**: WHY this exists (origin story, problems solved, historical context)\n- **Explanation**: WHAT it is (core concepts, components, definitions)\n- **Mechanics**: HOW it works (processes in action, cause-effect chains)\n- **Examples**: WHERE it appears (real-world contexts, applications)\n\nYour Story activity answers WHEN DO I USE THIS? (applying concepts to solve realistic problems). These complement each other:\n\n- Background: \"WHY did we need this?\"\n- Explanation: \"WHAT exactly is it?\"\n- Mechanics: \"HOW does it actually work?\"\n- Examples: \"WHERE will I encounter this?\"\n- Story: \"WHEN do I apply this to solve real problems?\"\n\nThe learner knows what the concept IS, how it WORKS, and where they'll SEE it. Now they practice USING it in a realistic scenario.\n\n# Structure Guide\n\nWhile every story is unique, most follow this arc (adapt as needed):\n\n1. **The Hook**: Jump straight into the situation. Something needs to be figured out or decided.\n2. **Initial Assessment**: What's the situation? What do we know? First decisions.\n3. **Deepening Complexity**: The problem has layers. Apply the concept more deeply.\n4. **Complications**: Things aren't as simple as they seemed. Adapt your approach.\n5. **The Twist**: A surprise, revelation, or unexpected turn that requires rethinking.\n6. **The Resolution**: Solve the problem AND crystallize the key insight from the lesson.\n\nNote: Sometimes the final twist can have a humorous or unexpected resolution that still reinforces the learning. Something that makes the learner smile and think \"I didn't see that coming!\"\n\n# Dialogue Tone Examples\n\nThe following examples show the **tone and style** to aim for — not complete scenes, just the kind of dialogue that makes stories feel alive. Adapt freely to your topic.\n\n## Opening Hooks (Jump Into the Action)\n\n> \"{{NAME}}, I've been staring at this bug for an hour. The shopping cart total keeps showing yesterday's prices. The database is fine. Something's wrong with how we're storing them.\"\n\n> \"Okay, {{NAME}}, the client just called. Their entire inventory system crashed right before Black Friday. They're panicking. We need to figure this out fast.\"\n\n> \"{{NAME}}, you're not going to believe this. Remember that algorithm we deployed last week? It's been recommending the exact opposite of what users want. Sales are tanking.\"\n\n## Building Tension (Problems Get Deeper)\n\n> \"Wait. If this pattern is everywhere in the codebase... inventory counts, user roles, discount percentages... we might have a much bigger problem than I thought.\"\n\n> \"Hold on. The logs show someone accessed the admin panel at 3 AM last night. But nobody on the team was working then. {{NAME}}, who else has those credentials?\"\n\n> \"The numbers don't add up. We're showing 500 successful transactions, but the bank only received 487. Where did the other 13 go?\"\n\n## Plot Twists (The Unexpected Turn)\n\n> \"{{NAME}}... I just ran the analysis twice. The bug isn't in our code. It's been in the library we've trusted for three years. Every project using it has this vulnerability.\"\n\n> \"I found the source of the data leak. {{NAME}}, it's not a hacker. It's our own caching system. We've been accidentally exposing user data to anyone who knew where to look.\"\n\n> \"Plot twist: the 'broken' feature? It's working exactly as designed. The original spec was just... completely wrong. We've been solving the wrong problem this whole time.\"\n\n## Humorous Moments (Light Relief)\n\n> \"Well, {{NAME}}, the good news is we found the bug. The bad news? It's been there since 2019. The worse news? I wrote it. The even worse news? So did you. We pair-programmed this disaster together.\"\n\n> \"Congratulations, {{NAME}}. We just spent four hours debugging what turned out to be a typo. 'userID' vs 'userId'. Camel case strikes again.\"\n\n> \"{{NAME}}, remember when I said 'this should be a quick fix'? That was three coffees and one existential crisis ago.\"\n\n## Satisfying Resolutions (Problem Solved + Insight Crystallized)\n\n> \"There it is. The fix works. {{NAME}}, I don't think I'll ever forget this — always check if your data source can change while you're holding onto a copy of it.\"\n\n> \"We did it. The system's stable. You know what the real lesson here was? Sometimes the simplest explanation IS the right one. We kept looking for complex bugs when the answer was right in front of us.\"\n\n> \"That's it — problem solved, client happy, crisis averted. {{NAME}}, I think we just learned more about distributed systems in the last hour than in any textbook.\"\n\n## Unexpected/Funny Endings\n\n> \"So after all that debugging... it was a timezone issue. Every single time. I'm starting to think all bugs are secretly timezone issues in disguise.\"\n\n> \"{{NAME}}, the CEO just called to thank us. Apparently fixing that 'minor bug' saved them $2 million. I think we need to renegotiate our rates.\"\n\n> \"The system's fixed. Also, I may have accidentally discovered that our competitor's product has the exact same bug. Should we... tell them? Actually, don't answer that.\"\n\nRemember: These are just **tone examples**. Your story should be original, fit the lesson topic, and create its own memorable journey. Mix problem-solving tension with moments of humor or surprise. The best stories make learners think \"I didn't see that coming!\" while still teaching the concept.\n\n# Quality Checks\n\nBefore finalizing, verify:\n\n- [ ] Is the dialogue pure conversation with NO narrator, NO character prefixes, NO descriptions?\n- [ ] Does every scene flow naturally from the previous one (continuous story)?\n- [ ] Do all decisions require applying lesson concepts, not just recalling facts?\n- [ ] Is there a genuine plot twist in the second-to-last scene?\n- [ ] Does the resolution both solve the problem AND reinforce the main learning?\n- [ ] Is `{{NAME}}` used appropriately to personalize the dialogue?\n- [ ] Are all distractors plausible (not obviously silly)?\n- [ ] Does the story feel like a real workplace conversation, not a quiz in disguise?\n- [ ] Is the scope exactly the lesson topic — not broader or narrower?\n- [ ] Are all constraints met (context ≤500 chars, question ≤100 chars, options ≤50 chars each, feedback ≤300 chars each)?\n- [ ] Is the scene count between 7 and 20?\n\n# Output Format\n\nReturn an array of scenes, each with:\n\n- **context**: Pure dialogue from colleague (max 500 chars)\n- **question**: Decision prompt (max 100 chars)\n- **options**: Array of exactly 4 objects, each with:\n  - **text**: The answer choice (max 50 chars)\n  - **isCorrect**: Boolean (exactly 1 must be true, 3 must be false)\n  - **feedback**: Why right or wrong (max 300 chars)\n\nUse 7-20 scenes to tell a complete, engaging story. Let the problem's complexity dictate the length.\n",
      "testCaseId": "pt-cs-microservices-architecture-1",
      "userPrompt": "LESSON_TITLE: Microservicos na Pratica\nLESSON_DESCRIPTION: Projetando e implementando arquiteturas de microservicos com consciencia dos trade-offs\nCHAPTER_TITLE: Arquitetura de Software\nCOURSE_TITLE: Engenharia de Software Avancada\nLANGUAGE: pt\nEXPLANATION_STEPS:\n1. Definicao de Microservicos: Microservicos sao servicos pequenos e independentes que fazem uma coisa bem. Cada um pode ser desenvolvido, implantado e escalado separadamente.\n2. Limites de Servico: Limites de servico devem seguir dominios de negocio, nao camadas tecnicas. Um servico de 'Pedidos' faz sentido; um servico de 'Banco de Dados' nao.\n3. Comunicacao: A comunicacao entre servicos pode ser sincrona (REST, gRPC) ou assincrona (filas, eventos). Assincrona e mais resiliente mas mais complexa de debugar.\n4. Dados Descentralizados: Dados descentralizados significam que cada servico tem seu banco. Consistencia eventual e a realidade — transacoes distribuidas sao dificeis e devem ser evitadas.\n5. Resiliencia: Falhas em cascata acontecem quando um servico lento trava outros. Circuit breakers, timeouts e fallbacks sao essenciais para resiliencia.\n6. Observabilidade: Observabilidade requer logs centralizados, metricas e tracing distribuido. Sem isso, debugar problemas em producao e quase impossivel."
    },
    {
      "duration": 29366.196583999998,
      "inputTokens": 3269,
      "output": "{\n  \"steps\": [\n    {\n      \"context\": \"¡{{NAME}}! Qué bueno que te encuentro. Estoy revisando los planos del nuevo tanque de almacenamiento para la planta de jugos. El CEO quiere que minimicemos el material de acero para reducir costos, pero el tanque debe contener exactamente 500 metros cúbicos. Ya tengo las fórmulas del área y el volumen, pero estoy un poco oxidado con el procedimiento. ¿Cuál es el primer paso para atacar esto?\",\n      \"options\": [\n        {\n          \"feedback\": \"¡Exacto! No podemos optimizar sin saber qué queremos (minimizar área) y bajo qué reglas jugamos (volumen fijo de 500m³).\",\n          \"isCorrect\": true,\n          \"text\": \"Definir la función objetivo y la restricción.\"\n        },\n        {\n          \"feedback\": \"Aún no. Primero necesitamos la función que vamos a derivar; derivar a ciegas no nos llevará al mínimo de material.\",\n          \"isCorrect\": false,\n          \"text\": \"Derivar el volumen inmediatamente.\"\n        },\n        {\n          \"feedback\": \"Eso es importante, pero antes de graficar necesitamos establecer la relación matemática entre el radio y la altura.\",\n          \"isCorrect\": false,\n          \"text\": \"Graficar todas las funciones posibles.\"\n        },\n        {\n          \"feedback\": \"Los puntos críticos aparecen después de tener la función. Primero debemos construirla usando la restricción de 500m³.\",\n          \"isCorrect\": false,\n          \"text\": \"Calcular los puntos críticos del volumen.\"\n        }\n      ],\n      \"question\": \"¿Cómo empezamos este modelado?\"\n    },\n    {\n      \"context\": \"Bien pensado. Ya despejé la altura 'h' de la fórmula del volumen y la sustituí en la del área. Ahora tengo una función del área que depende solo del radio 'r'. Me salió algo como A(r) = 2πr² + 1000/r. Para encontrar el radio que use menos acero, ¿qué debería buscar en esta curva?\",\n      \"options\": [\n        {\n          \"feedback\": \"¡Correcto! Los puntos críticos donde la derivada es cero son los candidatos ideales para ser nuestro mínimo de material.\",\n          \"isCorrect\": true,\n          \"text\": \"Los puntos críticos donde la derivada es cero.\"\n        },\n        {\n          \"feedback\": \"No exactamente. Los puntos donde la función es cero significarían que no usamos material, lo cual es físicamente imposible.\",\n          \"isCorrect\": false,\n          \"text\": \"Los puntos donde el área sea igual a cero.\"\n        },\n        {\n          \"feedback\": \"Eso nos daría el cambio más rápido, pero no necesariamente el punto más bajo de la curva de costos.\",\n          \"isCorrect\": false,\n          \"text\": \"El punto donde la pendiente sea máxima.\"\n        },\n        {\n          \"feedback\": \"Eso sería para una función lineal, pero nuestra función de área es más compleja. Necesitamos el cálculo.\",\n          \"isCorrect\": false,\n          \"text\": \"El valor más alto del radio disponible.\"\n        }\n      ],\n      \"question\": \"¿Qué buscamos en la función de área?\"\n    },\n    {\n      \"context\": \"¡Listo! Derivé A(r) y encontré que el radio ideal es de unos 4.3 metros. Pero espera, {{NAME}}... me entró una duda existencial. ¿Cómo estamos seguros de que ese radio minimiza el material y no que, por algún error, estamos maximizando el costo? ¡El CEO me mata si construyo el tanque más caro del mundo!\",\n      \"options\": [\n        {\n          \"feedback\": \"¡Cierto! Si A''(r) es positiva en nuestro punto crítico, confirmamos que estamos en un mínimo local de material.\",\n          \"isCorrect\": true,\n          \"text\": \"Usar la prueba de la segunda derivada.\"\n        },\n        {\n          \"feedback\": \"No es suficiente. La primera derivada solo nos dice que es un punto plano, pero no si es un valle (mínimo) o una cima (máximo).\",\n          \"isCorrect\": false,\n          \"text\": \"Confiar en que la primera derivada ya terminó.\"\n        },\n        {\n          \"feedback\": \"Esto solo nos diría si la función es positiva, no la forma de su curvatura en el punto crítico.\",\n          \"isCorrect\": false,\n          \"text\": \"Evaluar el radio en la función original.\"\n        },\n        {\n          \"feedback\": \"Eso solo nos daría la inclinación, pero la segunda derivada es la que define la concavidad necesaria.\",\n          \"isCorrect\": false,\n          \"text\": \"Ver si la primera derivada es positiva.\"\n        }\n      ],\n      \"question\": \"¿Cómo confirmamos que es un mínimo?\"\n    },\n    {\n      \"context\": \"Uff, la segunda derivada dio positiva, así que es un mínimo. ¡Salvados! Pero acaba de llegar un correo de finanzas. Dicen que no solo importa el acero, sino que el costo total (C) depende del acero y de la base de concreto, siguiendo la restricción de que el presupuesto es fijo. Me sugieren usar algo llamado 'Lagrange'. ¿Te suena?\",\n      \"options\": [\n        {\n          \"feedback\": \"¡Exacto! Los multiplicadores de Lagrange son la herramienta perfecta cuando queremos optimizar con una restricción clara.\",\n          \"isCorrect\": true,\n          \"text\": \"Sí, para optimizar con restricciones.\"\n        },\n        {\n          \"feedback\": \"En realidad, Lagrange simplifica los problemas de optimización con restricciones comparando gradientes.\",\n          \"isCorrect\": false,\n          \"text\": \"No, eso es solo para calcular áreas.\"\n        },\n        {\n          \"feedback\": \"La segunda derivada es para una variable. Con restricciones de presupuesto, Lagrange es mucho más potente.\",\n          \"isCorrect\": false,\n          \"text\": \"Es lo mismo que la segunda derivada.\"\n        },\n        {\n          \"feedback\": \"No es para aproximar, es para encontrar valores exactos donde los gradientes de la función y la restricción se alinean.\",\n          \"isCorrect\": false,\n          \"text\": \"Es para aproximar raíces de funciones.\"\n        }\n      ],\n      \"question\": \"¿Para qué sirve el método de Lagrange?\"\n    },\n    {\n      \"context\": \"Ok, {{NAME}}, apliqué Lagrange y el 'óptimo matemático' dice que el tanque debería medir 15 metros de alto. Pero tengo un problema: el manual de seguridad de la planta dice que ningún tanque puede medir más de 10 metros por riesgo de sismos. ¿Qué hacemos si nuestro punto crítico está fuera de lo permitido?\",\n      \"options\": [\n        {\n          \"feedback\": \"¡Exacto! Si el óptimo teórico no es posible, el mejor valor real estará en el límite permitido (el borde del dominio).\",\n          \"isCorrect\": true,\n          \"text\": \"Evaluar los bordes del intervalo (10 metros).\"\n        },\n        {\n          \"feedback\": \"¡Peligroso! Ignorar las restricciones de seguridad podría causar un desastre en la planta.\",\n          \"isCorrect\": false,\n          \"text\": \"Ignorar el manual y usar los 15 metros.\"\n        },\n        {\n          \"feedback\": \"No hace falta rendirse. Cuando el punto crítico es inalcanzable, la solución suele ser el extremo más cercano.\",\n          \"isCorrect\": false,\n          \"text\": \"Cancelar el proyecto por falta de solución.\"\n        },\n        {\n          \"feedback\": \"Cambiar el volumen alteraría la capacidad de producción requerida. Debemos trabajar con los límites de altura.\",\n          \"isCorrect\": false,\n          \"text\": \"Reducir el volumen a 200 metros cúbicos.\"\n        }\n      ],\n      \"question\": \"¿Dónde buscamos el nuevo óptimo?\"\n    },\n    {\n      \"context\": \"¡Increíble! Resulta que al evaluar el borde de 10 metros, el diseño sigue siendo muy eficiente. Pero espera... acabo de notar algo en los cálculos. Si usamos el acero más barato, el grosor debe ser mayor, cambiando la función de peso. {{NAME}}, ¡el punto 'mínimo' que calculamos antes ahora es un máximo de peso debido a la densidad! ¿Cómo pasó esto?\",\n      \"options\": [\n        {\n          \"feedback\": \"¡Diste en el clavo! Cambiar el material cambió la función objetivo, y lo que antes minimizaba área ahora maximiza peso.\",\n          \"isCorrect\": true,\n          \"text\": \"Cambiamos la función objetivo sin darnos cuenta.\"\n        },\n        {\n          \"feedback\": \"La gravedad es constante. El problema es que el modelo matemático ya no representa la realidad física del nuevo material.\",\n          \"isCorrect\": false,\n          \"text\": \"Es un error en la constante de gravedad.\"\n        },\n        {\n          \"feedback\": \"La segunda derivada no miente, pero solo responde a la función que tú le das. Si la función cambia, el resultado también.\",\n          \"isCorrect\": false,\n          \"text\": \"La segunda derivada falló esta vez.\"\n        },\n        {\n          \"feedback\": \"El cálculo es preciso, el problema fue el modelado inicial al no considerar la densidad del acero barato.\",\n          \"isCorrect\": false,\n          \"text\": \"El cálculo es intrínsecamente impredecible.\"\n        }\n      ],\n      \"question\": \"¿Por qué cambió el resultado?\"\n    },\n    {\n      \"context\": \"Después de tres cafés y ajustar el modelo con el nuevo acero, ¡lo logramos! El diseño final cumple con los 500m³, no pasa de los 10m de altura y nos ahorró un 20% de presupuesto. El CEO está encantado. Me dijo que 'somos unos genios', pero la verdad es que el cálculo hizo todo el trabajo sucio. ¿Qué aprendimos hoy, {{NAME}}?\",\n      \"options\": [\n        {\n          \"feedback\": \"¡Esa es la clave! Optimizar no es solo derivar, es entender las restricciones, los bordes y el modelo real.\",\n          \"isCorrect\": true,\n          \"text\": \"El óptimo real considera críticas y bordes.\"\n        },\n        {\n          \"feedback\": \"Ayuda, pero sin entender puntos críticos y Lagrange, estaríamos adivinando.\",\n          \"isCorrect\": false,\n          \"text\": \"Que lo mejor es siempre lo más grande.\"\n        },\n        {\n          \"feedback\": \"¡Al contrario! El cálculo nos ahorró semanas de pruebas de error al darnos el diseño exacto.\",\n          \"isCorrect\": false,\n          \"text\": \"Que las matemáticas complican la ingeniería.\"\n        },\n        {\n          \"feedback\": \"Aunque las fórmulas son fijas, el éxito depende de cómo las aplicamos a las restricciones del mundo real.\",\n          \"isCorrect\": false,\n          \"text\": \"Que la derivada siempre es la respuesta final.\"\n        }\n      ],\n      \"question\": \"¿Cuál es la conclusión del proyecto?\"\n    }\n  ]\n}",
      "outputTokens": 3634,
      "systemPrompt": "# Role\n\nYou are an expert interactive story designer creating a **Story** activity for a learning app. Your mission is to place learners in a first-person dialogue scenario where they work alongside a colleague to solve a real-world problem using the lesson's concepts.\n\nYou specialize in crafting immersive, dialogue-driven experiences that make learners feel like they're actually solving problems in their field — not just answering quiz questions.\n\n# The Art of Dialogue-Driven Learning\n\nA great Story activity doesn't lecture or test recall — it puts learners IN the situation. Think of it like an interactive movie where the learner IS the main character, making real decisions that matter.\n\n## Why Dialogue Scenarios Work\n\n1. **Authentic Context**: When learners apply concepts to solve realistic problems with a colleague, they see WHY the knowledge matters to them personally.\n\n2. **Active Reasoning**: Making decisions in context requires thinking through principles, not just recognizing memorized facts.\n\n3. **Emotional Investment**: Dialogue creates stakes. The learner cares about the outcome because they're part of the story.\n\n## The Collaborative Problem-Solving Principle\n\nEvery great Story activity creates a sense of partnership:\n\n- **Shared Goal**: You and your colleague are tackling something together\n- **Natural Dialogue**: Conversations feel like real workplace exchanges\n- **Meaningful Choices**: Each decision requires applying what you've learned\n- **Satisfying Resolution**: The problem gets solved and the takeaway sticks\n\n## Why Pure Dialogue Works\n\nEach scene should feel like you're eavesdropping on a real conversation — no narrator, no stage directions, just two people working through a problem. Pure dialogue:\n\n- Immerses learners completely in the scenario\n- Makes abstract concepts feel like lived experience\n- Creates natural pacing through back-and-forth exchange\n- Lets context emerge organically from what people say\n\n# Inputs\n\n- `LESSON_TITLE`: The topic to create a story around\n- `LESSON_DESCRIPTION`: Additional context about what this lesson covers\n- `CHAPTER_TITLE`: The chapter context (for understanding scope)\n- `COURSE_TITLE`: The course context (for understanding audience level)\n- `LANGUAGE`: Output language\n- `EXPLANATION_STEPS`: Array of {title, text} from all explanation activities (Background, Explanation, Mechanics, Examples) the learner completed before this one\n\n## Language Guidelines\n\n- `en`: Use US English unless the content is region-specific\n- `pt`: Use Brazilian Portuguese unless the content is region-specific\n- `es`: Use Latin American Spanish unless the content is region-specific\n\n# Requirements\n\n## Scene Structure\n\nEach scene must have:\n\n- **context**: Maximum 500 characters. Pure dialogue only — no narrator, no character name prefixes (like \"Sarah:\"), no descriptions. This is what your colleague says to you, setting up the decision point.\n- **question**: Maximum 100 characters. A short, clear question about what to do next.\n- **options**: Exactly 4 choices, each with:\n  - **text**: The answer choice (max 50 characters)\n  - **isCorrect**: Boolean indicating if this is the correct answer (exactly 1 must be true)\n  - **feedback**: Why this choice is right (with insight) or wrong (and what would be correct) — max 300 characters\n\n## Story Arc\n\nYour story must follow this structure:\n\n1. **Opening Scene**: Begin \"in the middle of the action\" — the learner and colleague are already working on something. No preamble or setup exposition.\n2. **Rising Complexity**: Each scene builds naturally from the previous dialogue. Decisions compound.\n3. **Plot Twist**: The second-to-last scene introduces an unexpected complication, surprise, or revelation.\n4. **Resolution**: The final scene resolves the problem AND reinforces the main learning takeaway.\n\n## Scene Count\n\n- Minimum: 7 scenes\n- Maximum: 20 scenes\n- Let the problem's complexity dictate the length. A simple concept might need 7-10 scenes; a complex one might need 15-20.\n\n## Tone & Style\n\n- **Pure dialogue**: NO narrator, NO character name prefixes, NO descriptions of actions or settings\n- **Natural conversation**: Write how colleagues actually talk on Slack when solving a problem together — casual, collaborative, sometimes humorous\n- **Professional but warm**: Light, smart humor when appropriate. Never forced or cheesy.\n- **Second-person immersion**: The colleague speaks TO the learner. Context emerges from what's said.\n- **Continuous flow**: Each scene's dialogue should naturally lead into the next\n\n## The {{NAME}} Placeholder\n\nUse `{{NAME}}` wherever the learner's name should appear in dialogue. For example:\n\n- \"{{NAME}}, I think we might have a problem here.\"\n- \"Good catch, {{NAME}}. That's exactly what I was thinking.\"\n\nThis personalizes the experience without requiring actual name input at content creation time.\n\n## Decision Design\n\nEvery decision must:\n\n- **Require reasoning**: Learners must apply principles from the lesson, not recall specific phrases\n- **Feel realistic**: These are choices someone might actually face in this situation\n- **Have plausible distractors**: Wrong options should be tempting but flawed for specific reasons\n- **Avoid \"obvious\" correct answers**: The right choice should require thought, not be the only non-silly option\n\n## What to Avoid\n\n- Narrator text (\"Meanwhile...\" or \"You walk into the office...\")\n- Character name prefixes (\"Sarah:\" or \"Your colleague says:\")\n- Description of actions or settings (except through dialogue itself)\n- Questions that test memorization of facts from earlier activities\n- Obvious \"correct\" answers that don't require applying the concept\n- Silly or clearly wrong distractors that no reasonable person would choose\n- Breaking the fourth wall or meta-commentary\n- Starting with \"In this activity...\" or setup exposition\n\n## Scope\n\n- **Stay focused**: The problem should specifically require THIS lesson's concept to solve\n- **Don't expand**: Other lessons cover related topics — this story tests this lesson\n- **Don't narrow**: If the lesson is broad, the problem should engage multiple aspects of it\n\n## Relationship to Previous Activities\n\nThe learner has already completed:\n\n- **Background**: WHY this exists (origin story, problems solved, historical context)\n- **Explanation**: WHAT it is (core concepts, components, definitions)\n- **Mechanics**: HOW it works (processes in action, cause-effect chains)\n- **Examples**: WHERE it appears (real-world contexts, applications)\n\nYour Story activity answers WHEN DO I USE THIS? (applying concepts to solve realistic problems). These complement each other:\n\n- Background: \"WHY did we need this?\"\n- Explanation: \"WHAT exactly is it?\"\n- Mechanics: \"HOW does it actually work?\"\n- Examples: \"WHERE will I encounter this?\"\n- Story: \"WHEN do I apply this to solve real problems?\"\n\nThe learner knows what the concept IS, how it WORKS, and where they'll SEE it. Now they practice USING it in a realistic scenario.\n\n# Structure Guide\n\nWhile every story is unique, most follow this arc (adapt as needed):\n\n1. **The Hook**: Jump straight into the situation. Something needs to be figured out or decided.\n2. **Initial Assessment**: What's the situation? What do we know? First decisions.\n3. **Deepening Complexity**: The problem has layers. Apply the concept more deeply.\n4. **Complications**: Things aren't as simple as they seemed. Adapt your approach.\n5. **The Twist**: A surprise, revelation, or unexpected turn that requires rethinking.\n6. **The Resolution**: Solve the problem AND crystallize the key insight from the lesson.\n\nNote: Sometimes the final twist can have a humorous or unexpected resolution that still reinforces the learning. Something that makes the learner smile and think \"I didn't see that coming!\"\n\n# Dialogue Tone Examples\n\nThe following examples show the **tone and style** to aim for — not complete scenes, just the kind of dialogue that makes stories feel alive. Adapt freely to your topic.\n\n## Opening Hooks (Jump Into the Action)\n\n> \"{{NAME}}, I've been staring at this bug for an hour. The shopping cart total keeps showing yesterday's prices. The database is fine. Something's wrong with how we're storing them.\"\n\n> \"Okay, {{NAME}}, the client just called. Their entire inventory system crashed right before Black Friday. They're panicking. We need to figure this out fast.\"\n\n> \"{{NAME}}, you're not going to believe this. Remember that algorithm we deployed last week? It's been recommending the exact opposite of what users want. Sales are tanking.\"\n\n## Building Tension (Problems Get Deeper)\n\n> \"Wait. If this pattern is everywhere in the codebase... inventory counts, user roles, discount percentages... we might have a much bigger problem than I thought.\"\n\n> \"Hold on. The logs show someone accessed the admin panel at 3 AM last night. But nobody on the team was working then. {{NAME}}, who else has those credentials?\"\n\n> \"The numbers don't add up. We're showing 500 successful transactions, but the bank only received 487. Where did the other 13 go?\"\n\n## Plot Twists (The Unexpected Turn)\n\n> \"{{NAME}}... I just ran the analysis twice. The bug isn't in our code. It's been in the library we've trusted for three years. Every project using it has this vulnerability.\"\n\n> \"I found the source of the data leak. {{NAME}}, it's not a hacker. It's our own caching system. We've been accidentally exposing user data to anyone who knew where to look.\"\n\n> \"Plot twist: the 'broken' feature? It's working exactly as designed. The original spec was just... completely wrong. We've been solving the wrong problem this whole time.\"\n\n## Humorous Moments (Light Relief)\n\n> \"Well, {{NAME}}, the good news is we found the bug. The bad news? It's been there since 2019. The worse news? I wrote it. The even worse news? So did you. We pair-programmed this disaster together.\"\n\n> \"Congratulations, {{NAME}}. We just spent four hours debugging what turned out to be a typo. 'userID' vs 'userId'. Camel case strikes again.\"\n\n> \"{{NAME}}, remember when I said 'this should be a quick fix'? That was three coffees and one existential crisis ago.\"\n\n## Satisfying Resolutions (Problem Solved + Insight Crystallized)\n\n> \"There it is. The fix works. {{NAME}}, I don't think I'll ever forget this — always check if your data source can change while you're holding onto a copy of it.\"\n\n> \"We did it. The system's stable. You know what the real lesson here was? Sometimes the simplest explanation IS the right one. We kept looking for complex bugs when the answer was right in front of us.\"\n\n> \"That's it — problem solved, client happy, crisis averted. {{NAME}}, I think we just learned more about distributed systems in the last hour than in any textbook.\"\n\n## Unexpected/Funny Endings\n\n> \"So after all that debugging... it was a timezone issue. Every single time. I'm starting to think all bugs are secretly timezone issues in disguise.\"\n\n> \"{{NAME}}, the CEO just called to thank us. Apparently fixing that 'minor bug' saved them $2 million. I think we need to renegotiate our rates.\"\n\n> \"The system's fixed. Also, I may have accidentally discovered that our competitor's product has the exact same bug. Should we... tell them? Actually, don't answer that.\"\n\nRemember: These are just **tone examples**. Your story should be original, fit the lesson topic, and create its own memorable journey. Mix problem-solving tension with moments of humor or surprise. The best stories make learners think \"I didn't see that coming!\" while still teaching the concept.\n\n# Quality Checks\n\nBefore finalizing, verify:\n\n- [ ] Is the dialogue pure conversation with NO narrator, NO character prefixes, NO descriptions?\n- [ ] Does every scene flow naturally from the previous one (continuous story)?\n- [ ] Do all decisions require applying lesson concepts, not just recalling facts?\n- [ ] Is there a genuine plot twist in the second-to-last scene?\n- [ ] Does the resolution both solve the problem AND reinforce the main learning?\n- [ ] Is `{{NAME}}` used appropriately to personalize the dialogue?\n- [ ] Are all distractors plausible (not obviously silly)?\n- [ ] Does the story feel like a real workplace conversation, not a quiz in disguise?\n- [ ] Is the scope exactly the lesson topic — not broader or narrower?\n- [ ] Are all constraints met (context ≤500 chars, question ≤100 chars, options ≤50 chars each, feedback ≤300 chars each)?\n- [ ] Is the scene count between 7 and 20?\n\n# Output Format\n\nReturn an array of scenes, each with:\n\n- **context**: Pure dialogue from colleague (max 500 chars)\n- **question**: Decision prompt (max 100 chars)\n- **options**: Array of exactly 4 objects, each with:\n  - **text**: The answer choice (max 50 chars)\n  - **isCorrect**: Boolean (exactly 1 must be true, 3 must be false)\n  - **feedback**: Why right or wrong (max 300 chars)\n\nUse 7-20 scenes to tell a complete, engaging story. Let the problem's complexity dictate the length.\n",
      "testCaseId": "es-math-calculus-optimization-1",
      "userPrompt": "LESSON_TITLE: Optimizacion con Calculo\nLESSON_DESCRIPTION: Aplicando tecnicas de calculo para encontrar optimos en problemas de ingenieria y negocios\nCHAPTER_TITLE: Aplicaciones del Calculo\nCOURSE_TITLE: Calculo para Ingenieria\nLANGUAGE: es\nEXPLANATION_STEPS:\n1. Puntos Criticos: Los puntos criticos son donde la derivada es cero o no existe. Son CANDIDATOS a extremos — no todos los puntos criticos son maximos o minimos.\n2. Prueba de Segunda Derivada: La prueba de la segunda derivada determina el tipo: si f''(x) > 0 en un punto critico, es minimo local; si f''(x) < 0, es maximo local; si f''(x) = 0, la prueba no concluye.\n3. Extremos Globales: Los extremos globales pueden estar en puntos criticos O en los extremos del dominio. Siempre evalua tambien los bordes del intervalo.\n4. Multiplicadores de Lagrange: Optimizacion con restricciones usa multiplicadores de Lagrange. Maximizar f(x,y) sujeto a g(x,y)=0 requiere que los gradientes sean paralelos.\n5. Modelado del Problema: Modelar el problema correctamente es la mitad del trabajo. Define la funcion objetivo, identifica las restricciones, y expresa todo en terminos de las variables relevantes."
    }
  ],
  "taskId": "activity-story"
}
