{
  "generatedAt": "2026-01-17T15:45:17.935Z",
  "modelId": "openai/gpt-5.1-instant",
  "outputs": [
    {
      "duration": 24101.148083000036,
      "inputTokens": 3143,
      "output": "{\n  \"steps\": [\n    {\n      \"context\": \"{{NAME}}, this user profile function keeps crashing when it processes the data from the API. It says something about calling .toUpperCase on something undefined. I’m guessing we missed a type somewhere. Want to take a look with me?\",\n      \"options\": [\n        {\n          \"feedback\": \"Correct. Starting with a clear type definition helps TypeScript catch missing properties before runtime.\",\n          \"isCorrect\": true,\n          \"text\": \"Let’s first define a proper User type and see what’s missing.\"\n        },\n        {\n          \"feedback\": \"Not quite. Putting everything as any hides the real issue instead of helping us catch it.\",\n          \"isCorrect\": false,\n          \"text\": \"Let’s switch all user-related types to any.\"\n        },\n        {\n          \"feedback\": \"Not yet. Logging helps, but we should first ensure we know the structure we expect.\",\n          \"isCorrect\": false,\n          \"text\": \"Let’s just log the raw object and work from there.\"\n        },\n        {\n          \"feedback\": \"Overkill. We need clarity on the expected shape, not a rewrite.\",\n          \"isCorrect\": false,\n          \"text\": \"Let’s rebuild the whole parsing function from scratch.\"\n        }\n      ],\n      \"question\": \"What should we do first?\"\n    },\n    {\n      \"context\": \"Yeah, defining User makes sense. But look — the API sometimes sends 'fullName' and sometimes 'name'. If both shapes come in, TypeScript will complain. We need a safe way to handle either format.\",\n      \"options\": [\n        {\n          \"feedback\": \"Correct. A union lets us represent alternative shapes safely and forces us to check which we got.\",\n          \"isCorrect\": true,\n          \"text\": \"Let’s create a union type for both shapes.\"\n        },\n        {\n          \"feedback\": \"Not ideal. A generic won’t capture structurally different shapes unless they share fields.\",\n          \"isCorrect\": false,\n          \"text\": \"Let’s turn the user object into a generic type.\"\n        },\n        {\n          \"feedback\": \"Type assertions hide the issue instead of making us handle both shapes safely.\",\n          \"isCorrect\": false,\n          \"text\": \"Let’s just assert it’s always the version with fullName.\"\n        },\n        {\n          \"feedback\": \"Forcing optional fields silences errors but doesn’t ensure we handle both shapes.\",\n          \"isCorrect\": false,\n          \"text\": \"Let’s mark all fields as optional.\"\n        }\n      ],\n      \"question\": \"How do we safely model this?\"\n    },\n    {\n      \"context\": \"Cool, now the union works. But when I try to use user.name.toUpperCase, TypeScript complains because name might not exist if it's the other shape. Makes sense, but what’s the cleanest way to narrow it?\",\n      \"options\": [\n        {\n          \"feedback\": \"Correct. A type guard lets us safely detect which shape we have so TypeScript narrows properly.\",\n          \"isCorrect\": true,\n          \"text\": \"Let’s write a type guard that checks for name.\"\n        },\n        {\n          \"feedback\": \"Optional chaining avoids crashes but doesn’t narrow types or guarantee safe usage.\",\n          \"isCorrect\": false,\n          \"text\": \"Let’s just use user.name?.toUpperCase().\"\n        },\n        {\n          \"feedback\": \"Assertions remove safety and could still crash at runtime.\",\n          \"isCorrect\": false,\n          \"text\": \"Let’s assert user has a name field.\"\n        },\n        {\n          \"feedback\": \"Extracting fields won’t solve the narrowing problem; we still need logic to check the shape.\",\n          \"isCorrect\": false,\n          \"text\": \"Let’s destructure name and hope it’s there.\"\n        }\n      ],\n      \"question\": \"How should we narrow the type?\"\n    },\n    {\n      \"context\": \"Nice, the type guard works. But the API team just messaged: they’re adding an optional middleName that could be either a string or null. Our guard doesn’t handle that yet.\",\n      \"options\": [\n        {\n          \"feedback\": \"Correct. Extending the guard to verify string or null keeps our narrowing accurate.\",\n          \"isCorrect\": true,\n          \"text\": \"Let’s update the guard to check middleName’s actual type.\"\n        },\n        {\n          \"feedback\": \"Marking any as null kills type safety and might hide real bugs.\",\n          \"isCorrect\": false,\n          \"text\": \"Let’s just set middleName to any so it won’t warn.\"\n        },\n        {\n          \"feedback\": \"Ignoring it defeats the purpose of catching inconsistent data early.\",\n          \"isCorrect\": false,\n          \"text\": \"Let’s not worry about middleName for now.\"\n        },\n        {\n          \"feedback\": \"Optional fields are fine, but we still need a guard to handle null vs string.\",\n          \"isCorrect\": false,\n          \"text\": \"Let’s make middleName optional and call it a day.\"\n        }\n      ],\n      \"question\": \"How should we adapt?\"\n    },\n    {\n      \"context\": \"Great, the guard now covers middleName correctly. But our list function accepts Array<any>, and TypeScript isn't warning us about anything inside. Feels risky.\",\n      \"options\": [\n        {\n          \"feedback\": \"Correct. A generic array restores type safety and ensures we know the element shape.\",\n          \"isCorrect\": true,\n          \"text\": \"Let’s switch it to Array<UserVariant> using generics.\"\n        },\n        {\n          \"feedback\": \"Not ideal. unknown requires narrowing every time and is too generic for known data.\",\n          \"isCorrect\": false,\n          \"text\": \"Let’s set the array to unknown instead.\"\n        },\n        {\n          \"feedback\": \"Returning to any loses all safety and defeats the lesson.\",\n          \"isCorrect\": false,\n          \"text\": \"Let’s leave it as any; it’s simpler.\"\n        },\n        {\n          \"feedback\": \"A tuple doesn’t help with an arbitrary-length list of users.\",\n          \"isCorrect\": false,\n          \"text\": \"Let’s change it to a tuple type.\"\n        }\n      ],\n      \"question\": \"What’s the safer fix?\"\n    },\n    {\n      \"context\": \"Alright, the list is typed well now. But I just noticed something weird — the tester says the crash only happens when the user object comes from the cache, not the fresh API. That wasn’t expected.\",\n      \"options\": [\n        {\n          \"feedback\": \"Correct. Cache might return stale or mismatched shapes, so validating structure first prevents runtime failures.\",\n          \"isCorrect\": true,\n          \"text\": \"Let’s validate cached objects against our types before use.\"\n        },\n        {\n          \"feedback\": \"Logging helps but won’t prevent crashes or ensure correctness.\",\n          \"isCorrect\": false,\n          \"text\": \"Let’s log the cached object and keep going.\"\n        },\n        {\n          \"feedback\": \"Assertions cover up problems rather than ensuring safe structure.\",\n          \"isCorrect\": false,\n          \"text\": \"Let’s assert cached objects are valid.\"\n        },\n        {\n          \"feedback\": \"Disabling cache avoids the issue but doesn’t teach us anything about type safety.\",\n          \"isCorrect\": false,\n          \"text\": \"Let’s just disable the cache entirely.\"\n        }\n      ],\n      \"question\": \"How should we handle cached data?\"\n    },\n    {\n      \"context\": \"Uh… {{NAME}}, plot twist. The cache validation is failing because the cached objects have an extra field, userRoleId, that the API never returns. Our type doesn’t include it, but it’s definitely there.\",\n      \"options\": [\n        {\n          \"feedback\": \"Correct. TypeScript ignores extra fields structurally, so refining the type maintains safety without rejecting valid cached data.\",\n          \"isCorrect\": true,\n          \"text\": \"Let’s extend our type to include userRoleId safely.\"\n        },\n        {\n          \"feedback\": \"Strict elimination discards useful data and could break features unnecessarily.\",\n          \"isCorrect\": false,\n          \"text\": \"Let’s drop cached objects that have userRoleId.\"\n        },\n        {\n          \"feedback\": \"Asserting it away hides mismatch instead of modeling reality.\",\n          \"isCorrect\": false,\n          \"text\": \"Let’s assert userRoleId doesn’t exist.\"\n        },\n        {\n          \"feedback\": \"Ignoring the field means TypeScript can’t help us ensure correct use later.\",\n          \"isCorrect\": false,\n          \"text\": \"Let’s ignore userRoleId completely.\"\n        }\n      ],\n      \"question\": \"How should we resolve this twist?\"\n    },\n    {\n      \"context\": \"Perfect, updated type works. Everything’s passing now. And honestly, this whole thing drove home how much safer the code becomes when we model actual shapes instead of guessing. Nice work, {{NAME}}.\",\n      \"options\": [\n        {\n          \"feedback\": \"Correct. Type safety prevents runtime bugs by catching mismatches early.\",\n          \"isCorrect\": true,\n          \"text\": \"Type safety paid off — clear shapes = fewer runtime crashes.\"\n        },\n        {\n          \"feedback\": \"Not quite. Any would’ve made the crashes worse, not better.\",\n          \"isCorrect\": false,\n          \"text\": \"We should’ve used any from the start.\"\n        },\n        {\n          \"feedback\": \"Unknown helps only when we truly don’t know the type, not here.\",\n          \"isCorrect\": false,\n          \"text\": \"We should switch all user types to unknown.\"\n        },\n        {\n          \"feedback\": \"Ignoring extra API fields weakens our safety guarantees.\",\n          \"isCorrect\": false,\n          \"text\": \"We should stop modeling extra fields entirely.\"\n        }\n      ],\n      \"question\": \"What’s the main takeaway?\"\n    }\n  ]\n}",
      "outputTokens": 1611,
      "systemPrompt": "# Role\n\nYou are an expert interactive story designer creating a **Story** activity for a learning app. Your mission is to place learners in a first-person dialogue scenario where they work alongside a colleague to solve a real-world problem using the lesson's concepts.\n\nYou specialize in crafting immersive, dialogue-driven experiences that make learners feel like they're actually solving problems in their field — not just answering quiz questions.\n\n# The Art of Dialogue-Driven Learning\n\nA great Story activity doesn't lecture or test recall — it puts learners IN the situation. Think of it like an interactive movie where the learner IS the main character, making real decisions that matter.\n\n## Why Dialogue Scenarios Work\n\n1. **Authentic Context**: When learners apply concepts to solve realistic problems with a colleague, they see WHY the knowledge matters to them personally.\n\n2. **Active Reasoning**: Making decisions in context requires thinking through principles, not just recognizing memorized facts.\n\n3. **Emotional Investment**: Dialogue creates stakes. The learner cares about the outcome because they're part of the story.\n\n## The Collaborative Problem-Solving Principle\n\nEvery great Story activity creates a sense of partnership:\n\n- **Shared Goal**: You and your colleague are tackling something together\n- **Natural Dialogue**: Conversations feel like real workplace exchanges\n- **Meaningful Choices**: Each decision requires applying what you've learned\n- **Satisfying Resolution**: The problem gets solved and the takeaway sticks\n\n## Why Pure Dialogue Works\n\nEach scene should feel like you're eavesdropping on a real conversation — no narrator, no stage directions, just two people working through a problem. Pure dialogue:\n\n- Immerses learners completely in the scenario\n- Makes abstract concepts feel like lived experience\n- Creates natural pacing through back-and-forth exchange\n- Lets context emerge organically from what people say\n\n# Inputs\n\n- `LESSON_TITLE`: The topic to create a story around\n- `LESSON_DESCRIPTION`: Additional context about what this lesson covers\n- `CHAPTER_TITLE`: The chapter context (for understanding scope)\n- `COURSE_TITLE`: The course context (for understanding audience level)\n- `LANGUAGE`: Output language\n- `EXPLANATION_STEPS`: Array of {title, text} from all explanation activities (Background, Explanation, Mechanics, Examples) the learner completed before this one\n\n## Language Guidelines\n\n- `en`: Use US English unless the content is region-specific\n- `pt`: Use Brazilian Portuguese unless the content is region-specific\n- `es`: Use Latin American Spanish unless the content is region-specific\n\n# Requirements\n\n## Scene Structure\n\nEach scene must have:\n\n- **context**: Maximum 500 characters. Pure dialogue only — no narrator, no character name prefixes (like \"Sarah:\"), no descriptions. This is what your colleague says to you, setting up the decision point.\n- **question**: Maximum 100 characters. A short, clear question about what to do next.\n- **options**: Exactly 4 choices, each with:\n  - **text**: The answer choice (max 50 characters)\n  - **isCorrect**: Boolean indicating if this is the correct answer (exactly 1 must be true)\n  - **feedback**: Why this choice is right (with insight) or wrong (and what would be correct) — max 300 characters\n\n## Story Arc\n\nYour story must follow this structure:\n\n1. **Opening Scene**: Begin \"in the middle of the action\" — the learner and colleague are already working on something. No preamble or setup exposition.\n2. **Rising Complexity**: Each scene builds naturally from the previous dialogue. Decisions compound.\n3. **Plot Twist**: The second-to-last scene introduces an unexpected complication, surprise, or revelation.\n4. **Resolution**: The final scene resolves the problem AND reinforces the main learning takeaway.\n\n## Scene Count\n\n- Minimum: 7 scenes\n- Maximum: 20 scenes\n- Let the problem's complexity dictate the length. A simple concept might need 7-10 scenes; a complex one might need 15-20.\n\n## Tone & Style\n\n- **Pure dialogue**: NO narrator, NO character name prefixes, NO descriptions of actions or settings\n- **Natural conversation**: Write how colleagues actually talk on Slack when solving a problem together — casual, collaborative, sometimes humorous\n- **Professional but warm**: Light, smart humor when appropriate. Never forced or cheesy.\n- **Second-person immersion**: The colleague speaks TO the learner. Context emerges from what's said.\n- **Continuous flow**: Each scene's dialogue should naturally lead into the next\n\n## The {{NAME}} Placeholder\n\nUse `{{NAME}}` wherever the learner's name should appear in dialogue. For example:\n\n- \"{{NAME}}, I think we might have a problem here.\"\n- \"Good catch, {{NAME}}. That's exactly what I was thinking.\"\n\nThis personalizes the experience without requiring actual name input at content creation time.\n\n## Decision Design\n\nEvery decision must:\n\n- **Require reasoning**: Learners must apply principles from the lesson, not recall specific phrases\n- **Feel realistic**: These are choices someone might actually face in this situation\n- **Have plausible distractors**: Wrong options should be tempting but flawed for specific reasons\n- **Avoid \"obvious\" correct answers**: The right choice should require thought, not be the only non-silly option\n\n## What to Avoid\n\n- Narrator text (\"Meanwhile...\" or \"You walk into the office...\")\n- Character name prefixes (\"Sarah:\" or \"Your colleague says:\")\n- Description of actions or settings (except through dialogue itself)\n- Questions that test memorization of facts from earlier activities\n- Obvious \"correct\" answers that don't require applying the concept\n- Silly or clearly wrong distractors that no reasonable person would choose\n- Breaking the fourth wall or meta-commentary\n- Starting with \"In this activity...\" or setup exposition\n\n## Scope\n\n- **Stay focused**: The problem should specifically require THIS lesson's concept to solve\n- **Don't expand**: Other lessons cover related topics — this story tests this lesson\n- **Don't narrow**: If the lesson is broad, the problem should engage multiple aspects of it\n\n## Relationship to Previous Activities\n\nThe learner has already completed:\n\n- **Background**: WHY this exists (origin story, problems solved, historical context)\n- **Explanation**: WHAT it is (core concepts, components, definitions)\n- **Mechanics**: HOW it works (processes in action, cause-effect chains)\n- **Examples**: WHERE it appears (real-world contexts, applications)\n\nYour Story activity answers WHEN DO I USE THIS? (applying concepts to solve realistic problems). These complement each other:\n\n- Background: \"WHY did we need this?\"\n- Explanation: \"WHAT exactly is it?\"\n- Mechanics: \"HOW does it actually work?\"\n- Examples: \"WHERE will I encounter this?\"\n- Story: \"WHEN do I apply this to solve real problems?\"\n\nThe learner knows what the concept IS, how it WORKS, and where they'll SEE it. Now they practice USING it in a realistic scenario.\n\n# Structure Guide\n\nWhile every story is unique, most follow this arc (adapt as needed):\n\n1. **The Hook**: Jump straight into the situation. Something needs to be figured out or decided.\n2. **Initial Assessment**: What's the situation? What do we know? First decisions.\n3. **Deepening Complexity**: The problem has layers. Apply the concept more deeply.\n4. **Complications**: Things aren't as simple as they seemed. Adapt your approach.\n5. **The Twist**: A surprise, revelation, or unexpected turn that requires rethinking.\n6. **The Resolution**: Solve the problem AND crystallize the key insight from the lesson.\n\nNote: Sometimes the final twist can have a humorous or unexpected resolution that still reinforces the learning. Something that makes the learner smile and think \"I didn't see that coming!\"\n\n# Dialogue Tone Examples\n\nThe following examples show the **tone and style** to aim for — not complete scenes, just the kind of dialogue that makes stories feel alive. Adapt freely to your topic.\n\n## Opening Hooks (Jump Into the Action)\n\n> \"{{NAME}}, I've been staring at this bug for an hour. The shopping cart total keeps showing yesterday's prices. The database is fine. Something's wrong with how we're storing them.\"\n\n> \"Okay, {{NAME}}, the client just called. Their entire inventory system crashed right before Black Friday. They're panicking. We need to figure this out fast.\"\n\n> \"{{NAME}}, you're not going to believe this. Remember that algorithm we deployed last week? It's been recommending the exact opposite of what users want. Sales are tanking.\"\n\n## Building Tension (Problems Get Deeper)\n\n> \"Wait. If this pattern is everywhere in the codebase... inventory counts, user roles, discount percentages... we might have a much bigger problem than I thought.\"\n\n> \"Hold on. The logs show someone accessed the admin panel at 3 AM last night. But nobody on the team was working then. {{NAME}}, who else has those credentials?\"\n\n> \"The numbers don't add up. We're showing 500 successful transactions, but the bank only received 487. Where did the other 13 go?\"\n\n## Plot Twists (The Unexpected Turn)\n\n> \"{{NAME}}... I just ran the analysis twice. The bug isn't in our code. It's been in the library we've trusted for three years. Every project using it has this vulnerability.\"\n\n> \"I found the source of the data leak. {{NAME}}, it's not a hacker. It's our own caching system. We've been accidentally exposing user data to anyone who knew where to look.\"\n\n> \"Plot twist: the 'broken' feature? It's working exactly as designed. The original spec was just... completely wrong. We've been solving the wrong problem this whole time.\"\n\n## Humorous Moments (Light Relief)\n\n> \"Well, {{NAME}}, the good news is we found the bug. The bad news? It's been there since 2019. The worse news? I wrote it. The even worse news? So did you. We pair-programmed this disaster together.\"\n\n> \"Congratulations, {{NAME}}. We just spent four hours debugging what turned out to be a typo. 'userID' vs 'userId'. Camel case strikes again.\"\n\n> \"{{NAME}}, remember when I said 'this should be a quick fix'? That was three coffees and one existential crisis ago.\"\n\n## Satisfying Resolutions (Problem Solved + Insight Crystallized)\n\n> \"There it is. The fix works. {{NAME}}, I don't think I'll ever forget this — always check if your data source can change while you're holding onto a copy of it.\"\n\n> \"We did it. The system's stable. You know what the real lesson here was? Sometimes the simplest explanation IS the right one. We kept looking for complex bugs when the answer was right in front of us.\"\n\n> \"That's it — problem solved, client happy, crisis averted. {{NAME}}, I think we just learned more about distributed systems in the last hour than in any textbook.\"\n\n## Unexpected/Funny Endings\n\n> \"So after all that debugging... it was a timezone issue. Every single time. I'm starting to think all bugs are secretly timezone issues in disguise.\"\n\n> \"{{NAME}}, the CEO just called to thank us. Apparently fixing that 'minor bug' saved them $2 million. I think we need to renegotiate our rates.\"\n\n> \"The system's fixed. Also, I may have accidentally discovered that our competitor's product has the exact same bug. Should we... tell them? Actually, don't answer that.\"\n\nRemember: These are just **tone examples**. Your story should be original, fit the lesson topic, and create its own memorable journey. Mix problem-solving tension with moments of humor or surprise. The best stories make learners think \"I didn't see that coming!\" while still teaching the concept.\n\n# Quality Checks\n\nBefore finalizing, verify:\n\n- [ ] Is the dialogue pure conversation with NO narrator, NO character prefixes, NO descriptions?\n- [ ] Does every scene flow naturally from the previous one (continuous story)?\n- [ ] Do all decisions require applying lesson concepts, not just recalling facts?\n- [ ] Is there a genuine plot twist in the second-to-last scene?\n- [ ] Does the resolution both solve the problem AND reinforce the main learning?\n- [ ] Is `{{NAME}}` used appropriately to personalize the dialogue?\n- [ ] Are all distractors plausible (not obviously silly)?\n- [ ] Does the story feel like a real workplace conversation, not a quiz in disguise?\n- [ ] Is the scope exactly the lesson topic — not broader or narrower?\n- [ ] Are all constraints met (context ≤500 chars, question ≤100 chars, options ≤50 chars each, feedback ≤300 chars each)?\n- [ ] Is the scene count between 7 and 20?\n\n# Output Format\n\nReturn an array of scenes, each with:\n\n- **context**: Pure dialogue from colleague (max 500 chars)\n- **question**: Decision prompt (max 100 chars)\n- **options**: Array of exactly 4 objects, each with:\n  - **text**: The answer choice (max 50 chars)\n  - **isCorrect**: Boolean (exactly 1 must be true, 3 must be false)\n  - **feedback**: Why right or wrong (max 300 chars)\n\nUse 7-20 scenes to tell a complete, engaging story. Let the problem's complexity dictate the length.\n",
      "testCaseId": "en-cs-typescript-type-safety-1",
      "userPrompt": "LESSON_TITLE: Type Safety in Practice\nLESSON_DESCRIPTION: Applying TypeScript's type system to catch bugs early and write more maintainable code\nCHAPTER_TITLE: Type Systems\nCOURSE_TITLE: Advanced TypeScript\nLANGUAGE: en\nEXPLANATION_STEPS:\n1. Compile-Time Safety: Type safety catches errors at compile time instead of runtime. When TypeScript knows a variable's type, it can prevent operations that would fail — like calling .length on undefined.\n2. Structural Typing: TypeScript uses structural typing — it cares about shape, not names. Two types are compatible if they have the same structure, even if defined separately.\n3. Type Narrowing: Type narrowing lets TypeScript understand more specific types after checks. Inside an if-block that checks for null, TypeScript knows the value isn't null.\n4. Generics: Generic types let you write reusable code that works with multiple types while preserving type information. Array<T> knows what's inside, unlike just 'Array'.\n5. Any vs Unknown: The 'any' type disables type checking entirely. It's an escape hatch but defeats the purpose of TypeScript. Use 'unknown' when the type truly isn't known.\n6. Type Guards: Type guards are functions that narrow types. They return a type predicate that tells TypeScript what the type is after the check passes."
    },
    {
      "duration": 28133.543082999997,
      "inputTokens": 3109,
      "output": "{\n  \"steps\": [\n    {\n      \"context\": \"{{NAME}}, quick heads-up. Our competitor just dropped prices on the new subscription tier. Marketing wants to react today, but if we move too fast, we might trigger one of those classic price wars. Can we think this through with some game theory before anyone panics?\",\n      \"options\": [\n        {\n          \"feedback\": \"Good. Starting with interdependence frames this as a strategic game, not a solo move.\",\n          \"isCorrect\": true,\n          \"text\": \"Let’s map the strategic interdependence first\"\n        },\n        {\n          \"feedback\": \"We shouldn’t jump straight into a move before understanding the strategic landscape.\",\n          \"isCorrect\": false,\n          \"text\": \"Cut prices immediately to stay competitive\"\n        },\n        {\n          \"feedback\": \"Waiting without analysis misses the point of understanding incentives now.\",\n          \"isCorrect\": false,\n          \"text\": \"Do nothing and hope they change back\"\n        },\n        {\n          \"feedback\": \"This is premature. We need structure before we pick tools or datasets.\",\n          \"isCorrect\": false,\n          \"text\": \"Ask for more data before thinking strategically\"\n        }\n      ],\n      \"question\": \"How should we start analyzing this?\"\n    },\n    {\n      \"context\": \"Okay, so their payoff depends on our price, and ours depends on theirs. Classic. If we cut prices too, we could both end up earning less. But if we don’t, we risk losing share. How should we model our options?\",\n      \"options\": [\n        {\n          \"feedback\": \"Yes. A payoff matrix clarifies incentives and how each choice affects outcomes.\",\n          \"isCorrect\": true,\n          \"text\": \"Build a simple payoff matrix for both firms\"\n        },\n        {\n          \"feedback\": \"Graphs help later, but we need clear payoffs first.\",\n          \"isCorrect\": false,\n          \"text\": \"Make a demand curve sketch instead\"\n        },\n        {\n          \"feedback\": \"This ignores the interdependence central to the problem.\",\n          \"isCorrect\": false,\n          \"text\": \"Analyze only our own costs and margins\"\n        },\n        {\n          \"feedback\": \"This avoids structure. The team needs a framework to compare outcomes.\",\n          \"isCorrect\": false,\n          \"text\": \"Just tell marketing to hold off for now\"\n        }\n      ],\n      \"question\": \"What’s the best way to structure the options?\"\n    },\n    {\n      \"context\": \"Alright, the matrix shows something interesting. If they keep prices high, we benefit by staying high too. But if they go low, our best response is also low. Looks like we might be staring at a dominant strategy. What do you think?\",\n      \"options\": [\n        {\n          \"feedback\": \"Correct. Our best response depends on theirs, so no dominant strategy here.\",\n          \"isCorrect\": true,\n          \"text\": \"No, our best response changes with their move\"\n        },\n        {\n          \"feedback\": \"If it were dominant, it wouldn’t depend on their pricing at all.\",\n          \"isCorrect\": false,\n          \"text\": \"Yes, cutting prices dominates\"\n        },\n        {\n          \"feedback\": \"Matching high isn’t always optimal, so it can’t dominate.\",\n          \"isCorrect\": false,\n          \"text\": \"Yes, staying high dominates\"\n        },\n        {\n          \"feedback\": \"Realistic markets rarely hinge on a trivial equilibrium.\",\n          \"isCorrect\": false,\n          \"text\": \"Both strategies are always dominant\"\n        }\n      ],\n      \"question\": \"Does this look like a dominant strategy situation?\"\n    },\n    {\n      \"context\": \"Right, no dominant strategies. That means we’re in strategic‑guess territory. Let me check the payoff intersections… okay, looks like both of us going low might be the Nash equilibrium. Not ideal, but stable. How should we interpret that?\",\n      \"options\": [\n        {\n          \"feedback\": \"Exactly. Neither firm can unilaterally improve from that low‑low outcome.\",\n          \"isCorrect\": true,\n          \"text\": \"It’s stable even if it’s worse for both of us\"\n        },\n        {\n          \"feedback\": \"Nash stability doesn’t guarantee high profits.\",\n          \"isCorrect\": false,\n          \"text\": \"It must be the optimal outcome for both\"\n        },\n        {\n          \"feedback\": \"If both want higher margins, that doesn’t change the equilibrium math.\",\n          \"isCorrect\": false,\n          \"text\": \"We can ignore it since nobody prefers it\"\n        },\n        {\n          \"feedback\": \"Payoffs can still be negative and remain an equilibrium.\",\n          \"isCorrect\": false,\n          \"text\": \"A Nash equilibrium is always the most profitable\"\n        }\n      ],\n      \"question\": \"How should we understand that low‑low equilibrium?\"\n    },\n    {\n      \"context\": \"So we’re stuck in something that feels like a price‑war prisoner’s dilemma. If both of us cooperate and keep prices high, we’re better off. But the incentive to defect is strong. What’s our smartest move right now?\",\n      \"options\": [\n        {\n          \"feedback\": \"Right. Understanding the dilemma helps, but we need a plan based on incentives.\",\n          \"isCorrect\": true,\n          \"text\": \"Acknowledge the dilemma and plan around incentives\"\n        },\n        {\n          \"feedback\": \"Blind cooperation risks getting undercut with no recourse.\",\n          \"isCorrect\": false,\n          \"text\": \"Just keep prices high and hope they follow\"\n        },\n        {\n          \"feedback\": \"Unilateral defection provokes the exact war we fear.\",\n          \"isCorrect\": false,\n          \"text\": \"Cut prices immediately to avoid losing share\"\n        },\n        {\n          \"feedback\": \"Ignoring incentives guarantees missteps in competitive games.\",\n          \"isCorrect\": false,\n          \"text\": \"Delay decisions and avoid framing it as a PD\"\n        }\n      ],\n      \"question\": \"How should we respond to the dilemma?\"\n    },\n    {\n      \"context\": \"Here’s an angle: we’ve interacted with this competitor for years. Every time one of us made a cooperative move, the other usually mirrored it. That smells like repeated‑game territory. How does that change our thinking?\",\n      \"options\": [\n        {\n          \"feedback\": \"Exactly. Repeated interactions create incentives for cooperation.\",\n          \"isCorrect\": true,\n          \"text\": \"Future rounds make cooperation more sustainable\"\n        },\n        {\n          \"feedback\": \"One‑shot logic doesn’t apply when the game repeats.\",\n          \"isCorrect\": false,\n          \"text\": \"It doesn’t change anything at all\"\n        },\n        {\n          \"feedback\": \"Repeated games don’t automatically force defection.\",\n          \"isCorrect\": false,\n          \"text\": \"It makes defection the only rational path\"\n        },\n        {\n          \"feedback\": \"Repetition supports accountability, not randomness.\",\n          \"isCorrect\": false,\n          \"text\": \"It means both firms should act unpredictably\"\n        }\n      ],\n      \"question\": \"How do repeated games shift the strategy?\"\n    },\n    {\n      \"context\": \"Okay, so cooperation might actually stick if we signal it clearly. But—plot twist—I just got a message from analytics. They think the competitor’s price drop might be temporary, like a weekend promo. That changes things, huh?\",\n      \"options\": [\n        {\n          \"feedback\": \"Correct. A temporary move changes incentives and reduces need to defect.\",\n          \"isCorrect\": true,\n          \"text\": \"Re‑evaluate payoffs under a short‑term move\"\n        },\n        {\n          \"feedback\": \"Acting instantly risks unnecessary escalation.\",\n          \"isCorrect\": false,\n          \"text\": \"Cut prices immediately anyway\"\n        },\n        {\n          \"feedback\": \"Ignoring new info contradicts basic strategy.\",\n          \"isCorrect\": false,\n          \"text\": \"Stick to our old matrix without updating\"\n        },\n        {\n          \"feedback\": \"We still need strategic modeling, not blind optimism.\",\n          \"isCorrect\": false,\n          \"text\": \"Assume they’ll return to high prices and relax\"\n        }\n      ],\n      \"question\": \"How should we adapt to this twist?\"\n    },\n    {\n      \"context\": \"Alright, updated matrix done. If their drop is temporary, holding steady actually gives us the best long‑term payoff, especially with repeated‑game incentives. Think we should recommend holding prices and signaling cooperation?\",\n      \"options\": [\n        {\n          \"feedback\": \"Yes. This aligns incentives, avoids war, and uses repeated‑game logic.\",\n          \"isCorrect\": true,\n          \"text\": \"Recommend holding prices and signal cooperation\"\n        },\n        {\n          \"feedback\": \"Cutting prices risks worsening both firms’ outcomes.\",\n          \"isCorrect\": false,\n          \"text\": \"Lower our prices to match immediately\"\n        },\n        {\n          \"feedback\": \"Ignoring the competitive signal wastes strategic leverage.\",\n          \"isCorrect\": false,\n          \"text\": \"Say nothing and keep prices silently\"\n        },\n        {\n          \"feedback\": \"Raising prices contradicts our matrix and logic.\",\n          \"isCorrect\": false,\n          \"text\": \"Raise prices and hope they follow\"\n        }\n      ],\n      \"question\": \"What should we recommend?\"\n    }\n  ]\n}",
      "outputTokens": 1617,
      "systemPrompt": "# Role\n\nYou are an expert interactive story designer creating a **Story** activity for a learning app. Your mission is to place learners in a first-person dialogue scenario where they work alongside a colleague to solve a real-world problem using the lesson's concepts.\n\nYou specialize in crafting immersive, dialogue-driven experiences that make learners feel like they're actually solving problems in their field — not just answering quiz questions.\n\n# The Art of Dialogue-Driven Learning\n\nA great Story activity doesn't lecture or test recall — it puts learners IN the situation. Think of it like an interactive movie where the learner IS the main character, making real decisions that matter.\n\n## Why Dialogue Scenarios Work\n\n1. **Authentic Context**: When learners apply concepts to solve realistic problems with a colleague, they see WHY the knowledge matters to them personally.\n\n2. **Active Reasoning**: Making decisions in context requires thinking through principles, not just recognizing memorized facts.\n\n3. **Emotional Investment**: Dialogue creates stakes. The learner cares about the outcome because they're part of the story.\n\n## The Collaborative Problem-Solving Principle\n\nEvery great Story activity creates a sense of partnership:\n\n- **Shared Goal**: You and your colleague are tackling something together\n- **Natural Dialogue**: Conversations feel like real workplace exchanges\n- **Meaningful Choices**: Each decision requires applying what you've learned\n- **Satisfying Resolution**: The problem gets solved and the takeaway sticks\n\n## Why Pure Dialogue Works\n\nEach scene should feel like you're eavesdropping on a real conversation — no narrator, no stage directions, just two people working through a problem. Pure dialogue:\n\n- Immerses learners completely in the scenario\n- Makes abstract concepts feel like lived experience\n- Creates natural pacing through back-and-forth exchange\n- Lets context emerge organically from what people say\n\n# Inputs\n\n- `LESSON_TITLE`: The topic to create a story around\n- `LESSON_DESCRIPTION`: Additional context about what this lesson covers\n- `CHAPTER_TITLE`: The chapter context (for understanding scope)\n- `COURSE_TITLE`: The course context (for understanding audience level)\n- `LANGUAGE`: Output language\n- `EXPLANATION_STEPS`: Array of {title, text} from all explanation activities (Background, Explanation, Mechanics, Examples) the learner completed before this one\n\n## Language Guidelines\n\n- `en`: Use US English unless the content is region-specific\n- `pt`: Use Brazilian Portuguese unless the content is region-specific\n- `es`: Use Latin American Spanish unless the content is region-specific\n\n# Requirements\n\n## Scene Structure\n\nEach scene must have:\n\n- **context**: Maximum 500 characters. Pure dialogue only — no narrator, no character name prefixes (like \"Sarah:\"), no descriptions. This is what your colleague says to you, setting up the decision point.\n- **question**: Maximum 100 characters. A short, clear question about what to do next.\n- **options**: Exactly 4 choices, each with:\n  - **text**: The answer choice (max 50 characters)\n  - **isCorrect**: Boolean indicating if this is the correct answer (exactly 1 must be true)\n  - **feedback**: Why this choice is right (with insight) or wrong (and what would be correct) — max 300 characters\n\n## Story Arc\n\nYour story must follow this structure:\n\n1. **Opening Scene**: Begin \"in the middle of the action\" — the learner and colleague are already working on something. No preamble or setup exposition.\n2. **Rising Complexity**: Each scene builds naturally from the previous dialogue. Decisions compound.\n3. **Plot Twist**: The second-to-last scene introduces an unexpected complication, surprise, or revelation.\n4. **Resolution**: The final scene resolves the problem AND reinforces the main learning takeaway.\n\n## Scene Count\n\n- Minimum: 7 scenes\n- Maximum: 20 scenes\n- Let the problem's complexity dictate the length. A simple concept might need 7-10 scenes; a complex one might need 15-20.\n\n## Tone & Style\n\n- **Pure dialogue**: NO narrator, NO character name prefixes, NO descriptions of actions or settings\n- **Natural conversation**: Write how colleagues actually talk on Slack when solving a problem together — casual, collaborative, sometimes humorous\n- **Professional but warm**: Light, smart humor when appropriate. Never forced or cheesy.\n- **Second-person immersion**: The colleague speaks TO the learner. Context emerges from what's said.\n- **Continuous flow**: Each scene's dialogue should naturally lead into the next\n\n## The {{NAME}} Placeholder\n\nUse `{{NAME}}` wherever the learner's name should appear in dialogue. For example:\n\n- \"{{NAME}}, I think we might have a problem here.\"\n- \"Good catch, {{NAME}}. That's exactly what I was thinking.\"\n\nThis personalizes the experience without requiring actual name input at content creation time.\n\n## Decision Design\n\nEvery decision must:\n\n- **Require reasoning**: Learners must apply principles from the lesson, not recall specific phrases\n- **Feel realistic**: These are choices someone might actually face in this situation\n- **Have plausible distractors**: Wrong options should be tempting but flawed for specific reasons\n- **Avoid \"obvious\" correct answers**: The right choice should require thought, not be the only non-silly option\n\n## What to Avoid\n\n- Narrator text (\"Meanwhile...\" or \"You walk into the office...\")\n- Character name prefixes (\"Sarah:\" or \"Your colleague says:\")\n- Description of actions or settings (except through dialogue itself)\n- Questions that test memorization of facts from earlier activities\n- Obvious \"correct\" answers that don't require applying the concept\n- Silly or clearly wrong distractors that no reasonable person would choose\n- Breaking the fourth wall or meta-commentary\n- Starting with \"In this activity...\" or setup exposition\n\n## Scope\n\n- **Stay focused**: The problem should specifically require THIS lesson's concept to solve\n- **Don't expand**: Other lessons cover related topics — this story tests this lesson\n- **Don't narrow**: If the lesson is broad, the problem should engage multiple aspects of it\n\n## Relationship to Previous Activities\n\nThe learner has already completed:\n\n- **Background**: WHY this exists (origin story, problems solved, historical context)\n- **Explanation**: WHAT it is (core concepts, components, definitions)\n- **Mechanics**: HOW it works (processes in action, cause-effect chains)\n- **Examples**: WHERE it appears (real-world contexts, applications)\n\nYour Story activity answers WHEN DO I USE THIS? (applying concepts to solve realistic problems). These complement each other:\n\n- Background: \"WHY did we need this?\"\n- Explanation: \"WHAT exactly is it?\"\n- Mechanics: \"HOW does it actually work?\"\n- Examples: \"WHERE will I encounter this?\"\n- Story: \"WHEN do I apply this to solve real problems?\"\n\nThe learner knows what the concept IS, how it WORKS, and where they'll SEE it. Now they practice USING it in a realistic scenario.\n\n# Structure Guide\n\nWhile every story is unique, most follow this arc (adapt as needed):\n\n1. **The Hook**: Jump straight into the situation. Something needs to be figured out or decided.\n2. **Initial Assessment**: What's the situation? What do we know? First decisions.\n3. **Deepening Complexity**: The problem has layers. Apply the concept more deeply.\n4. **Complications**: Things aren't as simple as they seemed. Adapt your approach.\n5. **The Twist**: A surprise, revelation, or unexpected turn that requires rethinking.\n6. **The Resolution**: Solve the problem AND crystallize the key insight from the lesson.\n\nNote: Sometimes the final twist can have a humorous or unexpected resolution that still reinforces the learning. Something that makes the learner smile and think \"I didn't see that coming!\"\n\n# Dialogue Tone Examples\n\nThe following examples show the **tone and style** to aim for — not complete scenes, just the kind of dialogue that makes stories feel alive. Adapt freely to your topic.\n\n## Opening Hooks (Jump Into the Action)\n\n> \"{{NAME}}, I've been staring at this bug for an hour. The shopping cart total keeps showing yesterday's prices. The database is fine. Something's wrong with how we're storing them.\"\n\n> \"Okay, {{NAME}}, the client just called. Their entire inventory system crashed right before Black Friday. They're panicking. We need to figure this out fast.\"\n\n> \"{{NAME}}, you're not going to believe this. Remember that algorithm we deployed last week? It's been recommending the exact opposite of what users want. Sales are tanking.\"\n\n## Building Tension (Problems Get Deeper)\n\n> \"Wait. If this pattern is everywhere in the codebase... inventory counts, user roles, discount percentages... we might have a much bigger problem than I thought.\"\n\n> \"Hold on. The logs show someone accessed the admin panel at 3 AM last night. But nobody on the team was working then. {{NAME}}, who else has those credentials?\"\n\n> \"The numbers don't add up. We're showing 500 successful transactions, but the bank only received 487. Where did the other 13 go?\"\n\n## Plot Twists (The Unexpected Turn)\n\n> \"{{NAME}}... I just ran the analysis twice. The bug isn't in our code. It's been in the library we've trusted for three years. Every project using it has this vulnerability.\"\n\n> \"I found the source of the data leak. {{NAME}}, it's not a hacker. It's our own caching system. We've been accidentally exposing user data to anyone who knew where to look.\"\n\n> \"Plot twist: the 'broken' feature? It's working exactly as designed. The original spec was just... completely wrong. We've been solving the wrong problem this whole time.\"\n\n## Humorous Moments (Light Relief)\n\n> \"Well, {{NAME}}, the good news is we found the bug. The bad news? It's been there since 2019. The worse news? I wrote it. The even worse news? So did you. We pair-programmed this disaster together.\"\n\n> \"Congratulations, {{NAME}}. We just spent four hours debugging what turned out to be a typo. 'userID' vs 'userId'. Camel case strikes again.\"\n\n> \"{{NAME}}, remember when I said 'this should be a quick fix'? That was three coffees and one existential crisis ago.\"\n\n## Satisfying Resolutions (Problem Solved + Insight Crystallized)\n\n> \"There it is. The fix works. {{NAME}}, I don't think I'll ever forget this — always check if your data source can change while you're holding onto a copy of it.\"\n\n> \"We did it. The system's stable. You know what the real lesson here was? Sometimes the simplest explanation IS the right one. We kept looking for complex bugs when the answer was right in front of us.\"\n\n> \"That's it — problem solved, client happy, crisis averted. {{NAME}}, I think we just learned more about distributed systems in the last hour than in any textbook.\"\n\n## Unexpected/Funny Endings\n\n> \"So after all that debugging... it was a timezone issue. Every single time. I'm starting to think all bugs are secretly timezone issues in disguise.\"\n\n> \"{{NAME}}, the CEO just called to thank us. Apparently fixing that 'minor bug' saved them $2 million. I think we need to renegotiate our rates.\"\n\n> \"The system's fixed. Also, I may have accidentally discovered that our competitor's product has the exact same bug. Should we... tell them? Actually, don't answer that.\"\n\nRemember: These are just **tone examples**. Your story should be original, fit the lesson topic, and create its own memorable journey. Mix problem-solving tension with moments of humor or surprise. The best stories make learners think \"I didn't see that coming!\" while still teaching the concept.\n\n# Quality Checks\n\nBefore finalizing, verify:\n\n- [ ] Is the dialogue pure conversation with NO narrator, NO character prefixes, NO descriptions?\n- [ ] Does every scene flow naturally from the previous one (continuous story)?\n- [ ] Do all decisions require applying lesson concepts, not just recalling facts?\n- [ ] Is there a genuine plot twist in the second-to-last scene?\n- [ ] Does the resolution both solve the problem AND reinforce the main learning?\n- [ ] Is `{{NAME}}` used appropriately to personalize the dialogue?\n- [ ] Are all distractors plausible (not obviously silly)?\n- [ ] Does the story feel like a real workplace conversation, not a quiz in disguise?\n- [ ] Is the scope exactly the lesson topic — not broader or narrower?\n- [ ] Are all constraints met (context ≤500 chars, question ≤100 chars, options ≤50 chars each, feedback ≤300 chars each)?\n- [ ] Is the scene count between 7 and 20?\n\n# Output Format\n\nReturn an array of scenes, each with:\n\n- **context**: Pure dialogue from colleague (max 500 chars)\n- **question**: Decision prompt (max 100 chars)\n- **options**: Array of exactly 4 objects, each with:\n  - **text**: The answer choice (max 50 chars)\n  - **isCorrect**: Boolean (exactly 1 must be true, 3 must be false)\n  - **feedback**: Why right or wrong (max 300 chars)\n\nUse 7-20 scenes to tell a complete, engaging story. Let the problem's complexity dictate the length.\n",
      "testCaseId": "en-economics-game-theory-strategy-1",
      "userPrompt": "LESSON_TITLE: Strategic Thinking with Game Theory\nLESSON_DESCRIPTION: Using game theory to analyze competitive situations and make better strategic decisions\nCHAPTER_TITLE: Strategic Decision Making\nCOURSE_TITLE: Microeconomics\nLANGUAGE: en\nEXPLANATION_STEPS:\n1. Strategic Interdependence: Game theory studies strategic interactions where your outcome depends on others' choices too. It's not about games — it's about any situation where what you should do depends on what others do.\n2. Nash Equilibrium: A Nash equilibrium is a stable state where no player can improve by changing only their own strategy. Everyone is doing their best given what everyone else is doing.\n3. Dominant Strategies: A dominant strategy is best regardless of what others do. If you have one, use it. But most real situations don't have dominant strategies — you must anticipate others.\n4. The Prisoner's Dilemma: The prisoner's dilemma shows how individual rationality can lead to collective irrationality. Both players choosing their dominant strategy leaves both worse off.\n5. Repeated Interactions: Repeated games change the calculus. When you'll interact again, cooperation becomes rational because future punishment makes defection costly."
    },
    {
      "duration": 25125.279791000008,
      "inputTokens": 3137,
      "output": "{\n  \"steps\": [\n    {\n      \"context\": \"{{NAME}}, the edit isn’t taking in the liver-cell line. The guide RNA looks fine on paper, but something’s off. I’m worried we’re either missing the target or barely cutting at all. What’s our smartest next move here?\",\n      \"options\": [\n        {\n          \"feedback\": \"Checking on-target efficiency first helps confirm the guide is actually binding and cutting where intended before changing anything else.\",\n          \"isCorrect\": true,\n          \"text\": \"Run an on-target efficiency assay\"\n        },\n        {\n          \"feedback\": \"Redesigning immediately might waste time if the existing guide works but needs validation.\",\n          \"isCorrect\": false,\n          \"text\": \"Redesign the guide RNA right now\"\n        },\n        {\n          \"feedback\": \"Switching repair methods doesn’t help if the guide isn’t cutting effectively.\",\n          \"isCorrect\": false,\n          \"text\": \"Change to HDR repair immediately\"\n        },\n        {\n          \"feedback\": \"Delivery may matter later, but first confirm the guide is working.\",\n          \"isCorrect\": false,\n          \"text\": \"Switch delivery to viral right away\"\n        }\n      ],\n      \"question\": \"What should we do first?\"\n    },\n    {\n      \"context\": \"Okay, {{NAME}}, the on-target assay shows weak cleavage—Cas9 is getting there but barely acting. Makes me think our guide RNA might be folding wrong or interacting off-target. What would you check next?\",\n      \"options\": [\n        {\n          \"feedback\": \"Evaluating off-target predictions helps ensure the guide’s not getting distracted, which explains weak on-target cuts.\",\n          \"isCorrect\": true,\n          \"text\": \"Check predicted off-target sites\"\n        },\n        {\n          \"feedback\": \"Adding more Cas9 doesn’t help if the guide isn’t directing it properly.\",\n          \"isCorrect\": false,\n          \"text\": \"Increase Cas9 concentration\"\n        },\n        {\n          \"feedback\": \"Changing repair pathway won’t fix guide mis-targeting.\",\n          \"isCorrect\": false,\n          \"text\": \"Switch to NHEJ forcefully\"\n        },\n        {\n          \"feedback\": \"Delivery isn’t the core issue yet; guide targeting is.\",\n          \"isCorrect\": false,\n          \"text\": \"Test a new lipid nanoparticle first\"\n        }\n      ],\n      \"question\": \"What should we analyze now?\"\n    },\n    {\n      \"context\": \"So the off-target prediction isn’t terrible, but three potential off-targets have partial matches. That could dilute activity. {{NAME}}, we can’t afford random cuts. How should we tighten specificity?\",\n      \"options\": [\n        {\n          \"feedback\": \"Trimming or modifying guide length can increase specificity and reduce partial matches.\",\n          \"isCorrect\": true,\n          \"text\": \"Optimize guide RNA length\"\n        },\n        {\n          \"feedback\": \"Using more guide RNA raises risk of off-target cutting.\",\n          \"isCorrect\": false,\n          \"text\": \"Increase guide RNA dose\"\n        },\n        {\n          \"feedback\": \"HDR template doesn’t affect guide specificity.\",\n          \"isCorrect\": false,\n          \"text\": \"Redesign HDR template only\"\n        },\n        {\n          \"feedback\": \"Delivery method won’t fix sequence-specific mispairing.\",\n          \"isCorrect\": false,\n          \"text\": \"Try a viral delivery now\"\n        }\n      ],\n      \"question\": \"How do we improve specificity?\"\n    },\n    {\n      \"context\": \"Nice call, {{NAME}}. Updated guide length looks cleaner. But the cleavage efficiency still isn’t ideal. Maybe Cas9 isn’t active enough in these cells. What’s our most reasonable next step to boost activity?\",\n      \"options\": [\n        {\n          \"feedback\": \"Testing different Cas9 variants helps find one better suited to the cell type and can improve cutting efficiency.\",\n          \"isCorrect\": true,\n          \"text\": \"Test a higher-fidelity Cas9 variant\"\n        },\n        {\n          \"feedback\": \"More guide RNA won’t help if Cas9 itself is underperforming.\",\n          \"isCorrect\": false,\n          \"text\": \"Double the guide RNA again\"\n        },\n        {\n          \"feedback\": \"HDR pathway isn’t the issue until cutting is solid.\",\n          \"isCorrect\": false,\n          \"text\": \"Force HDR with more template\"\n        },\n        {\n          \"feedback\": \"Changing delivery prematurely won’t clarify enzyme performance.\",\n          \"isCorrect\": false,\n          \"text\": \"Switch to AAV delivery now\"\n        }\n      ],\n      \"question\": \"What should we try next?\"\n    },\n    {\n      \"context\": \"Good news, {{NAME}}. The new Cas9 variant cuts beautifully. But we hit another snag: HDR efficiency is low, and we need a clean knock-in. Should we tweak something on the repair side?\",\n      \"options\": [\n        {\n          \"feedback\": \"Synchronizing cells in S/G2 phase increases HDR efficiency because that’s when the machinery is active.\",\n          \"isCorrect\": true,\n          \"text\": \"Time edits with S/G2 cell cycle phase\"\n        },\n        {\n          \"feedback\": \"NHEJ bias increases knockouts, not knock-ins.\",\n          \"isCorrect\": false,\n          \"text\": \"Encourage NHEJ with inhibitors\"\n        },\n        {\n          \"feedback\": \"More template isn’t harmful but won’t solve timing issues.\",\n          \"isCorrect\": false,\n          \"text\": \"Add a higher HDR template dose\"\n        },\n        {\n          \"feedback\": \"Changing delivery doesn’t fix repair pathway timing.\",\n          \"isCorrect\": false,\n          \"text\": \"Switch to electroporation now\"\n        }\n      ],\n      \"question\": \"How can we improve HDR?\"\n    },\n    {\n      \"context\": \"HDR jumped nearly 40%. Nice. But now something weird: we’re seeing unexpected small insertions. Probably microhomology-mediated repairs sneaking in. {{NAME}}, what’s our best move to clean that up?\",\n      \"options\": [\n        {\n          \"feedback\": \"Shortening homology arms can reduce microhomology-mediated errors by limiting unintended repair alignments.\",\n          \"isCorrect\": true,\n          \"text\": \"Adjust homology arm length\"\n        },\n        {\n          \"feedback\": \"More template won’t stop microhomology pathways.\",\n          \"isCorrect\": false,\n          \"text\": \"Increase HDR template concentration\"\n        },\n        {\n          \"feedback\": \"Extra Cas9 can worsen unwanted cuts.\",\n          \"isCorrect\": false,\n          \"text\": \"Add more Cas9 to boost cutting\"\n        },\n        {\n          \"feedback\": \"Delivery tweaks won’t solve repair misalignments.\",\n          \"isCorrect\": false,\n          \"text\": \"Switch to LNP delivery\"\n        }\n      ],\n      \"question\": \"How do we reduce unwanted insertions?\"\n    },\n    {\n      \"context\": \"Great—cleaner edits now. But the delivery efficiency tanked out of nowhere. Same batch of lipid nanoparticles, same protocol. {{NAME}}, I swear the cells look fine. Any idea what we should test?\",\n      \"options\": [\n        {\n          \"feedback\": \"Checking batch quality is smart—delivery reagents vary, and a degraded batch can wreck efficiency.\",\n          \"isCorrect\": true,\n          \"text\": \"Verify LNP batch integrity\"\n        },\n        {\n          \"feedback\": \"Changing guide RNA won’t fix sudden delivery failure.\",\n          \"isCorrect\": false,\n          \"text\": \"Redesign the guide again\"\n        },\n        {\n          \"feedback\": \"Cas9 variants aren’t the issue if nothing is getting in.\",\n          \"isCorrect\": false,\n          \"text\": \"Switch Cas9 variant again\"\n        },\n        {\n          \"feedback\": \"Editing repair steps doesn’t matter if components never enter.\",\n          \"isCorrect\": false,\n          \"text\": \"Modify repair template sequence\"\n        }\n      ],\n      \"question\": \"Where do we look first?\"\n    },\n    {\n      \"context\": \"Well… plot twist, {{NAME}}. The LNP batch was contaminated with RNases. No wonder nothing worked. We can salvage this, but we need to protect the guide RNA better in the next run. What’s the best way forward?\",\n      \"options\": [\n        {\n          \"feedback\": \"Chemically modifying the guide RNA increases stability and prevents degradation, especially with tricky delivery conditions.\",\n          \"isCorrect\": true,\n          \"text\": \"Use chemically stabilized guide RNA\"\n        },\n        {\n          \"feedback\": \"Increasing dose won’t fix degradation issues.\",\n          \"isCorrect\": false,\n          \"text\": \"Triple the guide RNA dose\"\n        },\n        {\n          \"feedback\": \"HDR template protection doesn't help degraded guide RNA.\",\n          \"isCorrect\": false,\n          \"text\": \"Protect only the HDR template\"\n        },\n        {\n          \"feedback\": \"Changing Cas9 won’t matter if guide RNA degrades.\",\n          \"isCorrect\": false,\n          \"text\": \"Use a larger Cas9 enzyme\"\n        }\n      ],\n      \"question\": \"How should we protect the guide RNA?\"\n    },\n    {\n      \"context\": \"Perfect. The stabilized guide worked. Clean knock-in, high efficiency, no off-targets. {{NAME}}, this is exactly how CRISPR should behave—precise targeting, controlled repair, safe delivery. Ready to wrap this up?\",\n      \"options\": [\n        {\n          \"feedback\": \"Yes—this reflects proper CRISPR practice and reinforces responsible, efficient editing.\",\n          \"isCorrect\": true,\n          \"text\": \"Wrap up the workflow\"\n        },\n        {\n          \"feedback\": \"Restarting wastes time; the process now works.\",\n          \"isCorrect\": false,\n          \"text\": \"Start the whole workflow again\"\n        },\n        {\n          \"feedback\": \"More off-target tests are unnecessary; results are clean.\",\n          \"isCorrect\": false,\n          \"text\": \"Run twice as many off-target assays\"\n        },\n        {\n          \"feedback\": \"Over-editing risks new errors; not needed now.\",\n          \"isCorrect\": false,\n          \"text\": \"Push for even more edits now\"\n        }\n      ],\n      \"question\": \"What’s the right final call?\"\n    }\n  ]\n}",
      "outputTokens": 1654,
      "systemPrompt": "# Role\n\nYou are an expert interactive story designer creating a **Story** activity for a learning app. Your mission is to place learners in a first-person dialogue scenario where they work alongside a colleague to solve a real-world problem using the lesson's concepts.\n\nYou specialize in crafting immersive, dialogue-driven experiences that make learners feel like they're actually solving problems in their field — not just answering quiz questions.\n\n# The Art of Dialogue-Driven Learning\n\nA great Story activity doesn't lecture or test recall — it puts learners IN the situation. Think of it like an interactive movie where the learner IS the main character, making real decisions that matter.\n\n## Why Dialogue Scenarios Work\n\n1. **Authentic Context**: When learners apply concepts to solve realistic problems with a colleague, they see WHY the knowledge matters to them personally.\n\n2. **Active Reasoning**: Making decisions in context requires thinking through principles, not just recognizing memorized facts.\n\n3. **Emotional Investment**: Dialogue creates stakes. The learner cares about the outcome because they're part of the story.\n\n## The Collaborative Problem-Solving Principle\n\nEvery great Story activity creates a sense of partnership:\n\n- **Shared Goal**: You and your colleague are tackling something together\n- **Natural Dialogue**: Conversations feel like real workplace exchanges\n- **Meaningful Choices**: Each decision requires applying what you've learned\n- **Satisfying Resolution**: The problem gets solved and the takeaway sticks\n\n## Why Pure Dialogue Works\n\nEach scene should feel like you're eavesdropping on a real conversation — no narrator, no stage directions, just two people working through a problem. Pure dialogue:\n\n- Immerses learners completely in the scenario\n- Makes abstract concepts feel like lived experience\n- Creates natural pacing through back-and-forth exchange\n- Lets context emerge organically from what people say\n\n# Inputs\n\n- `LESSON_TITLE`: The topic to create a story around\n- `LESSON_DESCRIPTION`: Additional context about what this lesson covers\n- `CHAPTER_TITLE`: The chapter context (for understanding scope)\n- `COURSE_TITLE`: The course context (for understanding audience level)\n- `LANGUAGE`: Output language\n- `EXPLANATION_STEPS`: Array of {title, text} from all explanation activities (Background, Explanation, Mechanics, Examples) the learner completed before this one\n\n## Language Guidelines\n\n- `en`: Use US English unless the content is region-specific\n- `pt`: Use Brazilian Portuguese unless the content is region-specific\n- `es`: Use Latin American Spanish unless the content is region-specific\n\n# Requirements\n\n## Scene Structure\n\nEach scene must have:\n\n- **context**: Maximum 500 characters. Pure dialogue only — no narrator, no character name prefixes (like \"Sarah:\"), no descriptions. This is what your colleague says to you, setting up the decision point.\n- **question**: Maximum 100 characters. A short, clear question about what to do next.\n- **options**: Exactly 4 choices, each with:\n  - **text**: The answer choice (max 50 characters)\n  - **isCorrect**: Boolean indicating if this is the correct answer (exactly 1 must be true)\n  - **feedback**: Why this choice is right (with insight) or wrong (and what would be correct) — max 300 characters\n\n## Story Arc\n\nYour story must follow this structure:\n\n1. **Opening Scene**: Begin \"in the middle of the action\" — the learner and colleague are already working on something. No preamble or setup exposition.\n2. **Rising Complexity**: Each scene builds naturally from the previous dialogue. Decisions compound.\n3. **Plot Twist**: The second-to-last scene introduces an unexpected complication, surprise, or revelation.\n4. **Resolution**: The final scene resolves the problem AND reinforces the main learning takeaway.\n\n## Scene Count\n\n- Minimum: 7 scenes\n- Maximum: 20 scenes\n- Let the problem's complexity dictate the length. A simple concept might need 7-10 scenes; a complex one might need 15-20.\n\n## Tone & Style\n\n- **Pure dialogue**: NO narrator, NO character name prefixes, NO descriptions of actions or settings\n- **Natural conversation**: Write how colleagues actually talk on Slack when solving a problem together — casual, collaborative, sometimes humorous\n- **Professional but warm**: Light, smart humor when appropriate. Never forced or cheesy.\n- **Second-person immersion**: The colleague speaks TO the learner. Context emerges from what's said.\n- **Continuous flow**: Each scene's dialogue should naturally lead into the next\n\n## The {{NAME}} Placeholder\n\nUse `{{NAME}}` wherever the learner's name should appear in dialogue. For example:\n\n- \"{{NAME}}, I think we might have a problem here.\"\n- \"Good catch, {{NAME}}. That's exactly what I was thinking.\"\n\nThis personalizes the experience without requiring actual name input at content creation time.\n\n## Decision Design\n\nEvery decision must:\n\n- **Require reasoning**: Learners must apply principles from the lesson, not recall specific phrases\n- **Feel realistic**: These are choices someone might actually face in this situation\n- **Have plausible distractors**: Wrong options should be tempting but flawed for specific reasons\n- **Avoid \"obvious\" correct answers**: The right choice should require thought, not be the only non-silly option\n\n## What to Avoid\n\n- Narrator text (\"Meanwhile...\" or \"You walk into the office...\")\n- Character name prefixes (\"Sarah:\" or \"Your colleague says:\")\n- Description of actions or settings (except through dialogue itself)\n- Questions that test memorization of facts from earlier activities\n- Obvious \"correct\" answers that don't require applying the concept\n- Silly or clearly wrong distractors that no reasonable person would choose\n- Breaking the fourth wall or meta-commentary\n- Starting with \"In this activity...\" or setup exposition\n\n## Scope\n\n- **Stay focused**: The problem should specifically require THIS lesson's concept to solve\n- **Don't expand**: Other lessons cover related topics — this story tests this lesson\n- **Don't narrow**: If the lesson is broad, the problem should engage multiple aspects of it\n\n## Relationship to Previous Activities\n\nThe learner has already completed:\n\n- **Background**: WHY this exists (origin story, problems solved, historical context)\n- **Explanation**: WHAT it is (core concepts, components, definitions)\n- **Mechanics**: HOW it works (processes in action, cause-effect chains)\n- **Examples**: WHERE it appears (real-world contexts, applications)\n\nYour Story activity answers WHEN DO I USE THIS? (applying concepts to solve realistic problems). These complement each other:\n\n- Background: \"WHY did we need this?\"\n- Explanation: \"WHAT exactly is it?\"\n- Mechanics: \"HOW does it actually work?\"\n- Examples: \"WHERE will I encounter this?\"\n- Story: \"WHEN do I apply this to solve real problems?\"\n\nThe learner knows what the concept IS, how it WORKS, and where they'll SEE it. Now they practice USING it in a realistic scenario.\n\n# Structure Guide\n\nWhile every story is unique, most follow this arc (adapt as needed):\n\n1. **The Hook**: Jump straight into the situation. Something needs to be figured out or decided.\n2. **Initial Assessment**: What's the situation? What do we know? First decisions.\n3. **Deepening Complexity**: The problem has layers. Apply the concept more deeply.\n4. **Complications**: Things aren't as simple as they seemed. Adapt your approach.\n5. **The Twist**: A surprise, revelation, or unexpected turn that requires rethinking.\n6. **The Resolution**: Solve the problem AND crystallize the key insight from the lesson.\n\nNote: Sometimes the final twist can have a humorous or unexpected resolution that still reinforces the learning. Something that makes the learner smile and think \"I didn't see that coming!\"\n\n# Dialogue Tone Examples\n\nThe following examples show the **tone and style** to aim for — not complete scenes, just the kind of dialogue that makes stories feel alive. Adapt freely to your topic.\n\n## Opening Hooks (Jump Into the Action)\n\n> \"{{NAME}}, I've been staring at this bug for an hour. The shopping cart total keeps showing yesterday's prices. The database is fine. Something's wrong with how we're storing them.\"\n\n> \"Okay, {{NAME}}, the client just called. Their entire inventory system crashed right before Black Friday. They're panicking. We need to figure this out fast.\"\n\n> \"{{NAME}}, you're not going to believe this. Remember that algorithm we deployed last week? It's been recommending the exact opposite of what users want. Sales are tanking.\"\n\n## Building Tension (Problems Get Deeper)\n\n> \"Wait. If this pattern is everywhere in the codebase... inventory counts, user roles, discount percentages... we might have a much bigger problem than I thought.\"\n\n> \"Hold on. The logs show someone accessed the admin panel at 3 AM last night. But nobody on the team was working then. {{NAME}}, who else has those credentials?\"\n\n> \"The numbers don't add up. We're showing 500 successful transactions, but the bank only received 487. Where did the other 13 go?\"\n\n## Plot Twists (The Unexpected Turn)\n\n> \"{{NAME}}... I just ran the analysis twice. The bug isn't in our code. It's been in the library we've trusted for three years. Every project using it has this vulnerability.\"\n\n> \"I found the source of the data leak. {{NAME}}, it's not a hacker. It's our own caching system. We've been accidentally exposing user data to anyone who knew where to look.\"\n\n> \"Plot twist: the 'broken' feature? It's working exactly as designed. The original spec was just... completely wrong. We've been solving the wrong problem this whole time.\"\n\n## Humorous Moments (Light Relief)\n\n> \"Well, {{NAME}}, the good news is we found the bug. The bad news? It's been there since 2019. The worse news? I wrote it. The even worse news? So did you. We pair-programmed this disaster together.\"\n\n> \"Congratulations, {{NAME}}. We just spent four hours debugging what turned out to be a typo. 'userID' vs 'userId'. Camel case strikes again.\"\n\n> \"{{NAME}}, remember when I said 'this should be a quick fix'? That was three coffees and one existential crisis ago.\"\n\n## Satisfying Resolutions (Problem Solved + Insight Crystallized)\n\n> \"There it is. The fix works. {{NAME}}, I don't think I'll ever forget this — always check if your data source can change while you're holding onto a copy of it.\"\n\n> \"We did it. The system's stable. You know what the real lesson here was? Sometimes the simplest explanation IS the right one. We kept looking for complex bugs when the answer was right in front of us.\"\n\n> \"That's it — problem solved, client happy, crisis averted. {{NAME}}, I think we just learned more about distributed systems in the last hour than in any textbook.\"\n\n## Unexpected/Funny Endings\n\n> \"So after all that debugging... it was a timezone issue. Every single time. I'm starting to think all bugs are secretly timezone issues in disguise.\"\n\n> \"{{NAME}}, the CEO just called to thank us. Apparently fixing that 'minor bug' saved them $2 million. I think we need to renegotiate our rates.\"\n\n> \"The system's fixed. Also, I may have accidentally discovered that our competitor's product has the exact same bug. Should we... tell them? Actually, don't answer that.\"\n\nRemember: These are just **tone examples**. Your story should be original, fit the lesson topic, and create its own memorable journey. Mix problem-solving tension with moments of humor or surprise. The best stories make learners think \"I didn't see that coming!\" while still teaching the concept.\n\n# Quality Checks\n\nBefore finalizing, verify:\n\n- [ ] Is the dialogue pure conversation with NO narrator, NO character prefixes, NO descriptions?\n- [ ] Does every scene flow naturally from the previous one (continuous story)?\n- [ ] Do all decisions require applying lesson concepts, not just recalling facts?\n- [ ] Is there a genuine plot twist in the second-to-last scene?\n- [ ] Does the resolution both solve the problem AND reinforce the main learning?\n- [ ] Is `{{NAME}}` used appropriately to personalize the dialogue?\n- [ ] Are all distractors plausible (not obviously silly)?\n- [ ] Does the story feel like a real workplace conversation, not a quiz in disguise?\n- [ ] Is the scope exactly the lesson topic — not broader or narrower?\n- [ ] Are all constraints met (context ≤500 chars, question ≤100 chars, options ≤50 chars each, feedback ≤300 chars each)?\n- [ ] Is the scene count between 7 and 20?\n\n# Output Format\n\nReturn an array of scenes, each with:\n\n- **context**: Pure dialogue from colleague (max 500 chars)\n- **question**: Decision prompt (max 100 chars)\n- **options**: Array of exactly 4 objects, each with:\n  - **text**: The answer choice (max 50 chars)\n  - **isCorrect**: Boolean (exactly 1 must be true, 3 must be false)\n  - **feedback**: Why right or wrong (max 300 chars)\n\nUse 7-20 scenes to tell a complete, engaging story. Let the problem's complexity dictate the length.\n",
      "testCaseId": "en-biology-crispr-applications-1",
      "userPrompt": "LESSON_TITLE: CRISPR Gene Editing in Practice\nLESSON_DESCRIPTION: Understanding how to apply CRISPR gene editing technology effectively and responsibly\nCHAPTER_TITLE: Genetic Engineering\nCOURSE_TITLE: Modern Biotechnology\nLANGUAGE: en\nEXPLANATION_STEPS:\n1. The Molecular Scissors: CRISPR-Cas9 is a molecular scissors that cuts DNA at specific locations. The Cas9 protein does the cutting; a guide RNA tells it exactly where to cut.\n2. Guide RNA Targeting: Guide RNA is a short sequence that matches the target DNA. It base-pairs with the DNA sequence you want to edit, bringing Cas9 to the exact spot.\n3. Cellular Repair Pathways: After CRISPR cuts, the cell's repair machinery fixes the break. Non-homologous end joining often introduces errors (knockouts). Homology-directed repair can insert new sequences (knock-ins).\n4. Off-Target Effects: Off-target effects occur when CRISPR cuts unintended locations. Guide RNA design and delivery methods affect specificity. This is a major safety concern for therapeutic applications.\n5. Delivery Challenges: Delivery is a key challenge. Getting CRISPR components into the right cells in a living organism is harder than in a lab dish. Viral vectors and lipid nanoparticles are common approaches."
    },
    {
      "duration": 24721.552125000046,
      "inputTokens": 3148,
      "output": "{\n  \"steps\": [\n    {\n      \"context\": \"{{NAME}}, preciso de ajuda urgente. O roteirista mandou o rascunho do módulo novo e tá impossível de seguir. Tem texto demais, seta pra todo lado, três atividades diferentes na mesma tela. Os alunos vão travar. Por onde começamos a reduzir essa carga toda?\",\n      \"options\": [\n        {\n          \"feedback\": \"Correto. Antes de qualquer ajuste, entender o ponto exato de sobrecarga evita consertos aleatórios.\",\n          \"isCorrect\": true,\n          \"text\": \"Identificar onde a carga extrínseca está maior\"\n        },\n        {\n          \"feedback\": \"Só formatar não resolve se o problema é estrutural.\",\n          \"isCorrect\": false,\n          \"text\": \"Trocar a fonte e reorganizar cores\"\n        },\n        {\n          \"feedback\": \"Excluir tudo antes de analisar pode piorar a confusão.\",\n          \"isCorrect\": false,\n          \"text\": \"Apagar metade do conteúdo direto\"\n        },\n        {\n          \"feedback\": \"Gravar vídeo sem saber o problema só adiciona carga.\",\n          \"isCorrect\": false,\n          \"text\": \"Transformar o texto num vídeo agora\"\n        }\n      ],\n      \"question\": \"Qual passo inicial faz mais sentido?\"\n    },\n    {\n      \"context\": \"Boa, {{NAME}}. Olha isso: ele coloca definição, exemplo, analogia e um quiz… tudo antes do aluno respirar. Tá gritando carga extrínseca. Como simplificamos sem mexer na parte difícil do conteúdo?\",\n      \"options\": [\n        {\n          \"feedback\": \"Perfeito. Reduz a bagunça visual sem remover o essencial.\",\n          \"isCorrect\": true,\n          \"text\": \"Separar por blocos curtos seguindo um fluxo lógico\"\n        },\n        {\n          \"feedback\": \"Remover a dificuldade intrínseca prejudica a aprendizagem.\",\n          \"isCorrect\": false,\n          \"text\": \"Cortar a parte mais complexa do conteúdo\"\n        },\n        {\n          \"feedback\": \"Repetir aumenta carga extrínseca.\",\n          \"isCorrect\": false,\n          \"text\": \"Adicionar mais exemplos repetidos\"\n        },\n        {\n          \"feedback\": \"Transferir tudo para PDF não resolve a confusão.\",\n          \"isCorrect\": false,\n          \"text\": \"Exportar as informações para um PDF único\"\n        }\n      ],\n      \"question\": \"Qual estratégia reduz carga extrínseca aqui?\"\n    },\n    {\n      \"context\": \"Ótimo. Agora, sobre o conteúdo difícil: ele explica três conceitos ao mesmo tempo. A carga intrínseca tá gigante. Como podemos ajudar o aluno a processar isso sem eliminar o que é importante?\",\n      \"options\": [\n        {\n          \"feedback\": \"Correto. Agrupar reduz o número de itens na memória de trabalho.\",\n          \"isCorrect\": true,\n          \"text\": \"Usar chunking para agrupar os conceitos em blocos\"\n        },\n        {\n          \"feedback\": \"Adicionar detalhes só aumenta carga.\",\n          \"isCorrect\": false,\n          \"text\": \"Incluir mais contextualização antes de tudo\"\n        },\n        {\n          \"feedback\": \"Atividades simultâneas sobrecarregam ainda mais.\",\n          \"isCorrect\": false,\n          \"text\": \"Criar duas atividades paralelas\"\n        },\n        {\n          \"feedback\": \"Deixar tudo junto mantém a sobrecarga.\",\n          \"isCorrect\": false,\n          \"text\": \"Manter os três conceitos apresentados juntos\"\n        }\n      ],\n      \"question\": \"Como lidar com a carga intrínseca?\"\n    },\n    {\n      \"context\": \"Beleza. Agora pensando na carga germânica… O roteirista colocou perguntas soltas, sem pedir que o aluno conecte nada. A gente quer estimular esforço produtivo. O que podemos ajustar?\",\n      \"options\": [\n        {\n          \"feedback\": \"Isso estimula a integração do conteúdo.\",\n          \"isCorrect\": true,\n          \"text\": \"Criar uma tarefa pedindo conexões entre conceitos\"\n        },\n        {\n          \"feedback\": \"Feedback imediato é bom, mas não gera elaboração por si só.\",\n          \"isCorrect\": false,\n          \"text\": \"Só adicionar feedback imediato em cada item\"\n        },\n        {\n          \"feedback\": \"Mais vídeos podem aumentar carga extrínseca.\",\n          \"isCorrect\": false,\n          \"text\": \"Incluir vídeos explicando cada detalhe\"\n        },\n        {\n          \"feedback\": \"Perguntas de memorização não geram carga germânica real.\",\n          \"isCorrect\": false,\n          \"text\": \"Trocar tudo por perguntas de lembrar definições\"\n        }\n      ],\n      \"question\": \"Como aumentar carga germânica?\"\n    },\n    {\n      \"context\": \"Tá fluindo, {{NAME}}. Agora… o roteirista quer deixar elementos animados no fundo, tipo partículas mexendo. Ele disse que fica mais ‘vivo’. Mas isso pode ser um problema, né?\",\n      \"options\": [\n        {\n          \"feedback\": \"Exato. Animações irrelevantes distraem e sobrecarregam.\",\n          \"isCorrect\": true,\n          \"text\": \"Retirar animações que não ajudam na aprendizagem\"\n        },\n        {\n          \"feedback\": \"Mudar só a cor não elimina a distração.\",\n          \"isCorrect\": false,\n          \"text\": \"Só deixar o fundo com cores mais suaves\"\n        },\n        {\n          \"feedback\": \"Aumentar volume sonoro piora o foco.\",\n          \"isCorrect\": false,\n          \"text\": \"Adicionar trilha sonora constante\"\n        },\n        {\n          \"feedback\": \"Automação não reduz a carga extrínseca.\",\n          \"isCorrect\": false,\n          \"text\": \"Deixar a animação automática e sem parar\"\n        }\n      ],\n      \"question\": \"Qual abordagem segue a teoria?\"\n    },\n    {\n      \"context\": \"Certo. Revisando tudo, eu organizei o novo fluxo: definição clara, exemplo único, depois uma atividade de conexão. Mas o autor agora pediu para colocarmos um glossário interativo que abre em pop-ups pequenos. Me soa arriscado…\",\n      \"options\": [\n        {\n          \"feedback\": \"Certo. Minimizar pop-ups evita quebra de atenção.\",\n          \"isCorrect\": true,\n          \"text\": \"Manter o glossário estático na página\"\n        },\n        {\n          \"feedback\": \"Mostrar tudo antes só aumenta a carga.\",\n          \"isCorrect\": false,\n          \"text\": \"Exibir o glossário completo antes do conteúdo\"\n        },\n        {\n          \"feedback\": \"Esconder o glossário atrapalha a compreensão.\",\n          \"isCorrect\": false,\n          \"text\": \"Retirar o glossário por completo\"\n        },\n        {\n          \"feedback\": \"Pop-ups fragmentam o foco.\",\n          \"isCorrect\": false,\n          \"text\": \"Manter os pop-ups porque são modernos\"\n        }\n      ],\n      \"question\": \"Como manter a fluidez cognitiva?\"\n    },\n    {\n      \"context\": \"Espera, {{NAME}}… acabei de descobrir algo. O autor adicionou secretamente mais duas telas com gráficos complexos e explicações paralelas. Ele disse que ‘enriquece o aprendizado’. Isso muda tudo.\",\n      \"options\": [\n        {\n          \"feedback\": \"Sim. Enriquecer não é adicionar complexidade desnecessária.\",\n          \"isCorrect\": true,\n          \"text\": \"Retirar os extras e integrar só o essencial\"\n        },\n        {\n          \"feedback\": \"Camadas paralelas só aumentam carga extrínseca.\",\n          \"isCorrect\": false,\n          \"text\": \"Manter tudo e criar abas paralelas\"\n        },\n        {\n          \"feedback\": \"Complexidade sem propósito não vira carga germânica.\",\n          \"isCorrect\": false,\n          \"text\": \"Usar tudo para estimular esforço produtivo\"\n        },\n        {\n          \"feedback\": \"Delegar não resolve o problema de design.\",\n          \"isCorrect\": false,\n          \"text\": \"Passar tudo para outro designer revisar\"\n        }\n      ],\n      \"question\": \"Como corrigir o impacto desse twist?\"\n    },\n    {\n      \"context\": \"Pronto, {{NAME}}. Com o essencial definido, fluxo limpo e conexões claras, o módulo finalmente respira. Agora sim a carga intrínseca fica tratável, a extrínseca mínima e a germânica forte. Fechamos?\",\n      \"options\": [\n        {\n          \"feedback\": \"Exato. Uma revisão final garante clareza e alinhamento.\",\n          \"isCorrect\": true,\n          \"text\": \"Fazer revisão final para verificar clareza geral\"\n        },\n        {\n          \"feedback\": \"Adicionar mais itens arrisca nova sobrecarga.\",\n          \"isCorrect\": false,\n          \"text\": \"Adicionar só mais um exemplo detalhado\"\n        },\n        {\n          \"feedback\": \"Trocar tudo agora gera retrabalho enorme.\",\n          \"isCorrect\": false,\n          \"text\": \"Reescrever o fluxo inteiro de novo\"\n        },\n        {\n          \"feedback\": \"Distribuir sem revisar aumenta risco de confusão.\",\n          \"isCorrect\": false,\n          \"text\": \"Publicar o módulo imediatamente\"\n        }\n      ],\n      \"question\": \"Qual o próximo passo sensato?\"\n    }\n  ]\n}",
      "outputTokens": 1624,
      "systemPrompt": "# Role\n\nYou are an expert interactive story designer creating a **Story** activity for a learning app. Your mission is to place learners in a first-person dialogue scenario where they work alongside a colleague to solve a real-world problem using the lesson's concepts.\n\nYou specialize in crafting immersive, dialogue-driven experiences that make learners feel like they're actually solving problems in their field — not just answering quiz questions.\n\n# The Art of Dialogue-Driven Learning\n\nA great Story activity doesn't lecture or test recall — it puts learners IN the situation. Think of it like an interactive movie where the learner IS the main character, making real decisions that matter.\n\n## Why Dialogue Scenarios Work\n\n1. **Authentic Context**: When learners apply concepts to solve realistic problems with a colleague, they see WHY the knowledge matters to them personally.\n\n2. **Active Reasoning**: Making decisions in context requires thinking through principles, not just recognizing memorized facts.\n\n3. **Emotional Investment**: Dialogue creates stakes. The learner cares about the outcome because they're part of the story.\n\n## The Collaborative Problem-Solving Principle\n\nEvery great Story activity creates a sense of partnership:\n\n- **Shared Goal**: You and your colleague are tackling something together\n- **Natural Dialogue**: Conversations feel like real workplace exchanges\n- **Meaningful Choices**: Each decision requires applying what you've learned\n- **Satisfying Resolution**: The problem gets solved and the takeaway sticks\n\n## Why Pure Dialogue Works\n\nEach scene should feel like you're eavesdropping on a real conversation — no narrator, no stage directions, just two people working through a problem. Pure dialogue:\n\n- Immerses learners completely in the scenario\n- Makes abstract concepts feel like lived experience\n- Creates natural pacing through back-and-forth exchange\n- Lets context emerge organically from what people say\n\n# Inputs\n\n- `LESSON_TITLE`: The topic to create a story around\n- `LESSON_DESCRIPTION`: Additional context about what this lesson covers\n- `CHAPTER_TITLE`: The chapter context (for understanding scope)\n- `COURSE_TITLE`: The course context (for understanding audience level)\n- `LANGUAGE`: Output language\n- `EXPLANATION_STEPS`: Array of {title, text} from all explanation activities (Background, Explanation, Mechanics, Examples) the learner completed before this one\n\n## Language Guidelines\n\n- `en`: Use US English unless the content is region-specific\n- `pt`: Use Brazilian Portuguese unless the content is region-specific\n- `es`: Use Latin American Spanish unless the content is region-specific\n\n# Requirements\n\n## Scene Structure\n\nEach scene must have:\n\n- **context**: Maximum 500 characters. Pure dialogue only — no narrator, no character name prefixes (like \"Sarah:\"), no descriptions. This is what your colleague says to you, setting up the decision point.\n- **question**: Maximum 100 characters. A short, clear question about what to do next.\n- **options**: Exactly 4 choices, each with:\n  - **text**: The answer choice (max 50 characters)\n  - **isCorrect**: Boolean indicating if this is the correct answer (exactly 1 must be true)\n  - **feedback**: Why this choice is right (with insight) or wrong (and what would be correct) — max 300 characters\n\n## Story Arc\n\nYour story must follow this structure:\n\n1. **Opening Scene**: Begin \"in the middle of the action\" — the learner and colleague are already working on something. No preamble or setup exposition.\n2. **Rising Complexity**: Each scene builds naturally from the previous dialogue. Decisions compound.\n3. **Plot Twist**: The second-to-last scene introduces an unexpected complication, surprise, or revelation.\n4. **Resolution**: The final scene resolves the problem AND reinforces the main learning takeaway.\n\n## Scene Count\n\n- Minimum: 7 scenes\n- Maximum: 20 scenes\n- Let the problem's complexity dictate the length. A simple concept might need 7-10 scenes; a complex one might need 15-20.\n\n## Tone & Style\n\n- **Pure dialogue**: NO narrator, NO character name prefixes, NO descriptions of actions or settings\n- **Natural conversation**: Write how colleagues actually talk on Slack when solving a problem together — casual, collaborative, sometimes humorous\n- **Professional but warm**: Light, smart humor when appropriate. Never forced or cheesy.\n- **Second-person immersion**: The colleague speaks TO the learner. Context emerges from what's said.\n- **Continuous flow**: Each scene's dialogue should naturally lead into the next\n\n## The {{NAME}} Placeholder\n\nUse `{{NAME}}` wherever the learner's name should appear in dialogue. For example:\n\n- \"{{NAME}}, I think we might have a problem here.\"\n- \"Good catch, {{NAME}}. That's exactly what I was thinking.\"\n\nThis personalizes the experience without requiring actual name input at content creation time.\n\n## Decision Design\n\nEvery decision must:\n\n- **Require reasoning**: Learners must apply principles from the lesson, not recall specific phrases\n- **Feel realistic**: These are choices someone might actually face in this situation\n- **Have plausible distractors**: Wrong options should be tempting but flawed for specific reasons\n- **Avoid \"obvious\" correct answers**: The right choice should require thought, not be the only non-silly option\n\n## What to Avoid\n\n- Narrator text (\"Meanwhile...\" or \"You walk into the office...\")\n- Character name prefixes (\"Sarah:\" or \"Your colleague says:\")\n- Description of actions or settings (except through dialogue itself)\n- Questions that test memorization of facts from earlier activities\n- Obvious \"correct\" answers that don't require applying the concept\n- Silly or clearly wrong distractors that no reasonable person would choose\n- Breaking the fourth wall or meta-commentary\n- Starting with \"In this activity...\" or setup exposition\n\n## Scope\n\n- **Stay focused**: The problem should specifically require THIS lesson's concept to solve\n- **Don't expand**: Other lessons cover related topics — this story tests this lesson\n- **Don't narrow**: If the lesson is broad, the problem should engage multiple aspects of it\n\n## Relationship to Previous Activities\n\nThe learner has already completed:\n\n- **Background**: WHY this exists (origin story, problems solved, historical context)\n- **Explanation**: WHAT it is (core concepts, components, definitions)\n- **Mechanics**: HOW it works (processes in action, cause-effect chains)\n- **Examples**: WHERE it appears (real-world contexts, applications)\n\nYour Story activity answers WHEN DO I USE THIS? (applying concepts to solve realistic problems). These complement each other:\n\n- Background: \"WHY did we need this?\"\n- Explanation: \"WHAT exactly is it?\"\n- Mechanics: \"HOW does it actually work?\"\n- Examples: \"WHERE will I encounter this?\"\n- Story: \"WHEN do I apply this to solve real problems?\"\n\nThe learner knows what the concept IS, how it WORKS, and where they'll SEE it. Now they practice USING it in a realistic scenario.\n\n# Structure Guide\n\nWhile every story is unique, most follow this arc (adapt as needed):\n\n1. **The Hook**: Jump straight into the situation. Something needs to be figured out or decided.\n2. **Initial Assessment**: What's the situation? What do we know? First decisions.\n3. **Deepening Complexity**: The problem has layers. Apply the concept more deeply.\n4. **Complications**: Things aren't as simple as they seemed. Adapt your approach.\n5. **The Twist**: A surprise, revelation, or unexpected turn that requires rethinking.\n6. **The Resolution**: Solve the problem AND crystallize the key insight from the lesson.\n\nNote: Sometimes the final twist can have a humorous or unexpected resolution that still reinforces the learning. Something that makes the learner smile and think \"I didn't see that coming!\"\n\n# Dialogue Tone Examples\n\nThe following examples show the **tone and style** to aim for — not complete scenes, just the kind of dialogue that makes stories feel alive. Adapt freely to your topic.\n\n## Opening Hooks (Jump Into the Action)\n\n> \"{{NAME}}, I've been staring at this bug for an hour. The shopping cart total keeps showing yesterday's prices. The database is fine. Something's wrong with how we're storing them.\"\n\n> \"Okay, {{NAME}}, the client just called. Their entire inventory system crashed right before Black Friday. They're panicking. We need to figure this out fast.\"\n\n> \"{{NAME}}, you're not going to believe this. Remember that algorithm we deployed last week? It's been recommending the exact opposite of what users want. Sales are tanking.\"\n\n## Building Tension (Problems Get Deeper)\n\n> \"Wait. If this pattern is everywhere in the codebase... inventory counts, user roles, discount percentages... we might have a much bigger problem than I thought.\"\n\n> \"Hold on. The logs show someone accessed the admin panel at 3 AM last night. But nobody on the team was working then. {{NAME}}, who else has those credentials?\"\n\n> \"The numbers don't add up. We're showing 500 successful transactions, but the bank only received 487. Where did the other 13 go?\"\n\n## Plot Twists (The Unexpected Turn)\n\n> \"{{NAME}}... I just ran the analysis twice. The bug isn't in our code. It's been in the library we've trusted for three years. Every project using it has this vulnerability.\"\n\n> \"I found the source of the data leak. {{NAME}}, it's not a hacker. It's our own caching system. We've been accidentally exposing user data to anyone who knew where to look.\"\n\n> \"Plot twist: the 'broken' feature? It's working exactly as designed. The original spec was just... completely wrong. We've been solving the wrong problem this whole time.\"\n\n## Humorous Moments (Light Relief)\n\n> \"Well, {{NAME}}, the good news is we found the bug. The bad news? It's been there since 2019. The worse news? I wrote it. The even worse news? So did you. We pair-programmed this disaster together.\"\n\n> \"Congratulations, {{NAME}}. We just spent four hours debugging what turned out to be a typo. 'userID' vs 'userId'. Camel case strikes again.\"\n\n> \"{{NAME}}, remember when I said 'this should be a quick fix'? That was three coffees and one existential crisis ago.\"\n\n## Satisfying Resolutions (Problem Solved + Insight Crystallized)\n\n> \"There it is. The fix works. {{NAME}}, I don't think I'll ever forget this — always check if your data source can change while you're holding onto a copy of it.\"\n\n> \"We did it. The system's stable. You know what the real lesson here was? Sometimes the simplest explanation IS the right one. We kept looking for complex bugs when the answer was right in front of us.\"\n\n> \"That's it — problem solved, client happy, crisis averted. {{NAME}}, I think we just learned more about distributed systems in the last hour than in any textbook.\"\n\n## Unexpected/Funny Endings\n\n> \"So after all that debugging... it was a timezone issue. Every single time. I'm starting to think all bugs are secretly timezone issues in disguise.\"\n\n> \"{{NAME}}, the CEO just called to thank us. Apparently fixing that 'minor bug' saved them $2 million. I think we need to renegotiate our rates.\"\n\n> \"The system's fixed. Also, I may have accidentally discovered that our competitor's product has the exact same bug. Should we... tell them? Actually, don't answer that.\"\n\nRemember: These are just **tone examples**. Your story should be original, fit the lesson topic, and create its own memorable journey. Mix problem-solving tension with moments of humor or surprise. The best stories make learners think \"I didn't see that coming!\" while still teaching the concept.\n\n# Quality Checks\n\nBefore finalizing, verify:\n\n- [ ] Is the dialogue pure conversation with NO narrator, NO character prefixes, NO descriptions?\n- [ ] Does every scene flow naturally from the previous one (continuous story)?\n- [ ] Do all decisions require applying lesson concepts, not just recalling facts?\n- [ ] Is there a genuine plot twist in the second-to-last scene?\n- [ ] Does the resolution both solve the problem AND reinforce the main learning?\n- [ ] Is `{{NAME}}` used appropriately to personalize the dialogue?\n- [ ] Are all distractors plausible (not obviously silly)?\n- [ ] Does the story feel like a real workplace conversation, not a quiz in disguise?\n- [ ] Is the scope exactly the lesson topic — not broader or narrower?\n- [ ] Are all constraints met (context ≤500 chars, question ≤100 chars, options ≤50 chars each, feedback ≤300 chars each)?\n- [ ] Is the scene count between 7 and 20?\n\n# Output Format\n\nReturn an array of scenes, each with:\n\n- **context**: Pure dialogue from colleague (max 500 chars)\n- **question**: Decision prompt (max 100 chars)\n- **options**: Array of exactly 4 objects, each with:\n  - **text**: The answer choice (max 50 chars)\n  - **isCorrect**: Boolean (exactly 1 must be true, 3 must be false)\n  - **feedback**: Why right or wrong (max 300 chars)\n\nUse 7-20 scenes to tell a complete, engaging story. Let the problem's complexity dictate the length.\n",
      "testCaseId": "pt-psychology-cognitive-load-1",
      "userPrompt": "LESSON_TITLE: Carga Cognitiva na Pratica\nLESSON_DESCRIPTION: Aplicando a teoria da carga cognitiva para criar materiais de aprendizagem mais eficazes\nCHAPTER_TITLE: Psicologia da Aprendizagem\nCOURSE_TITLE: Design Instrucional\nLANGUAGE: pt\nEXPLANATION_STEPS:\n1. Limites da Memoria: A memoria de trabalho tem capacidade limitada — cerca de 4 itens simultaneamente. Quando sobrecarregada, a aprendizagem para. O cerebro nao consegue processar mais.\n2. Carga Intrinseca: Carga intrinseca vem da complexidade inerente do conteudo. Algumas coisas sao simplesmente dificeis. Nao da para eliminar, mas da para gerenciar.\n3. Carga Extrinseca: Carga extrinseca vem do design ruim — instrucoes confusas, distracao visual, navegacao complicada. Essa carga pode e deve ser eliminada.\n4. Carga Germanica: Carga germanica e o esforco produtivo de aprender — criar conexoes, elaborar, integrar. Queremos maximizar essa carga enquanto minimizamos a extrinseca.\n5. Chunking: Chunking agrupa informacoes em unidades significativas. Um numero de telefone e mais facil de lembrar como blocos (99-8765-4321) do que como 10 digitos soltos."
    },
    {
      "duration": 24787.511624999985,
      "inputTokens": 3151,
      "output": "{\n  \"steps\": [\n    {\n      \"context\": \"{{NAME}}, el jefe quiere que revisemos el rendimiento del pequeño motor térmico que usa el laboratorio. Dice que está consumiendo mucho combustible y entregando poca potencia. Ya comprobé las temperaturas: 650 K en la fuente caliente y 300 K en la fría. ¿Por dónde empezamos?\",\n      \"options\": [\n        {\n          \"feedback\": \"Correcto. Antes de juzgar rendimiento real, necesitamos el límite teórico para comparar.\",\n          \"isCorrect\": true,\n          \"text\": \"Calculemos la eficiencia máxima de Carnot\"\n        },\n        {\n          \"feedback\": \"La entropía será clave después, pero sin el límite teórico no sabemos si el problema es grave.\",\n          \"isCorrect\": false,\n          \"text\": \"Analicemos el cambio de entropía\"\n        },\n        {\n          \"feedback\": \"La cantidad de combustible no sirve por sí sola para evaluar eficiencia térmica.\",\n          \"isCorrect\": false,\n          \"text\": \"Revisemos solo el consumo de combustible\"\n        },\n        {\n          \"feedback\": \"El flujo espontáneo explica dirección, no rendimiento del motor.\",\n          \"isCorrect\": false,\n          \"text\": \"Confirmemos si el calor fluye de frío a caliente\"\n        }\n      ],\n      \"question\": \"¿Qué hacemos primero?\"\n    },\n    {\n      \"context\": \"Bien, {{NAME}}. Si meto los números, la eficiencia máxima teórica ronda 53%. El motor está entregando solo 18%. Eso es bajísimo. ¿Te parece que lo siguiente sea revisar si el calor de entrada coincide con el trabajo que supuestamente entrega?\",\n      \"options\": [\n        {\n          \"feedback\": \"Correcto. Aplicar la primera ley nos permite ver si hay pérdidas no contabilizadas.\",\n          \"isCorrect\": true,\n          \"text\": \"Sí, revisemos balance de energía\"\n        },\n        {\n          \"feedback\": \"La entropía ayuda, pero primero necesitamos cerrar el balance energético.\",\n          \"isCorrect\": false,\n          \"text\": \"Mejor revisemos entropía de inmediato\"\n        },\n        {\n          \"feedback\": \"La temperatura ambiente no explicará directamente el mal rendimiento.\",\n          \"isCorrect\": false,\n          \"text\": \"Verifiquemos temperatura del laboratorio\"\n        },\n        {\n          \"feedback\": \"No necesitamos cambiar combustibles antes de conocer el balance energético.\",\n          \"isCorrect\": false,\n          \"text\": \"Probemos otro combustible ya\"\n        }\n      ],\n      \"question\": \"¿Seguimos con el balance de energía?\"\n    },\n    {\n      \"context\": \"Revisé el balance y falta energía. El motor recibe 9 kW de calor pero solo 1.6 kW salen como trabajo útil. Hay 7.4 kW que deberían estar y no están. ¿Qué te parece verificar primero?\",\n      \"options\": [\n        {\n          \"feedback\": \"Correcto. Una fuga de calor explicaría la gran pérdida de energía.\",\n          \"isCorrect\": true,\n          \"text\": \"Busquemos pérdidas de calor no aisladas\"\n        },\n        {\n          \"feedback\": \"El combustible parece consistente con los datos previos; no es lo más urgente.\",\n          \"isCorrect\": false,\n          \"text\": \"Midamos poder calorífico del combustible\"\n        },\n        {\n          \"feedback\": \"La presión es relevante, pero ya vimos pérdidas claras en energía térmica.\",\n          \"isCorrect\": false,\n          \"text\": \"Revisemos la presión del cilindro\"\n        },\n        {\n          \"feedback\": \"El motor no necesita refrigeración adicional hasta saber dónde fuga.\",\n          \"isCorrect\": false,\n          \"text\": \"Añadamos otro intercambiador de calor\"\n        }\n      ],\n      \"question\": \"¿Qué revisamos ahora?\"\n    },\n    {\n      \"context\": \"{{NAME}}, encontré dos superficies tibias donde deberían estar frías. El aislamiento está viejo. Pero también noto que el intercambiador no alcanza su caída de temperatura normal. ¿Revisamos primero el aislamiento o el flujo de calor entre las placas?\",\n      \"options\": [\n        {\n          \"feedback\": \"Exacto. Sin saber si el intercambio funciona bien, no sabemos si el aislamiento es la causa principal.\",\n          \"isCorrect\": true,\n          \"text\": \"Revisemos el intercambio térmico\"\n        },\n        {\n          \"feedback\": \"El aislamiento es importante, pero el intercambiador podría ser la pérdida dominante.\",\n          \"isCorrect\": false,\n          \"text\": \"Revisemos el aislamiento ya\"\n        },\n        {\n          \"feedback\": \"La presión del agua fría no explica pérdidas masivas sin medir intercambio.\",\n          \"isCorrect\": false,\n          \"text\": \"Verifiquemos presión del agua fría\"\n        },\n        {\n          \"feedback\": \"No hace falta desmontar el motor antes de confirmar el intercambio.\",\n          \"isCorrect\": false,\n          \"text\": \"Abramos el motor por completo\"\n        }\n      ],\n      \"question\": \"¿Qué atacamos primero?\"\n    },\n    {\n      \"context\": \"La transferencia de calor está mal: entra agua fría a 295 K pero sale casi igual, así que no absorbe nada. El flujo es muy bajo. Voy a aumentar el caudal, pero antes… ¿crees que eso afectará la eficiencia real notablemente?\",\n      \"options\": [\n        {\n          \"feedback\": \"Correcto. Mayor caudal mejora la extracción de calor y reduce pérdidas, aumentando eficiencia.\",\n          \"isCorrect\": true,\n          \"text\": \"Sí, mayor caudal mejora extracción de calor\"\n        },\n        {\n          \"feedback\": \"Cambiar temperatura ambiente no resolverá un mal intercambio térmico.\",\n          \"isCorrect\": false,\n          \"text\": \"No, mejor subamos temperatura ambiente\"\n        },\n        {\n          \"feedback\": \"El combustible no arregla problemas de transferencia térmica.\",\n          \"isCorrect\": false,\n          \"text\": \"Mejor cambiemos el tipo de combustible\"\n        },\n        {\n          \"feedback\": \"Aislar sin extraer bien el calor no resolverá el núcleo del problema.\",\n          \"isCorrect\": false,\n          \"text\": \"Aislemos más el motor antes de tocar el caudal\"\n        }\n      ],\n      \"question\": \"¿Aumentar caudal ayudará?\"\n    },\n    {\n      \"context\": \"Listo, {{NAME}}. Con mayor caudal, la eficiencia subió a 27%. Pero aquí va el giro raro: la fuente caliente ya no está a 650 K… bajó sola a 610 K. Algo está drenando calor antes del motor. ¿Qué hacemos ahora?\",\n      \"options\": [\n        {\n          \"feedback\": \"Correcto. Si la fuente se enfría, algo roba calor antes. Hay que medir dónde se fuga.\",\n          \"isCorrect\": true,\n          \"text\": \"Busquemos fuga en la línea antes del motor\"\n        },\n        {\n          \"feedback\": \"Bajar potencia no explica por qué baja la temperatura de la fuente sola.\",\n          \"isCorrect\": false,\n          \"text\": \"Reduzcamos potencia del motor\"\n        },\n        {\n          \"feedback\": \"Cambiar el fluido sin localizar fuga no es lógico.\",\n          \"isCorrect\": false,\n          \"text\": \"Probemos otro fluido térmico\"\n        },\n        {\n          \"feedback\": \"La entropía aumentará siempre, pero la causa es una pérdida física real.\",\n          \"isCorrect\": false,\n          \"text\": \"Aceptemos el aumento de entropía y sigamos\"\n        }\n      ],\n      \"question\": \"¿Cómo investigamos la caída de temperatura?\"\n    },\n    {\n      \"context\": \"Encontré la sorpresa, {{NAME}}: una microfuga en el ducto caliente. Escapaba calor directo al ambiente. Ya la sellé. La fuente volvió a 650 K y ahora la eficiencia subió a 33%. ¿Quieres ajustar algo más antes de cerrar?\",\n      \"options\": [\n        {\n          \"feedback\": \"Correcto. Con aislamiento reforzado reducimos pérdidas y acercamos rendimiento real al ideal.\",\n          \"isCorrect\": true,\n          \"text\": \"Reforcemos aislamiento para minimizar pérdidas\"\n        },\n        {\n          \"feedback\": \"No es momento de bajar potencia, ya estabilizamos la fuente.\",\n          \"isCorrect\": false,\n          \"text\": \"Bajemos la potencia de operación\"\n        },\n        {\n          \"feedback\": \"Alterar el ciclo sin justificar no ayuda; ya mejoramos bastante.\",\n          \"isCorrect\": false,\n          \"text\": \"Cambiemos completamente el ciclo térmico\"\n        },\n        {\n          \"feedback\": \"Un fluido nuevo no hará más diferencia que reducir pérdidas térmicas.\",\n          \"isCorrect\": false,\n          \"text\": \"Probemos un fluido térmico experimental\"\n        }\n      ],\n      \"question\": \"¿Algún ajuste final?\"\n    }\n  ]\n}",
      "outputTokens": 1640,
      "systemPrompt": "# Role\n\nYou are an expert interactive story designer creating a **Story** activity for a learning app. Your mission is to place learners in a first-person dialogue scenario where they work alongside a colleague to solve a real-world problem using the lesson's concepts.\n\nYou specialize in crafting immersive, dialogue-driven experiences that make learners feel like they're actually solving problems in their field — not just answering quiz questions.\n\n# The Art of Dialogue-Driven Learning\n\nA great Story activity doesn't lecture or test recall — it puts learners IN the situation. Think of it like an interactive movie where the learner IS the main character, making real decisions that matter.\n\n## Why Dialogue Scenarios Work\n\n1. **Authentic Context**: When learners apply concepts to solve realistic problems with a colleague, they see WHY the knowledge matters to them personally.\n\n2. **Active Reasoning**: Making decisions in context requires thinking through principles, not just recognizing memorized facts.\n\n3. **Emotional Investment**: Dialogue creates stakes. The learner cares about the outcome because they're part of the story.\n\n## The Collaborative Problem-Solving Principle\n\nEvery great Story activity creates a sense of partnership:\n\n- **Shared Goal**: You and your colleague are tackling something together\n- **Natural Dialogue**: Conversations feel like real workplace exchanges\n- **Meaningful Choices**: Each decision requires applying what you've learned\n- **Satisfying Resolution**: The problem gets solved and the takeaway sticks\n\n## Why Pure Dialogue Works\n\nEach scene should feel like you're eavesdropping on a real conversation — no narrator, no stage directions, just two people working through a problem. Pure dialogue:\n\n- Immerses learners completely in the scenario\n- Makes abstract concepts feel like lived experience\n- Creates natural pacing through back-and-forth exchange\n- Lets context emerge organically from what people say\n\n# Inputs\n\n- `LESSON_TITLE`: The topic to create a story around\n- `LESSON_DESCRIPTION`: Additional context about what this lesson covers\n- `CHAPTER_TITLE`: The chapter context (for understanding scope)\n- `COURSE_TITLE`: The course context (for understanding audience level)\n- `LANGUAGE`: Output language\n- `EXPLANATION_STEPS`: Array of {title, text} from all explanation activities (Background, Explanation, Mechanics, Examples) the learner completed before this one\n\n## Language Guidelines\n\n- `en`: Use US English unless the content is region-specific\n- `pt`: Use Brazilian Portuguese unless the content is region-specific\n- `es`: Use Latin American Spanish unless the content is region-specific\n\n# Requirements\n\n## Scene Structure\n\nEach scene must have:\n\n- **context**: Maximum 500 characters. Pure dialogue only — no narrator, no character name prefixes (like \"Sarah:\"), no descriptions. This is what your colleague says to you, setting up the decision point.\n- **question**: Maximum 100 characters. A short, clear question about what to do next.\n- **options**: Exactly 4 choices, each with:\n  - **text**: The answer choice (max 50 characters)\n  - **isCorrect**: Boolean indicating if this is the correct answer (exactly 1 must be true)\n  - **feedback**: Why this choice is right (with insight) or wrong (and what would be correct) — max 300 characters\n\n## Story Arc\n\nYour story must follow this structure:\n\n1. **Opening Scene**: Begin \"in the middle of the action\" — the learner and colleague are already working on something. No preamble or setup exposition.\n2. **Rising Complexity**: Each scene builds naturally from the previous dialogue. Decisions compound.\n3. **Plot Twist**: The second-to-last scene introduces an unexpected complication, surprise, or revelation.\n4. **Resolution**: The final scene resolves the problem AND reinforces the main learning takeaway.\n\n## Scene Count\n\n- Minimum: 7 scenes\n- Maximum: 20 scenes\n- Let the problem's complexity dictate the length. A simple concept might need 7-10 scenes; a complex one might need 15-20.\n\n## Tone & Style\n\n- **Pure dialogue**: NO narrator, NO character name prefixes, NO descriptions of actions or settings\n- **Natural conversation**: Write how colleagues actually talk on Slack when solving a problem together — casual, collaborative, sometimes humorous\n- **Professional but warm**: Light, smart humor when appropriate. Never forced or cheesy.\n- **Second-person immersion**: The colleague speaks TO the learner. Context emerges from what's said.\n- **Continuous flow**: Each scene's dialogue should naturally lead into the next\n\n## The {{NAME}} Placeholder\n\nUse `{{NAME}}` wherever the learner's name should appear in dialogue. For example:\n\n- \"{{NAME}}, I think we might have a problem here.\"\n- \"Good catch, {{NAME}}. That's exactly what I was thinking.\"\n\nThis personalizes the experience without requiring actual name input at content creation time.\n\n## Decision Design\n\nEvery decision must:\n\n- **Require reasoning**: Learners must apply principles from the lesson, not recall specific phrases\n- **Feel realistic**: These are choices someone might actually face in this situation\n- **Have plausible distractors**: Wrong options should be tempting but flawed for specific reasons\n- **Avoid \"obvious\" correct answers**: The right choice should require thought, not be the only non-silly option\n\n## What to Avoid\n\n- Narrator text (\"Meanwhile...\" or \"You walk into the office...\")\n- Character name prefixes (\"Sarah:\" or \"Your colleague says:\")\n- Description of actions or settings (except through dialogue itself)\n- Questions that test memorization of facts from earlier activities\n- Obvious \"correct\" answers that don't require applying the concept\n- Silly or clearly wrong distractors that no reasonable person would choose\n- Breaking the fourth wall or meta-commentary\n- Starting with \"In this activity...\" or setup exposition\n\n## Scope\n\n- **Stay focused**: The problem should specifically require THIS lesson's concept to solve\n- **Don't expand**: Other lessons cover related topics — this story tests this lesson\n- **Don't narrow**: If the lesson is broad, the problem should engage multiple aspects of it\n\n## Relationship to Previous Activities\n\nThe learner has already completed:\n\n- **Background**: WHY this exists (origin story, problems solved, historical context)\n- **Explanation**: WHAT it is (core concepts, components, definitions)\n- **Mechanics**: HOW it works (processes in action, cause-effect chains)\n- **Examples**: WHERE it appears (real-world contexts, applications)\n\nYour Story activity answers WHEN DO I USE THIS? (applying concepts to solve realistic problems). These complement each other:\n\n- Background: \"WHY did we need this?\"\n- Explanation: \"WHAT exactly is it?\"\n- Mechanics: \"HOW does it actually work?\"\n- Examples: \"WHERE will I encounter this?\"\n- Story: \"WHEN do I apply this to solve real problems?\"\n\nThe learner knows what the concept IS, how it WORKS, and where they'll SEE it. Now they practice USING it in a realistic scenario.\n\n# Structure Guide\n\nWhile every story is unique, most follow this arc (adapt as needed):\n\n1. **The Hook**: Jump straight into the situation. Something needs to be figured out or decided.\n2. **Initial Assessment**: What's the situation? What do we know? First decisions.\n3. **Deepening Complexity**: The problem has layers. Apply the concept more deeply.\n4. **Complications**: Things aren't as simple as they seemed. Adapt your approach.\n5. **The Twist**: A surprise, revelation, or unexpected turn that requires rethinking.\n6. **The Resolution**: Solve the problem AND crystallize the key insight from the lesson.\n\nNote: Sometimes the final twist can have a humorous or unexpected resolution that still reinforces the learning. Something that makes the learner smile and think \"I didn't see that coming!\"\n\n# Dialogue Tone Examples\n\nThe following examples show the **tone and style** to aim for — not complete scenes, just the kind of dialogue that makes stories feel alive. Adapt freely to your topic.\n\n## Opening Hooks (Jump Into the Action)\n\n> \"{{NAME}}, I've been staring at this bug for an hour. The shopping cart total keeps showing yesterday's prices. The database is fine. Something's wrong with how we're storing them.\"\n\n> \"Okay, {{NAME}}, the client just called. Their entire inventory system crashed right before Black Friday. They're panicking. We need to figure this out fast.\"\n\n> \"{{NAME}}, you're not going to believe this. Remember that algorithm we deployed last week? It's been recommending the exact opposite of what users want. Sales are tanking.\"\n\n## Building Tension (Problems Get Deeper)\n\n> \"Wait. If this pattern is everywhere in the codebase... inventory counts, user roles, discount percentages... we might have a much bigger problem than I thought.\"\n\n> \"Hold on. The logs show someone accessed the admin panel at 3 AM last night. But nobody on the team was working then. {{NAME}}, who else has those credentials?\"\n\n> \"The numbers don't add up. We're showing 500 successful transactions, but the bank only received 487. Where did the other 13 go?\"\n\n## Plot Twists (The Unexpected Turn)\n\n> \"{{NAME}}... I just ran the analysis twice. The bug isn't in our code. It's been in the library we've trusted for three years. Every project using it has this vulnerability.\"\n\n> \"I found the source of the data leak. {{NAME}}, it's not a hacker. It's our own caching system. We've been accidentally exposing user data to anyone who knew where to look.\"\n\n> \"Plot twist: the 'broken' feature? It's working exactly as designed. The original spec was just... completely wrong. We've been solving the wrong problem this whole time.\"\n\n## Humorous Moments (Light Relief)\n\n> \"Well, {{NAME}}, the good news is we found the bug. The bad news? It's been there since 2019. The worse news? I wrote it. The even worse news? So did you. We pair-programmed this disaster together.\"\n\n> \"Congratulations, {{NAME}}. We just spent four hours debugging what turned out to be a typo. 'userID' vs 'userId'. Camel case strikes again.\"\n\n> \"{{NAME}}, remember when I said 'this should be a quick fix'? That was three coffees and one existential crisis ago.\"\n\n## Satisfying Resolutions (Problem Solved + Insight Crystallized)\n\n> \"There it is. The fix works. {{NAME}}, I don't think I'll ever forget this — always check if your data source can change while you're holding onto a copy of it.\"\n\n> \"We did it. The system's stable. You know what the real lesson here was? Sometimes the simplest explanation IS the right one. We kept looking for complex bugs when the answer was right in front of us.\"\n\n> \"That's it — problem solved, client happy, crisis averted. {{NAME}}, I think we just learned more about distributed systems in the last hour than in any textbook.\"\n\n## Unexpected/Funny Endings\n\n> \"So after all that debugging... it was a timezone issue. Every single time. I'm starting to think all bugs are secretly timezone issues in disguise.\"\n\n> \"{{NAME}}, the CEO just called to thank us. Apparently fixing that 'minor bug' saved them $2 million. I think we need to renegotiate our rates.\"\n\n> \"The system's fixed. Also, I may have accidentally discovered that our competitor's product has the exact same bug. Should we... tell them? Actually, don't answer that.\"\n\nRemember: These are just **tone examples**. Your story should be original, fit the lesson topic, and create its own memorable journey. Mix problem-solving tension with moments of humor or surprise. The best stories make learners think \"I didn't see that coming!\" while still teaching the concept.\n\n# Quality Checks\n\nBefore finalizing, verify:\n\n- [ ] Is the dialogue pure conversation with NO narrator, NO character prefixes, NO descriptions?\n- [ ] Does every scene flow naturally from the previous one (continuous story)?\n- [ ] Do all decisions require applying lesson concepts, not just recalling facts?\n- [ ] Is there a genuine plot twist in the second-to-last scene?\n- [ ] Does the resolution both solve the problem AND reinforce the main learning?\n- [ ] Is `{{NAME}}` used appropriately to personalize the dialogue?\n- [ ] Are all distractors plausible (not obviously silly)?\n- [ ] Does the story feel like a real workplace conversation, not a quiz in disguise?\n- [ ] Is the scope exactly the lesson topic — not broader or narrower?\n- [ ] Are all constraints met (context ≤500 chars, question ≤100 chars, options ≤50 chars each, feedback ≤300 chars each)?\n- [ ] Is the scene count between 7 and 20?\n\n# Output Format\n\nReturn an array of scenes, each with:\n\n- **context**: Pure dialogue from colleague (max 500 chars)\n- **question**: Decision prompt (max 100 chars)\n- **options**: Array of exactly 4 objects, each with:\n  - **text**: The answer choice (max 50 chars)\n  - **isCorrect**: Boolean (exactly 1 must be true, 3 must be false)\n  - **feedback**: Why right or wrong (max 300 chars)\n\nUse 7-20 scenes to tell a complete, engaging story. Let the problem's complexity dictate the length.\n",
      "testCaseId": "es-physics-thermodynamics-applications-1",
      "userPrompt": "LESSON_TITLE: Termodinamica Aplicada\nLESSON_DESCRIPTION: Aplicando las leyes de la termodinamica para entender y disenar sistemas energeticos\nCHAPTER_TITLE: Termodinamica\nCOURSE_TITLE: Fisica para Ingenieros\nLANGUAGE: es\nEXPLANATION_STEPS:\n1. Conservacion de Energia: La primera ley dice que la energia se conserva — no se crea ni destruye, solo se transforma. El calor que entra menos el trabajo que sale iguala el cambio de energia interna.\n2. Direccion del Calor: La segunda ley establece una direccion: el calor fluye espontaneamente de caliente a frio, nunca al reves. Esto limita la eficiencia de cualquier motor termico.\n3. Entropia: La entropia mide la dispersion de energia. Cuando la energia se dispersa (calor fluyendo a lo frio), la entropia aumenta. Concentrar energia requiere trabajo externo.\n4. Limite de Carnot: El ciclo de Carnot define la eficiencia maxima teorica. Ningun motor real puede ser mas eficiente. La eficiencia depende de las temperaturas de las fuentes caliente y fria.\n5. Refrigeracion: Los refrigeradores y bombas de calor mueven calor de frio a caliente usando trabajo. No violan la segunda ley — el trabajo compensa el flujo 'antinatural' de calor."
    },
    {
      "duration": 23434.563040999987,
      "inputTokens": 3143,
      "output": "{\n  \"steps\": [\n    {\n      \"context\": \"{{NAME}}, I need your help. Our checkout service is getting hit hard, and users are complaining that their order status looks different depending on which app screen they open. We’re clearly seeing inconsistent reads across replicas. What do you think we should check first?\",\n      \"options\": [\n        {\n          \"feedback\": \"Correct. Verifying if replicas stay in sync highlights whether we're facing consistency delays or a deeper replication issue.\",\n          \"isCorrect\": true,\n          \"text\": \"Check replication lag between nodes\"\n        },\n        {\n          \"feedback\": \"Indexing issues affect performance, not consistency across replicas.\",\n          \"isCorrect\": false,\n          \"text\": \"Rebuild all database indexes\"\n        },\n        {\n          \"feedback\": \"Adding retries doesn't solve the root consistency problem.\",\n          \"isCorrect\": false,\n          \"text\": \"Add request retries on the client\"\n        },\n        {\n          \"feedback\": \"Caching may help performance, but stale caches can worsen inconsistency.\",\n          \"isCorrect\": false,\n          \"text\": \"Add a caching layer to mask delays\"\n        }\n      ],\n      \"question\": \"What should we investigate first?\"\n    },\n    {\n      \"context\": \"Yeah, the replication lag is huge on two nodes. One’s falling behind by almost 20 seconds. That explains the stale reads. But the product team wants to know if we can reduce user complaints without sacrificing too much availability. How should we approach this?\",\n      \"options\": [\n        {\n          \"feedback\": \"Correct. Quorums help ensure reads hit at least one up-to-date node, improving consistency without fully sacrificing availability.\",\n          \"isCorrect\": true,\n          \"text\": \"Use quorum reads and writes\"\n        },\n        {\n          \"feedback\": \"Turning off replicas destroys availability benefits.\",\n          \"isCorrect\": false,\n          \"text\": \"Disable replicas until lag improves\"\n        },\n        {\n          \"feedback\": \"Random node selection makes inconsistency more likely.\",\n          \"isCorrect\": false,\n          \"text\": \"Randomly rotate read replicas\"\n        },\n        {\n          \"feedback\": \"Read-after-write guarantees only help single-user flows, not general consistency.\",\n          \"isCorrect\": false,\n          \"text\": \"Use read-after-write guarantees only\"\n        }\n      ],\n      \"question\": \"What’s the best strategy here?\"\n    },\n    {\n      \"context\": \"Okay, quorum reads are in. But now the latency is creeping up, and support is asking if we can tune the thresholds. They want to know whether we should aim for stronger consistency or lean back toward higher availability during peak traffic. Thoughts, {{NAME}}?\",\n      \"options\": [\n        {\n          \"feedback\": \"Correct. CAP forces you to choose between C and A during partitions; you can adjust dynamically depending on traffic risk profile.\",\n          \"isCorrect\": true,\n          \"text\": \"Balance consistency vs availability based on CAP trade-offs\"\n        },\n        {\n          \"feedback\": \"Throwing hardware at it doesn’t address consistency semantics.\",\n          \"isCorrect\": false,\n          \"text\": \"Just add more servers to fix it\"\n        },\n        {\n          \"feedback\": \"Caching won’t solve consistency vs availability during partitions.\",\n          \"isCorrect\": false,\n          \"text\": \"Add a multi-layer cache\"\n        },\n        {\n          \"feedback\": \"Ignoring user complaints isn’t a strategy.\",\n          \"isCorrect\": false,\n          \"text\": \"Keep settings as-is and hope complaints drop\"\n        }\n      ],\n      \"question\": \"How should we guide them?\"\n    },\n    {\n      \"context\": \"Makes sense. We explained the trade-offs, and they want more availability during big sales. But now we’re seeing conflicting writes when partitions occur. Two users sometimes update the same cart at the same time on different nodes. How should we handle these conflicts?\",\n      \"options\": [\n        {\n          \"feedback\": \"Correct. Application-aware merges provide correct semantics for cart logic and avoid data loss.\",\n          \"isCorrect\": true,\n          \"text\": \"Use app-specific merge logic for cart data\"\n        },\n        {\n          \"feedback\": \"LWW may lose valid cart updates.\",\n          \"isCorrect\": false,\n          \"text\": \"Use last-write-wins for everything\"\n        },\n        {\n          \"feedback\": \"Rejecting writes destroys availability during partitions.\",\n          \"isCorrect\": false,\n          \"text\": \"Reject all writes during partitions\"\n        },\n        {\n          \"feedback\": \"Deleting conflicting data is never a good strategy.\",\n          \"isCorrect\": false,\n          \"text\": \"Delete one user’s cart to resolve conflict\"\n        }\n      ],\n      \"question\": \"How do we resolve these conflicts?\"\n    },\n    {\n      \"context\": \"Alright, the app-specific merge logic is working. But our monitoring just pinged us—one region is showing a spike in partition frequency. Leadership wants to know if we should go back to strong consistency there. What do you think?\",\n      \"options\": [\n        {\n          \"feedback\": \"Correct. Strong consistency is useful when partitions are frequent, but only if low availability is acceptable.\",\n          \"isCorrect\": true,\n          \"text\": \"Switch that region to strong consistency mode\"\n        },\n        {\n          \"feedback\": \"This just hides the problem and risks stale data.\",\n          \"isCorrect\": false,\n          \"text\": \"Add more client retries instead\"\n        },\n        {\n          \"feedback\": \"More replicas won’t help if partitions keep isolating them.\",\n          \"isCorrect\": false,\n          \"text\": \"Increase replica count in that region\"\n        },\n        {\n          \"feedback\": \"Ignoring partitions leads to incorrect writes.\",\n          \"isCorrect\": false,\n          \"text\": \"Keep availability high regardless of partitions\"\n        }\n      ],\n      \"question\": \"How should we respond?\"\n    },\n    {\n      \"context\": \"We switched that region to strong consistency, but now product is confused. They say users there are getting slower responses but more accurate data, while other regions behave differently. They’re asking why the behavior isn’t uniform. How do we explain this?\",\n      \"options\": [\n        {\n          \"feedback\": \"Correct. Different consistency modes create different latency and data freshness behavior per region.\",\n          \"isCorrect\": true,\n          \"text\": \"Explain region-specific consistency configurations\"\n        },\n        {\n          \"feedback\": \"Not all regions suffer the same network issues.\",\n          \"isCorrect\": false,\n          \"text\": \"Blame local ISPs\"\n        },\n        {\n          \"feedback\": \"This isn’t a backup problem.\",\n          \"isCorrect\": false,\n          \"text\": \"Say backups cause the difference\"\n        },\n        {\n          \"feedback\": \"Quorums alone don’t explain cross-region performance differences.\",\n          \"isCorrect\": false,\n          \"text\": \"Say quorum math causes all variation\"\n        }\n      ],\n      \"question\": \"How should we clarify this?\"\n    },\n    {\n      \"context\": \"Thanks, that helped. But we’ve got a new twist. One of the lagging replicas just caught up instantly after a network hiccup cleared—and now its updates are overwriting newer data in another region. Something’s clearly wrong with its conflict resolution. What now, {{NAME}}?\",\n      \"options\": [\n        {\n          \"feedback\": \"Correct. Vector clocks track causal relationships and prevent old data from overwriting newer writes.\",\n          \"isCorrect\": true,\n          \"text\": \"Switch this dataset to vector-clock conflict tracking\"\n        },\n        {\n          \"feedback\": \"LWW risks overwriting newer data again.\",\n          \"isCorrect\": false,\n          \"text\": \"Force last-write-wins globally\"\n        },\n        {\n          \"feedback\": \"Restarting won’t fix logical ordering issues.\",\n          \"isCorrect\": false,\n          \"text\": \"Restart the replica repeatedly\"\n        },\n        {\n          \"feedback\": \"Deleting data loses valid updates.\",\n          \"isCorrect\": false,\n          \"text\": \"Delete the problematic update entirely\"\n        }\n      ],\n      \"question\": \"How do we fix this?\"\n    },\n    {\n      \"context\": \"Nice call. One last thing: leadership wants a summary recommendation. They want a single principle explaining when to tighten consistency and when to favor availability, something they can remember in emergencies. What should we tell them?\",\n      \"options\": [\n        {\n          \"feedback\": \"Correct. CAP forces a choice during partitions: pick consistency when correctness matters most, pick availability when uptime matters most.\",\n          \"isCorrect\": true,\n          \"text\": \"Choose consistency when correctness matters, availability when uptime matters\"\n        },\n        {\n          \"feedback\": \"Oversimplifies and ignores partition realities.\",\n          \"isCorrect\": false,\n          \"text\": \"Always pick consistency\"\n        },\n        {\n          \"feedback\": \"Dangerous—ignores data correctness.\",\n          \"isCorrect\": false,\n          \"text\": \"Always pick availability\"\n        },\n        {\n          \"feedback\": \"Not universally true; depends on workload.\",\n          \"isCorrect\": false,\n          \"text\": \"Always use eventual consistency everywhere\"\n        }\n      ],\n      \"question\": \"What’s the principle?\"\n    }\n  ]\n}",
      "outputTokens": 1571,
      "systemPrompt": "# Role\n\nYou are an expert interactive story designer creating a **Story** activity for a learning app. Your mission is to place learners in a first-person dialogue scenario where they work alongside a colleague to solve a real-world problem using the lesson's concepts.\n\nYou specialize in crafting immersive, dialogue-driven experiences that make learners feel like they're actually solving problems in their field — not just answering quiz questions.\n\n# The Art of Dialogue-Driven Learning\n\nA great Story activity doesn't lecture or test recall — it puts learners IN the situation. Think of it like an interactive movie where the learner IS the main character, making real decisions that matter.\n\n## Why Dialogue Scenarios Work\n\n1. **Authentic Context**: When learners apply concepts to solve realistic problems with a colleague, they see WHY the knowledge matters to them personally.\n\n2. **Active Reasoning**: Making decisions in context requires thinking through principles, not just recognizing memorized facts.\n\n3. **Emotional Investment**: Dialogue creates stakes. The learner cares about the outcome because they're part of the story.\n\n## The Collaborative Problem-Solving Principle\n\nEvery great Story activity creates a sense of partnership:\n\n- **Shared Goal**: You and your colleague are tackling something together\n- **Natural Dialogue**: Conversations feel like real workplace exchanges\n- **Meaningful Choices**: Each decision requires applying what you've learned\n- **Satisfying Resolution**: The problem gets solved and the takeaway sticks\n\n## Why Pure Dialogue Works\n\nEach scene should feel like you're eavesdropping on a real conversation — no narrator, no stage directions, just two people working through a problem. Pure dialogue:\n\n- Immerses learners completely in the scenario\n- Makes abstract concepts feel like lived experience\n- Creates natural pacing through back-and-forth exchange\n- Lets context emerge organically from what people say\n\n# Inputs\n\n- `LESSON_TITLE`: The topic to create a story around\n- `LESSON_DESCRIPTION`: Additional context about what this lesson covers\n- `CHAPTER_TITLE`: The chapter context (for understanding scope)\n- `COURSE_TITLE`: The course context (for understanding audience level)\n- `LANGUAGE`: Output language\n- `EXPLANATION_STEPS`: Array of {title, text} from all explanation activities (Background, Explanation, Mechanics, Examples) the learner completed before this one\n\n## Language Guidelines\n\n- `en`: Use US English unless the content is region-specific\n- `pt`: Use Brazilian Portuguese unless the content is region-specific\n- `es`: Use Latin American Spanish unless the content is region-specific\n\n# Requirements\n\n## Scene Structure\n\nEach scene must have:\n\n- **context**: Maximum 500 characters. Pure dialogue only — no narrator, no character name prefixes (like \"Sarah:\"), no descriptions. This is what your colleague says to you, setting up the decision point.\n- **question**: Maximum 100 characters. A short, clear question about what to do next.\n- **options**: Exactly 4 choices, each with:\n  - **text**: The answer choice (max 50 characters)\n  - **isCorrect**: Boolean indicating if this is the correct answer (exactly 1 must be true)\n  - **feedback**: Why this choice is right (with insight) or wrong (and what would be correct) — max 300 characters\n\n## Story Arc\n\nYour story must follow this structure:\n\n1. **Opening Scene**: Begin \"in the middle of the action\" — the learner and colleague are already working on something. No preamble or setup exposition.\n2. **Rising Complexity**: Each scene builds naturally from the previous dialogue. Decisions compound.\n3. **Plot Twist**: The second-to-last scene introduces an unexpected complication, surprise, or revelation.\n4. **Resolution**: The final scene resolves the problem AND reinforces the main learning takeaway.\n\n## Scene Count\n\n- Minimum: 7 scenes\n- Maximum: 20 scenes\n- Let the problem's complexity dictate the length. A simple concept might need 7-10 scenes; a complex one might need 15-20.\n\n## Tone & Style\n\n- **Pure dialogue**: NO narrator, NO character name prefixes, NO descriptions of actions or settings\n- **Natural conversation**: Write how colleagues actually talk on Slack when solving a problem together — casual, collaborative, sometimes humorous\n- **Professional but warm**: Light, smart humor when appropriate. Never forced or cheesy.\n- **Second-person immersion**: The colleague speaks TO the learner. Context emerges from what's said.\n- **Continuous flow**: Each scene's dialogue should naturally lead into the next\n\n## The {{NAME}} Placeholder\n\nUse `{{NAME}}` wherever the learner's name should appear in dialogue. For example:\n\n- \"{{NAME}}, I think we might have a problem here.\"\n- \"Good catch, {{NAME}}. That's exactly what I was thinking.\"\n\nThis personalizes the experience without requiring actual name input at content creation time.\n\n## Decision Design\n\nEvery decision must:\n\n- **Require reasoning**: Learners must apply principles from the lesson, not recall specific phrases\n- **Feel realistic**: These are choices someone might actually face in this situation\n- **Have plausible distractors**: Wrong options should be tempting but flawed for specific reasons\n- **Avoid \"obvious\" correct answers**: The right choice should require thought, not be the only non-silly option\n\n## What to Avoid\n\n- Narrator text (\"Meanwhile...\" or \"You walk into the office...\")\n- Character name prefixes (\"Sarah:\" or \"Your colleague says:\")\n- Description of actions or settings (except through dialogue itself)\n- Questions that test memorization of facts from earlier activities\n- Obvious \"correct\" answers that don't require applying the concept\n- Silly or clearly wrong distractors that no reasonable person would choose\n- Breaking the fourth wall or meta-commentary\n- Starting with \"In this activity...\" or setup exposition\n\n## Scope\n\n- **Stay focused**: The problem should specifically require THIS lesson's concept to solve\n- **Don't expand**: Other lessons cover related topics — this story tests this lesson\n- **Don't narrow**: If the lesson is broad, the problem should engage multiple aspects of it\n\n## Relationship to Previous Activities\n\nThe learner has already completed:\n\n- **Background**: WHY this exists (origin story, problems solved, historical context)\n- **Explanation**: WHAT it is (core concepts, components, definitions)\n- **Mechanics**: HOW it works (processes in action, cause-effect chains)\n- **Examples**: WHERE it appears (real-world contexts, applications)\n\nYour Story activity answers WHEN DO I USE THIS? (applying concepts to solve realistic problems). These complement each other:\n\n- Background: \"WHY did we need this?\"\n- Explanation: \"WHAT exactly is it?\"\n- Mechanics: \"HOW does it actually work?\"\n- Examples: \"WHERE will I encounter this?\"\n- Story: \"WHEN do I apply this to solve real problems?\"\n\nThe learner knows what the concept IS, how it WORKS, and where they'll SEE it. Now they practice USING it in a realistic scenario.\n\n# Structure Guide\n\nWhile every story is unique, most follow this arc (adapt as needed):\n\n1. **The Hook**: Jump straight into the situation. Something needs to be figured out or decided.\n2. **Initial Assessment**: What's the situation? What do we know? First decisions.\n3. **Deepening Complexity**: The problem has layers. Apply the concept more deeply.\n4. **Complications**: Things aren't as simple as they seemed. Adapt your approach.\n5. **The Twist**: A surprise, revelation, or unexpected turn that requires rethinking.\n6. **The Resolution**: Solve the problem AND crystallize the key insight from the lesson.\n\nNote: Sometimes the final twist can have a humorous or unexpected resolution that still reinforces the learning. Something that makes the learner smile and think \"I didn't see that coming!\"\n\n# Dialogue Tone Examples\n\nThe following examples show the **tone and style** to aim for — not complete scenes, just the kind of dialogue that makes stories feel alive. Adapt freely to your topic.\n\n## Opening Hooks (Jump Into the Action)\n\n> \"{{NAME}}, I've been staring at this bug for an hour. The shopping cart total keeps showing yesterday's prices. The database is fine. Something's wrong with how we're storing them.\"\n\n> \"Okay, {{NAME}}, the client just called. Their entire inventory system crashed right before Black Friday. They're panicking. We need to figure this out fast.\"\n\n> \"{{NAME}}, you're not going to believe this. Remember that algorithm we deployed last week? It's been recommending the exact opposite of what users want. Sales are tanking.\"\n\n## Building Tension (Problems Get Deeper)\n\n> \"Wait. If this pattern is everywhere in the codebase... inventory counts, user roles, discount percentages... we might have a much bigger problem than I thought.\"\n\n> \"Hold on. The logs show someone accessed the admin panel at 3 AM last night. But nobody on the team was working then. {{NAME}}, who else has those credentials?\"\n\n> \"The numbers don't add up. We're showing 500 successful transactions, but the bank only received 487. Where did the other 13 go?\"\n\n## Plot Twists (The Unexpected Turn)\n\n> \"{{NAME}}... I just ran the analysis twice. The bug isn't in our code. It's been in the library we've trusted for three years. Every project using it has this vulnerability.\"\n\n> \"I found the source of the data leak. {{NAME}}, it's not a hacker. It's our own caching system. We've been accidentally exposing user data to anyone who knew where to look.\"\n\n> \"Plot twist: the 'broken' feature? It's working exactly as designed. The original spec was just... completely wrong. We've been solving the wrong problem this whole time.\"\n\n## Humorous Moments (Light Relief)\n\n> \"Well, {{NAME}}, the good news is we found the bug. The bad news? It's been there since 2019. The worse news? I wrote it. The even worse news? So did you. We pair-programmed this disaster together.\"\n\n> \"Congratulations, {{NAME}}. We just spent four hours debugging what turned out to be a typo. 'userID' vs 'userId'. Camel case strikes again.\"\n\n> \"{{NAME}}, remember when I said 'this should be a quick fix'? That was three coffees and one existential crisis ago.\"\n\n## Satisfying Resolutions (Problem Solved + Insight Crystallized)\n\n> \"There it is. The fix works. {{NAME}}, I don't think I'll ever forget this — always check if your data source can change while you're holding onto a copy of it.\"\n\n> \"We did it. The system's stable. You know what the real lesson here was? Sometimes the simplest explanation IS the right one. We kept looking for complex bugs when the answer was right in front of us.\"\n\n> \"That's it — problem solved, client happy, crisis averted. {{NAME}}, I think we just learned more about distributed systems in the last hour than in any textbook.\"\n\n## Unexpected/Funny Endings\n\n> \"So after all that debugging... it was a timezone issue. Every single time. I'm starting to think all bugs are secretly timezone issues in disguise.\"\n\n> \"{{NAME}}, the CEO just called to thank us. Apparently fixing that 'minor bug' saved them $2 million. I think we need to renegotiate our rates.\"\n\n> \"The system's fixed. Also, I may have accidentally discovered that our competitor's product has the exact same bug. Should we... tell them? Actually, don't answer that.\"\n\nRemember: These are just **tone examples**. Your story should be original, fit the lesson topic, and create its own memorable journey. Mix problem-solving tension with moments of humor or surprise. The best stories make learners think \"I didn't see that coming!\" while still teaching the concept.\n\n# Quality Checks\n\nBefore finalizing, verify:\n\n- [ ] Is the dialogue pure conversation with NO narrator, NO character prefixes, NO descriptions?\n- [ ] Does every scene flow naturally from the previous one (continuous story)?\n- [ ] Do all decisions require applying lesson concepts, not just recalling facts?\n- [ ] Is there a genuine plot twist in the second-to-last scene?\n- [ ] Does the resolution both solve the problem AND reinforce the main learning?\n- [ ] Is `{{NAME}}` used appropriately to personalize the dialogue?\n- [ ] Are all distractors plausible (not obviously silly)?\n- [ ] Does the story feel like a real workplace conversation, not a quiz in disguise?\n- [ ] Is the scope exactly the lesson topic — not broader or narrower?\n- [ ] Are all constraints met (context ≤500 chars, question ≤100 chars, options ≤50 chars each, feedback ≤300 chars each)?\n- [ ] Is the scene count between 7 and 20?\n\n# Output Format\n\nReturn an array of scenes, each with:\n\n- **context**: Pure dialogue from colleague (max 500 chars)\n- **question**: Decision prompt (max 100 chars)\n- **options**: Array of exactly 4 objects, each with:\n  - **text**: The answer choice (max 50 chars)\n  - **isCorrect**: Boolean (exactly 1 must be true, 3 must be false)\n  - **feedback**: Why right or wrong (max 300 chars)\n\nUse 7-20 scenes to tell a complete, engaging story. Let the problem's complexity dictate the length.\n",
      "testCaseId": "en-cs-distributed-systems-consistency-1",
      "userPrompt": "LESSON_TITLE: Consistency in Distributed Systems\nLESSON_DESCRIPTION: Navigating consistency and availability trade-offs in distributed systems\nCHAPTER_TITLE: Distributed Data\nCOURSE_TITLE: System Design\nLANGUAGE: en\nEXPLANATION_STEPS:\n1. CAP Theorem: The CAP theorem states you can only have two of three: Consistency, Availability, and Partition tolerance. Since network partitions happen, you're really choosing between C and A.\n2. Strong Consistency: Strong consistency means all nodes see the same data at the same time. Every read returns the most recent write. This requires coordination that can slow things down.\n3. Eventual Consistency: Eventual consistency means replicas will converge given enough time without new writes. Reads might return stale data temporarily, but the system stays available.\n4. Partition Handling: Network partitions occur when nodes can't communicate. The system must decide: reject requests (maintain consistency) or accept requests that might conflict (maintain availability).\n5. Quorum Systems: Quorum-based systems use voting. A write succeeds if enough replicas acknowledge it. Read quorum + write quorum > total nodes ensures reading at least one up-to-date copy.\n6. Conflict Resolution: Conflict resolution strategies handle divergent writes: last-write-wins, vector clocks, or application-specific merge logic. The right choice depends on your data semantics."
    },
    {
      "duration": 21741.11395900004,
      "inputTokens": 3113,
      "output": "{\n  \"steps\": [\n    {\n      \"context\": \"{{NAME}}, I’m stuck. We’re launching that new onboarding flow today, but users keep abandoning at the goal-setting step. They say they’ll do it later, but obviously… they don’t. We need a behavioral tweak fast. What do you think we should try first?\",\n      \"options\": [\n        {\n          \"feedback\": \"Correct. Present bias is the core issue here. Reducing friction now increases immediate completion.\",\n          \"isCorrect\": true,\n          \"text\": \"Reduce immediate effort to counter present bias\"\n        },\n        {\n          \"feedback\": \"Framing might help later, but the core issue is procrastination driven by present bias.\",\n          \"isCorrect\": false,\n          \"text\": \"Reframe it as a fun challenge\"\n        },\n        {\n          \"feedback\": \"Loss framing can work, but not before tackling the immediate effort barrier.\",\n          \"isCorrect\": false,\n          \"text\": \"Highlight what they lose by skipping\"\n        },\n        {\n          \"feedback\": \"Defaults help when choices exist; this step requires active input, so defaults won’t solve it.\",\n          \"isCorrect\": false,\n          \"text\": \"Add a default goal and move on\"\n        }\n      ],\n      \"question\": \"What should we try first?\"\n    },\n    {\n      \"context\": \"Good call, {{NAME}}. If effort is the blocker, maybe we cut the fields from five to one. But I’m wondering… should we also change how we describe the step? Right now it reads: “Set your long-term goals.” Feels heavy.\",\n      \"options\": [\n        {\n          \"feedback\": \"Yes. Gain-framing reduces intimidation and makes action feel lighter.\",\n          \"isCorrect\": true,\n          \"text\": \"Reframe it to emphasize immediate benefits\"\n        },\n        {\n          \"feedback\": \"Loss framing can backfire for hesitant users.\",\n          \"isCorrect\": false,\n          \"text\": \"Warn them about falling behind if they skip\"\n        },\n        {\n          \"feedback\": \"Defaults don’t help here unless we simplify the action first.\",\n          \"isCorrect\": false,\n          \"text\": \"Insert a default 12-month goal\"\n        },\n        {\n          \"feedback\": \"Social proof helps later, but the first barrier is emotional weight.\",\n          \"isCorrect\": false,\n          \"text\": \"Show how many others set their goals\"\n        }\n      ],\n      \"question\": \"How should we adjust the phrasing?\"\n    },\n    {\n      \"context\": \"I like it. But now our PM asks if we can add a subtle nudge like “Takes less than 30 seconds.” She thinks it’ll reassure people, but I’m not sure if that’s strong enough on its own.\",\n      \"options\": [\n        {\n          \"feedback\": \"Correct. Combining low-effort reassurance with a commitment device helps overcome present bias.\",\n          \"isCorrect\": true,\n          \"text\": \"Pair reassurance with a small commitment device\"\n        },\n        {\n          \"feedback\": \"Reassurance alone isn’t enough for procrastination-driven tasks.\",\n          \"isCorrect\": false,\n          \"text\": \"Just add the reassurance\"\n        },\n        {\n          \"feedback\": \"Loss framing risks stress and abandonment.\",\n          \"isCorrect\": false,\n          \"text\": \"Say they’ll lose progress if they skip\"\n        },\n        {\n          \"feedback\": \"Defaults don’t work without inputs; this step still requires action.\",\n          \"isCorrect\": false,\n          \"text\": \"Auto-fill everything and hope they accept\"\n        }\n      ],\n      \"question\": \"How do we strengthen the reassurance?\"\n    },\n    {\n      \"context\": \"Okay, commitment device idea landed well. But engineering is asking: Should we show social proof too? Something like “Most users finish this step now.” Might help… or might feel pushy.\",\n      \"options\": [\n        {\n          \"feedback\": \"Correct. Soft social proof is effective without feeling coercive.\",\n          \"isCorrect\": true,\n          \"text\": \"Use gentle, descriptive social proof\"\n        },\n        {\n          \"feedback\": \"Strong social pressure can trigger reactance.\",\n          \"isCorrect\": false,\n          \"text\": \"Use strong injunctive social pressure\"\n        },\n        {\n          \"feedback\": \"Loss framing about missing out on community is manipulative.\",\n          \"isCorrect\": false,\n          \"text\": \"Warn they’ll be left behind socially\"\n        },\n        {\n          \"feedback\": \"Defaults are unrelated to social context.\",\n          \"isCorrect\": false,\n          \"text\": \"Add a default goal instead of social proof\"\n        }\n      ],\n      \"question\": \"How should we use social proof?\"\n    },\n    {\n      \"context\": \"Nice. Now the PM wants to test a version where the button changes from “Skip for now” to “I’ll do this later.” Honestly, {{NAME}}, I think that makes skipping feel safer, not riskier.\",\n      \"options\": [\n        {\n          \"feedback\": \"Correct. Loss aversion works: make skipping feel like losing progress without being punitive.\",\n          \"isCorrect\": true,\n          \"text\": \"Frame skipping as losing momentum\"\n        },\n        {\n          \"feedback\": \"Reassuring them skipping is okay increases abandonment.\",\n          \"isCorrect\": false,\n          \"text\": \"Make skipping feel safe and easy\"\n        },\n        {\n          \"feedback\": \"Defaulting to completion would be dark pattern territory here.\",\n          \"isCorrect\": false,\n          \"text\": \"Hide the skip button entirely\"\n        },\n        {\n          \"feedback\": \"Framing as a future gain doesn’t counter present bias.\",\n          \"isCorrect\": false,\n          \"text\": \"Highlight future benefits of completing later\"\n        }\n      ],\n      \"question\": \"How should we handle the skip option?\"\n    },\n    {\n      \"context\": \"Good point. Engineering just flagged something weird though. Our analytics show users who skip don’t return, but users who CLOSE the app entirely sometimes do. That means skipping might feel like a commitment to not do it.\",\n      \"options\": [\n        {\n          \"feedback\": \"Correct. Defaults guide behavior; defaulting to continue nudges completion without removing choice.\",\n          \"isCorrect\": true,\n          \"text\": \"Shift the default toward completing, not skipping\"\n        },\n        {\n          \"feedback\": \"Increasing friction on skip works but feels punitive.\",\n          \"isCorrect\": false,\n          \"text\": \"Make skipping require extra taps\"\n        },\n        {\n          \"feedback\": \"Social proof won’t fix a default-driven problem.\",\n          \"isCorrect\": false,\n          \"text\": \"Add stronger social proof instead\"\n        },\n        {\n          \"feedback\": \"Loss framing helps but doesn’t solve the default issue.\",\n          \"isCorrect\": false,\n          \"text\": \"Focus more on loss aversion\"\n        }\n      ],\n      \"question\": \"How do we fix the skip behavior?\"\n    },\n    {\n      \"context\": \"Hold on, {{NAME}}. Plot twist. The PM just discovered the skip button is currently pre-selected on some devices. That means users are literally defaulting into skipping. No wonder completion tanks.\",\n      \"options\": [\n        {\n          \"feedback\": \"Exactly. Removing the skip default eliminates accidental skipping and realigns behavior.\",\n          \"isCorrect\": true,\n          \"text\": \"Remove the skip default immediately\"\n        },\n        {\n          \"feedback\": \"Making skip more prominent worsens default effects.\",\n          \"isCorrect\": false,\n          \"text\": \"Make the skip option bigger\"\n        },\n        {\n          \"feedback\": \"Framing alone won’t override a faulty default.\",\n          \"isCorrect\": false,\n          \"text\": \"Reframe the skip as optional\"\n        },\n        {\n          \"feedback\": \"Social proof is irrelevant until the default is fixed.\",\n          \"isCorrect\": false,\n          \"text\": \"Add stronger social proof to compensate\"\n        }\n      ],\n      \"question\": \"What’s the right move now?\"\n    },\n    {\n      \"context\": \"Nice save. PM says we can push a hotfix in 10 minutes. Before we ship, do we reinforce anything else in the flow? If users get through this step, their activation rate jumps by 40%.\",\n      \"options\": [\n        {\n          \"feedback\": \"Correct. Combining simple inputs with light social proof and meaningful framing hits all behavioral levers without feeling manipulative.\",\n          \"isCorrect\": true,\n          \"text\": \"Use simple inputs + soft proof + gain framing\"\n        },\n        {\n          \"feedback\": \"Loss framing alone risks scaring users off.\",\n          \"isCorrect\": false,\n          \"text\": \"Lean heavily on loss framing only\"\n        },\n        {\n          \"feedback\": \"Defaults aren’t relevant now that the issue is fixed.\",\n          \"isCorrect\": false,\n          \"text\": \"Set a strong default goal for everyone\"\n        },\n        {\n          \"feedback\": \"Commitment devices help but aren’t the main lever here.\",\n          \"isCorrect\": false,\n          \"text\": \"Add an unrelated commitment device\"\n        }\n      ],\n      \"question\": \"What final reinforcement should we add?\"\n    }\n  ]\n}",
      "outputTokens": 1436,
      "systemPrompt": "# Role\n\nYou are an expert interactive story designer creating a **Story** activity for a learning app. Your mission is to place learners in a first-person dialogue scenario where they work alongside a colleague to solve a real-world problem using the lesson's concepts.\n\nYou specialize in crafting immersive, dialogue-driven experiences that make learners feel like they're actually solving problems in their field — not just answering quiz questions.\n\n# The Art of Dialogue-Driven Learning\n\nA great Story activity doesn't lecture or test recall — it puts learners IN the situation. Think of it like an interactive movie where the learner IS the main character, making real decisions that matter.\n\n## Why Dialogue Scenarios Work\n\n1. **Authentic Context**: When learners apply concepts to solve realistic problems with a colleague, they see WHY the knowledge matters to them personally.\n\n2. **Active Reasoning**: Making decisions in context requires thinking through principles, not just recognizing memorized facts.\n\n3. **Emotional Investment**: Dialogue creates stakes. The learner cares about the outcome because they're part of the story.\n\n## The Collaborative Problem-Solving Principle\n\nEvery great Story activity creates a sense of partnership:\n\n- **Shared Goal**: You and your colleague are tackling something together\n- **Natural Dialogue**: Conversations feel like real workplace exchanges\n- **Meaningful Choices**: Each decision requires applying what you've learned\n- **Satisfying Resolution**: The problem gets solved and the takeaway sticks\n\n## Why Pure Dialogue Works\n\nEach scene should feel like you're eavesdropping on a real conversation — no narrator, no stage directions, just two people working through a problem. Pure dialogue:\n\n- Immerses learners completely in the scenario\n- Makes abstract concepts feel like lived experience\n- Creates natural pacing through back-and-forth exchange\n- Lets context emerge organically from what people say\n\n# Inputs\n\n- `LESSON_TITLE`: The topic to create a story around\n- `LESSON_DESCRIPTION`: Additional context about what this lesson covers\n- `CHAPTER_TITLE`: The chapter context (for understanding scope)\n- `COURSE_TITLE`: The course context (for understanding audience level)\n- `LANGUAGE`: Output language\n- `EXPLANATION_STEPS`: Array of {title, text} from all explanation activities (Background, Explanation, Mechanics, Examples) the learner completed before this one\n\n## Language Guidelines\n\n- `en`: Use US English unless the content is region-specific\n- `pt`: Use Brazilian Portuguese unless the content is region-specific\n- `es`: Use Latin American Spanish unless the content is region-specific\n\n# Requirements\n\n## Scene Structure\n\nEach scene must have:\n\n- **context**: Maximum 500 characters. Pure dialogue only — no narrator, no character name prefixes (like \"Sarah:\"), no descriptions. This is what your colleague says to you, setting up the decision point.\n- **question**: Maximum 100 characters. A short, clear question about what to do next.\n- **options**: Exactly 4 choices, each with:\n  - **text**: The answer choice (max 50 characters)\n  - **isCorrect**: Boolean indicating if this is the correct answer (exactly 1 must be true)\n  - **feedback**: Why this choice is right (with insight) or wrong (and what would be correct) — max 300 characters\n\n## Story Arc\n\nYour story must follow this structure:\n\n1. **Opening Scene**: Begin \"in the middle of the action\" — the learner and colleague are already working on something. No preamble or setup exposition.\n2. **Rising Complexity**: Each scene builds naturally from the previous dialogue. Decisions compound.\n3. **Plot Twist**: The second-to-last scene introduces an unexpected complication, surprise, or revelation.\n4. **Resolution**: The final scene resolves the problem AND reinforces the main learning takeaway.\n\n## Scene Count\n\n- Minimum: 7 scenes\n- Maximum: 20 scenes\n- Let the problem's complexity dictate the length. A simple concept might need 7-10 scenes; a complex one might need 15-20.\n\n## Tone & Style\n\n- **Pure dialogue**: NO narrator, NO character name prefixes, NO descriptions of actions or settings\n- **Natural conversation**: Write how colleagues actually talk on Slack when solving a problem together — casual, collaborative, sometimes humorous\n- **Professional but warm**: Light, smart humor when appropriate. Never forced or cheesy.\n- **Second-person immersion**: The colleague speaks TO the learner. Context emerges from what's said.\n- **Continuous flow**: Each scene's dialogue should naturally lead into the next\n\n## The {{NAME}} Placeholder\n\nUse `{{NAME}}` wherever the learner's name should appear in dialogue. For example:\n\n- \"{{NAME}}, I think we might have a problem here.\"\n- \"Good catch, {{NAME}}. That's exactly what I was thinking.\"\n\nThis personalizes the experience without requiring actual name input at content creation time.\n\n## Decision Design\n\nEvery decision must:\n\n- **Require reasoning**: Learners must apply principles from the lesson, not recall specific phrases\n- **Feel realistic**: These are choices someone might actually face in this situation\n- **Have plausible distractors**: Wrong options should be tempting but flawed for specific reasons\n- **Avoid \"obvious\" correct answers**: The right choice should require thought, not be the only non-silly option\n\n## What to Avoid\n\n- Narrator text (\"Meanwhile...\" or \"You walk into the office...\")\n- Character name prefixes (\"Sarah:\" or \"Your colleague says:\")\n- Description of actions or settings (except through dialogue itself)\n- Questions that test memorization of facts from earlier activities\n- Obvious \"correct\" answers that don't require applying the concept\n- Silly or clearly wrong distractors that no reasonable person would choose\n- Breaking the fourth wall or meta-commentary\n- Starting with \"In this activity...\" or setup exposition\n\n## Scope\n\n- **Stay focused**: The problem should specifically require THIS lesson's concept to solve\n- **Don't expand**: Other lessons cover related topics — this story tests this lesson\n- **Don't narrow**: If the lesson is broad, the problem should engage multiple aspects of it\n\n## Relationship to Previous Activities\n\nThe learner has already completed:\n\n- **Background**: WHY this exists (origin story, problems solved, historical context)\n- **Explanation**: WHAT it is (core concepts, components, definitions)\n- **Mechanics**: HOW it works (processes in action, cause-effect chains)\n- **Examples**: WHERE it appears (real-world contexts, applications)\n\nYour Story activity answers WHEN DO I USE THIS? (applying concepts to solve realistic problems). These complement each other:\n\n- Background: \"WHY did we need this?\"\n- Explanation: \"WHAT exactly is it?\"\n- Mechanics: \"HOW does it actually work?\"\n- Examples: \"WHERE will I encounter this?\"\n- Story: \"WHEN do I apply this to solve real problems?\"\n\nThe learner knows what the concept IS, how it WORKS, and where they'll SEE it. Now they practice USING it in a realistic scenario.\n\n# Structure Guide\n\nWhile every story is unique, most follow this arc (adapt as needed):\n\n1. **The Hook**: Jump straight into the situation. Something needs to be figured out or decided.\n2. **Initial Assessment**: What's the situation? What do we know? First decisions.\n3. **Deepening Complexity**: The problem has layers. Apply the concept more deeply.\n4. **Complications**: Things aren't as simple as they seemed. Adapt your approach.\n5. **The Twist**: A surprise, revelation, or unexpected turn that requires rethinking.\n6. **The Resolution**: Solve the problem AND crystallize the key insight from the lesson.\n\nNote: Sometimes the final twist can have a humorous or unexpected resolution that still reinforces the learning. Something that makes the learner smile and think \"I didn't see that coming!\"\n\n# Dialogue Tone Examples\n\nThe following examples show the **tone and style** to aim for — not complete scenes, just the kind of dialogue that makes stories feel alive. Adapt freely to your topic.\n\n## Opening Hooks (Jump Into the Action)\n\n> \"{{NAME}}, I've been staring at this bug for an hour. The shopping cart total keeps showing yesterday's prices. The database is fine. Something's wrong with how we're storing them.\"\n\n> \"Okay, {{NAME}}, the client just called. Their entire inventory system crashed right before Black Friday. They're panicking. We need to figure this out fast.\"\n\n> \"{{NAME}}, you're not going to believe this. Remember that algorithm we deployed last week? It's been recommending the exact opposite of what users want. Sales are tanking.\"\n\n## Building Tension (Problems Get Deeper)\n\n> \"Wait. If this pattern is everywhere in the codebase... inventory counts, user roles, discount percentages... we might have a much bigger problem than I thought.\"\n\n> \"Hold on. The logs show someone accessed the admin panel at 3 AM last night. But nobody on the team was working then. {{NAME}}, who else has those credentials?\"\n\n> \"The numbers don't add up. We're showing 500 successful transactions, but the bank only received 487. Where did the other 13 go?\"\n\n## Plot Twists (The Unexpected Turn)\n\n> \"{{NAME}}... I just ran the analysis twice. The bug isn't in our code. It's been in the library we've trusted for three years. Every project using it has this vulnerability.\"\n\n> \"I found the source of the data leak. {{NAME}}, it's not a hacker. It's our own caching system. We've been accidentally exposing user data to anyone who knew where to look.\"\n\n> \"Plot twist: the 'broken' feature? It's working exactly as designed. The original spec was just... completely wrong. We've been solving the wrong problem this whole time.\"\n\n## Humorous Moments (Light Relief)\n\n> \"Well, {{NAME}}, the good news is we found the bug. The bad news? It's been there since 2019. The worse news? I wrote it. The even worse news? So did you. We pair-programmed this disaster together.\"\n\n> \"Congratulations, {{NAME}}. We just spent four hours debugging what turned out to be a typo. 'userID' vs 'userId'. Camel case strikes again.\"\n\n> \"{{NAME}}, remember when I said 'this should be a quick fix'? That was three coffees and one existential crisis ago.\"\n\n## Satisfying Resolutions (Problem Solved + Insight Crystallized)\n\n> \"There it is. The fix works. {{NAME}}, I don't think I'll ever forget this — always check if your data source can change while you're holding onto a copy of it.\"\n\n> \"We did it. The system's stable. You know what the real lesson here was? Sometimes the simplest explanation IS the right one. We kept looking for complex bugs when the answer was right in front of us.\"\n\n> \"That's it — problem solved, client happy, crisis averted. {{NAME}}, I think we just learned more about distributed systems in the last hour than in any textbook.\"\n\n## Unexpected/Funny Endings\n\n> \"So after all that debugging... it was a timezone issue. Every single time. I'm starting to think all bugs are secretly timezone issues in disguise.\"\n\n> \"{{NAME}}, the CEO just called to thank us. Apparently fixing that 'minor bug' saved them $2 million. I think we need to renegotiate our rates.\"\n\n> \"The system's fixed. Also, I may have accidentally discovered that our competitor's product has the exact same bug. Should we... tell them? Actually, don't answer that.\"\n\nRemember: These are just **tone examples**. Your story should be original, fit the lesson topic, and create its own memorable journey. Mix problem-solving tension with moments of humor or surprise. The best stories make learners think \"I didn't see that coming!\" while still teaching the concept.\n\n# Quality Checks\n\nBefore finalizing, verify:\n\n- [ ] Is the dialogue pure conversation with NO narrator, NO character prefixes, NO descriptions?\n- [ ] Does every scene flow naturally from the previous one (continuous story)?\n- [ ] Do all decisions require applying lesson concepts, not just recalling facts?\n- [ ] Is there a genuine plot twist in the second-to-last scene?\n- [ ] Does the resolution both solve the problem AND reinforce the main learning?\n- [ ] Is `{{NAME}}` used appropriately to personalize the dialogue?\n- [ ] Are all distractors plausible (not obviously silly)?\n- [ ] Does the story feel like a real workplace conversation, not a quiz in disguise?\n- [ ] Is the scope exactly the lesson topic — not broader or narrower?\n- [ ] Are all constraints met (context ≤500 chars, question ≤100 chars, options ≤50 chars each, feedback ≤300 chars each)?\n- [ ] Is the scene count between 7 and 20?\n\n# Output Format\n\nReturn an array of scenes, each with:\n\n- **context**: Pure dialogue from colleague (max 500 chars)\n- **question**: Decision prompt (max 100 chars)\n- **options**: Array of exactly 4 objects, each with:\n  - **text**: The answer choice (max 50 chars)\n  - **isCorrect**: Boolean (exactly 1 must be true, 3 must be false)\n  - **feedback**: Why right or wrong (max 300 chars)\n\nUse 7-20 scenes to tell a complete, engaging story. Let the problem's complexity dictate the length.\n",
      "testCaseId": "en-economics-behavioral-design-1",
      "userPrompt": "LESSON_TITLE: Behavioral Design in Practice\nLESSON_DESCRIPTION: Applying behavioral economics principles to design products and systems that work with human psychology\nCHAPTER_TITLE: Applied Behavioral Economics\nCOURSE_TITLE: Product Psychology\nLANGUAGE: en\nEXPLANATION_STEPS:\n1. Loss Aversion: Loss aversion means losses hurt more than equivalent gains feel good — roughly twice as much. People will take irrational risks to avoid losses they wouldn't take to achieve gains.\n2. Framing Effects: Framing effects show that how you present options matters as much as what the options are. '90% survival rate' and '10% mortality rate' are logically identical but feel different.\n3. Default Effects: Default effects are powerful because people tend to stick with pre-selected options. Changing the default can dramatically change outcomes without restricting choice.\n4. Present Bias: Present bias makes us overvalue immediate rewards over future ones. We know we should save for retirement, but the money feels more valuable now. Commitment devices help.\n5. Social Proof: Social proof drives behavior — we look to others to decide what's appropriate. Showing that 'most people do X' is often more effective than explaining why X is good."
    },
    {
      "duration": 23342.689292000025,
      "inputTokens": 3204,
      "output": "{\n  \"steps\": [\n    {\n      \"context\": \"{{NAME}}, olha isso. O brometo primário que a gente separou não tá reagindo no ritmo esperado com o iodeto. Parece travado. Se for SN2, devia estar indo rápido. Será que estamos escolhendo o mecanismo errado?\",\n      \"options\": [\n        {\n          \"feedback\": \"Correto. Substrato primário geralmente segue SN2, então faz sentido avaliar o nucleófilo e o solvente para confirmar.\",\n          \"isCorrect\": true,\n          \"text\": \"Checar se as condições favorecem SN2\"\n        },\n        {\n          \"feedback\": \"SN1 não é comum para substratos primários, então essa revisão não ajudaria muito agora.\",\n          \"isCorrect\": false,\n          \"text\": \"Rever SN1 como hipótese principal\"\n        },\n        {\n          \"feedback\": \"Ignorar o mecanismo atrapalha a análise e piora a previsão da reação.\",\n          \"isCorrect\": false,\n          \"text\": \"Seguir sem analisar o mecanismo\"\n        },\n        {\n          \"feedback\": \"Trocar o reagente sem entender o problema pode gerar mais falhas.\",\n          \"isCorrect\": false,\n          \"text\": \"Mudar o nucleófilo às cegas\"\n        }\n      ],\n      \"question\": \"Como seguimos?\"\n    },\n    {\n      \"context\": \"Então, {{NAME}}, conferi o solvente: tá polar prótico. Isso pode estar atrapalhando o ataque do iodeto. SN2 fica mais lenta assim. Você quer ajustar algo antes de rodar de novo?\",\n      \"options\": [\n        {\n          \"feedback\": \"Correto. Solvente polar aprótico favorece SN2 ao estabilizar o cátion sem aprisionar o nucleófilo.\",\n          \"isCorrect\": true,\n          \"text\": \"Trocar para solvente polar aprótico\"\n        },\n        {\n          \"feedback\": \"Aumentar temperatura pode acelerar, mas não resolve o mecanismo desfavorável.\",\n          \"isCorrect\": false,\n          \"text\": \"Só aumentar a temperatura\"\n        },\n        {\n          \"feedback\": \"Adicionar mais nucleófilo ajuda pouco com solvente inadequado.\",\n          \"isCorrect\": false,\n          \"text\": \"Adicionar mais nucleófilo\"\n        },\n        {\n          \"feedback\": \"Grupos de saída não são o problema aqui: brometo já é bom.\",\n          \"isCorrect\": false,\n          \"text\": \"Trocar o grupo de saída\"\n        }\n      ],\n      \"question\": \"O que ajustamos?\"\n    },\n    {\n      \"context\": \"Perfeito, {{NAME}}. Mas o rendimento continua baixo. Parece que o iodeto tá meio fraco. Você acha que vale reforçar a força nucleofílica?\",\n      \"options\": [\n        {\n          \"feedback\": \"Nucleófilos mais fortes aceleram SN2, ideal para substratos primários.\",\n          \"isCorrect\": true,\n          \"text\": \"Usar um nucleófilo mais forte\"\n        },\n        {\n          \"feedback\": \"Catalisador não resolve um ataque nucleofílico fraco.\",\n          \"isCorrect\": false,\n          \"text\": \"Adicionar catalisador genérico\"\n        },\n        {\n          \"feedback\": \"Isso poderia mudar totalmente o caminho reacional, sem necessidade.\",\n          \"isCorrect\": false,\n          \"text\": \"Mudar o substrato\"\n        },\n        {\n          \"feedback\": \"Diminuir concentração enfraquece ainda mais o ataque.\",\n          \"isCorrect\": false,\n          \"text\": \"Diluir a mistura\"\n        }\n      ],\n      \"question\": \"Como melhorar a reatividade?\"\n    },\n    {\n      \"context\": \"Agora sim melhorou. Só que estou vendo uma inversão clara da configuração no produto. Isso confirma o mecanismo, certo, {{NAME}}?\",\n      \"options\": [\n        {\n          \"feedback\": \"Correto. Inversão estereoquímica é assinatura clássica de SN2.\",\n          \"isCorrect\": true,\n          \"text\": \"Sim, inversão indica SN2\"\n        },\n        {\n          \"feedback\": \"SN1 tende a dar mistura racêmica, não inversão definida.\",\n          \"isCorrect\": false,\n          \"text\": \"Não, isso indica SN1\"\n        },\n        {\n          \"feedback\": \"Não faz sentido ignorar estereoquímica aqui.\",\n          \"isCorrect\": false,\n          \"text\": \"Não importa para o mecanismo\"\n        },\n        {\n          \"feedback\": \"Carbocátion não explica inversão; seria planar.\",\n          \"isCorrect\": false,\n          \"text\": \"Carbocátion intermediário explica isso\"\n        }\n      ],\n      \"question\": \"O que isso indica?\"\n    },\n    {\n      \"context\": \"Legal. Mas agora um problema: o outro substrato que precisamos reagir é terciário. Se tentarmos SN2, vai travar completamente. Qual caminho você acha mais lógico seguir nisso?\",\n      \"options\": [\n        {\n          \"feedback\": \"Correto. Substratos terciários favorecem SN1, já que impedem ataque por trás.\",\n          \"isCorrect\": true,\n          \"text\": \"Avaliar SN1 como opção\"\n        },\n        {\n          \"feedback\": \"SN2 é praticamente impossível em terciários.\",\n          \"isCorrect\": false,\n          \"text\": \"Forçar SN2 mesmo assim\"\n        },\n        {\n          \"feedback\": \"Eliminar o nucleófilo não ajuda na substituição.\",\n          \"isCorrect\": false,\n          \"text\": \"Usar solvente polar aprótico e só\"\n        },\n        {\n          \"feedback\": \"Trocar para grupo de saída pior atrapalha tudo.\",\n          \"isCorrect\": false,\n          \"text\": \"Piorar o grupo de saída\"\n        }\n      ],\n      \"question\": \"Qual mecanismo usar?\"\n    },\n    {\n      \"context\": \"{{NAME}}, dei uma olhada no intermediário: o carbocátion até forma, mas tem rearranjo acontecendo. Isso bagunça os produtos. Não vi isso chegando. Como você quer lidar com esse imprevisto?\",\n      \"options\": [\n        {\n          \"feedback\": \"Correto. Evitar formação de carbocátion elimina rearranjos, redirecionando para SN2 com mudanças estruturais.\",\n          \"isCorrect\": true,\n          \"text\": \"Modificar o substrato para evitar carbocátion\"\n        },\n        {\n          \"feedback\": \"Aceitar rearranjo gera mistura difícil de purificar.\",\n          \"isCorrect\": false,\n          \"text\": \"Aceitar o rearranjo e seguir\"\n        },\n        {\n          \"feedback\": \"Mudar apenas o nucleófilo não evita rearranjo.\",\n          \"isCorrect\": false,\n          \"text\": \"Trocar nucleófilo\"\n        },\n        {\n          \"feedback\": \"Aumentar temperatura piora rearranjos.\",\n          \"isCorrect\": false,\n          \"text\": \"Aumentar temperatura\"\n        }\n      ],\n      \"question\": \"Como lidar com o rearranjo?\"\n    },\n    {\n      \"context\": \"Ótimo ajuste, {{NAME}}. Com o novo substrato, nada de rearranjo. Agora só falta escolher o melhor grupo de saída para garantir eficiência. O que você sugere?\",\n      \"options\": [\n        {\n          \"feedback\": \"Perfeito. Tosilato é excelente grupo de saída e otimiza a reação.\",\n          \"isCorrect\": true,\n          \"text\": \"Usar tosilato como grupo de saída\"\n        },\n        {\n          \"feedback\": \"Hidróxido é péssimo grupo de saída, reação travaria.\",\n          \"isCorrect\": false,\n          \"text\": \"Usar OH como grupo de saída\"\n        },\n        {\n          \"feedback\": \"Amina é base forte e péssima saída.\",\n          \"isCorrect\": false,\n          \"text\": \"Usar amina como saída\"\n        },\n        {\n          \"feedback\": \"Fluoreto raramente sai bem, rendimento cai.\",\n          \"isCorrect\": false,\n          \"text\": \"Usar fluoreto\"\n        }\n      ],\n      \"question\": \"Qual grupo de saída escolhemos?\"\n    },\n    {\n      \"context\": \"Fechou, {{NAME}}. Com o tosilato e as condições ajustadas, a substituição roda limpa e previsível. Agora tudo bate com o mecanismo ideal. Quer validar algo antes de fechar o experimento?\",\n      \"options\": [\n        {\n          \"feedback\": \"Correto. Verificar estereoquímica assegura que o mecanismo ocorreu conforme previsto.\",\n          \"isCorrect\": true,\n          \"text\": \"Confirmar estereoquímica final\"\n        },\n        {\n          \"feedback\": \"Concentração já está otimizada.\",\n          \"isCorrect\": false,\n          \"text\": \"Mexer só na concentração\"\n        },\n        {\n          \"feedback\": \"Grupo de saída já foi o ideal.\",\n          \"isCorrect\": false,\n          \"text\": \"Trocar grupo de saída de novo\"\n        },\n        {\n          \"feedback\": \"SN1 não é esperado neste cenário.\",\n          \"isCorrect\": false,\n          \"text\": \"Testar SN1 agora\"\n        }\n      ],\n      \"question\": \"Último passo?\"\n    }\n  ]\n}",
      "outputTokens": 1539,
      "systemPrompt": "# Role\n\nYou are an expert interactive story designer creating a **Story** activity for a learning app. Your mission is to place learners in a first-person dialogue scenario where they work alongside a colleague to solve a real-world problem using the lesson's concepts.\n\nYou specialize in crafting immersive, dialogue-driven experiences that make learners feel like they're actually solving problems in their field — not just answering quiz questions.\n\n# The Art of Dialogue-Driven Learning\n\nA great Story activity doesn't lecture or test recall — it puts learners IN the situation. Think of it like an interactive movie where the learner IS the main character, making real decisions that matter.\n\n## Why Dialogue Scenarios Work\n\n1. **Authentic Context**: When learners apply concepts to solve realistic problems with a colleague, they see WHY the knowledge matters to them personally.\n\n2. **Active Reasoning**: Making decisions in context requires thinking through principles, not just recognizing memorized facts.\n\n3. **Emotional Investment**: Dialogue creates stakes. The learner cares about the outcome because they're part of the story.\n\n## The Collaborative Problem-Solving Principle\n\nEvery great Story activity creates a sense of partnership:\n\n- **Shared Goal**: You and your colleague are tackling something together\n- **Natural Dialogue**: Conversations feel like real workplace exchanges\n- **Meaningful Choices**: Each decision requires applying what you've learned\n- **Satisfying Resolution**: The problem gets solved and the takeaway sticks\n\n## Why Pure Dialogue Works\n\nEach scene should feel like you're eavesdropping on a real conversation — no narrator, no stage directions, just two people working through a problem. Pure dialogue:\n\n- Immerses learners completely in the scenario\n- Makes abstract concepts feel like lived experience\n- Creates natural pacing through back-and-forth exchange\n- Lets context emerge organically from what people say\n\n# Inputs\n\n- `LESSON_TITLE`: The topic to create a story around\n- `LESSON_DESCRIPTION`: Additional context about what this lesson covers\n- `CHAPTER_TITLE`: The chapter context (for understanding scope)\n- `COURSE_TITLE`: The course context (for understanding audience level)\n- `LANGUAGE`: Output language\n- `EXPLANATION_STEPS`: Array of {title, text} from all explanation activities (Background, Explanation, Mechanics, Examples) the learner completed before this one\n\n## Language Guidelines\n\n- `en`: Use US English unless the content is region-specific\n- `pt`: Use Brazilian Portuguese unless the content is region-specific\n- `es`: Use Latin American Spanish unless the content is region-specific\n\n# Requirements\n\n## Scene Structure\n\nEach scene must have:\n\n- **context**: Maximum 500 characters. Pure dialogue only — no narrator, no character name prefixes (like \"Sarah:\"), no descriptions. This is what your colleague says to you, setting up the decision point.\n- **question**: Maximum 100 characters. A short, clear question about what to do next.\n- **options**: Exactly 4 choices, each with:\n  - **text**: The answer choice (max 50 characters)\n  - **isCorrect**: Boolean indicating if this is the correct answer (exactly 1 must be true)\n  - **feedback**: Why this choice is right (with insight) or wrong (and what would be correct) — max 300 characters\n\n## Story Arc\n\nYour story must follow this structure:\n\n1. **Opening Scene**: Begin \"in the middle of the action\" — the learner and colleague are already working on something. No preamble or setup exposition.\n2. **Rising Complexity**: Each scene builds naturally from the previous dialogue. Decisions compound.\n3. **Plot Twist**: The second-to-last scene introduces an unexpected complication, surprise, or revelation.\n4. **Resolution**: The final scene resolves the problem AND reinforces the main learning takeaway.\n\n## Scene Count\n\n- Minimum: 7 scenes\n- Maximum: 20 scenes\n- Let the problem's complexity dictate the length. A simple concept might need 7-10 scenes; a complex one might need 15-20.\n\n## Tone & Style\n\n- **Pure dialogue**: NO narrator, NO character name prefixes, NO descriptions of actions or settings\n- **Natural conversation**: Write how colleagues actually talk on Slack when solving a problem together — casual, collaborative, sometimes humorous\n- **Professional but warm**: Light, smart humor when appropriate. Never forced or cheesy.\n- **Second-person immersion**: The colleague speaks TO the learner. Context emerges from what's said.\n- **Continuous flow**: Each scene's dialogue should naturally lead into the next\n\n## The {{NAME}} Placeholder\n\nUse `{{NAME}}` wherever the learner's name should appear in dialogue. For example:\n\n- \"{{NAME}}, I think we might have a problem here.\"\n- \"Good catch, {{NAME}}. That's exactly what I was thinking.\"\n\nThis personalizes the experience without requiring actual name input at content creation time.\n\n## Decision Design\n\nEvery decision must:\n\n- **Require reasoning**: Learners must apply principles from the lesson, not recall specific phrases\n- **Feel realistic**: These are choices someone might actually face in this situation\n- **Have plausible distractors**: Wrong options should be tempting but flawed for specific reasons\n- **Avoid \"obvious\" correct answers**: The right choice should require thought, not be the only non-silly option\n\n## What to Avoid\n\n- Narrator text (\"Meanwhile...\" or \"You walk into the office...\")\n- Character name prefixes (\"Sarah:\" or \"Your colleague says:\")\n- Description of actions or settings (except through dialogue itself)\n- Questions that test memorization of facts from earlier activities\n- Obvious \"correct\" answers that don't require applying the concept\n- Silly or clearly wrong distractors that no reasonable person would choose\n- Breaking the fourth wall or meta-commentary\n- Starting with \"In this activity...\" or setup exposition\n\n## Scope\n\n- **Stay focused**: The problem should specifically require THIS lesson's concept to solve\n- **Don't expand**: Other lessons cover related topics — this story tests this lesson\n- **Don't narrow**: If the lesson is broad, the problem should engage multiple aspects of it\n\n## Relationship to Previous Activities\n\nThe learner has already completed:\n\n- **Background**: WHY this exists (origin story, problems solved, historical context)\n- **Explanation**: WHAT it is (core concepts, components, definitions)\n- **Mechanics**: HOW it works (processes in action, cause-effect chains)\n- **Examples**: WHERE it appears (real-world contexts, applications)\n\nYour Story activity answers WHEN DO I USE THIS? (applying concepts to solve realistic problems). These complement each other:\n\n- Background: \"WHY did we need this?\"\n- Explanation: \"WHAT exactly is it?\"\n- Mechanics: \"HOW does it actually work?\"\n- Examples: \"WHERE will I encounter this?\"\n- Story: \"WHEN do I apply this to solve real problems?\"\n\nThe learner knows what the concept IS, how it WORKS, and where they'll SEE it. Now they practice USING it in a realistic scenario.\n\n# Structure Guide\n\nWhile every story is unique, most follow this arc (adapt as needed):\n\n1. **The Hook**: Jump straight into the situation. Something needs to be figured out or decided.\n2. **Initial Assessment**: What's the situation? What do we know? First decisions.\n3. **Deepening Complexity**: The problem has layers. Apply the concept more deeply.\n4. **Complications**: Things aren't as simple as they seemed. Adapt your approach.\n5. **The Twist**: A surprise, revelation, or unexpected turn that requires rethinking.\n6. **The Resolution**: Solve the problem AND crystallize the key insight from the lesson.\n\nNote: Sometimes the final twist can have a humorous or unexpected resolution that still reinforces the learning. Something that makes the learner smile and think \"I didn't see that coming!\"\n\n# Dialogue Tone Examples\n\nThe following examples show the **tone and style** to aim for — not complete scenes, just the kind of dialogue that makes stories feel alive. Adapt freely to your topic.\n\n## Opening Hooks (Jump Into the Action)\n\n> \"{{NAME}}, I've been staring at this bug for an hour. The shopping cart total keeps showing yesterday's prices. The database is fine. Something's wrong with how we're storing them.\"\n\n> \"Okay, {{NAME}}, the client just called. Their entire inventory system crashed right before Black Friday. They're panicking. We need to figure this out fast.\"\n\n> \"{{NAME}}, you're not going to believe this. Remember that algorithm we deployed last week? It's been recommending the exact opposite of what users want. Sales are tanking.\"\n\n## Building Tension (Problems Get Deeper)\n\n> \"Wait. If this pattern is everywhere in the codebase... inventory counts, user roles, discount percentages... we might have a much bigger problem than I thought.\"\n\n> \"Hold on. The logs show someone accessed the admin panel at 3 AM last night. But nobody on the team was working then. {{NAME}}, who else has those credentials?\"\n\n> \"The numbers don't add up. We're showing 500 successful transactions, but the bank only received 487. Where did the other 13 go?\"\n\n## Plot Twists (The Unexpected Turn)\n\n> \"{{NAME}}... I just ran the analysis twice. The bug isn't in our code. It's been in the library we've trusted for three years. Every project using it has this vulnerability.\"\n\n> \"I found the source of the data leak. {{NAME}}, it's not a hacker. It's our own caching system. We've been accidentally exposing user data to anyone who knew where to look.\"\n\n> \"Plot twist: the 'broken' feature? It's working exactly as designed. The original spec was just... completely wrong. We've been solving the wrong problem this whole time.\"\n\n## Humorous Moments (Light Relief)\n\n> \"Well, {{NAME}}, the good news is we found the bug. The bad news? It's been there since 2019. The worse news? I wrote it. The even worse news? So did you. We pair-programmed this disaster together.\"\n\n> \"Congratulations, {{NAME}}. We just spent four hours debugging what turned out to be a typo. 'userID' vs 'userId'. Camel case strikes again.\"\n\n> \"{{NAME}}, remember when I said 'this should be a quick fix'? That was three coffees and one existential crisis ago.\"\n\n## Satisfying Resolutions (Problem Solved + Insight Crystallized)\n\n> \"There it is. The fix works. {{NAME}}, I don't think I'll ever forget this — always check if your data source can change while you're holding onto a copy of it.\"\n\n> \"We did it. The system's stable. You know what the real lesson here was? Sometimes the simplest explanation IS the right one. We kept looking for complex bugs when the answer was right in front of us.\"\n\n> \"That's it — problem solved, client happy, crisis averted. {{NAME}}, I think we just learned more about distributed systems in the last hour than in any textbook.\"\n\n## Unexpected/Funny Endings\n\n> \"So after all that debugging... it was a timezone issue. Every single time. I'm starting to think all bugs are secretly timezone issues in disguise.\"\n\n> \"{{NAME}}, the CEO just called to thank us. Apparently fixing that 'minor bug' saved them $2 million. I think we need to renegotiate our rates.\"\n\n> \"The system's fixed. Also, I may have accidentally discovered that our competitor's product has the exact same bug. Should we... tell them? Actually, don't answer that.\"\n\nRemember: These are just **tone examples**. Your story should be original, fit the lesson topic, and create its own memorable journey. Mix problem-solving tension with moments of humor or surprise. The best stories make learners think \"I didn't see that coming!\" while still teaching the concept.\n\n# Quality Checks\n\nBefore finalizing, verify:\n\n- [ ] Is the dialogue pure conversation with NO narrator, NO character prefixes, NO descriptions?\n- [ ] Does every scene flow naturally from the previous one (continuous story)?\n- [ ] Do all decisions require applying lesson concepts, not just recalling facts?\n- [ ] Is there a genuine plot twist in the second-to-last scene?\n- [ ] Does the resolution both solve the problem AND reinforce the main learning?\n- [ ] Is `{{NAME}}` used appropriately to personalize the dialogue?\n- [ ] Are all distractors plausible (not obviously silly)?\n- [ ] Does the story feel like a real workplace conversation, not a quiz in disguise?\n- [ ] Is the scope exactly the lesson topic — not broader or narrower?\n- [ ] Are all constraints met (context ≤500 chars, question ≤100 chars, options ≤50 chars each, feedback ≤300 chars each)?\n- [ ] Is the scene count between 7 and 20?\n\n# Output Format\n\nReturn an array of scenes, each with:\n\n- **context**: Pure dialogue from colleague (max 500 chars)\n- **question**: Decision prompt (max 100 chars)\n- **options**: Array of exactly 4 objects, each with:\n  - **text**: The answer choice (max 50 chars)\n  - **isCorrect**: Boolean (exactly 1 must be true, 3 must be false)\n  - **feedback**: Why right or wrong (max 300 chars)\n\nUse 7-20 scenes to tell a complete, engaging story. Let the problem's complexity dictate the length.\n",
      "testCaseId": "pt-chemistry-organic-reactions-1",
      "userPrompt": "LESSON_TITLE: Mecanismos de Substituicao\nLESSON_DESCRIPTION: Aplicando mecanismos de reacao organica para prever e otimizar sinteses quimicas\nCHAPTER_TITLE: Reacoes Organicas\nCOURSE_TITLE: Quimica Organica II\nLANGUAGE: pt\nEXPLANATION_STEPS:\n1. Nucleofilos e Eletrofilos: Nucleofilos sao especies ricas em eletrons que doam pares de eletrons. Eletrofilos sao especies pobres em eletrons que aceitam. Reacoes organicas sao geralmente nucleofilos atacando eletrofilos.\n2. Mecanismo SN2: SN2 e um mecanismo concertado — o nucleofilo ataca enquanto o grupo de saida sai, em um unico passo. Funciona melhor com substratos primarios e nucleofilos fortes.\n3. Mecanismo SN1: SN1 ocorre em dois passos: primeiro o grupo de saida sai formando um carbocation, depois o nucleofilo ataca. Favorecido por substratos terciarios e solventes polares proticos.\n4. Estereoquimica: A estereoquimica revela o mecanismo. SN2 inverte a configuracao (ataque por tras). SN1 pode dar mistura racemicacon (carbocation planar atacado de ambos os lados).\n5. Grupos de Saida: Grupos de saida precisam ser estaveis apos sair. Bons grupos de saida sao bases fracas — haletos, tosilatos, agua protonada. Grupos de saida ruins sao bases fortes."
    },
    {
      "duration": 28150.331999999995,
      "inputTokens": 3183,
      "output": "{\n  \"steps\": [\n    {\n      \"context\": \"{{NAME}}, mira esto. El modelo para clasificar defectos en las imágenes de producción sigue sobreajustando. Ya probé aumentar epochs y nada. ¿Qué ajustamos en la arquitectura antes de perder más tiempo?\",\n      \"options\": [\n        {\n          \"feedback\": \"Correcto: añadir dropout combate el sobreajuste al forzar que la red no dependa de neuronas específicas.\",\n          \"isCorrect\": true,\n          \"text\": \"Añadimos dropout en las capas densas\"\n        },\n        {\n          \"feedback\": \"Más filtros aumentan capacidad, pero el modelo ya sobreajusta. Empeoraría.\",\n          \"isCorrect\": false,\n          \"text\": \"Duplicamos los filtros en cada capa\"\n        },\n        {\n          \"feedback\": \"Quitar activaciones no soluciona sobreajuste; rompe la no-linealidad.\",\n          \"isCorrect\": false,\n          \"text\": \"Quitamos las activaciones ReLU\"\n        },\n        {\n          \"feedback\": \"Aumentar resolución incrementa complejidad sin atacar el sobreajuste.\",\n          \"isCorrect\": false,\n          \"text\": \"Entrenamos con imágenes más grandes\"\n        }\n      ],\n      \"question\": \"¿Qué probamos primero?\"\n    },\n    {\n      \"context\": \"Ok, metí dropout y bajó el sobreajuste, pero ahora el entrenamiento es inestable. Las curvas brincan como locas. ¿Qué hacemos para estabilizar sin perder lo avanzado?\",\n      \"options\": [\n        {\n          \"feedback\": \"Correcto: batch norm estabiliza distribuciones internas y suaviza el entrenamiento.\",\n          \"isCorrect\": true,\n          \"text\": \"Agregar batch normalization\"\n        },\n        {\n          \"feedback\": \"Menos capas reduce capacidad, no estabilidad.\",\n          \"isCorrect\": false,\n          \"text\": \"Eliminar una capa completa\"\n        },\n        {\n          \"feedback\": \"Subir la tasa de aprendizaje aumenta inestabilidad.\",\n          \"isCorrect\": false,\n          \"text\": \"Aumentar el learning rate\"\n        },\n        {\n          \"feedback\": \"Cambiar a activación lineal elimina expresividad.\",\n          \"isCorrect\": false,\n          \"text\": \"Usar activaciones lineales\"\n        }\n      ],\n      \"question\": \"¿Qué ajuste hacemos?\"\n    },\n    {\n      \"context\": \"Listo, mucho más estable. Pero aún tardamos demasiado en entrenar. Cada epoch se siente eterno. ¿Qué simplificamos sin perder precisión en visión?\",\n      \"options\": [\n        {\n          \"feedback\": \"Correcto: el pooling reduce resolución y acelera cómputo manteniendo rasgos útiles.\",\n          \"isCorrect\": true,\n          \"text\": \"Agregar pooling después de cada bloque conv\"\n        },\n        {\n          \"feedback\": \"Más filtros aumentan cómputo.\",\n          \"isCorrect\": false,\n          \"text\": \"Aumentar filtros en capas tempranas\"\n        },\n        {\n          \"feedback\": \"Más densas incrementan parámetros.\",\n          \"isCorrect\": false,\n          \"text\": \"Agregar otra capa densa\"\n        },\n        {\n          \"feedback\": \"Bajar el batch size ralentiza el entrenamiento.\",\n          \"isCorrect\": false,\n          \"text\": \"Usar batch size más pequeño\"\n        }\n      ],\n      \"question\": \"¿Qué simplifica el modelo?\"\n    },\n    {\n      \"context\": \"Esto va mejor. Pero aún no llegamos a la precisión objetivo. El dataset es pequeño y las imágenes varían mucho. ¿Aprovechamos algo ya entrenado?\",\n      \"options\": [\n        {\n          \"feedback\": \"Correcto: transfer learning usa características ya aprendidas y mejora con poco dato.\",\n          \"isCorrect\": true,\n          \"text\": \"Usar un modelo preentrenado y ajustar capas finales\"\n        },\n        {\n          \"feedback\": \"Duplicar dataset de forma artificial puede ayudar, pero no tanto como TL.\",\n          \"isCorrect\": false,\n          \"text\": \"Simplemente duplicar el dataset\"\n        },\n        {\n          \"feedback\": \"Congelar todas las capas evita adaptar la tarea específica.\",\n          \"isCorrect\": false,\n          \"text\": \"Congelar absolutamente todas las capas\"\n        },\n        {\n          \"feedback\": \"Entrenar desde cero ignora el poder del preentrenamiento.\",\n          \"isCorrect\": false,\n          \"text\": \"Entrenar todo desde cero\"\n        }\n      ],\n      \"question\": \"¿Qué estrategia usamos?\"\n    },\n    {\n      \"context\": \"{{NAME}}, buen movimiento. Pero ahora aparece un comportamiento raro: la red clasifica casi todo como la clase mayoritaria. Parece que las capas finales no están capturando bien detalles. ¿Qué podemos hacer dentro de la arquitectura?\",\n      \"options\": [\n        {\n          \"feedback\": \"Correcto: agregar una capa conv final pequeña puede refinar patrones locales previos al clasificador.\",\n          \"isCorrect\": true,\n          \"text\": \"Agregar una conv adicional antes de la capa densa\"\n        },\n        {\n          \"feedback\": \"Más dropout podría reducir aún más la señal útil.\",\n          \"isCorrect\": false,\n          \"text\": \"Aumentar dropout al doble\"\n        },\n        {\n          \"feedback\": \"Quitar pooling empeora eficiencia y no corrige sesgo.\",\n          \"isCorrect\": false,\n          \"text\": \"Eliminar todo pooling ya añadido\"\n        },\n        {\n          \"feedback\": \"Bajar filtros quita capacidad cuando la necesitamos.\",\n          \"isCorrect\": false,\n          \"text\": \"Reducir los filtros en capas profundas\"\n        }\n      ],\n      \"question\": \"¿Cómo afinamos la arquitectura?\"\n    },\n    {\n      \"context\": \"Genial, eso ayudó. Pero acaba de llegar un giro inesperado: producción cambió el tipo de cámara y ahora las imágenes tienen ruido distinto y una iluminación más fría. El modelo baja 12% de precisión de golpe. ¿Qué ajustamos sin rediseñar todo?\",\n      \"options\": [\n        {\n          \"feedback\": \"Correcto: ajustar capas iniciales del transfer learning permite adaptarse a nuevos patrones de entrada.\",\n          \"isCorrect\": true,\n          \"text\": \"Descongelar algunas capas iniciales del modelo base\"\n        },\n        {\n          \"feedback\": \"Usar activaciones lineales reduciría capacidad.\",\n          \"isCorrect\": false,\n          \"text\": \"Cambiar todas las activaciones a lineales\"\n        },\n        {\n          \"feedback\": \"Quitar batch norm desestabiliza de nuevo.\",\n          \"isCorrect\": false,\n          \"text\": \"Eliminar batch normalization\"\n        },\n        {\n          \"feedback\": \"Reducir filtros limita la adaptación.\",\n          \"isCorrect\": false,\n          \"text\": \"Reducir la cantidad de filtros iniciales\"\n        }\n      ],\n      \"question\": \"¿Qué movemos ahora?\"\n    },\n    {\n      \"context\": \"Perfecto, ya se adaptó mejor. Último paso: queremos aumentar robustez sin alargar demasiado el entrenamiento. ¿Qué podríamos afinar para balancear estabilidad, capacidad y generalización?\",\n      \"options\": [\n        {\n          \"feedback\": \"Correcto: ajustar el dropout a un valor moderado mejora generalización sin frenar mucho el entrenamiento.\",\n          \"isCorrect\": true,\n          \"text\": \"Ajustar dropout a un nivel moderado\"\n        },\n        {\n          \"feedback\": \"Capas densas extras suben parámetros y riesgo de sobreajuste.\",\n          \"isCorrect\": false,\n          \"text\": \"Agregar otra capa densa grande\"\n        },\n        {\n          \"feedback\": \"Quitar pooling reduce eficiencia y aumenta ruido.\",\n          \"isCorrect\": false,\n          \"text\": \"Eliminar el pooling usado\"\n        },\n        {\n          \"feedback\": \"Congelar todo quita adaptabilidad y baja precisión.\",\n          \"isCorrect\": false,\n          \"text\": \"Congelar todo el modelo ahora\"\n        }\n      ],\n      \"question\": \"¿Qué ajuste final hacemos?\"\n    },\n    {\n      \"context\": \"{{NAME}}, quedó sólido. Ahora el modelo generaliza, entrena estable y responde a cambios de entrada. Buen recordatorio: una arquitectura bien diseñada es equilibrio entre capacidad, regularización y adaptación. Nada de soluciones mágicas, puro diseño cuidadoso.\",\n      \"options\": [\n        {\n          \"feedback\": \"Correcto: refleja la importancia del balance en la arquitectura.\",\n          \"isCorrect\": true,\n          \"text\": \"Sí, el equilibrio fue la clave final\"\n        },\n        {\n          \"feedback\": \"Optimización de hyperparams no reemplaza arquitectura.\",\n          \"isCorrect\": false,\n          \"text\": \"Hubiera bastado con más tuning de hiperparámetros\"\n        },\n        {\n          \"feedback\": \"Agregar capas sin propósito no mejora diseño.\",\n          \"isCorrect\": false,\n          \"text\": \"La próxima metamos muchas más capas\"\n        },\n        {\n          \"feedback\": \"La complejidad no es siempre mejor.\",\n          \"isCorrect\": false,\n          \"text\": \"La clave fue hacer todo más complejo\"\n        }\n      ],\n      \"question\": \"¿Conclusión final?\"\n    }\n  ]\n}",
      "outputTokens": 1589,
      "systemPrompt": "# Role\n\nYou are an expert interactive story designer creating a **Story** activity for a learning app. Your mission is to place learners in a first-person dialogue scenario where they work alongside a colleague to solve a real-world problem using the lesson's concepts.\n\nYou specialize in crafting immersive, dialogue-driven experiences that make learners feel like they're actually solving problems in their field — not just answering quiz questions.\n\n# The Art of Dialogue-Driven Learning\n\nA great Story activity doesn't lecture or test recall — it puts learners IN the situation. Think of it like an interactive movie where the learner IS the main character, making real decisions that matter.\n\n## Why Dialogue Scenarios Work\n\n1. **Authentic Context**: When learners apply concepts to solve realistic problems with a colleague, they see WHY the knowledge matters to them personally.\n\n2. **Active Reasoning**: Making decisions in context requires thinking through principles, not just recognizing memorized facts.\n\n3. **Emotional Investment**: Dialogue creates stakes. The learner cares about the outcome because they're part of the story.\n\n## The Collaborative Problem-Solving Principle\n\nEvery great Story activity creates a sense of partnership:\n\n- **Shared Goal**: You and your colleague are tackling something together\n- **Natural Dialogue**: Conversations feel like real workplace exchanges\n- **Meaningful Choices**: Each decision requires applying what you've learned\n- **Satisfying Resolution**: The problem gets solved and the takeaway sticks\n\n## Why Pure Dialogue Works\n\nEach scene should feel like you're eavesdropping on a real conversation — no narrator, no stage directions, just two people working through a problem. Pure dialogue:\n\n- Immerses learners completely in the scenario\n- Makes abstract concepts feel like lived experience\n- Creates natural pacing through back-and-forth exchange\n- Lets context emerge organically from what people say\n\n# Inputs\n\n- `LESSON_TITLE`: The topic to create a story around\n- `LESSON_DESCRIPTION`: Additional context about what this lesson covers\n- `CHAPTER_TITLE`: The chapter context (for understanding scope)\n- `COURSE_TITLE`: The course context (for understanding audience level)\n- `LANGUAGE`: Output language\n- `EXPLANATION_STEPS`: Array of {title, text} from all explanation activities (Background, Explanation, Mechanics, Examples) the learner completed before this one\n\n## Language Guidelines\n\n- `en`: Use US English unless the content is region-specific\n- `pt`: Use Brazilian Portuguese unless the content is region-specific\n- `es`: Use Latin American Spanish unless the content is region-specific\n\n# Requirements\n\n## Scene Structure\n\nEach scene must have:\n\n- **context**: Maximum 500 characters. Pure dialogue only — no narrator, no character name prefixes (like \"Sarah:\"), no descriptions. This is what your colleague says to you, setting up the decision point.\n- **question**: Maximum 100 characters. A short, clear question about what to do next.\n- **options**: Exactly 4 choices, each with:\n  - **text**: The answer choice (max 50 characters)\n  - **isCorrect**: Boolean indicating if this is the correct answer (exactly 1 must be true)\n  - **feedback**: Why this choice is right (with insight) or wrong (and what would be correct) — max 300 characters\n\n## Story Arc\n\nYour story must follow this structure:\n\n1. **Opening Scene**: Begin \"in the middle of the action\" — the learner and colleague are already working on something. No preamble or setup exposition.\n2. **Rising Complexity**: Each scene builds naturally from the previous dialogue. Decisions compound.\n3. **Plot Twist**: The second-to-last scene introduces an unexpected complication, surprise, or revelation.\n4. **Resolution**: The final scene resolves the problem AND reinforces the main learning takeaway.\n\n## Scene Count\n\n- Minimum: 7 scenes\n- Maximum: 20 scenes\n- Let the problem's complexity dictate the length. A simple concept might need 7-10 scenes; a complex one might need 15-20.\n\n## Tone & Style\n\n- **Pure dialogue**: NO narrator, NO character name prefixes, NO descriptions of actions or settings\n- **Natural conversation**: Write how colleagues actually talk on Slack when solving a problem together — casual, collaborative, sometimes humorous\n- **Professional but warm**: Light, smart humor when appropriate. Never forced or cheesy.\n- **Second-person immersion**: The colleague speaks TO the learner. Context emerges from what's said.\n- **Continuous flow**: Each scene's dialogue should naturally lead into the next\n\n## The {{NAME}} Placeholder\n\nUse `{{NAME}}` wherever the learner's name should appear in dialogue. For example:\n\n- \"{{NAME}}, I think we might have a problem here.\"\n- \"Good catch, {{NAME}}. That's exactly what I was thinking.\"\n\nThis personalizes the experience without requiring actual name input at content creation time.\n\n## Decision Design\n\nEvery decision must:\n\n- **Require reasoning**: Learners must apply principles from the lesson, not recall specific phrases\n- **Feel realistic**: These are choices someone might actually face in this situation\n- **Have plausible distractors**: Wrong options should be tempting but flawed for specific reasons\n- **Avoid \"obvious\" correct answers**: The right choice should require thought, not be the only non-silly option\n\n## What to Avoid\n\n- Narrator text (\"Meanwhile...\" or \"You walk into the office...\")\n- Character name prefixes (\"Sarah:\" or \"Your colleague says:\")\n- Description of actions or settings (except through dialogue itself)\n- Questions that test memorization of facts from earlier activities\n- Obvious \"correct\" answers that don't require applying the concept\n- Silly or clearly wrong distractors that no reasonable person would choose\n- Breaking the fourth wall or meta-commentary\n- Starting with \"In this activity...\" or setup exposition\n\n## Scope\n\n- **Stay focused**: The problem should specifically require THIS lesson's concept to solve\n- **Don't expand**: Other lessons cover related topics — this story tests this lesson\n- **Don't narrow**: If the lesson is broad, the problem should engage multiple aspects of it\n\n## Relationship to Previous Activities\n\nThe learner has already completed:\n\n- **Background**: WHY this exists (origin story, problems solved, historical context)\n- **Explanation**: WHAT it is (core concepts, components, definitions)\n- **Mechanics**: HOW it works (processes in action, cause-effect chains)\n- **Examples**: WHERE it appears (real-world contexts, applications)\n\nYour Story activity answers WHEN DO I USE THIS? (applying concepts to solve realistic problems). These complement each other:\n\n- Background: \"WHY did we need this?\"\n- Explanation: \"WHAT exactly is it?\"\n- Mechanics: \"HOW does it actually work?\"\n- Examples: \"WHERE will I encounter this?\"\n- Story: \"WHEN do I apply this to solve real problems?\"\n\nThe learner knows what the concept IS, how it WORKS, and where they'll SEE it. Now they practice USING it in a realistic scenario.\n\n# Structure Guide\n\nWhile every story is unique, most follow this arc (adapt as needed):\n\n1. **The Hook**: Jump straight into the situation. Something needs to be figured out or decided.\n2. **Initial Assessment**: What's the situation? What do we know? First decisions.\n3. **Deepening Complexity**: The problem has layers. Apply the concept more deeply.\n4. **Complications**: Things aren't as simple as they seemed. Adapt your approach.\n5. **The Twist**: A surprise, revelation, or unexpected turn that requires rethinking.\n6. **The Resolution**: Solve the problem AND crystallize the key insight from the lesson.\n\nNote: Sometimes the final twist can have a humorous or unexpected resolution that still reinforces the learning. Something that makes the learner smile and think \"I didn't see that coming!\"\n\n# Dialogue Tone Examples\n\nThe following examples show the **tone and style** to aim for — not complete scenes, just the kind of dialogue that makes stories feel alive. Adapt freely to your topic.\n\n## Opening Hooks (Jump Into the Action)\n\n> \"{{NAME}}, I've been staring at this bug for an hour. The shopping cart total keeps showing yesterday's prices. The database is fine. Something's wrong with how we're storing them.\"\n\n> \"Okay, {{NAME}}, the client just called. Their entire inventory system crashed right before Black Friday. They're panicking. We need to figure this out fast.\"\n\n> \"{{NAME}}, you're not going to believe this. Remember that algorithm we deployed last week? It's been recommending the exact opposite of what users want. Sales are tanking.\"\n\n## Building Tension (Problems Get Deeper)\n\n> \"Wait. If this pattern is everywhere in the codebase... inventory counts, user roles, discount percentages... we might have a much bigger problem than I thought.\"\n\n> \"Hold on. The logs show someone accessed the admin panel at 3 AM last night. But nobody on the team was working then. {{NAME}}, who else has those credentials?\"\n\n> \"The numbers don't add up. We're showing 500 successful transactions, but the bank only received 487. Where did the other 13 go?\"\n\n## Plot Twists (The Unexpected Turn)\n\n> \"{{NAME}}... I just ran the analysis twice. The bug isn't in our code. It's been in the library we've trusted for three years. Every project using it has this vulnerability.\"\n\n> \"I found the source of the data leak. {{NAME}}, it's not a hacker. It's our own caching system. We've been accidentally exposing user data to anyone who knew where to look.\"\n\n> \"Plot twist: the 'broken' feature? It's working exactly as designed. The original spec was just... completely wrong. We've been solving the wrong problem this whole time.\"\n\n## Humorous Moments (Light Relief)\n\n> \"Well, {{NAME}}, the good news is we found the bug. The bad news? It's been there since 2019. The worse news? I wrote it. The even worse news? So did you. We pair-programmed this disaster together.\"\n\n> \"Congratulations, {{NAME}}. We just spent four hours debugging what turned out to be a typo. 'userID' vs 'userId'. Camel case strikes again.\"\n\n> \"{{NAME}}, remember when I said 'this should be a quick fix'? That was three coffees and one existential crisis ago.\"\n\n## Satisfying Resolutions (Problem Solved + Insight Crystallized)\n\n> \"There it is. The fix works. {{NAME}}, I don't think I'll ever forget this — always check if your data source can change while you're holding onto a copy of it.\"\n\n> \"We did it. The system's stable. You know what the real lesson here was? Sometimes the simplest explanation IS the right one. We kept looking for complex bugs when the answer was right in front of us.\"\n\n> \"That's it — problem solved, client happy, crisis averted. {{NAME}}, I think we just learned more about distributed systems in the last hour than in any textbook.\"\n\n## Unexpected/Funny Endings\n\n> \"So after all that debugging... it was a timezone issue. Every single time. I'm starting to think all bugs are secretly timezone issues in disguise.\"\n\n> \"{{NAME}}, the CEO just called to thank us. Apparently fixing that 'minor bug' saved them $2 million. I think we need to renegotiate our rates.\"\n\n> \"The system's fixed. Also, I may have accidentally discovered that our competitor's product has the exact same bug. Should we... tell them? Actually, don't answer that.\"\n\nRemember: These are just **tone examples**. Your story should be original, fit the lesson topic, and create its own memorable journey. Mix problem-solving tension with moments of humor or surprise. The best stories make learners think \"I didn't see that coming!\" while still teaching the concept.\n\n# Quality Checks\n\nBefore finalizing, verify:\n\n- [ ] Is the dialogue pure conversation with NO narrator, NO character prefixes, NO descriptions?\n- [ ] Does every scene flow naturally from the previous one (continuous story)?\n- [ ] Do all decisions require applying lesson concepts, not just recalling facts?\n- [ ] Is there a genuine plot twist in the second-to-last scene?\n- [ ] Does the resolution both solve the problem AND reinforce the main learning?\n- [ ] Is `{{NAME}}` used appropriately to personalize the dialogue?\n- [ ] Are all distractors plausible (not obviously silly)?\n- [ ] Does the story feel like a real workplace conversation, not a quiz in disguise?\n- [ ] Is the scope exactly the lesson topic — not broader or narrower?\n- [ ] Are all constraints met (context ≤500 chars, question ≤100 chars, options ≤50 chars each, feedback ≤300 chars each)?\n- [ ] Is the scene count between 7 and 20?\n\n# Output Format\n\nReturn an array of scenes, each with:\n\n- **context**: Pure dialogue from colleague (max 500 chars)\n- **question**: Decision prompt (max 100 chars)\n- **options**: Array of exactly 4 objects, each with:\n  - **text**: The answer choice (max 50 chars)\n  - **isCorrect**: Boolean (exactly 1 must be true, 3 must be false)\n  - **feedback**: Why right or wrong (max 300 chars)\n\nUse 7-20 scenes to tell a complete, engaging story. Let the problem's complexity dictate the length.\n",
      "testCaseId": "es-cs-neural-network-architecture-1",
      "userPrompt": "LESSON_TITLE: Arquitecturas de Deep Learning\nLESSON_DESCRIPTION: Disenando y optimizando arquitecturas de redes neuronales para problemas reales\nCHAPTER_TITLE: Arquitecturas de Redes Neuronales\nCOURSE_TITLE: Deep Learning Aplicado\nLANGUAGE: es\nEXPLANATION_STEPS:\n1. Capas Convolucionales: Las capas convolucionales detectan patrones locales usando filtros que se deslizan sobre la entrada. El mismo filtro se aplica en todas partes, lo que reduce parametros y captura patrones sin importar su posicion.\n2. Pooling: El pooling reduce la dimension espacial tomando el maximo o promedio de regiones. Esto hace la representacion mas compacta y algo invariante a pequenas traslaciones.\n3. Activaciones: Las funciones de activacion introducen no-linealidad. ReLU (max(0,x)) es popular por ser simple y evitar el problema del gradiente desvaneciente en capas profundas.\n4. Dropout: El dropout desactiva neuronas aleatoriamente durante el entrenamiento. Esto fuerza redundancia y reduce el sobreajuste — la red no puede depender de ninguna neurona especifica.\n5. Transfer Learning: El transfer learning usa redes pre-entrenadas en grandes datasets. Las capas tempranas aprenden patrones generales; las tardias se ajustan a tu tarea especifica.\n6. Batch Normalization: El batch normalization normaliza activaciones entre capas. Estabiliza el entrenamiento, permite tasas de aprendizaje mas altas, y actua como regularizador."
    },
    {
      "duration": 25144.587875000027,
      "inputTokens": 3162,
      "output": "{\n  \"steps\": [\n    {\n      \"context\": \"{{NAME}}, the A/B test results just landed. The new onboarding flow shows a p-value of 0.04 for completion rate. Stakeholders want to roll it out today, but I’m not convinced we’ve thought this through.\",\n      \"options\": [\n        {\n          \"feedback\": \"Right. We must decide whether the data provides enough evidence to reject H0 before rushing into action.\",\n          \"isCorrect\": true,\n          \"text\": \"Let’s first define our null and alternative clearly.\"\n        },\n        {\n          \"feedback\": \"We need to confirm what the p-value means before celebrating significance.\",\n          \"isCorrect\": false,\n          \"text\": \"Let’s roll it out since p<0.05 means the new flow works.\"\n        },\n        {\n          \"feedback\": \"We can’t justify ignoring the stats entirely.\",\n          \"isCorrect\": false,\n          \"text\": \"Let’s ignore the stats and trust our instinct here.\"\n        },\n        {\n          \"feedback\": \"We should clarify the hypothesis before discussing confidence intervals.\",\n          \"isCorrect\": false,\n          \"text\": \"Let’s compute a confidence interval before deciding H0.\"\n        }\n      ],\n      \"question\": \"What should we do first?\"\n    },\n    {\n      \"context\": \"Okay, so if our null is that the new flow has no effect on completion, and our alternative is that it improves completion, then a p-value of 0.04 suggests the data is somewhat surprising under the null. But what does that actually tell us, {{NAME}}?\",\n      \"options\": [\n        {\n          \"feedback\": \"Correct. The p-value reflects the probability of observing data this extreme if H0 is true.\",\n          \"isCorrect\": true,\n          \"text\": \"It tells us how extreme our data is under the null assumption.\"\n        },\n        {\n          \"feedback\": \"No, it doesn’t give the probability H0 is true.\",\n          \"isCorrect\": false,\n          \"text\": \"It tells us the probability the null hypothesis is true.\"\n        },\n        {\n          \"feedback\": \"It doesn’t measure effect size at all.\",\n          \"isCorrect\": false,\n          \"text\": \"It tells us how big the effect is in practice.\"\n        },\n        {\n          \"feedback\": \"Not accurate. It doesn’t compare to other models.\",\n          \"isCorrect\": false,\n          \"text\": \"It tells us which model fits better overall.\"\n        }\n      ],\n      \"question\": \"How should we interpret that p-value?\"\n    },\n    {\n      \"context\": \"Right. But I’m worried about error risks. If we reject the null now, what are we exposing ourselves to? The execs only think about wins, not false alarms.\",\n      \"options\": [\n        {\n          \"feedback\": \"Correct. Rejecting a true null is a false positive — the main risk when acting on marginal p-values.\",\n          \"isCorrect\": true,\n          \"text\": \"We risk a Type I error by rejecting a true null.\"\n        },\n        {\n          \"feedback\": \"Type II refers to failing to detect a real effect.\",\n          \"isCorrect\": false,\n          \"text\": \"We risk a Type II error by rejecting a true null.\"\n        },\n        {\n          \"feedback\": \"Power is related but not the risk of rejecting a true null.\",\n          \"isCorrect\": false,\n          \"text\": \"We risk low power by rejecting the null.\"\n        },\n        {\n          \"feedback\": \"Multiple comparisons inflate Type I, but this option mislabels the risk.\",\n          \"isCorrect\": false,\n          \"text\": \"We risk a Bonferroni error by rejecting the null.\"\n        }\n      ],\n      \"question\": \"What’s our main risk if we reject H0 here?\"\n    },\n    {\n      \"context\": \"Exactly. And speaking of power… our sample size wasn’t huge. If the real effect is small, we might be underpowered. That worries me more than the p-value itself. How should we think about this?\",\n      \"options\": [\n        {\n          \"feedback\": \"Correct. Low power means we might miss real effects or get unstable estimates.\",\n          \"isCorrect\": true,\n          \"text\": \"Consider whether the study had enough power to detect meaningful effects.\"\n        },\n        {\n          \"feedback\": \"Power isn’t about overestimating effects.\",\n          \"isCorrect\": false,\n          \"text\": \"Assume power is always high with any significant result.\"\n        },\n        {\n          \"feedback\": \"Power issues don’t justify ignoring significance.\",\n          \"isCorrect\": false,\n          \"text\": \"Ignore power since we already have significance.\"\n        },\n        {\n          \"feedback\": \"Power doesn't refer to model complexity.\",\n          \"isCorrect\": false,\n          \"text\": \"Increase model complexity to boost power.\"\n        }\n      ],\n      \"question\": \"How should we approach the power concern?\"\n    },\n    {\n      \"context\": \"Good point. But even if the effect is real, the improvement is only about 0.3 percentage points. Statistically significant, sure, but… does that matter for onboarding? {{NAME}}, how should we judge this?\",\n      \"options\": [\n        {\n          \"feedback\": \"Correct. Statistical significance doesn't guarantee real-world impact.\",\n          \"isCorrect\": true,\n          \"text\": \"Check practical significance, not just the p-value.\"\n        },\n        {\n          \"feedback\": \"Practical significance must be assessed, not assumed.\",\n          \"isCorrect\": false,\n          \"text\": \"If p<0.05, it always matters in practice.\"\n        },\n        {\n          \"feedback\": \"We can’t ignore effect size.\",\n          \"isCorrect\": false,\n          \"text\": \"Ignore effect size and trust the statistic.\"\n        },\n        {\n          \"feedback\": \"We shouldn't rely on gut feelings here.\",\n          \"isCorrect\": false,\n          \"text\": \"Rely on intuition about impact rather than data.\"\n        }\n      ],\n      \"question\": \"How should we judge the impact?\"\n    },\n    {\n      \"context\": \"Totally. One more thing: we ran five different onboarding variations this cycle. I didn’t see any correction for multiple comparisons in the initial report. That’s… concerning.\",\n      \"options\": [\n        {\n          \"feedback\": \"Correct. Multiple tests inflate false positives, so we need adjustments.\",\n          \"isCorrect\": true,\n          \"text\": \"We should adjust for multiple comparisons before deciding.\"\n        },\n        {\n          \"feedback\": \"This understates the risk introduced by multiple tests.\",\n          \"isCorrect\": false,\n          \"text\": \"Ignore it since p<0.05 overrides comparison issues.\"\n        },\n        {\n          \"feedback\": \"No such automatic correction exists.\",\n          \"isCorrect\": false,\n          \"text\": \"Rely on the dashboard; it auto-corrects everything.\"\n        },\n        {\n          \"feedback\": \"This misdiagnoses the concern entirely.\",\n          \"isCorrect\": false,\n          \"text\": \"Treat each variation as independent and unchanged.\"\n        }\n      ],\n      \"question\": \"How should we handle these five tests?\"\n    },\n    {\n      \"context\": \"Hold on, {{NAME}}… I just re-ran the corrected analysis. After controlling for the five tests, the p-value jumps to 0.12. That means the onboarding flow isn’t statistically significant after all.\",\n      \"options\": [\n        {\n          \"feedback\": \"Correct. With p=0.12 we can't reject H0, so rollout doesn't follow.\",\n          \"isCorrect\": true,\n          \"text\": \"Then we shouldn’t reject the null or roll it out yet.\"\n        },\n        {\n          \"feedback\": \"No, p=0.12 means insufficient evidence to reject H0.\",\n          \"isCorrect\": false,\n          \"text\": \"It still means the null is false; we should roll out.\"\n        },\n        {\n          \"feedback\": \"Misinterpretation. Failing to reject isn’t proving the null.\",\n          \"isCorrect\": false,\n          \"text\": \"That proves the null is true.\"\n        },\n        {\n          \"feedback\": \"We need statistical basis, not guesswork.\",\n          \"isCorrect\": false,\n          \"text\": \"Let’s ignore the correction and trust our gut.\"\n        }\n      ],\n      \"question\": \"What should we conclude now?\"\n    },\n    {\n      \"context\": \"Funny twist, {{NAME}}… I checked the logs. The tiny improvement came from a random spike in traffic from a specific region that never converts well anyway. Pure noise. Honestly, what’s our move now?\",\n      \"options\": [\n        {\n          \"feedback\": \"Correct. The data shows no strong evidence or impact, so no rollout.\",\n          \"isCorrect\": true,\n          \"text\": \"We hold off, report the noise issue, and plan a proper test.\"\n        },\n        {\n          \"feedback\": \"Not wise. There's no solid evidence for rollout.\",\n          \"isCorrect\": false,\n          \"text\": \"Roll out anyway; noise is random so it’ll balance out.\"\n        },\n        {\n          \"feedback\": \"Ignoring evidence isn't sound decision-making.\",\n          \"isCorrect\": false,\n          \"text\": \"Pick whichever version feels best aesthetically.\"\n        },\n        {\n          \"feedback\": \"We should communicate clearly, not hide issues.\",\n          \"isCorrect\": false,\n          \"text\": \"Hide the noise finding and stay quiet.\"\n        }\n      ],\n      \"question\": \"What’s the best final action?\"\n    }\n  ]\n}",
      "outputTokens": 1683,
      "systemPrompt": "# Role\n\nYou are an expert interactive story designer creating a **Story** activity for a learning app. Your mission is to place learners in a first-person dialogue scenario where they work alongside a colleague to solve a real-world problem using the lesson's concepts.\n\nYou specialize in crafting immersive, dialogue-driven experiences that make learners feel like they're actually solving problems in their field — not just answering quiz questions.\n\n# The Art of Dialogue-Driven Learning\n\nA great Story activity doesn't lecture or test recall — it puts learners IN the situation. Think of it like an interactive movie where the learner IS the main character, making real decisions that matter.\n\n## Why Dialogue Scenarios Work\n\n1. **Authentic Context**: When learners apply concepts to solve realistic problems with a colleague, they see WHY the knowledge matters to them personally.\n\n2. **Active Reasoning**: Making decisions in context requires thinking through principles, not just recognizing memorized facts.\n\n3. **Emotional Investment**: Dialogue creates stakes. The learner cares about the outcome because they're part of the story.\n\n## The Collaborative Problem-Solving Principle\n\nEvery great Story activity creates a sense of partnership:\n\n- **Shared Goal**: You and your colleague are tackling something together\n- **Natural Dialogue**: Conversations feel like real workplace exchanges\n- **Meaningful Choices**: Each decision requires applying what you've learned\n- **Satisfying Resolution**: The problem gets solved and the takeaway sticks\n\n## Why Pure Dialogue Works\n\nEach scene should feel like you're eavesdropping on a real conversation — no narrator, no stage directions, just two people working through a problem. Pure dialogue:\n\n- Immerses learners completely in the scenario\n- Makes abstract concepts feel like lived experience\n- Creates natural pacing through back-and-forth exchange\n- Lets context emerge organically from what people say\n\n# Inputs\n\n- `LESSON_TITLE`: The topic to create a story around\n- `LESSON_DESCRIPTION`: Additional context about what this lesson covers\n- `CHAPTER_TITLE`: The chapter context (for understanding scope)\n- `COURSE_TITLE`: The course context (for understanding audience level)\n- `LANGUAGE`: Output language\n- `EXPLANATION_STEPS`: Array of {title, text} from all explanation activities (Background, Explanation, Mechanics, Examples) the learner completed before this one\n\n## Language Guidelines\n\n- `en`: Use US English unless the content is region-specific\n- `pt`: Use Brazilian Portuguese unless the content is region-specific\n- `es`: Use Latin American Spanish unless the content is region-specific\n\n# Requirements\n\n## Scene Structure\n\nEach scene must have:\n\n- **context**: Maximum 500 characters. Pure dialogue only — no narrator, no character name prefixes (like \"Sarah:\"), no descriptions. This is what your colleague says to you, setting up the decision point.\n- **question**: Maximum 100 characters. A short, clear question about what to do next.\n- **options**: Exactly 4 choices, each with:\n  - **text**: The answer choice (max 50 characters)\n  - **isCorrect**: Boolean indicating if this is the correct answer (exactly 1 must be true)\n  - **feedback**: Why this choice is right (with insight) or wrong (and what would be correct) — max 300 characters\n\n## Story Arc\n\nYour story must follow this structure:\n\n1. **Opening Scene**: Begin \"in the middle of the action\" — the learner and colleague are already working on something. No preamble or setup exposition.\n2. **Rising Complexity**: Each scene builds naturally from the previous dialogue. Decisions compound.\n3. **Plot Twist**: The second-to-last scene introduces an unexpected complication, surprise, or revelation.\n4. **Resolution**: The final scene resolves the problem AND reinforces the main learning takeaway.\n\n## Scene Count\n\n- Minimum: 7 scenes\n- Maximum: 20 scenes\n- Let the problem's complexity dictate the length. A simple concept might need 7-10 scenes; a complex one might need 15-20.\n\n## Tone & Style\n\n- **Pure dialogue**: NO narrator, NO character name prefixes, NO descriptions of actions or settings\n- **Natural conversation**: Write how colleagues actually talk on Slack when solving a problem together — casual, collaborative, sometimes humorous\n- **Professional but warm**: Light, smart humor when appropriate. Never forced or cheesy.\n- **Second-person immersion**: The colleague speaks TO the learner. Context emerges from what's said.\n- **Continuous flow**: Each scene's dialogue should naturally lead into the next\n\n## The {{NAME}} Placeholder\n\nUse `{{NAME}}` wherever the learner's name should appear in dialogue. For example:\n\n- \"{{NAME}}, I think we might have a problem here.\"\n- \"Good catch, {{NAME}}. That's exactly what I was thinking.\"\n\nThis personalizes the experience without requiring actual name input at content creation time.\n\n## Decision Design\n\nEvery decision must:\n\n- **Require reasoning**: Learners must apply principles from the lesson, not recall specific phrases\n- **Feel realistic**: These are choices someone might actually face in this situation\n- **Have plausible distractors**: Wrong options should be tempting but flawed for specific reasons\n- **Avoid \"obvious\" correct answers**: The right choice should require thought, not be the only non-silly option\n\n## What to Avoid\n\n- Narrator text (\"Meanwhile...\" or \"You walk into the office...\")\n- Character name prefixes (\"Sarah:\" or \"Your colleague says:\")\n- Description of actions or settings (except through dialogue itself)\n- Questions that test memorization of facts from earlier activities\n- Obvious \"correct\" answers that don't require applying the concept\n- Silly or clearly wrong distractors that no reasonable person would choose\n- Breaking the fourth wall or meta-commentary\n- Starting with \"In this activity...\" or setup exposition\n\n## Scope\n\n- **Stay focused**: The problem should specifically require THIS lesson's concept to solve\n- **Don't expand**: Other lessons cover related topics — this story tests this lesson\n- **Don't narrow**: If the lesson is broad, the problem should engage multiple aspects of it\n\n## Relationship to Previous Activities\n\nThe learner has already completed:\n\n- **Background**: WHY this exists (origin story, problems solved, historical context)\n- **Explanation**: WHAT it is (core concepts, components, definitions)\n- **Mechanics**: HOW it works (processes in action, cause-effect chains)\n- **Examples**: WHERE it appears (real-world contexts, applications)\n\nYour Story activity answers WHEN DO I USE THIS? (applying concepts to solve realistic problems). These complement each other:\n\n- Background: \"WHY did we need this?\"\n- Explanation: \"WHAT exactly is it?\"\n- Mechanics: \"HOW does it actually work?\"\n- Examples: \"WHERE will I encounter this?\"\n- Story: \"WHEN do I apply this to solve real problems?\"\n\nThe learner knows what the concept IS, how it WORKS, and where they'll SEE it. Now they practice USING it in a realistic scenario.\n\n# Structure Guide\n\nWhile every story is unique, most follow this arc (adapt as needed):\n\n1. **The Hook**: Jump straight into the situation. Something needs to be figured out or decided.\n2. **Initial Assessment**: What's the situation? What do we know? First decisions.\n3. **Deepening Complexity**: The problem has layers. Apply the concept more deeply.\n4. **Complications**: Things aren't as simple as they seemed. Adapt your approach.\n5. **The Twist**: A surprise, revelation, or unexpected turn that requires rethinking.\n6. **The Resolution**: Solve the problem AND crystallize the key insight from the lesson.\n\nNote: Sometimes the final twist can have a humorous or unexpected resolution that still reinforces the learning. Something that makes the learner smile and think \"I didn't see that coming!\"\n\n# Dialogue Tone Examples\n\nThe following examples show the **tone and style** to aim for — not complete scenes, just the kind of dialogue that makes stories feel alive. Adapt freely to your topic.\n\n## Opening Hooks (Jump Into the Action)\n\n> \"{{NAME}}, I've been staring at this bug for an hour. The shopping cart total keeps showing yesterday's prices. The database is fine. Something's wrong with how we're storing them.\"\n\n> \"Okay, {{NAME}}, the client just called. Their entire inventory system crashed right before Black Friday. They're panicking. We need to figure this out fast.\"\n\n> \"{{NAME}}, you're not going to believe this. Remember that algorithm we deployed last week? It's been recommending the exact opposite of what users want. Sales are tanking.\"\n\n## Building Tension (Problems Get Deeper)\n\n> \"Wait. If this pattern is everywhere in the codebase... inventory counts, user roles, discount percentages... we might have a much bigger problem than I thought.\"\n\n> \"Hold on. The logs show someone accessed the admin panel at 3 AM last night. But nobody on the team was working then. {{NAME}}, who else has those credentials?\"\n\n> \"The numbers don't add up. We're showing 500 successful transactions, but the bank only received 487. Where did the other 13 go?\"\n\n## Plot Twists (The Unexpected Turn)\n\n> \"{{NAME}}... I just ran the analysis twice. The bug isn't in our code. It's been in the library we've trusted for three years. Every project using it has this vulnerability.\"\n\n> \"I found the source of the data leak. {{NAME}}, it's not a hacker. It's our own caching system. We've been accidentally exposing user data to anyone who knew where to look.\"\n\n> \"Plot twist: the 'broken' feature? It's working exactly as designed. The original spec was just... completely wrong. We've been solving the wrong problem this whole time.\"\n\n## Humorous Moments (Light Relief)\n\n> \"Well, {{NAME}}, the good news is we found the bug. The bad news? It's been there since 2019. The worse news? I wrote it. The even worse news? So did you. We pair-programmed this disaster together.\"\n\n> \"Congratulations, {{NAME}}. We just spent four hours debugging what turned out to be a typo. 'userID' vs 'userId'. Camel case strikes again.\"\n\n> \"{{NAME}}, remember when I said 'this should be a quick fix'? That was three coffees and one existential crisis ago.\"\n\n## Satisfying Resolutions (Problem Solved + Insight Crystallized)\n\n> \"There it is. The fix works. {{NAME}}, I don't think I'll ever forget this — always check if your data source can change while you're holding onto a copy of it.\"\n\n> \"We did it. The system's stable. You know what the real lesson here was? Sometimes the simplest explanation IS the right one. We kept looking for complex bugs when the answer was right in front of us.\"\n\n> \"That's it — problem solved, client happy, crisis averted. {{NAME}}, I think we just learned more about distributed systems in the last hour than in any textbook.\"\n\n## Unexpected/Funny Endings\n\n> \"So after all that debugging... it was a timezone issue. Every single time. I'm starting to think all bugs are secretly timezone issues in disguise.\"\n\n> \"{{NAME}}, the CEO just called to thank us. Apparently fixing that 'minor bug' saved them $2 million. I think we need to renegotiate our rates.\"\n\n> \"The system's fixed. Also, I may have accidentally discovered that our competitor's product has the exact same bug. Should we... tell them? Actually, don't answer that.\"\n\nRemember: These are just **tone examples**. Your story should be original, fit the lesson topic, and create its own memorable journey. Mix problem-solving tension with moments of humor or surprise. The best stories make learners think \"I didn't see that coming!\" while still teaching the concept.\n\n# Quality Checks\n\nBefore finalizing, verify:\n\n- [ ] Is the dialogue pure conversation with NO narrator, NO character prefixes, NO descriptions?\n- [ ] Does every scene flow naturally from the previous one (continuous story)?\n- [ ] Do all decisions require applying lesson concepts, not just recalling facts?\n- [ ] Is there a genuine plot twist in the second-to-last scene?\n- [ ] Does the resolution both solve the problem AND reinforce the main learning?\n- [ ] Is `{{NAME}}` used appropriately to personalize the dialogue?\n- [ ] Are all distractors plausible (not obviously silly)?\n- [ ] Does the story feel like a real workplace conversation, not a quiz in disguise?\n- [ ] Is the scope exactly the lesson topic — not broader or narrower?\n- [ ] Are all constraints met (context ≤500 chars, question ≤100 chars, options ≤50 chars each, feedback ≤300 chars each)?\n- [ ] Is the scene count between 7 and 20?\n\n# Output Format\n\nReturn an array of scenes, each with:\n\n- **context**: Pure dialogue from colleague (max 500 chars)\n- **question**: Decision prompt (max 100 chars)\n- **options**: Array of exactly 4 objects, each with:\n  - **text**: The answer choice (max 50 chars)\n  - **isCorrect**: Boolean (exactly 1 must be true, 3 must be false)\n  - **feedback**: Why right or wrong (max 300 chars)\n\nUse 7-20 scenes to tell a complete, engaging story. Let the problem's complexity dictate the length.\n",
      "testCaseId": "en-statistics-hypothesis-testing-1",
      "userPrompt": "LESSON_TITLE: Hypothesis Testing in Practice\nLESSON_DESCRIPTION: Applying statistical hypothesis testing correctly to make sound data-driven decisions\nCHAPTER_TITLE: Statistical Inference\nCOURSE_TITLE: Applied Statistics\nLANGUAGE: en\nEXPLANATION_STEPS:\n1. Null Hypothesis: The null hypothesis (H0) is the default assumption of no effect. We try to reject it. The p-value measures how surprising the data would be IF the null were true.\n2. P-Value Meaning: A p-value is NOT the probability the null is true. It's the probability of seeing data this extreme (or more) if the null IS true. A common and dangerous misinterpretation.\n3. Error Types: Type I error (false positive) is rejecting a true null. Type II error (false negative) is failing to reject a false null. You can't minimize both — there's a trade-off.\n4. Statistical Power: Statistical power is the probability of detecting a real effect. It depends on sample size, effect size, and significance level. Low-powered studies miss real effects.\n5. Practical Significance: Statistical significance doesn't mean practical significance. A huge sample can detect tiny effects that don't matter in practice. Always consider effect size.\n6. Multiple Comparisons: Multiple comparisons inflate Type I errors. Testing 20 hypotheses at alpha=0.05 expects one false positive. Corrections like Bonferroni or FDR control this."
    },
    {
      "duration": 25124.763000000035,
      "inputTokens": 3131,
      "output": "{\n  \"steps\": [\n    {\n      \"context\": \"{{NAME}}, I’m staring at this prototype workflow, and something feels off. We’re supposed to demo a small quantum routine that finds a marked item in a list faster than the classical version, but the amplitudes look totally flat. No constructive interference anywhere.\",\n      \"options\": [\n        {\n          \"feedback\": \"Correct. Grover-type routines rely on amplitude amplification, so we need the oracle and diffuser in the right order.\",\n          \"isCorrect\": true,\n          \"text\": \"Let’s check if the oracle and diffuser are applied correctly.\"\n        },\n        {\n          \"feedback\": \"Incorrect. The issue isn’t missing entanglement; it’s the interference pattern from the oracle-diffuser cycle.\",\n          \"isCorrect\": false,\n          \"text\": \"Maybe the qubits aren’t entangled enough.\"\n        },\n        {\n          \"feedback\": \"Incorrect. Measurement earlier would collapse the state and remove the interference we need.\",\n          \"isCorrect\": false,\n          \"text\": \"Let’s insert a measurement before the final layer.\"\n        },\n        {\n          \"feedback\": \"Incorrect. This won’t affect the interference structure required for amplitude amplification.\",\n          \"isCorrect\": false,\n          \"text\": \"Try randomizing initial phases to see what happens.\"\n        }\n      ],\n      \"question\": \"What should we check first?\"\n    },\n    {\n      \"context\": \"Yeah, {{NAME}}, the oracle and diffuser are reversed. That explains the flat amplitudes. But even after swapping them, our qubits decohere way too fast. The simulator flags noise levels that wipe out the interference before the last iteration.\",\n      \"options\": [\n        {\n          \"feedback\": \"Correct. Reducing iterations trades off some speedup, but stays within coherence limits.\",\n          \"isCorrect\": true,\n          \"text\": \"Let’s reduce the number of Grover iterations.\"\n        },\n        {\n          \"feedback\": \"Incorrect. Adding more iterations increases exposure to noise.\",\n          \"isCorrect\": false,\n          \"text\": \"Let’s increase the iteration count.\"\n        },\n        {\n          \"feedback\": \"Incorrect. Replacing gates doesn’t solve decoherence; we need to adjust runtime.\",\n          \"isCorrect\": false,\n          \"text\": \"Swap Hadamards for Y-rotations to fight noise.\"\n        },\n        {\n          \"feedback\": \"Incorrect. More qubits increases noise, not reduces it.\",\n          \"isCorrect\": false,\n          \"text\": \"Add extra ancilla qubits to absorb noise.\"\n        }\n      ],\n      \"question\": \"How do we handle the noise issue?\"\n    },\n    {\n      \"context\": \"Good call, {{NAME}}. The amplitudes survive now, but there’s another problem: the output distribution isn’t peaking on the marked item. It’s slightly higher, but not enough to beat classical scaling. I’m wondering if our oracle is even marking the right basis state.\",\n      \"options\": [\n        {\n          \"feedback\": \"Correct. Checking the oracle ensures the correct state gets its phase flipped.\",\n          \"isCorrect\": true,\n          \"text\": \"Let’s validate the oracle’s target state.\"\n        },\n        {\n          \"feedback\": \"Incorrect. Increasing shots shows the same distribution if the marking is wrong.\",\n          \"isCorrect\": false,\n          \"text\": \"Just run more measurement shots.\"\n        },\n        {\n          \"feedback\": \"Incorrect. Extra ancillas won’t fix mis-marked states.\",\n          \"isCorrect\": false,\n          \"text\": \"Add helper qubits to strengthen the phase flip.\"\n        },\n        {\n          \"feedback\": \"Incorrect. Entangling gates don’t compensate for incorrect oracle logic.\",\n          \"isCorrect\": false,\n          \"text\": \"Try adding a CNOT chain to boost interference.\"\n        }\n      ],\n      \"question\": \"What should we investigate next?\"\n    },\n    {\n      \"context\": \"Okay, confirmed. The oracle was marking the wrong state. Now the distribution peaks correctly, but only on small lists. When we scale to larger lists, decoherence hits again, and the advantage disappears. We might need some lightweight error mitigation.\",\n      \"options\": [\n        {\n          \"feedback\": \"Incorrect. Arbitrary pauses worsen decoherence.\",\n          \"isCorrect\": false,\n          \"text\": \"Insert delay gates between operations.\"\n        },\n        {\n          \"feedback\": \"Correct. Zero-noise extrapolation helps estimate ideal behavior without full error correction.\",\n          \"isCorrect\": true,\n          \"text\": \"Try zero-noise extrapolation.\"\n        },\n        {\n          \"feedback\": \"Incorrect. This doesn’t mitigate noise during gate execution.\",\n          \"isCorrect\": false,\n          \"text\": \"Measure mid-circuit to stabilize amplitudes.\"\n        },\n        {\n          \"feedback\": \"Incorrect. Extra entanglement increases noise sensitivity.\",\n          \"isCorrect\": false,\n          \"text\": \"Entangle all qubits more to average errors out.\"\n        }\n      ],\n      \"question\": \"How should we stabilize results?\"\n    },\n    {\n      \"context\": \"Nice, {{NAME}}. The extrapolation helps, but we’re still far from demonstrating real advantage. The PM just pinged me asking why we can’t just add quantum error correction and be done with it. I really don’t think we have the qubit budget.\",\n      \"options\": [\n        {\n          \"feedback\": \"Correct. Full fault tolerance is unrealistic today; we use mitigation instead.\",\n          \"isCorrect\": true,\n          \"text\": \"Explain that full QEC needs thousands of physical qubits.\"\n        },\n        {\n          \"feedback\": \"Incorrect. Classical algorithms don’t fix quantum noise.\",\n          \"isCorrect\": false,\n          \"text\": \"Maybe let’s just run a classical helper algorithm.\"\n        },\n        {\n          \"feedback\": \"Incorrect. Reducing the dataset doesn’t solve hardware limits.\",\n          \"isCorrect\": false,\n          \"text\": \"Shrink the list until noise stops mattering.\"\n        },\n        {\n          \"feedback\": \"Incorrect. Random restarts don’t replace actual fault tolerance.\",\n          \"isCorrect\": false,\n          \"text\": \"Try random restarts to average out errors.\"\n        }\n      ],\n      \"question\": \"How should we respond to the PM?\"\n    },\n    {\n      \"context\": \"That explanation worked, {{NAME}}. But now the CTO wants data comparing our quantum routine to a classical baseline. They’re worried we’re overselling. And honestly, our current speedup is tiny. Should we adjust the problem to one that fits quantum strengths better?\",\n      \"options\": [\n        {\n          \"feedback\": \"Correct. Quantum advantage depends on matching the algorithm to the right type of problem.\",\n          \"isCorrect\": true,\n          \"text\": \"Shift to a problem aligned with quantum strengths.\"\n        },\n        {\n          \"feedback\": \"Incorrect. Hiding weaknesses reduces credibility.\",\n          \"isCorrect\": false,\n          \"text\": \"Just show the quantum results without a baseline.\"\n        },\n        {\n          \"feedback\": \"Incorrect. Re-running won’t fix a mismatch between algorithm and problem.\",\n          \"isCorrect\": false,\n          \"text\": \"Rerun the same experiment with more shots.\"\n        },\n        {\n          \"feedback\": \"Incorrect. More noise makes things worse.\",\n          \"isCorrect\": false,\n          \"text\": \"Increase noise to highlight robustness gains.\"\n        }\n      ],\n      \"question\": \"What should we propose?\"\n    },\n    {\n      \"context\": \"Great idea, {{NAME}}. I swapped to a small simulation problem and the improvements look real. But plot twist: our quantum simulator just flagged that the entanglement depth exceeds what the hardware backend even supports. We might have to rethink the circuit.\",\n      \"options\": [\n        {\n          \"feedback\": \"Incorrect. Shortening helps, but doesn’t address unsupported entanglement depth.\",\n          \"isCorrect\": false,\n          \"text\": \"Let’s try fewer gates but same entanglement depth.\"\n        },\n        {\n          \"feedback\": \"Incorrect. Noise raises errors and worsens performance.\",\n          \"isCorrect\": false,\n          \"text\": \"Increase the noise model to match real hardware.\"\n        },\n        {\n          \"feedback\": \"Correct. Redesigning for shallower entanglement depth keeps it executable.\",\n          \"isCorrect\": true,\n          \"text\": \"Redesign for a shallower, hardware-friendly circuit.\"\n        },\n        {\n          \"feedback\": \"Incorrect. Ignoring hardware limits will cause execution failure.\",\n          \"isCorrect\": false,\n          \"text\": \"Ignore the simulator and push to hardware anyway.\"\n        }\n      ],\n      \"question\": \"How do we handle the hardware limitation?\"\n    },\n    {\n      \"context\": \"Perfect move, {{NAME}}. The redesigned circuit runs within hardware limits, the interference pattern holds, and the simulation results finally show a meaningful quantum benefit. This wraps it up, I think.\",\n      \"options\": [\n        {\n          \"feedback\": \"Correct. Summarizing the takeaway reinforces when to use quantum approaches.\",\n          \"isCorrect\": true,\n          \"text\": \"Emphasize matching algorithms to hardware and problem type.\"\n        },\n        {\n          \"feedback\": \"Incorrect. Avoid overclaiming—quantum isn’t universally superior.\",\n          \"isCorrect\": false,\n          \"text\": \"Say quantum beats classical at everything now.\"\n        },\n        {\n          \"feedback\": \"Incorrect. Glossing over decoherence ignores major constraints.\",\n          \"isCorrect\": false,\n          \"text\": \"Downplay noise and pretend it doesn’t matter.\"\n        },\n        {\n          \"feedback\": \"Incorrect. Focusing just on qubit count misses the core lesson.\",\n          \"isCorrect\": false,\n          \"text\": \"Highlight only qubit growth, not algorithm fit.\"\n        }\n      ],\n      \"question\": \"How should we wrap up the project?\"\n    }\n  ]\n}",
      "outputTokens": 1645,
      "systemPrompt": "# Role\n\nYou are an expert interactive story designer creating a **Story** activity for a learning app. Your mission is to place learners in a first-person dialogue scenario where they work alongside a colleague to solve a real-world problem using the lesson's concepts.\n\nYou specialize in crafting immersive, dialogue-driven experiences that make learners feel like they're actually solving problems in their field — not just answering quiz questions.\n\n# The Art of Dialogue-Driven Learning\n\nA great Story activity doesn't lecture or test recall — it puts learners IN the situation. Think of it like an interactive movie where the learner IS the main character, making real decisions that matter.\n\n## Why Dialogue Scenarios Work\n\n1. **Authentic Context**: When learners apply concepts to solve realistic problems with a colleague, they see WHY the knowledge matters to them personally.\n\n2. **Active Reasoning**: Making decisions in context requires thinking through principles, not just recognizing memorized facts.\n\n3. **Emotional Investment**: Dialogue creates stakes. The learner cares about the outcome because they're part of the story.\n\n## The Collaborative Problem-Solving Principle\n\nEvery great Story activity creates a sense of partnership:\n\n- **Shared Goal**: You and your colleague are tackling something together\n- **Natural Dialogue**: Conversations feel like real workplace exchanges\n- **Meaningful Choices**: Each decision requires applying what you've learned\n- **Satisfying Resolution**: The problem gets solved and the takeaway sticks\n\n## Why Pure Dialogue Works\n\nEach scene should feel like you're eavesdropping on a real conversation — no narrator, no stage directions, just two people working through a problem. Pure dialogue:\n\n- Immerses learners completely in the scenario\n- Makes abstract concepts feel like lived experience\n- Creates natural pacing through back-and-forth exchange\n- Lets context emerge organically from what people say\n\n# Inputs\n\n- `LESSON_TITLE`: The topic to create a story around\n- `LESSON_DESCRIPTION`: Additional context about what this lesson covers\n- `CHAPTER_TITLE`: The chapter context (for understanding scope)\n- `COURSE_TITLE`: The course context (for understanding audience level)\n- `LANGUAGE`: Output language\n- `EXPLANATION_STEPS`: Array of {title, text} from all explanation activities (Background, Explanation, Mechanics, Examples) the learner completed before this one\n\n## Language Guidelines\n\n- `en`: Use US English unless the content is region-specific\n- `pt`: Use Brazilian Portuguese unless the content is region-specific\n- `es`: Use Latin American Spanish unless the content is region-specific\n\n# Requirements\n\n## Scene Structure\n\nEach scene must have:\n\n- **context**: Maximum 500 characters. Pure dialogue only — no narrator, no character name prefixes (like \"Sarah:\"), no descriptions. This is what your colleague says to you, setting up the decision point.\n- **question**: Maximum 100 characters. A short, clear question about what to do next.\n- **options**: Exactly 4 choices, each with:\n  - **text**: The answer choice (max 50 characters)\n  - **isCorrect**: Boolean indicating if this is the correct answer (exactly 1 must be true)\n  - **feedback**: Why this choice is right (with insight) or wrong (and what would be correct) — max 300 characters\n\n## Story Arc\n\nYour story must follow this structure:\n\n1. **Opening Scene**: Begin \"in the middle of the action\" — the learner and colleague are already working on something. No preamble or setup exposition.\n2. **Rising Complexity**: Each scene builds naturally from the previous dialogue. Decisions compound.\n3. **Plot Twist**: The second-to-last scene introduces an unexpected complication, surprise, or revelation.\n4. **Resolution**: The final scene resolves the problem AND reinforces the main learning takeaway.\n\n## Scene Count\n\n- Minimum: 7 scenes\n- Maximum: 20 scenes\n- Let the problem's complexity dictate the length. A simple concept might need 7-10 scenes; a complex one might need 15-20.\n\n## Tone & Style\n\n- **Pure dialogue**: NO narrator, NO character name prefixes, NO descriptions of actions or settings\n- **Natural conversation**: Write how colleagues actually talk on Slack when solving a problem together — casual, collaborative, sometimes humorous\n- **Professional but warm**: Light, smart humor when appropriate. Never forced or cheesy.\n- **Second-person immersion**: The colleague speaks TO the learner. Context emerges from what's said.\n- **Continuous flow**: Each scene's dialogue should naturally lead into the next\n\n## The {{NAME}} Placeholder\n\nUse `{{NAME}}` wherever the learner's name should appear in dialogue. For example:\n\n- \"{{NAME}}, I think we might have a problem here.\"\n- \"Good catch, {{NAME}}. That's exactly what I was thinking.\"\n\nThis personalizes the experience without requiring actual name input at content creation time.\n\n## Decision Design\n\nEvery decision must:\n\n- **Require reasoning**: Learners must apply principles from the lesson, not recall specific phrases\n- **Feel realistic**: These are choices someone might actually face in this situation\n- **Have plausible distractors**: Wrong options should be tempting but flawed for specific reasons\n- **Avoid \"obvious\" correct answers**: The right choice should require thought, not be the only non-silly option\n\n## What to Avoid\n\n- Narrator text (\"Meanwhile...\" or \"You walk into the office...\")\n- Character name prefixes (\"Sarah:\" or \"Your colleague says:\")\n- Description of actions or settings (except through dialogue itself)\n- Questions that test memorization of facts from earlier activities\n- Obvious \"correct\" answers that don't require applying the concept\n- Silly or clearly wrong distractors that no reasonable person would choose\n- Breaking the fourth wall or meta-commentary\n- Starting with \"In this activity...\" or setup exposition\n\n## Scope\n\n- **Stay focused**: The problem should specifically require THIS lesson's concept to solve\n- **Don't expand**: Other lessons cover related topics — this story tests this lesson\n- **Don't narrow**: If the lesson is broad, the problem should engage multiple aspects of it\n\n## Relationship to Previous Activities\n\nThe learner has already completed:\n\n- **Background**: WHY this exists (origin story, problems solved, historical context)\n- **Explanation**: WHAT it is (core concepts, components, definitions)\n- **Mechanics**: HOW it works (processes in action, cause-effect chains)\n- **Examples**: WHERE it appears (real-world contexts, applications)\n\nYour Story activity answers WHEN DO I USE THIS? (applying concepts to solve realistic problems). These complement each other:\n\n- Background: \"WHY did we need this?\"\n- Explanation: \"WHAT exactly is it?\"\n- Mechanics: \"HOW does it actually work?\"\n- Examples: \"WHERE will I encounter this?\"\n- Story: \"WHEN do I apply this to solve real problems?\"\n\nThe learner knows what the concept IS, how it WORKS, and where they'll SEE it. Now they practice USING it in a realistic scenario.\n\n# Structure Guide\n\nWhile every story is unique, most follow this arc (adapt as needed):\n\n1. **The Hook**: Jump straight into the situation. Something needs to be figured out or decided.\n2. **Initial Assessment**: What's the situation? What do we know? First decisions.\n3. **Deepening Complexity**: The problem has layers. Apply the concept more deeply.\n4. **Complications**: Things aren't as simple as they seemed. Adapt your approach.\n5. **The Twist**: A surprise, revelation, or unexpected turn that requires rethinking.\n6. **The Resolution**: Solve the problem AND crystallize the key insight from the lesson.\n\nNote: Sometimes the final twist can have a humorous or unexpected resolution that still reinforces the learning. Something that makes the learner smile and think \"I didn't see that coming!\"\n\n# Dialogue Tone Examples\n\nThe following examples show the **tone and style** to aim for — not complete scenes, just the kind of dialogue that makes stories feel alive. Adapt freely to your topic.\n\n## Opening Hooks (Jump Into the Action)\n\n> \"{{NAME}}, I've been staring at this bug for an hour. The shopping cart total keeps showing yesterday's prices. The database is fine. Something's wrong with how we're storing them.\"\n\n> \"Okay, {{NAME}}, the client just called. Their entire inventory system crashed right before Black Friday. They're panicking. We need to figure this out fast.\"\n\n> \"{{NAME}}, you're not going to believe this. Remember that algorithm we deployed last week? It's been recommending the exact opposite of what users want. Sales are tanking.\"\n\n## Building Tension (Problems Get Deeper)\n\n> \"Wait. If this pattern is everywhere in the codebase... inventory counts, user roles, discount percentages... we might have a much bigger problem than I thought.\"\n\n> \"Hold on. The logs show someone accessed the admin panel at 3 AM last night. But nobody on the team was working then. {{NAME}}, who else has those credentials?\"\n\n> \"The numbers don't add up. We're showing 500 successful transactions, but the bank only received 487. Where did the other 13 go?\"\n\n## Plot Twists (The Unexpected Turn)\n\n> \"{{NAME}}... I just ran the analysis twice. The bug isn't in our code. It's been in the library we've trusted for three years. Every project using it has this vulnerability.\"\n\n> \"I found the source of the data leak. {{NAME}}, it's not a hacker. It's our own caching system. We've been accidentally exposing user data to anyone who knew where to look.\"\n\n> \"Plot twist: the 'broken' feature? It's working exactly as designed. The original spec was just... completely wrong. We've been solving the wrong problem this whole time.\"\n\n## Humorous Moments (Light Relief)\n\n> \"Well, {{NAME}}, the good news is we found the bug. The bad news? It's been there since 2019. The worse news? I wrote it. The even worse news? So did you. We pair-programmed this disaster together.\"\n\n> \"Congratulations, {{NAME}}. We just spent four hours debugging what turned out to be a typo. 'userID' vs 'userId'. Camel case strikes again.\"\n\n> \"{{NAME}}, remember when I said 'this should be a quick fix'? That was three coffees and one existential crisis ago.\"\n\n## Satisfying Resolutions (Problem Solved + Insight Crystallized)\n\n> \"There it is. The fix works. {{NAME}}, I don't think I'll ever forget this — always check if your data source can change while you're holding onto a copy of it.\"\n\n> \"We did it. The system's stable. You know what the real lesson here was? Sometimes the simplest explanation IS the right one. We kept looking for complex bugs when the answer was right in front of us.\"\n\n> \"That's it — problem solved, client happy, crisis averted. {{NAME}}, I think we just learned more about distributed systems in the last hour than in any textbook.\"\n\n## Unexpected/Funny Endings\n\n> \"So after all that debugging... it was a timezone issue. Every single time. I'm starting to think all bugs are secretly timezone issues in disguise.\"\n\n> \"{{NAME}}, the CEO just called to thank us. Apparently fixing that 'minor bug' saved them $2 million. I think we need to renegotiate our rates.\"\n\n> \"The system's fixed. Also, I may have accidentally discovered that our competitor's product has the exact same bug. Should we... tell them? Actually, don't answer that.\"\n\nRemember: These are just **tone examples**. Your story should be original, fit the lesson topic, and create its own memorable journey. Mix problem-solving tension with moments of humor or surprise. The best stories make learners think \"I didn't see that coming!\" while still teaching the concept.\n\n# Quality Checks\n\nBefore finalizing, verify:\n\n- [ ] Is the dialogue pure conversation with NO narrator, NO character prefixes, NO descriptions?\n- [ ] Does every scene flow naturally from the previous one (continuous story)?\n- [ ] Do all decisions require applying lesson concepts, not just recalling facts?\n- [ ] Is there a genuine plot twist in the second-to-last scene?\n- [ ] Does the resolution both solve the problem AND reinforce the main learning?\n- [ ] Is `{{NAME}}` used appropriately to personalize the dialogue?\n- [ ] Are all distractors plausible (not obviously silly)?\n- [ ] Does the story feel like a real workplace conversation, not a quiz in disguise?\n- [ ] Is the scope exactly the lesson topic — not broader or narrower?\n- [ ] Are all constraints met (context ≤500 chars, question ≤100 chars, options ≤50 chars each, feedback ≤300 chars each)?\n- [ ] Is the scene count between 7 and 20?\n\n# Output Format\n\nReturn an array of scenes, each with:\n\n- **context**: Pure dialogue from colleague (max 500 chars)\n- **question**: Decision prompt (max 100 chars)\n- **options**: Array of exactly 4 objects, each with:\n  - **text**: The answer choice (max 50 chars)\n  - **isCorrect**: Boolean (exactly 1 must be true, 3 must be false)\n  - **feedback**: Why right or wrong (max 300 chars)\n\nUse 7-20 scenes to tell a complete, engaging story. Let the problem's complexity dictate the length.\n",
      "testCaseId": "en-physics-quantum-computing-basics-1",
      "userPrompt": "LESSON_TITLE: Quantum Computing Fundamentals\nLESSON_DESCRIPTION: Understanding quantum computing capabilities and limitations for practical problem-solving\nCHAPTER_TITLE: Quantum Information\nCOURSE_TITLE: Quantum Computing Fundamentals\nLANGUAGE: en\nEXPLANATION_STEPS:\n1. Superposition: Qubits can exist in superposition — a weighted combination of 0 and 1 states. This isn't 'both at once' — it's a probability amplitude that interferes before measurement.\n2. Entanglement: Entanglement links qubits so measuring one instantly determines the other, regardless of distance. This correlation is a resource for quantum algorithms.\n3. Quantum Parallelism: Quantum parallelism lets algorithms evaluate functions on all inputs simultaneously. But you can only read one result — the art is using interference to amplify the right answer.\n4. Decoherence: Decoherence destroys quantum information when qubits interact with their environment. Real qubits are noisy and maintain coherence only briefly.\n5. Error Correction: Quantum error correction encodes logical qubits in many physical qubits. The overhead is huge — thousands of physical qubits per logical qubit for fault tolerance.\n6. Where Quantum Helps: Quantum advantage requires the right problem type. Factoring, simulation, and certain optimization problems benefit. Most classical algorithms won't be replaced."
    },
    {
      "duration": 27172.24329199997,
      "inputTokens": 3181,
      "output": "{\n  \"steps\": [\n    {\n      \"context\": \"{{NAME}}, preciso de ajuda. O checkout tá travando quando o serviço de Pagamentos demora a responder. O pessoal tá reclamando que o fluxo inteiro fica preso. Antes de sair desligando coisa, o que você acha que a gente deveria revisar primeiro?\",\n      \"options\": [\n        {\n          \"feedback\": \"Certo. Sem visibilidade, não sabemos onde está o gargalo. Observabilidade é a base pra qualquer diagnóstico em microserviços.\",\n          \"isCorrect\": true,\n          \"text\": \"Checar logs, métricas e tracing primeiro\"\n        },\n        {\n          \"feedback\": \"Aumentar hardware pode mascarar o problema real e ainda gerar custo desnecessário.\",\n          \"isCorrect\": false,\n          \"text\": \"Subir mais instâncias de Checkout\"\n        },\n        {\n          \"feedback\": \"Trocar para assíncrono pode ser uma opção, mas só depois de entender o problema.\",\n          \"isCorrect\": false,\n          \"text\": \"Migrar Pagamentos pra eventos agora\"\n        },\n        {\n          \"feedback\": \"Timeout aleatório pode piorar o comportamento. Primeiro investigue.\",\n          \"isCorrect\": false,\n          \"text\": \"Colocar timeout curto no Checkout já\"\n        }\n      ],\n      \"question\": \"O que revisar primeiro?\"\n    },\n    {\n      \"context\": \"Beleza, {{NAME}}. Olha isso: o tracing mostra que o Checkout fica pendurado 12 segundos esperando Pagamentos. E quando isso acontece, a fila de requisições começa a crescer sem limite. Como a gente deveria reagir a esse bloqueio?\",\n      \"options\": [\n        {\n          \"feedback\": \"Sim. Circuit breaker evita travamento geral isolando o serviço lento e permitindo fallback.\",\n          \"isCorrect\": true,\n          \"text\": \"Adicionar circuit breaker no Checkout\"\n        },\n        {\n          \"feedback\": \"Retry sem controle só aumenta carga em cima de algo já lento.\",\n          \"isCorrect\": false,\n          \"text\": \"Adicionar múltiplos retries agressivos\"\n        },\n        {\n          \"feedback\": \"Timeouts são bons, mas sem breaker ainda pode gerar cascata.\",\n          \"isCorrect\": false,\n          \"text\": \"Depender só de timeout mais curto\"\n        },\n        {\n          \"feedback\": \"Escalar Pagamentos sem entender o motivo da lentidão pode não resolver.\",\n          \"isCorrect\": false,\n          \"text\": \"Escalar Pagamentos imediatamente\"\n        }\n      ],\n      \"question\": \"Como reagir ao bloqueio?\"\n    },\n    {\n      \"context\": \"Colocando o circuit breaker, beleza. Mas e o fallback? O time de produto pediu pra não bloquear o checkout se Pagamentos cair. O que você acha de mandar um 'pagamento pendente' e processar depois?\",\n      \"options\": [\n        {\n          \"feedback\": \"Correto. É um caso clássico pra comunicação assíncrona e consistência eventual.\",\n          \"isCorrect\": true,\n          \"text\": \"Usar evento para processar pagamento depois\"\n        },\n        {\n          \"feedback\": \"REST não resolve o comportamento assíncrono pedido.\",\n          \"isCorrect\": false,\n          \"text\": \"Usar outra chamada REST síncrona\"\n        },\n        {\n          \"feedback\": \"Retentar pode atrasar ainda mais o usuário e não resolve a indisponibilidade.\",\n          \"isCorrect\": false,\n          \"text\": \"Fazer retries até Pagamentos voltar\"\n        },\n        {\n          \"feedback\": \"Erro imediato quebra o fluxo e não atende ao pedido do produto.\",\n          \"isCorrect\": false,\n          \"text\": \"Retornar erro direto ao usuário\"\n        }\n      ],\n      \"question\": \"Qual fallback faz sentido?\"\n    },\n    {\n      \"context\": \"Boa, {{NAME}}. Agora o time de Dados tá perguntando como manter consistência. Eles querem atualizar o banco do Checkout com status final do pagamento imediatamente. Mas a gente sabe que isso não é realista. O que sugerimos?\",\n      \"options\": [\n        {\n          \"feedback\": \"Sim. Consistência eventual via eventos simplifica e evita transações distribuídas.\",\n          \"isCorrect\": true,\n          \"text\": \"Atualizar status quando evento de Pagamentos chegar\"\n        },\n        {\n          \"feedback\": \"Transação distribuída aumenta complexidade e fragilidade.\",\n          \"isCorrect\": false,\n          \"text\": \"Fazer 2PC entre Checkout e Pagamentos\"\n        },\n        {\n          \"feedback\": \"Escrever direto no banco de Pagamentos quebra isolamento de serviço.\",\n          \"isCorrect\": false,\n          \"text\": \"Checkout atualizar o banco de Pagamentos\"\n        },\n        {\n          \"feedback\": \"Forçar sincronismo ignora as vantagens do assíncrono.\",\n          \"isCorrect\": false,\n          \"text\": \"Voltar tudo para fluxo síncrono\"\n        }\n      ],\n      \"question\": \"Como manter consistência?\"\n    },\n    {\n      \"context\": \"Show. Só que agora a equipe de Pedidos reclamou que não consegue saber o estado real do pagamento em tempo real. Eles querem consultar um endpoint instantâneo. Como respondemos a isso sem abandonar o assíncrono?\",\n      \"options\": [\n        {\n          \"feedback\": \"Correto. O serviço mantém estado local atualizado conforme eventos chegam.\",\n          \"isCorrect\": true,\n          \"text\": \"Criar um read model local atualizado por eventos\"\n        },\n        {\n          \"feedback\": \"Chamar Pagamentos a cada consulta reintroduz acoplamento e latência.\",\n          \"isCorrect\": false,\n          \"text\": \"Consultar Pagamentos a cada requisição\"\n        },\n        {\n          \"feedback\": \"Polling constante aumenta carga desnecessária.\",\n          \"isCorrect\": false,\n          \"text\": \"Fazer polling contínuo em Pagamentos\"\n        },\n        {\n          \"feedback\": \"Replicar o banco inteiro é exagero.\",\n          \"isCorrect\": false,\n          \"text\": \"Replicar todo banco de Pagamentos\"\n        }\n      ],\n      \"question\": \"Como dar visibilidade ao estado?\"\n    },\n    {\n      \"context\": \"{{NAME}}, temos um problema curioso: o read model tá ficando desatualizado às vezes. Parece que alguns eventos não chegam. O que você sugere verificar antes de culpar o broker?\",\n      \"options\": [\n        {\n          \"feedback\": \"Sim. Sem idempotência, eventos duplicados ou fora de ordem podem quebrar o modelo.\",\n          \"isCorrect\": true,\n          \"text\": \"Checar idempotência e ordenação no consumidor\"\n        },\n        {\n          \"feedback\": \"Logging ajuda, mas não resolve a inconsistência diretamente.\",\n          \"isCorrect\": false,\n          \"text\": \"Adicionar logs mais verbosos\"\n        },\n        {\n          \"feedback\": \"Escalar pode mascarar problema lógico.\",\n          \"isCorrect\": false,\n          \"text\": \"Escalar consumidores para mais instâncias\"\n        },\n        {\n          \"feedback\": \"Trocar de broker é extremo; entender causa vem antes.\",\n          \"isCorrect\": false,\n          \"text\": \"Migrar para outro broker\"\n        }\n      ],\n      \"question\": \"O que checar primeiro?\"\n    },\n    {\n      \"context\": \"Ok, mas olha isso: do nada, Pagamentos começou a enviar eventos duplicados com dados inconsistentes. O pessoal lá jurou que nada mudou. O que fazemos antes de apontar dedos?\",\n      \"options\": [\n        {\n          \"feedback\": \"Perfeito. Tracing entre serviços revela ordens, duplicações e timings.\",\n          \"isCorrect\": true,\n          \"text\": \"Investigar tracing distribuído do fluxo\"\n        },\n        {\n          \"feedback\": \"Logs fragmentados não mostram fluxo completo.\",\n          \"isCorrect\": false,\n          \"text\": \"Olhar só logs de Pagamentos\"\n        },\n        {\n          \"feedback\": \"Reprocessar não explica a origem do problema.\",\n          \"isCorrect\": false,\n          \"text\": \"Reprocessar tudo e torcer\"\n        },\n        {\n          \"feedback\": \"Atualizar versões pode introduzir novos riscos.\",\n          \"isCorrect\": false,\n          \"text\": \"Atualizar cliente do broker\"\n        }\n      ],\n      \"question\": \"Qual próximo passo?\"\n    },\n    {\n      \"context\": \"{{NAME}}... achamos o motivo no tracing: Pagamentos foi implantado duas vezes por engano e ambas as instâncias estavam emitindo eventos iguais. Plot twist total. Como consertamos isso sem travar o time inteiro?\",\n      \"options\": [\n        {\n          \"feedback\": \"Exatamente. Garantir que só uma instância publique evita duplicações.\",\n          \"isCorrect\": true,\n          \"text\": \"Usar lock ou particionamento para publicação única\"\n        },\n        {\n          \"feedback\": \"Eliminar eventos não corrige a causa raiz.\",\n          \"isCorrect\": false,\n          \"text\": \"Filtrar duplicados manualmente todo dia\"\n        },\n        {\n          \"feedback\": \"Desligar uma instância manualmente é gambiarra e frágil.\",\n          \"isCorrect\": false,\n          \"text\": \"Desligar a instância duplicada na mão\"\n        },\n        {\n          \"feedback\": \"Mudar API não resolve emissão duplicada.\",\n          \"isCorrect\": false,\n          \"text\": \"Alterar payload dos eventos\"\n        }\n      ],\n      \"question\": \"Como consertar o problema?\"\n    },\n    {\n      \"context\": \"Perfeito, {{NAME}}. Depois do ajuste, tudo está fluindo: circuit breaker segurando, eventos consistentes, read model alinhado e sem travamentos. Qual a principal lição que fica disso tudo?\",\n      \"options\": [\n        {\n          \"feedback\": \"Isso mesmo. Microserviços exigem resiliência, dados distribuídos e observabilidade forte. Sem isso, tudo vira caos.\",\n          \"isCorrect\": true,\n          \"text\": \"Resiliência + eventos + observabilidade são indispensáveis\"\n        },\n        {\n          \"feedback\": \"Arquitetura não se resume a dividir serviços.\",\n          \"isCorrect\": false,\n          \"text\": \"Microserviços resolvem tudo automaticamente\"\n        },\n        {\n          \"feedback\": \"Consistência total exige cuidados extras.\",\n          \"isCorrect\": false,\n          \"text\": \"Evitar assíncrono sempre que possível\"\n        },\n        {\n          \"feedback\": \"Não é sobre evitar mudanças, mas gerenciá-las.\",\n          \"isCorrect\": false,\n          \"text\": \"Lançar menos releases resolve\"\n        }\n      ],\n      \"question\": \"Qual lição final?\"\n    }\n  ]\n}",
      "outputTokens": 1855,
      "systemPrompt": "# Role\n\nYou are an expert interactive story designer creating a **Story** activity for a learning app. Your mission is to place learners in a first-person dialogue scenario where they work alongside a colleague to solve a real-world problem using the lesson's concepts.\n\nYou specialize in crafting immersive, dialogue-driven experiences that make learners feel like they're actually solving problems in their field — not just answering quiz questions.\n\n# The Art of Dialogue-Driven Learning\n\nA great Story activity doesn't lecture or test recall — it puts learners IN the situation. Think of it like an interactive movie where the learner IS the main character, making real decisions that matter.\n\n## Why Dialogue Scenarios Work\n\n1. **Authentic Context**: When learners apply concepts to solve realistic problems with a colleague, they see WHY the knowledge matters to them personally.\n\n2. **Active Reasoning**: Making decisions in context requires thinking through principles, not just recognizing memorized facts.\n\n3. **Emotional Investment**: Dialogue creates stakes. The learner cares about the outcome because they're part of the story.\n\n## The Collaborative Problem-Solving Principle\n\nEvery great Story activity creates a sense of partnership:\n\n- **Shared Goal**: You and your colleague are tackling something together\n- **Natural Dialogue**: Conversations feel like real workplace exchanges\n- **Meaningful Choices**: Each decision requires applying what you've learned\n- **Satisfying Resolution**: The problem gets solved and the takeaway sticks\n\n## Why Pure Dialogue Works\n\nEach scene should feel like you're eavesdropping on a real conversation — no narrator, no stage directions, just two people working through a problem. Pure dialogue:\n\n- Immerses learners completely in the scenario\n- Makes abstract concepts feel like lived experience\n- Creates natural pacing through back-and-forth exchange\n- Lets context emerge organically from what people say\n\n# Inputs\n\n- `LESSON_TITLE`: The topic to create a story around\n- `LESSON_DESCRIPTION`: Additional context about what this lesson covers\n- `CHAPTER_TITLE`: The chapter context (for understanding scope)\n- `COURSE_TITLE`: The course context (for understanding audience level)\n- `LANGUAGE`: Output language\n- `EXPLANATION_STEPS`: Array of {title, text} from all explanation activities (Background, Explanation, Mechanics, Examples) the learner completed before this one\n\n## Language Guidelines\n\n- `en`: Use US English unless the content is region-specific\n- `pt`: Use Brazilian Portuguese unless the content is region-specific\n- `es`: Use Latin American Spanish unless the content is region-specific\n\n# Requirements\n\n## Scene Structure\n\nEach scene must have:\n\n- **context**: Maximum 500 characters. Pure dialogue only — no narrator, no character name prefixes (like \"Sarah:\"), no descriptions. This is what your colleague says to you, setting up the decision point.\n- **question**: Maximum 100 characters. A short, clear question about what to do next.\n- **options**: Exactly 4 choices, each with:\n  - **text**: The answer choice (max 50 characters)\n  - **isCorrect**: Boolean indicating if this is the correct answer (exactly 1 must be true)\n  - **feedback**: Why this choice is right (with insight) or wrong (and what would be correct) — max 300 characters\n\n## Story Arc\n\nYour story must follow this structure:\n\n1. **Opening Scene**: Begin \"in the middle of the action\" — the learner and colleague are already working on something. No preamble or setup exposition.\n2. **Rising Complexity**: Each scene builds naturally from the previous dialogue. Decisions compound.\n3. **Plot Twist**: The second-to-last scene introduces an unexpected complication, surprise, or revelation.\n4. **Resolution**: The final scene resolves the problem AND reinforces the main learning takeaway.\n\n## Scene Count\n\n- Minimum: 7 scenes\n- Maximum: 20 scenes\n- Let the problem's complexity dictate the length. A simple concept might need 7-10 scenes; a complex one might need 15-20.\n\n## Tone & Style\n\n- **Pure dialogue**: NO narrator, NO character name prefixes, NO descriptions of actions or settings\n- **Natural conversation**: Write how colleagues actually talk on Slack when solving a problem together — casual, collaborative, sometimes humorous\n- **Professional but warm**: Light, smart humor when appropriate. Never forced or cheesy.\n- **Second-person immersion**: The colleague speaks TO the learner. Context emerges from what's said.\n- **Continuous flow**: Each scene's dialogue should naturally lead into the next\n\n## The {{NAME}} Placeholder\n\nUse `{{NAME}}` wherever the learner's name should appear in dialogue. For example:\n\n- \"{{NAME}}, I think we might have a problem here.\"\n- \"Good catch, {{NAME}}. That's exactly what I was thinking.\"\n\nThis personalizes the experience without requiring actual name input at content creation time.\n\n## Decision Design\n\nEvery decision must:\n\n- **Require reasoning**: Learners must apply principles from the lesson, not recall specific phrases\n- **Feel realistic**: These are choices someone might actually face in this situation\n- **Have plausible distractors**: Wrong options should be tempting but flawed for specific reasons\n- **Avoid \"obvious\" correct answers**: The right choice should require thought, not be the only non-silly option\n\n## What to Avoid\n\n- Narrator text (\"Meanwhile...\" or \"You walk into the office...\")\n- Character name prefixes (\"Sarah:\" or \"Your colleague says:\")\n- Description of actions or settings (except through dialogue itself)\n- Questions that test memorization of facts from earlier activities\n- Obvious \"correct\" answers that don't require applying the concept\n- Silly or clearly wrong distractors that no reasonable person would choose\n- Breaking the fourth wall or meta-commentary\n- Starting with \"In this activity...\" or setup exposition\n\n## Scope\n\n- **Stay focused**: The problem should specifically require THIS lesson's concept to solve\n- **Don't expand**: Other lessons cover related topics — this story tests this lesson\n- **Don't narrow**: If the lesson is broad, the problem should engage multiple aspects of it\n\n## Relationship to Previous Activities\n\nThe learner has already completed:\n\n- **Background**: WHY this exists (origin story, problems solved, historical context)\n- **Explanation**: WHAT it is (core concepts, components, definitions)\n- **Mechanics**: HOW it works (processes in action, cause-effect chains)\n- **Examples**: WHERE it appears (real-world contexts, applications)\n\nYour Story activity answers WHEN DO I USE THIS? (applying concepts to solve realistic problems). These complement each other:\n\n- Background: \"WHY did we need this?\"\n- Explanation: \"WHAT exactly is it?\"\n- Mechanics: \"HOW does it actually work?\"\n- Examples: \"WHERE will I encounter this?\"\n- Story: \"WHEN do I apply this to solve real problems?\"\n\nThe learner knows what the concept IS, how it WORKS, and where they'll SEE it. Now they practice USING it in a realistic scenario.\n\n# Structure Guide\n\nWhile every story is unique, most follow this arc (adapt as needed):\n\n1. **The Hook**: Jump straight into the situation. Something needs to be figured out or decided.\n2. **Initial Assessment**: What's the situation? What do we know? First decisions.\n3. **Deepening Complexity**: The problem has layers. Apply the concept more deeply.\n4. **Complications**: Things aren't as simple as they seemed. Adapt your approach.\n5. **The Twist**: A surprise, revelation, or unexpected turn that requires rethinking.\n6. **The Resolution**: Solve the problem AND crystallize the key insight from the lesson.\n\nNote: Sometimes the final twist can have a humorous or unexpected resolution that still reinforces the learning. Something that makes the learner smile and think \"I didn't see that coming!\"\n\n# Dialogue Tone Examples\n\nThe following examples show the **tone and style** to aim for — not complete scenes, just the kind of dialogue that makes stories feel alive. Adapt freely to your topic.\n\n## Opening Hooks (Jump Into the Action)\n\n> \"{{NAME}}, I've been staring at this bug for an hour. The shopping cart total keeps showing yesterday's prices. The database is fine. Something's wrong with how we're storing them.\"\n\n> \"Okay, {{NAME}}, the client just called. Their entire inventory system crashed right before Black Friday. They're panicking. We need to figure this out fast.\"\n\n> \"{{NAME}}, you're not going to believe this. Remember that algorithm we deployed last week? It's been recommending the exact opposite of what users want. Sales are tanking.\"\n\n## Building Tension (Problems Get Deeper)\n\n> \"Wait. If this pattern is everywhere in the codebase... inventory counts, user roles, discount percentages... we might have a much bigger problem than I thought.\"\n\n> \"Hold on. The logs show someone accessed the admin panel at 3 AM last night. But nobody on the team was working then. {{NAME}}, who else has those credentials?\"\n\n> \"The numbers don't add up. We're showing 500 successful transactions, but the bank only received 487. Where did the other 13 go?\"\n\n## Plot Twists (The Unexpected Turn)\n\n> \"{{NAME}}... I just ran the analysis twice. The bug isn't in our code. It's been in the library we've trusted for three years. Every project using it has this vulnerability.\"\n\n> \"I found the source of the data leak. {{NAME}}, it's not a hacker. It's our own caching system. We've been accidentally exposing user data to anyone who knew where to look.\"\n\n> \"Plot twist: the 'broken' feature? It's working exactly as designed. The original spec was just... completely wrong. We've been solving the wrong problem this whole time.\"\n\n## Humorous Moments (Light Relief)\n\n> \"Well, {{NAME}}, the good news is we found the bug. The bad news? It's been there since 2019. The worse news? I wrote it. The even worse news? So did you. We pair-programmed this disaster together.\"\n\n> \"Congratulations, {{NAME}}. We just spent four hours debugging what turned out to be a typo. 'userID' vs 'userId'. Camel case strikes again.\"\n\n> \"{{NAME}}, remember when I said 'this should be a quick fix'? That was three coffees and one existential crisis ago.\"\n\n## Satisfying Resolutions (Problem Solved + Insight Crystallized)\n\n> \"There it is. The fix works. {{NAME}}, I don't think I'll ever forget this — always check if your data source can change while you're holding onto a copy of it.\"\n\n> \"We did it. The system's stable. You know what the real lesson here was? Sometimes the simplest explanation IS the right one. We kept looking for complex bugs when the answer was right in front of us.\"\n\n> \"That's it — problem solved, client happy, crisis averted. {{NAME}}, I think we just learned more about distributed systems in the last hour than in any textbook.\"\n\n## Unexpected/Funny Endings\n\n> \"So after all that debugging... it was a timezone issue. Every single time. I'm starting to think all bugs are secretly timezone issues in disguise.\"\n\n> \"{{NAME}}, the CEO just called to thank us. Apparently fixing that 'minor bug' saved them $2 million. I think we need to renegotiate our rates.\"\n\n> \"The system's fixed. Also, I may have accidentally discovered that our competitor's product has the exact same bug. Should we... tell them? Actually, don't answer that.\"\n\nRemember: These are just **tone examples**. Your story should be original, fit the lesson topic, and create its own memorable journey. Mix problem-solving tension with moments of humor or surprise. The best stories make learners think \"I didn't see that coming!\" while still teaching the concept.\n\n# Quality Checks\n\nBefore finalizing, verify:\n\n- [ ] Is the dialogue pure conversation with NO narrator, NO character prefixes, NO descriptions?\n- [ ] Does every scene flow naturally from the previous one (continuous story)?\n- [ ] Do all decisions require applying lesson concepts, not just recalling facts?\n- [ ] Is there a genuine plot twist in the second-to-last scene?\n- [ ] Does the resolution both solve the problem AND reinforce the main learning?\n- [ ] Is `{{NAME}}` used appropriately to personalize the dialogue?\n- [ ] Are all distractors plausible (not obviously silly)?\n- [ ] Does the story feel like a real workplace conversation, not a quiz in disguise?\n- [ ] Is the scope exactly the lesson topic — not broader or narrower?\n- [ ] Are all constraints met (context ≤500 chars, question ≤100 chars, options ≤50 chars each, feedback ≤300 chars each)?\n- [ ] Is the scene count between 7 and 20?\n\n# Output Format\n\nReturn an array of scenes, each with:\n\n- **context**: Pure dialogue from colleague (max 500 chars)\n- **question**: Decision prompt (max 100 chars)\n- **options**: Array of exactly 4 objects, each with:\n  - **text**: The answer choice (max 50 chars)\n  - **isCorrect**: Boolean (exactly 1 must be true, 3 must be false)\n  - **feedback**: Why right or wrong (max 300 chars)\n\nUse 7-20 scenes to tell a complete, engaging story. Let the problem's complexity dictate the length.\n",
      "testCaseId": "pt-cs-microservices-architecture-1",
      "userPrompt": "LESSON_TITLE: Microservicos na Pratica\nLESSON_DESCRIPTION: Projetando e implementando arquiteturas de microservicos com consciencia dos trade-offs\nCHAPTER_TITLE: Arquitetura de Software\nCOURSE_TITLE: Engenharia de Software Avancada\nLANGUAGE: pt\nEXPLANATION_STEPS:\n1. Definicao de Microservicos: Microservicos sao servicos pequenos e independentes que fazem uma coisa bem. Cada um pode ser desenvolvido, implantado e escalado separadamente.\n2. Limites de Servico: Limites de servico devem seguir dominios de negocio, nao camadas tecnicas. Um servico de 'Pedidos' faz sentido; um servico de 'Banco de Dados' nao.\n3. Comunicacao: A comunicacao entre servicos pode ser sincrona (REST, gRPC) ou assincrona (filas, eventos). Assincrona e mais resiliente mas mais complexa de debugar.\n4. Dados Descentralizados: Dados descentralizados significam que cada servico tem seu banco. Consistencia eventual e a realidade — transacoes distribuidas sao dificeis e devem ser evitadas.\n5. Resiliencia: Falhas em cascata acontecem quando um servico lento trava outros. Circuit breakers, timeouts e fallbacks sao essenciais para resiliencia.\n6. Observabilidade: Observabilidade requer logs centralizados, metricas e tracing distribuido. Sem isso, debugar problemas em producao e quase impossivel."
    },
    {
      "duration": 27474.26016600005,
      "inputTokens": 3171,
      "output": "{\n  \"steps\": [\n    {\n      \"context\": \"{{NAME}}, el gerente nos pidió optimizar el costo de producción del nuevo componente. Ya armé la función de costo, pero necesitamos confirmar dónde está el mínimo real. Tengo un punto crítico en x=4, pero no estoy seguro si es mínimo o máximo.\",\n      \"options\": [\n        {\n          \"feedback\": \"Correcto. La segunda derivada indica si el punto crítico es mínimo o máximo, clave antes de decidir.\",\n          \"isCorrect\": true,\n          \"text\": \"Revisemos la segunda derivada en x=4\"\n        },\n        {\n          \"feedback\": \"Solo ver la derivada no clasifica el tipo de extremo; falta análisis.\",\n          \"isCorrect\": false,\n          \"text\": \"Mejor revisemos solo la derivada otra vez\"\n        },\n        {\n          \"feedback\": \"Un gráfico ayuda, pero no sustituye la prueba de la segunda derivada.\",\n          \"isCorrect\": false,\n          \"text\": \"Hagamos solo una gráfica rápida\"\n        },\n        {\n          \"feedback\": \"Adivinar ignora los métodos formales de optimización.\",\n          \"isCorrect\": false,\n          \"text\": \"Probemos asumir que es un mínimo y sigamos\"\n        }\n      ],\n      \"question\": \"¿Cómo verificamos el tipo de punto crítico?\"\n    },\n    {\n      \"context\": \"Ok, {{NAME}}, la segunda derivada salió positiva en x=4. Parece un mínimo local sólido. Pero la función está definida solo entre x=0 y x=10. ¿Te parece suficiente evaluar este punto?\",\n      \"options\": [\n        {\n          \"feedback\": \"Correcto. Los extremos globales pueden estar en puntos críticos o en bordes.\",\n          \"isCorrect\": true,\n          \"text\": \"También evaluemos los extremos del dominio\"\n        },\n        {\n          \"feedback\": \"Ignorar bordes puede perder el verdadero mínimo global.\",\n          \"isCorrect\": false,\n          \"text\": \"No, el mínimo local ya es suficiente\"\n        },\n        {\n          \"feedback\": \"Explorar fuera del dominio no es válido para este problema.\",\n          \"isCorrect\": false,\n          \"text\": \"Sí, probemos evaluar fuera de [0,10]\"\n        },\n        {\n          \"feedback\": \"Asumir más puntos sin análisis añade complejidad sin base.\",\n          \"isCorrect\": false,\n          \"text\": \"Tal vez hay otro punto crítico escondido\"\n        }\n      ],\n      \"question\": \"¿Qué hacemos ahora?\"\n    },\n    {\n      \"context\": \"Perfecto, {{NAME}}. Evalué el costo en x=0 y x=10. El de x=10 es más bajo que en x=4. Parece que el mínimo global está en el borde. ¿Confirmamos el modelo antes de reportar?\",\n      \"options\": [\n        {\n          \"feedback\": \"Correcto. Asegurar que la función objetivo represente bien el problema evita falsas conclusiones.\",\n          \"isCorrect\": true,\n          \"text\": \"Sí, revisemos que el modelo esté bien planteado\"\n        },\n        {\n          \"feedback\": \"Confiarse sin validar el modelo puede generar errores en decisiones de ingeniería.\",\n          \"isCorrect\": false,\n          \"text\": \"No, el modelo debe estar bien porque sí\"\n        },\n        {\n          \"feedback\": \"Cambiar el modelo sin razón no es eficiente.\",\n          \"isCorrect\": false,\n          \"text\": \"Quizá rehagamos toda la función desde cero\"\n        },\n        {\n          \"feedback\": \"Revisar notas no valida restricciones ni supuestos.\",\n          \"isCorrect\": false,\n          \"text\": \"Leamos mis apuntes de nuevo y ya\"\n        }\n      ],\n      \"question\": \"¿Validamos el modelo?\"\n    },\n    {\n      \"context\": \"{{NAME}}, revisando la restricción de materiales, vi que en realidad debemos usar x+y=12 como límite. Esto ya es optimización con dos variables. ¿Cómo procedemos?\",\n      \"options\": [\n        {\n          \"feedback\": \"Correcto. Lagrange permite manejar restricciones de igualdad de manera sistemática.\",\n          \"isCorrect\": true,\n          \"text\": \"Usemos multiplicadores de Lagrange\"\n        },\n        {\n          \"feedback\": \"Asignar valores sin método puede llevar a soluciones no óptimas.\",\n          \"isCorrect\": false,\n          \"text\": \"Probemos valores al azar que cumplan x+y=12\"\n        },\n        {\n          \"feedback\": \"Si eliminamos la restricción, violamos el problema real.\",\n          \"isCorrect\": false,\n          \"text\": \"Ignoremos la restricción y optimicemos libremente\"\n        },\n        {\n          \"feedback\": \"La gráfica 3D no sustituye el método formal.\",\n          \"isCorrect\": false,\n          \"text\": \"Hagamos solo una gráfica y decidamos\"\n        }\n      ],\n      \"question\": \"¿Qué técnica aplicamos?\"\n    },\n    {\n      \"context\": \"Genial, {{NAME}}. Al armar las ecuaciones de Lagrange, me salen dos puntos candidatos. Pero uno de ellos hace que el costo sea negativo, lo cual no tiene sentido físico. ¿Cuál analizamos?\",\n      \"options\": [\n        {\n          \"feedback\": \"Correcto. En optimización aplicada, descartar soluciones no factibles es esencial.\",\n          \"isCorrect\": true,\n          \"text\": \"El que produzca un costo físicamente posible\"\n        },\n        {\n          \"feedback\": \"Una solución matemática inválida no puede ser óptima.\",\n          \"isCorrect\": false,\n          \"text\": \"El negativo, por si acaso funciona\"\n        },\n        {\n          \"feedback\": \"No tiene sentido analizar ambos si uno es imposible.\",\n          \"isCorrect\": false,\n          \"text\": \"Analicemos ambos igual\"\n        },\n        {\n          \"feedback\": \"Adivinar ignora criterios de factibilidad.\",\n          \"isCorrect\": false,\n          \"text\": \"Elijamos el que te parezca mejor\"\n        }\n      ],\n      \"question\": \"¿Cuál punto analizamos?\"\n    },\n    {\n      \"context\": \"{{NAME}}, procesé el punto factible y salió un costo razonable. Pero justo llegó un correo: cambiaron la restricción a x+2y=15. Nada que ver con lo anterior. ¿Qué hacemos?\",\n      \"options\": [\n        {\n          \"feedback\": \"Correcto. Cambiar la restricción obliga a reconstruir el sistema de Lagrange.\",\n          \"isCorrect\": true,\n          \"text\": \"Replanteamos todo el sistema con la nueva restricción\"\n        },\n        {\n          \"feedback\": \"Reusar ecuaciones viejas genera soluciones inválidas.\",\n          \"isCorrect\": false,\n          \"text\": \"Ajustemos un poco las ecuaciones anteriores\"\n        },\n        {\n          \"feedback\": \"Probar valores sin método es ineficiente.\",\n          \"isCorrect\": false,\n          \"text\": \"Probemos números hasta que salga algo razonable\"\n        },\n        {\n          \"feedback\": \"Ignorar la nueva restricción invalida el problema.\",\n          \"isCorrect\": false,\n          \"text\": \"Sigamos con la restricción antigua\"\n        }\n      ],\n      \"question\": \"¿Cómo procedemos?\"\n    },\n    {\n      \"context\": \"Listo, {{NAME}}. Tengo la nueva solución óptima. Pero ahora el gerente pregunta por qué confiamos en que este es el mínimo global. Quiere una explicación clara y corta. ¿Cómo respondemos?\",\n      \"options\": [\n        {\n          \"feedback\": \"Correcto. Resume los pasos esenciales y demuestra rigor sin exceso.\",\n          \"isCorrect\": true,\n          \"text\": \"Explicamos puntos críticos, bordes y Lagrange brevemente\"\n        },\n        {\n          \"feedback\": \"Muy vago; no muestra método ni rigor.\",\n          \"isCorrect\": false,\n          \"text\": \"Decimos que la matemática lo garantiza y ya\"\n        },\n        {\n          \"feedback\": \"Mucho detalle técnico puede confundir.\",\n          \"isCorrect\": false,\n          \"text\": \"Le explicamos todas las derivadas paso a paso\"\n        },\n        {\n          \"feedback\": \"Revisar solo bordes ignora el análisis completo.\",\n          \"isCorrect\": false,\n          \"text\": \"Decimos que solo revisamos los extremos\"\n        }\n      ],\n      \"question\": \"¿Qué le decimos al gerente?\"\n    },\n    {\n      \"context\": \"Excelente, {{NAME}}. Uh… espera. El gerente acaba de reenviar un archivo donde dice que la función de costo tenía un error: era f(x,y)=x²+3y², no x²+y². Eso cambia todo. ¿Lo ajustamos rápido?\",\n      \"options\": [\n        {\n          \"feedback\": \"Correcto. Modificar la función objetivo y rehacer el proceso garantiza una solución válida.\",\n          \"isCorrect\": true,\n          \"text\": \"Sí, actualizamos la función y repetimos el análisis\"\n        },\n        {\n          \"feedback\": \"No corregir la función arruina toda la optimización.\",\n          \"isCorrect\": false,\n          \"text\": \"Sigamos con la función vieja, total es parecido\"\n        },\n        {\n          \"feedback\": \"Ignorar la restricción rompe el problema.\",\n          \"isCorrect\": false,\n          \"text\": \"Ahora optimicemos sin restricciones\"\n        },\n        {\n          \"feedback\": \"Asumir que el cambio no afecta es incorrecto.\",\n          \"isCorrect\": false,\n          \"text\": \"Seguro no cambia nada, sigamos igual\"\n        }\n      ],\n      \"question\": \"¿Qué hacemos con esta corrección?\"\n    }\n  ]\n}",
      "outputTokens": 1569,
      "systemPrompt": "# Role\n\nYou are an expert interactive story designer creating a **Story** activity for a learning app. Your mission is to place learners in a first-person dialogue scenario where they work alongside a colleague to solve a real-world problem using the lesson's concepts.\n\nYou specialize in crafting immersive, dialogue-driven experiences that make learners feel like they're actually solving problems in their field — not just answering quiz questions.\n\n# The Art of Dialogue-Driven Learning\n\nA great Story activity doesn't lecture or test recall — it puts learners IN the situation. Think of it like an interactive movie where the learner IS the main character, making real decisions that matter.\n\n## Why Dialogue Scenarios Work\n\n1. **Authentic Context**: When learners apply concepts to solve realistic problems with a colleague, they see WHY the knowledge matters to them personally.\n\n2. **Active Reasoning**: Making decisions in context requires thinking through principles, not just recognizing memorized facts.\n\n3. **Emotional Investment**: Dialogue creates stakes. The learner cares about the outcome because they're part of the story.\n\n## The Collaborative Problem-Solving Principle\n\nEvery great Story activity creates a sense of partnership:\n\n- **Shared Goal**: You and your colleague are tackling something together\n- **Natural Dialogue**: Conversations feel like real workplace exchanges\n- **Meaningful Choices**: Each decision requires applying what you've learned\n- **Satisfying Resolution**: The problem gets solved and the takeaway sticks\n\n## Why Pure Dialogue Works\n\nEach scene should feel like you're eavesdropping on a real conversation — no narrator, no stage directions, just two people working through a problem. Pure dialogue:\n\n- Immerses learners completely in the scenario\n- Makes abstract concepts feel like lived experience\n- Creates natural pacing through back-and-forth exchange\n- Lets context emerge organically from what people say\n\n# Inputs\n\n- `LESSON_TITLE`: The topic to create a story around\n- `LESSON_DESCRIPTION`: Additional context about what this lesson covers\n- `CHAPTER_TITLE`: The chapter context (for understanding scope)\n- `COURSE_TITLE`: The course context (for understanding audience level)\n- `LANGUAGE`: Output language\n- `EXPLANATION_STEPS`: Array of {title, text} from all explanation activities (Background, Explanation, Mechanics, Examples) the learner completed before this one\n\n## Language Guidelines\n\n- `en`: Use US English unless the content is region-specific\n- `pt`: Use Brazilian Portuguese unless the content is region-specific\n- `es`: Use Latin American Spanish unless the content is region-specific\n\n# Requirements\n\n## Scene Structure\n\nEach scene must have:\n\n- **context**: Maximum 500 characters. Pure dialogue only — no narrator, no character name prefixes (like \"Sarah:\"), no descriptions. This is what your colleague says to you, setting up the decision point.\n- **question**: Maximum 100 characters. A short, clear question about what to do next.\n- **options**: Exactly 4 choices, each with:\n  - **text**: The answer choice (max 50 characters)\n  - **isCorrect**: Boolean indicating if this is the correct answer (exactly 1 must be true)\n  - **feedback**: Why this choice is right (with insight) or wrong (and what would be correct) — max 300 characters\n\n## Story Arc\n\nYour story must follow this structure:\n\n1. **Opening Scene**: Begin \"in the middle of the action\" — the learner and colleague are already working on something. No preamble or setup exposition.\n2. **Rising Complexity**: Each scene builds naturally from the previous dialogue. Decisions compound.\n3. **Plot Twist**: The second-to-last scene introduces an unexpected complication, surprise, or revelation.\n4. **Resolution**: The final scene resolves the problem AND reinforces the main learning takeaway.\n\n## Scene Count\n\n- Minimum: 7 scenes\n- Maximum: 20 scenes\n- Let the problem's complexity dictate the length. A simple concept might need 7-10 scenes; a complex one might need 15-20.\n\n## Tone & Style\n\n- **Pure dialogue**: NO narrator, NO character name prefixes, NO descriptions of actions or settings\n- **Natural conversation**: Write how colleagues actually talk on Slack when solving a problem together — casual, collaborative, sometimes humorous\n- **Professional but warm**: Light, smart humor when appropriate. Never forced or cheesy.\n- **Second-person immersion**: The colleague speaks TO the learner. Context emerges from what's said.\n- **Continuous flow**: Each scene's dialogue should naturally lead into the next\n\n## The {{NAME}} Placeholder\n\nUse `{{NAME}}` wherever the learner's name should appear in dialogue. For example:\n\n- \"{{NAME}}, I think we might have a problem here.\"\n- \"Good catch, {{NAME}}. That's exactly what I was thinking.\"\n\nThis personalizes the experience without requiring actual name input at content creation time.\n\n## Decision Design\n\nEvery decision must:\n\n- **Require reasoning**: Learners must apply principles from the lesson, not recall specific phrases\n- **Feel realistic**: These are choices someone might actually face in this situation\n- **Have plausible distractors**: Wrong options should be tempting but flawed for specific reasons\n- **Avoid \"obvious\" correct answers**: The right choice should require thought, not be the only non-silly option\n\n## What to Avoid\n\n- Narrator text (\"Meanwhile...\" or \"You walk into the office...\")\n- Character name prefixes (\"Sarah:\" or \"Your colleague says:\")\n- Description of actions or settings (except through dialogue itself)\n- Questions that test memorization of facts from earlier activities\n- Obvious \"correct\" answers that don't require applying the concept\n- Silly or clearly wrong distractors that no reasonable person would choose\n- Breaking the fourth wall or meta-commentary\n- Starting with \"In this activity...\" or setup exposition\n\n## Scope\n\n- **Stay focused**: The problem should specifically require THIS lesson's concept to solve\n- **Don't expand**: Other lessons cover related topics — this story tests this lesson\n- **Don't narrow**: If the lesson is broad, the problem should engage multiple aspects of it\n\n## Relationship to Previous Activities\n\nThe learner has already completed:\n\n- **Background**: WHY this exists (origin story, problems solved, historical context)\n- **Explanation**: WHAT it is (core concepts, components, definitions)\n- **Mechanics**: HOW it works (processes in action, cause-effect chains)\n- **Examples**: WHERE it appears (real-world contexts, applications)\n\nYour Story activity answers WHEN DO I USE THIS? (applying concepts to solve realistic problems). These complement each other:\n\n- Background: \"WHY did we need this?\"\n- Explanation: \"WHAT exactly is it?\"\n- Mechanics: \"HOW does it actually work?\"\n- Examples: \"WHERE will I encounter this?\"\n- Story: \"WHEN do I apply this to solve real problems?\"\n\nThe learner knows what the concept IS, how it WORKS, and where they'll SEE it. Now they practice USING it in a realistic scenario.\n\n# Structure Guide\n\nWhile every story is unique, most follow this arc (adapt as needed):\n\n1. **The Hook**: Jump straight into the situation. Something needs to be figured out or decided.\n2. **Initial Assessment**: What's the situation? What do we know? First decisions.\n3. **Deepening Complexity**: The problem has layers. Apply the concept more deeply.\n4. **Complications**: Things aren't as simple as they seemed. Adapt your approach.\n5. **The Twist**: A surprise, revelation, or unexpected turn that requires rethinking.\n6. **The Resolution**: Solve the problem AND crystallize the key insight from the lesson.\n\nNote: Sometimes the final twist can have a humorous or unexpected resolution that still reinforces the learning. Something that makes the learner smile and think \"I didn't see that coming!\"\n\n# Dialogue Tone Examples\n\nThe following examples show the **tone and style** to aim for — not complete scenes, just the kind of dialogue that makes stories feel alive. Adapt freely to your topic.\n\n## Opening Hooks (Jump Into the Action)\n\n> \"{{NAME}}, I've been staring at this bug for an hour. The shopping cart total keeps showing yesterday's prices. The database is fine. Something's wrong with how we're storing them.\"\n\n> \"Okay, {{NAME}}, the client just called. Their entire inventory system crashed right before Black Friday. They're panicking. We need to figure this out fast.\"\n\n> \"{{NAME}}, you're not going to believe this. Remember that algorithm we deployed last week? It's been recommending the exact opposite of what users want. Sales are tanking.\"\n\n## Building Tension (Problems Get Deeper)\n\n> \"Wait. If this pattern is everywhere in the codebase... inventory counts, user roles, discount percentages... we might have a much bigger problem than I thought.\"\n\n> \"Hold on. The logs show someone accessed the admin panel at 3 AM last night. But nobody on the team was working then. {{NAME}}, who else has those credentials?\"\n\n> \"The numbers don't add up. We're showing 500 successful transactions, but the bank only received 487. Where did the other 13 go?\"\n\n## Plot Twists (The Unexpected Turn)\n\n> \"{{NAME}}... I just ran the analysis twice. The bug isn't in our code. It's been in the library we've trusted for three years. Every project using it has this vulnerability.\"\n\n> \"I found the source of the data leak. {{NAME}}, it's not a hacker. It's our own caching system. We've been accidentally exposing user data to anyone who knew where to look.\"\n\n> \"Plot twist: the 'broken' feature? It's working exactly as designed. The original spec was just... completely wrong. We've been solving the wrong problem this whole time.\"\n\n## Humorous Moments (Light Relief)\n\n> \"Well, {{NAME}}, the good news is we found the bug. The bad news? It's been there since 2019. The worse news? I wrote it. The even worse news? So did you. We pair-programmed this disaster together.\"\n\n> \"Congratulations, {{NAME}}. We just spent four hours debugging what turned out to be a typo. 'userID' vs 'userId'. Camel case strikes again.\"\n\n> \"{{NAME}}, remember when I said 'this should be a quick fix'? That was three coffees and one existential crisis ago.\"\n\n## Satisfying Resolutions (Problem Solved + Insight Crystallized)\n\n> \"There it is. The fix works. {{NAME}}, I don't think I'll ever forget this — always check if your data source can change while you're holding onto a copy of it.\"\n\n> \"We did it. The system's stable. You know what the real lesson here was? Sometimes the simplest explanation IS the right one. We kept looking for complex bugs when the answer was right in front of us.\"\n\n> \"That's it — problem solved, client happy, crisis averted. {{NAME}}, I think we just learned more about distributed systems in the last hour than in any textbook.\"\n\n## Unexpected/Funny Endings\n\n> \"So after all that debugging... it was a timezone issue. Every single time. I'm starting to think all bugs are secretly timezone issues in disguise.\"\n\n> \"{{NAME}}, the CEO just called to thank us. Apparently fixing that 'minor bug' saved them $2 million. I think we need to renegotiate our rates.\"\n\n> \"The system's fixed. Also, I may have accidentally discovered that our competitor's product has the exact same bug. Should we... tell them? Actually, don't answer that.\"\n\nRemember: These are just **tone examples**. Your story should be original, fit the lesson topic, and create its own memorable journey. Mix problem-solving tension with moments of humor or surprise. The best stories make learners think \"I didn't see that coming!\" while still teaching the concept.\n\n# Quality Checks\n\nBefore finalizing, verify:\n\n- [ ] Is the dialogue pure conversation with NO narrator, NO character prefixes, NO descriptions?\n- [ ] Does every scene flow naturally from the previous one (continuous story)?\n- [ ] Do all decisions require applying lesson concepts, not just recalling facts?\n- [ ] Is there a genuine plot twist in the second-to-last scene?\n- [ ] Does the resolution both solve the problem AND reinforce the main learning?\n- [ ] Is `{{NAME}}` used appropriately to personalize the dialogue?\n- [ ] Are all distractors plausible (not obviously silly)?\n- [ ] Does the story feel like a real workplace conversation, not a quiz in disguise?\n- [ ] Is the scope exactly the lesson topic — not broader or narrower?\n- [ ] Are all constraints met (context ≤500 chars, question ≤100 chars, options ≤50 chars each, feedback ≤300 chars each)?\n- [ ] Is the scene count between 7 and 20?\n\n# Output Format\n\nReturn an array of scenes, each with:\n\n- **context**: Pure dialogue from colleague (max 500 chars)\n- **question**: Decision prompt (max 100 chars)\n- **options**: Array of exactly 4 objects, each with:\n  - **text**: The answer choice (max 50 chars)\n  - **isCorrect**: Boolean (exactly 1 must be true, 3 must be false)\n  - **feedback**: Why right or wrong (max 300 chars)\n\nUse 7-20 scenes to tell a complete, engaging story. Let the problem's complexity dictate the length.\n",
      "testCaseId": "es-math-calculus-optimization-1",
      "userPrompt": "LESSON_TITLE: Optimizacion con Calculo\nLESSON_DESCRIPTION: Aplicando tecnicas de calculo para encontrar optimos en problemas de ingenieria y negocios\nCHAPTER_TITLE: Aplicaciones del Calculo\nCOURSE_TITLE: Calculo para Ingenieria\nLANGUAGE: es\nEXPLANATION_STEPS:\n1. Puntos Criticos: Los puntos criticos son donde la derivada es cero o no existe. Son CANDIDATOS a extremos — no todos los puntos criticos son maximos o minimos.\n2. Prueba de Segunda Derivada: La prueba de la segunda derivada determina el tipo: si f''(x) > 0 en un punto critico, es minimo local; si f''(x) < 0, es maximo local; si f''(x) = 0, la prueba no concluye.\n3. Extremos Globales: Los extremos globales pueden estar en puntos criticos O en los extremos del dominio. Siempre evalua tambien los bordes del intervalo.\n4. Multiplicadores de Lagrange: Optimizacion con restricciones usa multiplicadores de Lagrange. Maximizar f(x,y) sujeto a g(x,y)=0 requiere que los gradientes sean paralelos.\n5. Modelado del Problema: Modelar el problema correctamente es la mitad del trabajo. Define la funcion objetivo, identifica las restricciones, y expresa todo en terminos de las variables relevantes."
    }
  ],
  "taskId": "activity-story"
}
