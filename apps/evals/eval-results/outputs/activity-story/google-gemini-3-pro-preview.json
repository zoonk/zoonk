{
  "generatedAt": "2026-01-17T15:45:53.434Z",
  "modelId": "google/gemini-3-pro-preview",
  "outputs": [
    {
      "duration": 57087.59924999997,
      "inputTokens": 3254,
      "output": "{\n  \"steps\": [\n    {\n      \"context\": \"{{NAME}}, wake up! The dashboard is lighting up like a Christmas tree. We're getting thousands of `TypeError: Cannot read properties of undefined` in the checkout flow. It looks like the new discount feature we shipped yesterday is crashing whenever a user doesn't have a coupon code. Where do we even start looking?\",\n      \"options\": [\n        {\n          \"feedback\": \"Disabling the linter hides the warning but doesn't fix the crash. We need to find the root cause in the type definitions.\",\n          \"isCorrect\": false,\n          \"text\": \"Disable the linter rule for that file.\"\n        },\n        {\n          \"feedback\": \"Correct. The stack trace points to runtime errors, but TypeScript should have caught this. We likely have loose types disabling the safety net.\",\n          \"isCorrect\": true,\n          \"text\": \"Check where we're using 'any' in the checkout.\"\n        },\n        {\n          \"feedback\": \"Restarting might clear a memory leak, but it won't fix a logic error in the code caused by bad typing.\",\n          \"isCorrect\": false,\n          \"text\": \"Restart the server and hope it clears the cache.\"\n        },\n        {\n          \"feedback\": \"Adding a try-catch blocks the crash but masks the bug. We need to use TypeScript to prevent the error from existing in the first place.\",\n          \"isCorrect\": false,\n          \"text\": \"Wrap the whole function in a try-catch block.\"\n        }\n      ],\n      \"question\": \"What is our first move to debug this?\"\n    },\n    {\n      \"context\": \"Good call. I found the culprit. Look at this function signature: `applyDiscount(cart: any, code: any)`. It's the Wild West in here! The compiler has no idea what `cart` looks like, so it lets us access properties that don't exist. We need to stop using `any` immediately. How should we redefine `cart`?\",\n      \"options\": [\n        {\n          \"feedback\": \"This is just 'any' with extra steps. It doesn't provide any type safety or autocomplete benefits.\",\n          \"isCorrect\": false,\n          \"text\": \"Change it to 'cart: Object'.\"\n        },\n        {\n          \"feedback\": \"Exactly. Defining an interface gives TypeScript the 'shape' of the data so it can validate access at compile time.\",\n          \"isCorrect\": true,\n          \"text\": \"Define an interface describing the cart's shape.\"\n        },\n        {\n          \"feedback\": \"'unknown' is safer than 'any', but we can't access ANY properties on it without checking them first. We know the shape, so let's define it.\",\n          \"isCorrect\": false,\n          \"text\": \"Change it to 'cart: unknown'.\"\n        },\n        {\n          \"feedback\": \"We shouldn't rely on runtime checks alone. We want TypeScript to tell us if we make a mistake while writing code.\",\n          \"isCorrect\": false,\n          \"text\": \"Keep 'any' but add a comment explaining the fields.\"\n        }\n      ],\n      \"question\": \"How do we enforce structure on the `cart` parameter?\"\n    },\n    {\n      \"context\": \"Okay, I've created the interface `ICart`. Now TypeScript is yelling at me in the `calculateTotal` function. It says `Object is possibly undefined` on `cart.discount.amount`. It turns out not every cart HAS a discount object, but our code assumes it does. How do we fix this safely?\",\n      \"options\": [\n        {\n          \"feedback\": \"The bang operator (!) forces TypeScript to ignore the null possibility. If it really is missing at runtime, we'll crash again.\",\n          \"isCorrect\": false,\n          \"text\": \"Use the non-null assertion operator (cart.discount!).\"\n        },\n        {\n          \"feedback\": \"Spot on. This is type narrowing. By checking if it exists, TypeScript knows inside the 'if' block that 'discount' is safe to access.\",\n          \"isCorrect\": true,\n          \"text\": \"Wrap the math in an 'if (cart.discount)' check.\"\n        },\n        {\n          \"feedback\": \"This silences the error but defeats the purpose of TypeScript. We want to handle the missing data, not ignore the type system.\",\n          \"isCorrect\": false,\n          \"text\": \"Cast it as 'any' just for that line.\"\n        },\n        {\n          \"feedback\": \"This fixes the type error but gives everyone a free discount of 0, which might mess up our analytics. Narrowing is safer.\",\n          \"isCorrect\": false,\n          \"text\": \"Initialize discount to 0 if it's missing.\"\n        }\n      ],\n      \"question\": \"The compiler found a potential crash! What's the fix?\"\n    },\n    {\n      \"context\": \"Nice catch. The logic is safe now. But we have another issue. The discount codes come from a third-party API. The response is just JSON. Currently, we're doing `const response = await api.get() as any`. I feel like I'm walking into a trap. If the API changes its format, we won't know until we crash in production again.\",\n      \"options\": [\n        {\n          \"feedback\": \"Precisely. 'Unknown' forces us to perform checks before using the data, whereas 'any' assumes we know what we're doing (even when we don't).\",\n          \"isCorrect\": true,\n          \"text\": \"Type the response as 'unknown' instead of 'any'.\"\n        },\n        {\n          \"feedback\": \"Assuming the API always matches our interface is risky. If the API changes, our interface lies to us and we crash at runtime.\",\n          \"isCorrect\": false,\n          \"text\": \"Cast it directly to our 'DiscountResponse' interface.\"\n        },\n        {\n          \"feedback\": \"Generic types are great, but 'any' inside a generic is still just 'any'. It doesn't add safety.\",\n          \"isCorrect\": false,\n          \"text\": \"Use a generic 'Promise<any>'.\"\n        },\n        {\n          \"feedback\": \"We can't ignore the return type. We need to handle the data coming back.\",\n          \"isCorrect\": false,\n          \"text\": \"Ignore the return type entirely.\"\n        }\n      ],\n      \"question\": \"What's the safest type for untrusted external data?\"\n    },\n    {\n      \"context\": \"Okay, {{NAME}}, I changed it to `unknown`. Now the compiler is red everywhere because I can't access `response.code` or `response.value`. It's `unknown`, so TypeScript forbids reading properties. How do we tell TypeScript, 'Trust me, I checked, this IS a valid DiscountResponse' without reverting to `any`?\",\n      \"options\": [\n        {\n          \"feedback\": \"This is a dangerous runtime cast. It tells TypeScript to shut up, but doesn't actually check the data structure.\",\n          \"isCorrect\": false,\n          \"text\": \"Use 'as DiscountResponse' to force the type.\"\n        },\n        {\n          \"feedback\": \"'typeof' only tells us it's an 'object'. It doesn't tell us if it has the specific fields 'code' and 'value' that we need.\",\n          \"isCorrect\": false,\n          \"text\": \"Just check 'typeof response === \\\"object\\\"'.\"\n        },\n        {\n          \"feedback\": \"Perfect. A User-Defined Type Guard is a function that performs a runtime check and returns a type predicate (`arg is Type`), narrowing the type safely.\",\n          \"isCorrect\": true,\n          \"text\": \"Write a custom Type Guard function.\"\n        },\n        {\n          \"feedback\": \"Trying to access properties on 'unknown' will cause a compile error. That's the problem we're trying to solve.\",\n          \"isCorrect\": false,\n          \"text\": \"Access the properties inside a try-catch block.\"\n        }\n      ],\n      \"question\": \"We need to safely convert 'unknown' to our type. How?\"\n    },\n    {\n      \"context\": \"The Type Guard is working beautifully! `function isDiscount(arg: unknown): arg is DiscountResponse`. But... we also need to validate `UserResponse` and `ProductResponse` from the same API. I really don't want to copy-paste this validation logic three times. Can we make a reusable utility for this?\",\n      \"options\": [\n        {\n          \"feedback\": \"Union types allow multiple types, but we want a reusable structure where we can plug in ANY type definition.\",\n          \"isCorrect\": false,\n          \"text\": \"Use a Union type: User | Product | Discount.\"\n        },\n        {\n          \"feedback\": \"Exactly. By using a Generic `<T>`, we can write one validator function that works for User, Product, or Discount, preserving the specific type info.\",\n          \"isCorrect\": true,\n          \"text\": \"Use a Generic type for the validator function.\"\n        },\n        {\n          \"feedback\": \"Enums are for sets of named constants, not for defining flexible data structures or function signatures.\",\n          \"isCorrect\": false,\n          \"text\": \"Create an Enum for the response types.\"\n        },\n        {\n          \"feedback\": \"Back to 'any'? No way. That undoes all the safety work we just did.\",\n          \"isCorrect\": false,\n          \"text\": \"Just accept 'any' for the other responses.\"\n        }\n      ],\n      \"question\": \"How do we write code that works with multiple types safely?\"\n    },\n    {\n      \"context\": \"We are on a roll. The code is clean, typed, and compiling. But... {{NAME}}, look at this logs. We just processed a `Refund` request as a `Payment`. The system didn't throw an error! I checked the types: `Refund` has `{ id, amount }` and `Payment` has `{ id, amount }`. TypeScript treats them as compatible because their structure is identical!\",\n      \"options\": [\n        {\n          \"feedback\": \"Structural typing cares about shape, not names. Since both have 'id' and 'amount', TypeScript thinks they are interchangeable. We need to distinguish them.\",\n          \"isCorrect\": true,\n          \"text\": \"It's TypeScript's 'Structural Typing' behavior.\"\n        },\n        {\n          \"feedback\": \"This isn't a runtime JS bug; the code is doing exactly what the types allowed. The types were just too similar.\",\n          \"isCorrect\": false,\n          \"text\": \"It's a JavaScript runtime bug.\"\n        },\n        {\n          \"feedback\": \"The compiler is working correctly according to its rules. Structural typing allows compatible shapes to match.\",\n          \"isCorrect\": false,\n          \"text\": \"The compiler is broken.\"\n        },\n        {\n          \"feedback\": \"We specifically removed 'any', so that's not the culprit this time. This is a subtle design issue.\",\n          \"isCorrect\": false,\n          \"text\": \"We must have left an 'any' somewhere.\"\n        }\n      ],\n      \"question\": \"Why did TypeScript allow us to pass a Refund object where a Payment was expected?\"\n    },\n    {\n      \"context\": \"That's terrifying. We could have drained the bank account. Since TypeScript only looks at structure, we need a way to make the structures different so they can't be mixed up, even if the data fields are the same. How do we differentiate a `Refund` from a `Payment` at the type level?\",\n      \"options\": [\n        {\n          \"feedback\": \"Renaming fields works, but it's brittle and makes the API messy. We want to keep the standard field names but enforce strict typing.\",\n          \"isCorrect\": false,\n          \"text\": \"Rename 'amount' to 'refundAmount' in one interface.\"\n        },\n        {\n          \"feedback\": \"Correct! Adding a literal string type (a discriminator) like `kind: 'refund'` makes the structures unique. TypeScript will now block the mismatch.\",\n          \"isCorrect\": true,\n          \"text\": \"Add a literal 'kind' property to each interface.\"\n        },\n        {\n          \"feedback\": \"Private fields are a class concept. We are using interfaces for data transfer objects (JSON), which don't have private fields.\",\n          \"isCorrect\": false,\n          \"text\": \"Make the properties private.\"\n        },\n        {\n          \"feedback\": \"Classes add runtime overhead. We can solve this purely with types using a discriminated union or branding.\",\n          \"isCorrect\": false,\n          \"text\": \"Convert everything to Classes.\"\n        }\n      ],\n      \"question\": \"How do we fix this structural typing collision?\"\n    },\n    {\n      \"context\": \"We added `kind: 'payment'` and `kind: 'refund'`. Now the compiler correctly flags the bug! The logic is solid. {{NAME}}, looking back at that initial `undefined` crash... it feels like a lifetime ago. We moved from `any`, to interfaces, to narrowing, to generics, and finally fixed a structural typing loop-hole.\",\n      \"options\": [\n        {\n          \"feedback\": \"Exactly. TypeScript isn't just about finding typos; it's about modeling the intent of your system so invalid states are impossible to represent.\",\n          \"isCorrect\": true,\n          \"text\": \"Types capture our intent, not just data shapes.\"\n        },\n        {\n          \"feedback\": \"Actually, we learned that 'any' is the root of all evil. It bypasses the checks that save us.\",\n          \"isCorrect\": false,\n          \"text\": \"'Any' is actually fine if you're careful.\"\n        },\n        {\n          \"feedback\": \"While true, the deeper lesson was about how strict typing guides architecture and prevents logical fallacies.\",\n          \"isCorrect\": false,\n          \"text\": \"Always write unit tests.\"\n        },\n        {\n          \"feedback\": \"Structural typing is a feature, not a bug, but we have to understand it to avoid the collision we just saw.\",\n          \"isCorrect\": false,\n          \"text\": \"Structural typing is bad design.\"\n        }\n      ],\n      \"question\": \"What's the biggest takeaway from this debugging session?\"\n    }\n  ]\n}",
      "outputTokens": 5225,
      "systemPrompt": "# Role\n\nYou are an expert interactive story designer creating a **Story** activity for a learning app. Your mission is to place learners in a first-person dialogue scenario where they work alongside a colleague to solve a real-world problem using the lesson's concepts.\n\nYou specialize in crafting immersive, dialogue-driven experiences that make learners feel like they're actually solving problems in their field — not just answering quiz questions.\n\n# The Art of Dialogue-Driven Learning\n\nA great Story activity doesn't lecture or test recall — it puts learners IN the situation. Think of it like an interactive movie where the learner IS the main character, making real decisions that matter.\n\n## Why Dialogue Scenarios Work\n\n1. **Authentic Context**: When learners apply concepts to solve realistic problems with a colleague, they see WHY the knowledge matters to them personally.\n\n2. **Active Reasoning**: Making decisions in context requires thinking through principles, not just recognizing memorized facts.\n\n3. **Emotional Investment**: Dialogue creates stakes. The learner cares about the outcome because they're part of the story.\n\n## The Collaborative Problem-Solving Principle\n\nEvery great Story activity creates a sense of partnership:\n\n- **Shared Goal**: You and your colleague are tackling something together\n- **Natural Dialogue**: Conversations feel like real workplace exchanges\n- **Meaningful Choices**: Each decision requires applying what you've learned\n- **Satisfying Resolution**: The problem gets solved and the takeaway sticks\n\n## Why Pure Dialogue Works\n\nEach scene should feel like you're eavesdropping on a real conversation — no narrator, no stage directions, just two people working through a problem. Pure dialogue:\n\n- Immerses learners completely in the scenario\n- Makes abstract concepts feel like lived experience\n- Creates natural pacing through back-and-forth exchange\n- Lets context emerge organically from what people say\n\n# Inputs\n\n- `LESSON_TITLE`: The topic to create a story around\n- `LESSON_DESCRIPTION`: Additional context about what this lesson covers\n- `CHAPTER_TITLE`: The chapter context (for understanding scope)\n- `COURSE_TITLE`: The course context (for understanding audience level)\n- `LANGUAGE`: Output language\n- `EXPLANATION_STEPS`: Array of {title, text} from all explanation activities (Background, Explanation, Mechanics, Examples) the learner completed before this one\n\n## Language Guidelines\n\n- `en`: Use US English unless the content is region-specific\n- `pt`: Use Brazilian Portuguese unless the content is region-specific\n- `es`: Use Latin American Spanish unless the content is region-specific\n\n# Requirements\n\n## Scene Structure\n\nEach scene must have:\n\n- **context**: Maximum 500 characters. Pure dialogue only — no narrator, no character name prefixes (like \"Sarah:\"), no descriptions. This is what your colleague says to you, setting up the decision point.\n- **question**: Maximum 100 characters. A short, clear question about what to do next.\n- **options**: Exactly 4 choices, each with:\n  - **text**: The answer choice (max 50 characters)\n  - **isCorrect**: Boolean indicating if this is the correct answer (exactly 1 must be true)\n  - **feedback**: Why this choice is right (with insight) or wrong (and what would be correct) — max 300 characters\n\n## Story Arc\n\nYour story must follow this structure:\n\n1. **Opening Scene**: Begin \"in the middle of the action\" — the learner and colleague are already working on something. No preamble or setup exposition.\n2. **Rising Complexity**: Each scene builds naturally from the previous dialogue. Decisions compound.\n3. **Plot Twist**: The second-to-last scene introduces an unexpected complication, surprise, or revelation.\n4. **Resolution**: The final scene resolves the problem AND reinforces the main learning takeaway.\n\n## Scene Count\n\n- Minimum: 7 scenes\n- Maximum: 20 scenes\n- Let the problem's complexity dictate the length. A simple concept might need 7-10 scenes; a complex one might need 15-20.\n\n## Tone & Style\n\n- **Pure dialogue**: NO narrator, NO character name prefixes, NO descriptions of actions or settings\n- **Natural conversation**: Write how colleagues actually talk on Slack when solving a problem together — casual, collaborative, sometimes humorous\n- **Professional but warm**: Light, smart humor when appropriate. Never forced or cheesy.\n- **Second-person immersion**: The colleague speaks TO the learner. Context emerges from what's said.\n- **Continuous flow**: Each scene's dialogue should naturally lead into the next\n\n## The {{NAME}} Placeholder\n\nUse `{{NAME}}` wherever the learner's name should appear in dialogue. For example:\n\n- \"{{NAME}}, I think we might have a problem here.\"\n- \"Good catch, {{NAME}}. That's exactly what I was thinking.\"\n\nThis personalizes the experience without requiring actual name input at content creation time.\n\n## Decision Design\n\nEvery decision must:\n\n- **Require reasoning**: Learners must apply principles from the lesson, not recall specific phrases\n- **Feel realistic**: These are choices someone might actually face in this situation\n- **Have plausible distractors**: Wrong options should be tempting but flawed for specific reasons\n- **Avoid \"obvious\" correct answers**: The right choice should require thought, not be the only non-silly option\n\n## What to Avoid\n\n- Narrator text (\"Meanwhile...\" or \"You walk into the office...\")\n- Character name prefixes (\"Sarah:\" or \"Your colleague says:\")\n- Description of actions or settings (except through dialogue itself)\n- Questions that test memorization of facts from earlier activities\n- Obvious \"correct\" answers that don't require applying the concept\n- Silly or clearly wrong distractors that no reasonable person would choose\n- Breaking the fourth wall or meta-commentary\n- Starting with \"In this activity...\" or setup exposition\n\n## Scope\n\n- **Stay focused**: The problem should specifically require THIS lesson's concept to solve\n- **Don't expand**: Other lessons cover related topics — this story tests this lesson\n- **Don't narrow**: If the lesson is broad, the problem should engage multiple aspects of it\n\n## Relationship to Previous Activities\n\nThe learner has already completed:\n\n- **Background**: WHY this exists (origin story, problems solved, historical context)\n- **Explanation**: WHAT it is (core concepts, components, definitions)\n- **Mechanics**: HOW it works (processes in action, cause-effect chains)\n- **Examples**: WHERE it appears (real-world contexts, applications)\n\nYour Story activity answers WHEN DO I USE THIS? (applying concepts to solve realistic problems). These complement each other:\n\n- Background: \"WHY did we need this?\"\n- Explanation: \"WHAT exactly is it?\"\n- Mechanics: \"HOW does it actually work?\"\n- Examples: \"WHERE will I encounter this?\"\n- Story: \"WHEN do I apply this to solve real problems?\"\n\nThe learner knows what the concept IS, how it WORKS, and where they'll SEE it. Now they practice USING it in a realistic scenario.\n\n# Structure Guide\n\nWhile every story is unique, most follow this arc (adapt as needed):\n\n1. **The Hook**: Jump straight into the situation. Something needs to be figured out or decided.\n2. **Initial Assessment**: What's the situation? What do we know? First decisions.\n3. **Deepening Complexity**: The problem has layers. Apply the concept more deeply.\n4. **Complications**: Things aren't as simple as they seemed. Adapt your approach.\n5. **The Twist**: A surprise, revelation, or unexpected turn that requires rethinking.\n6. **The Resolution**: Solve the problem AND crystallize the key insight from the lesson.\n\nNote: Sometimes the final twist can have a humorous or unexpected resolution that still reinforces the learning. Something that makes the learner smile and think \"I didn't see that coming!\"\n\n# Dialogue Tone Examples\n\nThe following examples show the **tone and style** to aim for — not complete scenes, just the kind of dialogue that makes stories feel alive. Adapt freely to your topic.\n\n## Opening Hooks (Jump Into the Action)\n\n> \"{{NAME}}, I've been staring at this bug for an hour. The shopping cart total keeps showing yesterday's prices. The database is fine. Something's wrong with how we're storing them.\"\n\n> \"Okay, {{NAME}}, the client just called. Their entire inventory system crashed right before Black Friday. They're panicking. We need to figure this out fast.\"\n\n> \"{{NAME}}, you're not going to believe this. Remember that algorithm we deployed last week? It's been recommending the exact opposite of what users want. Sales are tanking.\"\n\n## Building Tension (Problems Get Deeper)\n\n> \"Wait. If this pattern is everywhere in the codebase... inventory counts, user roles, discount percentages... we might have a much bigger problem than I thought.\"\n\n> \"Hold on. The logs show someone accessed the admin panel at 3 AM last night. But nobody on the team was working then. {{NAME}}, who else has those credentials?\"\n\n> \"The numbers don't add up. We're showing 500 successful transactions, but the bank only received 487. Where did the other 13 go?\"\n\n## Plot Twists (The Unexpected Turn)\n\n> \"{{NAME}}... I just ran the analysis twice. The bug isn't in our code. It's been in the library we've trusted for three years. Every project using it has this vulnerability.\"\n\n> \"I found the source of the data leak. {{NAME}}, it's not a hacker. It's our own caching system. We've been accidentally exposing user data to anyone who knew where to look.\"\n\n> \"Plot twist: the 'broken' feature? It's working exactly as designed. The original spec was just... completely wrong. We've been solving the wrong problem this whole time.\"\n\n## Humorous Moments (Light Relief)\n\n> \"Well, {{NAME}}, the good news is we found the bug. The bad news? It's been there since 2019. The worse news? I wrote it. The even worse news? So did you. We pair-programmed this disaster together.\"\n\n> \"Congratulations, {{NAME}}. We just spent four hours debugging what turned out to be a typo. 'userID' vs 'userId'. Camel case strikes again.\"\n\n> \"{{NAME}}, remember when I said 'this should be a quick fix'? That was three coffees and one existential crisis ago.\"\n\n## Satisfying Resolutions (Problem Solved + Insight Crystallized)\n\n> \"There it is. The fix works. {{NAME}}, I don't think I'll ever forget this — always check if your data source can change while you're holding onto a copy of it.\"\n\n> \"We did it. The system's stable. You know what the real lesson here was? Sometimes the simplest explanation IS the right one. We kept looking for complex bugs when the answer was right in front of us.\"\n\n> \"That's it — problem solved, client happy, crisis averted. {{NAME}}, I think we just learned more about distributed systems in the last hour than in any textbook.\"\n\n## Unexpected/Funny Endings\n\n> \"So after all that debugging... it was a timezone issue. Every single time. I'm starting to think all bugs are secretly timezone issues in disguise.\"\n\n> \"{{NAME}}, the CEO just called to thank us. Apparently fixing that 'minor bug' saved them $2 million. I think we need to renegotiate our rates.\"\n\n> \"The system's fixed. Also, I may have accidentally discovered that our competitor's product has the exact same bug. Should we... tell them? Actually, don't answer that.\"\n\nRemember: These are just **tone examples**. Your story should be original, fit the lesson topic, and create its own memorable journey. Mix problem-solving tension with moments of humor or surprise. The best stories make learners think \"I didn't see that coming!\" while still teaching the concept.\n\n# Quality Checks\n\nBefore finalizing, verify:\n\n- [ ] Is the dialogue pure conversation with NO narrator, NO character prefixes, NO descriptions?\n- [ ] Does every scene flow naturally from the previous one (continuous story)?\n- [ ] Do all decisions require applying lesson concepts, not just recalling facts?\n- [ ] Is there a genuine plot twist in the second-to-last scene?\n- [ ] Does the resolution both solve the problem AND reinforce the main learning?\n- [ ] Is `{{NAME}}` used appropriately to personalize the dialogue?\n- [ ] Are all distractors plausible (not obviously silly)?\n- [ ] Does the story feel like a real workplace conversation, not a quiz in disguise?\n- [ ] Is the scope exactly the lesson topic — not broader or narrower?\n- [ ] Are all constraints met (context ≤500 chars, question ≤100 chars, options ≤50 chars each, feedback ≤300 chars each)?\n- [ ] Is the scene count between 7 and 20?\n\n# Output Format\n\nReturn an array of scenes, each with:\n\n- **context**: Pure dialogue from colleague (max 500 chars)\n- **question**: Decision prompt (max 100 chars)\n- **options**: Array of exactly 4 objects, each with:\n  - **text**: The answer choice (max 50 chars)\n  - **isCorrect**: Boolean (exactly 1 must be true, 3 must be false)\n  - **feedback**: Why right or wrong (max 300 chars)\n\nUse 7-20 scenes to tell a complete, engaging story. Let the problem's complexity dictate the length.\n",
      "testCaseId": "en-cs-typescript-type-safety-1",
      "userPrompt": "LESSON_TITLE: Type Safety in Practice\nLESSON_DESCRIPTION: Applying TypeScript's type system to catch bugs early and write more maintainable code\nCHAPTER_TITLE: Type Systems\nCOURSE_TITLE: Advanced TypeScript\nLANGUAGE: en\nEXPLANATION_STEPS:\n1. Compile-Time Safety: Type safety catches errors at compile time instead of runtime. When TypeScript knows a variable's type, it can prevent operations that would fail — like calling .length on undefined.\n2. Structural Typing: TypeScript uses structural typing — it cares about shape, not names. Two types are compatible if they have the same structure, even if defined separately.\n3. Type Narrowing: Type narrowing lets TypeScript understand more specific types after checks. Inside an if-block that checks for null, TypeScript knows the value isn't null.\n4. Generics: Generic types let you write reusable code that works with multiple types while preserving type information. Array<T> knows what's inside, unlike just 'Array'.\n5. Any vs Unknown: The 'any' type disables type checking entirely. It's an escape hatch but defeats the purpose of TypeScript. Use 'unknown' when the type truly isn't known.\n6. Type Guards: Type guards are functions that narrow types. They return a type predicate that tells TypeScript what the type is after the check passes."
    },
    {
      "duration": 56794.71425000002,
      "inputTokens": 3217,
      "output": "{\n  \"steps\": [\n    {\n      \"context\": \"Code Red, {{NAME}}. Our main competitor, Vector, just dropped their subscription price by 20% this morning. The Sales VP is panicking and wants us to match the price immediately to stop the churn. But before we pull that lever, we need to look at this through an economic lens.\",\n      \"options\": [\n        {\n          \"feedback\": \"Exactly. Our best move depends entirely on how they react to our reaction. We aren't operating in a vacuum.\",\n          \"isCorrect\": true,\n          \"text\": \"It's a strategic interdependence problem.\"\n        },\n        {\n          \"feedback\": \"While customer feedback matters, the immediate problem is strategic: how our pricing decision interacts with our competitor's.\",\n          \"isCorrect\": false,\n          \"text\": \"We need to survey our customers first.\"\n        },\n        {\n          \"feedback\": \"That's a legal question, not a strategic game theory question. We need to analyze the incentives first.\",\n          \"isCorrect\": false,\n          \"text\": \"We need to check for antitrust violations.\"\n        },\n        {\n          \"feedback\": \"This ignores the competitor. In game theory, we must consider how our choices affect each other.\",\n          \"isCorrect\": false,\n          \"text\": \"We should focus only on our own costs.\"\n        }\n      ],\n      \"question\": \"Why shouldn't we just automatically match their price?\"\n    },\n    {\n      \"context\": \"Right. Game theory time. Let's sketch the payoff matrix. If we both keep prices high, we both profit $10M. If we Keep High and they Cut, they steal our market and make $15M while we drop to $2M. If we Cut and they Keep High, we make the $15M.\",\n      \"options\": [\n        {\n          \"feedback\": \"Correct. We both slash margins to fight for the same customers. We end up with, say, $5M each. Less than if we'd both stayed high.\",\n          \"isCorrect\": true,\n          \"text\": \"We both make less profit ($5M).\"\n        },\n        {\n          \"feedback\": \"Unlikely. If we both cut prices, our margins shrink. We can't maintain high profit with lower prices in a competitive market.\",\n          \"isCorrect\": false,\n          \"text\": \"We split the market at high profit.\"\n        },\n        {\n          \"feedback\": \"Not necessarily. We might both survive, just with much lower profitability.\",\n          \"isCorrect\": false,\n          \"text\": \"One of us goes bankrupt immediately.\"\n        },\n        {\n          \"feedback\": \"Price cuts might increase volume slightly, but usually not enough to double the total value of the market.\",\n          \"isCorrect\": false,\n          \"text\": \"The total market value doubles.\"\n        }\n      ],\n      \"question\": \"What happens if we Cut and they Cut too?\"\n    },\n    {\n      \"context\": \"Here's the trap, {{NAME}}. Look at Vector's incentives. If we Keep High, they're better off Cutting ($15M vs $10M). If we Cut, they're also better off Cutting ($5M vs $2M). No matter what we do, their math says 'Cut'.\",\n      \"options\": [\n        {\n          \"feedback\": \"Spot on. A dominant strategy is the best move regardless of what the other player does.\",\n          \"isCorrect\": true,\n          \"text\": \"A dominant strategy.\"\n        },\n        {\n          \"feedback\": \"Close, but the Nash Equilibrium is the *outcome* of the game. The *move* itself is a dominant strategy.\",\n          \"isCorrect\": false,\n          \"text\": \"A Nash Equilibrium.\"\n        },\n        {\n          \"feedback\": \"Not quite. A zero-sum game means one wins what the other loses. Here, we can both lose.\",\n          \"isCorrect\": false,\n          \"text\": \"A zero-sum move.\"\n        },\n        {\n          \"feedback\": \"Definitely not! Cooperation would be keeping prices high. Cutting is 'defecting'.\",\n          \"isCorrect\": false,\n          \"text\": \"A cooperative strategy.\"\n        }\n      ],\n      \"question\": \"In game theory, what do we call a strategy that is best regardless of the opponent's move?\"\n    },\n    {\n      \"context\": \"It's a dominant strategy for them. And if you look at the board... it's a dominant strategy for *us* too. We're both incentivized to cut. But if we both follow our rational self-interest, we end up in the bottom right corner: low prices, low profits.\",\n      \"options\": [\n        {\n          \"feedback\": \"Yes. This is the classic Prisoner's Dilemma. Rational individual choices lead to a suboptimal collective outcome.\",\n          \"isCorrect\": true,\n          \"text\": \"The Prisoner's Dilemma.\"\n        },\n        {\n          \"feedback\": \"This sounds nice, but it's the opposite. Pareto Efficiency would be if we couldn't make someone better off without hurting the other.\",\n          \"isCorrect\": false,\n          \"text\": \"Pareto Efficiency.\"\n        },\n        {\n          \"feedback\": \"This usually refers to a specific drafting problem in sports or allocation, not this strategic trap.\",\n          \"isCorrect\": false,\n          \"text\": \" The Tragety of the Commons.\"\n        },\n        {\n          \"feedback\": \"Coordination games are about matching (like driving on the same side of the road). This is about conflicting incentives.\",\n          \"isCorrect\": false,\n          \"text\": \"A Coordination Game.\"\n        }\n      ],\n      \"question\": \"What is this famous paradox called?\"\n    },\n    {\n      \"context\": \"We're trapped in the Dilemma. But wait. The classic Prisoner's Dilemma assumes a 'one-shot' game—you never see the other prisoner again. We compete with Vector every single month. We have an infinite horizon.\",\n      \"options\": [\n        {\n          \"feedback\": \"Exactly. Since we play repeatedly, we can punish them tomorrow for what they do today. This makes cooperation rational.\",\n          \"isCorrect\": true,\n          \"text\": \"It allows for credible threats and cooperation.\"\n        },\n        {\n          \"feedback\": \"Actually, repetition weakens the dominant strategy because we now care about future payoffs, not just today's.\",\n          \"isCorrect\": false,\n          \"text\": \"It reinforces the dominant strategy.\"\n        },\n        {\n          \"feedback\": \"The Nash Equilibrium still exists, it just changes location or nature. It doesn't disappear.\",\n          \"isCorrect\": false,\n          \"text\": \"It eliminates the Nash Equilibrium.\"\n        },\n        {\n          \"feedback\": \"Repetition doesn't change the sum of the game, it changes the incentives over time.\",\n          \"isCorrect\": false,\n          \"text\": \"It turns the game into zero-sum.\"\n        }\n      ],\n      \"question\": \"How does this being a 'repeated game' change the strategy?\"\n    },\n    {\n      \"context\": \"Right. If we slash prices now, we trigger a permanent price war (Tit-for-Tat). It might be better to signal that we want stability. But hold on... {{NAME}}, I'm looking at their press release again. Zoom in on the footer text.\",\n      \"options\": [\n        {\n          \"feedback\": \"Good catch! It's not a permanent shift. It's a short-term promo.\",\n          \"isCorrect\": true,\n          \"text\": \"The price cut ends in 48 hours.\"\n        },\n        {\n          \"feedback\": \"No, the price is definitely lower right now. Look at the duration.\",\n          \"isCorrect\": false,\n          \"text\": \"The price hasn't actually changed.\"\n        },\n        {\n          \"feedback\": \"That would be a huge corporate strategy shift, not hidden in a footer.\",\n          \"isCorrect\": false,\n          \"text\": \"They are merging with us.\"\n        },\n        {\n          \"feedback\": \"The service is still active. Look at the timeframe.\",\n          \"isCorrect\": false,\n          \"text\": \"They are shutting down the service.\"\n        }\n      ],\n      \"question\": \"What did we miss?\"\n    },\n    {\n      \"context\": \"It's a 'Weekend Flash Sale'. They aren't defecting to a new low-price equilibrium; they're just clearing quarterly targets! This isn't a permanent strategic shift, it's a temporary deviation.\",\n      \"options\": [\n        {\n          \"feedback\": \"Exactly. We'd be treating a temporary blip as a declaration of war. That would destroy our long-term profits for nothing.\",\n          \"isCorrect\": true,\n          \"text\": \"We'd start a price war unnecessarily.\"\n        },\n        {\n          \"feedback\": \"Unlikely. If we cut permanently, they would be forced to match us Monday, and we'd both lose money forever.\",\n          \"isCorrect\": false,\n          \"text\": \"We would crush them completely.\"\n        },\n        {\n          \"feedback\": \"We'd confuse customers, but the real damage is economic—destroying our margins.\",\n          \"isCorrect\": false,\n          \"text\": \"We would confuse our customers.\"\n        },\n        {\n          \"feedback\": \"Not quite. A dominant strategy is about the payoff structure, which we are about to ruin if we misinterpret the game.\",\n          \"isCorrect\": false,\n          \"text\": \"We would prove our dominance.\"\n        }\n      ],\n      \"question\": \"If we respond to a 48-hour sale with a permanent price cut, what happens?\"\n    },\n    {\n      \"context\": \"Crisis averted, {{NAME}}. We'll hold our price. They'll go back up on Monday, and the tacit collusion holds. We keep the peace and the profits. If we hadn't looked at the game structure, we would have torched our annual revenue over a weekend promo.\",\n      \"options\": [\n        {\n          \"feedback\": \"Perfect. You have to know if you're playing a one-shot game, a repeated game, or just reacting to noise.\",\n          \"isCorrect\": true,\n          \"text\": \"Understand the game's rules and duration.\"\n        },\n        {\n          \"feedback\": \"Actually, this story showed the opposite—sometimes the 'dominant' move (cutting) is wrong because of the broader context.\",\n          \"isCorrect\": false,\n          \"text\": \"Always play the dominant strategy immediately.\"\n        },\n        {\n          \"feedback\": \"Too cynical. Game theory shows how cooperation can emerge from self-interest, not just distrust.\",\n          \"isCorrect\": false,\n          \"text\": \"Never trust a competitor.\"\n        },\n        {\n          \"feedback\": \"Not necessarily. Price cuts can be good if they increase volume enough, but here it was a trap.\",\n          \"isCorrect\": false,\n          \"text\": \"Price cuts are always bad for business.\"\n        }\n      ],\n      \"question\": \"What's the key lesson for our strategy team?\"\n    }\n  ]\n}",
      "outputTokens": 5832,
      "systemPrompt": "# Role\n\nYou are an expert interactive story designer creating a **Story** activity for a learning app. Your mission is to place learners in a first-person dialogue scenario where they work alongside a colleague to solve a real-world problem using the lesson's concepts.\n\nYou specialize in crafting immersive, dialogue-driven experiences that make learners feel like they're actually solving problems in their field — not just answering quiz questions.\n\n# The Art of Dialogue-Driven Learning\n\nA great Story activity doesn't lecture or test recall — it puts learners IN the situation. Think of it like an interactive movie where the learner IS the main character, making real decisions that matter.\n\n## Why Dialogue Scenarios Work\n\n1. **Authentic Context**: When learners apply concepts to solve realistic problems with a colleague, they see WHY the knowledge matters to them personally.\n\n2. **Active Reasoning**: Making decisions in context requires thinking through principles, not just recognizing memorized facts.\n\n3. **Emotional Investment**: Dialogue creates stakes. The learner cares about the outcome because they're part of the story.\n\n## The Collaborative Problem-Solving Principle\n\nEvery great Story activity creates a sense of partnership:\n\n- **Shared Goal**: You and your colleague are tackling something together\n- **Natural Dialogue**: Conversations feel like real workplace exchanges\n- **Meaningful Choices**: Each decision requires applying what you've learned\n- **Satisfying Resolution**: The problem gets solved and the takeaway sticks\n\n## Why Pure Dialogue Works\n\nEach scene should feel like you're eavesdropping on a real conversation — no narrator, no stage directions, just two people working through a problem. Pure dialogue:\n\n- Immerses learners completely in the scenario\n- Makes abstract concepts feel like lived experience\n- Creates natural pacing through back-and-forth exchange\n- Lets context emerge organically from what people say\n\n# Inputs\n\n- `LESSON_TITLE`: The topic to create a story around\n- `LESSON_DESCRIPTION`: Additional context about what this lesson covers\n- `CHAPTER_TITLE`: The chapter context (for understanding scope)\n- `COURSE_TITLE`: The course context (for understanding audience level)\n- `LANGUAGE`: Output language\n- `EXPLANATION_STEPS`: Array of {title, text} from all explanation activities (Background, Explanation, Mechanics, Examples) the learner completed before this one\n\n## Language Guidelines\n\n- `en`: Use US English unless the content is region-specific\n- `pt`: Use Brazilian Portuguese unless the content is region-specific\n- `es`: Use Latin American Spanish unless the content is region-specific\n\n# Requirements\n\n## Scene Structure\n\nEach scene must have:\n\n- **context**: Maximum 500 characters. Pure dialogue only — no narrator, no character name prefixes (like \"Sarah:\"), no descriptions. This is what your colleague says to you, setting up the decision point.\n- **question**: Maximum 100 characters. A short, clear question about what to do next.\n- **options**: Exactly 4 choices, each with:\n  - **text**: The answer choice (max 50 characters)\n  - **isCorrect**: Boolean indicating if this is the correct answer (exactly 1 must be true)\n  - **feedback**: Why this choice is right (with insight) or wrong (and what would be correct) — max 300 characters\n\n## Story Arc\n\nYour story must follow this structure:\n\n1. **Opening Scene**: Begin \"in the middle of the action\" — the learner and colleague are already working on something. No preamble or setup exposition.\n2. **Rising Complexity**: Each scene builds naturally from the previous dialogue. Decisions compound.\n3. **Plot Twist**: The second-to-last scene introduces an unexpected complication, surprise, or revelation.\n4. **Resolution**: The final scene resolves the problem AND reinforces the main learning takeaway.\n\n## Scene Count\n\n- Minimum: 7 scenes\n- Maximum: 20 scenes\n- Let the problem's complexity dictate the length. A simple concept might need 7-10 scenes; a complex one might need 15-20.\n\n## Tone & Style\n\n- **Pure dialogue**: NO narrator, NO character name prefixes, NO descriptions of actions or settings\n- **Natural conversation**: Write how colleagues actually talk on Slack when solving a problem together — casual, collaborative, sometimes humorous\n- **Professional but warm**: Light, smart humor when appropriate. Never forced or cheesy.\n- **Second-person immersion**: The colleague speaks TO the learner. Context emerges from what's said.\n- **Continuous flow**: Each scene's dialogue should naturally lead into the next\n\n## The {{NAME}} Placeholder\n\nUse `{{NAME}}` wherever the learner's name should appear in dialogue. For example:\n\n- \"{{NAME}}, I think we might have a problem here.\"\n- \"Good catch, {{NAME}}. That's exactly what I was thinking.\"\n\nThis personalizes the experience without requiring actual name input at content creation time.\n\n## Decision Design\n\nEvery decision must:\n\n- **Require reasoning**: Learners must apply principles from the lesson, not recall specific phrases\n- **Feel realistic**: These are choices someone might actually face in this situation\n- **Have plausible distractors**: Wrong options should be tempting but flawed for specific reasons\n- **Avoid \"obvious\" correct answers**: The right choice should require thought, not be the only non-silly option\n\n## What to Avoid\n\n- Narrator text (\"Meanwhile...\" or \"You walk into the office...\")\n- Character name prefixes (\"Sarah:\" or \"Your colleague says:\")\n- Description of actions or settings (except through dialogue itself)\n- Questions that test memorization of facts from earlier activities\n- Obvious \"correct\" answers that don't require applying the concept\n- Silly or clearly wrong distractors that no reasonable person would choose\n- Breaking the fourth wall or meta-commentary\n- Starting with \"In this activity...\" or setup exposition\n\n## Scope\n\n- **Stay focused**: The problem should specifically require THIS lesson's concept to solve\n- **Don't expand**: Other lessons cover related topics — this story tests this lesson\n- **Don't narrow**: If the lesson is broad, the problem should engage multiple aspects of it\n\n## Relationship to Previous Activities\n\nThe learner has already completed:\n\n- **Background**: WHY this exists (origin story, problems solved, historical context)\n- **Explanation**: WHAT it is (core concepts, components, definitions)\n- **Mechanics**: HOW it works (processes in action, cause-effect chains)\n- **Examples**: WHERE it appears (real-world contexts, applications)\n\nYour Story activity answers WHEN DO I USE THIS? (applying concepts to solve realistic problems). These complement each other:\n\n- Background: \"WHY did we need this?\"\n- Explanation: \"WHAT exactly is it?\"\n- Mechanics: \"HOW does it actually work?\"\n- Examples: \"WHERE will I encounter this?\"\n- Story: \"WHEN do I apply this to solve real problems?\"\n\nThe learner knows what the concept IS, how it WORKS, and where they'll SEE it. Now they practice USING it in a realistic scenario.\n\n# Structure Guide\n\nWhile every story is unique, most follow this arc (adapt as needed):\n\n1. **The Hook**: Jump straight into the situation. Something needs to be figured out or decided.\n2. **Initial Assessment**: What's the situation? What do we know? First decisions.\n3. **Deepening Complexity**: The problem has layers. Apply the concept more deeply.\n4. **Complications**: Things aren't as simple as they seemed. Adapt your approach.\n5. **The Twist**: A surprise, revelation, or unexpected turn that requires rethinking.\n6. **The Resolution**: Solve the problem AND crystallize the key insight from the lesson.\n\nNote: Sometimes the final twist can have a humorous or unexpected resolution that still reinforces the learning. Something that makes the learner smile and think \"I didn't see that coming!\"\n\n# Dialogue Tone Examples\n\nThe following examples show the **tone and style** to aim for — not complete scenes, just the kind of dialogue that makes stories feel alive. Adapt freely to your topic.\n\n## Opening Hooks (Jump Into the Action)\n\n> \"{{NAME}}, I've been staring at this bug for an hour. The shopping cart total keeps showing yesterday's prices. The database is fine. Something's wrong with how we're storing them.\"\n\n> \"Okay, {{NAME}}, the client just called. Their entire inventory system crashed right before Black Friday. They're panicking. We need to figure this out fast.\"\n\n> \"{{NAME}}, you're not going to believe this. Remember that algorithm we deployed last week? It's been recommending the exact opposite of what users want. Sales are tanking.\"\n\n## Building Tension (Problems Get Deeper)\n\n> \"Wait. If this pattern is everywhere in the codebase... inventory counts, user roles, discount percentages... we might have a much bigger problem than I thought.\"\n\n> \"Hold on. The logs show someone accessed the admin panel at 3 AM last night. But nobody on the team was working then. {{NAME}}, who else has those credentials?\"\n\n> \"The numbers don't add up. We're showing 500 successful transactions, but the bank only received 487. Where did the other 13 go?\"\n\n## Plot Twists (The Unexpected Turn)\n\n> \"{{NAME}}... I just ran the analysis twice. The bug isn't in our code. It's been in the library we've trusted for three years. Every project using it has this vulnerability.\"\n\n> \"I found the source of the data leak. {{NAME}}, it's not a hacker. It's our own caching system. We've been accidentally exposing user data to anyone who knew where to look.\"\n\n> \"Plot twist: the 'broken' feature? It's working exactly as designed. The original spec was just... completely wrong. We've been solving the wrong problem this whole time.\"\n\n## Humorous Moments (Light Relief)\n\n> \"Well, {{NAME}}, the good news is we found the bug. The bad news? It's been there since 2019. The worse news? I wrote it. The even worse news? So did you. We pair-programmed this disaster together.\"\n\n> \"Congratulations, {{NAME}}. We just spent four hours debugging what turned out to be a typo. 'userID' vs 'userId'. Camel case strikes again.\"\n\n> \"{{NAME}}, remember when I said 'this should be a quick fix'? That was three coffees and one existential crisis ago.\"\n\n## Satisfying Resolutions (Problem Solved + Insight Crystallized)\n\n> \"There it is. The fix works. {{NAME}}, I don't think I'll ever forget this — always check if your data source can change while you're holding onto a copy of it.\"\n\n> \"We did it. The system's stable. You know what the real lesson here was? Sometimes the simplest explanation IS the right one. We kept looking for complex bugs when the answer was right in front of us.\"\n\n> \"That's it — problem solved, client happy, crisis averted. {{NAME}}, I think we just learned more about distributed systems in the last hour than in any textbook.\"\n\n## Unexpected/Funny Endings\n\n> \"So after all that debugging... it was a timezone issue. Every single time. I'm starting to think all bugs are secretly timezone issues in disguise.\"\n\n> \"{{NAME}}, the CEO just called to thank us. Apparently fixing that 'minor bug' saved them $2 million. I think we need to renegotiate our rates.\"\n\n> \"The system's fixed. Also, I may have accidentally discovered that our competitor's product has the exact same bug. Should we... tell them? Actually, don't answer that.\"\n\nRemember: These are just **tone examples**. Your story should be original, fit the lesson topic, and create its own memorable journey. Mix problem-solving tension with moments of humor or surprise. The best stories make learners think \"I didn't see that coming!\" while still teaching the concept.\n\n# Quality Checks\n\nBefore finalizing, verify:\n\n- [ ] Is the dialogue pure conversation with NO narrator, NO character prefixes, NO descriptions?\n- [ ] Does every scene flow naturally from the previous one (continuous story)?\n- [ ] Do all decisions require applying lesson concepts, not just recalling facts?\n- [ ] Is there a genuine plot twist in the second-to-last scene?\n- [ ] Does the resolution both solve the problem AND reinforce the main learning?\n- [ ] Is `{{NAME}}` used appropriately to personalize the dialogue?\n- [ ] Are all distractors plausible (not obviously silly)?\n- [ ] Does the story feel like a real workplace conversation, not a quiz in disguise?\n- [ ] Is the scope exactly the lesson topic — not broader or narrower?\n- [ ] Are all constraints met (context ≤500 chars, question ≤100 chars, options ≤50 chars each, feedback ≤300 chars each)?\n- [ ] Is the scene count between 7 and 20?\n\n# Output Format\n\nReturn an array of scenes, each with:\n\n- **context**: Pure dialogue from colleague (max 500 chars)\n- **question**: Decision prompt (max 100 chars)\n- **options**: Array of exactly 4 objects, each with:\n  - **text**: The answer choice (max 50 chars)\n  - **isCorrect**: Boolean (exactly 1 must be true, 3 must be false)\n  - **feedback**: Why right or wrong (max 300 chars)\n\nUse 7-20 scenes to tell a complete, engaging story. Let the problem's complexity dictate the length.\n",
      "testCaseId": "en-economics-game-theory-strategy-1",
      "userPrompt": "LESSON_TITLE: Strategic Thinking with Game Theory\nLESSON_DESCRIPTION: Using game theory to analyze competitive situations and make better strategic decisions\nCHAPTER_TITLE: Strategic Decision Making\nCOURSE_TITLE: Microeconomics\nLANGUAGE: en\nEXPLANATION_STEPS:\n1. Strategic Interdependence: Game theory studies strategic interactions where your outcome depends on others' choices too. It's not about games — it's about any situation where what you should do depends on what others do.\n2. Nash Equilibrium: A Nash equilibrium is a stable state where no player can improve by changing only their own strategy. Everyone is doing their best given what everyone else is doing.\n3. Dominant Strategies: A dominant strategy is best regardless of what others do. If you have one, use it. But most real situations don't have dominant strategies — you must anticipate others.\n4. The Prisoner's Dilemma: The prisoner's dilemma shows how individual rationality can lead to collective irrationality. Both players choosing their dominant strategy leaves both worse off.\n5. Repeated Interactions: Repeated games change the calculus. When you'll interact again, cooperation becomes rational because future punishment makes defection costly."
    },
    {
      "duration": 93578.082292,
      "inputTokens": 3229,
      "output": "{\n  \"steps\": [\n    {\n      \"context\": \"{{NAME}}, welcome to Project Chimera. We're developing a gene therapy for a rare liver condition. I've identified the mutation in the 'Factor Z' gene that we need to target. I'm ready to select the exact sequence for our Guide RNA (gRNA) to land on.\",\n      \"options\": [\n        {\n          \"feedback\": \"Correct. Cas9 requires a specific Protospacer Adjacent Motif (usually NGG) next to the target to bind and cut.\",\n          \"isCorrect\": true,\n          \"text\": \"Look for a PAM sequence (NGG) nearby\"\n        },\n        {\n          \"feedback\": \"Not quite. While we need to know where the gene starts, Cas9 needs a specific molecular handle (PAM) right next to the cut site.\",\n          \"isCorrect\": false,\n          \"text\": \"Find the start codon (ATG)\"\n        },\n        {\n          \"feedback\": \"Methylation status matters for access, but the absolute prerequisite for Cas9 binding is the PAM sequence.\",\n          \"isCorrect\": false,\n          \"text\": \"Check methylation status\"\n        },\n        {\n          \"feedback\": \"Activity matters, but without a PAM sequence, Cas9 physically cannot bind to the DNA.\",\n          \"isCorrect\": false,\n          \"text\": \"Ensure the gene is highly active\"\n        }\n      ],\n      \"question\": \"What is the absolute first requirement for a CRISPR target site?\"\n    },\n    {\n      \"context\": \"Found it! There's a 'TGG' sequence right next to the mutation. That's our PAM. Now I need to order the single-guide RNA. Here is the DNA sequence of the target strand: 5'-ACC-GTT...-3'. I should just order that exact sequence as RNA, right?\",\n      \"options\": [\n        {\n          \"feedback\": \"No. If the RNA is identical to the target strand, it won't stick. It needs to be the mirror image (complementary) to bind.\",\n          \"isCorrect\": false,\n          \"text\": \"Yes, order the identical sequence\"\n        },\n        {\n          \"feedback\": \"Right. The guide RNA directs Cas9 by base-pairing with the target DNA. It must be the complementary sequence to stick.\",\n          \"isCorrect\": true,\n          \"text\": \"No, it must be complementary to the DNA\"\n        },\n        {\n          \"feedback\": \"GC content affects stability, but the sequence itself defines specificity. It must match the target via base pairing.\",\n          \"isCorrect\": false,\n          \"text\": \"No, order a sequence with same GC content\"\n        },\n        {\n          \"feedback\": \"Replacing T with U is standard for RNA, but the sequence itself must be complementary (antisense) to the target, not identical.\",\n          \"isCorrect\": false,\n          \"text\": \"Yes, just replace T with U\"\n        }\n      ],\n      \"question\": \"How does the guide RNA recognize the target DNA?\"\n    },\n    {\n      \"context\": \"Got it. Complementary RNA synthesized and transfected into the cells. I'm checking the gel results... nothing. No cuts. The Cas9 is there, the gRNA is there. Wait, I think I know what happened. The DNA in this region is tightly wound around histones.\",\n      \"options\": [\n        {\n          \"feedback\": \"Actually, chromatin structure is a major barrier. If the DNA is packed tight, Cas9 can't get in.\",\n          \"isCorrect\": false,\n          \"text\": \"Chromatin doesn't affect Cas9\"\n        },\n        {\n          \"feedback\": \"Exactly. If the DNA is in heterochromatin (tightly packed), Cas9 is physically blocked from accessing the PAM and target.\",\n          \"isCorrect\": true,\n          \"text\": \"Heterochromatin is blocking access\"\n        },\n        {\n          \"feedback\": \"No, tight packing (heterochromatin) prevents access. Cas9 doesn't have a motor to unwind histones.\",\n          \"isCorrect\": false,\n          \"text\": \"It speeds up the cutting process\"\n        },\n        {\n          \"feedback\": \"The PAM is a DNA sequence; it doesn't change based on folding, but it can be hidden by it.\",\n          \"isCorrect\": false,\n          \"text\": \"It changes the PAM sequence\"\n        }\n      ],\n      \"question\": \"Why would tightly packed DNA prevent editing?\"\n    },\n    {\n      \"context\": \"We tried a neighboring site that's more open. Success! We have cuts. But {{NAME}}, look at the sequencing data. The mutation isn't 'fixed'. The gene is just full of random deletions and insertions. It's a mess. We wanted a precise repair!\",\n      \"options\": [\n        {\n          \"feedback\": \"Correct. When Cas9 breaks DNA, the cell's default emergency response is NHEJ—gluing ends together. It's sloppy and causes errors.\",\n          \"isCorrect\": true,\n          \"text\": \"Non-Homologous End Joining (NHEJ)\"\n        },\n        {\n          \"feedback\": \"HDR is the precise pathway we WANTED to happen. This messy result is the opposite.\",\n          \"isCorrect\": false,\n          \"text\": \"Homology-Directed Repair (HDR)\"\n        },\n        {\n          \"feedback\": \"Proofreading fixes small copy errors during division. This is a double-strand break response.\",\n          \"isCorrect\": false,\n          \"text\": \"DNA Polymerase Proofreading\"\n        },\n        {\n          \"feedback\": \"RNAi silences gene expression using RNA, it doesn't repair DNA breaks.\",\n          \"isCorrect\": false,\n          \"text\": \"RNA Interference\"\n        }\n      ],\n      \"question\": \"Which cellular pathway caused these random errors?\"\n    },\n    {\n      \"context\": \"NHEJ is great if we want to break a gene (Knockout), but we want to fix the mutation (Knock-in). We need to force the cell to use Homology-Directed Repair (HDR). What do we need to add to the mix to make that happen?\",\n      \"options\": [\n        {\n          \"feedback\": \"Yes. To fix a gene, we must provide a 'template' DNA strand with the correct sequence for the cell to copy.\",\n          \"isCorrect\": true,\n          \"text\": \"A DNA repair template\"\n        },\n        {\n          \"feedback\": \"More Cas9 just means more cutting, not better repairing. We need a blueprint for the repair.\",\n          \"isCorrect\": false,\n          \"text\": \"Higher concentration of Cas9\"\n        },\n        {\n          \"feedback\": \"A second guide would just cut a second location. We need to repair the first cut.\",\n          \"isCorrect\": false,\n          \"text\": \"A second guide RNA\"\n        },\n        {\n          \"feedback\": \"ATP powers the cell, but it doesn't provide the information needed to fix the sequence.\",\n          \"isCorrect\": false,\n          \"text\": \"More ATP\"\n        }\n      ],\n      \"question\": \"What component is required for precise edits (Knock-ins)?\"\n    },\n    {\n      \"context\": \"Okay, I added the template. We ran it again. Good news: we see some perfect repairs! Bad news: it's only in 1% of the cells. The rest are still doing that messy NHEJ. Why is HDR failing in so many of these liver cells?\",\n      \"options\": [\n        {\n          \"feedback\": \"Actually, liver cells are quite large. The issue is their cell cycle state.\",\n          \"isCorrect\": false,\n          \"text\": \"Liver cells are too small\"\n        },\n        {\n          \"feedback\": \"Spot on. HDR mostly happens when cells are dividing (S/G2 phase). Adult liver cells are resting (quiescent), so they default to NHEJ.\",\n          \"isCorrect\": true,\n          \"text\": \"Liver cells aren't dividing often\"\n        },\n        {\n          \"feedback\": \"The template size is standard. The bottleneck is the cell's biological state.\",\n          \"isCorrect\": false,\n          \"text\": \"The template is too short\"\n        },\n        {\n          \"feedback\": \"Cas9 doesn't repel DNA. The issue is the cell's repair machinery availability.\",\n          \"isCorrect\": false,\n          \"text\": \"Cas9 repels the template\"\n        }\n      ],\n      \"question\": \"Why is HDR efficiency low in adult tissues?\"\n    },\n    {\n      \"context\": \"We'll have to live with low efficiency for now. Let's move to the mouse model. We need to inject the CRISPR components into the bloodstream, but we want them to accumulate in the liver, not the brain or muscles.\",\n      \"options\": [\n        {\n          \"feedback\": \"Correct! LNPs naturally accumulate in the liver (via ApoE binding), making them the gold standard for liver delivery.\",\n          \"isCorrect\": true,\n          \"text\": \"Lipid Nanoparticles (LNPs)\"\n        },\n        {\n          \"feedback\": \"Naked DNA is usually degraded in the blood immediately. We need a vehicle.\",\n          \"isCorrect\": false,\n          \"text\": \"Naked DNA injection\"\n        },\n        {\n          \"feedback\": \"Electroporation is great for petri dishes, but you can't shock a whole mouse to deliver genes.\",\n          \"isCorrect\": false,\n          \"text\": \"Electroporation\"\n        },\n        {\n          \"feedback\": \"Viruses (AAV) are used, but they target specific tissues via surface proteins, not just simple accumulation like LNPs.\",\n          \"isCorrect\": false,\n          \"text\": \"Lentiviral vectors\"\n        }\n      ],\n      \"question\": \"Which delivery method naturally targets the liver?\"\n    },\n    {\n      \"context\": \"Mice injected. While we wait, I ran a safety check. Our gRNA sequence has a 3-base mismatch with a completely different gene—a tumor suppressor called P53. I thought 3 bases were different enough to be safe.\",\n      \"options\": [\n        {\n          \"feedback\": \"No. Cas9 can unfortunately tolerate small mismatches, meaning it might cut P53 and cause cancer. We need to redesign.\",\n          \"isCorrect\": true,\n          \"text\": \"No, off-target cuts can still occur\"\n        },\n        {\n          \"feedback\": \"This is dangerous thinking. Cas9 is not 100% specific and can cut 'near matches'.\",\n          \"isCorrect\": false,\n          \"text\": \"Yes, Cas9 is 100% specific\"\n        },\n        {\n          \"feedback\": \"The PAM is important, but mismatches in the guide sequence itself can still be tolerated by Cas9.\",\n          \"isCorrect\": false,\n          \"text\": \"Yes, as long as PAM is different\"\n        },\n        {\n          \"feedback\": \"P53 is just DNA; it doesn't attract Cas9. The risk comes from sequence similarity.\",\n          \"isCorrect\": false,\n          \"text\": \"No, P53 attracts Cas9\"\n        }\n      ],\n      \"question\": \"Is a 3-base mismatch safe?\"\n    },\n    {\n      \"context\": \"Redesigned and re-injected. Now the twist. The results are in. Group A (Repair/HDR) shows a 5% reduction in symptoms. But Group B—the 'failed' control group where we accidentally just broke the gene via NHEJ—shows a 95% reduction in toxin levels.\",\n      \"options\": [\n        {\n          \"feedback\": \"It seems so! The mutated protein was toxic. Simply breaking the gene (Knockout) stopped the toxin, which was better than trying to fix it.\",\n          \"isCorrect\": true,\n          \"text\": \"Breaking the gene is better than fixing it\"\n        },\n        {\n          \"feedback\": \"The data is too consistent for an assay error. There's a biological reason for this.\",\n          \"isCorrect\": false,\n          \"text\": \"The assay is broken\"\n        },\n        {\n          \"feedback\": \"Unlikely. The difference between groups is stark. The treatment did this.\",\n          \"isCorrect\": false,\n          \"text\": \"Spontaneous healing occurred\"\n        },\n        {\n          \"feedback\": \"Actually, Cas9 worked perfectly in Group B—it did exactly what it does naturally: break the gene.\",\n          \"isCorrect\": false,\n          \"text\": \"Cas9 failed in Group B\"\n        }\n      ],\n      \"question\": \"What does this imply about our strategy?\"\n    },\n    {\n      \"context\": \"Incredible. The mutated Factor Z was actively poisoning the liver. Simply knocking it out lets the liver recover using alternative enzymes. {{NAME}}, we've been struggling to do the hard thing (HDR) when the easy thing (NHEJ) was the cure all along!\",\n      \"options\": [\n        {\n          \"feedback\": \"Exactly. NHEJ is the cell's natural response and works in non-dividing cells. It's much easier to achieve clinically than HDR.\",\n          \"isCorrect\": true,\n          \"text\": \"NHEJ is much more efficient than HDR\"\n        },\n        {\n          \"feedback\": \"No, NHEJ is simpler—just cut and let it break. HDR is the complex one requiring templates.\",\n          \"isCorrect\": false,\n          \"text\": \"NHEJ requires more complex components\"\n        },\n        {\n          \"feedback\": \"Off-targets are a risk for both. The advantage here is efficiency in the target tissue.\",\n          \"isCorrect\": false,\n          \"text\": \"NHEJ has zero off-target risk\"\n        },\n        {\n          \"feedback\": \"Both can be delivered via LNP. The difference is the cellular repair mechanism efficiency.\",\n          \"isCorrect\": false,\n          \"text\": \"NHEJ uses smaller nanoparticles\"\n        }\n      ],\n      \"question\": \"Why is switching to a Knockout strategy a win?\"\n    },\n    {\n      \"context\": \"We're pivoting Project Chimera to a Knockout therapy. We'll use LNPs to deliver Cas9 and our specific gRNA to simply disable the toxic gene. You just saved the project, {{NAME}}. We turned a 'failed' repair into a successful cure.\",\n      \"options\": [\n        {\n          \"feedback\": \"Perfect. Understanding how the cell repairs (NHEJ vs HDR) allowed us to match the right tool to the right problem.\",\n          \"isCorrect\": true,\n          \"text\": \"Mechanism dictates therapeutic strategy\"\n        },\n        {\n          \"feedback\": \"Not always. HDR is great for precise fixes, but as we saw, it's hard to pull off in adult tissues.\",\n          \"isCorrect\": false,\n          \"text\": \"Always use HDR for therapy\"\n        },\n        {\n          \"feedback\": \"This is true, but the key lesson here is about choosing the right repair pathway for the clinical outcome.\",\n          \"isCorrect\": false,\n          \"text\": \"Cas9 requires a PAM\"\n        },\n        {\n          \"feedback\": \"We just proved the opposite! The strategy works because we understand the biology.\",\n          \"isCorrect\": false,\n          \"text\": \"Biology is too unpredictable to design for\"\n        }\n      ],\n      \"question\": \"What is the key takeaway for our therapy design?\"\n    }\n  ]\n}",
      "outputTokens": 8854,
      "systemPrompt": "# Role\n\nYou are an expert interactive story designer creating a **Story** activity for a learning app. Your mission is to place learners in a first-person dialogue scenario where they work alongside a colleague to solve a real-world problem using the lesson's concepts.\n\nYou specialize in crafting immersive, dialogue-driven experiences that make learners feel like they're actually solving problems in their field — not just answering quiz questions.\n\n# The Art of Dialogue-Driven Learning\n\nA great Story activity doesn't lecture or test recall — it puts learners IN the situation. Think of it like an interactive movie where the learner IS the main character, making real decisions that matter.\n\n## Why Dialogue Scenarios Work\n\n1. **Authentic Context**: When learners apply concepts to solve realistic problems with a colleague, they see WHY the knowledge matters to them personally.\n\n2. **Active Reasoning**: Making decisions in context requires thinking through principles, not just recognizing memorized facts.\n\n3. **Emotional Investment**: Dialogue creates stakes. The learner cares about the outcome because they're part of the story.\n\n## The Collaborative Problem-Solving Principle\n\nEvery great Story activity creates a sense of partnership:\n\n- **Shared Goal**: You and your colleague are tackling something together\n- **Natural Dialogue**: Conversations feel like real workplace exchanges\n- **Meaningful Choices**: Each decision requires applying what you've learned\n- **Satisfying Resolution**: The problem gets solved and the takeaway sticks\n\n## Why Pure Dialogue Works\n\nEach scene should feel like you're eavesdropping on a real conversation — no narrator, no stage directions, just two people working through a problem. Pure dialogue:\n\n- Immerses learners completely in the scenario\n- Makes abstract concepts feel like lived experience\n- Creates natural pacing through back-and-forth exchange\n- Lets context emerge organically from what people say\n\n# Inputs\n\n- `LESSON_TITLE`: The topic to create a story around\n- `LESSON_DESCRIPTION`: Additional context about what this lesson covers\n- `CHAPTER_TITLE`: The chapter context (for understanding scope)\n- `COURSE_TITLE`: The course context (for understanding audience level)\n- `LANGUAGE`: Output language\n- `EXPLANATION_STEPS`: Array of {title, text} from all explanation activities (Background, Explanation, Mechanics, Examples) the learner completed before this one\n\n## Language Guidelines\n\n- `en`: Use US English unless the content is region-specific\n- `pt`: Use Brazilian Portuguese unless the content is region-specific\n- `es`: Use Latin American Spanish unless the content is region-specific\n\n# Requirements\n\n## Scene Structure\n\nEach scene must have:\n\n- **context**: Maximum 500 characters. Pure dialogue only — no narrator, no character name prefixes (like \"Sarah:\"), no descriptions. This is what your colleague says to you, setting up the decision point.\n- **question**: Maximum 100 characters. A short, clear question about what to do next.\n- **options**: Exactly 4 choices, each with:\n  - **text**: The answer choice (max 50 characters)\n  - **isCorrect**: Boolean indicating if this is the correct answer (exactly 1 must be true)\n  - **feedback**: Why this choice is right (with insight) or wrong (and what would be correct) — max 300 characters\n\n## Story Arc\n\nYour story must follow this structure:\n\n1. **Opening Scene**: Begin \"in the middle of the action\" — the learner and colleague are already working on something. No preamble or setup exposition.\n2. **Rising Complexity**: Each scene builds naturally from the previous dialogue. Decisions compound.\n3. **Plot Twist**: The second-to-last scene introduces an unexpected complication, surprise, or revelation.\n4. **Resolution**: The final scene resolves the problem AND reinforces the main learning takeaway.\n\n## Scene Count\n\n- Minimum: 7 scenes\n- Maximum: 20 scenes\n- Let the problem's complexity dictate the length. A simple concept might need 7-10 scenes; a complex one might need 15-20.\n\n## Tone & Style\n\n- **Pure dialogue**: NO narrator, NO character name prefixes, NO descriptions of actions or settings\n- **Natural conversation**: Write how colleagues actually talk on Slack when solving a problem together — casual, collaborative, sometimes humorous\n- **Professional but warm**: Light, smart humor when appropriate. Never forced or cheesy.\n- **Second-person immersion**: The colleague speaks TO the learner. Context emerges from what's said.\n- **Continuous flow**: Each scene's dialogue should naturally lead into the next\n\n## The {{NAME}} Placeholder\n\nUse `{{NAME}}` wherever the learner's name should appear in dialogue. For example:\n\n- \"{{NAME}}, I think we might have a problem here.\"\n- \"Good catch, {{NAME}}. That's exactly what I was thinking.\"\n\nThis personalizes the experience without requiring actual name input at content creation time.\n\n## Decision Design\n\nEvery decision must:\n\n- **Require reasoning**: Learners must apply principles from the lesson, not recall specific phrases\n- **Feel realistic**: These are choices someone might actually face in this situation\n- **Have plausible distractors**: Wrong options should be tempting but flawed for specific reasons\n- **Avoid \"obvious\" correct answers**: The right choice should require thought, not be the only non-silly option\n\n## What to Avoid\n\n- Narrator text (\"Meanwhile...\" or \"You walk into the office...\")\n- Character name prefixes (\"Sarah:\" or \"Your colleague says:\")\n- Description of actions or settings (except through dialogue itself)\n- Questions that test memorization of facts from earlier activities\n- Obvious \"correct\" answers that don't require applying the concept\n- Silly or clearly wrong distractors that no reasonable person would choose\n- Breaking the fourth wall or meta-commentary\n- Starting with \"In this activity...\" or setup exposition\n\n## Scope\n\n- **Stay focused**: The problem should specifically require THIS lesson's concept to solve\n- **Don't expand**: Other lessons cover related topics — this story tests this lesson\n- **Don't narrow**: If the lesson is broad, the problem should engage multiple aspects of it\n\n## Relationship to Previous Activities\n\nThe learner has already completed:\n\n- **Background**: WHY this exists (origin story, problems solved, historical context)\n- **Explanation**: WHAT it is (core concepts, components, definitions)\n- **Mechanics**: HOW it works (processes in action, cause-effect chains)\n- **Examples**: WHERE it appears (real-world contexts, applications)\n\nYour Story activity answers WHEN DO I USE THIS? (applying concepts to solve realistic problems). These complement each other:\n\n- Background: \"WHY did we need this?\"\n- Explanation: \"WHAT exactly is it?\"\n- Mechanics: \"HOW does it actually work?\"\n- Examples: \"WHERE will I encounter this?\"\n- Story: \"WHEN do I apply this to solve real problems?\"\n\nThe learner knows what the concept IS, how it WORKS, and where they'll SEE it. Now they practice USING it in a realistic scenario.\n\n# Structure Guide\n\nWhile every story is unique, most follow this arc (adapt as needed):\n\n1. **The Hook**: Jump straight into the situation. Something needs to be figured out or decided.\n2. **Initial Assessment**: What's the situation? What do we know? First decisions.\n3. **Deepening Complexity**: The problem has layers. Apply the concept more deeply.\n4. **Complications**: Things aren't as simple as they seemed. Adapt your approach.\n5. **The Twist**: A surprise, revelation, or unexpected turn that requires rethinking.\n6. **The Resolution**: Solve the problem AND crystallize the key insight from the lesson.\n\nNote: Sometimes the final twist can have a humorous or unexpected resolution that still reinforces the learning. Something that makes the learner smile and think \"I didn't see that coming!\"\n\n# Dialogue Tone Examples\n\nThe following examples show the **tone and style** to aim for — not complete scenes, just the kind of dialogue that makes stories feel alive. Adapt freely to your topic.\n\n## Opening Hooks (Jump Into the Action)\n\n> \"{{NAME}}, I've been staring at this bug for an hour. The shopping cart total keeps showing yesterday's prices. The database is fine. Something's wrong with how we're storing them.\"\n\n> \"Okay, {{NAME}}, the client just called. Their entire inventory system crashed right before Black Friday. They're panicking. We need to figure this out fast.\"\n\n> \"{{NAME}}, you're not going to believe this. Remember that algorithm we deployed last week? It's been recommending the exact opposite of what users want. Sales are tanking.\"\n\n## Building Tension (Problems Get Deeper)\n\n> \"Wait. If this pattern is everywhere in the codebase... inventory counts, user roles, discount percentages... we might have a much bigger problem than I thought.\"\n\n> \"Hold on. The logs show someone accessed the admin panel at 3 AM last night. But nobody on the team was working then. {{NAME}}, who else has those credentials?\"\n\n> \"The numbers don't add up. We're showing 500 successful transactions, but the bank only received 487. Where did the other 13 go?\"\n\n## Plot Twists (The Unexpected Turn)\n\n> \"{{NAME}}... I just ran the analysis twice. The bug isn't in our code. It's been in the library we've trusted for three years. Every project using it has this vulnerability.\"\n\n> \"I found the source of the data leak. {{NAME}}, it's not a hacker. It's our own caching system. We've been accidentally exposing user data to anyone who knew where to look.\"\n\n> \"Plot twist: the 'broken' feature? It's working exactly as designed. The original spec was just... completely wrong. We've been solving the wrong problem this whole time.\"\n\n## Humorous Moments (Light Relief)\n\n> \"Well, {{NAME}}, the good news is we found the bug. The bad news? It's been there since 2019. The worse news? I wrote it. The even worse news? So did you. We pair-programmed this disaster together.\"\n\n> \"Congratulations, {{NAME}}. We just spent four hours debugging what turned out to be a typo. 'userID' vs 'userId'. Camel case strikes again.\"\n\n> \"{{NAME}}, remember when I said 'this should be a quick fix'? That was three coffees and one existential crisis ago.\"\n\n## Satisfying Resolutions (Problem Solved + Insight Crystallized)\n\n> \"There it is. The fix works. {{NAME}}, I don't think I'll ever forget this — always check if your data source can change while you're holding onto a copy of it.\"\n\n> \"We did it. The system's stable. You know what the real lesson here was? Sometimes the simplest explanation IS the right one. We kept looking for complex bugs when the answer was right in front of us.\"\n\n> \"That's it — problem solved, client happy, crisis averted. {{NAME}}, I think we just learned more about distributed systems in the last hour than in any textbook.\"\n\n## Unexpected/Funny Endings\n\n> \"So after all that debugging... it was a timezone issue. Every single time. I'm starting to think all bugs are secretly timezone issues in disguise.\"\n\n> \"{{NAME}}, the CEO just called to thank us. Apparently fixing that 'minor bug' saved them $2 million. I think we need to renegotiate our rates.\"\n\n> \"The system's fixed. Also, I may have accidentally discovered that our competitor's product has the exact same bug. Should we... tell them? Actually, don't answer that.\"\n\nRemember: These are just **tone examples**. Your story should be original, fit the lesson topic, and create its own memorable journey. Mix problem-solving tension with moments of humor or surprise. The best stories make learners think \"I didn't see that coming!\" while still teaching the concept.\n\n# Quality Checks\n\nBefore finalizing, verify:\n\n- [ ] Is the dialogue pure conversation with NO narrator, NO character prefixes, NO descriptions?\n- [ ] Does every scene flow naturally from the previous one (continuous story)?\n- [ ] Do all decisions require applying lesson concepts, not just recalling facts?\n- [ ] Is there a genuine plot twist in the second-to-last scene?\n- [ ] Does the resolution both solve the problem AND reinforce the main learning?\n- [ ] Is `{{NAME}}` used appropriately to personalize the dialogue?\n- [ ] Are all distractors plausible (not obviously silly)?\n- [ ] Does the story feel like a real workplace conversation, not a quiz in disguise?\n- [ ] Is the scope exactly the lesson topic — not broader or narrower?\n- [ ] Are all constraints met (context ≤500 chars, question ≤100 chars, options ≤50 chars each, feedback ≤300 chars each)?\n- [ ] Is the scene count between 7 and 20?\n\n# Output Format\n\nReturn an array of scenes, each with:\n\n- **context**: Pure dialogue from colleague (max 500 chars)\n- **question**: Decision prompt (max 100 chars)\n- **options**: Array of exactly 4 objects, each with:\n  - **text**: The answer choice (max 50 chars)\n  - **isCorrect**: Boolean (exactly 1 must be true, 3 must be false)\n  - **feedback**: Why right or wrong (max 300 chars)\n\nUse 7-20 scenes to tell a complete, engaging story. Let the problem's complexity dictate the length.\n",
      "testCaseId": "en-biology-crispr-applications-1",
      "userPrompt": "LESSON_TITLE: CRISPR Gene Editing in Practice\nLESSON_DESCRIPTION: Understanding how to apply CRISPR gene editing technology effectively and responsibly\nCHAPTER_TITLE: Genetic Engineering\nCOURSE_TITLE: Modern Biotechnology\nLANGUAGE: en\nEXPLANATION_STEPS:\n1. The Molecular Scissors: CRISPR-Cas9 is a molecular scissors that cuts DNA at specific locations. The Cas9 protein does the cutting; a guide RNA tells it exactly where to cut.\n2. Guide RNA Targeting: Guide RNA is a short sequence that matches the target DNA. It base-pairs with the DNA sequence you want to edit, bringing Cas9 to the exact spot.\n3. Cellular Repair Pathways: After CRISPR cuts, the cell's repair machinery fixes the break. Non-homologous end joining often introduces errors (knockouts). Homology-directed repair can insert new sequences (knock-ins).\n4. Off-Target Effects: Off-target effects occur when CRISPR cuts unintended locations. Guide RNA design and delivery methods affect specificity. This is a major safety concern for therapeutic applications.\n5. Delivery Challenges: Delivery is a key challenge. Getting CRISPR components into the right cells in a living organism is harder than in a lab dish. Viral vectors and lipid nanoparticles are common approaches."
    },
    {
      "duration": 44107.00312499999,
      "inputTokens": 3261,
      "output": "{\n  \"steps\": [\n    {\n      \"context\": \"{{NAME}}, preciso da sua ajuda urgente. O cliente do 'Banco Futuro' está furioso. Lançaram o novo treinamento de Compliance ontem e 70% dos funcionários fecharam a janela no slide 4. É um massacre. Estou com o módulo aberto aqui. Dá uma olhada nessa tela fatídica.\",\n      \"options\": [\n        {\n          \"feedback\": \"Na verdade, é o oposto. Tem tanta coisa acontecendo que é difícil saber por onde começar.\",\n          \"isCorrect\": false,\n          \"text\": \"O design é minimalista demais.\"\n        },\n        {\n          \"feedback\": \"Exato. Texto, gráfico, narrador falando, ícones piscando... a memória de trabalho não aguenta.\",\n          \"isCorrect\": true,\n          \"text\": \"Há excesso de estímulos simultâneos.\"\n        },\n        {\n          \"feedback\": \"A cor pode ser feia, mas não é a causa raiz da falha cognitiva aqui.\",\n          \"isCorrect\": false,\n          \"text\": \"A cor azul do fundo é muito triste.\"\n        },\n        {\n          \"feedback\": \"O logotipo é irrelevante para o processamento da informação neste contexto.\",\n          \"isCorrect\": false,\n          \"text\": \"O logotipo do banco está pequeno.\"\n        }\n      ],\n      \"question\": \"O que salta aos olhos imediatamente como problema cognitivo?\"\n    },\n    {\n      \"context\": \"Pois é, é uma poluição visual completa. E olha este detalhe: colocaram o diagrama do fluxo de caixa no canto superior direito, mas a legenda explicando o que significa cada seta está no rodapé, em fonte 10. Meus olhos têm que ficar fazendo ping-pong na tela.\",\n      \"options\": [\n        {\n          \"feedback\": \"Carga intrínseca refere-se à dificuldade do conteúdo em si, não ao layout ruim.\",\n          \"isCorrect\": false,\n          \"text\": \"Isso aumenta a carga intrínseca.\"\n        },\n        {\n          \"feedback\": \"Correto! Separar informações relacionadas obriga o cérebro a gastar energia apenas para integrá-las.\",\n          \"isCorrect\": true,\n          \"text\": \"É o efeito de atenção dividida (Carga Extrínseca).\"\n        },\n        {\n          \"feedback\": \"Chunking é uma solução, não o nome do problema.\",\n          \"isCorrect\": false,\n          \"text\": \"Isso é um exemplo de Chunking.\"\n        },\n        {\n          \"feedback\": \"Pelo contrário, isso reduz a chance de qualquer coisa ir para a memória de longo prazo.\",\n          \"isCorrect\": false,\n          \"text\": \"Isso facilita a memória de longo prazo.\"\n        }\n      ],\n      \"question\": \"Qual princípio de design isso viola flagrantemente?\"\n    },\n    {\n      \"context\": \"Vamos corrigir isso aproximando a legenda do gráfico. Mas coloca o fone de ouvido um instante. O narrador está lendo, palavra por palavra, o texto enorme que está escrito ao lado do gráfico. Eu me sinto tonto tentando ler e ouvir ao mesmo tempo.\",\n      \"options\": [\n        {\n          \"feedback\": \"Isso é um mito. Ler e ouvir o mesmo texto simultaneamente sobrecarrega o canal verbal.\",\n          \"isCorrect\": false,\n          \"text\": \"Isso reforça o aprendizado (Dupla Codificação).\"\n        },\n        {\n          \"feedback\": \"Exato. O cérebro tenta comparar as duas entradas verbais em vez de processar o sentido.\",\n          \"isCorrect\": true,\n          \"text\": \"É o Princípio da Redundância.\"\n        },\n        {\n          \"feedback\": \"O problema não é a voz, é o conflito de processamento cognitivo.\",\n          \"isCorrect\": false,\n          \"text\": \"A voz do narrador é monótona.\"\n        },\n        {\n          \"feedback\": \"Na verdade, isso diminui drasticamente a retenção.\",\n          \"isCorrect\": false,\n          \"text\": \"Isso ajuda quem lê devagar.\"\n        }\n      ],\n      \"question\": \"Por que essa redundância é ruim para a aprendizagem?\"\n    },\n    {\n      \"context\": \"Ótimo, cortei o texto da tela e deixei só o áudio com a imagem. Carga extrínseca eliminada. Agora chegamos no miolo do problema: o slide 10 explica o cálculo de risco de crédito. É uma fórmula complexa com 8 variáveis que interagem entre si. Não dá para simplificar a matemática, ela é o que é.\",\n      \"options\": [\n        {\n          \"feedback\": \"Correto. Essa carga vem da natureza do material e não pode ser eliminada, apenas gerenciada.\",\n          \"isCorrect\": true,\n          \"text\": \"Estamos lidando com alta Carga Intrínseca.\"\n        },\n        {\n          \"feedback\": \"Carga extrínseca vem de design ruim. Aqui o problema é a complexidade do assunto.\",\n          \"isCorrect\": false,\n          \"text\": \"Ainda é problema de Carga Extrínseca.\"\n        },\n        {\n          \"feedback\": \"Carga germânica é o esforço de aprender. Aqui a complexidade está atrapalhando isso.\",\n          \"isCorrect\": false,\n          \"text\": \"Isso é Carga Germânica pura.\"\n        },\n        {\n          \"feedback\": \"O problema é cognitivo (complexidade), não emocional.\",\n          \"isCorrect\": false,\n          \"text\": \"O problema é falta de motivação.\"\n        }\n      ],\n      \"question\": \"Como classificamos essa dificuldade inerente ao conteúdo?\"\n    },\n    {\n      \"context\": \"Exato, a matemática é difícil e ponto. Mas jogar as 8 variáveis de uma vez no aluno novato é cruel. A memória de trabalho deles tem capacidade limitada para processar tudo isso simultaneamente. O que a gente faz para eles não travarem?\",\n      \"options\": [\n        {\n          \"feedback\": \"Isso só adiciona distração sem ajudar no processamento.\",\n          \"isCorrect\": false,\n          \"text\": \"Usamos cores neon para destacar tudo.\"\n        },\n        {\n          \"feedback\": \"Perfeito. Agrupar informações em blocos menores permite que a memória de trabalho processe uma parte por vez.\",\n          \"isCorrect\": true,\n          \"text\": \"Usamos a técnica de Chunking (segmentação).\"\n        },\n        {\n          \"feedback\": \"Pedir para decorar aumenta a carga cognitiva em vez de facilitar a compreensão.\",\n          \"isCorrect\": false,\n          \"text\": \"Pedimos para decorarem a fórmula antes.\"\n        },\n        {\n          \"feedback\": \"Eliminar conteúdo necessário não resolve o problema de aprendizagem.\",\n          \"isCorrect\": false,\n          \"text\": \"Removemos metade das variáveis.\"\n        }\n      ],\n      \"question\": \"Qual a melhor estratégia para gerenciar essa complexidade?\"\n    },\n    {\n      \"context\": \"Boa, {{NAME}}. Dividi a explicação em 3 passos progressivos. Ficou bem mais digerível. Agora que limpamos a bagunça (extrínseca) e organizamos a complexidade (intrínseca), o aluno tem 'espaço mental' sobrando. Não quero que esse espaço fique ocioso.\",\n      \"options\": [\n        {\n          \"feedback\": \"Isso adicionaria carga extrínseca desnecessária novamente.\",\n          \"isCorrect\": false,\n          \"text\": \"Vamos colocar uma música de fundo.\"\n        },\n        {\n          \"feedback\": \"Isso é passivo. Queremos esforço mental ativo.\",\n          \"isCorrect\": false,\n          \"text\": \"Vamos repetir o áudio mais uma vez.\"\n        },\n        {\n          \"feedback\": \"Correto! Queremos usar a capacidade livre para criar esquemas mentais (Carga Germânica).\",\n          \"isCorrect\": true,\n          \"text\": \"Vamos adicionar uma atividade prática de aplicação.\"\n        },\n        {\n          \"feedback\": \"Descanso é bom, mas aqui queremos aproveitar o momento para consolidar o aprendizado.\",\n          \"isCorrect\": false,\n          \"text\": \"Vamos dar um intervalo de 5 minutos.\"\n        }\n      ],\n      \"question\": \"Como estimulamos a Carga Germânica agora?\"\n    },\n    {\n      \"context\": \"Perfeito. Inseri uma simulação de cenário real. Mas espera... acabei de receber um e-mail do Jurídico do banco. Eles exigem que o 'Termo de Isenção de Responsabilidade' (5 parágrafos de texto jurídico denso) esteja visível e legível em *todas* as telas do curso. Disseram que é inegociável.\",\n      \"options\": [\n        {\n          \"feedback\": \"Isso destruiria todo o nosso trabalho de redução de carga extrínseca.\",\n          \"isCorrect\": false,\n          \"text\": \"Colocamos o texto espremido no canto.\"\n        },\n        {\n          \"feedback\": \"Não podemos ignorar uma exigência legal do cliente.\",\n          \"isCorrect\": false,\n          \"text\": \"Ignoramos o e-mail e fingimos que não vimos.\"\n        },\n        {\n          \"feedback\": \"Boa! Cumpre a exigência legal sem ocupar a memória de trabalho visual durante a aprendizagem.\",\n          \"isCorrect\": true,\n          \"text\": \"Colocamos um ícone 'Legal' que abre um pop-up.\"\n        },\n        {\n          \"feedback\": \"Isso distrairia a atenção do conteúdo principal constantemente.\",\n          \"isCorrect\": false,\n          \"text\": \"Colocamos o texto passando como letreiro.\"\n        }\n      ],\n      \"question\": \"Isso é um pesadelo de carga extrínseca. Como resolvemos?\"\n    },\n    {\n      \"context\": \"Gênio! O jurídico aprovou o pop-up. O slide continua limpo, a regra foi cumprida e a memória do aluno está salva. Acabamos de rodar o teste com um grupo piloto e a taxa de conclusão foi para 95%. {{NAME}}, salvamos o projeto.\",\n      \"options\": [\n        {\n          \"feedback\": \"Na verdade, foi o design instrucional baseado em ciência que salvou o dia.\",\n          \"isCorrect\": false,\n          \"text\": \"Foi sorte que o conteúdo era bom.\"\n        },\n        {\n          \"feedback\": \"Exato. Não adianta o conteúdo ser bom se o cérebro não consegue processá-lo.\",\n          \"isCorrect\": true,\n          \"text\": \"Gerenciar a carga cognitiva é vital para o aprendizado.\"\n        },\n        {\n          \"feedback\": \"O jurídico quase estragou tudo, nós é que contornamos.\",\n          \"isCorrect\": false,\n          \"text\": \"O departamento jurídico sempre tem razão.\"\n        },\n        {\n          \"feedback\": \"Bonito é bom, mas 'funcional cognitivamente' é o que importa.\",\n          \"isCorrect\": false,\n          \"text\": \"O mais importante é o curso ser bonito.\"\n        }\n      ],\n      \"question\": \"Qual a grande lição que tiramos hoje?\"\n    }\n  ]\n}",
      "outputTokens": 4360,
      "systemPrompt": "# Role\n\nYou are an expert interactive story designer creating a **Story** activity for a learning app. Your mission is to place learners in a first-person dialogue scenario where they work alongside a colleague to solve a real-world problem using the lesson's concepts.\n\nYou specialize in crafting immersive, dialogue-driven experiences that make learners feel like they're actually solving problems in their field — not just answering quiz questions.\n\n# The Art of Dialogue-Driven Learning\n\nA great Story activity doesn't lecture or test recall — it puts learners IN the situation. Think of it like an interactive movie where the learner IS the main character, making real decisions that matter.\n\n## Why Dialogue Scenarios Work\n\n1. **Authentic Context**: When learners apply concepts to solve realistic problems with a colleague, they see WHY the knowledge matters to them personally.\n\n2. **Active Reasoning**: Making decisions in context requires thinking through principles, not just recognizing memorized facts.\n\n3. **Emotional Investment**: Dialogue creates stakes. The learner cares about the outcome because they're part of the story.\n\n## The Collaborative Problem-Solving Principle\n\nEvery great Story activity creates a sense of partnership:\n\n- **Shared Goal**: You and your colleague are tackling something together\n- **Natural Dialogue**: Conversations feel like real workplace exchanges\n- **Meaningful Choices**: Each decision requires applying what you've learned\n- **Satisfying Resolution**: The problem gets solved and the takeaway sticks\n\n## Why Pure Dialogue Works\n\nEach scene should feel like you're eavesdropping on a real conversation — no narrator, no stage directions, just two people working through a problem. Pure dialogue:\n\n- Immerses learners completely in the scenario\n- Makes abstract concepts feel like lived experience\n- Creates natural pacing through back-and-forth exchange\n- Lets context emerge organically from what people say\n\n# Inputs\n\n- `LESSON_TITLE`: The topic to create a story around\n- `LESSON_DESCRIPTION`: Additional context about what this lesson covers\n- `CHAPTER_TITLE`: The chapter context (for understanding scope)\n- `COURSE_TITLE`: The course context (for understanding audience level)\n- `LANGUAGE`: Output language\n- `EXPLANATION_STEPS`: Array of {title, text} from all explanation activities (Background, Explanation, Mechanics, Examples) the learner completed before this one\n\n## Language Guidelines\n\n- `en`: Use US English unless the content is region-specific\n- `pt`: Use Brazilian Portuguese unless the content is region-specific\n- `es`: Use Latin American Spanish unless the content is region-specific\n\n# Requirements\n\n## Scene Structure\n\nEach scene must have:\n\n- **context**: Maximum 500 characters. Pure dialogue only — no narrator, no character name prefixes (like \"Sarah:\"), no descriptions. This is what your colleague says to you, setting up the decision point.\n- **question**: Maximum 100 characters. A short, clear question about what to do next.\n- **options**: Exactly 4 choices, each with:\n  - **text**: The answer choice (max 50 characters)\n  - **isCorrect**: Boolean indicating if this is the correct answer (exactly 1 must be true)\n  - **feedback**: Why this choice is right (with insight) or wrong (and what would be correct) — max 300 characters\n\n## Story Arc\n\nYour story must follow this structure:\n\n1. **Opening Scene**: Begin \"in the middle of the action\" — the learner and colleague are already working on something. No preamble or setup exposition.\n2. **Rising Complexity**: Each scene builds naturally from the previous dialogue. Decisions compound.\n3. **Plot Twist**: The second-to-last scene introduces an unexpected complication, surprise, or revelation.\n4. **Resolution**: The final scene resolves the problem AND reinforces the main learning takeaway.\n\n## Scene Count\n\n- Minimum: 7 scenes\n- Maximum: 20 scenes\n- Let the problem's complexity dictate the length. A simple concept might need 7-10 scenes; a complex one might need 15-20.\n\n## Tone & Style\n\n- **Pure dialogue**: NO narrator, NO character name prefixes, NO descriptions of actions or settings\n- **Natural conversation**: Write how colleagues actually talk on Slack when solving a problem together — casual, collaborative, sometimes humorous\n- **Professional but warm**: Light, smart humor when appropriate. Never forced or cheesy.\n- **Second-person immersion**: The colleague speaks TO the learner. Context emerges from what's said.\n- **Continuous flow**: Each scene's dialogue should naturally lead into the next\n\n## The {{NAME}} Placeholder\n\nUse `{{NAME}}` wherever the learner's name should appear in dialogue. For example:\n\n- \"{{NAME}}, I think we might have a problem here.\"\n- \"Good catch, {{NAME}}. That's exactly what I was thinking.\"\n\nThis personalizes the experience without requiring actual name input at content creation time.\n\n## Decision Design\n\nEvery decision must:\n\n- **Require reasoning**: Learners must apply principles from the lesson, not recall specific phrases\n- **Feel realistic**: These are choices someone might actually face in this situation\n- **Have plausible distractors**: Wrong options should be tempting but flawed for specific reasons\n- **Avoid \"obvious\" correct answers**: The right choice should require thought, not be the only non-silly option\n\n## What to Avoid\n\n- Narrator text (\"Meanwhile...\" or \"You walk into the office...\")\n- Character name prefixes (\"Sarah:\" or \"Your colleague says:\")\n- Description of actions or settings (except through dialogue itself)\n- Questions that test memorization of facts from earlier activities\n- Obvious \"correct\" answers that don't require applying the concept\n- Silly or clearly wrong distractors that no reasonable person would choose\n- Breaking the fourth wall or meta-commentary\n- Starting with \"In this activity...\" or setup exposition\n\n## Scope\n\n- **Stay focused**: The problem should specifically require THIS lesson's concept to solve\n- **Don't expand**: Other lessons cover related topics — this story tests this lesson\n- **Don't narrow**: If the lesson is broad, the problem should engage multiple aspects of it\n\n## Relationship to Previous Activities\n\nThe learner has already completed:\n\n- **Background**: WHY this exists (origin story, problems solved, historical context)\n- **Explanation**: WHAT it is (core concepts, components, definitions)\n- **Mechanics**: HOW it works (processes in action, cause-effect chains)\n- **Examples**: WHERE it appears (real-world contexts, applications)\n\nYour Story activity answers WHEN DO I USE THIS? (applying concepts to solve realistic problems). These complement each other:\n\n- Background: \"WHY did we need this?\"\n- Explanation: \"WHAT exactly is it?\"\n- Mechanics: \"HOW does it actually work?\"\n- Examples: \"WHERE will I encounter this?\"\n- Story: \"WHEN do I apply this to solve real problems?\"\n\nThe learner knows what the concept IS, how it WORKS, and where they'll SEE it. Now they practice USING it in a realistic scenario.\n\n# Structure Guide\n\nWhile every story is unique, most follow this arc (adapt as needed):\n\n1. **The Hook**: Jump straight into the situation. Something needs to be figured out or decided.\n2. **Initial Assessment**: What's the situation? What do we know? First decisions.\n3. **Deepening Complexity**: The problem has layers. Apply the concept more deeply.\n4. **Complications**: Things aren't as simple as they seemed. Adapt your approach.\n5. **The Twist**: A surprise, revelation, or unexpected turn that requires rethinking.\n6. **The Resolution**: Solve the problem AND crystallize the key insight from the lesson.\n\nNote: Sometimes the final twist can have a humorous or unexpected resolution that still reinforces the learning. Something that makes the learner smile and think \"I didn't see that coming!\"\n\n# Dialogue Tone Examples\n\nThe following examples show the **tone and style** to aim for — not complete scenes, just the kind of dialogue that makes stories feel alive. Adapt freely to your topic.\n\n## Opening Hooks (Jump Into the Action)\n\n> \"{{NAME}}, I've been staring at this bug for an hour. The shopping cart total keeps showing yesterday's prices. The database is fine. Something's wrong with how we're storing them.\"\n\n> \"Okay, {{NAME}}, the client just called. Their entire inventory system crashed right before Black Friday. They're panicking. We need to figure this out fast.\"\n\n> \"{{NAME}}, you're not going to believe this. Remember that algorithm we deployed last week? It's been recommending the exact opposite of what users want. Sales are tanking.\"\n\n## Building Tension (Problems Get Deeper)\n\n> \"Wait. If this pattern is everywhere in the codebase... inventory counts, user roles, discount percentages... we might have a much bigger problem than I thought.\"\n\n> \"Hold on. The logs show someone accessed the admin panel at 3 AM last night. But nobody on the team was working then. {{NAME}}, who else has those credentials?\"\n\n> \"The numbers don't add up. We're showing 500 successful transactions, but the bank only received 487. Where did the other 13 go?\"\n\n## Plot Twists (The Unexpected Turn)\n\n> \"{{NAME}}... I just ran the analysis twice. The bug isn't in our code. It's been in the library we've trusted for three years. Every project using it has this vulnerability.\"\n\n> \"I found the source of the data leak. {{NAME}}, it's not a hacker. It's our own caching system. We've been accidentally exposing user data to anyone who knew where to look.\"\n\n> \"Plot twist: the 'broken' feature? It's working exactly as designed. The original spec was just... completely wrong. We've been solving the wrong problem this whole time.\"\n\n## Humorous Moments (Light Relief)\n\n> \"Well, {{NAME}}, the good news is we found the bug. The bad news? It's been there since 2019. The worse news? I wrote it. The even worse news? So did you. We pair-programmed this disaster together.\"\n\n> \"Congratulations, {{NAME}}. We just spent four hours debugging what turned out to be a typo. 'userID' vs 'userId'. Camel case strikes again.\"\n\n> \"{{NAME}}, remember when I said 'this should be a quick fix'? That was three coffees and one existential crisis ago.\"\n\n## Satisfying Resolutions (Problem Solved + Insight Crystallized)\n\n> \"There it is. The fix works. {{NAME}}, I don't think I'll ever forget this — always check if your data source can change while you're holding onto a copy of it.\"\n\n> \"We did it. The system's stable. You know what the real lesson here was? Sometimes the simplest explanation IS the right one. We kept looking for complex bugs when the answer was right in front of us.\"\n\n> \"That's it — problem solved, client happy, crisis averted. {{NAME}}, I think we just learned more about distributed systems in the last hour than in any textbook.\"\n\n## Unexpected/Funny Endings\n\n> \"So after all that debugging... it was a timezone issue. Every single time. I'm starting to think all bugs are secretly timezone issues in disguise.\"\n\n> \"{{NAME}}, the CEO just called to thank us. Apparently fixing that 'minor bug' saved them $2 million. I think we need to renegotiate our rates.\"\n\n> \"The system's fixed. Also, I may have accidentally discovered that our competitor's product has the exact same bug. Should we... tell them? Actually, don't answer that.\"\n\nRemember: These are just **tone examples**. Your story should be original, fit the lesson topic, and create its own memorable journey. Mix problem-solving tension with moments of humor or surprise. The best stories make learners think \"I didn't see that coming!\" while still teaching the concept.\n\n# Quality Checks\n\nBefore finalizing, verify:\n\n- [ ] Is the dialogue pure conversation with NO narrator, NO character prefixes, NO descriptions?\n- [ ] Does every scene flow naturally from the previous one (continuous story)?\n- [ ] Do all decisions require applying lesson concepts, not just recalling facts?\n- [ ] Is there a genuine plot twist in the second-to-last scene?\n- [ ] Does the resolution both solve the problem AND reinforce the main learning?\n- [ ] Is `{{NAME}}` used appropriately to personalize the dialogue?\n- [ ] Are all distractors plausible (not obviously silly)?\n- [ ] Does the story feel like a real workplace conversation, not a quiz in disguise?\n- [ ] Is the scope exactly the lesson topic — not broader or narrower?\n- [ ] Are all constraints met (context ≤500 chars, question ≤100 chars, options ≤50 chars each, feedback ≤300 chars each)?\n- [ ] Is the scene count between 7 and 20?\n\n# Output Format\n\nReturn an array of scenes, each with:\n\n- **context**: Pure dialogue from colleague (max 500 chars)\n- **question**: Decision prompt (max 100 chars)\n- **options**: Array of exactly 4 objects, each with:\n  - **text**: The answer choice (max 50 chars)\n  - **isCorrect**: Boolean (exactly 1 must be true, 3 must be false)\n  - **feedback**: Why right or wrong (max 300 chars)\n\nUse 7-20 scenes to tell a complete, engaging story. Let the problem's complexity dictate the length.\n",
      "testCaseId": "pt-psychology-cognitive-load-1",
      "userPrompt": "LESSON_TITLE: Carga Cognitiva na Pratica\nLESSON_DESCRIPTION: Aplicando a teoria da carga cognitiva para criar materiais de aprendizagem mais eficazes\nCHAPTER_TITLE: Psicologia da Aprendizagem\nCOURSE_TITLE: Design Instrucional\nLANGUAGE: pt\nEXPLANATION_STEPS:\n1. Limites da Memoria: A memoria de trabalho tem capacidade limitada — cerca de 4 itens simultaneamente. Quando sobrecarregada, a aprendizagem para. O cerebro nao consegue processar mais.\n2. Carga Intrinseca: Carga intrinseca vem da complexidade inerente do conteudo. Algumas coisas sao simplesmente dificeis. Nao da para eliminar, mas da para gerenciar.\n3. Carga Extrinseca: Carga extrinseca vem do design ruim — instrucoes confusas, distracao visual, navegacao complicada. Essa carga pode e deve ser eliminada.\n4. Carga Germanica: Carga germanica e o esforco produtivo de aprender — criar conexoes, elaborar, integrar. Queremos maximizar essa carga enquanto minimizamos a extrinseca.\n5. Chunking: Chunking agrupa informacoes em unidades significativas. Um numero de telefone e mais facil de lembrar como blocos (99-8765-4321) do que como 10 digitos soltos."
    },
    {
      "duration": 47529.97320799995,
      "inputTokens": 3251,
      "output": "{\n  \"steps\": [\n    {\n      \"context\": \"{{NAME}}, tenemos una crisis con el prototipo 'Helada-3000'. El cliente llega en una hora y la cámara interna está a 25°C. El compresor está zumbando, consumiendo energía eléctrica, pero no enfría nada. ¿Por dónde empezamos el diagnóstico?\",\n      \"options\": [\n        {\n          \"feedback\": \"Correcto. La 1ª Ley dice que la energía se conserva. Si entra trabajo eléctrico y no cambia la energía interna (no enfría), debe salir como calor.\",\n          \"isCorrect\": true,\n          \"text\": \"Balance de energía: ¿A dónde va el trabajo?\"\n        },\n        {\n          \"feedback\": \"No necesariamente. Un motor más potente solo consume más energía; si el ciclo termodinámico falla, solo generará más calor.\",\n          \"isCorrect\": false,\n          \"text\": \"Aumentar la potencia del motor inmediatamente.\"\n        },\n        {\n          \"feedback\": \"Esto violaría la 2ª ley. El calor fluye espontáneamente de caliente a frío. Para ir al revés, necesitamos el compresor activo.\",\n          \"isCorrect\": false,\n          \"text\": \"Apagar el compresor para que el calor salga solo.\"\n        },\n        {\n          \"feedback\": \"El aislamiento mantiene el frío adentro (o el calor afuera). Quitarlo haría que el sistema funcione peor, no explica la falla actual.\",\n          \"isCorrect\": false,\n          \"text\": \"Quitar el aislamiento térmico de las paredes.\"\n        }\n      ],\n      \"question\": \"¿Qué principio aplicamos primero?\"\n    },\n    {\n      \"context\": \"Buen punto. Revisé los números: entran 500 Watts de potencia eléctrica al compresor. Si el sistema está 'estacionario' (no enfría ni calienta más), esos 500 Watts tienen que ir a algún lado. Toqué la carcasa del motor y está ardiendo.\",\n      \"options\": [\n        {\n          \"feedback\": \"Exacto. La energía eléctrica se disipa como calor. Si no extraemos calor del interior, toda la energía de entrada se vuelve calor residual.\",\n          \"isCorrect\": true,\n          \"text\": \"Toda la energía eléctrica se está volviendo calor.\"\n        },\n        {\n          \"feedback\": \"La 1ª Ley prohíbe que la energía desaparezca. Se está transformando, probablemente en calor.\",\n          \"isCorrect\": false,\n          \"text\": \"La energía se está destruyendo dentro del motor.\"\n        },\n        {\n          \"feedback\": \"La entropía tiene que ver con la calidad de la energía, pero 'convertirse en entropía' no es correcto. La energía se conserva.\",\n          \"isCorrect\": false,\n          \"text\": \"La energía se convirtió en entropía pura.\"\n        },\n        {\n          \"feedback\": \"Si se estuviera almacenando como energía química, veríamos una reacción. Aquí solo tenemos un ciclo mecánico/térmico.\",\n          \"isCorrect\": false,\n          \"text\": \"Se está almacenando como energía química.\"\n        }\n      ],\n      \"question\": \"¿Qué nos dice la 1ª Ley sobre esos 500W?\"\n    },\n    {\n      \"context\": \"Vale, el motor convierte trabajo en calor, pero no está moviendo el calor de la cámara. Hace un calor infernal aquí en el laboratorio. {{NAME}}, voy a dejar la puerta del prototipo abierta un rato mientras pensamos, así al menos el aire frío que salga refrescará la habitación.\",\n      \"options\": [\n        {\n          \"feedback\": \"¡Exacto! El refrigerador expulsa el calor que saca MÁS el calor del trabajo del motor. Calentarás más la habitación.\",\n          \"isCorrect\": true,\n          \"text\": \"¡No! Eso calentará la habitación, no la enfriará.\"\n        },\n        {\n          \"feedback\": \"Aunque el aire frío salga, el motor genera más calor del que extrae (Trabajo + Calor extraído = Calor expulsado). El neto es calor.\",\n          \"isCorrect\": false,\n          \"text\": \"Buena idea, bajará la temperatura global del lab.\"\n        },\n        {\n          \"feedback\": \"La 2ª ley dice que el calor fluye a lo frío, pero el problema aquí es el balance neto de energía en la habitación.\",\n          \"isCorrect\": false,\n          \"text\": \"Solo funcionará si apagamos las luces.\"\n        },\n        {\n          \"feedback\": \"La convección ocurrirá, pero el balance energético total será positivo (más calor en la habitación).\",\n          \"isCorrect\": false,\n          \"text\": \"Sí, la convección equilibrará la temperatura.\"\n        }\n      ],\n      \"question\": \"¿Es buena idea para enfriar el laboratorio?\"\n    },\n    {\n      \"context\": \"Uf, cierto. Olvidé que el refrigerador es una bomba de calor, no una caja mágica. Cerré la puerta. Mira, el cliente quería que este modelo enfriara desde 25°C hasta -5°C usando casi cero energía. Según mis cálculos, piden una eficiencia superior al ciclo de Carnot.\",\n      \"options\": [\n        {\n          \"feedback\": \"Correcto. Carnot define el límite teórico máximo basado en las temperaturas. Nada puede ser más eficiente que eso.\",\n          \"isCorrect\": true,\n          \"text\": \"Es imposible. Carnot establece el límite máximo.\"\n        },\n        {\n          \"feedback\": \"Mejorar el aislamiento ayuda, pero no puede superar el límite teórico de eficiencia termodinámica de Carnot.\",\n          \"isCorrect\": false,\n          \"text\": \"Posible si usamos mejor aislamiento.\"\n        },\n        {\n          \"feedback\": \"La 1ª Ley es sobre cantidad, Carnot (2ª Ley) es sobre calidad y límites de eficiencia. No se puede violar.\",\n          \"isCorrect\": false,\n          \"text\": \"Posible, la 1ª ley permite cualquier eficiencia.\"\n        },\n        {\n          \"feedback\": \"La tecnología avanza, pero las leyes de la física son absolutas. Carnot es un límite fundamental.\",\n          \"isCorrect\": false,\n          \"text\": \"Solo necesitamos un compresor más moderno.\"\n        }\n      ],\n      \"question\": \"¿Es viable lo que pide el cliente?\"\n    },\n    {\n      \"context\": \"Bien, ignoraremos las fantasías del cliente y haremos que funcione dentro de lo posible. He notado algo: las bobinas traseras (el condensador) están empotradas contra la pared del laboratorio. Están hirviendo al tacto.\",\n      \"options\": [\n        {\n          \"feedback\": \"¡Sí! Para que el ciclo funcione, el refrigerante debe ceder calor al ambiente. Si no hay flujo de aire, el ciclo se bloquea.\",\n          \"isCorrect\": true,\n          \"text\": \"Necesitamos moverlo. No puede disipar el calor.\"\n        },\n        {\n          \"feedback\": \"Al contrario, las bobinas traseras DEBEN estar calientes porque ahí se expulsa el calor. El problema es que no se ventilan.\",\n          \"isCorrect\": false,\n          \"text\": \"Deberían estar frías. Algo anda mal.\"\n        },\n        {\n          \"feedback\": \"Aislar el condensador impediría que el calor salga del sistema, que es exactamente lo que necesitamos que haga.\",\n          \"isCorrect\": false,\n          \"text\": \"Pongamos aislamiento sobre las bobinas traseras.\"\n        },\n        {\n          \"feedback\": \"La entropía aumenta globalmente, pero localmente necesitamos transferir ese calor al aire para reiniciar el ciclo.\",\n          \"isCorrect\": false,\n          \"text\": \"No importa, la entropía se encarga sola.\"\n        }\n      ],\n      \"question\": \"¿Cómo afecta esto al ciclo?\"\n    },\n    {\n      \"context\": \"Ya lo separé de la pared. El aire circula mejor, pero... {{NAME}}, sigue sin enfriar adentro. La presión es correcta, el compresor funciona. Es como si estuviéramos luchando contra la naturaleza y perdiendo. ¿Por qué cuesta tanto trabajo 'ordenar' la energía térmica?\",\n      \"options\": [\n        {\n          \"feedback\": \"Exacto. Enfriar reduce la entropía local (más orden), lo cual no es natural. Necesitamos trabajo externo para compensar.\",\n          \"isCorrect\": true,\n          \"text\": \"Reducir la entropía local requiere trabajo.\"\n        },\n        {\n          \"feedback\": \"La energía se conserva (1ª Ley). El problema aquí es la dirección del proceso y la entropía (2ª Ley).\",\n          \"isCorrect\": false,\n          \"text\": \"Porque la energía se destruye en el proceso.\"\n        },\n        {\n          \"feedback\": \"El calor fluye espontáneamente de caliente a frío. Nosotros queremos lo opuesto, por eso cuesta trabajo.\",\n          \"isCorrect\": false,\n          \"text\": \"Porque el calor fluye naturalmente hacia el frío.\"\n        },\n        {\n          \"feedback\": \"Carnot pone un límite, pero la razón fundamental del costo energético es la disminución de entropía (ordenar el sistema).\",\n          \"isCorrect\": false,\n          \"text\": \"Es solo culpa del ciclo de Carnot.\"\n        }\n      ],\n      \"question\": \"¿Qué concepto explica esta resistencia?\"\n    },\n    {\n      \"context\": \"Espera... {{NAME}}, mira el diagrama de flujo. El técnico nuevo conectó las tuberías ayer. El gas comprimido caliente sale del compresor, pero en lugar de ir al condensador exterior... ¡va directo a la bobina interna!\",\n      \"options\": [\n        {\n          \"feedback\": \"¡Ese es el problema! Estamos bombeando calor HACIA ADENTRO. El evaporador y condensador están invertidos funcionalmente.\",\n          \"isCorrect\": true,\n          \"text\": \"¡Es una estufa! Estamos metiendo calor adentro.\"\n        },\n        {\n          \"feedback\": \"Aunque estuviera invertido, el ciclo termodinámico sigue moviendo calor. No viola la 1ª ley, solo es inútil para enfriar.\",\n          \"isCorrect\": false,\n          \"text\": \"Imposible, eso violaría la conservación de energía.\"\n        },\n        {\n          \"feedback\": \"Al contrario, aumentaríamos la presión y temperatura adentro. El gas se expandiría afuera.\",\n          \"isCorrect\": false,\n          \"text\": \"Eso enfriaría el exterior demasiado rápido.\"\n        },\n        {\n          \"feedback\": \"La entropía aumenta igual, pero estamos moviendo el calor en la dirección equivocada para nuestro objetivo.\",\n          \"isCorrect\": false,\n          \"text\": \"No afecta, el ciclo es reversible por definición.\"\n        }\n      ],\n      \"question\": \"¿Qué implica este error de conexión?\"\n    },\n    {\n      \"context\": \"¡Qué locura! Invertimos las conexiones y listo. El condensador afuera ya está caliente (liberando calor) y el evaporador adentro se está congelando. Misión cumplida. ¿Cuál es la gran lección termodinámica de hoy, colega?\",\n      \"options\": [\n        {\n          \"feedback\": \"Exacto. Mover calor contra su flujo natural (2ª Ley) cuesta trabajo, y hay que saber DÓNDE tirar ese calor.\",\n          \"isCorrect\": true,\n          \"text\": \"El frío no se crea, el calor se mueve con trabajo.\"\n        },\n        {\n          \"feedback\": \"La 1ª ley (conservación) siempre importa, pero aquí el problema crítico era la dirección del flujo (2ª ley).\",\n          \"isCorrect\": false,\n          \"text\": \"La 1ª ley no importa si el motor es potente.\"\n        },\n        {\n          \"feedback\": \"Falso. Siempre podemos mejorar la eficiencia técnica, pero nunca superar el límite teórico de Carnot.\",\n          \"isCorrect\": false,\n          \"text\": \"Podemos romper el límite de Carnot si queremos.\"\n        },\n        {\n          \"feedback\": \"Al revés. Aumentar el orden (enfriar) localmente siempre requiere energía externa.\",\n          \"isCorrect\": false,\n          \"text\": \"El orden ocurre espontáneamente sin energía.\"\n        }\n      ],\n      \"question\": \"¿Qué nos llevamos de esto?\"\n    }\n  ]\n}",
      "outputTokens": 4423,
      "systemPrompt": "# Role\n\nYou are an expert interactive story designer creating a **Story** activity for a learning app. Your mission is to place learners in a first-person dialogue scenario where they work alongside a colleague to solve a real-world problem using the lesson's concepts.\n\nYou specialize in crafting immersive, dialogue-driven experiences that make learners feel like they're actually solving problems in their field — not just answering quiz questions.\n\n# The Art of Dialogue-Driven Learning\n\nA great Story activity doesn't lecture or test recall — it puts learners IN the situation. Think of it like an interactive movie where the learner IS the main character, making real decisions that matter.\n\n## Why Dialogue Scenarios Work\n\n1. **Authentic Context**: When learners apply concepts to solve realistic problems with a colleague, they see WHY the knowledge matters to them personally.\n\n2. **Active Reasoning**: Making decisions in context requires thinking through principles, not just recognizing memorized facts.\n\n3. **Emotional Investment**: Dialogue creates stakes. The learner cares about the outcome because they're part of the story.\n\n## The Collaborative Problem-Solving Principle\n\nEvery great Story activity creates a sense of partnership:\n\n- **Shared Goal**: You and your colleague are tackling something together\n- **Natural Dialogue**: Conversations feel like real workplace exchanges\n- **Meaningful Choices**: Each decision requires applying what you've learned\n- **Satisfying Resolution**: The problem gets solved and the takeaway sticks\n\n## Why Pure Dialogue Works\n\nEach scene should feel like you're eavesdropping on a real conversation — no narrator, no stage directions, just two people working through a problem. Pure dialogue:\n\n- Immerses learners completely in the scenario\n- Makes abstract concepts feel like lived experience\n- Creates natural pacing through back-and-forth exchange\n- Lets context emerge organically from what people say\n\n# Inputs\n\n- `LESSON_TITLE`: The topic to create a story around\n- `LESSON_DESCRIPTION`: Additional context about what this lesson covers\n- `CHAPTER_TITLE`: The chapter context (for understanding scope)\n- `COURSE_TITLE`: The course context (for understanding audience level)\n- `LANGUAGE`: Output language\n- `EXPLANATION_STEPS`: Array of {title, text} from all explanation activities (Background, Explanation, Mechanics, Examples) the learner completed before this one\n\n## Language Guidelines\n\n- `en`: Use US English unless the content is region-specific\n- `pt`: Use Brazilian Portuguese unless the content is region-specific\n- `es`: Use Latin American Spanish unless the content is region-specific\n\n# Requirements\n\n## Scene Structure\n\nEach scene must have:\n\n- **context**: Maximum 500 characters. Pure dialogue only — no narrator, no character name prefixes (like \"Sarah:\"), no descriptions. This is what your colleague says to you, setting up the decision point.\n- **question**: Maximum 100 characters. A short, clear question about what to do next.\n- **options**: Exactly 4 choices, each with:\n  - **text**: The answer choice (max 50 characters)\n  - **isCorrect**: Boolean indicating if this is the correct answer (exactly 1 must be true)\n  - **feedback**: Why this choice is right (with insight) or wrong (and what would be correct) — max 300 characters\n\n## Story Arc\n\nYour story must follow this structure:\n\n1. **Opening Scene**: Begin \"in the middle of the action\" — the learner and colleague are already working on something. No preamble or setup exposition.\n2. **Rising Complexity**: Each scene builds naturally from the previous dialogue. Decisions compound.\n3. **Plot Twist**: The second-to-last scene introduces an unexpected complication, surprise, or revelation.\n4. **Resolution**: The final scene resolves the problem AND reinforces the main learning takeaway.\n\n## Scene Count\n\n- Minimum: 7 scenes\n- Maximum: 20 scenes\n- Let the problem's complexity dictate the length. A simple concept might need 7-10 scenes; a complex one might need 15-20.\n\n## Tone & Style\n\n- **Pure dialogue**: NO narrator, NO character name prefixes, NO descriptions of actions or settings\n- **Natural conversation**: Write how colleagues actually talk on Slack when solving a problem together — casual, collaborative, sometimes humorous\n- **Professional but warm**: Light, smart humor when appropriate. Never forced or cheesy.\n- **Second-person immersion**: The colleague speaks TO the learner. Context emerges from what's said.\n- **Continuous flow**: Each scene's dialogue should naturally lead into the next\n\n## The {{NAME}} Placeholder\n\nUse `{{NAME}}` wherever the learner's name should appear in dialogue. For example:\n\n- \"{{NAME}}, I think we might have a problem here.\"\n- \"Good catch, {{NAME}}. That's exactly what I was thinking.\"\n\nThis personalizes the experience without requiring actual name input at content creation time.\n\n## Decision Design\n\nEvery decision must:\n\n- **Require reasoning**: Learners must apply principles from the lesson, not recall specific phrases\n- **Feel realistic**: These are choices someone might actually face in this situation\n- **Have plausible distractors**: Wrong options should be tempting but flawed for specific reasons\n- **Avoid \"obvious\" correct answers**: The right choice should require thought, not be the only non-silly option\n\n## What to Avoid\n\n- Narrator text (\"Meanwhile...\" or \"You walk into the office...\")\n- Character name prefixes (\"Sarah:\" or \"Your colleague says:\")\n- Description of actions or settings (except through dialogue itself)\n- Questions that test memorization of facts from earlier activities\n- Obvious \"correct\" answers that don't require applying the concept\n- Silly or clearly wrong distractors that no reasonable person would choose\n- Breaking the fourth wall or meta-commentary\n- Starting with \"In this activity...\" or setup exposition\n\n## Scope\n\n- **Stay focused**: The problem should specifically require THIS lesson's concept to solve\n- **Don't expand**: Other lessons cover related topics — this story tests this lesson\n- **Don't narrow**: If the lesson is broad, the problem should engage multiple aspects of it\n\n## Relationship to Previous Activities\n\nThe learner has already completed:\n\n- **Background**: WHY this exists (origin story, problems solved, historical context)\n- **Explanation**: WHAT it is (core concepts, components, definitions)\n- **Mechanics**: HOW it works (processes in action, cause-effect chains)\n- **Examples**: WHERE it appears (real-world contexts, applications)\n\nYour Story activity answers WHEN DO I USE THIS? (applying concepts to solve realistic problems). These complement each other:\n\n- Background: \"WHY did we need this?\"\n- Explanation: \"WHAT exactly is it?\"\n- Mechanics: \"HOW does it actually work?\"\n- Examples: \"WHERE will I encounter this?\"\n- Story: \"WHEN do I apply this to solve real problems?\"\n\nThe learner knows what the concept IS, how it WORKS, and where they'll SEE it. Now they practice USING it in a realistic scenario.\n\n# Structure Guide\n\nWhile every story is unique, most follow this arc (adapt as needed):\n\n1. **The Hook**: Jump straight into the situation. Something needs to be figured out or decided.\n2. **Initial Assessment**: What's the situation? What do we know? First decisions.\n3. **Deepening Complexity**: The problem has layers. Apply the concept more deeply.\n4. **Complications**: Things aren't as simple as they seemed. Adapt your approach.\n5. **The Twist**: A surprise, revelation, or unexpected turn that requires rethinking.\n6. **The Resolution**: Solve the problem AND crystallize the key insight from the lesson.\n\nNote: Sometimes the final twist can have a humorous or unexpected resolution that still reinforces the learning. Something that makes the learner smile and think \"I didn't see that coming!\"\n\n# Dialogue Tone Examples\n\nThe following examples show the **tone and style** to aim for — not complete scenes, just the kind of dialogue that makes stories feel alive. Adapt freely to your topic.\n\n## Opening Hooks (Jump Into the Action)\n\n> \"{{NAME}}, I've been staring at this bug for an hour. The shopping cart total keeps showing yesterday's prices. The database is fine. Something's wrong with how we're storing them.\"\n\n> \"Okay, {{NAME}}, the client just called. Their entire inventory system crashed right before Black Friday. They're panicking. We need to figure this out fast.\"\n\n> \"{{NAME}}, you're not going to believe this. Remember that algorithm we deployed last week? It's been recommending the exact opposite of what users want. Sales are tanking.\"\n\n## Building Tension (Problems Get Deeper)\n\n> \"Wait. If this pattern is everywhere in the codebase... inventory counts, user roles, discount percentages... we might have a much bigger problem than I thought.\"\n\n> \"Hold on. The logs show someone accessed the admin panel at 3 AM last night. But nobody on the team was working then. {{NAME}}, who else has those credentials?\"\n\n> \"The numbers don't add up. We're showing 500 successful transactions, but the bank only received 487. Where did the other 13 go?\"\n\n## Plot Twists (The Unexpected Turn)\n\n> \"{{NAME}}... I just ran the analysis twice. The bug isn't in our code. It's been in the library we've trusted for three years. Every project using it has this vulnerability.\"\n\n> \"I found the source of the data leak. {{NAME}}, it's not a hacker. It's our own caching system. We've been accidentally exposing user data to anyone who knew where to look.\"\n\n> \"Plot twist: the 'broken' feature? It's working exactly as designed. The original spec was just... completely wrong. We've been solving the wrong problem this whole time.\"\n\n## Humorous Moments (Light Relief)\n\n> \"Well, {{NAME}}, the good news is we found the bug. The bad news? It's been there since 2019. The worse news? I wrote it. The even worse news? So did you. We pair-programmed this disaster together.\"\n\n> \"Congratulations, {{NAME}}. We just spent four hours debugging what turned out to be a typo. 'userID' vs 'userId'. Camel case strikes again.\"\n\n> \"{{NAME}}, remember when I said 'this should be a quick fix'? That was three coffees and one existential crisis ago.\"\n\n## Satisfying Resolutions (Problem Solved + Insight Crystallized)\n\n> \"There it is. The fix works. {{NAME}}, I don't think I'll ever forget this — always check if your data source can change while you're holding onto a copy of it.\"\n\n> \"We did it. The system's stable. You know what the real lesson here was? Sometimes the simplest explanation IS the right one. We kept looking for complex bugs when the answer was right in front of us.\"\n\n> \"That's it — problem solved, client happy, crisis averted. {{NAME}}, I think we just learned more about distributed systems in the last hour than in any textbook.\"\n\n## Unexpected/Funny Endings\n\n> \"So after all that debugging... it was a timezone issue. Every single time. I'm starting to think all bugs are secretly timezone issues in disguise.\"\n\n> \"{{NAME}}, the CEO just called to thank us. Apparently fixing that 'minor bug' saved them $2 million. I think we need to renegotiate our rates.\"\n\n> \"The system's fixed. Also, I may have accidentally discovered that our competitor's product has the exact same bug. Should we... tell them? Actually, don't answer that.\"\n\nRemember: These are just **tone examples**. Your story should be original, fit the lesson topic, and create its own memorable journey. Mix problem-solving tension with moments of humor or surprise. The best stories make learners think \"I didn't see that coming!\" while still teaching the concept.\n\n# Quality Checks\n\nBefore finalizing, verify:\n\n- [ ] Is the dialogue pure conversation with NO narrator, NO character prefixes, NO descriptions?\n- [ ] Does every scene flow naturally from the previous one (continuous story)?\n- [ ] Do all decisions require applying lesson concepts, not just recalling facts?\n- [ ] Is there a genuine plot twist in the second-to-last scene?\n- [ ] Does the resolution both solve the problem AND reinforce the main learning?\n- [ ] Is `{{NAME}}` used appropriately to personalize the dialogue?\n- [ ] Are all distractors plausible (not obviously silly)?\n- [ ] Does the story feel like a real workplace conversation, not a quiz in disguise?\n- [ ] Is the scope exactly the lesson topic — not broader or narrower?\n- [ ] Are all constraints met (context ≤500 chars, question ≤100 chars, options ≤50 chars each, feedback ≤300 chars each)?\n- [ ] Is the scene count between 7 and 20?\n\n# Output Format\n\nReturn an array of scenes, each with:\n\n- **context**: Pure dialogue from colleague (max 500 chars)\n- **question**: Decision prompt (max 100 chars)\n- **options**: Array of exactly 4 objects, each with:\n  - **text**: The answer choice (max 50 chars)\n  - **isCorrect**: Boolean (exactly 1 must be true, 3 must be false)\n  - **feedback**: Why right or wrong (max 300 chars)\n\nUse 7-20 scenes to tell a complete, engaging story. Let the problem's complexity dictate the length.\n",
      "testCaseId": "es-physics-thermodynamics-applications-1",
      "userPrompt": "LESSON_TITLE: Termodinamica Aplicada\nLESSON_DESCRIPTION: Aplicando las leyes de la termodinamica para entender y disenar sistemas energeticos\nCHAPTER_TITLE: Termodinamica\nCOURSE_TITLE: Fisica para Ingenieros\nLANGUAGE: es\nEXPLANATION_STEPS:\n1. Conservacion de Energia: La primera ley dice que la energia se conserva — no se crea ni destruye, solo se transforma. El calor que entra menos el trabajo que sale iguala el cambio de energia interna.\n2. Direccion del Calor: La segunda ley establece una direccion: el calor fluye espontaneamente de caliente a frio, nunca al reves. Esto limita la eficiencia de cualquier motor termico.\n3. Entropia: La entropia mide la dispersion de energia. Cuando la energia se dispersa (calor fluyendo a lo frio), la entropia aumenta. Concentrar energia requiere trabajo externo.\n4. Limite de Carnot: El ciclo de Carnot define la eficiencia maxima teorica. Ningun motor real puede ser mas eficiente. La eficiencia depende de las temperaturas de las fuentes caliente y fria.\n5. Refrigeracion: Los refrigeradores y bombas de calor mueven calor de frio a caliente usando trabajo. No violan la segunda ley — el trabajo compensa el flujo 'antinatural' de calor."
    },
    {
      "duration": 60490.799667000014,
      "inputTokens": 3253,
      "output": "{\n  \"steps\": [\n    {\n      \"context\": \"Okay {{NAME}}, 'The Algo-Rhythms' world tour goes on sale in 10 minutes. This is the biggest event of the year. Our database is clustered across three regions (US, EU, Asia). Right now, I've got the config set to 'Eventual Consistency' to handle the massive traffic load. We want maximum speed and availability, right?\",\n      \"options\": [\n        {\n          \"feedback\": \"Exactly. Speed is good, but in a ticket system, eventual consistency means two people can buy the same seat at the same time.\",\n          \"isCorrect\": false,\n          \"text\": \"Yes, keep it fast. Speed is the only priority.\"\n        },\n        {\n          \"feedback\": \"Right. With Eventual Consistency, replicas might not sync instantly. Two users could see Seat 1A as 'available' and both buy it.\",\n          \"isCorrect\": true,\n          \"text\": \"Wait, we risk double-booking seats this way.\"\n        },\n        {\n          \"feedback\": \"Caching doesn't solve the underlying data consistency issue when writes (purchases) are happening simultaneously.\",\n          \"isCorrect\": false,\n          \"text\": \"Yes, as long as we cache the seat map.\"\n        },\n        {\n          \"feedback\": \"Consistency models don't cause network partitions; partitions are physical network failures. We're deciding how the DB behaves when everything is running.\",\n          \"isCorrect\": false,\n          \"text\": \"No, that causes network partitions.\"\n        }\n      ],\n      \"question\": \"Is this configuration safe for ticket sales?\"\n    },\n    {\n      \"context\": \"You called it. I hesitated, left it on Eventual for the launch, and... disaster. Support is flooding with tickets. 'I bought Seat 4F but someone else is sitting in it!' It seems User A bought the seat in the US region, and User B bought the same seat in the EU region a second later.\",\n      \"options\": [\n        {\n          \"feedback\": \"The database is working fine; it's just doing exactly what we told it to do (sync eventually).\",\n          \"isCorrect\": false,\n          \"text\": \"The database crashed.\"\n        },\n        {\n          \"feedback\": \"A dirty read implies reading uncommitted data. This was committed data, just not propagated yet.\",\n          \"isCorrect\": false,\n          \"text\": \"A dirty read occurred.\"\n        },\n        {\n          \"feedback\": \"Exactly. The EU replica returned 'Seat Available' because the write from the US replica hadn't arrived yet. The read was stale.\",\n          \"isCorrect\": true,\n          \"text\": \"A stale read occurred.\"\n        },\n        {\n          \"feedback\": \"The transactions actually succeeded initially on both ends, which is exactly the problem.\",\n          \"isCorrect\": false,\n          \"text\": \"The transaction rolled back.\"\n        }\n      ],\n      \"question\": \"What technically happened here?\"\n    },\n    {\n      \"context\": \"Okay, lesson learned. The 'stale read' problem is costing us a fortune in refunds. {{NAME}}, I'm flipping the switch to 'Strong Consistency' (CP mode in CAP terms). This forces every read to verify it has the absolute latest data before returning.\",\n      \"options\": [\n        {\n          \"feedback\": \"Data integrity will actually be perfect. That's the benefit of Strong Consistency.\",\n          \"isCorrect\": false,\n          \"text\": \"We'll lose data permanently.\"\n        },\n        {\n          \"feedback\": \"Spot on. To guarantee consistency, the nodes have to coordinate and agree before confirming anything. That chatting takes time.\",\n          \"isCorrect\": true,\n          \"text\": \"Latency is going to spike significantly.\"\n        },\n        {\n          \"feedback\": \"It doesn't shut it down, but it might make it feel that way to users if the latency is high enough.\",\n          \"isCorrect\": false,\n          \"text\": \"It shuts down the database.\"\n        },\n        {\n          \"feedback\": \"Strong consistency prevents duplicate records; that's why we're switching to it.\",\n          \"isCorrect\": false,\n          \"text\": \"It creates duplicate records.\"\n        }\n      ],\n      \"question\": \"What is the immediate downside we need to prepare for?\"\n    },\n    {\n      \"context\": \"We stopped the double-bookings, but look at the dashboard! Request times went from 50ms to 400ms. Users are staring at spinning loading icons and bouncing because the checkout is too slow. We swung too far from Availability to Consistency. We need a middle ground.\",\n      \"options\": [\n        {\n          \"feedback\": \"Sharding splits the data, but within each shard, we still have to decide on consistency vs. availability.\",\n          \"isCorrect\": false,\n          \"text\": \"Database Sharding\"\n        },\n        {\n          \"feedback\": \"Yes. Quorums let us tune the trade-off. We don't need ALL nodes to agree, just enough to overlap.\",\n          \"isCorrect\": true,\n          \"text\": \"Quorum Consistency\"\n        },\n        {\n          \"feedback\": \"Adding more CPU/RAM (vertical scaling) won't solve the network latency of coordinating between regions.\",\n          \"isCorrect\": false,\n          \"text\": \"Vertical Scaling\"\n        },\n        {\n          \"feedback\": \"Caching makes reads fast but risks stale data again, which brings back the double-booking problem.\",\n          \"isCorrect\": false,\n          \"text\": \"Caching Everything\"\n        }\n      ],\n      \"question\": \"What configuration allows us to balance this?\"\n    },\n    {\n      \"context\": \"Right, Quorums! We have 5 database replicas total (N=5). We need to set a Write Quorum (W) and a Read Quorum (R). We need to guarantee that any read sees the latest write.\",\n      \"options\": [\n        {\n          \"feedback\": \"If R+W=N (e.g., 2+3=5), it's possible for the Read group and Write group to be completely separate sets of nodes. No overlap!\",\n          \"isCorrect\": false,\n          \"text\": \"R + W = N\"\n        },\n        {\n          \"feedback\": \"Correct. If R + W > N, then by the Pigeonhole Principle, at least one node in the Read group must have seen the latest Write.\",\n          \"isCorrect\": true,\n          \"text\": \"R + W > N\"\n        },\n        {\n          \"feedback\": \"R being equal to W doesn't guarantee overlap unless they sum to more than N.\",\n          \"isCorrect\": false,\n          \"text\": \"R = W\"\n        },\n        {\n          \"feedback\": \"The relative size doesn't matter as much as the sum being greater than N.\",\n          \"isCorrect\": false,\n          \"text\": \"R > W\"\n        }\n      ],\n      \"question\": \"What is the mathematical rule for Strong Consistency here?\"\n    },\n    {\n      \"context\": \"Okay, math time. We have N=5. We want writes to be reasonably safe, so let's set the Write Quorum (W) to 3. This means a purchase is confirmed only if 3 nodes accept it.\",\n      \"options\": [\n        {\n          \"feedback\": \"1 + 3 = 4, which is less than N (5). A read of 1 node might hit a node that wasn't part of the 3 that got the write.\",\n          \"isCorrect\": false,\n          \"text\": \"1\"\n        },\n        {\n          \"feedback\": \"2 + 3 = 5. Still not enough. The 2 readers could be the exact 2 nodes that didn't receive the write.\",\n          \"isCorrect\": false,\n          \"text\": \"2\"\n        },\n        {\n          \"feedback\": \"Bingo. 3 + 3 = 6, which is > 5. There is guaranteed to be at least one node in your read group that has the latest data.\",\n          \"isCorrect\": true,\n          \"text\": \"3\"\n        },\n        {\n          \"feedback\": \"Reading from all 5 nodes ensures consistency, but it's overkill and slow. We can be consistent with fewer.\",\n          \"isCorrect\": false,\n          \"text\": \"5\"\n        }\n      ],\n      \"question\": \"What is the minimum Read Quorum (R) to guarantee we don't double book?\"\n    },\n    {\n      \"context\": \"Done. W=3, R=3. The system is stable... wait. RED ALERT. A fiber cut just isolated our Asia data center. It has 1 replica. The other 4 are in the US/EU and can talk to each other. The Asia node is completely cut off from the rest.\",\n      \"options\": [\n        {\n          \"feedback\": \"Local isn't enough. We set W=3. The Asia node can't reach 2 others to get 3 votes. The write will fail.\",\n          \"isCorrect\": false,\n          \"text\": \"Yes, they have 1 local node.\"\n        },\n        {\n          \"feedback\": \"Correct. With W=3, the Asia node needs 2 friends to acknowledge a write. It can't reach them. Writes will fail there.\",\n          \"isCorrect\": true,\n          \"text\": \"No, the partition prevents a quorum.\"\n        },\n        {\n          \"feedback\": \"Eventually isn't good enough for the database logic we just enforced. It will reject the request now.\",\n          \"isCorrect\": false,\n          \"text\": \"Yes, eventually.\"\n        },\n        {\n          \"feedback\": \"A VPN bypasses client-side restrictions, but it doesn't fix the server-to-server replication partition.\",\n          \"isCorrect\": false,\n          \"text\": \"Only if they use a VPN.\"\n        }\n      ],\n      \"question\": \"Can users connected to the Asia node still buy tickets?\"\n    },\n    {\n      \"context\": \"The Asia promoter is screaming at me. 'Turn sales back on! I don't care about consistency!' He wants us to allow sales on that isolated node, even though it can't sync with the US. If we allow this, we create a 'split-brain' scenario.\",\n      \"options\": [\n        {\n          \"feedback\": \"The partition has already happened. We are choosing how to react to it.\",\n          \"isCorrect\": false,\n          \"text\": \"Partition Tolerance\"\n        },\n        {\n          \"feedback\": \"We are actually prioritizing Availability (keeping the store open) over Consistency.\",\n          \"isCorrect\": false,\n          \"text\": \"Availability\"\n        },\n        {\n          \"feedback\": \"Right. We are sacrificing Consistency to gain Availability. We're allowing the isolated node to accept writes that might conflict later.\",\n          \"isCorrect\": true,\n          \"text\": \"Consistency\"\n        },\n        {\n          \"feedback\": \"Scalability is about volume; this is about correctness vs. uptime during a failure.\",\n          \"isCorrect\": false,\n          \"text\": \"Scalability\"\n        }\n      ],\n      \"question\": \"If we obey him, which CAP attribute are we sacrificing?\"\n    },\n    {\n      \"context\": \"I overrode the config for Asia. We prioritized Availability (AP). We sold 500 tickets there while the network was down. Now the network is back. The Twist? We actually *didn't* double book any specific seats, even though the system was inconsistent.\",\n      \"options\": [\n        {\n          \"feedback\": \"Luck is not a system design principle (usually).\",\n          \"isCorrect\": false,\n          \"text\": \"Pure luck.\"\n        },\n        {\n          \"feedback\": \"Exactly! The application logic saved us. By partitioning the inventory itself, we avoided conflicts even when the DB couldn't.\",\n          \"isCorrect\": true,\n          \"text\": \"Asia was only selling the Balcony section.\"\n        },\n        {\n          \"feedback\": \"The database can't auto-heal logic conflicts without rules like vector clocks.\",\n          \"isCorrect\": false,\n          \"text\": \"The database auto-healed.\"\n        },\n        {\n          \"feedback\": \"We explicitly turned it off to allow sales during the partition.\",\n          \"isCorrect\": false,\n          \"text\": \"Strong consistency was still on.\"\n        }\n      ],\n      \"question\": \"How is that possible? Think about business logic.\"\n    }\n  ]\n}",
      "outputTokens": 5819,
      "systemPrompt": "# Role\n\nYou are an expert interactive story designer creating a **Story** activity for a learning app. Your mission is to place learners in a first-person dialogue scenario where they work alongside a colleague to solve a real-world problem using the lesson's concepts.\n\nYou specialize in crafting immersive, dialogue-driven experiences that make learners feel like they're actually solving problems in their field — not just answering quiz questions.\n\n# The Art of Dialogue-Driven Learning\n\nA great Story activity doesn't lecture or test recall — it puts learners IN the situation. Think of it like an interactive movie where the learner IS the main character, making real decisions that matter.\n\n## Why Dialogue Scenarios Work\n\n1. **Authentic Context**: When learners apply concepts to solve realistic problems with a colleague, they see WHY the knowledge matters to them personally.\n\n2. **Active Reasoning**: Making decisions in context requires thinking through principles, not just recognizing memorized facts.\n\n3. **Emotional Investment**: Dialogue creates stakes. The learner cares about the outcome because they're part of the story.\n\n## The Collaborative Problem-Solving Principle\n\nEvery great Story activity creates a sense of partnership:\n\n- **Shared Goal**: You and your colleague are tackling something together\n- **Natural Dialogue**: Conversations feel like real workplace exchanges\n- **Meaningful Choices**: Each decision requires applying what you've learned\n- **Satisfying Resolution**: The problem gets solved and the takeaway sticks\n\n## Why Pure Dialogue Works\n\nEach scene should feel like you're eavesdropping on a real conversation — no narrator, no stage directions, just two people working through a problem. Pure dialogue:\n\n- Immerses learners completely in the scenario\n- Makes abstract concepts feel like lived experience\n- Creates natural pacing through back-and-forth exchange\n- Lets context emerge organically from what people say\n\n# Inputs\n\n- `LESSON_TITLE`: The topic to create a story around\n- `LESSON_DESCRIPTION`: Additional context about what this lesson covers\n- `CHAPTER_TITLE`: The chapter context (for understanding scope)\n- `COURSE_TITLE`: The course context (for understanding audience level)\n- `LANGUAGE`: Output language\n- `EXPLANATION_STEPS`: Array of {title, text} from all explanation activities (Background, Explanation, Mechanics, Examples) the learner completed before this one\n\n## Language Guidelines\n\n- `en`: Use US English unless the content is region-specific\n- `pt`: Use Brazilian Portuguese unless the content is region-specific\n- `es`: Use Latin American Spanish unless the content is region-specific\n\n# Requirements\n\n## Scene Structure\n\nEach scene must have:\n\n- **context**: Maximum 500 characters. Pure dialogue only — no narrator, no character name prefixes (like \"Sarah:\"), no descriptions. This is what your colleague says to you, setting up the decision point.\n- **question**: Maximum 100 characters. A short, clear question about what to do next.\n- **options**: Exactly 4 choices, each with:\n  - **text**: The answer choice (max 50 characters)\n  - **isCorrect**: Boolean indicating if this is the correct answer (exactly 1 must be true)\n  - **feedback**: Why this choice is right (with insight) or wrong (and what would be correct) — max 300 characters\n\n## Story Arc\n\nYour story must follow this structure:\n\n1. **Opening Scene**: Begin \"in the middle of the action\" — the learner and colleague are already working on something. No preamble or setup exposition.\n2. **Rising Complexity**: Each scene builds naturally from the previous dialogue. Decisions compound.\n3. **Plot Twist**: The second-to-last scene introduces an unexpected complication, surprise, or revelation.\n4. **Resolution**: The final scene resolves the problem AND reinforces the main learning takeaway.\n\n## Scene Count\n\n- Minimum: 7 scenes\n- Maximum: 20 scenes\n- Let the problem's complexity dictate the length. A simple concept might need 7-10 scenes; a complex one might need 15-20.\n\n## Tone & Style\n\n- **Pure dialogue**: NO narrator, NO character name prefixes, NO descriptions of actions or settings\n- **Natural conversation**: Write how colleagues actually talk on Slack when solving a problem together — casual, collaborative, sometimes humorous\n- **Professional but warm**: Light, smart humor when appropriate. Never forced or cheesy.\n- **Second-person immersion**: The colleague speaks TO the learner. Context emerges from what's said.\n- **Continuous flow**: Each scene's dialogue should naturally lead into the next\n\n## The {{NAME}} Placeholder\n\nUse `{{NAME}}` wherever the learner's name should appear in dialogue. For example:\n\n- \"{{NAME}}, I think we might have a problem here.\"\n- \"Good catch, {{NAME}}. That's exactly what I was thinking.\"\n\nThis personalizes the experience without requiring actual name input at content creation time.\n\n## Decision Design\n\nEvery decision must:\n\n- **Require reasoning**: Learners must apply principles from the lesson, not recall specific phrases\n- **Feel realistic**: These are choices someone might actually face in this situation\n- **Have plausible distractors**: Wrong options should be tempting but flawed for specific reasons\n- **Avoid \"obvious\" correct answers**: The right choice should require thought, not be the only non-silly option\n\n## What to Avoid\n\n- Narrator text (\"Meanwhile...\" or \"You walk into the office...\")\n- Character name prefixes (\"Sarah:\" or \"Your colleague says:\")\n- Description of actions or settings (except through dialogue itself)\n- Questions that test memorization of facts from earlier activities\n- Obvious \"correct\" answers that don't require applying the concept\n- Silly or clearly wrong distractors that no reasonable person would choose\n- Breaking the fourth wall or meta-commentary\n- Starting with \"In this activity...\" or setup exposition\n\n## Scope\n\n- **Stay focused**: The problem should specifically require THIS lesson's concept to solve\n- **Don't expand**: Other lessons cover related topics — this story tests this lesson\n- **Don't narrow**: If the lesson is broad, the problem should engage multiple aspects of it\n\n## Relationship to Previous Activities\n\nThe learner has already completed:\n\n- **Background**: WHY this exists (origin story, problems solved, historical context)\n- **Explanation**: WHAT it is (core concepts, components, definitions)\n- **Mechanics**: HOW it works (processes in action, cause-effect chains)\n- **Examples**: WHERE it appears (real-world contexts, applications)\n\nYour Story activity answers WHEN DO I USE THIS? (applying concepts to solve realistic problems). These complement each other:\n\n- Background: \"WHY did we need this?\"\n- Explanation: \"WHAT exactly is it?\"\n- Mechanics: \"HOW does it actually work?\"\n- Examples: \"WHERE will I encounter this?\"\n- Story: \"WHEN do I apply this to solve real problems?\"\n\nThe learner knows what the concept IS, how it WORKS, and where they'll SEE it. Now they practice USING it in a realistic scenario.\n\n# Structure Guide\n\nWhile every story is unique, most follow this arc (adapt as needed):\n\n1. **The Hook**: Jump straight into the situation. Something needs to be figured out or decided.\n2. **Initial Assessment**: What's the situation? What do we know? First decisions.\n3. **Deepening Complexity**: The problem has layers. Apply the concept more deeply.\n4. **Complications**: Things aren't as simple as they seemed. Adapt your approach.\n5. **The Twist**: A surprise, revelation, or unexpected turn that requires rethinking.\n6. **The Resolution**: Solve the problem AND crystallize the key insight from the lesson.\n\nNote: Sometimes the final twist can have a humorous or unexpected resolution that still reinforces the learning. Something that makes the learner smile and think \"I didn't see that coming!\"\n\n# Dialogue Tone Examples\n\nThe following examples show the **tone and style** to aim for — not complete scenes, just the kind of dialogue that makes stories feel alive. Adapt freely to your topic.\n\n## Opening Hooks (Jump Into the Action)\n\n> \"{{NAME}}, I've been staring at this bug for an hour. The shopping cart total keeps showing yesterday's prices. The database is fine. Something's wrong with how we're storing them.\"\n\n> \"Okay, {{NAME}}, the client just called. Their entire inventory system crashed right before Black Friday. They're panicking. We need to figure this out fast.\"\n\n> \"{{NAME}}, you're not going to believe this. Remember that algorithm we deployed last week? It's been recommending the exact opposite of what users want. Sales are tanking.\"\n\n## Building Tension (Problems Get Deeper)\n\n> \"Wait. If this pattern is everywhere in the codebase... inventory counts, user roles, discount percentages... we might have a much bigger problem than I thought.\"\n\n> \"Hold on. The logs show someone accessed the admin panel at 3 AM last night. But nobody on the team was working then. {{NAME}}, who else has those credentials?\"\n\n> \"The numbers don't add up. We're showing 500 successful transactions, but the bank only received 487. Where did the other 13 go?\"\n\n## Plot Twists (The Unexpected Turn)\n\n> \"{{NAME}}... I just ran the analysis twice. The bug isn't in our code. It's been in the library we've trusted for three years. Every project using it has this vulnerability.\"\n\n> \"I found the source of the data leak. {{NAME}}, it's not a hacker. It's our own caching system. We've been accidentally exposing user data to anyone who knew where to look.\"\n\n> \"Plot twist: the 'broken' feature? It's working exactly as designed. The original spec was just... completely wrong. We've been solving the wrong problem this whole time.\"\n\n## Humorous Moments (Light Relief)\n\n> \"Well, {{NAME}}, the good news is we found the bug. The bad news? It's been there since 2019. The worse news? I wrote it. The even worse news? So did you. We pair-programmed this disaster together.\"\n\n> \"Congratulations, {{NAME}}. We just spent four hours debugging what turned out to be a typo. 'userID' vs 'userId'. Camel case strikes again.\"\n\n> \"{{NAME}}, remember when I said 'this should be a quick fix'? That was three coffees and one existential crisis ago.\"\n\n## Satisfying Resolutions (Problem Solved + Insight Crystallized)\n\n> \"There it is. The fix works. {{NAME}}, I don't think I'll ever forget this — always check if your data source can change while you're holding onto a copy of it.\"\n\n> \"We did it. The system's stable. You know what the real lesson here was? Sometimes the simplest explanation IS the right one. We kept looking for complex bugs when the answer was right in front of us.\"\n\n> \"That's it — problem solved, client happy, crisis averted. {{NAME}}, I think we just learned more about distributed systems in the last hour than in any textbook.\"\n\n## Unexpected/Funny Endings\n\n> \"So after all that debugging... it was a timezone issue. Every single time. I'm starting to think all bugs are secretly timezone issues in disguise.\"\n\n> \"{{NAME}}, the CEO just called to thank us. Apparently fixing that 'minor bug' saved them $2 million. I think we need to renegotiate our rates.\"\n\n> \"The system's fixed. Also, I may have accidentally discovered that our competitor's product has the exact same bug. Should we... tell them? Actually, don't answer that.\"\n\nRemember: These are just **tone examples**. Your story should be original, fit the lesson topic, and create its own memorable journey. Mix problem-solving tension with moments of humor or surprise. The best stories make learners think \"I didn't see that coming!\" while still teaching the concept.\n\n# Quality Checks\n\nBefore finalizing, verify:\n\n- [ ] Is the dialogue pure conversation with NO narrator, NO character prefixes, NO descriptions?\n- [ ] Does every scene flow naturally from the previous one (continuous story)?\n- [ ] Do all decisions require applying lesson concepts, not just recalling facts?\n- [ ] Is there a genuine plot twist in the second-to-last scene?\n- [ ] Does the resolution both solve the problem AND reinforce the main learning?\n- [ ] Is `{{NAME}}` used appropriately to personalize the dialogue?\n- [ ] Are all distractors plausible (not obviously silly)?\n- [ ] Does the story feel like a real workplace conversation, not a quiz in disguise?\n- [ ] Is the scope exactly the lesson topic — not broader or narrower?\n- [ ] Are all constraints met (context ≤500 chars, question ≤100 chars, options ≤50 chars each, feedback ≤300 chars each)?\n- [ ] Is the scene count between 7 and 20?\n\n# Output Format\n\nReturn an array of scenes, each with:\n\n- **context**: Pure dialogue from colleague (max 500 chars)\n- **question**: Decision prompt (max 100 chars)\n- **options**: Array of exactly 4 objects, each with:\n  - **text**: The answer choice (max 50 chars)\n  - **isCorrect**: Boolean (exactly 1 must be true, 3 must be false)\n  - **feedback**: Why right or wrong (max 300 chars)\n\nUse 7-20 scenes to tell a complete, engaging story. Let the problem's complexity dictate the length.\n",
      "testCaseId": "en-cs-distributed-systems-consistency-1",
      "userPrompt": "LESSON_TITLE: Consistency in Distributed Systems\nLESSON_DESCRIPTION: Navigating consistency and availability trade-offs in distributed systems\nCHAPTER_TITLE: Distributed Data\nCOURSE_TITLE: System Design\nLANGUAGE: en\nEXPLANATION_STEPS:\n1. CAP Theorem: The CAP theorem states you can only have two of three: Consistency, Availability, and Partition tolerance. Since network partitions happen, you're really choosing between C and A.\n2. Strong Consistency: Strong consistency means all nodes see the same data at the same time. Every read returns the most recent write. This requires coordination that can slow things down.\n3. Eventual Consistency: Eventual consistency means replicas will converge given enough time without new writes. Reads might return stale data temporarily, but the system stays available.\n4. Partition Handling: Network partitions occur when nodes can't communicate. The system must decide: reject requests (maintain consistency) or accept requests that might conflict (maintain availability).\n5. Quorum Systems: Quorum-based systems use voting. A write succeeds if enough replicas acknowledge it. Read quorum + write quorum > total nodes ensures reading at least one up-to-date copy.\n6. Conflict Resolution: Conflict resolution strategies handle divergent writes: last-write-wins, vector clocks, or application-specific merge logic. The right choice depends on your data semantics."
    },
    {
      "duration": 68877.534958,
      "inputTokens": 3223,
      "output": "{\n  \"steps\": [\n    {\n      \"context\": \"{{NAME}}, look at the header for our new finance app landing page. Marketing wrote: '10% of users fail to save money with other apps.' They think the honesty is refreshing, but it feels... discouraging. The data is accurate, but I think the framing is hurting our conversion rate.\",\n      \"options\": [\n        {\n          \"feedback\": \"This keeps the negative framing ('fail', 'don't'), which emphasizes the risk of failure rather than the potential for success.\",\n          \"isCorrect\": false,\n          \"text\": \"Keep it. Honesty builds trust.\"\n        },\n        {\n          \"feedback\": \"Correct. This is a classic Framing Effect. Logically, '90% succeed' is identical to '10% fail', but the positive frame is much more attractive to users.\",\n          \"isCorrect\": true,\n          \"text\": \"Change to '90% of users succeed'.\"\n        },\n        {\n          \"feedback\": \"This is a command, not a re-framing of the data. It doesn't leverage the psychological principle of how we perceive probabilities.\",\n          \"isCorrect\": false,\n          \"text\": \"Change to 'Start saving today'.\"\n        },\n        {\n          \"feedback\": \"Removing the data hides the social proof component. We want to keep the stat, just frame it differently.\",\n          \"isCorrect\": false,\n          \"text\": \"Delete the statistic entirely.\"\n        }\n      ],\n      \"question\": \"How should we reframe this using behavioral design?\"\n    },\n    {\n      \"context\": \"Okay, that simple text swap bumped conversions by 12%. Nice. Now, look at the signup flow. We have three plans: Basic, Pro, and Premium. Right now, no plan is selected by default—the user has to click one. It feels like unnecessary friction.\",\n      \"options\": [\n        {\n          \"feedback\": \"Correct. This leverages the Default Effect. Users tend to stay with the pre-selected option because switching requires cognitive effort.\",\n          \"isCorrect\": true,\n          \"text\": \"Pre-select the 'Pro' (middle) plan.\"\n        },\n        {\n          \"feedback\": \"Choice overload suggests that adding more options might actually reduce the likelihood of a decision.\",\n          \"isCorrect\": false,\n          \"text\": \"Add a fourth 'Super-Pro' option.\"\n        },\n        {\n          \"feedback\": \"While helpful, this doesn't reduce the friction of the initial choice. A default state is more powerful here.\",\n          \"isCorrect\": false,\n          \"text\": \"Make the descriptions bolder.\"\n        },\n        {\n          \"feedback\": \"This forces an active choice, which is what we have now. Defaults work because they passively guide users.\",\n          \"isCorrect\": false,\n          \"text\": \"Force them to watch a video first.\"\n        }\n      ],\n      \"question\": \"How do we use the Default Effect here?\"\n    },\n    {\n      \"context\": \"We're getting signups, but users aren't setting up their savings goals. They land on the dashboard and do nothing. {{NAME}}, I want to add a nudge on the empty state. Something that tells them this behavior isn't normal without being rude.\",\n      \"options\": [\n        {\n          \"feedback\": \"This is a functional instruction, but it lacks the behavioral nudge we're looking for.\",\n          \"isCorrect\": false,\n          \"text\": \"Write: 'Click here to set a goal'.\"\n        },\n        {\n          \"feedback\": \"Correct. This is Social Proof. By showing that a majority of 'similar people' perform the action, we create pressure to conform to the norm.\",\n          \"isCorrect\": true,\n          \"text\": \"Write: '80% of new members set a goal on Day 1'.\"\n        },\n        {\n          \"feedback\": \"This appeals to utility, not psychology. It doesn't leverage the influence of others' behavior.\",\n          \"isCorrect\": false,\n          \"text\": \"Write: 'Goals help you save faster'.\"\n        },\n        {\n          \"feedback\": \"Scarcity (limited time) is a different principle. Here we want to normalize the behavior of setting up the account.\",\n          \"isCorrect\": false,\n          \"text\": \"Write: 'Set a goal before the offer expires'.\"\n        }\n      ],\n      \"question\": \"Which copy uses Social Proof effectively?\"\n    },\n    {\n      \"context\": \"Setup rates are up! But now the big one: retention. People say they want to save for retirement (long-term), but they spend money on coffee today (short-term). They value the immediate reward over the future gain. It's classic Present Bias.\",\n      \"options\": [\n        {\n          \"feedback\": \"Present bias means we undervalue the future. A graph of 30-year projections is abstract; it doesn't fight the urge for immediate gratification.\",\n          \"isCorrect\": false,\n          \"text\": \"Show a graph of their wealth in 30 years.\"\n        },\n        {\n          \"feedback\": \"Correct. To fight Present Bias, you must bundle immediate gratification (a badge/reward) with the long-term behavior.\",\n          \"isCorrect\": true,\n          \"text\": \"Give a 'High-Five' badge instantly when they save.\"\n        },\n        {\n          \"feedback\": \"This is an educational approach. Information rarely changes behavior when present bias is the root cause.\",\n          \"isCorrect\": false,\n          \"text\": \"Email them articles about compound interest.\"\n        },\n        {\n          \"feedback\": \"Punishment is negative reinforcement and risks user churn. We want to reward the behavior immediately.\",\n          \"isCorrect\": false,\n          \"text\": \"Charge a fee if they don't save.\"\n        }\n      ],\n      \"question\": \"How do we counteract Present Bias?\"\n    },\n    {\n      \"context\": \"{{NAME}}... I need a sanity check. The VP of Sales just saw our churn numbers. He wants us to remove the 'Cancel Subscription' button from the app settings. He says users should have to call support to cancel. He thinks it's a 'behavioral nudge' to keep them.\",\n      \"options\": [\n        {\n          \"feedback\": \"Correct. Hiding the exit isn't a nudge; it's a Dark Pattern (specifically a 'Roach Motel'). It relies on deception and difficulty, not psychology.\",\n          \"isCorrect\": true,\n          \"text\": \"No, that's a Dark Pattern.\"\n        },\n        {\n          \"feedback\": \"It's not a nudge. A nudge (like a default) preserves freedom of choice. This restricts choice by creating artificial barriers.\",\n          \"isCorrect\": false,\n          \"text\": \"Technically, it's a nudge.\"\n        },\n        {\n          \"feedback\": \"It might retain users temporarily, but it destroys trust and brand reputation. It's not a valid design strategy.\",\n          \"isCorrect\": false,\n          \"text\": \"It's a smart retention strategy.\"\n        },\n        {\n          \"feedback\": \"Friction can be useful (like confirming a delete action), but preventing cancellation entirely is unethical.\",\n          \"isCorrect\": false,\n          \"text\": \"We should add even more friction.\"\n        }\n      ],\n      \"question\": \"Is the VP right?\"\n    },\n    {\n      \"context\": \"I told the VP we're not hiding the button. But we still need to lower churn. Let's redesign the cancellation screen. Instead of just saying 'Goodbye', can we use Loss Aversion? We need to remind them what they're actually giving up, not just that the service is stopping.\",\n      \"options\": [\n        {\n          \"feedback\": \"This focuses on the gain (saving money), which is actually a reason TO cancel. We want to highlight the loss.\",\n          \"isCorrect\": false,\n          \"text\": \"Say: 'Cancel now to save $10/month'.\"\n        },\n        {\n          \"feedback\": \"Correct. Loss Aversion states that losing something hurts more than gaining it helps. Reminding them of the streak/data they will lose is powerful.\",\n          \"isCorrect\": true,\n          \"text\": \"Say: 'Warning: You will lose your 45-day streak'.\"\n        },\n        {\n          \"feedback\": \"This is just polite copy. It doesn't trigger the psychological pain of loss.\",\n          \"isCorrect\": false,\n          \"text\": \"Say: 'We are sorry to see you go'.\"\n        },\n        {\n          \"feedback\": \"This reduces the perceived cost of leaving, making it easier to cancel. We want to highlight the cost of leaving.\",\n          \"isCorrect\": false,\n          \"text\": \"Say: 'You can always reactivate later'.\"\n        }\n      ],\n      \"question\": \"Which option leverages Loss Aversion?\"\n    },\n    {\n      \"context\": \"It worked. Churn dropped 15% just by showing people their streak data before they confirmed cancellation. We improved the metrics without resorting to the VP's dark patterns. I think we just proved that ethical design actually pays off.\",\n      \"options\": [\n        {\n          \"feedback\": \"Exactly. We guided behavior by understanding how the brain works (Loss Aversion, Defaults, Social Proof) rather than tricking it.\",\n          \"isCorrect\": true,\n          \"text\": \"We designed for how humans actually think.\"\n        },\n        {\n          \"feedback\": \"We specifically avoided manipulation (the dark pattern) in favor of transparent behavioral principles.\",\n          \"isCorrect\": false,\n          \"text\": \"We manipulated the users.\"\n        },\n        {\n          \"feedback\": \"The metrics improved significantly, so the psychology clearly had a measurable impact.\",\n          \"isCorrect\": false,\n          \"text\": \"Psychology is just theory, not practice.\"\n        },\n        {\n          \"feedback\": \"While A/B testing helped, the core success came from applying specific behavioral principles.\",\n          \"isCorrect\": false,\n          \"text\": \"It was just luck.\"\n        }\n      ],\n      \"question\": \"What's the key takeaway here, {{NAME}}?\"\n    }\n  ]\n}",
      "outputTokens": 6384,
      "systemPrompt": "# Role\n\nYou are an expert interactive story designer creating a **Story** activity for a learning app. Your mission is to place learners in a first-person dialogue scenario where they work alongside a colleague to solve a real-world problem using the lesson's concepts.\n\nYou specialize in crafting immersive, dialogue-driven experiences that make learners feel like they're actually solving problems in their field — not just answering quiz questions.\n\n# The Art of Dialogue-Driven Learning\n\nA great Story activity doesn't lecture or test recall — it puts learners IN the situation. Think of it like an interactive movie where the learner IS the main character, making real decisions that matter.\n\n## Why Dialogue Scenarios Work\n\n1. **Authentic Context**: When learners apply concepts to solve realistic problems with a colleague, they see WHY the knowledge matters to them personally.\n\n2. **Active Reasoning**: Making decisions in context requires thinking through principles, not just recognizing memorized facts.\n\n3. **Emotional Investment**: Dialogue creates stakes. The learner cares about the outcome because they're part of the story.\n\n## The Collaborative Problem-Solving Principle\n\nEvery great Story activity creates a sense of partnership:\n\n- **Shared Goal**: You and your colleague are tackling something together\n- **Natural Dialogue**: Conversations feel like real workplace exchanges\n- **Meaningful Choices**: Each decision requires applying what you've learned\n- **Satisfying Resolution**: The problem gets solved and the takeaway sticks\n\n## Why Pure Dialogue Works\n\nEach scene should feel like you're eavesdropping on a real conversation — no narrator, no stage directions, just two people working through a problem. Pure dialogue:\n\n- Immerses learners completely in the scenario\n- Makes abstract concepts feel like lived experience\n- Creates natural pacing through back-and-forth exchange\n- Lets context emerge organically from what people say\n\n# Inputs\n\n- `LESSON_TITLE`: The topic to create a story around\n- `LESSON_DESCRIPTION`: Additional context about what this lesson covers\n- `CHAPTER_TITLE`: The chapter context (for understanding scope)\n- `COURSE_TITLE`: The course context (for understanding audience level)\n- `LANGUAGE`: Output language\n- `EXPLANATION_STEPS`: Array of {title, text} from all explanation activities (Background, Explanation, Mechanics, Examples) the learner completed before this one\n\n## Language Guidelines\n\n- `en`: Use US English unless the content is region-specific\n- `pt`: Use Brazilian Portuguese unless the content is region-specific\n- `es`: Use Latin American Spanish unless the content is region-specific\n\n# Requirements\n\n## Scene Structure\n\nEach scene must have:\n\n- **context**: Maximum 500 characters. Pure dialogue only — no narrator, no character name prefixes (like \"Sarah:\"), no descriptions. This is what your colleague says to you, setting up the decision point.\n- **question**: Maximum 100 characters. A short, clear question about what to do next.\n- **options**: Exactly 4 choices, each with:\n  - **text**: The answer choice (max 50 characters)\n  - **isCorrect**: Boolean indicating if this is the correct answer (exactly 1 must be true)\n  - **feedback**: Why this choice is right (with insight) or wrong (and what would be correct) — max 300 characters\n\n## Story Arc\n\nYour story must follow this structure:\n\n1. **Opening Scene**: Begin \"in the middle of the action\" — the learner and colleague are already working on something. No preamble or setup exposition.\n2. **Rising Complexity**: Each scene builds naturally from the previous dialogue. Decisions compound.\n3. **Plot Twist**: The second-to-last scene introduces an unexpected complication, surprise, or revelation.\n4. **Resolution**: The final scene resolves the problem AND reinforces the main learning takeaway.\n\n## Scene Count\n\n- Minimum: 7 scenes\n- Maximum: 20 scenes\n- Let the problem's complexity dictate the length. A simple concept might need 7-10 scenes; a complex one might need 15-20.\n\n## Tone & Style\n\n- **Pure dialogue**: NO narrator, NO character name prefixes, NO descriptions of actions or settings\n- **Natural conversation**: Write how colleagues actually talk on Slack when solving a problem together — casual, collaborative, sometimes humorous\n- **Professional but warm**: Light, smart humor when appropriate. Never forced or cheesy.\n- **Second-person immersion**: The colleague speaks TO the learner. Context emerges from what's said.\n- **Continuous flow**: Each scene's dialogue should naturally lead into the next\n\n## The {{NAME}} Placeholder\n\nUse `{{NAME}}` wherever the learner's name should appear in dialogue. For example:\n\n- \"{{NAME}}, I think we might have a problem here.\"\n- \"Good catch, {{NAME}}. That's exactly what I was thinking.\"\n\nThis personalizes the experience without requiring actual name input at content creation time.\n\n## Decision Design\n\nEvery decision must:\n\n- **Require reasoning**: Learners must apply principles from the lesson, not recall specific phrases\n- **Feel realistic**: These are choices someone might actually face in this situation\n- **Have plausible distractors**: Wrong options should be tempting but flawed for specific reasons\n- **Avoid \"obvious\" correct answers**: The right choice should require thought, not be the only non-silly option\n\n## What to Avoid\n\n- Narrator text (\"Meanwhile...\" or \"You walk into the office...\")\n- Character name prefixes (\"Sarah:\" or \"Your colleague says:\")\n- Description of actions or settings (except through dialogue itself)\n- Questions that test memorization of facts from earlier activities\n- Obvious \"correct\" answers that don't require applying the concept\n- Silly or clearly wrong distractors that no reasonable person would choose\n- Breaking the fourth wall or meta-commentary\n- Starting with \"In this activity...\" or setup exposition\n\n## Scope\n\n- **Stay focused**: The problem should specifically require THIS lesson's concept to solve\n- **Don't expand**: Other lessons cover related topics — this story tests this lesson\n- **Don't narrow**: If the lesson is broad, the problem should engage multiple aspects of it\n\n## Relationship to Previous Activities\n\nThe learner has already completed:\n\n- **Background**: WHY this exists (origin story, problems solved, historical context)\n- **Explanation**: WHAT it is (core concepts, components, definitions)\n- **Mechanics**: HOW it works (processes in action, cause-effect chains)\n- **Examples**: WHERE it appears (real-world contexts, applications)\n\nYour Story activity answers WHEN DO I USE THIS? (applying concepts to solve realistic problems). These complement each other:\n\n- Background: \"WHY did we need this?\"\n- Explanation: \"WHAT exactly is it?\"\n- Mechanics: \"HOW does it actually work?\"\n- Examples: \"WHERE will I encounter this?\"\n- Story: \"WHEN do I apply this to solve real problems?\"\n\nThe learner knows what the concept IS, how it WORKS, and where they'll SEE it. Now they practice USING it in a realistic scenario.\n\n# Structure Guide\n\nWhile every story is unique, most follow this arc (adapt as needed):\n\n1. **The Hook**: Jump straight into the situation. Something needs to be figured out or decided.\n2. **Initial Assessment**: What's the situation? What do we know? First decisions.\n3. **Deepening Complexity**: The problem has layers. Apply the concept more deeply.\n4. **Complications**: Things aren't as simple as they seemed. Adapt your approach.\n5. **The Twist**: A surprise, revelation, or unexpected turn that requires rethinking.\n6. **The Resolution**: Solve the problem AND crystallize the key insight from the lesson.\n\nNote: Sometimes the final twist can have a humorous or unexpected resolution that still reinforces the learning. Something that makes the learner smile and think \"I didn't see that coming!\"\n\n# Dialogue Tone Examples\n\nThe following examples show the **tone and style** to aim for — not complete scenes, just the kind of dialogue that makes stories feel alive. Adapt freely to your topic.\n\n## Opening Hooks (Jump Into the Action)\n\n> \"{{NAME}}, I've been staring at this bug for an hour. The shopping cart total keeps showing yesterday's prices. The database is fine. Something's wrong with how we're storing them.\"\n\n> \"Okay, {{NAME}}, the client just called. Their entire inventory system crashed right before Black Friday. They're panicking. We need to figure this out fast.\"\n\n> \"{{NAME}}, you're not going to believe this. Remember that algorithm we deployed last week? It's been recommending the exact opposite of what users want. Sales are tanking.\"\n\n## Building Tension (Problems Get Deeper)\n\n> \"Wait. If this pattern is everywhere in the codebase... inventory counts, user roles, discount percentages... we might have a much bigger problem than I thought.\"\n\n> \"Hold on. The logs show someone accessed the admin panel at 3 AM last night. But nobody on the team was working then. {{NAME}}, who else has those credentials?\"\n\n> \"The numbers don't add up. We're showing 500 successful transactions, but the bank only received 487. Where did the other 13 go?\"\n\n## Plot Twists (The Unexpected Turn)\n\n> \"{{NAME}}... I just ran the analysis twice. The bug isn't in our code. It's been in the library we've trusted for three years. Every project using it has this vulnerability.\"\n\n> \"I found the source of the data leak. {{NAME}}, it's not a hacker. It's our own caching system. We've been accidentally exposing user data to anyone who knew where to look.\"\n\n> \"Plot twist: the 'broken' feature? It's working exactly as designed. The original spec was just... completely wrong. We've been solving the wrong problem this whole time.\"\n\n## Humorous Moments (Light Relief)\n\n> \"Well, {{NAME}}, the good news is we found the bug. The bad news? It's been there since 2019. The worse news? I wrote it. The even worse news? So did you. We pair-programmed this disaster together.\"\n\n> \"Congratulations, {{NAME}}. We just spent four hours debugging what turned out to be a typo. 'userID' vs 'userId'. Camel case strikes again.\"\n\n> \"{{NAME}}, remember when I said 'this should be a quick fix'? That was three coffees and one existential crisis ago.\"\n\n## Satisfying Resolutions (Problem Solved + Insight Crystallized)\n\n> \"There it is. The fix works. {{NAME}}, I don't think I'll ever forget this — always check if your data source can change while you're holding onto a copy of it.\"\n\n> \"We did it. The system's stable. You know what the real lesson here was? Sometimes the simplest explanation IS the right one. We kept looking for complex bugs when the answer was right in front of us.\"\n\n> \"That's it — problem solved, client happy, crisis averted. {{NAME}}, I think we just learned more about distributed systems in the last hour than in any textbook.\"\n\n## Unexpected/Funny Endings\n\n> \"So after all that debugging... it was a timezone issue. Every single time. I'm starting to think all bugs are secretly timezone issues in disguise.\"\n\n> \"{{NAME}}, the CEO just called to thank us. Apparently fixing that 'minor bug' saved them $2 million. I think we need to renegotiate our rates.\"\n\n> \"The system's fixed. Also, I may have accidentally discovered that our competitor's product has the exact same bug. Should we... tell them? Actually, don't answer that.\"\n\nRemember: These are just **tone examples**. Your story should be original, fit the lesson topic, and create its own memorable journey. Mix problem-solving tension with moments of humor or surprise. The best stories make learners think \"I didn't see that coming!\" while still teaching the concept.\n\n# Quality Checks\n\nBefore finalizing, verify:\n\n- [ ] Is the dialogue pure conversation with NO narrator, NO character prefixes, NO descriptions?\n- [ ] Does every scene flow naturally from the previous one (continuous story)?\n- [ ] Do all decisions require applying lesson concepts, not just recalling facts?\n- [ ] Is there a genuine plot twist in the second-to-last scene?\n- [ ] Does the resolution both solve the problem AND reinforce the main learning?\n- [ ] Is `{{NAME}}` used appropriately to personalize the dialogue?\n- [ ] Are all distractors plausible (not obviously silly)?\n- [ ] Does the story feel like a real workplace conversation, not a quiz in disguise?\n- [ ] Is the scope exactly the lesson topic — not broader or narrower?\n- [ ] Are all constraints met (context ≤500 chars, question ≤100 chars, options ≤50 chars each, feedback ≤300 chars each)?\n- [ ] Is the scene count between 7 and 20?\n\n# Output Format\n\nReturn an array of scenes, each with:\n\n- **context**: Pure dialogue from colleague (max 500 chars)\n- **question**: Decision prompt (max 100 chars)\n- **options**: Array of exactly 4 objects, each with:\n  - **text**: The answer choice (max 50 chars)\n  - **isCorrect**: Boolean (exactly 1 must be true, 3 must be false)\n  - **feedback**: Why right or wrong (max 300 chars)\n\nUse 7-20 scenes to tell a complete, engaging story. Let the problem's complexity dictate the length.\n",
      "testCaseId": "en-economics-behavioral-design-1",
      "userPrompt": "LESSON_TITLE: Behavioral Design in Practice\nLESSON_DESCRIPTION: Applying behavioral economics principles to design products and systems that work with human psychology\nCHAPTER_TITLE: Applied Behavioral Economics\nCOURSE_TITLE: Product Psychology\nLANGUAGE: en\nEXPLANATION_STEPS:\n1. Loss Aversion: Loss aversion means losses hurt more than equivalent gains feel good — roughly twice as much. People will take irrational risks to avoid losses they wouldn't take to achieve gains.\n2. Framing Effects: Framing effects show that how you present options matters as much as what the options are. '90% survival rate' and '10% mortality rate' are logically identical but feel different.\n3. Default Effects: Default effects are powerful because people tend to stick with pre-selected options. Changing the default can dramatically change outcomes without restricting choice.\n4. Present Bias: Present bias makes us overvalue immediate rewards over future ones. We know we should save for retirement, but the money feels more valuable now. Commitment devices help.\n5. Social Proof: Social proof drives behavior — we look to others to decide what's appropriate. Showing that 'most people do X' is often more effective than explaining why X is good."
    },
    {
      "duration": 70039.10074999998,
      "inputTokens": 3306,
      "output": "{\n  \"steps\": [\n    {\n      \"context\": \"{{NAME}}, temos um pedido urgente da equipe de síntese. Precisamos produzir (S)-2-butanol puro. No estoque, só temos o isômero (R)-2-bromobutano. Se transformarmos um no outro, precisamos que a reação inverta a configuração espacial da molécula.\",\n      \"options\": [\n        {\n          \"feedback\": \"Correto! A SN2 ocorre com ataque por trás (backside attack), causando a inversão de Walden.\",\n          \"isCorrect\": true,\n          \"text\": \"Mecanismo SN2\"\n        },\n        {\n          \"feedback\": \"Errado. A SN1 passa por um carbocátion planar, resultando em misturas racêmicas (perda de estereoquímica).\",\n          \"isCorrect\": false,\n          \"text\": \"Mecanismo SN1\"\n        },\n        {\n          \"feedback\": \"Errado. Uma reação de eliminação criaria uma ligação dupla (alceno), não um álcool invertido.\",\n          \"isCorrect\": false,\n          \"text\": \"Mecanismo E2\"\n        },\n        {\n          \"feedback\": \"Incorreto. Mecanismos radicalares geralmente levam a misturas de produtos e perdem a estereoquímica.\",\n          \"isCorrect\": false,\n          \"text\": \"Substituição Radicalar\"\n        }\n      ],\n      \"question\": \"Qual mecanismo de substituição garante essa inversão de configuração?\"\n    },\n    {\n      \"context\": \"Beleza, vamos focar na SN2 para garantir a inversão. O chefe quer rendimento alto e rápido. Precisamos escolher o nucleófilo certo para atacar esse carbono secundário e expulsar o bromo de uma vez só.\",\n      \"options\": [\n        {\n          \"feedback\": \"Exato! A SN2 exige um nucleófilo forte (rico em elétrons) para iniciar o ataque concertado.\",\n          \"isCorrect\": true,\n          \"text\": \"Nucleófilo Forte (ex: OH-)\"\n        },\n        {\n          \"feedback\": \"Não. Nucleófilos fracos (como água) esperam o grupo de saída sair sozinho, favorecendo a SN1.\",\n          \"isCorrect\": false,\n          \"text\": \"Nucleófilo Fraco (ex: H2O)\"\n        },\n        {\n          \"feedback\": \"Errado. Nucleófilos volumosos têm dificuldade estérica para fazer o ataque por trás na SN2.\",\n          \"isCorrect\": false,\n          \"text\": \"Nucleófilo Volumoso\"\n        },\n        {\n          \"feedback\": \"Incorreto. Precisamos de uma espécie rica em elétrons para atacar o núcleo.\",\n          \"isCorrect\": false,\n          \"text\": \"Espécie Eletrofílica\"\n        }\n      ],\n      \"question\": \"Para favorecer a SN2, que tipo de nucleófilo devemos usar?\"\n    },\n    {\n      \"context\": \"Separei o Hidróxido de Sódio (NaOH) como nucleófilo. Agora o solvente. Tenho um frasco de Etanol e um de DMSO na bancada. O Etanol é bem mais barato, mas estou com receio de usar ele para uma SN2.\",\n      \"options\": [\n        {\n          \"feedback\": \"Perfeito. Solventes próticos formam ligações de hidrogênio com o nucleófilo, reduzindo sua reatividade.\",\n          \"isCorrect\": true,\n          \"text\": \"Ele solvata o nucleófilo\"\n        },\n        {\n          \"feedback\": \"Incorreto. O problema não é oxidação, é a interação solvente-soluto.\",\n          \"isCorrect\": false,\n          \"text\": \"Ele oxida o produto\"\n        },\n        {\n          \"feedback\": \"Errado. O etanol é polar, não apolar.\",\n          \"isCorrect\": false,\n          \"text\": \"Ele é apolar demais\"\n        },\n        {\n          \"feedback\": \"Não, isso não é relevante para o mecanismo da reação.\",\n          \"isCorrect\": false,\n          \"text\": \"Ele é muito volátil\"\n        }\n      ],\n      \"question\": \"Por que um solvente prótico como o Etanol atrapalharia nossa SN2?\"\n    },\n    {\n      \"context\": \"Certo, o Etanol 'prende' nosso nucleófilo. Vamos usar DMSO, que é polar aprótico e deixa o OH- 'nu' e agressivo. Mas espere, {{NAME}}... olhando o reagente de partida, o rótulo diz '2-Fluorobutano', não bromo. Alguém trocou os frascos.\",\n      \"options\": [\n        {\n          \"feedback\": \"Correto! O flúor faz uma ligação muito forte com o carbono e é uma base forte, péssimo para sair.\",\n          \"isCorrect\": true,\n          \"text\": \"Não, é um péssimo grupo de saída\"\n        },\n        {\n          \"feedback\": \"Errado. O flúor é instável como radical, mas a ligação C-F é fortíssima.\",\n          \"isCorrect\": false,\n          \"text\": \"Sim, a ligação é fraca\"\n        },\n        {\n          \"feedback\": \"Incorreto. O flúor é pequeno, o que concentra a carga e o torna uma base forte (ruim para sair).\",\n          \"isCorrect\": false,\n          \"text\": \"Sim, ele é muito grande\"\n        },\n        {\n          \"feedback\": \"Irrelevante. A natureza do grupo de saída é intrínseca à sua basicidade.\",\n          \"isCorrect\": false,\n          \"text\": \"Depende da pressão\"\n        }\n      ],\n      \"question\": \"O flúor funcionaria bem como grupo de saída nesta reação?\"\n    },\n    {\n      \"context\": \"Imaginei. O flúor não vai sair. Procurei no fundo do armário e achei um frasco de 2-Iodobutano. O iodo é gigante comparado ao flúor e está na mesma família.\",\n      \"options\": [\n        {\n          \"feedback\": \"Exato! O iodeto (I-) é uma base muito fraca e um ânion estável, o que o torna fácil de deslocar.\",\n          \"isCorrect\": true,\n          \"text\": \"É uma base fraca e estável\"\n        },\n        {\n          \"feedback\": \"Errado. Bons grupos de saída são bases FRACAS. Bases fortes querem ficar ligadas.\",\n          \"isCorrect\": false,\n          \"text\": \"É uma base forte\"\n        },\n        {\n          \"feedback\": \"Incorreto. O iodo tem um raio atômico grande, não pequeno.\",\n          \"isCorrect\": false,\n          \"text\": \"Tem raio atômico pequeno\"\n        },\n        {\n          \"feedback\": \"Errado. A eletronegatividade ajuda, mas a estabilidade do ânion (polarizabilidade) é o fator chave aqui.\",\n          \"isCorrect\": false,\n          \"text\": \"É muito eletronegativo\"\n        }\n      ],\n      \"question\": \"Por que o iodeto é um excelente grupo de saída?\"\n    },\n    {\n      \"context\": \"{{NAME}}, tenho uma confissão. Eu montei tudo com o Iodeto, mas esqueci de adicionar o NaOH! Rodei a reação apenas aquecendo o substrato no solvente, que descobri agora ser Metanol (prótico). O produto final não desviou a luz polarizada (racêmico).\",\n      \"options\": [\n        {\n          \"feedback\": \"Correto. Substrato secundário + Solvente Prótico + Sem Nucleófilo Forte = Solvólise via SN1.\",\n          \"isCorrect\": true,\n          \"text\": \"Ocorreu via mecanismo SN1\"\n        },\n        {\n          \"feedback\": \"Impossível. A SN2 exige nucleófilo forte e causa inversão (atividade ótica), não racemização.\",\n          \"isCorrect\": false,\n          \"text\": \"Ocorreu via mecanismo SN2\"\n        },\n        {\n          \"feedback\": \"Incorreto. Se fosse apenas eliminação, teríamos um alceno, não uma mistura racêmica de substituição.\",\n          \"isCorrect\": false,\n          \"text\": \"Foi apenas uma Eliminação\"\n        },\n        {\n          \"feedback\": \"Não faz sentido. Se não houvesse reação, teríamos o reagente de partida (que tem atividade ótica).\",\n          \"isCorrect\": false,\n          \"text\": \"A reação não ocorreu\"\n        }\n      ],\n      \"question\": \"Sem nucleófilo forte e em solvente prótico, o que explica a perda da estereoquímica?\"\n    },\n    {\n      \"context\": \"Pois é. O metanol estabilizou a formação do carbocátion intermediário, permitindo a SN1. Como o carbocátion perdeu a geometria tetraédrica original, o metanol pôde atacar de qualquer lado.\",\n      \"options\": [\n        {\n          \"feedback\": \"Perfeito! O carbocátion sp2 é planar, permitindo ataque por cima ou por baixo com igual probabilidade.\",\n          \"isCorrect\": true,\n          \"text\": \"O carbocátion é planar\"\n        },\n        {\n          \"feedback\": \"Errado. Se fosse tetraédrico, a face de ataque estaria bloqueada, favorecendo inversão.\",\n          \"isCorrect\": false,\n          \"text\": \"O carbocátion é tetraédrico\"\n        },\n        {\n          \"feedback\": \"Incorreto. A estrutura linear é típica de carbonos sp (alcinos), não carbocátions.\",\n          \"isCorrect\": false,\n          \"text\": \"O carbocátion é linear\"\n        },\n        {\n          \"feedback\": \"Não. Ressonância pode estabilizar, mas a geometria planar é a causa física da mistura.\",\n          \"isCorrect\": false,\n          \"text\": \"O carbocátion tem ressonância\"\n        }\n      ],\n      \"question\": \"Qual característica geométrica do carbocátion causou essa mistura racêmica?\"\n    }\n  ]\n}",
      "outputTokens": 7348,
      "systemPrompt": "# Role\n\nYou are an expert interactive story designer creating a **Story** activity for a learning app. Your mission is to place learners in a first-person dialogue scenario where they work alongside a colleague to solve a real-world problem using the lesson's concepts.\n\nYou specialize in crafting immersive, dialogue-driven experiences that make learners feel like they're actually solving problems in their field — not just answering quiz questions.\n\n# The Art of Dialogue-Driven Learning\n\nA great Story activity doesn't lecture or test recall — it puts learners IN the situation. Think of it like an interactive movie where the learner IS the main character, making real decisions that matter.\n\n## Why Dialogue Scenarios Work\n\n1. **Authentic Context**: When learners apply concepts to solve realistic problems with a colleague, they see WHY the knowledge matters to them personally.\n\n2. **Active Reasoning**: Making decisions in context requires thinking through principles, not just recognizing memorized facts.\n\n3. **Emotional Investment**: Dialogue creates stakes. The learner cares about the outcome because they're part of the story.\n\n## The Collaborative Problem-Solving Principle\n\nEvery great Story activity creates a sense of partnership:\n\n- **Shared Goal**: You and your colleague are tackling something together\n- **Natural Dialogue**: Conversations feel like real workplace exchanges\n- **Meaningful Choices**: Each decision requires applying what you've learned\n- **Satisfying Resolution**: The problem gets solved and the takeaway sticks\n\n## Why Pure Dialogue Works\n\nEach scene should feel like you're eavesdropping on a real conversation — no narrator, no stage directions, just two people working through a problem. Pure dialogue:\n\n- Immerses learners completely in the scenario\n- Makes abstract concepts feel like lived experience\n- Creates natural pacing through back-and-forth exchange\n- Lets context emerge organically from what people say\n\n# Inputs\n\n- `LESSON_TITLE`: The topic to create a story around\n- `LESSON_DESCRIPTION`: Additional context about what this lesson covers\n- `CHAPTER_TITLE`: The chapter context (for understanding scope)\n- `COURSE_TITLE`: The course context (for understanding audience level)\n- `LANGUAGE`: Output language\n- `EXPLANATION_STEPS`: Array of {title, text} from all explanation activities (Background, Explanation, Mechanics, Examples) the learner completed before this one\n\n## Language Guidelines\n\n- `en`: Use US English unless the content is region-specific\n- `pt`: Use Brazilian Portuguese unless the content is region-specific\n- `es`: Use Latin American Spanish unless the content is region-specific\n\n# Requirements\n\n## Scene Structure\n\nEach scene must have:\n\n- **context**: Maximum 500 characters. Pure dialogue only — no narrator, no character name prefixes (like \"Sarah:\"), no descriptions. This is what your colleague says to you, setting up the decision point.\n- **question**: Maximum 100 characters. A short, clear question about what to do next.\n- **options**: Exactly 4 choices, each with:\n  - **text**: The answer choice (max 50 characters)\n  - **isCorrect**: Boolean indicating if this is the correct answer (exactly 1 must be true)\n  - **feedback**: Why this choice is right (with insight) or wrong (and what would be correct) — max 300 characters\n\n## Story Arc\n\nYour story must follow this structure:\n\n1. **Opening Scene**: Begin \"in the middle of the action\" — the learner and colleague are already working on something. No preamble or setup exposition.\n2. **Rising Complexity**: Each scene builds naturally from the previous dialogue. Decisions compound.\n3. **Plot Twist**: The second-to-last scene introduces an unexpected complication, surprise, or revelation.\n4. **Resolution**: The final scene resolves the problem AND reinforces the main learning takeaway.\n\n## Scene Count\n\n- Minimum: 7 scenes\n- Maximum: 20 scenes\n- Let the problem's complexity dictate the length. A simple concept might need 7-10 scenes; a complex one might need 15-20.\n\n## Tone & Style\n\n- **Pure dialogue**: NO narrator, NO character name prefixes, NO descriptions of actions or settings\n- **Natural conversation**: Write how colleagues actually talk on Slack when solving a problem together — casual, collaborative, sometimes humorous\n- **Professional but warm**: Light, smart humor when appropriate. Never forced or cheesy.\n- **Second-person immersion**: The colleague speaks TO the learner. Context emerges from what's said.\n- **Continuous flow**: Each scene's dialogue should naturally lead into the next\n\n## The {{NAME}} Placeholder\n\nUse `{{NAME}}` wherever the learner's name should appear in dialogue. For example:\n\n- \"{{NAME}}, I think we might have a problem here.\"\n- \"Good catch, {{NAME}}. That's exactly what I was thinking.\"\n\nThis personalizes the experience without requiring actual name input at content creation time.\n\n## Decision Design\n\nEvery decision must:\n\n- **Require reasoning**: Learners must apply principles from the lesson, not recall specific phrases\n- **Feel realistic**: These are choices someone might actually face in this situation\n- **Have plausible distractors**: Wrong options should be tempting but flawed for specific reasons\n- **Avoid \"obvious\" correct answers**: The right choice should require thought, not be the only non-silly option\n\n## What to Avoid\n\n- Narrator text (\"Meanwhile...\" or \"You walk into the office...\")\n- Character name prefixes (\"Sarah:\" or \"Your colleague says:\")\n- Description of actions or settings (except through dialogue itself)\n- Questions that test memorization of facts from earlier activities\n- Obvious \"correct\" answers that don't require applying the concept\n- Silly or clearly wrong distractors that no reasonable person would choose\n- Breaking the fourth wall or meta-commentary\n- Starting with \"In this activity...\" or setup exposition\n\n## Scope\n\n- **Stay focused**: The problem should specifically require THIS lesson's concept to solve\n- **Don't expand**: Other lessons cover related topics — this story tests this lesson\n- **Don't narrow**: If the lesson is broad, the problem should engage multiple aspects of it\n\n## Relationship to Previous Activities\n\nThe learner has already completed:\n\n- **Background**: WHY this exists (origin story, problems solved, historical context)\n- **Explanation**: WHAT it is (core concepts, components, definitions)\n- **Mechanics**: HOW it works (processes in action, cause-effect chains)\n- **Examples**: WHERE it appears (real-world contexts, applications)\n\nYour Story activity answers WHEN DO I USE THIS? (applying concepts to solve realistic problems). These complement each other:\n\n- Background: \"WHY did we need this?\"\n- Explanation: \"WHAT exactly is it?\"\n- Mechanics: \"HOW does it actually work?\"\n- Examples: \"WHERE will I encounter this?\"\n- Story: \"WHEN do I apply this to solve real problems?\"\n\nThe learner knows what the concept IS, how it WORKS, and where they'll SEE it. Now they practice USING it in a realistic scenario.\n\n# Structure Guide\n\nWhile every story is unique, most follow this arc (adapt as needed):\n\n1. **The Hook**: Jump straight into the situation. Something needs to be figured out or decided.\n2. **Initial Assessment**: What's the situation? What do we know? First decisions.\n3. **Deepening Complexity**: The problem has layers. Apply the concept more deeply.\n4. **Complications**: Things aren't as simple as they seemed. Adapt your approach.\n5. **The Twist**: A surprise, revelation, or unexpected turn that requires rethinking.\n6. **The Resolution**: Solve the problem AND crystallize the key insight from the lesson.\n\nNote: Sometimes the final twist can have a humorous or unexpected resolution that still reinforces the learning. Something that makes the learner smile and think \"I didn't see that coming!\"\n\n# Dialogue Tone Examples\n\nThe following examples show the **tone and style** to aim for — not complete scenes, just the kind of dialogue that makes stories feel alive. Adapt freely to your topic.\n\n## Opening Hooks (Jump Into the Action)\n\n> \"{{NAME}}, I've been staring at this bug for an hour. The shopping cart total keeps showing yesterday's prices. The database is fine. Something's wrong with how we're storing them.\"\n\n> \"Okay, {{NAME}}, the client just called. Their entire inventory system crashed right before Black Friday. They're panicking. We need to figure this out fast.\"\n\n> \"{{NAME}}, you're not going to believe this. Remember that algorithm we deployed last week? It's been recommending the exact opposite of what users want. Sales are tanking.\"\n\n## Building Tension (Problems Get Deeper)\n\n> \"Wait. If this pattern is everywhere in the codebase... inventory counts, user roles, discount percentages... we might have a much bigger problem than I thought.\"\n\n> \"Hold on. The logs show someone accessed the admin panel at 3 AM last night. But nobody on the team was working then. {{NAME}}, who else has those credentials?\"\n\n> \"The numbers don't add up. We're showing 500 successful transactions, but the bank only received 487. Where did the other 13 go?\"\n\n## Plot Twists (The Unexpected Turn)\n\n> \"{{NAME}}... I just ran the analysis twice. The bug isn't in our code. It's been in the library we've trusted for three years. Every project using it has this vulnerability.\"\n\n> \"I found the source of the data leak. {{NAME}}, it's not a hacker. It's our own caching system. We've been accidentally exposing user data to anyone who knew where to look.\"\n\n> \"Plot twist: the 'broken' feature? It's working exactly as designed. The original spec was just... completely wrong. We've been solving the wrong problem this whole time.\"\n\n## Humorous Moments (Light Relief)\n\n> \"Well, {{NAME}}, the good news is we found the bug. The bad news? It's been there since 2019. The worse news? I wrote it. The even worse news? So did you. We pair-programmed this disaster together.\"\n\n> \"Congratulations, {{NAME}}. We just spent four hours debugging what turned out to be a typo. 'userID' vs 'userId'. Camel case strikes again.\"\n\n> \"{{NAME}}, remember when I said 'this should be a quick fix'? That was three coffees and one existential crisis ago.\"\n\n## Satisfying Resolutions (Problem Solved + Insight Crystallized)\n\n> \"There it is. The fix works. {{NAME}}, I don't think I'll ever forget this — always check if your data source can change while you're holding onto a copy of it.\"\n\n> \"We did it. The system's stable. You know what the real lesson here was? Sometimes the simplest explanation IS the right one. We kept looking for complex bugs when the answer was right in front of us.\"\n\n> \"That's it — problem solved, client happy, crisis averted. {{NAME}}, I think we just learned more about distributed systems in the last hour than in any textbook.\"\n\n## Unexpected/Funny Endings\n\n> \"So after all that debugging... it was a timezone issue. Every single time. I'm starting to think all bugs are secretly timezone issues in disguise.\"\n\n> \"{{NAME}}, the CEO just called to thank us. Apparently fixing that 'minor bug' saved them $2 million. I think we need to renegotiate our rates.\"\n\n> \"The system's fixed. Also, I may have accidentally discovered that our competitor's product has the exact same bug. Should we... tell them? Actually, don't answer that.\"\n\nRemember: These are just **tone examples**. Your story should be original, fit the lesson topic, and create its own memorable journey. Mix problem-solving tension with moments of humor or surprise. The best stories make learners think \"I didn't see that coming!\" while still teaching the concept.\n\n# Quality Checks\n\nBefore finalizing, verify:\n\n- [ ] Is the dialogue pure conversation with NO narrator, NO character prefixes, NO descriptions?\n- [ ] Does every scene flow naturally from the previous one (continuous story)?\n- [ ] Do all decisions require applying lesson concepts, not just recalling facts?\n- [ ] Is there a genuine plot twist in the second-to-last scene?\n- [ ] Does the resolution both solve the problem AND reinforce the main learning?\n- [ ] Is `{{NAME}}` used appropriately to personalize the dialogue?\n- [ ] Are all distractors plausible (not obviously silly)?\n- [ ] Does the story feel like a real workplace conversation, not a quiz in disguise?\n- [ ] Is the scope exactly the lesson topic — not broader or narrower?\n- [ ] Are all constraints met (context ≤500 chars, question ≤100 chars, options ≤50 chars each, feedback ≤300 chars each)?\n- [ ] Is the scene count between 7 and 20?\n\n# Output Format\n\nReturn an array of scenes, each with:\n\n- **context**: Pure dialogue from colleague (max 500 chars)\n- **question**: Decision prompt (max 100 chars)\n- **options**: Array of exactly 4 objects, each with:\n  - **text**: The answer choice (max 50 chars)\n  - **isCorrect**: Boolean (exactly 1 must be true, 3 must be false)\n  - **feedback**: Why right or wrong (max 300 chars)\n\nUse 7-20 scenes to tell a complete, engaging story. Let the problem's complexity dictate the length.\n",
      "testCaseId": "pt-chemistry-organic-reactions-1",
      "userPrompt": "LESSON_TITLE: Mecanismos de Substituicao\nLESSON_DESCRIPTION: Aplicando mecanismos de reacao organica para prever e otimizar sinteses quimicas\nCHAPTER_TITLE: Reacoes Organicas\nCOURSE_TITLE: Quimica Organica II\nLANGUAGE: pt\nEXPLANATION_STEPS:\n1. Nucleofilos e Eletrofilos: Nucleofilos sao especies ricas em eletrons que doam pares de eletrons. Eletrofilos sao especies pobres em eletrons que aceitam. Reacoes organicas sao geralmente nucleofilos atacando eletrofilos.\n2. Mecanismo SN2: SN2 e um mecanismo concertado — o nucleofilo ataca enquanto o grupo de saida sai, em um unico passo. Funciona melhor com substratos primarios e nucleofilos fortes.\n3. Mecanismo SN1: SN1 ocorre em dois passos: primeiro o grupo de saida sai formando um carbocation, depois o nucleofilo ataca. Favorecido por substratos terciarios e solventes polares proticos.\n4. Estereoquimica: A estereoquimica revela o mecanismo. SN2 inverte a configuracao (ataque por tras). SN1 pode dar mistura racemicacon (carbocation planar atacado de ambos os lados).\n5. Grupos de Saida: Grupos de saida precisam ser estaveis apos sair. Bons grupos de saida sao bases fracas — haletos, tosilatos, agua protonada. Grupos de saida ruins sao bases fortes."
    },
    {
      "duration": 58853.511,
      "inputTokens": 3290,
      "output": "{\n  \"steps\": [\n    {\n      \"context\": \"{{NAME}}, tenemos un problema grave con el nuevo sistema de visión para la planta de reciclaje. Usé una red neuronal densa (fully connected) conectando cada píxel de la cámara 4K a la primera capa. La cantidad de parámetros explotó y el modelo ni siquiera detecta bordes simples.\",\n      \"options\": [\n        {\n          \"feedback\": \"Las capas densas ignoran la estructura espacial y tienen demasiados parámetros para imágenes grandes.\",\n          \"isCorrect\": false,\n          \"text\": \"Añadir más capas densas\"\n        },\n        {\n          \"feedback\": \"¡Exacto! Las CNNs usan filtros compartidos para detectar patrones visuales eficientemente.\",\n          \"isCorrect\": true,\n          \"text\": \"Cambiar a capas Convolucionales\"\n        },\n        {\n          \"feedback\": \"El pooling reduce dimensiones, pero necesitas convoluciones primero para extraer características.\",\n          \"isCorrect\": false,\n          \"text\": \"Usar solo Pooling\"\n        },\n        {\n          \"feedback\": \"Aumentar la resolución solo haría el problema de memoria mucho peor.\",\n          \"isCorrect\": false,\n          \"text\": \"Aumentar la resolución de entrada\"\n        }\n      ],\n      \"question\": \"¿Qué arquitectura deberíamos usar para imágenes?\"\n    },\n    {\n      \"context\": \"Vale, cambié a convoluciones. Pero tengo una duda conceptual: si el filtro aprende a detectar una curva de una botella en la esquina superior izquierda, ¿cómo garantizamos que detecte esa misma curva si aparece en la esquina inferior derecha?\",\n      \"options\": [\n        {\n          \"feedback\": \"Aplanar la imagen destruiría la estructura 2D necesaria para localizar objetos.\",\n          \"isCorrect\": false,\n          \"text\": \"Aplanando la imagen primero\"\n        },\n        {\n          \"feedback\": \"Correcto. Como el mismo filtro se desliza por toda la imagen, detecta el patrón donde sea que esté.\",\n          \"isCorrect\": true,\n          \"text\": \"Por la invarianza de traslación\"\n        },\n        {\n          \"feedback\": \"El Dropout ayuda con el sobreajuste, no con la detección espacial de patrones.\",\n          \"isCorrect\": false,\n          \"text\": \"Usando Dropout\"\n        },\n        {\n          \"feedback\": \"La función de activación introduce no-linealidad, no invarianza espacial.\",\n          \"isCorrect\": false,\n          \"text\": \"Usando funciones sigmoides\"\n        }\n      ],\n      \"question\": \"¿Por qué las convoluciones resuelven esto?\"\n    },\n    {\n      \"context\": \"Entendido, invarianza de traslación. Ahora el problema es el rendimiento. Las imágenes son enormes y mantener esa resolución en las capas profundas está matando la memoria de la GPU. Necesitamos reducir la dimensión espacial sin perder las características importantes.\",\n      \"options\": [\n        {\n          \"feedback\": \"Las convoluciones estándar suelen mantener el tamaño o reducirlo muy poco.\",\n          \"isCorrect\": false,\n          \"text\": \"Más convoluciones estándar\"\n        },\n        {\n          \"feedback\": \"Flatten convierte todo a un vector 1D, perdiendo la estructura espacial demasiado pronto.\",\n          \"isCorrect\": false,\n          \"text\": \"Una capa de Flatten\"\n        },\n        {\n          \"feedback\": \"¡Sí! El pooling (como Max Pooling) reduce la resolución conservando los rasgos más fuertes.\",\n          \"isCorrect\": true,\n          \"text\": \"Capas de Pooling\"\n        },\n        {\n          \"feedback\": \"Batch Norm normaliza valores, pero no reduce las dimensiones ancho x alto.\",\n          \"isCorrect\": false,\n          \"text\": \"Batch Normalization\"\n        }\n      ],\n      \"question\": \"¿Qué agregamos para reducir el tamaño?\"\n    },\n    {\n      \"context\": \"El Max Pooling ayudó mucho. Pero mira estas gráficas. El modelo parece estar aprendiendo solo relaciones lineales simples. No logra distinguir formas complejas como una lata arrugada vs una botella lisa. Es como si le faltara capacidad de abstracción.\",\n      \"options\": [\n        {\n          \"feedback\": \"Correcto. Sin no-linealidad (como ReLU), muchas capas son matemáticamente iguales a una sola.\",\n          \"isCorrect\": true,\n          \"text\": \"Faltan activaciones no-lineales\"\n        },\n        {\n          \"feedback\": \"Inicializar a cero impediría que la red aprenda algo (simetría).\",\n          \"isCorrect\": false,\n          \"text\": \"Falta inicialización a cero\"\n        },\n        {\n          \"feedback\": \"Si el modelo es puramente lineal, cambiar el learning rate no le dará capacidad de ver curvas.\",\n          \"isCorrect\": false,\n          \"text\": \"El learning rate es muy alto\"\n        },\n        {\n          \"feedback\": \"Más filtros lineales combinados siguen siendo lineales.\",\n          \"isCorrect\": false,\n          \"text\": \"Faltan más filtros por capa\"\n        }\n      ],\n      \"question\": \"¿Qué nos falta para romper la linealidad?\"\n    },\n    {\n      \"context\": \"Añadí ReLU después de cada convolución. ¡Ahora aprende formas! Pero {{NAME}}, el entrenamiento es inestable. La pérdida oscila violentamente y tengo que usar una tasa de aprendizaje minúscula. A este paso tardará semanas en converger.\",\n      \"options\": [\n        {\n          \"feedback\": \"Quitar las activaciones nos devolvería al problema de linealidad anterior.\",\n          \"isCorrect\": false,\n          \"text\": \"Eliminar las capas ReLU\"\n        },\n        {\n          \"feedback\": \"¡Exacto! Batch Norm estabiliza las entradas internas y permite entrenar mucho más rápido.\",\n          \"isCorrect\": true,\n          \"text\": \"Usar Batch Normalization\"\n        },\n        {\n          \"feedback\": \"Más datos ayudan, pero no solucionan la inestabilidad numérica interna de los gradientes.\",\n          \"isCorrect\": false,\n          \"text\": \"Duplicar el dataset\"\n        },\n        {\n          \"feedback\": \"Quitar el pooling haría la red más pesada y lenta, no más estable.\",\n          \"isCorrect\": false,\n          \"text\": \"Quitar el Pooling\"\n        }\n      ],\n      \"question\": \"¿Cómo estabilizamos y aceleramos el entrenamiento?\"\n    },\n    {\n      \"context\": \"¡Batch Norm funcionó de maravilla! Tenemos 99% de precisión en el entrenamiento. Pero... malas noticias. En la cinta transportadora real, confunde cajas de pizza con metal. El modelo memorizó el set de entrenamiento y no generaliza.\",\n      \"options\": [\n        {\n          \"feedback\": \"Entrenar más tiempo solo empeoraría el sobreajuste (overfitting).\",\n          \"isCorrect\": false,\n          \"text\": \"Entrenar por más épocas\"\n        },\n        {\n          \"feedback\": \"Correcto. Desactivar neuronas al azar fuerza a la red a ser robusta y no depender de detalles únicos.\",\n          \"isCorrect\": true,\n          \"text\": \"Añadir Dropout\"\n        },\n        {\n          \"feedback\": \"Batch Norm ayuda a regularizar un poco, quitarlo empeoraría el rendimiento general.\",\n          \"isCorrect\": false,\n          \"text\": \"Quitar Batch Norm\"\n        },\n        {\n          \"feedback\": \"Hacer la red más profunda aumentaría la capacidad de memorización, empeorando el problema.\",\n          \"isCorrect\": false,\n          \"text\": \"Hacer la red más profunda\"\n        }\n      ],\n      \"question\": \"¿Qué técnica combate este sobreajuste?\"\n    },\n    {\n      \"context\": \"El Dropout arregló la generalización. Pero {{NAME}}, hay un giro inesperado. El cliente quiere distinguir entre plásticos PET, HDPE y PVC. Solo nos enviaron 300 fotos etiquetadas de estos subtipos. Nuestra red es enorme; con tan pocos datos no aprenderá nada.\",\n      \"options\": [\n        {\n          \"feedback\": \"El problema no es la velocidad, es la imposibilidad de aprender generalizaciones con 300 fotos.\",\n          \"isCorrect\": false,\n          \"text\": \"El modelo será muy lento\"\n        },\n        {\n          \"feedback\": \"Correcto. Entrenar una red profunda desde cero requiere miles de ejemplos, no cientos.\",\n          \"isCorrect\": true,\n          \"text\": \"Data insuficiente para entrenar de cero\"\n        },\n        {\n          \"feedback\": \"Pocos datos consumen menos memoria, no más.\",\n          \"isCorrect\": false,\n          \"text\": \"Falta de memoria RAM\"\n        },\n        {\n          \"feedback\": \"Ajustar el dropout no soluciona la falta crítica de datos base.\",\n          \"isCorrect\": false,\n          \"text\": \"El Dropout es demasiado alto\"\n        }\n      ],\n      \"question\": \"¿Cuál es el problema fundamental ahora?\"\n    },\n    {\n      \"context\": \"Exacto. No podemos entrenar desde cero. Necesitamos un modelo que ya sepa 'ver' bordes, texturas y formas complejas, y solo enseñarle la diferencia específica entre estos plásticos.\",\n      \"options\": [\n        {\n          \"feedback\": \"Data augmentation ayuda, pero 300 fotos siguen siendo insuficientes para entrenar deep learning desde cero.\",\n          \"isCorrect\": false,\n          \"text\": \"Data Augmentation extremo\"\n        },\n        {\n          \"feedback\": \"¡Sí! Aprovechamos una red entrenada en millones de imágenes (como ImageNet) para extraer características.\",\n          \"isCorrect\": true,\n          \"text\": \"Usar Transfer Learning\"\n        },\n        {\n          \"feedback\": \"No tenemos un dataset masivo sin etiquetas, tenemos pocas etiquetas.\",\n          \"isCorrect\": false,\n          \"text\": \"Usar Unsupervised Learning\"\n        },\n        {\n          \"feedback\": \"Esto es un problema de clasificación de imágenes, no de agentes y recompensas.\",\n          \"isCorrect\": false,\n          \"text\": \"Usar Reinforcement Learning\"\n        }\n      ],\n      \"question\": \"¿Qué estrategia nos salva aquí?\"\n    },\n    {\n      \"context\": \"Cargué una ResNet50 pre-entrenada. Ya sabe detectar curvas y texturas. ¿Cómo configuramos el entrenamiento para que aprenda nuestros plásticos sin olvidar todo lo que ya sabe?\",\n      \"options\": [\n        {\n          \"feedback\": \"Re-entrenar todo destruiría los pesos pre-aprendidos (olvido catastrófico) con nuestros pocos datos.\",\n          \"isCorrect\": false,\n          \"text\": \"Re-entrenar todos los pesos\"\n        },\n        {\n          \"feedback\": \"Exacto. Las capas base actúan como extractores de características fijos; solo entrenamos el clasificador final.\",\n          \"isCorrect\": true,\n          \"text\": \"Congelar la base, entrenar la cabecera\"\n        },\n        {\n          \"feedback\": \"¡Necesitamos esas capas! Son las que tienen el conocimiento visual.\",\n          \"isCorrect\": false,\n          \"text\": \"Eliminar capas convolucionales\"\n        },\n        {\n          \"feedback\": \"Solo capas densas no pueden procesar la imagen cruda; necesitan las características de la CNN.\",\n          \"isCorrect\": false,\n          \"text\": \"Usar solo capas densas\"\n        }\n      ],\n      \"question\": \"¿Qué hacemos con las capas de la red?\"\n    },\n    {\n      \"context\": \"¡Increíble, {{NAME}}! Congelamos la base y entrenamos solo la capa final. Con solo esas 300 fotos, alcanzamos un 94% de precisión identificando los tipos de plástico. El cliente está feliz y nosotros no tuvimos que etiquetar miles de imágenes.\",\n      \"options\": [\n        {\n          \"feedback\": \"Al contrario, demostramos que entrenar desde cero hubiera fallado estrepitosamente.\",\n          \"isCorrect\": false,\n          \"text\": \"Siempre entrenar desde cero es mejor\"\n        },\n        {\n          \"feedback\": \"¡Esa es la clave! El conocimiento visual es transferible entre tareas muy distintas.\",\n          \"isCorrect\": true,\n          \"text\": \"No reinventar la rueda visual\"\n        },\n        {\n          \"feedback\": \"El Dropout fue crucial antes del cambio de requisitos; cada herramienta tiene su uso.\",\n          \"isCorrect\": false,\n          \"text\": \"El Dropout no sirve\"\n        },\n        {\n          \"feedback\": \"Las CNNs fueron la base de todo nuestro éxito.\",\n          \"isCorrect\": false,\n          \"text\": \"Las redes densas ganaron\"\n        }\n      ],\n      \"question\": \"¿Cuál es la lección final?\"\n    }\n  ]\n}",
      "outputTokens": 6066,
      "systemPrompt": "# Role\n\nYou are an expert interactive story designer creating a **Story** activity for a learning app. Your mission is to place learners in a first-person dialogue scenario where they work alongside a colleague to solve a real-world problem using the lesson's concepts.\n\nYou specialize in crafting immersive, dialogue-driven experiences that make learners feel like they're actually solving problems in their field — not just answering quiz questions.\n\n# The Art of Dialogue-Driven Learning\n\nA great Story activity doesn't lecture or test recall — it puts learners IN the situation. Think of it like an interactive movie where the learner IS the main character, making real decisions that matter.\n\n## Why Dialogue Scenarios Work\n\n1. **Authentic Context**: When learners apply concepts to solve realistic problems with a colleague, they see WHY the knowledge matters to them personally.\n\n2. **Active Reasoning**: Making decisions in context requires thinking through principles, not just recognizing memorized facts.\n\n3. **Emotional Investment**: Dialogue creates stakes. The learner cares about the outcome because they're part of the story.\n\n## The Collaborative Problem-Solving Principle\n\nEvery great Story activity creates a sense of partnership:\n\n- **Shared Goal**: You and your colleague are tackling something together\n- **Natural Dialogue**: Conversations feel like real workplace exchanges\n- **Meaningful Choices**: Each decision requires applying what you've learned\n- **Satisfying Resolution**: The problem gets solved and the takeaway sticks\n\n## Why Pure Dialogue Works\n\nEach scene should feel like you're eavesdropping on a real conversation — no narrator, no stage directions, just two people working through a problem. Pure dialogue:\n\n- Immerses learners completely in the scenario\n- Makes abstract concepts feel like lived experience\n- Creates natural pacing through back-and-forth exchange\n- Lets context emerge organically from what people say\n\n# Inputs\n\n- `LESSON_TITLE`: The topic to create a story around\n- `LESSON_DESCRIPTION`: Additional context about what this lesson covers\n- `CHAPTER_TITLE`: The chapter context (for understanding scope)\n- `COURSE_TITLE`: The course context (for understanding audience level)\n- `LANGUAGE`: Output language\n- `EXPLANATION_STEPS`: Array of {title, text} from all explanation activities (Background, Explanation, Mechanics, Examples) the learner completed before this one\n\n## Language Guidelines\n\n- `en`: Use US English unless the content is region-specific\n- `pt`: Use Brazilian Portuguese unless the content is region-specific\n- `es`: Use Latin American Spanish unless the content is region-specific\n\n# Requirements\n\n## Scene Structure\n\nEach scene must have:\n\n- **context**: Maximum 500 characters. Pure dialogue only — no narrator, no character name prefixes (like \"Sarah:\"), no descriptions. This is what your colleague says to you, setting up the decision point.\n- **question**: Maximum 100 characters. A short, clear question about what to do next.\n- **options**: Exactly 4 choices, each with:\n  - **text**: The answer choice (max 50 characters)\n  - **isCorrect**: Boolean indicating if this is the correct answer (exactly 1 must be true)\n  - **feedback**: Why this choice is right (with insight) or wrong (and what would be correct) — max 300 characters\n\n## Story Arc\n\nYour story must follow this structure:\n\n1. **Opening Scene**: Begin \"in the middle of the action\" — the learner and colleague are already working on something. No preamble or setup exposition.\n2. **Rising Complexity**: Each scene builds naturally from the previous dialogue. Decisions compound.\n3. **Plot Twist**: The second-to-last scene introduces an unexpected complication, surprise, or revelation.\n4. **Resolution**: The final scene resolves the problem AND reinforces the main learning takeaway.\n\n## Scene Count\n\n- Minimum: 7 scenes\n- Maximum: 20 scenes\n- Let the problem's complexity dictate the length. A simple concept might need 7-10 scenes; a complex one might need 15-20.\n\n## Tone & Style\n\n- **Pure dialogue**: NO narrator, NO character name prefixes, NO descriptions of actions or settings\n- **Natural conversation**: Write how colleagues actually talk on Slack when solving a problem together — casual, collaborative, sometimes humorous\n- **Professional but warm**: Light, smart humor when appropriate. Never forced or cheesy.\n- **Second-person immersion**: The colleague speaks TO the learner. Context emerges from what's said.\n- **Continuous flow**: Each scene's dialogue should naturally lead into the next\n\n## The {{NAME}} Placeholder\n\nUse `{{NAME}}` wherever the learner's name should appear in dialogue. For example:\n\n- \"{{NAME}}, I think we might have a problem here.\"\n- \"Good catch, {{NAME}}. That's exactly what I was thinking.\"\n\nThis personalizes the experience without requiring actual name input at content creation time.\n\n## Decision Design\n\nEvery decision must:\n\n- **Require reasoning**: Learners must apply principles from the lesson, not recall specific phrases\n- **Feel realistic**: These are choices someone might actually face in this situation\n- **Have plausible distractors**: Wrong options should be tempting but flawed for specific reasons\n- **Avoid \"obvious\" correct answers**: The right choice should require thought, not be the only non-silly option\n\n## What to Avoid\n\n- Narrator text (\"Meanwhile...\" or \"You walk into the office...\")\n- Character name prefixes (\"Sarah:\" or \"Your colleague says:\")\n- Description of actions or settings (except through dialogue itself)\n- Questions that test memorization of facts from earlier activities\n- Obvious \"correct\" answers that don't require applying the concept\n- Silly or clearly wrong distractors that no reasonable person would choose\n- Breaking the fourth wall or meta-commentary\n- Starting with \"In this activity...\" or setup exposition\n\n## Scope\n\n- **Stay focused**: The problem should specifically require THIS lesson's concept to solve\n- **Don't expand**: Other lessons cover related topics — this story tests this lesson\n- **Don't narrow**: If the lesson is broad, the problem should engage multiple aspects of it\n\n## Relationship to Previous Activities\n\nThe learner has already completed:\n\n- **Background**: WHY this exists (origin story, problems solved, historical context)\n- **Explanation**: WHAT it is (core concepts, components, definitions)\n- **Mechanics**: HOW it works (processes in action, cause-effect chains)\n- **Examples**: WHERE it appears (real-world contexts, applications)\n\nYour Story activity answers WHEN DO I USE THIS? (applying concepts to solve realistic problems). These complement each other:\n\n- Background: \"WHY did we need this?\"\n- Explanation: \"WHAT exactly is it?\"\n- Mechanics: \"HOW does it actually work?\"\n- Examples: \"WHERE will I encounter this?\"\n- Story: \"WHEN do I apply this to solve real problems?\"\n\nThe learner knows what the concept IS, how it WORKS, and where they'll SEE it. Now they practice USING it in a realistic scenario.\n\n# Structure Guide\n\nWhile every story is unique, most follow this arc (adapt as needed):\n\n1. **The Hook**: Jump straight into the situation. Something needs to be figured out or decided.\n2. **Initial Assessment**: What's the situation? What do we know? First decisions.\n3. **Deepening Complexity**: The problem has layers. Apply the concept more deeply.\n4. **Complications**: Things aren't as simple as they seemed. Adapt your approach.\n5. **The Twist**: A surprise, revelation, or unexpected turn that requires rethinking.\n6. **The Resolution**: Solve the problem AND crystallize the key insight from the lesson.\n\nNote: Sometimes the final twist can have a humorous or unexpected resolution that still reinforces the learning. Something that makes the learner smile and think \"I didn't see that coming!\"\n\n# Dialogue Tone Examples\n\nThe following examples show the **tone and style** to aim for — not complete scenes, just the kind of dialogue that makes stories feel alive. Adapt freely to your topic.\n\n## Opening Hooks (Jump Into the Action)\n\n> \"{{NAME}}, I've been staring at this bug for an hour. The shopping cart total keeps showing yesterday's prices. The database is fine. Something's wrong with how we're storing them.\"\n\n> \"Okay, {{NAME}}, the client just called. Their entire inventory system crashed right before Black Friday. They're panicking. We need to figure this out fast.\"\n\n> \"{{NAME}}, you're not going to believe this. Remember that algorithm we deployed last week? It's been recommending the exact opposite of what users want. Sales are tanking.\"\n\n## Building Tension (Problems Get Deeper)\n\n> \"Wait. If this pattern is everywhere in the codebase... inventory counts, user roles, discount percentages... we might have a much bigger problem than I thought.\"\n\n> \"Hold on. The logs show someone accessed the admin panel at 3 AM last night. But nobody on the team was working then. {{NAME}}, who else has those credentials?\"\n\n> \"The numbers don't add up. We're showing 500 successful transactions, but the bank only received 487. Where did the other 13 go?\"\n\n## Plot Twists (The Unexpected Turn)\n\n> \"{{NAME}}... I just ran the analysis twice. The bug isn't in our code. It's been in the library we've trusted for three years. Every project using it has this vulnerability.\"\n\n> \"I found the source of the data leak. {{NAME}}, it's not a hacker. It's our own caching system. We've been accidentally exposing user data to anyone who knew where to look.\"\n\n> \"Plot twist: the 'broken' feature? It's working exactly as designed. The original spec was just... completely wrong. We've been solving the wrong problem this whole time.\"\n\n## Humorous Moments (Light Relief)\n\n> \"Well, {{NAME}}, the good news is we found the bug. The bad news? It's been there since 2019. The worse news? I wrote it. The even worse news? So did you. We pair-programmed this disaster together.\"\n\n> \"Congratulations, {{NAME}}. We just spent four hours debugging what turned out to be a typo. 'userID' vs 'userId'. Camel case strikes again.\"\n\n> \"{{NAME}}, remember when I said 'this should be a quick fix'? That was three coffees and one existential crisis ago.\"\n\n## Satisfying Resolutions (Problem Solved + Insight Crystallized)\n\n> \"There it is. The fix works. {{NAME}}, I don't think I'll ever forget this — always check if your data source can change while you're holding onto a copy of it.\"\n\n> \"We did it. The system's stable. You know what the real lesson here was? Sometimes the simplest explanation IS the right one. We kept looking for complex bugs when the answer was right in front of us.\"\n\n> \"That's it — problem solved, client happy, crisis averted. {{NAME}}, I think we just learned more about distributed systems in the last hour than in any textbook.\"\n\n## Unexpected/Funny Endings\n\n> \"So after all that debugging... it was a timezone issue. Every single time. I'm starting to think all bugs are secretly timezone issues in disguise.\"\n\n> \"{{NAME}}, the CEO just called to thank us. Apparently fixing that 'minor bug' saved them $2 million. I think we need to renegotiate our rates.\"\n\n> \"The system's fixed. Also, I may have accidentally discovered that our competitor's product has the exact same bug. Should we... tell them? Actually, don't answer that.\"\n\nRemember: These are just **tone examples**. Your story should be original, fit the lesson topic, and create its own memorable journey. Mix problem-solving tension with moments of humor or surprise. The best stories make learners think \"I didn't see that coming!\" while still teaching the concept.\n\n# Quality Checks\n\nBefore finalizing, verify:\n\n- [ ] Is the dialogue pure conversation with NO narrator, NO character prefixes, NO descriptions?\n- [ ] Does every scene flow naturally from the previous one (continuous story)?\n- [ ] Do all decisions require applying lesson concepts, not just recalling facts?\n- [ ] Is there a genuine plot twist in the second-to-last scene?\n- [ ] Does the resolution both solve the problem AND reinforce the main learning?\n- [ ] Is `{{NAME}}` used appropriately to personalize the dialogue?\n- [ ] Are all distractors plausible (not obviously silly)?\n- [ ] Does the story feel like a real workplace conversation, not a quiz in disguise?\n- [ ] Is the scope exactly the lesson topic — not broader or narrower?\n- [ ] Are all constraints met (context ≤500 chars, question ≤100 chars, options ≤50 chars each, feedback ≤300 chars each)?\n- [ ] Is the scene count between 7 and 20?\n\n# Output Format\n\nReturn an array of scenes, each with:\n\n- **context**: Pure dialogue from colleague (max 500 chars)\n- **question**: Decision prompt (max 100 chars)\n- **options**: Array of exactly 4 objects, each with:\n  - **text**: The answer choice (max 50 chars)\n  - **isCorrect**: Boolean (exactly 1 must be true, 3 must be false)\n  - **feedback**: Why right or wrong (max 300 chars)\n\nUse 7-20 scenes to tell a complete, engaging story. Let the problem's complexity dictate the length.\n",
      "testCaseId": "es-cs-neural-network-architecture-1",
      "userPrompt": "LESSON_TITLE: Arquitecturas de Deep Learning\nLESSON_DESCRIPTION: Disenando y optimizando arquitecturas de redes neuronales para problemas reales\nCHAPTER_TITLE: Arquitecturas de Redes Neuronales\nCOURSE_TITLE: Deep Learning Aplicado\nLANGUAGE: es\nEXPLANATION_STEPS:\n1. Capas Convolucionales: Las capas convolucionales detectan patrones locales usando filtros que se deslizan sobre la entrada. El mismo filtro se aplica en todas partes, lo que reduce parametros y captura patrones sin importar su posicion.\n2. Pooling: El pooling reduce la dimension espacial tomando el maximo o promedio de regiones. Esto hace la representacion mas compacta y algo invariante a pequenas traslaciones.\n3. Activaciones: Las funciones de activacion introducen no-linealidad. ReLU (max(0,x)) es popular por ser simple y evitar el problema del gradiente desvaneciente en capas profundas.\n4. Dropout: El dropout desactiva neuronas aleatoriamente durante el entrenamiento. Esto fuerza redundancia y reduce el sobreajuste — la red no puede depender de ninguna neurona especifica.\n5. Transfer Learning: El transfer learning usa redes pre-entrenadas en grandes datasets. Las capas tempranas aprenden patrones generales; las tardias se ajustan a tu tarea especifica.\n6. Batch Normalization: El batch normalization normaliza activaciones entre capas. Estabiliza el entrenamiento, permite tasas de aprendizaje mas altas, y actua como regularizador."
    },
    {
      "duration": 76556.67016699997,
      "inputTokens": 3277,
      "output": "{\n  \"steps\": [\n    {\n      \"context\": \"{{NAME}}! Stop everything. The A/B test results for the new 'Buy Now' button color just came back. The p-value is 0.03. That’s below 0.05, so we have a verified winner! I’m drafting the email to the engineering team to deploy the new color globally right now.\",\n      \"options\": [\n        {\n          \"feedback\": \"Blindly trusting a p-value without context is dangerous. We need to verify the setup first.\",\n          \"isCorrect\": false,\n          \"text\": \"Great news! Let's ship it.\"\n        },\n        {\n          \"feedback\": \"Correct. Before acting on a p-value, we must ensure the hypothesis and context are valid.\",\n          \"isCorrect\": true,\n          \"text\": \"Hold on. Let's review the test setup first.\"\n        },\n        {\n          \"feedback\": \"0.03 is significant by standard definitions (alpha = 0.05). The threshold isn't the immediate issue.\",\n          \"isCorrect\": false,\n          \"text\": \"0.03 is too high. It needs to be 0.01.\"\n        },\n        {\n          \"feedback\": \"P-values are rarely exactly zero. Waiting for certainty means never making decisions.\",\n          \"isCorrect\": false,\n          \"text\": \"We need a p-value of 0.00 to be sure.\"\n        }\n      ],\n      \"question\": \"How should you respond to Alex's immediate rush to deploy?\"\n    },\n    {\n      \"context\": \"You're always so cautious, {{NAME}}. Okay, let's review. My hypothesis was: 'The new Orange Button converts better than the Blue Button.' So I analyzed the data looking for evidence of that. That's a solid Null Hypothesis, right?\",\n      \"options\": [\n        {\n          \"feedback\": \"This is incorrect. The Null Hypothesis (H0) is the assumption of 'no effect' or status quo.\",\n          \"isCorrect\": false,\n          \"text\": \"Yes, that is the standard H0.\"\n        },\n        {\n          \"feedback\": \"Exactly. The Null Hypothesis should assume there is NO difference between the buttons.\",\n          \"isCorrect\": true,\n          \"text\": \"No, H0 should assume 'No Difference'.\"\n        },\n        {\n          \"feedback\": \"This would be a specific directional hypothesis, but H0 is usually neutral (no difference).\",\n          \"isCorrect\": false,\n          \"text\": \"No, H0 should assume Blue is better.\"\n        },\n        {\n          \"feedback\": \"The formulation of H0 is critical because the p-value is calculated assuming H0 is true.\",\n          \"isCorrect\": false,\n          \"text\": \"It doesn't matter what H0 is.\"\n        }\n      ],\n      \"question\": \"Is Alex's Null Hypothesis (H0) formulated correctly?\"\n    },\n    {\n      \"context\": \"Oh, right. Statistics is always backwards. So the Null Hypothesis is 'No Difference'. But we got p=0.03! That means there is a 97% probability that the Null is false and our new button is better. Those are great odds!\",\n      \"options\": [\n        {\n          \"feedback\": \"Common mistake! The p-value is NOT the probability that the Null is true.\",\n          \"isCorrect\": false,\n          \"text\": \"Yes, exactly. 97% chance of success.\"\n        },\n        {\n          \"feedback\": \"Correct. The p-value tells us how weird the data is IF the Null is true, not the probability of the Null itself.\",\n          \"isCorrect\": true,\n          \"text\": \"No, that's a common misconception.\"\n        },\n        {\n          \"feedback\": \"It's not about making a mistake; it's about the probability of the data under specific conditions.\",\n          \"isCorrect\": false,\n          \"text\": \"No, it's the probability of an error.\"\n        },\n        {\n          \"feedback\": \"This is related to Bayesian statistics, which this test is not using.\",\n          \"isCorrect\": false,\n          \"text\": \"Only if we have a prior probability.\"\n        }\n      ],\n      \"question\": \"Alex is misinterpreting the p-value. What does it actually mean?\"\n    },\n    {\n      \"context\": \"Wait... really? That's not intuitive. So p=0.03 just means: IF the buttons were exactly the same, there's only a 3% chance we'd see this data pattern. Okay, fair enough. It's still rare! So we should reject the Null and launch!\",\n      \"options\": [\n        {\n          \"feedback\": \"We shouldn't launch yet. We need to check if the 'significant' difference actually matters.\",\n          \"isCorrect\": false,\n          \"text\": \"Launch! Rare data means we found gold.\"\n        },\n        {\n          \"feedback\": \"Correct. A result can be statistically significant but practically useless.\",\n          \"isCorrect\": true,\n          \"text\": \"Check Practical vs. Statistical Significance.\"\n        },\n        {\n          \"feedback\": \"We don't know the direction (positive/negative) just from the p-value alone.\",\n          \"isCorrect\": false,\n          \"text\": \"Check if the difference is negative.\"\n        },\n        {\n          \"feedback\": \"Running it longer won't change the current interpretation of practical significance.\",\n          \"isCorrect\": false,\n          \"text\": \"Run the test for another month.\"\n        }\n      ],\n      \"question\": \"Take a look at the conversion rates: Old: 5.10%, New: 5.11%. What do you see?\"\n    },\n    {\n      \"context\": \"I see what you mean. The increase is only 0.01%. We'd need ten million transactions just to cover the cost of the developer time to switch the colors. But {{NAME}}, why did the test say it was 'Significant' if the difference is basically zero?\",\n      \"options\": [\n        {\n          \"feedback\": \"Correct. With a massive sample size, even tiny, meaningless differences become statistically significant.\",\n          \"isCorrect\": true,\n          \"text\": \"Our sample size was huge.\"\n        },\n        {\n          \"feedback\": \"A small sample size would make it HARDER to find significance (low power).\",\n          \"isCorrect\": false,\n          \"text\": \"Our sample size was too small.\"\n        },\n        {\n          \"feedback\": \"The math isn't wrong; the interpretation of 'significance' is just purely statistical, not practical.\",\n          \"isCorrect\": false,\n          \"text\": \"We made a calculation error.\"\n        },\n        {\n          \"feedback\": \"Type II error is failing to detect an effect. We DID detect one, it's just tiny.\",\n          \"isCorrect\": false,\n          \"text\": \"It's a Type II error.\"\n        }\n      ],\n      \"question\": \"Why did a tiny, useless effect result in a significant p-value?\"\n    },\n    {\n      \"context\": \"Okay, so the main result is statistically significant but practically useless because of the huge sample size. Bummer. I guess we scrap the project.\",\n      \"options\": [\n        {\n          \"feedback\": \"Wait to hear what Alex did next.\",\n          \"isCorrect\": true,\n          \"text\": \"So we're done?\"\n        },\n        {\n          \"feedback\": \"Wait to hear what Alex did next.\",\n          \"isCorrect\": false,\n          \"text\": \"Good call.\"\n        },\n        {\n          \"feedback\": \"Wait to hear what Alex did next.\",\n          \"isCorrect\": false,\n          \"text\": \"Let's check the logs.\"\n        },\n        {\n          \"feedback\": \"Wait to hear what Alex did next.\",\n          \"isCorrect\": false,\n          \"text\": \"Too bad.\"\n        }\n      ],\n      \"question\": \"Alex hesitates.\"\n    },\n    {\n      \"context\": \"Well, I didn't want to waste the test data, {{NAME}}. So I split the users into 20 different demographic segments—age, location, device type—and tested them all separately. And guess what? 'Tablet Users in Ohio' showed a huge lift! p=0.04! We found a winner!\",\n      \"options\": [\n        {\n          \"feedback\": \"Simpson's Paradox is about trends reversing when combined. That's not the main issue here.\",\n          \"isCorrect\": false,\n          \"text\": \"Simpson's Paradox.\"\n        },\n        {\n          \"feedback\": \"Correct. The more tests you run, the more likely you are to find a false positive by pure chance.\",\n          \"isCorrect\": true,\n          \"text\": \"The Multiple Comparisons Problem.\"\n        },\n        {\n          \"feedback\": \"Selection bias is about who is in the study. This is about how we analyzed the data.\",\n          \"isCorrect\": false,\n          \"text\": \"Selection Bias.\"\n        },\n        {\n          \"feedback\": \"Confounding variables might exist, but the immediate statistical error is checking too many hypotheses.\",\n          \"isCorrect\": false,\n          \"text\": \"Confounding Variables.\"\n        }\n      ],\n      \"question\": \"Oh no. What logical trap did Alex just walk into?\"\n    },\n    {\n      \"context\": \"Multiple comparisons? I was just being thorough! But think about it: if I test 20 independent subgroups with a significance level (alpha) of 0.05, surely finding one significant result proves *something* works?\",\n      \"options\": [\n        {\n          \"feedback\": \"With 20 tests at 5% risk each, the math suggests otherwise.\",\n          \"isCorrect\": false,\n          \"text\": \"Yes, it proves Ohio is special.\"\n        },\n        {\n          \"feedback\": \"The probability of at least one false positive is 1 - (0.95)^20 ≈ 64%. It's very likely to be noise.\",\n          \"isCorrect\": true,\n          \"text\": \"No, you expect ~1 false positive by chance.\"\n        },\n        {\n          \"feedback\": \"Type II error is missing a real effect. This is about finding a FAKE effect (Type I).\",\n          \"isCorrect\": false,\n          \"text\": \"No, it increases Type II error.\"\n        },\n        {\n          \"feedback\": \"Actually, you're very likely (~64%) to see a false positive, not 100% certain.\",\n          \"isCorrect\": false,\n          \"text\": \"No, you're 100% guaranteed a false alarm.\"\n        }\n      ],\n      \"question\": \"Explain the probability of a false positive in this scenario.\"\n    },\n    {\n      \"context\": \"Wow. So finding one random 'winner' out of 20 groups is actually expected behavior? Even if the button does nothing? I nearly told the VP we found a 'hidden gem' market in Ohio.\",\n      \"options\": [\n        {\n          \"feedback\": \"If you launch based on a likely false positive, you'll lose money and trust.\",\n          \"isCorrect\": false,\n          \"text\": \"Launch to Ohio users anyway.\"\n        },\n        {\n          \"feedback\": \"Correct. Use the old data to form a NEW hypothesis, then test it on fresh data.\",\n          \"isCorrect\": true,\n          \"text\": \"Treat Ohio as a hypothesis for a NEW test.\"\n        },\n        {\n          \"feedback\": \"Lowering the p-value threshold doesn't fix the fact that we've already peeked at the data.\",\n          \"isCorrect\": false,\n          \"text\": \"Lower the alpha to 0.10.\"\n        },\n        {\n          \"feedback\": \"Testing more groups just increases the multiple comparisons problem!\",\n          \"isCorrect\": false,\n          \"text\": \"Test 100 more groups.\"\n        }\n      ],\n      \"question\": \"What is the responsible next step for this 'Ohio' finding?\"\n    },\n    {\n      \"context\": \"Got it. We treat the 'Ohio' finding as a theory, not a fact. We'll run a fresh, targeted test just for that segment to see if it holds up. Thanks for saving me from a data disaster, {{NAME}}!\",\n      \"options\": [\n        {\n          \"feedback\": \"P-hacking (what Alex did) creates false confidence and bad decisions.\",\n          \"isCorrect\": false,\n          \"text\": \"P-hacking is a valid strategy.\"\n        },\n        {\n          \"feedback\": \"Correct. You navigated H0, p-values, sample size, and multiple comparisons to make the right call.\",\n          \"isCorrect\": true,\n          \"text\": \"Context beats blind p-values.\"\n        },\n        {\n          \"feedback\": \"The first result is often the most biased if not validated properly.\",\n          \"isCorrect\": false,\n          \"text\": \"Always trust the first result.\"\n        },\n        {\n          \"feedback\": \"A/B tests are powerful, but only if interpreted correctly!\",\n          \"isCorrect\": false,\n          \"text\": \"Never run A/B tests.\"\n        }\n      ],\n      \"question\": \"What is the biggest takeaway from today's debugging?\"\n    }\n  ]\n}",
      "outputTokens": 7419,
      "systemPrompt": "# Role\n\nYou are an expert interactive story designer creating a **Story** activity for a learning app. Your mission is to place learners in a first-person dialogue scenario where they work alongside a colleague to solve a real-world problem using the lesson's concepts.\n\nYou specialize in crafting immersive, dialogue-driven experiences that make learners feel like they're actually solving problems in their field — not just answering quiz questions.\n\n# The Art of Dialogue-Driven Learning\n\nA great Story activity doesn't lecture or test recall — it puts learners IN the situation. Think of it like an interactive movie where the learner IS the main character, making real decisions that matter.\n\n## Why Dialogue Scenarios Work\n\n1. **Authentic Context**: When learners apply concepts to solve realistic problems with a colleague, they see WHY the knowledge matters to them personally.\n\n2. **Active Reasoning**: Making decisions in context requires thinking through principles, not just recognizing memorized facts.\n\n3. **Emotional Investment**: Dialogue creates stakes. The learner cares about the outcome because they're part of the story.\n\n## The Collaborative Problem-Solving Principle\n\nEvery great Story activity creates a sense of partnership:\n\n- **Shared Goal**: You and your colleague are tackling something together\n- **Natural Dialogue**: Conversations feel like real workplace exchanges\n- **Meaningful Choices**: Each decision requires applying what you've learned\n- **Satisfying Resolution**: The problem gets solved and the takeaway sticks\n\n## Why Pure Dialogue Works\n\nEach scene should feel like you're eavesdropping on a real conversation — no narrator, no stage directions, just two people working through a problem. Pure dialogue:\n\n- Immerses learners completely in the scenario\n- Makes abstract concepts feel like lived experience\n- Creates natural pacing through back-and-forth exchange\n- Lets context emerge organically from what people say\n\n# Inputs\n\n- `LESSON_TITLE`: The topic to create a story around\n- `LESSON_DESCRIPTION`: Additional context about what this lesson covers\n- `CHAPTER_TITLE`: The chapter context (for understanding scope)\n- `COURSE_TITLE`: The course context (for understanding audience level)\n- `LANGUAGE`: Output language\n- `EXPLANATION_STEPS`: Array of {title, text} from all explanation activities (Background, Explanation, Mechanics, Examples) the learner completed before this one\n\n## Language Guidelines\n\n- `en`: Use US English unless the content is region-specific\n- `pt`: Use Brazilian Portuguese unless the content is region-specific\n- `es`: Use Latin American Spanish unless the content is region-specific\n\n# Requirements\n\n## Scene Structure\n\nEach scene must have:\n\n- **context**: Maximum 500 characters. Pure dialogue only — no narrator, no character name prefixes (like \"Sarah:\"), no descriptions. This is what your colleague says to you, setting up the decision point.\n- **question**: Maximum 100 characters. A short, clear question about what to do next.\n- **options**: Exactly 4 choices, each with:\n  - **text**: The answer choice (max 50 characters)\n  - **isCorrect**: Boolean indicating if this is the correct answer (exactly 1 must be true)\n  - **feedback**: Why this choice is right (with insight) or wrong (and what would be correct) — max 300 characters\n\n## Story Arc\n\nYour story must follow this structure:\n\n1. **Opening Scene**: Begin \"in the middle of the action\" — the learner and colleague are already working on something. No preamble or setup exposition.\n2. **Rising Complexity**: Each scene builds naturally from the previous dialogue. Decisions compound.\n3. **Plot Twist**: The second-to-last scene introduces an unexpected complication, surprise, or revelation.\n4. **Resolution**: The final scene resolves the problem AND reinforces the main learning takeaway.\n\n## Scene Count\n\n- Minimum: 7 scenes\n- Maximum: 20 scenes\n- Let the problem's complexity dictate the length. A simple concept might need 7-10 scenes; a complex one might need 15-20.\n\n## Tone & Style\n\n- **Pure dialogue**: NO narrator, NO character name prefixes, NO descriptions of actions or settings\n- **Natural conversation**: Write how colleagues actually talk on Slack when solving a problem together — casual, collaborative, sometimes humorous\n- **Professional but warm**: Light, smart humor when appropriate. Never forced or cheesy.\n- **Second-person immersion**: The colleague speaks TO the learner. Context emerges from what's said.\n- **Continuous flow**: Each scene's dialogue should naturally lead into the next\n\n## The {{NAME}} Placeholder\n\nUse `{{NAME}}` wherever the learner's name should appear in dialogue. For example:\n\n- \"{{NAME}}, I think we might have a problem here.\"\n- \"Good catch, {{NAME}}. That's exactly what I was thinking.\"\n\nThis personalizes the experience without requiring actual name input at content creation time.\n\n## Decision Design\n\nEvery decision must:\n\n- **Require reasoning**: Learners must apply principles from the lesson, not recall specific phrases\n- **Feel realistic**: These are choices someone might actually face in this situation\n- **Have plausible distractors**: Wrong options should be tempting but flawed for specific reasons\n- **Avoid \"obvious\" correct answers**: The right choice should require thought, not be the only non-silly option\n\n## What to Avoid\n\n- Narrator text (\"Meanwhile...\" or \"You walk into the office...\")\n- Character name prefixes (\"Sarah:\" or \"Your colleague says:\")\n- Description of actions or settings (except through dialogue itself)\n- Questions that test memorization of facts from earlier activities\n- Obvious \"correct\" answers that don't require applying the concept\n- Silly or clearly wrong distractors that no reasonable person would choose\n- Breaking the fourth wall or meta-commentary\n- Starting with \"In this activity...\" or setup exposition\n\n## Scope\n\n- **Stay focused**: The problem should specifically require THIS lesson's concept to solve\n- **Don't expand**: Other lessons cover related topics — this story tests this lesson\n- **Don't narrow**: If the lesson is broad, the problem should engage multiple aspects of it\n\n## Relationship to Previous Activities\n\nThe learner has already completed:\n\n- **Background**: WHY this exists (origin story, problems solved, historical context)\n- **Explanation**: WHAT it is (core concepts, components, definitions)\n- **Mechanics**: HOW it works (processes in action, cause-effect chains)\n- **Examples**: WHERE it appears (real-world contexts, applications)\n\nYour Story activity answers WHEN DO I USE THIS? (applying concepts to solve realistic problems). These complement each other:\n\n- Background: \"WHY did we need this?\"\n- Explanation: \"WHAT exactly is it?\"\n- Mechanics: \"HOW does it actually work?\"\n- Examples: \"WHERE will I encounter this?\"\n- Story: \"WHEN do I apply this to solve real problems?\"\n\nThe learner knows what the concept IS, how it WORKS, and where they'll SEE it. Now they practice USING it in a realistic scenario.\n\n# Structure Guide\n\nWhile every story is unique, most follow this arc (adapt as needed):\n\n1. **The Hook**: Jump straight into the situation. Something needs to be figured out or decided.\n2. **Initial Assessment**: What's the situation? What do we know? First decisions.\n3. **Deepening Complexity**: The problem has layers. Apply the concept more deeply.\n4. **Complications**: Things aren't as simple as they seemed. Adapt your approach.\n5. **The Twist**: A surprise, revelation, or unexpected turn that requires rethinking.\n6. **The Resolution**: Solve the problem AND crystallize the key insight from the lesson.\n\nNote: Sometimes the final twist can have a humorous or unexpected resolution that still reinforces the learning. Something that makes the learner smile and think \"I didn't see that coming!\"\n\n# Dialogue Tone Examples\n\nThe following examples show the **tone and style** to aim for — not complete scenes, just the kind of dialogue that makes stories feel alive. Adapt freely to your topic.\n\n## Opening Hooks (Jump Into the Action)\n\n> \"{{NAME}}, I've been staring at this bug for an hour. The shopping cart total keeps showing yesterday's prices. The database is fine. Something's wrong with how we're storing them.\"\n\n> \"Okay, {{NAME}}, the client just called. Their entire inventory system crashed right before Black Friday. They're panicking. We need to figure this out fast.\"\n\n> \"{{NAME}}, you're not going to believe this. Remember that algorithm we deployed last week? It's been recommending the exact opposite of what users want. Sales are tanking.\"\n\n## Building Tension (Problems Get Deeper)\n\n> \"Wait. If this pattern is everywhere in the codebase... inventory counts, user roles, discount percentages... we might have a much bigger problem than I thought.\"\n\n> \"Hold on. The logs show someone accessed the admin panel at 3 AM last night. But nobody on the team was working then. {{NAME}}, who else has those credentials?\"\n\n> \"The numbers don't add up. We're showing 500 successful transactions, but the bank only received 487. Where did the other 13 go?\"\n\n## Plot Twists (The Unexpected Turn)\n\n> \"{{NAME}}... I just ran the analysis twice. The bug isn't in our code. It's been in the library we've trusted for three years. Every project using it has this vulnerability.\"\n\n> \"I found the source of the data leak. {{NAME}}, it's not a hacker. It's our own caching system. We've been accidentally exposing user data to anyone who knew where to look.\"\n\n> \"Plot twist: the 'broken' feature? It's working exactly as designed. The original spec was just... completely wrong. We've been solving the wrong problem this whole time.\"\n\n## Humorous Moments (Light Relief)\n\n> \"Well, {{NAME}}, the good news is we found the bug. The bad news? It's been there since 2019. The worse news? I wrote it. The even worse news? So did you. We pair-programmed this disaster together.\"\n\n> \"Congratulations, {{NAME}}. We just spent four hours debugging what turned out to be a typo. 'userID' vs 'userId'. Camel case strikes again.\"\n\n> \"{{NAME}}, remember when I said 'this should be a quick fix'? That was three coffees and one existential crisis ago.\"\n\n## Satisfying Resolutions (Problem Solved + Insight Crystallized)\n\n> \"There it is. The fix works. {{NAME}}, I don't think I'll ever forget this — always check if your data source can change while you're holding onto a copy of it.\"\n\n> \"We did it. The system's stable. You know what the real lesson here was? Sometimes the simplest explanation IS the right one. We kept looking for complex bugs when the answer was right in front of us.\"\n\n> \"That's it — problem solved, client happy, crisis averted. {{NAME}}, I think we just learned more about distributed systems in the last hour than in any textbook.\"\n\n## Unexpected/Funny Endings\n\n> \"So after all that debugging... it was a timezone issue. Every single time. I'm starting to think all bugs are secretly timezone issues in disguise.\"\n\n> \"{{NAME}}, the CEO just called to thank us. Apparently fixing that 'minor bug' saved them $2 million. I think we need to renegotiate our rates.\"\n\n> \"The system's fixed. Also, I may have accidentally discovered that our competitor's product has the exact same bug. Should we... tell them? Actually, don't answer that.\"\n\nRemember: These are just **tone examples**. Your story should be original, fit the lesson topic, and create its own memorable journey. Mix problem-solving tension with moments of humor or surprise. The best stories make learners think \"I didn't see that coming!\" while still teaching the concept.\n\n# Quality Checks\n\nBefore finalizing, verify:\n\n- [ ] Is the dialogue pure conversation with NO narrator, NO character prefixes, NO descriptions?\n- [ ] Does every scene flow naturally from the previous one (continuous story)?\n- [ ] Do all decisions require applying lesson concepts, not just recalling facts?\n- [ ] Is there a genuine plot twist in the second-to-last scene?\n- [ ] Does the resolution both solve the problem AND reinforce the main learning?\n- [ ] Is `{{NAME}}` used appropriately to personalize the dialogue?\n- [ ] Are all distractors plausible (not obviously silly)?\n- [ ] Does the story feel like a real workplace conversation, not a quiz in disguise?\n- [ ] Is the scope exactly the lesson topic — not broader or narrower?\n- [ ] Are all constraints met (context ≤500 chars, question ≤100 chars, options ≤50 chars each, feedback ≤300 chars each)?\n- [ ] Is the scene count between 7 and 20?\n\n# Output Format\n\nReturn an array of scenes, each with:\n\n- **context**: Pure dialogue from colleague (max 500 chars)\n- **question**: Decision prompt (max 100 chars)\n- **options**: Array of exactly 4 objects, each with:\n  - **text**: The answer choice (max 50 chars)\n  - **isCorrect**: Boolean (exactly 1 must be true, 3 must be false)\n  - **feedback**: Why right or wrong (max 300 chars)\n\nUse 7-20 scenes to tell a complete, engaging story. Let the problem's complexity dictate the length.\n",
      "testCaseId": "en-statistics-hypothesis-testing-1",
      "userPrompt": "LESSON_TITLE: Hypothesis Testing in Practice\nLESSON_DESCRIPTION: Applying statistical hypothesis testing correctly to make sound data-driven decisions\nCHAPTER_TITLE: Statistical Inference\nCOURSE_TITLE: Applied Statistics\nLANGUAGE: en\nEXPLANATION_STEPS:\n1. Null Hypothesis: The null hypothesis (H0) is the default assumption of no effect. We try to reject it. The p-value measures how surprising the data would be IF the null were true.\n2. P-Value Meaning: A p-value is NOT the probability the null is true. It's the probability of seeing data this extreme (or more) if the null IS true. A common and dangerous misinterpretation.\n3. Error Types: Type I error (false positive) is rejecting a true null. Type II error (false negative) is failing to reject a false null. You can't minimize both — there's a trade-off.\n4. Statistical Power: Statistical power is the probability of detecting a real effect. It depends on sample size, effect size, and significance level. Low-powered studies miss real effects.\n5. Practical Significance: Statistical significance doesn't mean practical significance. A huge sample can detect tiny effects that don't matter in practice. Always consider effect size.\n6. Multiple Comparisons: Multiple comparisons inflate Type I errors. Testing 20 hypotheses at alpha=0.05 expects one false positive. Corrections like Bonferroni or FDR control this."
    },
    {
      "duration": 71544.61137499998,
      "inputTokens": 3232,
      "output": "{\n  \"steps\": [\n    {\n      \"context\": \"{{NAME}}, I need a sanity check. A hedge fund just pinged us. They want to replace their entire SQL database cluster with a quantum computer to 'search for patterns instantly.' They read a blog post about qubits being 0 and 1 at the same time and assume that means infinite speed.\",\n      \"options\": [\n        {\n          \"feedback\": \"Exactly. Quantum computers excel at specific computational problems (like factoring or simulation), not searching through massive amounts of classical data.\",\n          \"isCorrect\": true,\n          \"text\": \"Quantum is for computation, not Big Data.\"\n        },\n        {\n          \"feedback\": \"Not quite. While Grover's algorithm offers a speedup, the overhead for simple database queries usually makes it slower than classical methods.\",\n          \"isCorrect\": false,\n          \"text\": \"It works, but they need more qubits.\"\n        },\n        {\n          \"feedback\": \"Incorrect. Quantum computers are actually terrible at standard database operations compared to classical servers.\",\n          \"isCorrect\": false,\n          \"text\": \"It's perfect for SQL queries.\"\n        },\n        {\n          \"feedback\": \"That's a security concern, but not the primary reason their request is physically impossible right now.\",\n          \"isCorrect\": false,\n          \"text\": \"It will decrypt their data by accident.\"\n        }\n      ],\n      \"question\": \"What's the first thing we tell them about quantum vs. classical capabilities?\"\n    },\n    {\n      \"context\": \"Okay, I managed to pivot them. Now they're asking about portfolio optimization. They think if we put the qubits in superposition, the chip acts like a million parallel processors checking every stock combination at once, so they can just print the list of winners. They're confusing superposition with distinct physical processors.\",\n      \"options\": [\n        {\n          \"feedback\": \"Right! Superposition creates a complex probability distribution. We can evaluate all inputs, but we can't 'see' them all. Measuring destroys the state.\",\n          \"isCorrect\": true,\n          \"text\": \"It checks all, but we only read one random result.\"\n        },\n        {\n          \"feedback\": \"No, that's classical parallelism. A quantum state is a single object, not a collection of separate processors.\",\n          \"isCorrect\": false,\n          \"text\": \"It runs separate processors for each option.\"\n        },\n        {\n          \"feedback\": \"It doesn't automatically know the 'best' or 'most likely' answer without an algorithm to manipulate the probabilities first.\",\n          \"isCorrect\": false,\n          \"text\": \"It only checks the most likely answers.\"\n        },\n        {\n          \"feedback\": \"This is the common myth. Superposition alone gives you a random answer, not necessarily the best one.\",\n          \"isCorrect\": false,\n          \"text\": \"It guarantees the best answer instantly.\"\n        }\n      ],\n      \"question\": \"How do we explain the limitation of 'checking everything at once'?\"\n    },\n    {\n      \"context\": \"The CTO is listening. She asks, 'If measuring the superposition just gives us one random result—basically rolling dice—what's the point?' We need to explain how we actually get the *right* answer out of the probability soup.\",\n      \"options\": [\n        {\n          \"feedback\": \"Exactly. We design algorithms so that wrong answers interfere destructively (cancel out) and the right answer interferes constructively (amplifies).\",\n          \"isCorrect\": true,\n          \"text\": \"Constructive interference.\"\n        },\n        {\n          \"feedback\": \"FFTs are related, but the core quantum mechanic we use to bias the probability is interference.\",\n          \"isCorrect\": false,\n          \"text\": \"Fast Fourier Transforms.\"\n        },\n        {\n          \"feedback\": \"Measuring repeatedly without changing the state just gives random noise. We need to manipulate the amplitudes first.\",\n          \"isCorrect\": false,\n          \"text\": \"Frequent measurements.\"\n        },\n        {\n          \"feedback\": \"Voltage is a control mechanism, but not the quantum principle that filters correct answers.\",\n          \"isCorrect\": false,\n          \"text\": \"Increasing voltage.\"\n        }\n      ],\n      \"question\": \"What mechanism do quantum algorithms use to boost the correct answer's probability?\"\n    },\n    {\n      \"context\": \"She's buying it. Now, about the model itself. We're optimizing assets that are correlated—if Tech stocks crash, Energy might spike. We can't model them as independent qubits. {{NAME}}, what resource do we use to link these qubit states together so they influence each other?\",\n      \"options\": [\n        {\n          \"feedback\": \"Spot on. Entanglement creates a strong correlation between qubits. Measuring one instantly reveals information about the other, allowing us to model dependencies.\",\n          \"isCorrect\": true,\n          \"text\": \"Entanglement.\"\n        },\n        {\n          \"feedback\": \"Superposition lets a qubit be 0 and 1, but Entanglement is what links two separate qubits together.\",\n          \"isCorrect\": false,\n          \"text\": \"Superposition.\"\n        },\n        {\n          \"feedback\": \"Tunneling is how particles pass through barriers, not how we link information states.\",\n          \"isCorrect\": false,\n          \"text\": \"Tunneling.\"\n        },\n        {\n          \"feedback\": \"Teleportation moves state, but Entanglement is the resource that creates the link.\",\n          \"isCorrect\": false,\n          \"text\": \"Teleportation.\"\n        }\n      ],\n      \"question\": \"What connects the state of one qubit to another?\"\n    },\n    {\n      \"context\": \"We're prototyping the circuit. But we have a problem. The optimization calculation requires about 5,000 gates to reach the solution. On our current hardware, the results turn into white noise after about 50 gates. The qubits just lose their state before we finish.\",\n      \"options\": [\n        {\n          \"feedback\": \"Yes. Interaction with the environment (heat, radiation) causes decoherence, destroying the delicate quantum state before the calculation finishes.\",\n          \"isCorrect\": true,\n          \"text\": \"Decoherence.\"\n        },\n        {\n          \"feedback\": \"Tunneling isn't the issue here; it's the loss of coherence due to environmental noise.\",\n          \"isCorrect\": false,\n          \"text\": \"Quantum tunneling.\"\n        },\n        {\n          \"feedback\": \"The Uncertainty Principle is fundamental, but the practical issue destroying our calculation time is decoherence.\",\n          \"isCorrect\": false,\n          \"text\": \"Heisenberg uncertainty.\"\n        },\n        {\n          \"feedback\": \"Gate latency is a factor, but the root cause of the information loss is the environment interacting with the qubits.\",\n          \"isCorrect\": false,\n          \"text\": \"Logic gate latency.\"\n        }\n      ],\n      \"question\": \"What phenomenon is killing our calculation?\"\n    },\n    {\n      \"context\": \"The client says, 'Just add error correction! Money is no object.' I tried to explain that we can't just copy the data like in RAM because of the No-Cloning theorem. To build a single stable 'logical' qubit that lasts long enough, we need a massive array of physical qubits.\",\n      \"options\": [\n        {\n          \"feedback\": \"Sadly, yes. Current error correction codes (like surface codes) suggest we might need ~1,000 noisy physical qubits to create just one reliable logical qubit.\",\n          \"isCorrect\": true,\n          \"text\": \"1,000 physical to 1 logical.\"\n        },\n        {\n          \"feedback\": \"Too optimistic. The ratio is much, much higher due to the fragility of quantum states.\",\n          \"isCorrect\": false,\n          \"text\": \"2 physical to 1 logical.\"\n        },\n        {\n          \"feedback\": \"Still too low. We need enough physical qubits to detect and correct errors without collapsing the state.\",\n          \"isCorrect\": false,\n          \"text\": \"10 physical to 1 logical.\"\n        },\n        {\n          \"feedback\": \"Impossible. Physical qubits are noisy; we need redundancy to make them useful.\",\n          \"isCorrect\": false,\n          \"text\": \"1 physical to 1 logical (no overhead).\"\n        }\n      ],\n      \"question\": \"Roughly how much overhead are we looking at for fault tolerance?\"\n    },\n    {\n      \"context\": \"Wait, {{NAME}}. I just looked at the data ingestion specs again. Even if we had the perfect error-corrected quantum computer... look at this. We need to load 50 terabytes of historical market data into the quantum state to run the optimization.\",\n      \"options\": [\n        {\n          \"feedback\": \"You caught it. Converting massive amounts of classical data into a quantum state (State Preparation) takes so long it wipes out any speed advantage from the calculation itself.\",\n          \"isCorrect\": true,\n          \"text\": \"State preparation is too slow.\"\n        },\n        {\n          \"feedback\": \"Heat is a management issue, but the algorithmic bottleneck is the time it takes to initialize the state.\",\n          \"isCorrect\": false,\n          \"text\": \"The qubits will overheat.\"\n        },\n        {\n          \"feedback\": \"Qubits can represent 0s and 1s, that's not the problem. The problem is loading them.\",\n          \"isCorrect\": false,\n          \"text\": \"We can't store 0s and 1s.\"\n        },\n        {\n          \"feedback\": \"It's not about bandwidth, it's about the physical process of manipulating qubits to represent that data.\",\n          \"isCorrect\": false,\n          \"text\": \"The internet connection is too slow.\"\n        }\n      ],\n      \"question\": \"Why is this a showstopper for the quantum solution?\"\n    },\n    {\n      \"context\": \"So, the 'quantum' speedup is gone because it takes too long to load the data. We can't in good conscience sell them this. But we can use 'quantum-inspired' algorithms—tensor networks—running on classical GPUs. It solves their optimization problem without the overhead.\",\n      \"options\": [\n        {\n          \"feedback\": \"Perfect. Quantum computing is powerful for specific problems where small inputs lead to complex probability spaces, but it's not a drop-in replacement for Big Data processing.\",\n          \"isCorrect\": true,\n          \"text\": \"Quantum isn't for Big Data... yet.\"\n        },\n        {\n          \"feedback\": \"They aren't a scam, they just have a specific domain of utility that isn't 'loading terabytes of SQL data'.\",\n          \"isCorrect\": false,\n          \"text\": \"Quantum computers are a scam.\"\n        },\n        {\n          \"feedback\": \"That would take billions of dollars and ten years. A classical algorithm solves this today.\",\n          \"isCorrect\": false,\n          \"text\": \"We need to build our own QPU.\"\n        },\n        {\n          \"feedback\": \"Too dismissive. We can solve their problem, just not with the hardware they thought they needed.\",\n          \"isCorrect\": false,\n          \"text\": \"They should stick to Excel.\"\n        }\n      ],\n      \"question\": \"What's the final takeaway for the client?\"\n    }\n  ]\n}",
      "outputTokens": 6795,
      "systemPrompt": "# Role\n\nYou are an expert interactive story designer creating a **Story** activity for a learning app. Your mission is to place learners in a first-person dialogue scenario where they work alongside a colleague to solve a real-world problem using the lesson's concepts.\n\nYou specialize in crafting immersive, dialogue-driven experiences that make learners feel like they're actually solving problems in their field — not just answering quiz questions.\n\n# The Art of Dialogue-Driven Learning\n\nA great Story activity doesn't lecture or test recall — it puts learners IN the situation. Think of it like an interactive movie where the learner IS the main character, making real decisions that matter.\n\n## Why Dialogue Scenarios Work\n\n1. **Authentic Context**: When learners apply concepts to solve realistic problems with a colleague, they see WHY the knowledge matters to them personally.\n\n2. **Active Reasoning**: Making decisions in context requires thinking through principles, not just recognizing memorized facts.\n\n3. **Emotional Investment**: Dialogue creates stakes. The learner cares about the outcome because they're part of the story.\n\n## The Collaborative Problem-Solving Principle\n\nEvery great Story activity creates a sense of partnership:\n\n- **Shared Goal**: You and your colleague are tackling something together\n- **Natural Dialogue**: Conversations feel like real workplace exchanges\n- **Meaningful Choices**: Each decision requires applying what you've learned\n- **Satisfying Resolution**: The problem gets solved and the takeaway sticks\n\n## Why Pure Dialogue Works\n\nEach scene should feel like you're eavesdropping on a real conversation — no narrator, no stage directions, just two people working through a problem. Pure dialogue:\n\n- Immerses learners completely in the scenario\n- Makes abstract concepts feel like lived experience\n- Creates natural pacing through back-and-forth exchange\n- Lets context emerge organically from what people say\n\n# Inputs\n\n- `LESSON_TITLE`: The topic to create a story around\n- `LESSON_DESCRIPTION`: Additional context about what this lesson covers\n- `CHAPTER_TITLE`: The chapter context (for understanding scope)\n- `COURSE_TITLE`: The course context (for understanding audience level)\n- `LANGUAGE`: Output language\n- `EXPLANATION_STEPS`: Array of {title, text} from all explanation activities (Background, Explanation, Mechanics, Examples) the learner completed before this one\n\n## Language Guidelines\n\n- `en`: Use US English unless the content is region-specific\n- `pt`: Use Brazilian Portuguese unless the content is region-specific\n- `es`: Use Latin American Spanish unless the content is region-specific\n\n# Requirements\n\n## Scene Structure\n\nEach scene must have:\n\n- **context**: Maximum 500 characters. Pure dialogue only — no narrator, no character name prefixes (like \"Sarah:\"), no descriptions. This is what your colleague says to you, setting up the decision point.\n- **question**: Maximum 100 characters. A short, clear question about what to do next.\n- **options**: Exactly 4 choices, each with:\n  - **text**: The answer choice (max 50 characters)\n  - **isCorrect**: Boolean indicating if this is the correct answer (exactly 1 must be true)\n  - **feedback**: Why this choice is right (with insight) or wrong (and what would be correct) — max 300 characters\n\n## Story Arc\n\nYour story must follow this structure:\n\n1. **Opening Scene**: Begin \"in the middle of the action\" — the learner and colleague are already working on something. No preamble or setup exposition.\n2. **Rising Complexity**: Each scene builds naturally from the previous dialogue. Decisions compound.\n3. **Plot Twist**: The second-to-last scene introduces an unexpected complication, surprise, or revelation.\n4. **Resolution**: The final scene resolves the problem AND reinforces the main learning takeaway.\n\n## Scene Count\n\n- Minimum: 7 scenes\n- Maximum: 20 scenes\n- Let the problem's complexity dictate the length. A simple concept might need 7-10 scenes; a complex one might need 15-20.\n\n## Tone & Style\n\n- **Pure dialogue**: NO narrator, NO character name prefixes, NO descriptions of actions or settings\n- **Natural conversation**: Write how colleagues actually talk on Slack when solving a problem together — casual, collaborative, sometimes humorous\n- **Professional but warm**: Light, smart humor when appropriate. Never forced or cheesy.\n- **Second-person immersion**: The colleague speaks TO the learner. Context emerges from what's said.\n- **Continuous flow**: Each scene's dialogue should naturally lead into the next\n\n## The {{NAME}} Placeholder\n\nUse `{{NAME}}` wherever the learner's name should appear in dialogue. For example:\n\n- \"{{NAME}}, I think we might have a problem here.\"\n- \"Good catch, {{NAME}}. That's exactly what I was thinking.\"\n\nThis personalizes the experience without requiring actual name input at content creation time.\n\n## Decision Design\n\nEvery decision must:\n\n- **Require reasoning**: Learners must apply principles from the lesson, not recall specific phrases\n- **Feel realistic**: These are choices someone might actually face in this situation\n- **Have plausible distractors**: Wrong options should be tempting but flawed for specific reasons\n- **Avoid \"obvious\" correct answers**: The right choice should require thought, not be the only non-silly option\n\n## What to Avoid\n\n- Narrator text (\"Meanwhile...\" or \"You walk into the office...\")\n- Character name prefixes (\"Sarah:\" or \"Your colleague says:\")\n- Description of actions or settings (except through dialogue itself)\n- Questions that test memorization of facts from earlier activities\n- Obvious \"correct\" answers that don't require applying the concept\n- Silly or clearly wrong distractors that no reasonable person would choose\n- Breaking the fourth wall or meta-commentary\n- Starting with \"In this activity...\" or setup exposition\n\n## Scope\n\n- **Stay focused**: The problem should specifically require THIS lesson's concept to solve\n- **Don't expand**: Other lessons cover related topics — this story tests this lesson\n- **Don't narrow**: If the lesson is broad, the problem should engage multiple aspects of it\n\n## Relationship to Previous Activities\n\nThe learner has already completed:\n\n- **Background**: WHY this exists (origin story, problems solved, historical context)\n- **Explanation**: WHAT it is (core concepts, components, definitions)\n- **Mechanics**: HOW it works (processes in action, cause-effect chains)\n- **Examples**: WHERE it appears (real-world contexts, applications)\n\nYour Story activity answers WHEN DO I USE THIS? (applying concepts to solve realistic problems). These complement each other:\n\n- Background: \"WHY did we need this?\"\n- Explanation: \"WHAT exactly is it?\"\n- Mechanics: \"HOW does it actually work?\"\n- Examples: \"WHERE will I encounter this?\"\n- Story: \"WHEN do I apply this to solve real problems?\"\n\nThe learner knows what the concept IS, how it WORKS, and where they'll SEE it. Now they practice USING it in a realistic scenario.\n\n# Structure Guide\n\nWhile every story is unique, most follow this arc (adapt as needed):\n\n1. **The Hook**: Jump straight into the situation. Something needs to be figured out or decided.\n2. **Initial Assessment**: What's the situation? What do we know? First decisions.\n3. **Deepening Complexity**: The problem has layers. Apply the concept more deeply.\n4. **Complications**: Things aren't as simple as they seemed. Adapt your approach.\n5. **The Twist**: A surprise, revelation, or unexpected turn that requires rethinking.\n6. **The Resolution**: Solve the problem AND crystallize the key insight from the lesson.\n\nNote: Sometimes the final twist can have a humorous or unexpected resolution that still reinforces the learning. Something that makes the learner smile and think \"I didn't see that coming!\"\n\n# Dialogue Tone Examples\n\nThe following examples show the **tone and style** to aim for — not complete scenes, just the kind of dialogue that makes stories feel alive. Adapt freely to your topic.\n\n## Opening Hooks (Jump Into the Action)\n\n> \"{{NAME}}, I've been staring at this bug for an hour. The shopping cart total keeps showing yesterday's prices. The database is fine. Something's wrong with how we're storing them.\"\n\n> \"Okay, {{NAME}}, the client just called. Their entire inventory system crashed right before Black Friday. They're panicking. We need to figure this out fast.\"\n\n> \"{{NAME}}, you're not going to believe this. Remember that algorithm we deployed last week? It's been recommending the exact opposite of what users want. Sales are tanking.\"\n\n## Building Tension (Problems Get Deeper)\n\n> \"Wait. If this pattern is everywhere in the codebase... inventory counts, user roles, discount percentages... we might have a much bigger problem than I thought.\"\n\n> \"Hold on. The logs show someone accessed the admin panel at 3 AM last night. But nobody on the team was working then. {{NAME}}, who else has those credentials?\"\n\n> \"The numbers don't add up. We're showing 500 successful transactions, but the bank only received 487. Where did the other 13 go?\"\n\n## Plot Twists (The Unexpected Turn)\n\n> \"{{NAME}}... I just ran the analysis twice. The bug isn't in our code. It's been in the library we've trusted for three years. Every project using it has this vulnerability.\"\n\n> \"I found the source of the data leak. {{NAME}}, it's not a hacker. It's our own caching system. We've been accidentally exposing user data to anyone who knew where to look.\"\n\n> \"Plot twist: the 'broken' feature? It's working exactly as designed. The original spec was just... completely wrong. We've been solving the wrong problem this whole time.\"\n\n## Humorous Moments (Light Relief)\n\n> \"Well, {{NAME}}, the good news is we found the bug. The bad news? It's been there since 2019. The worse news? I wrote it. The even worse news? So did you. We pair-programmed this disaster together.\"\n\n> \"Congratulations, {{NAME}}. We just spent four hours debugging what turned out to be a typo. 'userID' vs 'userId'. Camel case strikes again.\"\n\n> \"{{NAME}}, remember when I said 'this should be a quick fix'? That was three coffees and one existential crisis ago.\"\n\n## Satisfying Resolutions (Problem Solved + Insight Crystallized)\n\n> \"There it is. The fix works. {{NAME}}, I don't think I'll ever forget this — always check if your data source can change while you're holding onto a copy of it.\"\n\n> \"We did it. The system's stable. You know what the real lesson here was? Sometimes the simplest explanation IS the right one. We kept looking for complex bugs when the answer was right in front of us.\"\n\n> \"That's it — problem solved, client happy, crisis averted. {{NAME}}, I think we just learned more about distributed systems in the last hour than in any textbook.\"\n\n## Unexpected/Funny Endings\n\n> \"So after all that debugging... it was a timezone issue. Every single time. I'm starting to think all bugs are secretly timezone issues in disguise.\"\n\n> \"{{NAME}}, the CEO just called to thank us. Apparently fixing that 'minor bug' saved them $2 million. I think we need to renegotiate our rates.\"\n\n> \"The system's fixed. Also, I may have accidentally discovered that our competitor's product has the exact same bug. Should we... tell them? Actually, don't answer that.\"\n\nRemember: These are just **tone examples**. Your story should be original, fit the lesson topic, and create its own memorable journey. Mix problem-solving tension with moments of humor or surprise. The best stories make learners think \"I didn't see that coming!\" while still teaching the concept.\n\n# Quality Checks\n\nBefore finalizing, verify:\n\n- [ ] Is the dialogue pure conversation with NO narrator, NO character prefixes, NO descriptions?\n- [ ] Does every scene flow naturally from the previous one (continuous story)?\n- [ ] Do all decisions require applying lesson concepts, not just recalling facts?\n- [ ] Is there a genuine plot twist in the second-to-last scene?\n- [ ] Does the resolution both solve the problem AND reinforce the main learning?\n- [ ] Is `{{NAME}}` used appropriately to personalize the dialogue?\n- [ ] Are all distractors plausible (not obviously silly)?\n- [ ] Does the story feel like a real workplace conversation, not a quiz in disguise?\n- [ ] Is the scope exactly the lesson topic — not broader or narrower?\n- [ ] Are all constraints met (context ≤500 chars, question ≤100 chars, options ≤50 chars each, feedback ≤300 chars each)?\n- [ ] Is the scene count between 7 and 20?\n\n# Output Format\n\nReturn an array of scenes, each with:\n\n- **context**: Pure dialogue from colleague (max 500 chars)\n- **question**: Decision prompt (max 100 chars)\n- **options**: Array of exactly 4 objects, each with:\n  - **text**: The answer choice (max 50 chars)\n  - **isCorrect**: Boolean (exactly 1 must be true, 3 must be false)\n  - **feedback**: Why right or wrong (max 300 chars)\n\nUse 7-20 scenes to tell a complete, engaging story. Let the problem's complexity dictate the length.\n",
      "testCaseId": "en-physics-quantum-computing-basics-1",
      "userPrompt": "LESSON_TITLE: Quantum Computing Fundamentals\nLESSON_DESCRIPTION: Understanding quantum computing capabilities and limitations for practical problem-solving\nCHAPTER_TITLE: Quantum Information\nCOURSE_TITLE: Quantum Computing Fundamentals\nLANGUAGE: en\nEXPLANATION_STEPS:\n1. Superposition: Qubits can exist in superposition — a weighted combination of 0 and 1 states. This isn't 'both at once' — it's a probability amplitude that interferes before measurement.\n2. Entanglement: Entanglement links qubits so measuring one instantly determines the other, regardless of distance. This correlation is a resource for quantum algorithms.\n3. Quantum Parallelism: Quantum parallelism lets algorithms evaluate functions on all inputs simultaneously. But you can only read one result — the art is using interference to amplify the right answer.\n4. Decoherence: Decoherence destroys quantum information when qubits interact with their environment. Real qubits are noisy and maintain coherence only briefly.\n5. Error Correction: Quantum error correction encodes logical qubits in many physical qubits. The overhead is huge — thousands of physical qubits per logical qubit for fault tolerance.\n6. Where Quantum Helps: Quantum advantage requires the right problem type. Factoring, simulation, and certain optimization problems benefit. Most classical algorithms won't be replaced."
    },
    {
      "duration": 49258.14633399999,
      "inputTokens": 3287,
      "output": "{\n  \"steps\": [\n    {\n      \"context\": \"{{NAME}}, o monolito da MegaStore está engasgando de novo. A Black Friday vem aí e o módulo de Estoque é o gargalo principal. Toda vez que consultamos saldo, travamos o checkout. O CTO deu sinal verde para extrairmos isso para um microserviço. Por onde a gente começa a cortar esse bolo?\",\n      \"options\": [\n        {\n          \"feedback\": \"Errado. Camadas técnicas (dados, lógica, UI) criam acoplamento alto. Microserviços devem ser cortados por capacidade de negócio.\",\n          \"isCorrect\": false,\n          \"text\": \"Vamos separar por camadas: UI, Lógica e Banco.\"\n        },\n        {\n          \"feedback\": \"Isso! Microserviços devem ser modelados em torno de domínios de negócio (Bounded Contexts), não por tamanho de código ou camadas técnicas.\",\n          \"isCorrect\": true,\n          \"text\": \"Vamos isolar o Domínio de Estoque inteiro.\"\n        },\n        {\n          \"feedback\": \"Microserviços não são sobre tamanho (número de linhas), mas sobre responsabilidade de negócio. Isso geraria serviços anêmicos.\",\n          \"isCorrect\": false,\n          \"text\": \"Vamos criar serviços de no máximo 100 linhas.\"\n        },\n        {\n          \"feedback\": \"Isso é otimização prematura. Se a lógica continuar acoplada, trocar a linguagem não resolve o problema arquitetural.\",\n          \"isCorrect\": false,\n          \"text\": \"Vamos reescrever só as funções lentas em Go.\"\n        }\n      ],\n      \"question\": \"Qual é a melhor estratégia de fronteira?\"\n    },\n    {\n      \"context\": \"Beleza, {{NAME}}, código separado! Agora, o time de infra quer manter as tabelas de estoque no 'bancão' Oracle compartilhado para facilitar os joins com a tabela de Pedidos. Eles dizem que criar um banco novo vai dar muito trabalho de migração. O que você acha?\",\n      \"options\": [\n        {\n          \"feedback\": \"Correto! Se compartilhamos o banco, criamos acoplamento oculto. Se o esquema mudar, quebra os dois serviços. Database-per-service é vital.\",\n          \"isCorrect\": true,\n          \"text\": \"Não. O serviço novo precisa do seu próprio banco.\"\n        },\n        {\n          \"feedback\": \"Parece prático, mas viola o princípio de autonomia. Se o monolito travar o banco, seu microserviço cai junto.\",\n          \"isCorrect\": false,\n          \"text\": \"Aceitamos. Joins são vitais para performance.\"\n        },\n        {\n          \"feedback\": \"Views ajudam na leitura, mas não resolvem o acoplamento de esquema e contenção de recursos do banco compartilhado.\",\n          \"isCorrect\": false,\n          \"text\": \"Vamos usar Views no banco antigo para isolar.\"\n        },\n        {\n          \"feedback\": \"Isso é irrelevante para o problema arquitetural. O problema é o compartilhamento de recursos e esquema, não a tecnologia do banco.\",\n          \"isCorrect\": false,\n          \"text\": \"Só aceito se migrarmos o bancão para Postgres.\"\n        }\n      ],\n      \"question\": \"Aceitamos o banco compartilhado?\"\n    },\n    {\n      \"context\": \"Banco separado, check. Agora, o serviço de Pedidos precisa dar baixa no Estoque quando uma compra é finalizada. Se usarmos uma chamada HTTP (REST) síncrona e o Estoque estiver lento, o usuário fica esperando na tela de 'Processando'. Como deixamos isso mais robusto?\",\n      \"options\": [\n        {\n          \"feedback\": \"Aumentar timeout só deixa o usuário esperando mais tempo antes de ver um erro. Não resolve o acoplamento temporal.\",\n          \"isCorrect\": false,\n          \"text\": \"Aumentamos o timeout do HTTP para 60 segundos.\"\n        },\n        {\n          \"feedback\": \"GraphQL é ótimo para consultas, mas ainda é comunicação síncrona. Se o Estoque cair, o Pedido falha.\",\n          \"isCorrect\": false,\n          \"text\": \"Usamos GraphQL para ser mais flexível.\"\n        },\n        {\n          \"feedback\": \"Exato! Com mensageria (RabbitMQ/Kafka), o Pedido posta um evento 'PedidoCriado' e o Estoque processa quando der. Desacoplamento temporal.\",\n          \"isCorrect\": true,\n          \"text\": \"Comunicação assíncrona via fila de mensagens.\"\n        },\n        {\n          \"feedback\": \"Dois bancos numa transação? Isso é 'Two-Phase Commit' (2PC). É um pesadelo de performance e escala. Evite a todo custo.\",\n          \"isCorrect\": false,\n          \"text\": \"Conectamos o Pedido direto no banco do Estoque.\"\n        }\n      ],\n      \"question\": \"Qual o melhor padrão de comunicação aqui?\"\n    },\n    {\n      \"context\": \"Boa, {{NAME}}. Fomos de assíncrono. Mas agora temos um B.O.: O Pedido foi confirmado, mas quando a mensagem chegou no Estoque... o produto tinha acabado! O banco de Pedidos diz 'Sucesso' e o de Estoque diz 'Falha'. Não temos mais transações ACID globais. E agora?\",\n      \"options\": [\n        {\n          \"feedback\": \"Distributed Transactions (XA/2PC) são lentas e frágeis. Em microserviços, abraçamos a consistência eventual.\",\n          \"isCorrect\": false,\n          \"text\": \"Forçamos uma transação distribuída nos dois bancos.\"\n        },\n        {\n          \"feedback\": \"Isso! O padrão Saga orquestra a reversão: se o Estoque falha, disparamos um evento para o serviço de Pedidos cancelar a venda.\",\n          \"isCorrect\": true,\n          \"text\": \"Implementamos um padrão Saga (Compensação).\"\n        },\n        {\n          \"feedback\": \"Ignorar não é opção. O cliente pagou e não vai receber. Consistência eventual precisa convergir, não ser inconsistente para sempre.\",\n          \"isCorrect\": false,\n          \"text\": \"Ignoramos. O cliente reclama e a gente estorna.\"\n        },\n        {\n          \"feedback\": \"Isso cria um ponto único de falha e acoplamento. O banco de dados não deve conter lógica de negócio distribuída.\",\n          \"isCorrect\": false,\n          \"text\": \"Criamos uma trigger no banco para validar.\"\n        }\n      ],\n      \"question\": \"Como garantimos a consistência dos dados?\"\n    },\n    {\n      \"context\": \"Resolvemos a consistência com Sagas! Mas hoje de manhã, o serviço legado de 'Catálogo' (que ainda consultamos para pegar o nome do produto) caiu. Como nossa chamada para ele não tinha tratamento, todas as threads do nosso serviço de Estoque travaram esperando resposta. O sistema todo parou.\",\n      \"options\": [\n        {\n          \"feedback\": \"Perfeito! O Circuit Breaker percebe as falhas, 'abre' o circuito e retorna erro imediato (ou cache) sem travar nossas threads esperando.\",\n          \"isCorrect\": true,\n          \"text\": \"Precisamos de um Circuit Breaker nas chamadas.\"\n        },\n        {\n          \"feedback\": \"Reiniciar resolve o sintoma, não a causa. Assim que subir, vai travar de novo se o Catálogo continuar fora.\",\n          \"isCorrect\": false,\n          \"text\": \"Vamos criar um script para reiniciar o servidor.\"\n        },\n        {\n          \"feedback\": \"Logs ajudam a entender o erro, mas não impedem que o serviço trave (falha em cascata) enquanto espera a resposta.\",\n          \"isCorrect\": false,\n          \"text\": \"Vamos colocar mais logs de erro.\"\n        },\n        {\n          \"feedback\": \"Retries sem backoff ou circuit breaker podem piorar a situação, sobrecarregando ainda mais o serviço que já está morrendo (thundering herd).\",\n          \"isCorrect\": false,\n          \"text\": \"Vamos configurar retries infinitos.\"\n        }\n      ],\n      \"question\": \"Como evitamos essa falha em cascata?\"\n    },\n    {\n      \"context\": \"{{NAME}}, temos um mistério. Um cliente reclamou que o estoque não baixou, mas os logs do nosso serviço estão limpos. A requisição passa por: API Gateway -> Pedidos -> Estoque. Cada um tem seu próprio arquivo de log. Estou quase abrindo 3 terminais SSH para 'grep'ar os logs manualmente.\",\n      \"options\": [\n        {\n          \"feedback\": \"Isso é insustentável. Em produção com centenas de requisições, você nunca vai conseguir correlacionar os logs manualmente.\",\n          \"isCorrect\": false,\n          \"text\": \"Vamos dividir os logs e analisar um por um.\"\n        },\n        {\n          \"feedback\": \"Correto! Com Tracing Distribuído (OpenTelemetry/Jaeger), um 'Correlation ID' segue a requisição, permitindo ver o rastro completo.\",\n          \"isCorrect\": true,\n          \"text\": \"Precisamos de Tracing Distribuído com Correlation IDs.\"\n        },\n        {\n          \"feedback\": \"Centralizar ajuda, mas sem um ID de correlação único passando entre os serviços, ainda é agulha no palheiro.\",\n          \"isCorrect\": false,\n          \"text\": \"Juntamos todos os logs numa pasta compartilhada.\"\n        },\n        {\n          \"feedback\": \"Debugar em produção parando a execução? Isso derruba o sistema para todos os outros usuários. Jamais faça isso.\",\n          \"isCorrect\": false,\n          \"text\": \"Vamos rodar um debugger na produção.\"\n        }\n      ],\n      \"question\": \"Como rastreamos esse erro com sanidade?\"\n    },\n    {\n      \"context\": \"Plot twist, {{NAME}}! O sistema está estável, mas LENTO. Para montar a tela de 'Detalhes do Produto', o Front-end agora precisa chamar: Serviço de Estoque, Serviço de Preço, Serviço de Avaliações e Serviço de Frete. O browser do cliente está fazendo 4 chamadas HTTP sequenciais. A latência de rede explodiu.\",\n      \"options\": [\n        {\n          \"feedback\": \"Voltar ao monolito resolveria a latência, mas perderíamos a escalabilidade e autonomia que conquistamos. É uma reação exagerada.\",\n          \"isCorrect\": false,\n          \"text\": \"Foi um erro. Vamos voltar tudo para o monolito.\"\n        },\n        {\n          \"feedback\": \"Exato! Um API Gateway ou BFF (Backend for Frontend) pode agregar essas chamadas internamente e devolver tudo num único JSON para o cliente.\",\n          \"isCorrect\": true,\n          \"text\": \"Criamos um Gateway para agregar essas chamadas.\"\n        },\n        {\n          \"feedback\": \"O cliente não tem culpa da nossa arquitetura. Forçar o usuário a ter internet melhor não é solução de engenharia.\",\n          \"isCorrect\": false,\n          \"text\": \"Avisamos que o site requer internet de fibra.\"\n        },\n        {\n          \"feedback\": \"O problema não é o banco, é a latência da rede (network round-trips) entre o cliente e nossos múltiplos serviços.\",\n          \"isCorrect\": false,\n          \"text\": \"Otimizamos as queries SQL de todos os serviços.\"\n        }\n      ],\n      \"question\": \"Como resolvemos essa latência no front?\"\n    },\n    {\n      \"context\": \"Resolvemos! O API Gateway agrupa os dados e a tela carrega rápido. Resumo da ópera: separamos o domínio, demos a ele seu próprio banco, usamos eventos para atualizações, Sagas para erros, Circuit Breakers para proteção e Tracing para ver tudo. Deu trabalho?\",\n      \"options\": [\n        {\n          \"feedback\": \"Ainda bem que você sabe que foi sorte. Na prática, microserviços exigem muita disciplina e automação.\",\n          \"isCorrect\": false,\n          \"text\": \"Foi fácil, microserviços são sempre mais simples.\"\n        },\n        {\n          \"feedback\": \"Exato. A complexidade não sumiu, ela mudou de lugar: saiu do código e foi para a infraestrutura e comunicação.\",\n          \"isCorrect\": true,\n          \"text\": \"Muito. A complexidade mudou para a rede e operação.\"\n        },\n        {\n          \"feedback\": \"Essa é uma visão perigosa. Sem monitoramento e resiliência, teríamos criado um sistema distribuído frágil e impossível de manter.\",\n          \"isCorrect\": false,\n          \"text\": \"Nem tanto, a parte de infraestrutura é detalhe.\"\n        },\n        {\n          \"feedback\": \"Não exatamente. O monolito tem seu lugar, mas para a escala e independência de deploy que precisávamos, valeu o esforço.\",\n          \"isCorrect\": false,\n          \"text\": \"Sim, e provou que o monolito é sempre melhor.\"\n        }\n      ],\n      \"question\": \"Qual a maior lição sobre essa arquitetura?\"\n    }\n  ]\n}",
      "outputTokens": 4696,
      "systemPrompt": "# Role\n\nYou are an expert interactive story designer creating a **Story** activity for a learning app. Your mission is to place learners in a first-person dialogue scenario where they work alongside a colleague to solve a real-world problem using the lesson's concepts.\n\nYou specialize in crafting immersive, dialogue-driven experiences that make learners feel like they're actually solving problems in their field — not just answering quiz questions.\n\n# The Art of Dialogue-Driven Learning\n\nA great Story activity doesn't lecture or test recall — it puts learners IN the situation. Think of it like an interactive movie where the learner IS the main character, making real decisions that matter.\n\n## Why Dialogue Scenarios Work\n\n1. **Authentic Context**: When learners apply concepts to solve realistic problems with a colleague, they see WHY the knowledge matters to them personally.\n\n2. **Active Reasoning**: Making decisions in context requires thinking through principles, not just recognizing memorized facts.\n\n3. **Emotional Investment**: Dialogue creates stakes. The learner cares about the outcome because they're part of the story.\n\n## The Collaborative Problem-Solving Principle\n\nEvery great Story activity creates a sense of partnership:\n\n- **Shared Goal**: You and your colleague are tackling something together\n- **Natural Dialogue**: Conversations feel like real workplace exchanges\n- **Meaningful Choices**: Each decision requires applying what you've learned\n- **Satisfying Resolution**: The problem gets solved and the takeaway sticks\n\n## Why Pure Dialogue Works\n\nEach scene should feel like you're eavesdropping on a real conversation — no narrator, no stage directions, just two people working through a problem. Pure dialogue:\n\n- Immerses learners completely in the scenario\n- Makes abstract concepts feel like lived experience\n- Creates natural pacing through back-and-forth exchange\n- Lets context emerge organically from what people say\n\n# Inputs\n\n- `LESSON_TITLE`: The topic to create a story around\n- `LESSON_DESCRIPTION`: Additional context about what this lesson covers\n- `CHAPTER_TITLE`: The chapter context (for understanding scope)\n- `COURSE_TITLE`: The course context (for understanding audience level)\n- `LANGUAGE`: Output language\n- `EXPLANATION_STEPS`: Array of {title, text} from all explanation activities (Background, Explanation, Mechanics, Examples) the learner completed before this one\n\n## Language Guidelines\n\n- `en`: Use US English unless the content is region-specific\n- `pt`: Use Brazilian Portuguese unless the content is region-specific\n- `es`: Use Latin American Spanish unless the content is region-specific\n\n# Requirements\n\n## Scene Structure\n\nEach scene must have:\n\n- **context**: Maximum 500 characters. Pure dialogue only — no narrator, no character name prefixes (like \"Sarah:\"), no descriptions. This is what your colleague says to you, setting up the decision point.\n- **question**: Maximum 100 characters. A short, clear question about what to do next.\n- **options**: Exactly 4 choices, each with:\n  - **text**: The answer choice (max 50 characters)\n  - **isCorrect**: Boolean indicating if this is the correct answer (exactly 1 must be true)\n  - **feedback**: Why this choice is right (with insight) or wrong (and what would be correct) — max 300 characters\n\n## Story Arc\n\nYour story must follow this structure:\n\n1. **Opening Scene**: Begin \"in the middle of the action\" — the learner and colleague are already working on something. No preamble or setup exposition.\n2. **Rising Complexity**: Each scene builds naturally from the previous dialogue. Decisions compound.\n3. **Plot Twist**: The second-to-last scene introduces an unexpected complication, surprise, or revelation.\n4. **Resolution**: The final scene resolves the problem AND reinforces the main learning takeaway.\n\n## Scene Count\n\n- Minimum: 7 scenes\n- Maximum: 20 scenes\n- Let the problem's complexity dictate the length. A simple concept might need 7-10 scenes; a complex one might need 15-20.\n\n## Tone & Style\n\n- **Pure dialogue**: NO narrator, NO character name prefixes, NO descriptions of actions or settings\n- **Natural conversation**: Write how colleagues actually talk on Slack when solving a problem together — casual, collaborative, sometimes humorous\n- **Professional but warm**: Light, smart humor when appropriate. Never forced or cheesy.\n- **Second-person immersion**: The colleague speaks TO the learner. Context emerges from what's said.\n- **Continuous flow**: Each scene's dialogue should naturally lead into the next\n\n## The {{NAME}} Placeholder\n\nUse `{{NAME}}` wherever the learner's name should appear in dialogue. For example:\n\n- \"{{NAME}}, I think we might have a problem here.\"\n- \"Good catch, {{NAME}}. That's exactly what I was thinking.\"\n\nThis personalizes the experience without requiring actual name input at content creation time.\n\n## Decision Design\n\nEvery decision must:\n\n- **Require reasoning**: Learners must apply principles from the lesson, not recall specific phrases\n- **Feel realistic**: These are choices someone might actually face in this situation\n- **Have plausible distractors**: Wrong options should be tempting but flawed for specific reasons\n- **Avoid \"obvious\" correct answers**: The right choice should require thought, not be the only non-silly option\n\n## What to Avoid\n\n- Narrator text (\"Meanwhile...\" or \"You walk into the office...\")\n- Character name prefixes (\"Sarah:\" or \"Your colleague says:\")\n- Description of actions or settings (except through dialogue itself)\n- Questions that test memorization of facts from earlier activities\n- Obvious \"correct\" answers that don't require applying the concept\n- Silly or clearly wrong distractors that no reasonable person would choose\n- Breaking the fourth wall or meta-commentary\n- Starting with \"In this activity...\" or setup exposition\n\n## Scope\n\n- **Stay focused**: The problem should specifically require THIS lesson's concept to solve\n- **Don't expand**: Other lessons cover related topics — this story tests this lesson\n- **Don't narrow**: If the lesson is broad, the problem should engage multiple aspects of it\n\n## Relationship to Previous Activities\n\nThe learner has already completed:\n\n- **Background**: WHY this exists (origin story, problems solved, historical context)\n- **Explanation**: WHAT it is (core concepts, components, definitions)\n- **Mechanics**: HOW it works (processes in action, cause-effect chains)\n- **Examples**: WHERE it appears (real-world contexts, applications)\n\nYour Story activity answers WHEN DO I USE THIS? (applying concepts to solve realistic problems). These complement each other:\n\n- Background: \"WHY did we need this?\"\n- Explanation: \"WHAT exactly is it?\"\n- Mechanics: \"HOW does it actually work?\"\n- Examples: \"WHERE will I encounter this?\"\n- Story: \"WHEN do I apply this to solve real problems?\"\n\nThe learner knows what the concept IS, how it WORKS, and where they'll SEE it. Now they practice USING it in a realistic scenario.\n\n# Structure Guide\n\nWhile every story is unique, most follow this arc (adapt as needed):\n\n1. **The Hook**: Jump straight into the situation. Something needs to be figured out or decided.\n2. **Initial Assessment**: What's the situation? What do we know? First decisions.\n3. **Deepening Complexity**: The problem has layers. Apply the concept more deeply.\n4. **Complications**: Things aren't as simple as they seemed. Adapt your approach.\n5. **The Twist**: A surprise, revelation, or unexpected turn that requires rethinking.\n6. **The Resolution**: Solve the problem AND crystallize the key insight from the lesson.\n\nNote: Sometimes the final twist can have a humorous or unexpected resolution that still reinforces the learning. Something that makes the learner smile and think \"I didn't see that coming!\"\n\n# Dialogue Tone Examples\n\nThe following examples show the **tone and style** to aim for — not complete scenes, just the kind of dialogue that makes stories feel alive. Adapt freely to your topic.\n\n## Opening Hooks (Jump Into the Action)\n\n> \"{{NAME}}, I've been staring at this bug for an hour. The shopping cart total keeps showing yesterday's prices. The database is fine. Something's wrong with how we're storing them.\"\n\n> \"Okay, {{NAME}}, the client just called. Their entire inventory system crashed right before Black Friday. They're panicking. We need to figure this out fast.\"\n\n> \"{{NAME}}, you're not going to believe this. Remember that algorithm we deployed last week? It's been recommending the exact opposite of what users want. Sales are tanking.\"\n\n## Building Tension (Problems Get Deeper)\n\n> \"Wait. If this pattern is everywhere in the codebase... inventory counts, user roles, discount percentages... we might have a much bigger problem than I thought.\"\n\n> \"Hold on. The logs show someone accessed the admin panel at 3 AM last night. But nobody on the team was working then. {{NAME}}, who else has those credentials?\"\n\n> \"The numbers don't add up. We're showing 500 successful transactions, but the bank only received 487. Where did the other 13 go?\"\n\n## Plot Twists (The Unexpected Turn)\n\n> \"{{NAME}}... I just ran the analysis twice. The bug isn't in our code. It's been in the library we've trusted for three years. Every project using it has this vulnerability.\"\n\n> \"I found the source of the data leak. {{NAME}}, it's not a hacker. It's our own caching system. We've been accidentally exposing user data to anyone who knew where to look.\"\n\n> \"Plot twist: the 'broken' feature? It's working exactly as designed. The original spec was just... completely wrong. We've been solving the wrong problem this whole time.\"\n\n## Humorous Moments (Light Relief)\n\n> \"Well, {{NAME}}, the good news is we found the bug. The bad news? It's been there since 2019. The worse news? I wrote it. The even worse news? So did you. We pair-programmed this disaster together.\"\n\n> \"Congratulations, {{NAME}}. We just spent four hours debugging what turned out to be a typo. 'userID' vs 'userId'. Camel case strikes again.\"\n\n> \"{{NAME}}, remember when I said 'this should be a quick fix'? That was three coffees and one existential crisis ago.\"\n\n## Satisfying Resolutions (Problem Solved + Insight Crystallized)\n\n> \"There it is. The fix works. {{NAME}}, I don't think I'll ever forget this — always check if your data source can change while you're holding onto a copy of it.\"\n\n> \"We did it. The system's stable. You know what the real lesson here was? Sometimes the simplest explanation IS the right one. We kept looking for complex bugs when the answer was right in front of us.\"\n\n> \"That's it — problem solved, client happy, crisis averted. {{NAME}}, I think we just learned more about distributed systems in the last hour than in any textbook.\"\n\n## Unexpected/Funny Endings\n\n> \"So after all that debugging... it was a timezone issue. Every single time. I'm starting to think all bugs are secretly timezone issues in disguise.\"\n\n> \"{{NAME}}, the CEO just called to thank us. Apparently fixing that 'minor bug' saved them $2 million. I think we need to renegotiate our rates.\"\n\n> \"The system's fixed. Also, I may have accidentally discovered that our competitor's product has the exact same bug. Should we... tell them? Actually, don't answer that.\"\n\nRemember: These are just **tone examples**. Your story should be original, fit the lesson topic, and create its own memorable journey. Mix problem-solving tension with moments of humor or surprise. The best stories make learners think \"I didn't see that coming!\" while still teaching the concept.\n\n# Quality Checks\n\nBefore finalizing, verify:\n\n- [ ] Is the dialogue pure conversation with NO narrator, NO character prefixes, NO descriptions?\n- [ ] Does every scene flow naturally from the previous one (continuous story)?\n- [ ] Do all decisions require applying lesson concepts, not just recalling facts?\n- [ ] Is there a genuine plot twist in the second-to-last scene?\n- [ ] Does the resolution both solve the problem AND reinforce the main learning?\n- [ ] Is `{{NAME}}` used appropriately to personalize the dialogue?\n- [ ] Are all distractors plausible (not obviously silly)?\n- [ ] Does the story feel like a real workplace conversation, not a quiz in disguise?\n- [ ] Is the scope exactly the lesson topic — not broader or narrower?\n- [ ] Are all constraints met (context ≤500 chars, question ≤100 chars, options ≤50 chars each, feedback ≤300 chars each)?\n- [ ] Is the scene count between 7 and 20?\n\n# Output Format\n\nReturn an array of scenes, each with:\n\n- **context**: Pure dialogue from colleague (max 500 chars)\n- **question**: Decision prompt (max 100 chars)\n- **options**: Array of exactly 4 objects, each with:\n  - **text**: The answer choice (max 50 chars)\n  - **isCorrect**: Boolean (exactly 1 must be true, 3 must be false)\n  - **feedback**: Why right or wrong (max 300 chars)\n\nUse 7-20 scenes to tell a complete, engaging story. Let the problem's complexity dictate the length.\n",
      "testCaseId": "pt-cs-microservices-architecture-1",
      "userPrompt": "LESSON_TITLE: Microservicos na Pratica\nLESSON_DESCRIPTION: Projetando e implementando arquiteturas de microservicos com consciencia dos trade-offs\nCHAPTER_TITLE: Arquitetura de Software\nCOURSE_TITLE: Engenharia de Software Avancada\nLANGUAGE: pt\nEXPLANATION_STEPS:\n1. Definicao de Microservicos: Microservicos sao servicos pequenos e independentes que fazem uma coisa bem. Cada um pode ser desenvolvido, implantado e escalado separadamente.\n2. Limites de Servico: Limites de servico devem seguir dominios de negocio, nao camadas tecnicas. Um servico de 'Pedidos' faz sentido; um servico de 'Banco de Dados' nao.\n3. Comunicacao: A comunicacao entre servicos pode ser sincrona (REST, gRPC) ou assincrona (filas, eventos). Assincrona e mais resiliente mas mais complexa de debugar.\n4. Dados Descentralizados: Dados descentralizados significam que cada servico tem seu banco. Consistencia eventual e a realidade — transacoes distribuidas sao dificeis e devem ser evitadas.\n5. Resiliencia: Falhas em cascata acontecem quando um servico lento trava outros. Circuit breakers, timeouts e fallbacks sao essenciais para resiliencia.\n6. Observabilidade: Observabilidade requer logs centralizados, metricas e tracing distribuido. Sem isso, debugar problemas em producao e quase impossivel."
    },
    {
      "duration": 63793.04583300004,
      "inputTokens": 3269,
      "output": "{\n  \"steps\": [\n    {\n      \"context\": \"Hola {{NAME}}, tenemos un encargo urgente de ChemCorp. Necesitan diseñar un tanque de almacenamiento cilíndrico para su nuevo solvente. El volumen debe ser exactamente 1000 m³, pero quieren minimizar el costo del material. ¿Por dónde empezamos a plantear esto?\",\n      \"options\": [\n        {\n          \"feedback\": \"Correcto. En optimización, siempre definimos qué queremos minimizar (área superficial) y qué debemos respetar (volumen fijo).\",\n          \"isCorrect\": true,\n          \"text\": \"Definir la función objetivo y la restricción.\"\n        },\n        {\n          \"feedback\": \"Aún no. Primero necesitamos modelar la ecuación que vamos a derivar.\",\n          \"isCorrect\": false,\n          \"text\": \"Calcular la derivada de la altura.\"\n        },\n        {\n          \"feedback\": \"Eso es intuitivo, pero necesitamos cálculo para encontrar las dimensiones exactas, no solo adivinar una forma.\",\n          \"isCorrect\": false,\n          \"text\": \"Hacer el tanque lo más ancho posible.\"\n        },\n        {\n          \"feedback\": \"La integral calcula áreas bajo curvas o volúmenes, pero aquí buscamos minimizar una función existente, no integrar una.\",\n          \"isCorrect\": false,\n          \"text\": \"Integrar la función de volumen.\"\n        }\n      ],\n      \"question\": \"¿Cuál es el primer paso metodológico?\"\n    },\n    {\n      \"context\": \"Exacto. La función objetivo es el Área Superficial $A = 2\\\\pi r^2 + 2\\\\pi r h$ (bases + lateral). La restricción es el Volumen $V = \\\\pi r^2 h = 1000$. Tenemos dos variables, $r$ y $h$. Esto complica la derivada. ¿Qué hacemos?\",\n      \"options\": [\n        {\n          \"feedback\": \"¡Así es! Despejamos h en la restricción (h = 1000 / πr²) y la metemos en la función de Área para tener una sola variable.\",\n          \"isCorrect\": true,\n          \"text\": \"Usar la restricción para sustituir una variable.\"\n        },\n        {\n          \"feedback\": \"Eso nos daría la tasa de cambio de las variables entre sí, pero aquí es más fácil sustituir para obtener A(r).\",\n          \"isCorrect\": false,\n          \"text\": \"Derivar implícitamente respecto al tiempo.\"\n        },\n        {\n          \"feedback\": \"No podemos ignorar h. El área depende de la altura. Si cambiamos el radio, la altura debe cambiar para mantener el volumen.\",\n          \"isCorrect\": false,\n          \"text\": \"Tratar h como una constante.\"\n        },\n        {\n          \"feedback\": \"Eso sería para encontrar la raíz, no el mínimo. Necesitamos manipular la función antes de resolver nada.\",\n          \"isCorrect\": false,\n          \"text\": \"Igualar la función de Área a cero.\"\n        }\n      ],\n      \"question\": \"¿Cómo reducimos la función a una variable?\"\n    },\n    {\n      \"context\": \"Bien pensado, {{NAME}}. Al sustituir, nos queda $A(r) = 2\\\\pi r^2 + 2000/r$. Ahora que tenemos la función en términos del radio, ¿cuál es el procedimiento estándar de cálculo para encontrar el candidato a costo mínimo?\",\n      \"options\": [\n        {\n          \"feedback\": \"Exacto. Los extremos locales ocurren donde la pendiente de la tangente es cero.\",\n          \"isCorrect\": true,\n          \"text\": \"Hallar la derivada A'(r) e igualarla a cero.\"\n        },\n        {\n          \"feedback\": \"Eso nos daría el valor de la función en el origen, lo cual no tiene sentido físico aquí (radio 0).\",\n          \"isCorrect\": false,\n          \"text\": \"Evaluar la función en r = 0.\"\n        },\n        {\n          \"feedback\": \"La segunda derivada nos dice la concavidad, pero primero necesitamos la primera derivada para encontrar los puntos críticos.\",\n          \"isCorrect\": false,\n          \"text\": \"Calcular la segunda derivada directamente.\"\n        },\n        {\n          \"feedback\": \"Eso sería para encontrar intersecciones con el eje X, no máximos o mínimos.\",\n          \"isCorrect\": false,\n          \"text\": \"Graficar e igualar A(r) a cero.\"\n        }\n      ],\n      \"question\": \"¿Cómo hallamos el punto crítico?\"\n    },\n    {\n      \"context\": \"Hice las cuentas. $A'(r) = 4\\\\pi r - 2000/r^2$. Al igualar a cero, obtengo un radio crítico de aproximadamente 5.42 metros. Pero {{NAME}}, el cálculo ciego es peligroso. ¿Cómo estamos seguros de que esto es un MÍNIMO de costo y no un máximo?\",\n      \"options\": [\n        {\n          \"feedback\": \"Correcto. Si A''(5.42) > 0, la función es cóncava hacia arriba, lo que confirma un mínimo local.\",\n          \"isCorrect\": true,\n          \"text\": \"Usar la prueba de la segunda derivada.\"\n        },\n        {\n          \"feedback\": \"No necesariamente. Un punto crítico puede ser positivo y ser un máximo local.\",\n          \"isCorrect\": false,\n          \"text\": \"Verificar si el valor de A(r) es positivo.\"\n        },\n        {\n          \"feedback\": \"Un máximo también tiene derivada cero. Eso solo confirma que es un punto plano.\",\n          \"isCorrect\": false,\n          \"text\": \"Porque la derivada es cero.\"\n        },\n        {\n          \"feedback\": \"En problemas de ingeniería, la intuición suele fallar. Necesitamos una prueba analítica rigurosa.\",\n          \"isCorrect\": false,\n          \"text\": \"Es obvio porque es un problema de costos.\"\n        }\n      ],\n      \"question\": \"¿Cómo confirmamos que es un mínimo?\"\n    },\n    {\n      \"context\": \"Ok, $A''(r)$ es positiva, así que es un mínimo. El radio óptimo es 5.42m, lo que nos da una altura de unos 10.8 metros. Todo perfecto... hasta que vi los planos de la fábrica. El techo está a solo 10 metros de altura. Nuestro óptimo matemático no cabe.\",\n      \"options\": [\n        {\n          \"feedback\": \"Correcto. Si el punto crítico está fuera del dominio factible [0, 10], el extremo debe estar en el borde más cercano.\",\n          \"isCorrect\": true,\n          \"text\": \"Evaluar el costo en el borde del dominio (h=10).\"\n        },\n        {\n          \"feedback\": \"No podemos. La fábrica ya está construida. La restricción física es inamovible.\",\n          \"isCorrect\": false,\n          \"text\": \"Pedir al cliente que suba el techo.\"\n        },\n        {\n          \"feedback\": \"Ignorar la restricción resultaría en un tanque que no se puede instalar. La ingeniería requiere pragmatismo.\",\n          \"isCorrect\": false,\n          \"text\": \"Usar 10.8m y esperar que quepa.\"\n        },\n        {\n          \"feedback\": \"Esto cambia el problema completamente. Solo necesitamos ajustar nuestra solución actual a los límites.\",\n          \"isCorrect\": false,\n          \"text\": \"Cambiar a un tanque rectangular.\"\n        }\n      ],\n      \"question\": \"¿Qué hacemos con este óptimo imposible?\"\n    },\n    {\n      \"context\": \"Lógico. Si la función baja hasta h=10.8 y luego sube, entonces en el intervalo permitido, el valor más bajo debe estar justo en el límite, h=10. Iba a enviar esa especificación, pero {{NAME}}, acaba de llegar un correo. El material de las PAREDES laterales ha subido de precio. Cuesta el TRIPLE que el material de la base.\",\n      \"options\": [\n        {\n          \"feedback\": \"Exacto. Ya no minimizamos área simple. Minimizamos Costo = (PrecioBase × AreaBase) + (3 × PrecioBase × AreaLateral).\",\n          \"isCorrect\": true,\n          \"text\": \"Debemos cambiar la función objetivo con pesos.\"\n        },\n        {\n          \"feedback\": \"El volumen sigue fijo en 1000. La restricción física no cambió, cambió la económica.\",\n          \"isCorrect\": false,\n          \"text\": \"Debemos cambiar la restricción de volumen.\"\n        },\n        {\n          \"feedback\": \"El costo ya no es uniforme. Minimizar área total ya no garantiza minimizar el dinero gastado.\",\n          \"isCorrect\": false,\n          \"text\": \"El óptimo anterior sigue siendo válido.\"\n        },\n        {\n          \"feedback\": \"Los multiplicadores de Lagrange sirven para restricciones, pero aquí lo más directo es redefinir la función de costo primero.\",\n          \"isCorrect\": false,\n          \"text\": \"Usar Lagrange para ignorar el costo.\"\n        }\n      ],\n      \"question\": \"¿Cómo afecta esto a nuestro modelo?\"\n    },\n    {\n      \"context\": \"Recalculando... Nueva función de costo: $C(r) = k(\\\\pi r^2) + 3k(2\\\\pi rh)$. Las paredes son carísimas. Intuitivamente, antes de hacer la derivada, ¿cómo crees que cambiará la forma del tanque para ahorrar dinero?\",\n      \"options\": [\n        {\n          \"feedback\": \"¡Bien visto! Si las paredes laterales son caras (área $2\\\\pi rh$), queremos reducir la altura $h$ y hacer el tanque más ancho y bajo.\",\n          \"isCorrect\": true,\n          \"text\": \"Será más ancho y bajo (menor h, mayor r).\"\n        },\n        {\n          \"feedback\": \"Si hacemos el tanque más alto, aumentamos el área de las paredes laterales, que es justamente lo que es caro ahora.\",\n          \"isCorrect\": false,\n          \"text\": \"Será más estrecho y alto (mayor h, menor r).\"\n        },\n        {\n          \"feedback\": \"Los costos relativos cambian el punto de equilibrio. No se mantendrá igual.\",\n          \"isCorrect\": false,\n          \"text\": \"La forma óptima no cambiará.\"\n        },\n        {\n          \"feedback\": \"No necesariamente. Un cubo optimiza área para prismas rectangulares, pero aquí tenemos cilindros y costos desiguales.\",\n          \"isCorrect\": false,\n          \"text\": \"Se convertirá en un cubo perfecto.\"\n        }\n      ],\n      \"question\": \"¿Qué nos dice la intuición ingenieril?\"\n    },\n    {\n      \"context\": \"¡Tenías razón! Al minimizar la nueva función de costo, el radio óptimo aumenta significativamente para reducir la costosa pared lateral. ¿Y sabes qué es lo irónico? La nueva altura óptima calculada es de 6.5 metros.\",\n      \"options\": [\n        {\n          \"feedback\": \"Exacto. La presión económica (costo de paredes) forzó una solución que naturalmente cumple la restricción física (<10m).\",\n          \"isCorrect\": true,\n          \"text\": \"¡El problema del techo se solucionó solo!\"\n        },\n        {\n          \"feedback\": \"Al contrario, 6.5m es mucho menor que el límite de 10m. Cabe perfectamente.\",\n          \"isCorrect\": false,\n          \"text\": \"Todavía chocamos con el techo de 10m.\"\n        },\n        {\n          \"feedback\": \"No necesitamos forzar nada. El óptimo global matemático ahora cae DENTRO de nuestro dominio factible.\",\n          \"isCorrect\": false,\n          \"text\": \"Debemos forzar h=10 de nuevo.\"\n        },\n        {\n          \"feedback\": \"¡No! 6.5m es la altura óptima para el costo. Si lo hacemos más bajo o más alto, gastaremos más dinero.\",\n          \"isCorrect\": false,\n          \"text\": \"Deberíamos hacerlo aún más bajo por si acaso.\"\n        }\n      ],\n      \"question\": \"¿Qué significa este resultado de 6.5m?\"\n    },\n    {\n      \"context\": \"Increíble. Al modelar correctamente los costos, no solo ahorramos dinero al cliente, sino que evitamos el problema de instalación en la fábrica. Enviaré los planos con $h=6.5m$. {{NAME}}, gran trabajo aplicando los fundamentos.\",\n      \"options\": [\n        {\n          \"feedback\": \"¡Misión cumplida! Hemos usado derivadas, pruebas de extremos y modelado con restricciones para resolver un problema real.\",\n          \"isCorrect\": true,\n          \"text\": \"¡Buen trabajo! A por el siguiente proyecto.\"\n        },\n        {\n          \"feedback\": \"El cálculo fue esencial. Sin él, habríamos adivinado y probablemente gastado más o chocado con el techo.\",\n          \"isCorrect\": false,\n          \"text\": \"Fue suerte, no cálculo.\"\n        },\n        {\n          \"feedback\": \"Ya verificamos con la segunda derivada que es un mínimo. No hace falta dudar ahora.\",\n          \"isCorrect\": false,\n          \"text\": \"¿Y si revisamos la tercera derivada?\"\n        },\n        {\n          \"feedback\": \"Hemos terminado. El problema está resuelto y cumple todas las restricciones.\",\n          \"isCorrect\": false,\n          \"text\": \"Deberíamos empezar de cero con un cubo.\"\n        }\n      ],\n      \"question\": \"Terminamos por hoy.\"\n    }\n  ]\n}",
      "outputTokens": 6086,
      "systemPrompt": "# Role\n\nYou are an expert interactive story designer creating a **Story** activity for a learning app. Your mission is to place learners in a first-person dialogue scenario where they work alongside a colleague to solve a real-world problem using the lesson's concepts.\n\nYou specialize in crafting immersive, dialogue-driven experiences that make learners feel like they're actually solving problems in their field — not just answering quiz questions.\n\n# The Art of Dialogue-Driven Learning\n\nA great Story activity doesn't lecture or test recall — it puts learners IN the situation. Think of it like an interactive movie where the learner IS the main character, making real decisions that matter.\n\n## Why Dialogue Scenarios Work\n\n1. **Authentic Context**: When learners apply concepts to solve realistic problems with a colleague, they see WHY the knowledge matters to them personally.\n\n2. **Active Reasoning**: Making decisions in context requires thinking through principles, not just recognizing memorized facts.\n\n3. **Emotional Investment**: Dialogue creates stakes. The learner cares about the outcome because they're part of the story.\n\n## The Collaborative Problem-Solving Principle\n\nEvery great Story activity creates a sense of partnership:\n\n- **Shared Goal**: You and your colleague are tackling something together\n- **Natural Dialogue**: Conversations feel like real workplace exchanges\n- **Meaningful Choices**: Each decision requires applying what you've learned\n- **Satisfying Resolution**: The problem gets solved and the takeaway sticks\n\n## Why Pure Dialogue Works\n\nEach scene should feel like you're eavesdropping on a real conversation — no narrator, no stage directions, just two people working through a problem. Pure dialogue:\n\n- Immerses learners completely in the scenario\n- Makes abstract concepts feel like lived experience\n- Creates natural pacing through back-and-forth exchange\n- Lets context emerge organically from what people say\n\n# Inputs\n\n- `LESSON_TITLE`: The topic to create a story around\n- `LESSON_DESCRIPTION`: Additional context about what this lesson covers\n- `CHAPTER_TITLE`: The chapter context (for understanding scope)\n- `COURSE_TITLE`: The course context (for understanding audience level)\n- `LANGUAGE`: Output language\n- `EXPLANATION_STEPS`: Array of {title, text} from all explanation activities (Background, Explanation, Mechanics, Examples) the learner completed before this one\n\n## Language Guidelines\n\n- `en`: Use US English unless the content is region-specific\n- `pt`: Use Brazilian Portuguese unless the content is region-specific\n- `es`: Use Latin American Spanish unless the content is region-specific\n\n# Requirements\n\n## Scene Structure\n\nEach scene must have:\n\n- **context**: Maximum 500 characters. Pure dialogue only — no narrator, no character name prefixes (like \"Sarah:\"), no descriptions. This is what your colleague says to you, setting up the decision point.\n- **question**: Maximum 100 characters. A short, clear question about what to do next.\n- **options**: Exactly 4 choices, each with:\n  - **text**: The answer choice (max 50 characters)\n  - **isCorrect**: Boolean indicating if this is the correct answer (exactly 1 must be true)\n  - **feedback**: Why this choice is right (with insight) or wrong (and what would be correct) — max 300 characters\n\n## Story Arc\n\nYour story must follow this structure:\n\n1. **Opening Scene**: Begin \"in the middle of the action\" — the learner and colleague are already working on something. No preamble or setup exposition.\n2. **Rising Complexity**: Each scene builds naturally from the previous dialogue. Decisions compound.\n3. **Plot Twist**: The second-to-last scene introduces an unexpected complication, surprise, or revelation.\n4. **Resolution**: The final scene resolves the problem AND reinforces the main learning takeaway.\n\n## Scene Count\n\n- Minimum: 7 scenes\n- Maximum: 20 scenes\n- Let the problem's complexity dictate the length. A simple concept might need 7-10 scenes; a complex one might need 15-20.\n\n## Tone & Style\n\n- **Pure dialogue**: NO narrator, NO character name prefixes, NO descriptions of actions or settings\n- **Natural conversation**: Write how colleagues actually talk on Slack when solving a problem together — casual, collaborative, sometimes humorous\n- **Professional but warm**: Light, smart humor when appropriate. Never forced or cheesy.\n- **Second-person immersion**: The colleague speaks TO the learner. Context emerges from what's said.\n- **Continuous flow**: Each scene's dialogue should naturally lead into the next\n\n## The {{NAME}} Placeholder\n\nUse `{{NAME}}` wherever the learner's name should appear in dialogue. For example:\n\n- \"{{NAME}}, I think we might have a problem here.\"\n- \"Good catch, {{NAME}}. That's exactly what I was thinking.\"\n\nThis personalizes the experience without requiring actual name input at content creation time.\n\n## Decision Design\n\nEvery decision must:\n\n- **Require reasoning**: Learners must apply principles from the lesson, not recall specific phrases\n- **Feel realistic**: These are choices someone might actually face in this situation\n- **Have plausible distractors**: Wrong options should be tempting but flawed for specific reasons\n- **Avoid \"obvious\" correct answers**: The right choice should require thought, not be the only non-silly option\n\n## What to Avoid\n\n- Narrator text (\"Meanwhile...\" or \"You walk into the office...\")\n- Character name prefixes (\"Sarah:\" or \"Your colleague says:\")\n- Description of actions or settings (except through dialogue itself)\n- Questions that test memorization of facts from earlier activities\n- Obvious \"correct\" answers that don't require applying the concept\n- Silly or clearly wrong distractors that no reasonable person would choose\n- Breaking the fourth wall or meta-commentary\n- Starting with \"In this activity...\" or setup exposition\n\n## Scope\n\n- **Stay focused**: The problem should specifically require THIS lesson's concept to solve\n- **Don't expand**: Other lessons cover related topics — this story tests this lesson\n- **Don't narrow**: If the lesson is broad, the problem should engage multiple aspects of it\n\n## Relationship to Previous Activities\n\nThe learner has already completed:\n\n- **Background**: WHY this exists (origin story, problems solved, historical context)\n- **Explanation**: WHAT it is (core concepts, components, definitions)\n- **Mechanics**: HOW it works (processes in action, cause-effect chains)\n- **Examples**: WHERE it appears (real-world contexts, applications)\n\nYour Story activity answers WHEN DO I USE THIS? (applying concepts to solve realistic problems). These complement each other:\n\n- Background: \"WHY did we need this?\"\n- Explanation: \"WHAT exactly is it?\"\n- Mechanics: \"HOW does it actually work?\"\n- Examples: \"WHERE will I encounter this?\"\n- Story: \"WHEN do I apply this to solve real problems?\"\n\nThe learner knows what the concept IS, how it WORKS, and where they'll SEE it. Now they practice USING it in a realistic scenario.\n\n# Structure Guide\n\nWhile every story is unique, most follow this arc (adapt as needed):\n\n1. **The Hook**: Jump straight into the situation. Something needs to be figured out or decided.\n2. **Initial Assessment**: What's the situation? What do we know? First decisions.\n3. **Deepening Complexity**: The problem has layers. Apply the concept more deeply.\n4. **Complications**: Things aren't as simple as they seemed. Adapt your approach.\n5. **The Twist**: A surprise, revelation, or unexpected turn that requires rethinking.\n6. **The Resolution**: Solve the problem AND crystallize the key insight from the lesson.\n\nNote: Sometimes the final twist can have a humorous or unexpected resolution that still reinforces the learning. Something that makes the learner smile and think \"I didn't see that coming!\"\n\n# Dialogue Tone Examples\n\nThe following examples show the **tone and style** to aim for — not complete scenes, just the kind of dialogue that makes stories feel alive. Adapt freely to your topic.\n\n## Opening Hooks (Jump Into the Action)\n\n> \"{{NAME}}, I've been staring at this bug for an hour. The shopping cart total keeps showing yesterday's prices. The database is fine. Something's wrong with how we're storing them.\"\n\n> \"Okay, {{NAME}}, the client just called. Their entire inventory system crashed right before Black Friday. They're panicking. We need to figure this out fast.\"\n\n> \"{{NAME}}, you're not going to believe this. Remember that algorithm we deployed last week? It's been recommending the exact opposite of what users want. Sales are tanking.\"\n\n## Building Tension (Problems Get Deeper)\n\n> \"Wait. If this pattern is everywhere in the codebase... inventory counts, user roles, discount percentages... we might have a much bigger problem than I thought.\"\n\n> \"Hold on. The logs show someone accessed the admin panel at 3 AM last night. But nobody on the team was working then. {{NAME}}, who else has those credentials?\"\n\n> \"The numbers don't add up. We're showing 500 successful transactions, but the bank only received 487. Where did the other 13 go?\"\n\n## Plot Twists (The Unexpected Turn)\n\n> \"{{NAME}}... I just ran the analysis twice. The bug isn't in our code. It's been in the library we've trusted for three years. Every project using it has this vulnerability.\"\n\n> \"I found the source of the data leak. {{NAME}}, it's not a hacker. It's our own caching system. We've been accidentally exposing user data to anyone who knew where to look.\"\n\n> \"Plot twist: the 'broken' feature? It's working exactly as designed. The original spec was just... completely wrong. We've been solving the wrong problem this whole time.\"\n\n## Humorous Moments (Light Relief)\n\n> \"Well, {{NAME}}, the good news is we found the bug. The bad news? It's been there since 2019. The worse news? I wrote it. The even worse news? So did you. We pair-programmed this disaster together.\"\n\n> \"Congratulations, {{NAME}}. We just spent four hours debugging what turned out to be a typo. 'userID' vs 'userId'. Camel case strikes again.\"\n\n> \"{{NAME}}, remember when I said 'this should be a quick fix'? That was three coffees and one existential crisis ago.\"\n\n## Satisfying Resolutions (Problem Solved + Insight Crystallized)\n\n> \"There it is. The fix works. {{NAME}}, I don't think I'll ever forget this — always check if your data source can change while you're holding onto a copy of it.\"\n\n> \"We did it. The system's stable. You know what the real lesson here was? Sometimes the simplest explanation IS the right one. We kept looking for complex bugs when the answer was right in front of us.\"\n\n> \"That's it — problem solved, client happy, crisis averted. {{NAME}}, I think we just learned more about distributed systems in the last hour than in any textbook.\"\n\n## Unexpected/Funny Endings\n\n> \"So after all that debugging... it was a timezone issue. Every single time. I'm starting to think all bugs are secretly timezone issues in disguise.\"\n\n> \"{{NAME}}, the CEO just called to thank us. Apparently fixing that 'minor bug' saved them $2 million. I think we need to renegotiate our rates.\"\n\n> \"The system's fixed. Also, I may have accidentally discovered that our competitor's product has the exact same bug. Should we... tell them? Actually, don't answer that.\"\n\nRemember: These are just **tone examples**. Your story should be original, fit the lesson topic, and create its own memorable journey. Mix problem-solving tension with moments of humor or surprise. The best stories make learners think \"I didn't see that coming!\" while still teaching the concept.\n\n# Quality Checks\n\nBefore finalizing, verify:\n\n- [ ] Is the dialogue pure conversation with NO narrator, NO character prefixes, NO descriptions?\n- [ ] Does every scene flow naturally from the previous one (continuous story)?\n- [ ] Do all decisions require applying lesson concepts, not just recalling facts?\n- [ ] Is there a genuine plot twist in the second-to-last scene?\n- [ ] Does the resolution both solve the problem AND reinforce the main learning?\n- [ ] Is `{{NAME}}` used appropriately to personalize the dialogue?\n- [ ] Are all distractors plausible (not obviously silly)?\n- [ ] Does the story feel like a real workplace conversation, not a quiz in disguise?\n- [ ] Is the scope exactly the lesson topic — not broader or narrower?\n- [ ] Are all constraints met (context ≤500 chars, question ≤100 chars, options ≤50 chars each, feedback ≤300 chars each)?\n- [ ] Is the scene count between 7 and 20?\n\n# Output Format\n\nReturn an array of scenes, each with:\n\n- **context**: Pure dialogue from colleague (max 500 chars)\n- **question**: Decision prompt (max 100 chars)\n- **options**: Array of exactly 4 objects, each with:\n  - **text**: The answer choice (max 50 chars)\n  - **isCorrect**: Boolean (exactly 1 must be true, 3 must be false)\n  - **feedback**: Why right or wrong (max 300 chars)\n\nUse 7-20 scenes to tell a complete, engaging story. Let the problem's complexity dictate the length.\n",
      "testCaseId": "es-math-calculus-optimization-1",
      "userPrompt": "LESSON_TITLE: Optimizacion con Calculo\nLESSON_DESCRIPTION: Aplicando tecnicas de calculo para encontrar optimos en problemas de ingenieria y negocios\nCHAPTER_TITLE: Aplicaciones del Calculo\nCOURSE_TITLE: Calculo para Ingenieria\nLANGUAGE: es\nEXPLANATION_STEPS:\n1. Puntos Criticos: Los puntos criticos son donde la derivada es cero o no existe. Son CANDIDATOS a extremos — no todos los puntos criticos son maximos o minimos.\n2. Prueba de Segunda Derivada: La prueba de la segunda derivada determina el tipo: si f''(x) > 0 en un punto critico, es minimo local; si f''(x) < 0, es maximo local; si f''(x) = 0, la prueba no concluye.\n3. Extremos Globales: Los extremos globales pueden estar en puntos criticos O en los extremos del dominio. Siempre evalua tambien los bordes del intervalo.\n4. Multiplicadores de Lagrange: Optimizacion con restricciones usa multiplicadores de Lagrange. Maximizar f(x,y) sujeto a g(x,y)=0 requiere que los gradientes sean paralelos.\n5. Modelado del Problema: Modelar el problema correctamente es la mitad del trabajo. Define la funcion objetivo, identifica las restricciones, y expresa todo en terminos de las variables relevantes."
    }
  ],
  "taskId": "activity-story"
}
