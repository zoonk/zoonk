{
  "generatedAt": "2026-01-21T21:30:09.026Z",
  "modelId": "openai/gpt-5.2",
  "outputs": [
    {
      "duration": 34948.735832999984,
      "inputTokens": 2657,
      "output": "{\n  \"scenario\": \"You’re at a small café in Paris. You want to get a drink and something to eat, ask for the menu, handle one item being unavailable, and then pay at the end.\",\n  \"steps\": [\n    {\n      \"context\": \"Bonjour ! Vous prenez quelque chose ?\",\n      \"contextRomanization\": \"\",\n      \"contextTranslation\": \"Hello! Are you having something?\",\n      \"options\": [\n        {\n          \"feedback\": \"A table for two, please. - This is for asking to be seated; here the server is asking what you want to order.\",\n          \"isCorrect\": false,\n          \"text\": \"Une table pour deux, s’il vous plaît.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Yes, I’d like a coffee, please. - Perfect: you answer the question and place a simple, polite order.\",\n          \"isCorrect\": true,\n          \"text\": \"Oui, je voudrais un café, s’il vous plaît.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Where is the restroom? - Off-topic: they’re asking what you want to have, not about directions in the café.\",\n          \"isCorrect\": false,\n          \"text\": \"Où sont les toilettes ?\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"The check, please. - Too early: you haven’t ordered or consumed anything yet.\",\n          \"isCorrect\": false,\n          \"text\": \"L’addition, s’il vous plaît.\",\n          \"textRomanization\": \"\"\n        }\n      ]\n    },\n    {\n      \"context\": \"Très bien. Et vous voulez voir la carte ?\",\n      \"contextRomanization\": \"\",\n      \"contextTranslation\": \"Very good. And would you like to see the menu?\",\n      \"options\": [\n        {\n          \"feedback\": \"Yes, could I have the menu, please? - Great: this directly answers and politely asks for the menu.\",\n          \"isCorrect\": true,\n          \"text\": \"Oui, je peux avoir la carte, s’il vous plaît ?\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"No, I’m allergic to milk. - This is important information but it doesn’t answer the immediate question about the menu.\",\n          \"isCorrect\": false,\n          \"text\": \"Non, je suis allergique au lait.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"I’d like to pay by card. - That’s about paying later; right now you’re being offered the menu.\",\n          \"isCorrect\": false,\n          \"text\": \"Je voudrais payer par carte.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"What time do you open? - Off-topic; you’re already in the café ordering.\",\n          \"isCorrect\": false,\n          \"text\": \"Vous ouvrez à quelle heure ?\",\n          \"textRomanization\": \"\"\n        }\n      ]\n    },\n    {\n      \"context\": \"Voilà. Vous voulez boire quoi ?\",\n      \"contextRomanization\": \"\",\n      \"contextTranslation\": \"Here you go. What would you like to drink?\",\n      \"options\": [\n        {\n          \"feedback\": \"A tea, please. - Correct and natural: you order a drink clearly.\",\n          \"isCorrect\": true,\n          \"text\": \"Un thé, s’il vous plaît.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"A ham-and-butter sandwich, please. - That’s food, not a drink; it doesn’t answer ‘what to drink?’\",\n          \"isCorrect\": false,\n          \"text\": \"Un jambon-beurre, s’il vous plaît.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Can I have a glass of tap water? - Plausible in a café, but it dodges the drink order you’re making from the menu in this moment.\",\n          \"isCorrect\": false,\n          \"text\": \"Je peux avoir un verre d’eau du robinet ?\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"I don’t understand. - You could say this if needed, but here you’re practicing ordering a drink.\",\n          \"isCorrect\": false,\n          \"text\": \"Je ne comprends pas.\",\n          \"textRomanization\": \"\"\n        }\n      ]\n    },\n    {\n      \"context\": \"Parfait. Et pour manger, vous prenez quelque chose ?\",\n      \"contextRomanization\": \"\",\n      \"contextTranslation\": \"Perfect. And to eat, are you having something?\",\n      \"options\": [\n        {\n          \"feedback\": \"Yes, I’ll have a croissant, please. - Perfect: common café item and fits the question.\",\n          \"isCorrect\": true,\n          \"text\": \"Oui, je vais prendre un croissant, s’il vous plaît.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"A coffee, please. - You’re switching back to a drink; the server asked what you want to eat.\",\n          \"isCorrect\": false,\n          \"text\": \"Un café, s’il vous plaît.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"I’m just looking. - This is more for shopping; in a café it sounds odd when you’re already ordering.\",\n          \"isCorrect\": false,\n          \"text\": \"Je regarde seulement.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Where is the nearest metro station? - Off-topic; you’re ordering food.\",\n          \"isCorrect\": false,\n          \"text\": \"Où est la station de métro la plus proche ?\",\n          \"textRomanization\": \"\"\n        }\n      ]\n    },\n    {\n      \"context\": \"Désolé, il n’y a plus de croissants. Vous voulez autre chose ?\",\n      \"contextRomanization\": \"\",\n      \"contextTranslation\": \"Sorry, we’re out of croissants. Would you like something else?\",\n      \"options\": [\n        {\n          \"feedback\": \"No problem, I’ll take a pain au chocolat. - Great: you adapt naturally to what’s available.\",\n          \"isCorrect\": true,\n          \"text\": \"Pas de souci, je vais prendre un pain au chocolat.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Why is it closed? - Confusing: the café isn’t closed; they’re just out of croissants.\",\n          \"isCorrect\": false,\n          \"text\": \"Pourquoi c’est fermé ?\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"I reserved for 7 o’clock. - Unrelated; this is about a reservation, not replacing your pastry.\",\n          \"isCorrect\": false,\n          \"text\": \"J’ai réservé pour 19 heures.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Bring me two beers. - Abrupt and changes the order completely; also mismatched tone for this situation.\",\n          \"isCorrect\": false,\n          \"text\": \"Apportez-moi deux bières.\",\n          \"textRomanization\": \"\"\n        }\n      ]\n    },\n    {\n      \"context\": \"Très bien. Vous consommez sur place ou à emporter ?\",\n      \"contextRomanization\": \"\",\n      \"contextTranslation\": \"Very good. Are you having it here or to go?\",\n      \"options\": [\n        {\n          \"feedback\": \"Here, please. - Correct: ‘sur place’ means you’re staying to consume it there.\",\n          \"isCorrect\": true,\n          \"text\": \"Sur place, s’il vous plaît.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"I’m in a hurry. - This doesn’t answer clearly whether it’s for here or to go.\",\n          \"isCorrect\": false,\n          \"text\": \"Je suis pressé(e).\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"I’d like a window seat. - Seating preference, not the ‘here or to go’ choice.\",\n          \"isCorrect\": false,\n          \"text\": \"Je voudrais une place près de la fenêtre.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"How much is it? - Price can come later; first you need to specify here or to go.\",\n          \"isCorrect\": false,\n          \"text\": \"C’est combien ?\",\n          \"textRomanization\": \"\"\n        }\n      ]\n    },\n    {\n      \"context\": \"D’accord. Je vous apporte ça tout de suite. Autre chose ?\",\n      \"contextRomanization\": \"\",\n      \"contextTranslation\": \"Alright. I’ll bring that right away. Anything else?\",\n      \"options\": [\n        {\n          \"feedback\": \"No thanks, that’s all. - Perfect: you close the order politely.\",\n          \"isCorrect\": true,\n          \"text\": \"Non merci, c’est tout.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"The menu, please. - You already have the menu and have ordered; this would confuse the flow.\",\n          \"isCorrect\": false,\n          \"text\": \"La carte, s’il vous plaît.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Where is the pharmacy? - Off-topic and would interrupt the ordering process.\",\n          \"isCorrect\": false,\n          \"text\": \"Où est la pharmacie ?\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"I need a towel. - That’s a hotel request, not a café request.\",\n          \"isCorrect\": false,\n          \"text\": \"J’ai besoin d’une serviette.\",\n          \"textRomanization\": \"\"\n        }\n      ]\n    },\n    {\n      \"context\": \"Voilà : un thé et un pain au chocolat. Ça a l’air bon ?\",\n      \"contextRomanization\": \"\",\n      \"contextTranslation\": \"Here you go: a tea and a pain au chocolat. Does it look good?\",\n      \"options\": [\n        {\n          \"feedback\": \"Yes, thank you very much. - Natural and polite acknowledgment of receiving your order.\",\n          \"isCorrect\": true,\n          \"text\": \"Oui, merci beaucoup.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"No, I didn’t order that. - This would signal a mistake, but in the story it matches your order, so it’s inappropriate.\",\n          \"isCorrect\": false,\n          \"text\": \"Non, je n’ai pas commandé ça.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Bring me the check right now. - You just got your food; asking immediately is unnatural here.\",\n          \"isCorrect\": false,\n          \"text\": \"Apportez-moi l’addition tout de suite.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"I want a train ticket. - Completely unrelated to the café situation.\",\n          \"isCorrect\": false,\n          \"text\": \"Je voudrais un billet de train.\",\n          \"textRomanization\": \"\"\n        }\n      ]\n    },\n    {\n      \"context\": \"Quand vous voulez, je peux vous apporter l’addition.\",\n      \"contextRomanization\": \"\",\n      \"contextTranslation\": \"Whenever you like, I can bring you the check.\",\n      \"options\": [\n        {\n          \"feedback\": \"Yes, the check please. - Correct: you accept and request the bill politely.\",\n          \"isCorrect\": true,\n          \"text\": \"Oui, l’addition, s’il vous plaît.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"I’d like to order. - Wrong timing: you already ordered and received your items.\",\n          \"isCorrect\": false,\n          \"text\": \"Je voudrais commander.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Can you show me the way? - Off-topic; the server offered the check.\",\n          \"isCorrect\": false,\n          \"text\": \"Vous pouvez me montrer le chemin ?\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"I don’t have a reservation. - Unrelated; this isn’t about booking a table.\",\n          \"isCorrect\": false,\n          \"text\": \"Je n’ai pas de réservation.\",\n          \"textRomanization\": \"\"\n        }\n      ]\n    },\n    {\n      \"context\": \"Bien sûr. Vous payez comment : en espèces ou par carte ?\",\n      \"contextRomanization\": \"\",\n      \"contextTranslation\": \"Of course. How are you paying: cash or card?\",\n      \"options\": [\n        {\n          \"feedback\": \"By card, please. - Perfect: directly answers the payment-method question.\",\n          \"isCorrect\": true,\n          \"text\": \"Par carte, s’il vous plaît.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"I’ll take it to go. - That was the earlier question; now you’re paying.\",\n          \"isCorrect\": false,\n          \"text\": \"À emporter, s’il vous plaît.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"I don’t want anything. - Too late and confusing since you already consumed/received items.\",\n          \"isCorrect\": false,\n          \"text\": \"Je ne veux rien.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"It’s on the house. - You can’t declare it free; that would be inappropriate.\",\n          \"isCorrect\": false,\n          \"text\": \"C’est offert.\",\n          \"textRomanization\": \"\"\n        }\n      ]\n    }\n  ]\n}",
      "outputTokens": 2211,
      "systemPrompt": "# Role\n\nYou are an expert language immersion designer specializing in creating realistic, dialogue-driven scenarios that help learners practice language production in authentic contexts. You design experiences that simulate situations learners would encounter when living or traveling in a country where the target language is spoken.\n\n# Goal\n\nCreate an immersive story activity where learners are placed in an everyday situation and must choose appropriate phrases to communicate. The activity simulates real conversations with native speakers, forcing learners to engage with the target language directly rather than relying on translations.\n\nThe activity places learners in a specific scenario (ordering food, asking for directions, checking into a hotel) and guides them through a dialogue where they must select appropriate responses at each step.\n\n# Key Design Principles\n\n## Immersion Over Translation\n\nUnlike other activities where translations help comprehension, this activity intentionally withholds translations from the options. Learners see:\n\n- **Context**: What the native speaker says (in TARGET language with translation)\n- **Options**: Four possible responses (in TARGET language ONLY - no translations)\n\nThis forces learners to:\n\n1. Engage with the target language sounds and patterns\n2. Use context clues to infer meaning\n3. Build recognition before relying on translations\n4. Experience the \"productive uncertainty\" of real conversations\n\nThe translation appears only in the feedback AFTER selection, revealing whether they understood correctly.\n\n## Authentic Scenarios\n\nFocus on situations learners will actually encounter:\n\n| Category       | Example Scenarios                                  |\n| -------------- | -------------------------------------------------- |\n| Food & Dining  | Ordering at a restaurant, asking about ingredients |\n| Transportation | Buying train tickets, asking for directions        |\n| Shopping       | Bargaining at a market, returning an item          |\n| Accommodation  | Checking into a hotel, reporting a problem         |\n| Healthcare     | Describing symptoms at a pharmacy, doctor's visit  |\n| Social         | Meeting neighbors, small talk at a cafe            |\n| Services       | Opening a bank account, getting a phone plan       |\n| Emergencies    | Reporting lost items, asking for help              |\n\n## Supportive Native Speaker\n\nThe character in the story is a friendly native speaker who:\n\n- Speaks naturally but not too fast\n- Helps the learner when they struggle\n- Provides context clues in their responses\n- Never mocks mistakes\n- Gradually introduces more complex language\n\n# Language Handling\n\n## Input Variables\n\n- **TARGET_LANGUAGE**: The language being learned (from `courseTitle`). All dialogue and options are in this language.\n- **NATIVE_LANGUAGE**: The learner's native language (from `language` code). Questions, feedback, and context translations use this language.\n\n## Language Codes\n\n- `en`: US English\n- `pt`: Brazilian Portuguese\n- `es`: Latin American Spanish\n\n## What Appears in Each Language\n\n| Field                        | Language     | Example (Spanish course, English native)                  |\n| ---------------------------- | ------------ | --------------------------------------------------------- |\n| `scenario`                   | NATIVE       | \"You're at a cafe in Madrid and want to order coffee.\"    |\n| `context`                    | TARGET       | \"Buenos dias, que le pongo?\"                              |\n| `contextTranslation`         | NATIVE       | \"Good morning, what can I get you?\"                       |\n| `contextRomanization`        | Romanization | \"\" (empty for Roman scripts)                              |\n| `options[].text`             | TARGET       | \"Un cafe con leche, por favor.\"                           |\n| `options[].textRomanization` | Romanization | \"\" (empty for Roman scripts)                              |\n| `options[].feedback`         | NATIVE       | \"A coffee with milk, please - Perfect! Polite and clear.\" |\n\n# Options Design\n\n## No Translations in Options\n\nThis is the most critical design decision. Options show ONLY:\n\n- `text`: The phrase in TARGET language\n- `textRomanization`: Romanization for non-Roman scripts (empty string for Roman scripts)\n\n**NO translation is shown**. This forces the learner to:\n\n1. Parse the target language directly\n2. Use patterns they've learned\n3. Make educated guesses based on context\n4. Experience the productive struggle of real communication\n\n## Option Quality\n\nAll 4 options must be:\n\n- **Grammatically correct** in the target language\n- **Contextually plausible** (something a learner might say in this situation)\n- **Distinct in meaning** (not just word variations)\n- **Level-appropriate** (using vocabulary/structures the learner knows)\n\n## Distractor Design\n\n**CRITICAL**: Wrong options must be genuinely inappropriate for the situation - they should lead to miscommunication or confusion if used. Do NOT create distractors that are merely \"less polished\" versions of the correct answer.\n\nWrong options should be **clearly wrong** because they:\n\n1. **Answer a different question**: Respond to something the speaker didn't ask (asking about price when asked about quantity)\n2. **Request the wrong thing**: Order/ask for something different than intended (one-way ticket when you need round-trip)\n3. **Are off-topic**: Say something unrelated to the current conversation point (asking for the check when you just arrived)\n4. **Would cause confusion**: Use words that change the meaning entirely (saying \"no\" when you mean \"yes\")\n\n**DO NOT** create distractors that are:\n\n- Just more/less formal versions of the correct answer\n- Slightly different phrasings that would still work\n- Grammatically awkward but still understandable\n\n# Feedback Design\n\nFeedback appears AFTER the learner selects an option. Every feedback message MUST include:\n\n1. **Translation**: What the option actually means in the native language\n2. **Explanation**: Why this choice is correct or incorrect for the situation\n\n## Feedback Structure\n\nFor **correct** options:\n\n```\n\"[Translation of what they said] - [Why this works in context]\"\n```\n\nExample: \"A coffee with milk, please - Perfect! This is polite and clearly communicates what you want.\"\n\nFor **incorrect** options:\n\n```\n\"[Translation of what they said] - [Why this doesn't work and what would be better]\"\n```\n\nExample: \"Where is the bathroom? - You're trying to order coffee, not find the restroom. Tell the barista what you'd like to drink.\"\n\n# Romanization Requirements\n\nFor languages using non-Roman writing systems (Japanese, Chinese, Korean, Arabic, Russian, Greek, Hebrew, Thai, Hindi, etc.), provide romanization for both context and options.\n\n## Standard Systems\n\n- **Japanese**: Romaji using Hepburn romanization\n- **Chinese**: Pinyin with tone marks\n- **Korean**: Revised Romanization of Korean\n- **Russian**: ISO 9 or BGN/PCGN transliteration\n- **Arabic**: Standard romanization\n- **Greek**: Standard transliteration\n- **Thai**: Royal Thai General System\n- **Hindi**: IAST or Hunterian transliteration\n\n## Roman Scripts\n\nFor languages using Roman letters (Spanish, French, German, Portuguese, Italian, etc.), set both `contextRomanization` and `textRomanization` to empty strings `\"\"`.\n\n# Story Arc\n\nEach story should have 5-10 steps following a natural arc:\n\n## Step Progression\n\n1. **Opening** (1-2 steps): Arrive at the location, initial greeting\n2. **Building** (2-4 steps): Main interaction, making requests, clarifying\n3. **Complication** (0-2 steps): Optional challenge that adds realism\n4. **Resolution** (1-2 steps): Complete the transaction\n5. **Closing** (1 step): Thank and goodbye\n\n## Complication Ideas (Recommended)\n\nAdding a complication makes the story more realistic and teaches learners to handle unexpected situations:\n\n- **Item unavailable**: \"Sorry, we're out of that. Would you like something else?\"\n- **Misunderstanding**: \"Did you say two or twelve?\"\n- **Additional requirement**: \"I'll need to see your ID for that.\"\n- **Clarification needed**: \"Which size did you want?\"\n\n## Pacing Guidelines\n\n- Steps should feel like natural conversation beats\n- Each step presents ONE decision point\n- Context should flow naturally from the previous step\n- The native speaker's response should acknowledge what the learner said\n\n# Output Format\n\nReturn an object with this structure (abbreviated examples shown):\n\n**Non-Roman script example (Japanese):**\n\n```json\n{\n  \"scenario\": \"You're at a train station in Tokyo...\",\n  \"steps\": [\n    {\n      \"context\": \"いらっしゃいませ。どちらまで？\",\n      \"contextTranslation\": \"Welcome. Where to?\",\n      \"contextRomanization\": \"Irasshaimase. Dochira made?\",\n      \"options\": [\n        {\n          \"text\": \"京都までお願いします。\",\n          \"textRomanization\": \"Kyouto made onegaishimasu.\",\n          \"isCorrect\": true,\n          \"feedback\": \"To Kyoto, please - Perfect!\"\n        },\n        {\n          \"text\": \"京都は遠いですか？\",\n          \"textRomanization\": \"Kyouto wa tooi desu ka?\",\n          \"isCorrect\": false,\n          \"feedback\": \"Is Kyoto far? - This asks about distance, not for a ticket.\"\n        }\n      ]\n    }\n  ]\n}\n```\n\n**Roman script example (Spanish) - empty romanization fields:**\n\n```json\n{\n  \"scenario\": \"You're at a restaurant in Barcelona...\",\n  \"steps\": [\n    {\n      \"context\": \"Buenas noches. Estan listos para pedir?\",\n      \"contextTranslation\": \"Good evening. Are you ready to order?\",\n      \"contextRomanization\": \"\",\n      \"options\": [\n        {\n          \"text\": \"Si, me gustaria la paella, por favor.\",\n          \"textRomanization\": \"\",\n          \"isCorrect\": true,\n          \"feedback\": \"Yes, I would like the paella, please - Perfect!\"\n        },\n        {\n          \"text\": \"La cuenta, por favor.\",\n          \"textRomanization\": \"\",\n          \"isCorrect\": false,\n          \"feedback\": \"The check, please - You haven't eaten yet!\"\n        }\n      ]\n    }\n  ]\n}\n```\n\nNote: Examples above are abbreviated. Actual output must have 4 options per step and 5-10 steps total.\n\n# Quality Checklist\n\nBefore finalizing, verify:\n\n1. **Grammar accuracy**: All target language text is grammatically correct\n2. **Natural dialogue**: Conversations flow like real interactions\n3. **Appropriate register**: Formality matches the situation (casual cafe vs formal office)\n4. **Cultural accuracy**: Interactions reflect how things work in that culture\n5. **Clear progression**: Steps follow a logical narrative arc\n6. **Distinct options**: Each option represents a meaningfully different choice\n7. **Helpful feedback**: Translations and explanations clarify meaning and context\n8. **Correct romanization**: Follows standard systems for non-Roman scripts, empty for Roman scripts\n9. **Scenario relevance**: The story matches the lesson topic\n10. **Appropriate difficulty**: Language complexity matches learner level\n\n# Common Mistakes to Avoid\n\n1. **Including translations in options**: Options must show TARGET language only\n2. **Trivial distractors**: Options that are obviously wrong or nonsensical\n3. **Inconsistent register**: Mixing formal and informal inappropriately\n4. **Unnatural responses**: Things a native speaker would never actually say\n5. **Missing romanization**: Forgetting to add romanization for non-Roman scripts\n6. **Adding romanization to Roman scripts**: Spanish, French, etc. should have empty strings\n7. **Feedback without translation**: Always include what the option means\n8. **Disconnected steps**: Each step should follow logically from the previous one\n",
      "testCaseId": "en-french-cafe-ordering-1",
      "userPrompt": "TARGET_LANGUAGE: French\nNATIVE_LANGUAGE: en\nCHAPTER_TITLE: At the Cafe\nLESSON_TITLE: Ordering at a Cafe\nLESSON_DESCRIPTION: Practice ordering drinks and food at a French cafe, including asking for the menu and paying\n\nGenerate an immersive dialogue-driven story activity for this language lesson. Create a realistic everyday scenario where learners practice language production in situations they'd face in a foreign country."
    },
    {
      "duration": 48981.82908300002,
      "inputTokens": 2654,
      "output": "{\n  \"scenario\": \"You’ve arrived at a hotel in Tokyo to check in. You need to confirm your reservation, handle a small issue, and ask about room amenities like Wi‑Fi and breakfast.\",\n  \"steps\": [\n    {\n      \"context\": \"いらっしゃいませ。ご予約はございますか。\",\n      \"contextRomanization\": \"Irasshaimase. Goyoyaku wa gozaimasu ka?\",\n      \"contextTranslation\": \"Welcome. Do you have a reservation?\",\n      \"options\": [\n        {\n          \"feedback\": \"Yes, I have a reservation. - Perfect. This directly answers the staff’s question and is a standard, polite check-in response.\",\n          \"isCorrect\": true,\n          \"text\": \"はい、予約しています。\",\n          \"textRomanization\": \"Hai, yoyaku shite imasu.\"\n        },\n        {\n          \"feedback\": \"I don’t have cash. - This is about payment and money, not whether you have a reservation. First, confirm your reservation.\",\n          \"isCorrect\": false,\n          \"text\": \"現金がありません。\",\n          \"textRomanization\": \"Genkin ga arimasen.\"\n        },\n        {\n          \"feedback\": \"Please tell me the way to the station. - This asks for directions and ignores the reservation question. Confirm your booking first.\",\n          \"isCorrect\": false,\n          \"text\": \"駅までの行き方を教えてください。\",\n          \"textRomanization\": \"Eki made no ikikata o oshiete kudasai.\"\n        },\n        {\n          \"feedback\": \"I’m going out now. - This doesn’t answer the question and would confuse the check-in flow.\",\n          \"isCorrect\": false,\n          \"text\": \"今から出かけます。\",\n          \"textRomanization\": \"Ima kara dekakemasu.\"\n        }\n      ]\n    },\n    {\n      \"context\": \"ありがとうございます。お名前をいただけますか。\",\n      \"contextRomanization\": \"Arigatou gozaimasu. Onamae o itadakemasu ka?\",\n      \"contextTranslation\": \"Thank you. May I have your name?\",\n      \"options\": [\n        {\n          \"feedback\": \"My name is Smith. - Correct and natural for giving your name at check-in.\",\n          \"isCorrect\": true,\n          \"text\": \"スミスと申します。\",\n          \"textRomanization\": \"Sumisu to moushimasu.\"\n        },\n        {\n          \"feedback\": \"I’m two people. - This talks about the number of guests, not your name. The staff asked for your name.\",\n          \"isCorrect\": false,\n          \"text\": \"二人です。\",\n          \"textRomanization\": \"Futari desu.\"\n        },\n        {\n          \"feedback\": \"It’s on the second floor. - This refers to location/floor and doesn’t answer the question about your name.\",\n          \"isCorrect\": false,\n          \"text\": \"二階です。\",\n          \"textRomanization\": \"Nikai desu.\"\n        },\n        {\n          \"feedback\": \"It’s 7 o’clock. - This gives the time, not your name.\",\n          \"isCorrect\": false,\n          \"text\": \"七時です。\",\n          \"textRomanization\": \"Shichi-ji desu.\"\n        }\n      ]\n    },\n    {\n      \"context\": \"スミス様ですね。ご予約を確認いたします。…失礼ですが、チェックインは本日でよろしいでしょうか。\",\n      \"contextRomanization\": \"Sumisu-sama desu ne. Goyoyaku o kakunin itashimasu. ...Shitsurei desu ga, chekkuin wa honjitsu de yoroshii deshou ka?\",\n      \"contextTranslation\": \"Mr./Ms. Smith, yes. I’ll confirm your reservation… Excuse me, but is your check-in for today?\",\n      \"options\": [\n        {\n          \"feedback\": \"Yes, it’s for today. - Great. This confirms the date clearly and keeps the check-in moving.\",\n          \"isCorrect\": true,\n          \"text\": \"はい、本日でお願いします。\",\n          \"textRomanization\": \"Hai, honjitsu de onegaishimasu.\"\n        },\n        {\n          \"feedback\": \"No, I want to cancel. - This changes the situation to a cancellation instead of confirming today’s check-in.\",\n          \"isCorrect\": false,\n          \"text\": \"いいえ、キャンセルしたいです。\",\n          \"textRomanization\": \"Iie, kyanseru shitai desu.\"\n        },\n        {\n          \"feedback\": \"I’d like another hotel. - This doesn’t address the date and would confuse the staff.\",\n          \"isCorrect\": false,\n          \"text\": \"別のホテルがいいです。\",\n          \"textRomanization\": \"Betsu no hoteru ga ii desu.\"\n        },\n        {\n          \"feedback\": \"I don’t understand Japanese. - You could say this if you’re stuck, but it doesn’t answer whether check-in is today.\",\n          \"isCorrect\": false,\n          \"text\": \"日本語がわかりません。\",\n          \"textRomanization\": \"Nihongo ga wakarimasen.\"\n        }\n      ]\n    },\n    {\n      \"context\": \"ありがとうございます。ご宿泊は2泊で、禁煙のシングルで承っております。よろしいでしょうか。\",\n      \"contextRomanization\": \"Arigatou gozaimasu. Goshukuhaku wa ni-haku de, kin'en no shinguru de ukatamawatte orimasu. Yoroshii deshou ka?\",\n      \"contextTranslation\": \"Thank you. We have you for two nights in a non-smoking single. Is that okay?\",\n      \"options\": [\n        {\n          \"feedback\": \"Yes, that’s fine. - Correct. You confirm the reservation details as stated.\",\n          \"isCorrect\": true,\n          \"text\": \"はい、それで大丈夫です。\",\n          \"textRomanization\": \"Hai, sore de daijoubu desu.\"\n        },\n        {\n          \"feedback\": \"I’d like a smoking room. - This contradicts the non-smoking detail and changes the booking.\",\n          \"isCorrect\": false,\n          \"text\": \"喫煙の部屋がいいです。\",\n          \"textRomanization\": \"Kitsuen no heya ga ii desu.\"\n        },\n        {\n          \"feedback\": \"Make it one night. - This changes the length of stay rather than confirming the details.\",\n          \"isCorrect\": false,\n          \"text\": \"一泊にしてください。\",\n          \"textRomanization\": \"Ippaku ni shite kudasai.\"\n        },\n        {\n          \"feedback\": \"I want a double room. - This changes the room type instead of confirming the single.\",\n          \"isCorrect\": false,\n          \"text\": \"ダブルがいいです。\",\n          \"textRomanization\": \"Daburu ga ii desu.\"\n        }\n      ]\n    },\n    {\n      \"context\": \"恐れ入ります。パスポートを拝見できますか。\",\n      \"contextRomanization\": \"Osoreirimasu. Pasupooto o haiken dekimasu ka?\",\n      \"contextTranslation\": \"May I see your passport?\",\n      \"options\": [\n        {\n          \"feedback\": \"Yes, here you go. - Perfect. This is a natural phrase when handing over a document.\",\n          \"isCorrect\": true,\n          \"text\": \"はい、どうぞ。\",\n          \"textRomanization\": \"Hai, douzo.\"\n        },\n        {\n          \"feedback\": \"Where is the elevator? - This is about facilities, not the passport request.\",\n          \"isCorrect\": false,\n          \"text\": \"エレベーターはどこですか。\",\n          \"textRomanization\": \"Erebeetaa wa doko desu ka?\"\n        },\n        {\n          \"feedback\": \"I already ate breakfast. - This is unrelated to showing your passport.\",\n          \"isCorrect\": false,\n          \"text\": \"もう朝ごはんを食べました。\",\n          \"textRomanization\": \"Mou asagohan o tabemashita.\"\n        },\n        {\n          \"feedback\": \"Please clean my room. - Housekeeping is a different request and doesn’t respond to the passport request.\",\n          \"isCorrect\": false,\n          \"text\": \"部屋を掃除してください。\",\n          \"textRomanization\": \"Heya o souji shite kudasai.\"\n        }\n      ]\n    },\n    {\n      \"context\": \"ありがとうございます。少々お待ちください。…失礼しました。システム上、お名前のスペルが少し違うようです。『Smith』でよろしいですか。\",\n      \"contextRomanization\": \"Arigatou gozaimasu. Shoushou omachi kudasai. ...Shitsurei shimashita. Shisutemu-jou, onamae no superu ga sukoshi chigau you desu. 'Smith' de yoroshii desu ka?\",\n      \"contextTranslation\": \"Thank you. Please wait a moment… Sorry. In our system, the spelling of your name seems a bit different. Is it ‘Smith’?\",\n      \"options\": [\n        {\n          \"feedback\": \"Yes, that’s correct. - Correct. You confirm the spelling the staff proposed.\",\n          \"isCorrect\": true,\n          \"text\": \"はい、そのスペルで合っています。\",\n          \"textRomanization\": \"Hai, sono superu de atte imasu.\"\n        },\n        {\n          \"feedback\": \"No, it’s tomorrow. - This answers a different issue (date) and doesn’t address name spelling.\",\n          \"isCorrect\": false,\n          \"text\": \"いいえ、明日です。\",\n          \"textRomanization\": \"Iie, ashita desu.\"\n        },\n        {\n          \"feedback\": \"My room is noisy. - That’s a complaint about the room, but you haven’t even checked in yet and it doesn’t address spelling.\",\n          \"isCorrect\": false,\n          \"text\": \"部屋がうるさいです。\",\n          \"textRomanization\": \"Heya ga urusai desu.\"\n        },\n        {\n          \"feedback\": \"Please call a taxi. - This is a separate request and doesn’t solve the name spelling issue.\",\n          \"isCorrect\": false,\n          \"text\": \"タクシーを呼んでください。\",\n          \"textRomanization\": \"Takushii o yonde kudasai.\"\n        }\n      ]\n    },\n    {\n      \"context\": \"かしこまりました。では、ご朝食はいかがなさいますか。朝食付きプランもございます。\",\n      \"contextRomanization\": \"Kashikomarimashita. Dewa, gochoushoku wa ikaga nasaimasu ka. Choushoku-tsuki puran mo gozaimasu.\",\n      \"contextTranslation\": \"Certainly. Now, what would you like to do about breakfast? We also have a plan with breakfast included.\",\n      \"options\": [\n        {\n          \"feedback\": \"I’d like the plan with breakfast included. - Correct. You choose the breakfast-included option the staff mentioned.\",\n          \"isCorrect\": true,\n          \"text\": \"朝食付きでお願いします。\",\n          \"textRomanization\": \"Choushoku-tsuki de onegaishimasu.\"\n        },\n        {\n          \"feedback\": \"I don’t need a key. - This is unrelated; you’ll need a room key/card regardless.\",\n          \"isCorrect\": false,\n          \"text\": \"鍵はいりません。\",\n          \"textRomanization\": \"Kagi wa irimasen.\"\n        },\n        {\n          \"feedback\": \"I want dinner included. - The staff asked about breakfast, not dinner.\",\n          \"isCorrect\": false,\n          \"text\": \"夕食付きがいいです。\",\n          \"textRomanization\": \"Yuushoku-tsuki ga ii desu.\"\n        },\n        {\n          \"feedback\": \"The breakfast is on the first floor. - You’re stating a location you haven’t been told; it doesn’t answer whether you want breakfast.\",\n          \"isCorrect\": false,\n          \"text\": \"朝食は一階です。\",\n          \"textRomanization\": \"Choushoku wa ikkai desu.\"\n        }\n      ]\n    },\n    {\n      \"context\": \"承知しました。お部屋のWi‑Fiは無料です。パスワードはこちらです。ほかにご質問はございますか。\",\n      \"contextRomanization\": \"Shouchi shimashita. Oheya no Waifai wa muryou desu. Pasuwaado wa kochira desu. Hoka ni goshitsumon wa gozaimasu ka?\",\n      \"contextTranslation\": \"Understood. The room Wi‑Fi is free. Here is the password. Do you have any other questions?\",\n      \"options\": [\n        {\n          \"feedback\": \"What time is check-out? - Correct. This is a very natural additional question at check-in.\",\n          \"isCorrect\": true,\n          \"text\": \"チェックアウトは何時ですか。\",\n          \"textRomanization\": \"Chekkuauto wa nan-ji desu ka?\"\n        },\n        {\n          \"feedback\": \"I forgot my password. - The staff just gave you the Wi‑Fi password; saying you forgot it immediately doesn’t fit and doesn’t ask a useful question.\",\n          \"isCorrect\": false,\n          \"text\": \"パスワードを忘れました。\",\n          \"textRomanization\": \"Pasuwaado o wasuremashita.\"\n        },\n        {\n          \"feedback\": \"Please bring me a towel. - This is a service request you could make later, but it doesn’t fit as the most relevant check-in question here.\",\n          \"isCorrect\": false,\n          \"text\": \"タオルを持ってきてください。\",\n          \"textRomanization\": \"Taoru o motte kite kudasai.\"\n        },\n        {\n          \"feedback\": \"I don’t have Wi‑Fi. - The staff already said it’s free and gave the password; this response is unclear and doesn’t form a question.\",\n          \"isCorrect\": false,\n          \"text\": \"Wi‑Fiがありません。\",\n          \"textRomanization\": \"Waifai ga arimasen.\"\n        }\n      ]\n    },\n    {\n      \"context\": \"チェックアウトは午前11時でございます。こちらがルームキーです。エレベーターは右手にございます。\",\n      \"contextRomanization\": \"Chekkuauto wa gozen juuichi-ji de gozaimasu. Kochira ga ruumu kii desu. Erebeetaa wa migite ni gozaimasu.\",\n      \"contextTranslation\": \"Check-out is at 11 a.m. Here is your room key. The elevator is to your right.\",\n      \"options\": [\n        {\n          \"feedback\": \"Thank you. - Perfect closing: polite and natural after receiving the key and information.\",\n          \"isCorrect\": true,\n          \"text\": \"ありがとうございます。\",\n          \"textRomanization\": \"Arigatou gozaimasu.\"\n        },\n        {\n          \"feedback\": \"I’ll pay next month. - Payment timing isn’t being discussed here; this would create confusion.\",\n          \"isCorrect\": false,\n          \"text\": \"来月払います。\",\n          \"textRomanization\": \"Raigetsu haraimasu.\"\n        },\n        {\n          \"feedback\": \"I’m going to the airport. - This doesn’t respond to the key/elevator information and ends the interaction oddly.\",\n          \"isCorrect\": false,\n          \"text\": \"空港に行きます。\",\n          \"textRomanization\": \"Kuukou ni ikimasu.\"\n        },\n        {\n          \"feedback\": \"Good morning. - A greeting here is awkward; you’re finishing check-in, so thanks is more appropriate.\",\n          \"isCorrect\": false,\n          \"text\": \"おはようございます。\",\n          \"textRomanization\": \"Ohayou gozaimasu.\"\n        }\n      ]\n    }\n  ]\n}",
      "outputTokens": 2815,
      "systemPrompt": "# Role\n\nYou are an expert language immersion designer specializing in creating realistic, dialogue-driven scenarios that help learners practice language production in authentic contexts. You design experiences that simulate situations learners would encounter when living or traveling in a country where the target language is spoken.\n\n# Goal\n\nCreate an immersive story activity where learners are placed in an everyday situation and must choose appropriate phrases to communicate. The activity simulates real conversations with native speakers, forcing learners to engage with the target language directly rather than relying on translations.\n\nThe activity places learners in a specific scenario (ordering food, asking for directions, checking into a hotel) and guides them through a dialogue where they must select appropriate responses at each step.\n\n# Key Design Principles\n\n## Immersion Over Translation\n\nUnlike other activities where translations help comprehension, this activity intentionally withholds translations from the options. Learners see:\n\n- **Context**: What the native speaker says (in TARGET language with translation)\n- **Options**: Four possible responses (in TARGET language ONLY - no translations)\n\nThis forces learners to:\n\n1. Engage with the target language sounds and patterns\n2. Use context clues to infer meaning\n3. Build recognition before relying on translations\n4. Experience the \"productive uncertainty\" of real conversations\n\nThe translation appears only in the feedback AFTER selection, revealing whether they understood correctly.\n\n## Authentic Scenarios\n\nFocus on situations learners will actually encounter:\n\n| Category       | Example Scenarios                                  |\n| -------------- | -------------------------------------------------- |\n| Food & Dining  | Ordering at a restaurant, asking about ingredients |\n| Transportation | Buying train tickets, asking for directions        |\n| Shopping       | Bargaining at a market, returning an item          |\n| Accommodation  | Checking into a hotel, reporting a problem         |\n| Healthcare     | Describing symptoms at a pharmacy, doctor's visit  |\n| Social         | Meeting neighbors, small talk at a cafe            |\n| Services       | Opening a bank account, getting a phone plan       |\n| Emergencies    | Reporting lost items, asking for help              |\n\n## Supportive Native Speaker\n\nThe character in the story is a friendly native speaker who:\n\n- Speaks naturally but not too fast\n- Helps the learner when they struggle\n- Provides context clues in their responses\n- Never mocks mistakes\n- Gradually introduces more complex language\n\n# Language Handling\n\n## Input Variables\n\n- **TARGET_LANGUAGE**: The language being learned (from `courseTitle`). All dialogue and options are in this language.\n- **NATIVE_LANGUAGE**: The learner's native language (from `language` code). Questions, feedback, and context translations use this language.\n\n## Language Codes\n\n- `en`: US English\n- `pt`: Brazilian Portuguese\n- `es`: Latin American Spanish\n\n## What Appears in Each Language\n\n| Field                        | Language     | Example (Spanish course, English native)                  |\n| ---------------------------- | ------------ | --------------------------------------------------------- |\n| `scenario`                   | NATIVE       | \"You're at a cafe in Madrid and want to order coffee.\"    |\n| `context`                    | TARGET       | \"Buenos dias, que le pongo?\"                              |\n| `contextTranslation`         | NATIVE       | \"Good morning, what can I get you?\"                       |\n| `contextRomanization`        | Romanization | \"\" (empty for Roman scripts)                              |\n| `options[].text`             | TARGET       | \"Un cafe con leche, por favor.\"                           |\n| `options[].textRomanization` | Romanization | \"\" (empty for Roman scripts)                              |\n| `options[].feedback`         | NATIVE       | \"A coffee with milk, please - Perfect! Polite and clear.\" |\n\n# Options Design\n\n## No Translations in Options\n\nThis is the most critical design decision. Options show ONLY:\n\n- `text`: The phrase in TARGET language\n- `textRomanization`: Romanization for non-Roman scripts (empty string for Roman scripts)\n\n**NO translation is shown**. This forces the learner to:\n\n1. Parse the target language directly\n2. Use patterns they've learned\n3. Make educated guesses based on context\n4. Experience the productive struggle of real communication\n\n## Option Quality\n\nAll 4 options must be:\n\n- **Grammatically correct** in the target language\n- **Contextually plausible** (something a learner might say in this situation)\n- **Distinct in meaning** (not just word variations)\n- **Level-appropriate** (using vocabulary/structures the learner knows)\n\n## Distractor Design\n\n**CRITICAL**: Wrong options must be genuinely inappropriate for the situation - they should lead to miscommunication or confusion if used. Do NOT create distractors that are merely \"less polished\" versions of the correct answer.\n\nWrong options should be **clearly wrong** because they:\n\n1. **Answer a different question**: Respond to something the speaker didn't ask (asking about price when asked about quantity)\n2. **Request the wrong thing**: Order/ask for something different than intended (one-way ticket when you need round-trip)\n3. **Are off-topic**: Say something unrelated to the current conversation point (asking for the check when you just arrived)\n4. **Would cause confusion**: Use words that change the meaning entirely (saying \"no\" when you mean \"yes\")\n\n**DO NOT** create distractors that are:\n\n- Just more/less formal versions of the correct answer\n- Slightly different phrasings that would still work\n- Grammatically awkward but still understandable\n\n# Feedback Design\n\nFeedback appears AFTER the learner selects an option. Every feedback message MUST include:\n\n1. **Translation**: What the option actually means in the native language\n2. **Explanation**: Why this choice is correct or incorrect for the situation\n\n## Feedback Structure\n\nFor **correct** options:\n\n```\n\"[Translation of what they said] - [Why this works in context]\"\n```\n\nExample: \"A coffee with milk, please - Perfect! This is polite and clearly communicates what you want.\"\n\nFor **incorrect** options:\n\n```\n\"[Translation of what they said] - [Why this doesn't work and what would be better]\"\n```\n\nExample: \"Where is the bathroom? - You're trying to order coffee, not find the restroom. Tell the barista what you'd like to drink.\"\n\n# Romanization Requirements\n\nFor languages using non-Roman writing systems (Japanese, Chinese, Korean, Arabic, Russian, Greek, Hebrew, Thai, Hindi, etc.), provide romanization for both context and options.\n\n## Standard Systems\n\n- **Japanese**: Romaji using Hepburn romanization\n- **Chinese**: Pinyin with tone marks\n- **Korean**: Revised Romanization of Korean\n- **Russian**: ISO 9 or BGN/PCGN transliteration\n- **Arabic**: Standard romanization\n- **Greek**: Standard transliteration\n- **Thai**: Royal Thai General System\n- **Hindi**: IAST or Hunterian transliteration\n\n## Roman Scripts\n\nFor languages using Roman letters (Spanish, French, German, Portuguese, Italian, etc.), set both `contextRomanization` and `textRomanization` to empty strings `\"\"`.\n\n# Story Arc\n\nEach story should have 5-10 steps following a natural arc:\n\n## Step Progression\n\n1. **Opening** (1-2 steps): Arrive at the location, initial greeting\n2. **Building** (2-4 steps): Main interaction, making requests, clarifying\n3. **Complication** (0-2 steps): Optional challenge that adds realism\n4. **Resolution** (1-2 steps): Complete the transaction\n5. **Closing** (1 step): Thank and goodbye\n\n## Complication Ideas (Recommended)\n\nAdding a complication makes the story more realistic and teaches learners to handle unexpected situations:\n\n- **Item unavailable**: \"Sorry, we're out of that. Would you like something else?\"\n- **Misunderstanding**: \"Did you say two or twelve?\"\n- **Additional requirement**: \"I'll need to see your ID for that.\"\n- **Clarification needed**: \"Which size did you want?\"\n\n## Pacing Guidelines\n\n- Steps should feel like natural conversation beats\n- Each step presents ONE decision point\n- Context should flow naturally from the previous step\n- The native speaker's response should acknowledge what the learner said\n\n# Output Format\n\nReturn an object with this structure (abbreviated examples shown):\n\n**Non-Roman script example (Japanese):**\n\n```json\n{\n  \"scenario\": \"You're at a train station in Tokyo...\",\n  \"steps\": [\n    {\n      \"context\": \"いらっしゃいませ。どちらまで？\",\n      \"contextTranslation\": \"Welcome. Where to?\",\n      \"contextRomanization\": \"Irasshaimase. Dochira made?\",\n      \"options\": [\n        {\n          \"text\": \"京都までお願いします。\",\n          \"textRomanization\": \"Kyouto made onegaishimasu.\",\n          \"isCorrect\": true,\n          \"feedback\": \"To Kyoto, please - Perfect!\"\n        },\n        {\n          \"text\": \"京都は遠いですか？\",\n          \"textRomanization\": \"Kyouto wa tooi desu ka?\",\n          \"isCorrect\": false,\n          \"feedback\": \"Is Kyoto far? - This asks about distance, not for a ticket.\"\n        }\n      ]\n    }\n  ]\n}\n```\n\n**Roman script example (Spanish) - empty romanization fields:**\n\n```json\n{\n  \"scenario\": \"You're at a restaurant in Barcelona...\",\n  \"steps\": [\n    {\n      \"context\": \"Buenas noches. Estan listos para pedir?\",\n      \"contextTranslation\": \"Good evening. Are you ready to order?\",\n      \"contextRomanization\": \"\",\n      \"options\": [\n        {\n          \"text\": \"Si, me gustaria la paella, por favor.\",\n          \"textRomanization\": \"\",\n          \"isCorrect\": true,\n          \"feedback\": \"Yes, I would like the paella, please - Perfect!\"\n        },\n        {\n          \"text\": \"La cuenta, por favor.\",\n          \"textRomanization\": \"\",\n          \"isCorrect\": false,\n          \"feedback\": \"The check, please - You haven't eaten yet!\"\n        }\n      ]\n    }\n  ]\n}\n```\n\nNote: Examples above are abbreviated. Actual output must have 4 options per step and 5-10 steps total.\n\n# Quality Checklist\n\nBefore finalizing, verify:\n\n1. **Grammar accuracy**: All target language text is grammatically correct\n2. **Natural dialogue**: Conversations flow like real interactions\n3. **Appropriate register**: Formality matches the situation (casual cafe vs formal office)\n4. **Cultural accuracy**: Interactions reflect how things work in that culture\n5. **Clear progression**: Steps follow a logical narrative arc\n6. **Distinct options**: Each option represents a meaningfully different choice\n7. **Helpful feedback**: Translations and explanations clarify meaning and context\n8. **Correct romanization**: Follows standard systems for non-Roman scripts, empty for Roman scripts\n9. **Scenario relevance**: The story matches the lesson topic\n10. **Appropriate difficulty**: Language complexity matches learner level\n\n# Common Mistakes to Avoid\n\n1. **Including translations in options**: Options must show TARGET language only\n2. **Trivial distractors**: Options that are obviously wrong or nonsensical\n3. **Inconsistent register**: Mixing formal and informal inappropriately\n4. **Unnatural responses**: Things a native speaker would never actually say\n5. **Missing romanization**: Forgetting to add romanization for non-Roman scripts\n6. **Adding romanization to Roman scripts**: Spanish, French, etc. should have empty strings\n7. **Feedback without translation**: Always include what the option means\n8. **Disconnected steps**: Each step should follow logically from the previous one\n",
      "testCaseId": "en-japanese-hotel-checkin-1",
      "userPrompt": "TARGET_LANGUAGE: Japanese\nNATIVE_LANGUAGE: en\nCHAPTER_TITLE: Travel and Accommodation\nLESSON_TITLE: Hotel Check-in\nLESSON_DESCRIPTION: Learn to check into a hotel, confirm reservations, and ask about room amenities\n\nGenerate an immersive dialogue-driven story activity for this language lesson. Create a realistic everyday scenario where learners practice language production in situations they'd face in a foreign country."
    },
    {
      "duration": 32292.139666000003,
      "inputTokens": 2654,
      "output": "{\n  \"scenario\": \"Você está em um mercado ao ar livre na Alemanha (Wochenmarkt). Você quer comprar frutas e verduras, perguntar o preço e a quantidade, e pagar no final.\",\n  \"steps\": [\n    {\n      \"context\": \"Guten Morgen! Was darf’s sein?\",\n      \"contextRomanization\": \"\",\n      \"contextTranslation\": \"Bom dia! O que vai ser?\",\n      \"options\": [\n        {\n          \"feedback\": \"Eu gostaria de um quilo de maçãs, por favor. - Perfeito! Você responde exatamente ao que a vendedora perguntou e já diz quantidade e produto.\",\n          \"isCorrect\": true,\n          \"text\": \"Ich hätte gern ein Kilo Äpfel, bitte.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Onde ficam os ovos? - Isso muda o assunto: ela perguntou o que você quer comprar agora. Melhor pedir um item diretamente.\",\n          \"isCorrect\": false,\n          \"text\": \"Wo sind die Eier?\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Você aceita cartão? - Perguntar sobre pagamento é útil, mas ainda é cedo: primeiro diga o que você quer comprar.\",\n          \"isCorrect\": false,\n          \"text\": \"Kann ich mit Karte zahlen?\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"A conta, por favor. - Você ainda nem comprou nada; isso soaria como se estivesse num restaurante.\",\n          \"isCorrect\": false,\n          \"text\": \"Die Rechnung, bitte.\",\n          \"textRomanization\": \"\"\n        }\n      ]\n    },\n    {\n      \"context\": \"Gern. Sonst noch etwas?\",\n      \"contextRomanization\": \"\",\n      \"contextTranslation\": \"Claro. Mais alguma coisa?\",\n      \"options\": [\n        {\n          \"feedback\": \"Sim, mais meio quilo de bananas, por favor. - Ótimo! Resposta natural para adicionar outro item com quantidade.\",\n          \"isCorrect\": true,\n          \"text\": \"Ja, noch ein halbes Kilo Bananen, bitte.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Quanto custa o ingresso? - Isso não tem relação com compras no mercado; vai confundir.\",\n          \"isCorrect\": false,\n          \"text\": \"Wie viel kostet das Ticket?\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Estou só olhando. - Isso encerraria a compra em vez de adicionar itens. Serve se você não quiser comprar mais.\",\n          \"isCorrect\": false,\n          \"text\": \"Ich schaue nur.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Eu não entendo você. - Você pode dizer isso, mas aqui a vendedora só perguntou se você quer mais algo. Melhor adicionar o próximo item.\",\n          \"isCorrect\": false,\n          \"text\": \"Ich verstehe Sie nicht.\",\n          \"textRomanization\": \"\"\n        }\n      ]\n    },\n    {\n      \"context\": \"Möchten Sie auch Gemüse? Wir haben heute frische Tomaten.\",\n      \"contextRomanization\": \"\",\n      \"contextTranslation\": \"Você quer também legumes/verduras? Hoje temos tomates frescos.\",\n      \"options\": [\n        {\n          \"feedback\": \"Sim, por favor, 500 gramas de tomates. - Excelente: você aceita a sugestão e especifica a quantidade claramente.\",\n          \"isCorrect\": true,\n          \"text\": \"Ja, bitte, 500 Gramm Tomaten.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Eu gostaria de uma água sem gás. - Isso não responde ao oferecimento de tomates/verduras e pode nem ser vendido nessa banca.\",\n          \"isCorrect\": false,\n          \"text\": \"Ich hätte gern ein stilles Wasser.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"A que horas vocês fecham? - Pergunta possível, mas não responde à oferta; atrasa a compra.\",\n          \"isCorrect\": false,\n          \"text\": \"Wann machen Sie zu?\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Não, eu sou de Portugal. - Informação aleatória aqui; não responde se você quer tomates/verduras.\",\n          \"isCorrect\": false,\n          \"text\": \"Nein, ich komme aus Portugal.\",\n          \"textRomanization\": \"\"\n        }\n      ]\n    },\n    {\n      \"context\": \"Kein Problem. Wie viele Gurken hätten Sie gern?\",\n      \"contextRomanization\": \"\",\n      \"contextTranslation\": \"Sem problema. Quantos pepinos você gostaria?\",\n      \"options\": [\n        {\n          \"feedback\": \"Duas, por favor. - Perfeito: para itens contáveis, usar número é o mais natural.\",\n          \"isCorrect\": true,\n          \"text\": \"Zwei Stück, bitte.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Um quilo, por favor. - Para pepinos, normalmente se pede por unidades; isso pode soar estranho e gerar esclarecimentos.\",\n          \"isCorrect\": false,\n          \"text\": \"Ein Kilo, bitte.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"É muito caro. - Você ainda não perguntou o preço; reclamar agora não faz sentido.\",\n          \"isCorrect\": false,\n          \"text\": \"Das ist zu teuer.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Onde é a saída? - Fora do contexto; ela perguntou quantos pepinos você quer.\",\n          \"isCorrect\": false,\n          \"text\": \"Wo ist der Ausgang?\",\n          \"textRomanization\": \"\"\n        }\n      ]\n    },\n    {\n      \"context\": \"Die Äpfel sind 3,50 € pro Kilo, die Bananen 2,90 € und die Tomaten 4,20 € pro Kilo. Ist das so in Ordnung?\",\n      \"contextRomanization\": \"\",\n      \"contextTranslation\": \"As maçãs são 3,50 € por quilo, as bananas 2,90 € e os tomates 4,20 € por quilo. Tudo bem assim?\",\n      \"options\": [\n        {\n          \"feedback\": \"Sim, está tudo bem. - Ótimo: você confirma os preços e segue adiante sem complicar.\",\n          \"isCorrect\": true,\n          \"text\": \"Ja, das ist in Ordnung.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Eu gostaria de experimentar. - Em mercado, “experimentar” pode soar como provar/degustar; não responde à confirmação dos preços.\",\n          \"isCorrect\": false,\n          \"text\": \"Ich möchte probieren.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Pode me trazer isso amanhã? - Entrega no dia seguinte não é o esperado numa banca; foge do fluxo da compra.\",\n          \"isCorrect\": false,\n          \"text\": \"Können Sie das morgen bringen?\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Estou doente. - Não responde aos preços; mudaria o assunto de forma estranha.\",\n          \"isCorrect\": false,\n          \"text\": \"Ich bin krank.\",\n          \"textRomanization\": \"\"\n        }\n      ]\n    },\n    {\n      \"context\": \"Eine Frage noch: Möchten Sie eine Tüte dazu?\",\n      \"contextRomanization\": \"\",\n      \"contextTranslation\": \"Mais uma pergunta: você quer uma sacola?\",\n      \"options\": [\n        {\n          \"feedback\": \"Sim, por favor. - Perfeito: resposta direta e educada para a oferta de sacola.\",\n          \"isCorrect\": true,\n          \"text\": \"Ja, bitte.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Não, obrigado, eu pago depois. - “Pagar depois” soa como se você fosse sair sem pagar; não é a intenção aqui.\",\n          \"isCorrect\": false,\n          \"text\": \"Nein, danke, ich zahle später.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Quanto pesa? - Ela perguntou sobre sacola; perguntar peso agora não resolve essa pergunta.\",\n          \"isCorrect\": false,\n          \"text\": \"Wie schwer ist das?\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Eu não tenho tempo. - Isso encerra de forma brusca e não responde claramente à sacola.\",\n          \"isCorrect\": false,\n          \"text\": \"Ich habe keine Zeit.\",\n          \"textRomanization\": \"\"\n        }\n      ]\n    },\n    {\n      \"context\": \"Alles zusammen macht 9,80 €. Zahlen Sie bar oder mit Karte?\",\n      \"contextRomanization\": \"\",\n      \"contextTranslation\": \"Tudo junto dá 9,80 €. Você paga em dinheiro ou com cartão?\",\n      \"options\": [\n        {\n          \"feedback\": \"Com cartão, por favor. - Ótimo: você escolhe o método de pagamento de forma clara.\",\n          \"isCorrect\": true,\n          \"text\": \"Mit Karte, bitte.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Eu gostaria de um recibo. - Isso pode ser pedido, mas não responde à escolha entre dinheiro ou cartão.\",\n          \"isCorrect\": false,\n          \"text\": \"Ich hätte gern eine Quittung.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Onde fica o banheiro? - Fora do contexto do pagamento; atrasaria a finalização.\",\n          \"isCorrect\": false,\n          \"text\": \"Wo ist die Toilette?\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Eu preciso de um desconto. - Pedir desconto é possível, mas aqui a vendedora perguntou como você vai pagar; isso muda a etapa da conversa.\",\n          \"isCorrect\": false,\n          \"text\": \"Ich brauche einen Rabatt.\",\n          \"textRomanization\": \"\"\n        }\n      ]\n    },\n    {\n      \"context\": \"Danke! Hier ist Ihr Einkauf. Schönen Tag noch!\",\n      \"contextRomanization\": \"\",\n      \"contextTranslation\": \"Obrigado! Aqui estão suas compras. Tenha um bom dia!\",\n      \"options\": [\n        {\n          \"feedback\": \"Obrigado, igualmente! Até logo. - Perfeito: você encerra com agradecimento e despedida natural.\",\n          \"isCorrect\": true,\n          \"text\": \"Danke, Ihnen auch! Auf Wiedersehen!\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Desculpe, eu perdi meu passaporte. - Isso criaria um problema totalmente diferente e não combina com o encerramento da compra.\",\n          \"isCorrect\": false,\n          \"text\": \"Entschuldigung, ich habe meinen Pass verloren.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Eu não quero isso. - Você já pagou; dizer isso agora causaria confusão e possível devolução desnecessária.\",\n          \"isCorrect\": false,\n          \"text\": \"Ich will das nicht.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Me vê dois bilhetes. - “Bilhetes” não tem relação com as compras; não faz sentido aqui.\",\n          \"isCorrect\": false,\n          \"text\": \"Geben Sie mir zwei Tickets.\",\n          \"textRomanization\": \"\"\n        }\n      ]\n    }\n  ]\n}",
      "outputTokens": 1885,
      "systemPrompt": "# Role\n\nYou are an expert language immersion designer specializing in creating realistic, dialogue-driven scenarios that help learners practice language production in authentic contexts. You design experiences that simulate situations learners would encounter when living or traveling in a country where the target language is spoken.\n\n# Goal\n\nCreate an immersive story activity where learners are placed in an everyday situation and must choose appropriate phrases to communicate. The activity simulates real conversations with native speakers, forcing learners to engage with the target language directly rather than relying on translations.\n\nThe activity places learners in a specific scenario (ordering food, asking for directions, checking into a hotel) and guides them through a dialogue where they must select appropriate responses at each step.\n\n# Key Design Principles\n\n## Immersion Over Translation\n\nUnlike other activities where translations help comprehension, this activity intentionally withholds translations from the options. Learners see:\n\n- **Context**: What the native speaker says (in TARGET language with translation)\n- **Options**: Four possible responses (in TARGET language ONLY - no translations)\n\nThis forces learners to:\n\n1. Engage with the target language sounds and patterns\n2. Use context clues to infer meaning\n3. Build recognition before relying on translations\n4. Experience the \"productive uncertainty\" of real conversations\n\nThe translation appears only in the feedback AFTER selection, revealing whether they understood correctly.\n\n## Authentic Scenarios\n\nFocus on situations learners will actually encounter:\n\n| Category       | Example Scenarios                                  |\n| -------------- | -------------------------------------------------- |\n| Food & Dining  | Ordering at a restaurant, asking about ingredients |\n| Transportation | Buying train tickets, asking for directions        |\n| Shopping       | Bargaining at a market, returning an item          |\n| Accommodation  | Checking into a hotel, reporting a problem         |\n| Healthcare     | Describing symptoms at a pharmacy, doctor's visit  |\n| Social         | Meeting neighbors, small talk at a cafe            |\n| Services       | Opening a bank account, getting a phone plan       |\n| Emergencies    | Reporting lost items, asking for help              |\n\n## Supportive Native Speaker\n\nThe character in the story is a friendly native speaker who:\n\n- Speaks naturally but not too fast\n- Helps the learner when they struggle\n- Provides context clues in their responses\n- Never mocks mistakes\n- Gradually introduces more complex language\n\n# Language Handling\n\n## Input Variables\n\n- **TARGET_LANGUAGE**: The language being learned (from `courseTitle`). All dialogue and options are in this language.\n- **NATIVE_LANGUAGE**: The learner's native language (from `language` code). Questions, feedback, and context translations use this language.\n\n## Language Codes\n\n- `en`: US English\n- `pt`: Brazilian Portuguese\n- `es`: Latin American Spanish\n\n## What Appears in Each Language\n\n| Field                        | Language     | Example (Spanish course, English native)                  |\n| ---------------------------- | ------------ | --------------------------------------------------------- |\n| `scenario`                   | NATIVE       | \"You're at a cafe in Madrid and want to order coffee.\"    |\n| `context`                    | TARGET       | \"Buenos dias, que le pongo?\"                              |\n| `contextTranslation`         | NATIVE       | \"Good morning, what can I get you?\"                       |\n| `contextRomanization`        | Romanization | \"\" (empty for Roman scripts)                              |\n| `options[].text`             | TARGET       | \"Un cafe con leche, por favor.\"                           |\n| `options[].textRomanization` | Romanization | \"\" (empty for Roman scripts)                              |\n| `options[].feedback`         | NATIVE       | \"A coffee with milk, please - Perfect! Polite and clear.\" |\n\n# Options Design\n\n## No Translations in Options\n\nThis is the most critical design decision. Options show ONLY:\n\n- `text`: The phrase in TARGET language\n- `textRomanization`: Romanization for non-Roman scripts (empty string for Roman scripts)\n\n**NO translation is shown**. This forces the learner to:\n\n1. Parse the target language directly\n2. Use patterns they've learned\n3. Make educated guesses based on context\n4. Experience the productive struggle of real communication\n\n## Option Quality\n\nAll 4 options must be:\n\n- **Grammatically correct** in the target language\n- **Contextually plausible** (something a learner might say in this situation)\n- **Distinct in meaning** (not just word variations)\n- **Level-appropriate** (using vocabulary/structures the learner knows)\n\n## Distractor Design\n\n**CRITICAL**: Wrong options must be genuinely inappropriate for the situation - they should lead to miscommunication or confusion if used. Do NOT create distractors that are merely \"less polished\" versions of the correct answer.\n\nWrong options should be **clearly wrong** because they:\n\n1. **Answer a different question**: Respond to something the speaker didn't ask (asking about price when asked about quantity)\n2. **Request the wrong thing**: Order/ask for something different than intended (one-way ticket when you need round-trip)\n3. **Are off-topic**: Say something unrelated to the current conversation point (asking for the check when you just arrived)\n4. **Would cause confusion**: Use words that change the meaning entirely (saying \"no\" when you mean \"yes\")\n\n**DO NOT** create distractors that are:\n\n- Just more/less formal versions of the correct answer\n- Slightly different phrasings that would still work\n- Grammatically awkward but still understandable\n\n# Feedback Design\n\nFeedback appears AFTER the learner selects an option. Every feedback message MUST include:\n\n1. **Translation**: What the option actually means in the native language\n2. **Explanation**: Why this choice is correct or incorrect for the situation\n\n## Feedback Structure\n\nFor **correct** options:\n\n```\n\"[Translation of what they said] - [Why this works in context]\"\n```\n\nExample: \"A coffee with milk, please - Perfect! This is polite and clearly communicates what you want.\"\n\nFor **incorrect** options:\n\n```\n\"[Translation of what they said] - [Why this doesn't work and what would be better]\"\n```\n\nExample: \"Where is the bathroom? - You're trying to order coffee, not find the restroom. Tell the barista what you'd like to drink.\"\n\n# Romanization Requirements\n\nFor languages using non-Roman writing systems (Japanese, Chinese, Korean, Arabic, Russian, Greek, Hebrew, Thai, Hindi, etc.), provide romanization for both context and options.\n\n## Standard Systems\n\n- **Japanese**: Romaji using Hepburn romanization\n- **Chinese**: Pinyin with tone marks\n- **Korean**: Revised Romanization of Korean\n- **Russian**: ISO 9 or BGN/PCGN transliteration\n- **Arabic**: Standard romanization\n- **Greek**: Standard transliteration\n- **Thai**: Royal Thai General System\n- **Hindi**: IAST or Hunterian transliteration\n\n## Roman Scripts\n\nFor languages using Roman letters (Spanish, French, German, Portuguese, Italian, etc.), set both `contextRomanization` and `textRomanization` to empty strings `\"\"`.\n\n# Story Arc\n\nEach story should have 5-10 steps following a natural arc:\n\n## Step Progression\n\n1. **Opening** (1-2 steps): Arrive at the location, initial greeting\n2. **Building** (2-4 steps): Main interaction, making requests, clarifying\n3. **Complication** (0-2 steps): Optional challenge that adds realism\n4. **Resolution** (1-2 steps): Complete the transaction\n5. **Closing** (1 step): Thank and goodbye\n\n## Complication Ideas (Recommended)\n\nAdding a complication makes the story more realistic and teaches learners to handle unexpected situations:\n\n- **Item unavailable**: \"Sorry, we're out of that. Would you like something else?\"\n- **Misunderstanding**: \"Did you say two or twelve?\"\n- **Additional requirement**: \"I'll need to see your ID for that.\"\n- **Clarification needed**: \"Which size did you want?\"\n\n## Pacing Guidelines\n\n- Steps should feel like natural conversation beats\n- Each step presents ONE decision point\n- Context should flow naturally from the previous step\n- The native speaker's response should acknowledge what the learner said\n\n# Output Format\n\nReturn an object with this structure (abbreviated examples shown):\n\n**Non-Roman script example (Japanese):**\n\n```json\n{\n  \"scenario\": \"You're at a train station in Tokyo...\",\n  \"steps\": [\n    {\n      \"context\": \"いらっしゃいませ。どちらまで？\",\n      \"contextTranslation\": \"Welcome. Where to?\",\n      \"contextRomanization\": \"Irasshaimase. Dochira made?\",\n      \"options\": [\n        {\n          \"text\": \"京都までお願いします。\",\n          \"textRomanization\": \"Kyouto made onegaishimasu.\",\n          \"isCorrect\": true,\n          \"feedback\": \"To Kyoto, please - Perfect!\"\n        },\n        {\n          \"text\": \"京都は遠いですか？\",\n          \"textRomanization\": \"Kyouto wa tooi desu ka?\",\n          \"isCorrect\": false,\n          \"feedback\": \"Is Kyoto far? - This asks about distance, not for a ticket.\"\n        }\n      ]\n    }\n  ]\n}\n```\n\n**Roman script example (Spanish) - empty romanization fields:**\n\n```json\n{\n  \"scenario\": \"You're at a restaurant in Barcelona...\",\n  \"steps\": [\n    {\n      \"context\": \"Buenas noches. Estan listos para pedir?\",\n      \"contextTranslation\": \"Good evening. Are you ready to order?\",\n      \"contextRomanization\": \"\",\n      \"options\": [\n        {\n          \"text\": \"Si, me gustaria la paella, por favor.\",\n          \"textRomanization\": \"\",\n          \"isCorrect\": true,\n          \"feedback\": \"Yes, I would like the paella, please - Perfect!\"\n        },\n        {\n          \"text\": \"La cuenta, por favor.\",\n          \"textRomanization\": \"\",\n          \"isCorrect\": false,\n          \"feedback\": \"The check, please - You haven't eaten yet!\"\n        }\n      ]\n    }\n  ]\n}\n```\n\nNote: Examples above are abbreviated. Actual output must have 4 options per step and 5-10 steps total.\n\n# Quality Checklist\n\nBefore finalizing, verify:\n\n1. **Grammar accuracy**: All target language text is grammatically correct\n2. **Natural dialogue**: Conversations flow like real interactions\n3. **Appropriate register**: Formality matches the situation (casual cafe vs formal office)\n4. **Cultural accuracy**: Interactions reflect how things work in that culture\n5. **Clear progression**: Steps follow a logical narrative arc\n6. **Distinct options**: Each option represents a meaningfully different choice\n7. **Helpful feedback**: Translations and explanations clarify meaning and context\n8. **Correct romanization**: Follows standard systems for non-Roman scripts, empty for Roman scripts\n9. **Scenario relevance**: The story matches the lesson topic\n10. **Appropriate difficulty**: Language complexity matches learner level\n\n# Common Mistakes to Avoid\n\n1. **Including translations in options**: Options must show TARGET language only\n2. **Trivial distractors**: Options that are obviously wrong or nonsensical\n3. **Inconsistent register**: Mixing formal and informal inappropriately\n4. **Unnatural responses**: Things a native speaker would never actually say\n5. **Missing romanization**: Forgetting to add romanization for non-Roman scripts\n6. **Adding romanization to Roman scripts**: Spanish, French, etc. should have empty strings\n7. **Feedback without translation**: Always include what the option means\n8. **Disconnected steps**: Each step should follow logically from the previous one\n",
      "testCaseId": "pt-german-market-shopping-1",
      "userPrompt": "TARGET_LANGUAGE: German\nNATIVE_LANGUAGE: pt\nCHAPTER_TITLE: Fazendo Compras\nLESSON_TITLE: No Mercado\nLESSON_DESCRIPTION: Aprenda a comprar frutas, verduras e outros itens em um mercado alemao\n\nGenerate an immersive dialogue-driven story activity for this language lesson. Create a realistic everyday scenario where learners practice language production in situations they'd face in a foreign country."
    },
    {
      "duration": 50200.574375,
      "inputTokens": 2654,
      "output": "{\n  \"scenario\": \"Estás en Seúl como visitante. Sales del metro y necesitas llegar a un destino cercano a pie. No tienes buena señal en el teléfono, así que tienes que pedir direcciones en coreano y entender indicaciones básicas.\",\n  \"steps\": [\n    {\n      \"context\": \"안녕하세요. 어디를 찾으세요?\",\n      \"contextRomanization\": \"Annyeonghaseyo. Eodireul chaj-euseyo?\",\n      \"contextTranslation\": \"Hola. ¿Qué lugar estás buscando?\",\n      \"options\": [\n        {\n          \"feedback\": \"\\\"저는 경복궁에 가고 싶어요.\\\" - \\\"Quiero ir al Palacio Gyeongbokgung\\\". Funciona perfecto: dices claramente tu destino y suena natural para pedir direcciones.\",\n          \"isCorrect\": true,\n          \"text\": \"저는 경복궁에 가고 싶어요.\",\n          \"textRomanization\": \"Jeoneun Gyeongbokgung-e gago sipeoyo.\"\n        },\n        {\n          \"feedback\": \"\\\"여기서 사진 찍어도 돼요?\\\" - \\\"¿Puedo tomar fotos aquí?\\\". Es una pregunta distinta; no responde a qué lugar buscas.\",\n          \"isCorrect\": false,\n          \"text\": \"여기서 사진 찍어도 돼요?\",\n          \"textRomanization\": \"Yeogiseo sajin jjigeodo dwaeyo?\"\n        },\n        {\n          \"feedback\": \"\\\"지하철표 한 장 주세요.\\\" - \\\"Deme un boleto de metro\\\". Estás en la calle pidiendo direcciones; esto cambiaría el tema a comprar boletos.\",\n          \"isCorrect\": false,\n          \"text\": \"지하철표 한 장 주세요.\",\n          \"textRomanization\": \"Jihacheolpyo han jang juseyo.\"\n        },\n        {\n          \"feedback\": \"\\\"저는 배가 고파요.\\\" - \\\"Tengo hambre\\\". Es comprensible, pero no ayuda a pedir direcciones al lugar que buscas.\",\n          \"isCorrect\": false,\n          \"text\": \"저는 배가 고파요.\",\n          \"textRomanization\": \"Jeoneun baega gopayo.\"\n        }\n      ]\n    },\n    {\n      \"context\": \"경복궁이요? 여기서 어떻게 가는지 알려드릴게요. 먼저 이 길로 쭉 가세요. 맞아요?\",\n      \"contextRomanization\": \"Gyeongbokgung-iyo? Yeogiseo eotteoke ganeunji allyeodeurilgeyo. Meonjeo i gillo jjukk gaseyo. Majayo?\",\n      \"contextTranslation\": \"¿Gyeongbokgung? Te explico cómo ir. Primero, sigue derecho por esta calle. ¿De acuerdo?\",\n      \"options\": [\n        {\n          \"feedback\": \"\\\"네, 알겠어요.\\\" - \\\"Sí, entendido\\\". Excelente: confirmas que entendiste la primera indicación.\",\n          \"isCorrect\": true,\n          \"text\": \"네, 알겠어요.\",\n          \"textRomanization\": \"Ne, algesseoyo.\"\n        },\n        {\n          \"feedback\": \"\\\"아니요, 택시 주세요.\\\" - \\\"No, un taxi por favor\\\". Cambia a pedir un taxi en vez de seguir las indicaciones a pie.\",\n          \"isCorrect\": false,\n          \"text\": \"아니요, 택시 주세요.\",\n          \"textRomanization\": \"Aniyo, taeksi juseyo.\"\n        },\n        {\n          \"feedback\": \"\\\"오른쪽이 어디예요?\\\" - \\\"¿Dónde está la derecha?\\\". Podrías preguntar esto si no sabes, pero aquí te dijeron ‘sigue derecho’ y te piden confirmación; no responde directamente.\",\n          \"isCorrect\": false,\n          \"text\": \"오른쪽이 어디예요?\",\n          \"textRomanization\": \"Oreunjjogi eodi-yeyo?\"\n        },\n        {\n          \"feedback\": \"\\\"저는 경복궁을 싫어해요.\\\" - \\\"No me gusta Gyeongbokgung\\\". No corresponde a la situación; necesitas llegar allí.\",\n          \"isCorrect\": false,\n          \"text\": \"저는 경복궁을 싫어해요.\",\n          \"textRomanization\": \"Jeoneun Gyeongbokgung-eul sireohaeyo.\"\n        }\n      ]\n    },\n    {\n      \"context\": \"좋아요. 그리고 두 번째 신호등에서 오른쪽으로 도세요. 지하철역이 보일 거예요.\",\n      \"contextRomanization\": \"Joayo. Geurigo du beonjjae sinhodeung-eseo oreunjjogeuro doseyo. Jihacheol-yeogi boil geo-yeyo.\",\n      \"contextTranslation\": \"Bien. Y en el segundo semáforo gira a la derecha. Verás una estación de metro.\",\n      \"options\": [\n        {\n          \"feedback\": \"\\\"두 번째 신호등에서 오른쪽으로 돌면 돼요?\\\" - \\\"¿Tengo que girar a la derecha en el segundo semáforo?\\\". Perfecto: repites para confirmar y aclarar.\",\n          \"isCorrect\": true,\n          \"text\": \"두 번째 신호등에서 오른쪽으로 돌면 돼요?\",\n          \"textRomanization\": \"Du beonjjae sinhodeung-eseo oreunjjogeuro dolmyeon dwaeyo?\"\n        },\n        {\n          \"feedback\": \"\\\"첫 번째 신호등에서 왼쪽으로 갈게요.\\\" - \\\"Iré a la izquierda en el primer semáforo\\\". Es lo contrario de la indicación; te perderías.\",\n          \"isCorrect\": false,\n          \"text\": \"첫 번째 신호등에서 왼쪽으로 갈게요.\",\n          \"textRomanization\": \"Cheot beonjjae sinhodeung-eseo oenjjogeuro galgeyo.\"\n        },\n        {\n          \"feedback\": \"\\\"지하철역에서 내려요.\\\" - \\\"Bajo en la estación de metro\\\". Estás caminando y no estás hablando de tomar el metro ahora; no encaja.\",\n          \"isCorrect\": false,\n          \"text\": \"지하철역에서 내려요.\",\n          \"textRomanization\": \"Jihacheol-yeog-eseo naeryeoyo.\"\n        },\n        {\n          \"feedback\": \"\\\"지금 비가 와요.\\\" - \\\"Ahora está lloviendo\\\". Comentario posible, pero no responde a la dirección que te están dando.\",\n          \"isCorrect\": false,\n          \"text\": \"지금 비가 와요.\",\n          \"textRomanization\": \"Jigeum biga wayo.\"\n        }\n      ]\n    },\n    {\n      \"context\": \"네, 맞아요. 거기서 조금만 더 가면 큰 길이 나와요. 혹시 걸어서 몇 분인지 궁금하세요?\",\n      \"contextRomanization\": \"Ne, majayo. Geogiseo jogeumman deo gamyeon keun giri nawayo. Hoksi georeoseo myeot bun-inji gunggeumhaseyo?\",\n      \"contextTranslation\": \"Sí, correcto. Desde ahí, si caminas un poco más, saldrá una avenida grande. ¿Te interesa saber cuántos minutos son caminando?\",\n      \"options\": [\n        {\n          \"feedback\": \"\\\"네, 걸어서 몇 분 걸려요?\\\" - \\\"Sí, ¿cuántos minutos tarda caminando?\\\". Muy adecuado: pides el tiempo a pie.\",\n          \"isCorrect\": true,\n          \"text\": \"네, 걸어서 몇 분 걸려요?\",\n          \"textRomanization\": \"Ne, georeoseo myeot bun geollyeoyo?\"\n        },\n        {\n          \"feedback\": \"\\\"버스로 몇 번이에요?\\\" - \\\"¿Qué número (de bus) es?\\\". Cambias el plan a tomar bus; no responde a la pregunta sobre minutos caminando.\",\n          \"isCorrect\": false,\n          \"text\": \"버스로 몇 번이에요?\",\n          \"textRomanization\": \"Beoseuro myeot beon-ieyo?\"\n        },\n        {\n          \"feedback\": \"\\\"지금 닫았어요?\\\" - \\\"¿Está cerrado ahora?\\\". Podrías preguntar por horarios, pero aquí te preguntan por el tiempo de caminata.\",\n          \"isCorrect\": false,\n          \"text\": \"지금 닫았어요?\",\n          \"textRomanization\": \"Jigeum dadasseoyo?\"\n        },\n        {\n          \"feedback\": \"\\\"저는 한국어를 못 읽어요.\\\" - \\\"No puedo leer coreano\\\". Podría ser relevante más tarde con letreros, pero no responde a la pregunta actual.\",\n          \"isCorrect\": false,\n          \"text\": \"저는 한국어를 못 읽어요.\",\n          \"textRomanization\": \"Jeoneun hangugeo-reul mot ilgeoyo.\"\n        }\n      ]\n    },\n    {\n      \"context\": \"걸어서 10분 정도예요. 그런데 길이 헷갈릴 수 있어요. 길을 잃으면 뭐라고 물어볼 거예요?\",\n      \"contextRomanization\": \"Georeoseo sip bun jeongdo-yeyo. Geureonde giri hetgallil su isseoyo. Gireul ireumyeon mworago mureobol geo-yeyo?\",\n      \"contextTranslation\": \"A pie son unos 10 minutos. Pero el camino puede confundir. Si te pierdes, ¿qué vas a preguntar?\",\n      \"options\": [\n        {\n          \"feedback\": \"\\\"죄송하지만, 경복궁이 어디예요?\\\" - \\\"Disculpe, ¿dónde está Gyeongbokgung?\\\". Perfecto: frase clave para cuando te pierdes.\",\n          \"isCorrect\": true,\n          \"text\": \"죄송하지만, 경복궁이 어디예요?\",\n          \"textRomanization\": \"Joesonghajiman, Gyeongbokgung-i eodi-yeyo?\"\n        },\n        {\n          \"feedback\": \"\\\"이거 얼마예요?\\\" - \\\"¿Cuánto cuesta esto?\\\". Es para compras, no para orientarte.\",\n          \"isCorrect\": false,\n          \"text\": \"이거 얼마예요?\",\n          \"textRomanization\": \"Igeo eolma-yeyo?\"\n        },\n        {\n          \"feedback\": \"\\\"물 좀 주세요.\\\" - \\\"Deme un poco de agua\\\". No es una pregunta de direcciones.\",\n          \"isCorrect\": false,\n          \"text\": \"물 좀 주세요.\",\n          \"textRomanization\": \"Mul jom juseyo.\"\n        },\n        {\n          \"feedback\": \"\\\"저는 학생이에요.\\\" - \\\"Soy estudiante\\\". No ayuda a ubicarte en la calle.\",\n          \"isCorrect\": false,\n          \"text\": \"저는 학생이에요.\",\n          \"textRomanization\": \"Jeoneun haksaeng-ieyo.\"\n        }\n      ]\n    },\n    {\n      \"context\": \"좋아요. 마지막으로, 큰 길이 나오면 횡단보도를 건너서 왼쪽으로 가세요. 그러면 정문이 보여요.\",\n      \"contextRomanization\": \"Joayo. Majimageuro, keun giri naomyeon hoengdanbodo-reul geonneoseo oenjjogeuro gaseyo. Geureomyeon jeongmun-i boyeo-yo.\",\n      \"contextTranslation\": \"Bien. Por último, cuando llegues a la avenida grande, cruza el paso de peatones y ve hacia la izquierda. Entonces verás la entrada principal.\",\n      \"options\": [\n        {\n          \"feedback\": \"\\\"횡단보도를 건너서 왼쪽으로 가면 돼요, 맞죠?\\\" - \\\"Tengo que cruzar el paso de peatones e ir a la izquierda, ¿verdad?\\\". Excelente: confirmas el último paso y reduces el riesgo de perderte.\",\n          \"isCorrect\": true,\n          \"text\": \"횡단보도를 건너서 왼쪽으로 가면 돼요, 맞죠?\",\n          \"textRomanization\": \"Hoengdanbodo-reul geonneoseo oenjjogeuro gamyeon dwaeyo, majjyo?\"\n        },\n        {\n          \"feedback\": \"\\\"횡단보도에서 멈추지 마세요.\\\" - \\\"No se detenga en el paso de peatones\\\". Suena como una instrucción rara/imperativa hacia la otra persona; no corresponde a confirmar tu ruta.\",\n          \"isCorrect\": false,\n          \"text\": \"횡단보도에서 멈추지 마세요.\",\n          \"textRomanization\": \"Hoengdanbodo-eseo meomchuji maseyo.\"\n        },\n        {\n          \"feedback\": \"\\\"왼쪽으로 오지 마세요.\\\" - \\\"No venga a la izquierda\\\". Cambia totalmente el sentido y suena como prohibición; no aplica.\",\n          \"isCorrect\": false,\n          \"text\": \"왼쪽으로 오지 마세요.\",\n          \"textRomanization\": \"Oenjjogeuro oji maseyo.\"\n        },\n        {\n          \"feedback\": \"\\\"저는 여기서 기다릴게요.\\\" - \\\"Voy a esperar aquí\\\". No avanza hacia tu destino; no es una respuesta útil a las indicaciones.\",\n          \"isCorrect\": false,\n          \"text\": \"저는 여기서 기다릴게요.\",\n          \"textRomanization\": \"Jeoneun yeogiseo gidarilgeyo.\"\n        }\n      ]\n    },\n    {\n      \"context\": \"네, 맞아요! 혹시 제가 말한 거 다시 한 번 정리해 볼래요?\",\n      \"contextRomanization\": \"Ne, majayo! Hoksi jega malhan geo dasi han beon jeongnihae bollaeyo?\",\n      \"contextTranslation\": \"¡Sí, correcto! ¿Quieres resumir una vez más lo que te dije?\",\n      \"options\": [\n        {\n          \"feedback\": \"\\\"네. 이 길로 쭉 가고, 두 번째 신호등에서 오른쪽으로 돈 다음, 큰 길에서 횡단보도를 건너 왼쪽으로 갈게요.\\\" - \\\"Sí: voy derecho, giro a la derecha en el segundo semáforo, y en la avenida cruzo y voy a la izquierda\\\". Perfecto: resumen completo y natural.\",\n          \"isCorrect\": true,\n          \"text\": \"네. 이 길로 쭉 가고, 두 번째 신호등에서 오른쪽으로 돈 다음, 큰 길에서 횡단보도를 건너 왼쪽으로 갈게요.\",\n          \"textRomanization\": \"Ne. I gillo jjukk gago, du beonjjae sinhodeung-eseo oreunjjogeuro don daeum, keun gil-eseo hoengdanbodo-reul geonneo oenjjogeuro galgeyo.\"\n        },\n        {\n          \"feedback\": \"\\\"네. 지하철을 타고 세 정거장 가요.\\\" - \\\"Sí: tomo el metro tres paradas\\\". No es lo que te indicaron (eran direcciones a pie).\",\n          \"isCorrect\": false,\n          \"text\": \"네. 지하철을 타고 세 정거장 가요.\",\n          \"textRomanization\": \"Ne. Jihacheol-eul tago se jeonggeojang gayo.\"\n        },\n        {\n          \"feedback\": \"\\\"네. 여기서 바로 왼쪽이에요.\\\" - \\\"Sí: está inmediatamente a la izquierda\\\". Reduce las instrucciones a algo incorrecto; te dijeron varios pasos.\",\n          \"isCorrect\": false,\n          \"text\": \"네. 여기서 바로 왼쪽이에요.\",\n          \"textRomanization\": \"Ne. Yeogiseo baro oenjjog-ieyo.\"\n        },\n        {\n          \"feedback\": \"\\\"죄송해요. 이해 못 했어요.\\\" - \\\"Lo siento, no entendí\\\". Es útil si de verdad no entendiste, pero aquí el objetivo era resumir lo que te dijeron.\",\n          \"isCorrect\": false,\n          \"text\": \"죄송해요. 이해 못 했어요.\",\n          \"textRomanization\": \"Joesonghaeyo. Ihae mot haesseoyo.\"\n        }\n      ]\n    },\n    {\n      \"context\": \"완벽해요. 도움이 필요하면 또 물어보세요. 좋은 하루 보내세요!\",\n      \"contextRomanization\": \"Wanbyeokhaeyo. Doumi piryohamyeon tto mureoboseyo. Joeun haru bonaeseyo!\",\n      \"contextTranslation\": \"Perfecto. Si necesitas ayuda, vuelve a preguntar. ¡Que tengas un buen día!\",\n      \"options\": [\n        {\n          \"feedback\": \"\\\"정말 감사합니다! 좋은 하루 보내세요.\\\" - \\\"¡Muchas gracias! Que tenga un buen día\\\". Cierre perfecto: agradeces y te despides con cortesía.\",\n          \"isCorrect\": true,\n          \"text\": \"정말 감사합니다! 좋은 하루 보내세요.\",\n          \"textRomanization\": \"Jeongmal gamsahamnida! Joeun haru bonaeseyo.\"\n        },\n        {\n          \"feedback\": \"\\\"아니요, 필요 없어요.\\\" - \\\"No, no lo necesito\\\". Suena cortante y no encaja con una despedida amable tras recibir ayuda.\",\n          \"isCorrect\": false,\n          \"text\": \"아니요, 필요 없어요.\",\n          \"textRomanization\": \"Aniyo, piryo eopseoyo.\"\n        },\n        {\n          \"feedback\": \"\\\"잠깐만요, 계산서 주세요.\\\" - \\\"Un momento, la cuenta por favor\\\". Eso es de restaurante; aquí estás en la calle.\",\n          \"isCorrect\": false,\n          \"text\": \"잠깐만요, 계산서 주세요.\",\n          \"textRomanization\": \"Jamkkanmanyo, gyesanseo juseyo.\"\n        },\n        {\n          \"feedback\": \"\\\"내일 다시 올게요.\\\" - \\\"Volveré mañana\\\". No es una despedida típica en este contexto y no responde a la amabilidad del cierre.\",\n          \"isCorrect\": false,\n          \"text\": \"내일 다시 올게요.\",\n          \"textRomanization\": \"Naeil dasi olgeyo.\"\n        }\n      ]\n    }\n  ]\n}",
      "outputTokens": 3361,
      "systemPrompt": "# Role\n\nYou are an expert language immersion designer specializing in creating realistic, dialogue-driven scenarios that help learners practice language production in authentic contexts. You design experiences that simulate situations learners would encounter when living or traveling in a country where the target language is spoken.\n\n# Goal\n\nCreate an immersive story activity where learners are placed in an everyday situation and must choose appropriate phrases to communicate. The activity simulates real conversations with native speakers, forcing learners to engage with the target language directly rather than relying on translations.\n\nThe activity places learners in a specific scenario (ordering food, asking for directions, checking into a hotel) and guides them through a dialogue where they must select appropriate responses at each step.\n\n# Key Design Principles\n\n## Immersion Over Translation\n\nUnlike other activities where translations help comprehension, this activity intentionally withholds translations from the options. Learners see:\n\n- **Context**: What the native speaker says (in TARGET language with translation)\n- **Options**: Four possible responses (in TARGET language ONLY - no translations)\n\nThis forces learners to:\n\n1. Engage with the target language sounds and patterns\n2. Use context clues to infer meaning\n3. Build recognition before relying on translations\n4. Experience the \"productive uncertainty\" of real conversations\n\nThe translation appears only in the feedback AFTER selection, revealing whether they understood correctly.\n\n## Authentic Scenarios\n\nFocus on situations learners will actually encounter:\n\n| Category       | Example Scenarios                                  |\n| -------------- | -------------------------------------------------- |\n| Food & Dining  | Ordering at a restaurant, asking about ingredients |\n| Transportation | Buying train tickets, asking for directions        |\n| Shopping       | Bargaining at a market, returning an item          |\n| Accommodation  | Checking into a hotel, reporting a problem         |\n| Healthcare     | Describing symptoms at a pharmacy, doctor's visit  |\n| Social         | Meeting neighbors, small talk at a cafe            |\n| Services       | Opening a bank account, getting a phone plan       |\n| Emergencies    | Reporting lost items, asking for help              |\n\n## Supportive Native Speaker\n\nThe character in the story is a friendly native speaker who:\n\n- Speaks naturally but not too fast\n- Helps the learner when they struggle\n- Provides context clues in their responses\n- Never mocks mistakes\n- Gradually introduces more complex language\n\n# Language Handling\n\n## Input Variables\n\n- **TARGET_LANGUAGE**: The language being learned (from `courseTitle`). All dialogue and options are in this language.\n- **NATIVE_LANGUAGE**: The learner's native language (from `language` code). Questions, feedback, and context translations use this language.\n\n## Language Codes\n\n- `en`: US English\n- `pt`: Brazilian Portuguese\n- `es`: Latin American Spanish\n\n## What Appears in Each Language\n\n| Field                        | Language     | Example (Spanish course, English native)                  |\n| ---------------------------- | ------------ | --------------------------------------------------------- |\n| `scenario`                   | NATIVE       | \"You're at a cafe in Madrid and want to order coffee.\"    |\n| `context`                    | TARGET       | \"Buenos dias, que le pongo?\"                              |\n| `contextTranslation`         | NATIVE       | \"Good morning, what can I get you?\"                       |\n| `contextRomanization`        | Romanization | \"\" (empty for Roman scripts)                              |\n| `options[].text`             | TARGET       | \"Un cafe con leche, por favor.\"                           |\n| `options[].textRomanization` | Romanization | \"\" (empty for Roman scripts)                              |\n| `options[].feedback`         | NATIVE       | \"A coffee with milk, please - Perfect! Polite and clear.\" |\n\n# Options Design\n\n## No Translations in Options\n\nThis is the most critical design decision. Options show ONLY:\n\n- `text`: The phrase in TARGET language\n- `textRomanization`: Romanization for non-Roman scripts (empty string for Roman scripts)\n\n**NO translation is shown**. This forces the learner to:\n\n1. Parse the target language directly\n2. Use patterns they've learned\n3. Make educated guesses based on context\n4. Experience the productive struggle of real communication\n\n## Option Quality\n\nAll 4 options must be:\n\n- **Grammatically correct** in the target language\n- **Contextually plausible** (something a learner might say in this situation)\n- **Distinct in meaning** (not just word variations)\n- **Level-appropriate** (using vocabulary/structures the learner knows)\n\n## Distractor Design\n\n**CRITICAL**: Wrong options must be genuinely inappropriate for the situation - they should lead to miscommunication or confusion if used. Do NOT create distractors that are merely \"less polished\" versions of the correct answer.\n\nWrong options should be **clearly wrong** because they:\n\n1. **Answer a different question**: Respond to something the speaker didn't ask (asking about price when asked about quantity)\n2. **Request the wrong thing**: Order/ask for something different than intended (one-way ticket when you need round-trip)\n3. **Are off-topic**: Say something unrelated to the current conversation point (asking for the check when you just arrived)\n4. **Would cause confusion**: Use words that change the meaning entirely (saying \"no\" when you mean \"yes\")\n\n**DO NOT** create distractors that are:\n\n- Just more/less formal versions of the correct answer\n- Slightly different phrasings that would still work\n- Grammatically awkward but still understandable\n\n# Feedback Design\n\nFeedback appears AFTER the learner selects an option. Every feedback message MUST include:\n\n1. **Translation**: What the option actually means in the native language\n2. **Explanation**: Why this choice is correct or incorrect for the situation\n\n## Feedback Structure\n\nFor **correct** options:\n\n```\n\"[Translation of what they said] - [Why this works in context]\"\n```\n\nExample: \"A coffee with milk, please - Perfect! This is polite and clearly communicates what you want.\"\n\nFor **incorrect** options:\n\n```\n\"[Translation of what they said] - [Why this doesn't work and what would be better]\"\n```\n\nExample: \"Where is the bathroom? - You're trying to order coffee, not find the restroom. Tell the barista what you'd like to drink.\"\n\n# Romanization Requirements\n\nFor languages using non-Roman writing systems (Japanese, Chinese, Korean, Arabic, Russian, Greek, Hebrew, Thai, Hindi, etc.), provide romanization for both context and options.\n\n## Standard Systems\n\n- **Japanese**: Romaji using Hepburn romanization\n- **Chinese**: Pinyin with tone marks\n- **Korean**: Revised Romanization of Korean\n- **Russian**: ISO 9 or BGN/PCGN transliteration\n- **Arabic**: Standard romanization\n- **Greek**: Standard transliteration\n- **Thai**: Royal Thai General System\n- **Hindi**: IAST or Hunterian transliteration\n\n## Roman Scripts\n\nFor languages using Roman letters (Spanish, French, German, Portuguese, Italian, etc.), set both `contextRomanization` and `textRomanization` to empty strings `\"\"`.\n\n# Story Arc\n\nEach story should have 5-10 steps following a natural arc:\n\n## Step Progression\n\n1. **Opening** (1-2 steps): Arrive at the location, initial greeting\n2. **Building** (2-4 steps): Main interaction, making requests, clarifying\n3. **Complication** (0-2 steps): Optional challenge that adds realism\n4. **Resolution** (1-2 steps): Complete the transaction\n5. **Closing** (1 step): Thank and goodbye\n\n## Complication Ideas (Recommended)\n\nAdding a complication makes the story more realistic and teaches learners to handle unexpected situations:\n\n- **Item unavailable**: \"Sorry, we're out of that. Would you like something else?\"\n- **Misunderstanding**: \"Did you say two or twelve?\"\n- **Additional requirement**: \"I'll need to see your ID for that.\"\n- **Clarification needed**: \"Which size did you want?\"\n\n## Pacing Guidelines\n\n- Steps should feel like natural conversation beats\n- Each step presents ONE decision point\n- Context should flow naturally from the previous step\n- The native speaker's response should acknowledge what the learner said\n\n# Output Format\n\nReturn an object with this structure (abbreviated examples shown):\n\n**Non-Roman script example (Japanese):**\n\n```json\n{\n  \"scenario\": \"You're at a train station in Tokyo...\",\n  \"steps\": [\n    {\n      \"context\": \"いらっしゃいませ。どちらまで？\",\n      \"contextTranslation\": \"Welcome. Where to?\",\n      \"contextRomanization\": \"Irasshaimase. Dochira made?\",\n      \"options\": [\n        {\n          \"text\": \"京都までお願いします。\",\n          \"textRomanization\": \"Kyouto made onegaishimasu.\",\n          \"isCorrect\": true,\n          \"feedback\": \"To Kyoto, please - Perfect!\"\n        },\n        {\n          \"text\": \"京都は遠いですか？\",\n          \"textRomanization\": \"Kyouto wa tooi desu ka?\",\n          \"isCorrect\": false,\n          \"feedback\": \"Is Kyoto far? - This asks about distance, not for a ticket.\"\n        }\n      ]\n    }\n  ]\n}\n```\n\n**Roman script example (Spanish) - empty romanization fields:**\n\n```json\n{\n  \"scenario\": \"You're at a restaurant in Barcelona...\",\n  \"steps\": [\n    {\n      \"context\": \"Buenas noches. Estan listos para pedir?\",\n      \"contextTranslation\": \"Good evening. Are you ready to order?\",\n      \"contextRomanization\": \"\",\n      \"options\": [\n        {\n          \"text\": \"Si, me gustaria la paella, por favor.\",\n          \"textRomanization\": \"\",\n          \"isCorrect\": true,\n          \"feedback\": \"Yes, I would like the paella, please - Perfect!\"\n        },\n        {\n          \"text\": \"La cuenta, por favor.\",\n          \"textRomanization\": \"\",\n          \"isCorrect\": false,\n          \"feedback\": \"The check, please - You haven't eaten yet!\"\n        }\n      ]\n    }\n  ]\n}\n```\n\nNote: Examples above are abbreviated. Actual output must have 4 options per step and 5-10 steps total.\n\n# Quality Checklist\n\nBefore finalizing, verify:\n\n1. **Grammar accuracy**: All target language text is grammatically correct\n2. **Natural dialogue**: Conversations flow like real interactions\n3. **Appropriate register**: Formality matches the situation (casual cafe vs formal office)\n4. **Cultural accuracy**: Interactions reflect how things work in that culture\n5. **Clear progression**: Steps follow a logical narrative arc\n6. **Distinct options**: Each option represents a meaningfully different choice\n7. **Helpful feedback**: Translations and explanations clarify meaning and context\n8. **Correct romanization**: Follows standard systems for non-Roman scripts, empty for Roman scripts\n9. **Scenario relevance**: The story matches the lesson topic\n10. **Appropriate difficulty**: Language complexity matches learner level\n\n# Common Mistakes to Avoid\n\n1. **Including translations in options**: Options must show TARGET language only\n2. **Trivial distractors**: Options that are obviously wrong or nonsensical\n3. **Inconsistent register**: Mixing formal and informal inappropriately\n4. **Unnatural responses**: Things a native speaker would never actually say\n5. **Missing romanization**: Forgetting to add romanization for non-Roman scripts\n6. **Adding romanization to Roman scripts**: Spanish, French, etc. should have empty strings\n7. **Feedback without translation**: Always include what the option means\n8. **Disconnected steps**: Each step should follow logically from the previous one\n",
      "testCaseId": "es-korean-asking-directions-1",
      "userPrompt": "TARGET_LANGUAGE: Korean\nNATIVE_LANGUAGE: es\nCHAPTER_TITLE: Transporte y Direcciones\nLESSON_TITLE: Pidiendo Direcciones\nLESSON_DESCRIPTION: Como pedir direcciones y entender indicaciones basicas en coreano\n\nGenerate an immersive dialogue-driven story activity for this language lesson. Create a realistic everyday scenario where learners practice language production in situations they'd face in a foreign country."
    },
    {
      "duration": 35338.439417000016,
      "inputTokens": 2650,
      "output": "{\n  \"scenario\": \"You're traveling in Spain and walk into a neighborhood pharmacy because you’re feeling sick. You need to explain your symptoms, ask for something appropriate, clarify dosage, and pay.\",\n  \"steps\": [\n    {\n      \"context\": \"Hola, buenos días. ¿En qué puedo ayudarte?\",\n      \"contextRomanization\": \"\",\n      \"contextTranslation\": \"Hi, good morning. How can I help you?\",\n      \"options\": [\n        {\n          \"feedback\": \"\\\"Me duele mucho la garganta y tengo tos.\\\" - Correct. You immediately describe your symptoms (sore throat and cough), which is exactly what the pharmacist needs to recommend something.\",\n          \"isCorrect\": true,\n          \"text\": \"Me duele mucho la garganta y tengo tos.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"\\\"Quisiera una mesa para dos, por favor.\\\" - Incorrect. You’re at a pharmacy, not a restaurant. You should explain what’s wrong or what you need.\",\n          \"isCorrect\": false,\n          \"text\": \"Quisiera una mesa para dos, por favor.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"\\\"¿Dónde está la estación de tren?\\\" - Incorrect. This asks for directions to the train station, not help with a health issue.\",\n          \"isCorrect\": false,\n          \"text\": \"¿Dónde está la estación de tren?\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"\\\"Solo estoy mirando, gracias.\\\" - Incorrect for this moment. It means “I’m just looking,” which doesn’t tell them why you came in. Describe your symptoms instead.\",\n          \"isCorrect\": false,\n          \"text\": \"Solo estoy mirando, gracias.\",\n          \"textRomanization\": \"\"\n        }\n      ]\n    },\n    {\n      \"context\": \"Entiendo. ¿Tienes fiebre o dolor de cabeza también?\",\n      \"contextRomanization\": \"\",\n      \"contextTranslation\": \"I understand. Do you have a fever or a headache too?\",\n      \"options\": [\n        {\n          \"feedback\": \"\\\"Sí, tengo un poco de fiebre, pero no me duele la cabeza.\\\" - Correct. You answer both parts clearly: some fever, no headache.\",\n          \"isCorrect\": true,\n          \"text\": \"Sí, tengo un poco de fiebre, pero no me duele la cabeza.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"\\\"No, gracias. Ya comí.\\\" - Incorrect. This sounds like you’re refusing food, not answering about fever or headache.\",\n          \"isCorrect\": false,\n          \"text\": \"No, gracias. Ya comí.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"\\\"¿Cuánto cuesta esta crema?\\\" - Incorrect. You’re switching topics to price of a cream, not answering the pharmacist’s question.\",\n          \"isCorrect\": false,\n          \"text\": \"¿Cuánto cuesta esta crema?\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"\\\"Vengo mañana a las ocho.\\\" - Incorrect. You’re talking about coming tomorrow, not describing symptoms.\",\n          \"isCorrect\": false,\n          \"text\": \"Vengo mañana a las ocho.\",\n          \"textRomanization\": \"\"\n        }\n      ]\n    },\n    {\n      \"context\": \"¿Desde cuándo tienes estos síntomas?\",\n      \"contextRomanization\": \"\",\n      \"contextTranslation\": \"Since when have you had these symptoms?\",\n      \"options\": [\n        {\n          \"feedback\": \"\\\"Desde hace dos días.\\\" - Correct. This is the natural, concise way to say you’ve had them for two days.\",\n          \"isCorrect\": true,\n          \"text\": \"Desde hace dos días.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"\\\"Para llevar, por favor.\\\" - Incorrect. This is used for takeout food, not for talking about symptoms.\",\n          \"isCorrect\": false,\n          \"text\": \"Para llevar, por favor.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"\\\"Estoy de vacaciones en Valencia.\\\" - Incorrect. That’s extra background and doesn’t answer “since when.”\",\n          \"isCorrect\": false,\n          \"text\": \"Estoy de vacaciones en Valencia.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"\\\"No lo sé, ¿dónde está el baño?\\\" - Incorrect. You’re changing the topic to finding the bathroom.\",\n          \"isCorrect\": false,\n          \"text\": \"No lo sé, ¿dónde está el baño?\",\n          \"textRomanization\": \"\"\n        }\n      ]\n    },\n    {\n      \"context\": \"¿Eres alérgico/a a algún medicamento?\",\n      \"contextRomanization\": \"\",\n      \"contextTranslation\": \"Are you allergic to any medication?\",\n      \"options\": [\n        {\n          \"feedback\": \"\\\"Que yo sepa, no.\\\" - Correct. It means “Not that I know of,” a common and appropriate answer.\",\n          \"isCorrect\": true,\n          \"text\": \"Que yo sepa, no.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"\\\"Sí, soy de Estados Unidos.\\\" - Incorrect. That answers where you’re from, not whether you have allergies.\",\n          \"isCorrect\": false,\n          \"text\": \"Sí, soy de Estados Unidos.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"\\\"Necesito una receta del médico.\\\" - Incorrect. That says you need a prescription, but the pharmacist asked about allergies.\",\n          \"isCorrect\": false,\n          \"text\": \"Necesito una receta del médico.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"\\\"Prefiero pagar con tarjeta.\\\" - Incorrect. That’s about payment, not allergies.\",\n          \"isCorrect\": false,\n          \"text\": \"Prefiero pagar con tarjeta.\",\n          \"textRomanization\": \"\"\n        }\n      ]\n    },\n    {\n      \"context\": \"Para la garganta, te recomiendo estas pastillas. Para la fiebre, paracetamol. ¿Prefieres pastillas o jarabe para la tos?\",\n      \"contextRomanization\": \"\",\n      \"contextTranslation\": \"For your throat, I recommend these lozenges. For the fever, paracetamol. Do you prefer pills or syrup for the cough?\",\n      \"options\": [\n        {\n          \"feedback\": \"\\\"Prefiero jarabe, por favor.\\\" - Correct. You clearly choose syrup, which answers the question directly.\",\n          \"isCorrect\": true,\n          \"text\": \"Prefiero jarabe, por favor.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"\\\"No, no tengo tos.\\\" - Incorrect. Earlier you said you have a cough; this contradicts your symptoms and confuses the recommendation.\",\n          \"isCorrect\": false,\n          \"text\": \"No, no tengo tos.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"\\\"Quiero cambiar dinero.\\\" - Incorrect. That’s about currency exchange, unrelated to medicine.\",\n          \"isCorrect\": false,\n          \"text\": \"Quiero cambiar dinero.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"\\\"Dame dos billetes para Sevilla.\\\" - Incorrect. That’s buying tickets, not choosing a medicine format.\",\n          \"isCorrect\": false,\n          \"text\": \"Dame dos billetes para Sevilla.\",\n          \"textRomanization\": \"\"\n        }\n      ]\n    },\n    {\n      \"context\": \"De acuerdo. ¿Quieres algo con descongestionante también, o solo para la tos?\",\n      \"contextRomanization\": \"\",\n      \"contextTranslation\": \"Alright. Do you also want something with a decongestant, or only for the cough?\",\n      \"options\": [\n        {\n          \"feedback\": \"\\\"Solo para la tos, por ahora.\\\" - Correct. You choose “only for the cough for now,” which is a realistic decision.\",\n          \"isCorrect\": true,\n          \"text\": \"Solo para la tos, por ahora.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"\\\"Sí, necesito una radiografía.\\\" - Incorrect. A pharmacy can’t provide an X-ray; this doesn’t fit the situation.\",\n          \"isCorrect\": false,\n          \"text\": \"Sí, necesito una radiografía.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"\\\"Estoy buscando una camisa.\\\" - Incorrect. That’s shopping for clothing, not medicine.\",\n          \"isCorrect\": false,\n          \"text\": \"Estoy buscando una camisa.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"\\\"¿A qué hora sale el próximo autobús?\\\" - Incorrect. You’re asking about buses, not medication.\",\n          \"isCorrect\": false,\n          \"text\": \"¿A qué hora sale el próximo autobús?\",\n          \"textRomanization\": \"\"\n        }\n      ]\n    },\n    {\n      \"context\": \"Perfecto. Para el paracetamol: ¿de 500 mg o de 1 g?\",\n      \"contextRomanization\": \"\",\n      \"contextTranslation\": \"Perfect. For the paracetamol: 500 mg or 1 g?\",\n      \"options\": [\n        {\n          \"feedback\": \"\\\"De 500 mg, por favor.\\\" - Correct. You choose a dose size clearly and politely.\",\n          \"isCorrect\": true,\n          \"text\": \"De 500 mg, por favor.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"\\\"Una botella de agua, por favor.\\\" - Incorrect. That’s ordering water, not choosing a dosage.\",\n          \"isCorrect\": false,\n          \"text\": \"Una botella de agua, por favor.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"\\\"No entiendo francés.\\\" - Incorrect. The conversation is in Spanish; this doesn’t answer the dosage question.\",\n          \"isCorrect\": false,\n          \"text\": \"No entiendo francés.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"\\\"Estoy mejor, gracias.\\\" - Incorrect. Even if you feel better, you still haven’t answered which dosage you want.\",\n          \"isCorrect\": false,\n          \"text\": \"Estoy mejor, gracias.\",\n          \"textRomanization\": \"\"\n        }\n      ]\n    },\n    {\n      \"context\": \"¿Sabes cómo tomarlo, o te explico la dosis?\",\n      \"contextRomanization\": \"\",\n      \"contextTranslation\": \"Do you know how to take it, or should I explain the dosage?\",\n      \"options\": [\n        {\n          \"feedback\": \"\\\"¿Me puede explicar la dosis, por favor?\\\" - Correct. You politely ask for dosage instructions, which is important and natural at a pharmacy.\",\n          \"isCorrect\": true,\n          \"text\": \"¿Me puede explicar la dosis, por favor?\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"\\\"No, solo estoy mirando.\\\" - Incorrect. You’re actively buying medicine; you’re not just browsing.\",\n          \"isCorrect\": false,\n          \"text\": \"No, solo estoy mirando.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"\\\"Quiero devolver esto.\\\" - Incorrect. That means you want to return something, not ask about how to take it.\",\n          \"isCorrect\": false,\n          \"text\": \"Quiero devolver esto.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"\\\"¿Tiene habitaciones libres?\\\" - Incorrect. That’s for a hotel, not a pharmacy.\",\n          \"isCorrect\": false,\n          \"text\": \"¿Tiene habitaciones libres?\",\n          \"textRomanization\": \"\"\n        }\n      ]\n    },\n    {\n      \"context\": \"Claro. El paracetamol, una cada 6–8 horas, sin pasar de 3 al día. El jarabe, según el vaso dosificador. ¿Algo más?\",\n      \"contextRomanization\": \"\",\n      \"contextTranslation\": \"Sure. The paracetamol, one every 6–8 hours, not more than 3 a day. The syrup, according to the measuring cup. Anything else?\",\n      \"options\": [\n        {\n          \"feedback\": \"\\\"No, nada más. Muchas gracias.\\\" - Correct. You close the interaction politely and naturally.\",\n          \"isCorrect\": true,\n          \"text\": \"No, nada más. Muchas gracias.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"\\\"Sí, tráigame la cuenta de la cena.\\\" - Incorrect. That’s asking for a dinner bill—wrong context.\",\n          \"isCorrect\": false,\n          \"text\": \"Sí, tráigame la cuenta de la cena.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"\\\"¿Dónde puedo alquilar un coche?\\\" - Incorrect. That’s about renting a car, not pharmacy needs.\",\n          \"isCorrect\": false,\n          \"text\": \"¿Dónde puedo alquilar un coche?\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"\\\"Entonces, ¿a qué hora abren mañana los museos?\\\" - Incorrect. That’s about museums, unrelated to the purchase.\",\n          \"isCorrect\": false,\n          \"text\": \"Entonces, ¿a qué hora abren mañana los museos?\",\n          \"textRomanization\": \"\"\n        }\n      ]\n    },\n    {\n      \"context\": \"Muy bien. Son 9,80 €. ¿Pagas en efectivo o con tarjeta?\",\n      \"contextRomanization\": \"\",\n      \"contextTranslation\": \"Alright. It’s €9.80. Are you paying in cash or by card?\",\n      \"options\": [\n        {\n          \"feedback\": \"\\\"Con tarjeta, por favor.\\\" - Correct. You answer the payment method clearly and politely.\",\n          \"isCorrect\": true,\n          \"text\": \"Con tarjeta, por favor.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"\\\"Me duele el estómago.\\\" - Incorrect. You’re back to symptoms; the pharmacist is asking how you want to pay.\",\n          \"isCorrect\": false,\n          \"text\": \"Me duele el estómago.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"\\\"Necesito una cita para mañana.\\\" - Incorrect. That’s about scheduling an appointment, not paying.\",\n          \"isCorrect\": false,\n          \"text\": \"Necesito una cita para mañana.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"\\\"¿Me lo puede cambiar por una talla más?\\\" - Incorrect. That’s for changing clothing sizes, not paying for medicine.\",\n          \"isCorrect\": false,\n          \"text\": \"¿Me lo puede cambiar por una talla más?\",\n          \"textRomanization\": \"\"\n        }\n      ]\n    }\n  ]\n}",
      "outputTokens": 2482,
      "systemPrompt": "# Role\n\nYou are an expert language immersion designer specializing in creating realistic, dialogue-driven scenarios that help learners practice language production in authentic contexts. You design experiences that simulate situations learners would encounter when living or traveling in a country where the target language is spoken.\n\n# Goal\n\nCreate an immersive story activity where learners are placed in an everyday situation and must choose appropriate phrases to communicate. The activity simulates real conversations with native speakers, forcing learners to engage with the target language directly rather than relying on translations.\n\nThe activity places learners in a specific scenario (ordering food, asking for directions, checking into a hotel) and guides them through a dialogue where they must select appropriate responses at each step.\n\n# Key Design Principles\n\n## Immersion Over Translation\n\nUnlike other activities where translations help comprehension, this activity intentionally withholds translations from the options. Learners see:\n\n- **Context**: What the native speaker says (in TARGET language with translation)\n- **Options**: Four possible responses (in TARGET language ONLY - no translations)\n\nThis forces learners to:\n\n1. Engage with the target language sounds and patterns\n2. Use context clues to infer meaning\n3. Build recognition before relying on translations\n4. Experience the \"productive uncertainty\" of real conversations\n\nThe translation appears only in the feedback AFTER selection, revealing whether they understood correctly.\n\n## Authentic Scenarios\n\nFocus on situations learners will actually encounter:\n\n| Category       | Example Scenarios                                  |\n| -------------- | -------------------------------------------------- |\n| Food & Dining  | Ordering at a restaurant, asking about ingredients |\n| Transportation | Buying train tickets, asking for directions        |\n| Shopping       | Bargaining at a market, returning an item          |\n| Accommodation  | Checking into a hotel, reporting a problem         |\n| Healthcare     | Describing symptoms at a pharmacy, doctor's visit  |\n| Social         | Meeting neighbors, small talk at a cafe            |\n| Services       | Opening a bank account, getting a phone plan       |\n| Emergencies    | Reporting lost items, asking for help              |\n\n## Supportive Native Speaker\n\nThe character in the story is a friendly native speaker who:\n\n- Speaks naturally but not too fast\n- Helps the learner when they struggle\n- Provides context clues in their responses\n- Never mocks mistakes\n- Gradually introduces more complex language\n\n# Language Handling\n\n## Input Variables\n\n- **TARGET_LANGUAGE**: The language being learned (from `courseTitle`). All dialogue and options are in this language.\n- **NATIVE_LANGUAGE**: The learner's native language (from `language` code). Questions, feedback, and context translations use this language.\n\n## Language Codes\n\n- `en`: US English\n- `pt`: Brazilian Portuguese\n- `es`: Latin American Spanish\n\n## What Appears in Each Language\n\n| Field                        | Language     | Example (Spanish course, English native)                  |\n| ---------------------------- | ------------ | --------------------------------------------------------- |\n| `scenario`                   | NATIVE       | \"You're at a cafe in Madrid and want to order coffee.\"    |\n| `context`                    | TARGET       | \"Buenos dias, que le pongo?\"                              |\n| `contextTranslation`         | NATIVE       | \"Good morning, what can I get you?\"                       |\n| `contextRomanization`        | Romanization | \"\" (empty for Roman scripts)                              |\n| `options[].text`             | TARGET       | \"Un cafe con leche, por favor.\"                           |\n| `options[].textRomanization` | Romanization | \"\" (empty for Roman scripts)                              |\n| `options[].feedback`         | NATIVE       | \"A coffee with milk, please - Perfect! Polite and clear.\" |\n\n# Options Design\n\n## No Translations in Options\n\nThis is the most critical design decision. Options show ONLY:\n\n- `text`: The phrase in TARGET language\n- `textRomanization`: Romanization for non-Roman scripts (empty string for Roman scripts)\n\n**NO translation is shown**. This forces the learner to:\n\n1. Parse the target language directly\n2. Use patterns they've learned\n3. Make educated guesses based on context\n4. Experience the productive struggle of real communication\n\n## Option Quality\n\nAll 4 options must be:\n\n- **Grammatically correct** in the target language\n- **Contextually plausible** (something a learner might say in this situation)\n- **Distinct in meaning** (not just word variations)\n- **Level-appropriate** (using vocabulary/structures the learner knows)\n\n## Distractor Design\n\n**CRITICAL**: Wrong options must be genuinely inappropriate for the situation - they should lead to miscommunication or confusion if used. Do NOT create distractors that are merely \"less polished\" versions of the correct answer.\n\nWrong options should be **clearly wrong** because they:\n\n1. **Answer a different question**: Respond to something the speaker didn't ask (asking about price when asked about quantity)\n2. **Request the wrong thing**: Order/ask for something different than intended (one-way ticket when you need round-trip)\n3. **Are off-topic**: Say something unrelated to the current conversation point (asking for the check when you just arrived)\n4. **Would cause confusion**: Use words that change the meaning entirely (saying \"no\" when you mean \"yes\")\n\n**DO NOT** create distractors that are:\n\n- Just more/less formal versions of the correct answer\n- Slightly different phrasings that would still work\n- Grammatically awkward but still understandable\n\n# Feedback Design\n\nFeedback appears AFTER the learner selects an option. Every feedback message MUST include:\n\n1. **Translation**: What the option actually means in the native language\n2. **Explanation**: Why this choice is correct or incorrect for the situation\n\n## Feedback Structure\n\nFor **correct** options:\n\n```\n\"[Translation of what they said] - [Why this works in context]\"\n```\n\nExample: \"A coffee with milk, please - Perfect! This is polite and clearly communicates what you want.\"\n\nFor **incorrect** options:\n\n```\n\"[Translation of what they said] - [Why this doesn't work and what would be better]\"\n```\n\nExample: \"Where is the bathroom? - You're trying to order coffee, not find the restroom. Tell the barista what you'd like to drink.\"\n\n# Romanization Requirements\n\nFor languages using non-Roman writing systems (Japanese, Chinese, Korean, Arabic, Russian, Greek, Hebrew, Thai, Hindi, etc.), provide romanization for both context and options.\n\n## Standard Systems\n\n- **Japanese**: Romaji using Hepburn romanization\n- **Chinese**: Pinyin with tone marks\n- **Korean**: Revised Romanization of Korean\n- **Russian**: ISO 9 or BGN/PCGN transliteration\n- **Arabic**: Standard romanization\n- **Greek**: Standard transliteration\n- **Thai**: Royal Thai General System\n- **Hindi**: IAST or Hunterian transliteration\n\n## Roman Scripts\n\nFor languages using Roman letters (Spanish, French, German, Portuguese, Italian, etc.), set both `contextRomanization` and `textRomanization` to empty strings `\"\"`.\n\n# Story Arc\n\nEach story should have 5-10 steps following a natural arc:\n\n## Step Progression\n\n1. **Opening** (1-2 steps): Arrive at the location, initial greeting\n2. **Building** (2-4 steps): Main interaction, making requests, clarifying\n3. **Complication** (0-2 steps): Optional challenge that adds realism\n4. **Resolution** (1-2 steps): Complete the transaction\n5. **Closing** (1 step): Thank and goodbye\n\n## Complication Ideas (Recommended)\n\nAdding a complication makes the story more realistic and teaches learners to handle unexpected situations:\n\n- **Item unavailable**: \"Sorry, we're out of that. Would you like something else?\"\n- **Misunderstanding**: \"Did you say two or twelve?\"\n- **Additional requirement**: \"I'll need to see your ID for that.\"\n- **Clarification needed**: \"Which size did you want?\"\n\n## Pacing Guidelines\n\n- Steps should feel like natural conversation beats\n- Each step presents ONE decision point\n- Context should flow naturally from the previous step\n- The native speaker's response should acknowledge what the learner said\n\n# Output Format\n\nReturn an object with this structure (abbreviated examples shown):\n\n**Non-Roman script example (Japanese):**\n\n```json\n{\n  \"scenario\": \"You're at a train station in Tokyo...\",\n  \"steps\": [\n    {\n      \"context\": \"いらっしゃいませ。どちらまで？\",\n      \"contextTranslation\": \"Welcome. Where to?\",\n      \"contextRomanization\": \"Irasshaimase. Dochira made?\",\n      \"options\": [\n        {\n          \"text\": \"京都までお願いします。\",\n          \"textRomanization\": \"Kyouto made onegaishimasu.\",\n          \"isCorrect\": true,\n          \"feedback\": \"To Kyoto, please - Perfect!\"\n        },\n        {\n          \"text\": \"京都は遠いですか？\",\n          \"textRomanization\": \"Kyouto wa tooi desu ka?\",\n          \"isCorrect\": false,\n          \"feedback\": \"Is Kyoto far? - This asks about distance, not for a ticket.\"\n        }\n      ]\n    }\n  ]\n}\n```\n\n**Roman script example (Spanish) - empty romanization fields:**\n\n```json\n{\n  \"scenario\": \"You're at a restaurant in Barcelona...\",\n  \"steps\": [\n    {\n      \"context\": \"Buenas noches. Estan listos para pedir?\",\n      \"contextTranslation\": \"Good evening. Are you ready to order?\",\n      \"contextRomanization\": \"\",\n      \"options\": [\n        {\n          \"text\": \"Si, me gustaria la paella, por favor.\",\n          \"textRomanization\": \"\",\n          \"isCorrect\": true,\n          \"feedback\": \"Yes, I would like the paella, please - Perfect!\"\n        },\n        {\n          \"text\": \"La cuenta, por favor.\",\n          \"textRomanization\": \"\",\n          \"isCorrect\": false,\n          \"feedback\": \"The check, please - You haven't eaten yet!\"\n        }\n      ]\n    }\n  ]\n}\n```\n\nNote: Examples above are abbreviated. Actual output must have 4 options per step and 5-10 steps total.\n\n# Quality Checklist\n\nBefore finalizing, verify:\n\n1. **Grammar accuracy**: All target language text is grammatically correct\n2. **Natural dialogue**: Conversations flow like real interactions\n3. **Appropriate register**: Formality matches the situation (casual cafe vs formal office)\n4. **Cultural accuracy**: Interactions reflect how things work in that culture\n5. **Clear progression**: Steps follow a logical narrative arc\n6. **Distinct options**: Each option represents a meaningfully different choice\n7. **Helpful feedback**: Translations and explanations clarify meaning and context\n8. **Correct romanization**: Follows standard systems for non-Roman scripts, empty for Roman scripts\n9. **Scenario relevance**: The story matches the lesson topic\n10. **Appropriate difficulty**: Language complexity matches learner level\n\n# Common Mistakes to Avoid\n\n1. **Including translations in options**: Options must show TARGET language only\n2. **Trivial distractors**: Options that are obviously wrong or nonsensical\n3. **Inconsistent register**: Mixing formal and informal inappropriately\n4. **Unnatural responses**: Things a native speaker would never actually say\n5. **Missing romanization**: Forgetting to add romanization for non-Roman scripts\n6. **Adding romanization to Roman scripts**: Spanish, French, etc. should have empty strings\n7. **Feedback without translation**: Always include what the option means\n8. **Disconnected steps**: Each step should follow logically from the previous one\n",
      "testCaseId": "en-spanish-pharmacy-visit-1",
      "userPrompt": "TARGET_LANGUAGE: Spanish\nNATIVE_LANGUAGE: en\nCHAPTER_TITLE: Health and Wellness\nLESSON_TITLE: At the Pharmacy\nLESSON_DESCRIPTION: Learn to describe symptoms and buy medicine at a Spanish pharmacy\n\nGenerate an immersive dialogue-driven story activity for this language lesson. Create a realistic everyday scenario where learners practice language production in situations they'd face in a foreign country."
    }
  ],
  "taskId": "activity-story-language"
}
