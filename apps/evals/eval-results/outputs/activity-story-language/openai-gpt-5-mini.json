{
  "generatedAt": "2026-01-21T21:31:36.477Z",
  "modelId": "openai/gpt-5-mini",
  "outputs": [
    {
      "duration": 65462.046042,
      "inputTokens": 2657,
      "output": "{\n  \"scenario\": \"You're at a small café in Paris. Practice getting seated, ordering drinks and food, handling a small problem (item unavailable), asking for the bill, and paying.\",\n  \"steps\": [\n    {\n      \"context\": \"Bonjour ! Une table pour combien ?\",\n      \"contextRomanization\": \"\",\n      \"contextTranslation\": \"Hello! A table for how many?\",\n      \"options\": [\n        {\n          \"feedback\": \"A table for one person, please - Good. This directly answers the server's question and is polite.\",\n          \"isCorrect\": true,\n          \"text\": \"Une table pour une personne, s'il vous plaît.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"I would like to see the menu, please - The server asked how many people. Asking for the menu instead doesn't answer the question and delays seating.\",\n          \"isCorrect\": false,\n          \"text\": \"Je voudrais voir le menu, s'il vous plaît.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Where are the toilets? - This is unrelated to the server's question about number of people. You'll need to answer the original question first.\",\n          \"isCorrect\": false,\n          \"text\": \"Où sont les toilettes ?\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Two coffees, please - This orders drinks before being seated and doesn't answer how many people need the table. It may confuse the server.\",\n          \"isCorrect\": false,\n          \"text\": \"Deux cafés, s'il vous plaît.\",\n          \"textRomanization\": \"\"\n        }\n      ]\n    },\n    {\n      \"context\": \"Voici votre table. Voulez-vous quelque chose à boire tout de suite ?\",\n      \"contextRomanization\": \"\",\n      \"contextTranslation\": \"Here's your table. Would you like something to drink right away?\",\n      \"options\": [\n        {\n          \"feedback\": \"Yes, a café crème, please - Perfect. You politely order a drink right away as the server asked.\",\n          \"isCorrect\": true,\n          \"text\": \"Oui, un café crème, s'il vous plaît.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"The bill, please - You're asking for the check immediately after being seated, which doesn't answer the server's question about a drink.\",\n          \"isCorrect\": false,\n          \"text\": \"L'addition, s'il vous plaît.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"No thank you, we're in a hurry - This refuses service; it's a valid response but not the typical choice if you intend to order. It tells the server you don't want a drink.\",\n          \"isCorrect\": false,\n          \"text\": \"Non merci, nous sommes pressés.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Where is the subway? - This is unrelated to ordering a drink and would confuse the server in this context.\",\n          \"isCorrect\": false,\n          \"text\": \"Où est le métro ?\",\n          \"textRomanization\": \"\"\n        }\n      ]\n    },\n    {\n      \"context\": \"Très bien. Vous voulez aussi quelque chose à manger ?\",\n      \"contextRomanization\": \"\",\n      \"contextTranslation\": \"Very well. Would you also like something to eat?\",\n      \"options\": [\n        {\n          \"feedback\": \"Yes, a quiche lorraine, please - Perfect. You politely order a specific dish in response to the question about food.\",\n          \"isCorrect\": true,\n          \"text\": \"Oui, une quiche lorraine, s'il vous plaît.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"I'll pay in cash - This answers how you'll pay, not whether you want to eat. It doesn't respond to the server's question.\",\n          \"isCorrect\": false,\n          \"text\": \"Je paie en liquide.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"The menu, please - Asking for the menu when the server already asked if you want something to eat is reasonable, but it doesn't directly answer yes/no about ordering now.\",\n          \"isCorrect\": false,\n          \"text\": \"La carte, s'il vous plaît.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"I'm allergic to nuts - This is important information but doesn't answer whether you want to order food. If relevant, mention it when choosing a dish.\",\n          \"isCorrect\": false,\n          \"text\": \"Je suis allergique aux noix.\",\n          \"textRomanization\": \"\"\n        }\n      ]\n    },\n    {\n      \"context\": \"Désolé, il n'y a plus de quiche. Je peux vous proposer une salade ou un croissant.\",\n      \"contextRomanization\": \"\",\n      \"contextTranslation\": \"Sorry, there's no quiche left. I can offer you a salad or a croissant.\",\n      \"options\": [\n        {\n          \"feedback\": \"Okay, the salad, please - Good. You accept one of the alternatives the server offered, which resolves the availability issue.\",\n          \"isCorrect\": true,\n          \"text\": \"D'accord, la salade, s'il vous plaît.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"I want the quiche anyway - This insists on an unavailable item. It won't work because the kitchen is out; choose an offered alternative instead.\",\n          \"isCorrect\": false,\n          \"text\": \"Je veux la quiche quand même.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"What's in it? - \\\"Qu'est-ce qu'il y a dedans ?\\\" asks about ingredients. It's a reasonable clarification, but it doesn't choose one of the options the server just offered. Use it if you need ingredient info before deciding.\",\n          \"isCorrect\": false,\n          \"text\": \"Qu'est-ce qu'il y a dedans ?\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"The bill, please - Asking for the check right after the server explains availability is premature and doesn't solve the food order problem.\",\n          \"isCorrect\": false,\n          \"text\": \"L'addition, s'il vous plaît.\",\n          \"textRomanization\": \"\"\n        }\n      ]\n    },\n    {\n      \"context\": \"Très bien, je vous apporte ça tout de suite. Vous souhaitez autre chose ?\",\n      \"contextRomanization\": \"\",\n      \"contextTranslation\": \"Very well, I'll bring that right away. Would you like anything else?\",\n      \"options\": [\n        {\n          \"feedback\": \"Water, please - Good. This politely requests something additional (water) and matches the server's question.\",\n          \"isCorrect\": true,\n          \"text\": \"De l'eau, s'il vous plaît.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"No thank you, just the check - Saying you want the check right now is premature if you haven't finished; it doesn't match \\\"anything else?\\\" meaningfully.\",\n          \"isCorrect\": false,\n          \"text\": \"Non merci, juste l'addition.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Can you call a taxi? - This is off-topic in the middle of your meal. The server might help, but it doesn't answer the immediate question about ordering more items.\",\n          \"isCorrect\": false,\n          \"text\": \"Pouvez-vous appeler un taxi ?\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"I want dessert - This says you want dessert now; it's a possible response, but usually you'd ask for dessert after finishing the meal rather than when the server is bringing the main course.\",\n          \"isCorrect\": false,\n          \"text\": \"Je prends un dessert.\",\n          \"textRomanization\": \"\"\n        }\n      ]\n    },\n    {\n      \"context\": \"Avez-vous terminé ? Voulez-vous l'addition ?\",\n      \"contextRomanization\": \"\",\n      \"contextTranslation\": \"Have you finished? Would you like the bill?\",\n      \"options\": [\n        {\n          \"feedback\": \"Yes, the bill please - Perfect. This clearly tells the server you're ready to pay.\",\n          \"isCorrect\": true,\n          \"text\": \"Oui, l'addition, s'il vous plaît.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"No, we're staying a bit longer - This tells the server you are not ready for the bill. It's a valid response if you want to keep sitting, but it doesn't request payment.\",\n          \"isCorrect\": false,\n          \"text\": \"Non, nous restons encore.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Where is the train station? - Off-topic. The server asked about the bill; asking for directions now will cause confusion.\",\n          \"isCorrect\": false,\n          \"text\": \"Où est la gare ?\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Thank you, it was delicious - This is a polite comment but doesn't say whether you want the bill. The server asked a direct question about the check.\",\n          \"isCorrect\": false,\n          \"text\": \"Merci, c'était délicieux.\",\n          \"textRomanization\": \"\"\n        }\n      ]\n    },\n    {\n      \"context\": \"C'est 18 euros. Vous payez en espèces ou par carte ?\",\n      \"contextRomanization\": \"\",\n      \"contextTranslation\": \"That's 18 euros. Will you pay in cash or by card?\",\n      \"options\": [\n        {\n          \"feedback\": \"By card, please - Perfect. This answers the server's payment question and lets them proceed.\",\n          \"isCorrect\": true,\n          \"text\": \"Par carte, s'il vous plaît.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"I'd like to split the bill - Splitting is a different request; if you're alone this doesn't apply. If you are with others, say how you'd like it split instead of answering cash or card.\",\n          \"isCorrect\": false,\n          \"text\": \"Je voudrais partager la note.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"I have no money - This creates a real problem and doesn't answer the server's question about how you plan to pay. If true, explain the situation politely.\",\n          \"isCorrect\": false,\n          \"text\": \"Je n'ai pas d'argent.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Keep the change! - This is something you might say after paying and leaving a tip; it doesn't answer whether you'll pay cash or card.\",\n          \"isCorrect\": false,\n          \"text\": \"Gardez la monnaie !\",\n          \"textRomanization\": \"\"\n        }\n      ]\n    },\n    {\n      \"context\": \"Merci, bonne journée !\",\n      \"contextRomanization\": \"\",\n      \"contextTranslation\": \"Thank you, have a nice day!\",\n      \"options\": [\n        {\n          \"feedback\": \"Thank you, have a nice day! - Perfect. A polite, natural way to say goodbye in return.\",\n          \"isCorrect\": true,\n          \"text\": \"Merci, bonne journée !\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Goodbye, I'll come back tomorrow - This is friendly but implies a promise to return; it's fine socially but not the simplest closing reply.\",\n          \"isCorrect\": false,\n          \"text\": \"Au revoir, je reviens demain.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"I didn't like the service - This is rude and unexpected as a closing; if you have a complaint, it's better to mention it politely before leaving.\",\n          \"isCorrect\": false,\n          \"text\": \"Je n'ai pas aimé le service.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Can you refund me? - Asking for a refund at the final goodbye is abrupt. If there's a real issue with your order, state it clearly earlier and ask politely for a solution.\",\n          \"isCorrect\": false,\n          \"text\": \"Pouvez-vous me rembourser ?\",\n          \"textRomanization\": \"\"\n        }\n      ]\n    }\n  ]\n}",
      "outputTokens": 4091,
      "systemPrompt": "# Role\n\nYou are an expert language immersion designer specializing in creating realistic, dialogue-driven scenarios that help learners practice language production in authentic contexts. You design experiences that simulate situations learners would encounter when living or traveling in a country where the target language is spoken.\n\n# Goal\n\nCreate an immersive story activity where learners are placed in an everyday situation and must choose appropriate phrases to communicate. The activity simulates real conversations with native speakers, forcing learners to engage with the target language directly rather than relying on translations.\n\nThe activity places learners in a specific scenario (ordering food, asking for directions, checking into a hotel) and guides them through a dialogue where they must select appropriate responses at each step.\n\n# Key Design Principles\n\n## Immersion Over Translation\n\nUnlike other activities where translations help comprehension, this activity intentionally withholds translations from the options. Learners see:\n\n- **Context**: What the native speaker says (in TARGET language with translation)\n- **Options**: Four possible responses (in TARGET language ONLY - no translations)\n\nThis forces learners to:\n\n1. Engage with the target language sounds and patterns\n2. Use context clues to infer meaning\n3. Build recognition before relying on translations\n4. Experience the \"productive uncertainty\" of real conversations\n\nThe translation appears only in the feedback AFTER selection, revealing whether they understood correctly.\n\n## Authentic Scenarios\n\nFocus on situations learners will actually encounter:\n\n| Category       | Example Scenarios                                  |\n| -------------- | -------------------------------------------------- |\n| Food & Dining  | Ordering at a restaurant, asking about ingredients |\n| Transportation | Buying train tickets, asking for directions        |\n| Shopping       | Bargaining at a market, returning an item          |\n| Accommodation  | Checking into a hotel, reporting a problem         |\n| Healthcare     | Describing symptoms at a pharmacy, doctor's visit  |\n| Social         | Meeting neighbors, small talk at a cafe            |\n| Services       | Opening a bank account, getting a phone plan       |\n| Emergencies    | Reporting lost items, asking for help              |\n\n## Supportive Native Speaker\n\nThe character in the story is a friendly native speaker who:\n\n- Speaks naturally but not too fast\n- Helps the learner when they struggle\n- Provides context clues in their responses\n- Never mocks mistakes\n- Gradually introduces more complex language\n\n# Language Handling\n\n## Input Variables\n\n- **TARGET_LANGUAGE**: The language being learned (from `courseTitle`). All dialogue and options are in this language.\n- **NATIVE_LANGUAGE**: The learner's native language (from `language` code). Questions, feedback, and context translations use this language.\n\n## Language Codes\n\n- `en`: US English\n- `pt`: Brazilian Portuguese\n- `es`: Latin American Spanish\n\n## What Appears in Each Language\n\n| Field                        | Language     | Example (Spanish course, English native)                  |\n| ---------------------------- | ------------ | --------------------------------------------------------- |\n| `scenario`                   | NATIVE       | \"You're at a cafe in Madrid and want to order coffee.\"    |\n| `context`                    | TARGET       | \"Buenos dias, que le pongo?\"                              |\n| `contextTranslation`         | NATIVE       | \"Good morning, what can I get you?\"                       |\n| `contextRomanization`        | Romanization | \"\" (empty for Roman scripts)                              |\n| `options[].text`             | TARGET       | \"Un cafe con leche, por favor.\"                           |\n| `options[].textRomanization` | Romanization | \"\" (empty for Roman scripts)                              |\n| `options[].feedback`         | NATIVE       | \"A coffee with milk, please - Perfect! Polite and clear.\" |\n\n# Options Design\n\n## No Translations in Options\n\nThis is the most critical design decision. Options show ONLY:\n\n- `text`: The phrase in TARGET language\n- `textRomanization`: Romanization for non-Roman scripts (empty string for Roman scripts)\n\n**NO translation is shown**. This forces the learner to:\n\n1. Parse the target language directly\n2. Use patterns they've learned\n3. Make educated guesses based on context\n4. Experience the productive struggle of real communication\n\n## Option Quality\n\nAll 4 options must be:\n\n- **Grammatically correct** in the target language\n- **Contextually plausible** (something a learner might say in this situation)\n- **Distinct in meaning** (not just word variations)\n- **Level-appropriate** (using vocabulary/structures the learner knows)\n\n## Distractor Design\n\n**CRITICAL**: Wrong options must be genuinely inappropriate for the situation - they should lead to miscommunication or confusion if used. Do NOT create distractors that are merely \"less polished\" versions of the correct answer.\n\nWrong options should be **clearly wrong** because they:\n\n1. **Answer a different question**: Respond to something the speaker didn't ask (asking about price when asked about quantity)\n2. **Request the wrong thing**: Order/ask for something different than intended (one-way ticket when you need round-trip)\n3. **Are off-topic**: Say something unrelated to the current conversation point (asking for the check when you just arrived)\n4. **Would cause confusion**: Use words that change the meaning entirely (saying \"no\" when you mean \"yes\")\n\n**DO NOT** create distractors that are:\n\n- Just more/less formal versions of the correct answer\n- Slightly different phrasings that would still work\n- Grammatically awkward but still understandable\n\n# Feedback Design\n\nFeedback appears AFTER the learner selects an option. Every feedback message MUST include:\n\n1. **Translation**: What the option actually means in the native language\n2. **Explanation**: Why this choice is correct or incorrect for the situation\n\n## Feedback Structure\n\nFor **correct** options:\n\n```\n\"[Translation of what they said] - [Why this works in context]\"\n```\n\nExample: \"A coffee with milk, please - Perfect! This is polite and clearly communicates what you want.\"\n\nFor **incorrect** options:\n\n```\n\"[Translation of what they said] - [Why this doesn't work and what would be better]\"\n```\n\nExample: \"Where is the bathroom? - You're trying to order coffee, not find the restroom. Tell the barista what you'd like to drink.\"\n\n# Romanization Requirements\n\nFor languages using non-Roman writing systems (Japanese, Chinese, Korean, Arabic, Russian, Greek, Hebrew, Thai, Hindi, etc.), provide romanization for both context and options.\n\n## Standard Systems\n\n- **Japanese**: Romaji using Hepburn romanization\n- **Chinese**: Pinyin with tone marks\n- **Korean**: Revised Romanization of Korean\n- **Russian**: ISO 9 or BGN/PCGN transliteration\n- **Arabic**: Standard romanization\n- **Greek**: Standard transliteration\n- **Thai**: Royal Thai General System\n- **Hindi**: IAST or Hunterian transliteration\n\n## Roman Scripts\n\nFor languages using Roman letters (Spanish, French, German, Portuguese, Italian, etc.), set both `contextRomanization` and `textRomanization` to empty strings `\"\"`.\n\n# Story Arc\n\nEach story should have 5-10 steps following a natural arc:\n\n## Step Progression\n\n1. **Opening** (1-2 steps): Arrive at the location, initial greeting\n2. **Building** (2-4 steps): Main interaction, making requests, clarifying\n3. **Complication** (0-2 steps): Optional challenge that adds realism\n4. **Resolution** (1-2 steps): Complete the transaction\n5. **Closing** (1 step): Thank and goodbye\n\n## Complication Ideas (Recommended)\n\nAdding a complication makes the story more realistic and teaches learners to handle unexpected situations:\n\n- **Item unavailable**: \"Sorry, we're out of that. Would you like something else?\"\n- **Misunderstanding**: \"Did you say two or twelve?\"\n- **Additional requirement**: \"I'll need to see your ID for that.\"\n- **Clarification needed**: \"Which size did you want?\"\n\n## Pacing Guidelines\n\n- Steps should feel like natural conversation beats\n- Each step presents ONE decision point\n- Context should flow naturally from the previous step\n- The native speaker's response should acknowledge what the learner said\n\n# Output Format\n\nReturn an object with this structure (abbreviated examples shown):\n\n**Non-Roman script example (Japanese):**\n\n```json\n{\n  \"scenario\": \"You're at a train station in Tokyo...\",\n  \"steps\": [\n    {\n      \"context\": \"いらっしゃいませ。どちらまで？\",\n      \"contextTranslation\": \"Welcome. Where to?\",\n      \"contextRomanization\": \"Irasshaimase. Dochira made?\",\n      \"options\": [\n        {\n          \"text\": \"京都までお願いします。\",\n          \"textRomanization\": \"Kyouto made onegaishimasu.\",\n          \"isCorrect\": true,\n          \"feedback\": \"To Kyoto, please - Perfect!\"\n        },\n        {\n          \"text\": \"京都は遠いですか？\",\n          \"textRomanization\": \"Kyouto wa tooi desu ka?\",\n          \"isCorrect\": false,\n          \"feedback\": \"Is Kyoto far? - This asks about distance, not for a ticket.\"\n        }\n      ]\n    }\n  ]\n}\n```\n\n**Roman script example (Spanish) - empty romanization fields:**\n\n```json\n{\n  \"scenario\": \"You're at a restaurant in Barcelona...\",\n  \"steps\": [\n    {\n      \"context\": \"Buenas noches. Estan listos para pedir?\",\n      \"contextTranslation\": \"Good evening. Are you ready to order?\",\n      \"contextRomanization\": \"\",\n      \"options\": [\n        {\n          \"text\": \"Si, me gustaria la paella, por favor.\",\n          \"textRomanization\": \"\",\n          \"isCorrect\": true,\n          \"feedback\": \"Yes, I would like the paella, please - Perfect!\"\n        },\n        {\n          \"text\": \"La cuenta, por favor.\",\n          \"textRomanization\": \"\",\n          \"isCorrect\": false,\n          \"feedback\": \"The check, please - You haven't eaten yet!\"\n        }\n      ]\n    }\n  ]\n}\n```\n\nNote: Examples above are abbreviated. Actual output must have 4 options per step and 5-10 steps total.\n\n# Quality Checklist\n\nBefore finalizing, verify:\n\n1. **Grammar accuracy**: All target language text is grammatically correct\n2. **Natural dialogue**: Conversations flow like real interactions\n3. **Appropriate register**: Formality matches the situation (casual cafe vs formal office)\n4. **Cultural accuracy**: Interactions reflect how things work in that culture\n5. **Clear progression**: Steps follow a logical narrative arc\n6. **Distinct options**: Each option represents a meaningfully different choice\n7. **Helpful feedback**: Translations and explanations clarify meaning and context\n8. **Correct romanization**: Follows standard systems for non-Roman scripts, empty for Roman scripts\n9. **Scenario relevance**: The story matches the lesson topic\n10. **Appropriate difficulty**: Language complexity matches learner level\n\n# Common Mistakes to Avoid\n\n1. **Including translations in options**: Options must show TARGET language only\n2. **Trivial distractors**: Options that are obviously wrong or nonsensical\n3. **Inconsistent register**: Mixing formal and informal inappropriately\n4. **Unnatural responses**: Things a native speaker would never actually say\n5. **Missing romanization**: Forgetting to add romanization for non-Roman scripts\n6. **Adding romanization to Roman scripts**: Spanish, French, etc. should have empty strings\n7. **Feedback without translation**: Always include what the option means\n8. **Disconnected steps**: Each step should follow logically from the previous one\n",
      "testCaseId": "en-french-cafe-ordering-1",
      "userPrompt": "TARGET_LANGUAGE: French\nNATIVE_LANGUAGE: en\nCHAPTER_TITLE: At the Cafe\nLESSON_TITLE: Ordering at a Cafe\nLESSON_DESCRIPTION: Practice ordering drinks and food at a French cafe, including asking for the menu and paying\n\nGenerate an immersive dialogue-driven story activity for this language lesson. Create a realistic everyday scenario where learners practice language production in situations they'd face in a foreign country."
    },
    {
      "duration": 119568.70754100001,
      "inputTokens": 2654,
      "output": "{\n  \"scenario\": \"You're checking into a hotel in Japan. Practice confirming your reservation, answering the receptionist's questions, handling a room change, and asking about amenities.\",\n  \"steps\": [\n    {\n      \"context\": \"いらっしゃいませ。ご予約のお名前をお願いします。\",\n      \"contextRomanization\": \"Irasshaimase. Go-yoyaku no onamae o onegaishimasu.\",\n      \"contextTranslation\": \"Welcome. Under what name is the reservation?\",\n      \"options\": [\n        {\n          \"feedback\": \"I have a reservation under Smith. I'm John Smith. - Perfect. You gave the reservation name clearly and introduced yourself, which is exactly what the receptionist asked for.\",\n          \"isCorrect\": true,\n          \"text\": \"スミスで予約しています。ジョン・スミスです。\",\n          \"textRomanization\": \"Sumisu de yoyaku shiteimasu. Jon Sumisu desu.\"\n        },\n        {\n          \"feedback\": \"No, I don't have a reservation. - This says you don't have a reservation. If you actually have one, this will confuse the receptionist; only use this if you truly have no booking.\",\n          \"isCorrect\": false,\n          \"text\": \"いいえ、予約していません。\",\n          \"textRomanization\": \"Iie, yoyaku shiteimasen.\"\n        },\n        {\n          \"feedback\": \"Where can I eat lunch? - This is off-topic. The receptionist asked for the reservation name; asking about lunch will not help check-in.\",\n          \"isCorrect\": false,\n          \"text\": \"どこで昼食を食べられますか？\",\n          \"textRomanization\": \"Doko de chūshoku o taberaremasu ka?\"\n        },\n        {\n          \"feedback\": \"My reservation number is 12345. - Giving the reservation number can be helpful, but the receptionist asked specifically for the name. If you prefer, you can give the number, but it's better to answer the question asked (the name) first.\",\n          \"isCorrect\": false,\n          \"text\": \"予約の番号は12345です。\",\n          \"textRomanization\": \"Yoyaku no bangō wa ichi ni san yon go desu.\"\n        }\n      ]\n    },\n    {\n      \"context\": \"確認します。お電話番号を教えていただけますか？\",\n      \"contextRomanization\": \"Kakunin shimasu. O-denwa bangō o oshiete itadakemasu ka?\",\n      \"contextTranslation\": \"I'll confirm. Could you tell me your phone number?\",\n      \"options\": [\n        {\n          \"feedback\": \"080-1234-5678. - Good. You answered the receptionist's request directly with your phone number so they can confirm your reservation.\",\n          \"isCorrect\": true,\n          \"text\": \"080-1234-5678です。\",\n          \"textRomanization\": \"Zero-hachi-zero - ichi ni san yon - go roku nana hachi desu.\"\n        },\n        {\n          \"feedback\": \"Can I show my passport? - This doesn't answer the question about your phone number. Saying you'll show your passport may be useful later, but first give the phone number the receptionist asked for.\",\n          \"isCorrect\": false,\n          \"text\": \"パスポートを見せてもいいですか？\",\n          \"textRomanization\": \"Pasupōto o misete mo ii desu ka?\"\n        },\n        {\n          \"feedback\": \"I forgot the number. - This tells the receptionist you can't provide the requested information. If true, offer an alternative (e.g., provide an email or show ID) rather than just saying you forgot.\",\n          \"isCorrect\": false,\n          \"text\": \"番号を忘れました。\",\n          \"textRomanization\": \"Bangō o wasuremashita.\"\n        },\n        {\n          \"feedback\": \"Yes, here it is. - This is vague. If you mean to hand them something, say what it is (e.g., \\\"こちらが携帯番号です\\\") or simply state the number as requested.\",\n          \"isCorrect\": false,\n          \"text\": \"はい、こちらです。\",\n          \"textRomanization\": \"Hai, kochira desu.\"\n        }\n      ]\n    },\n    {\n      \"context\": \"ご宿泊は何泊のご予定ですか？\",\n      \"contextRomanization\": \"Go-shukuhaku wa nanpaku no yotei desu ka?\",\n      \"contextTranslation\": \"How many nights will you be staying?\",\n      \"options\": [\n        {\n          \"feedback\": \"Three nights. - Correct. This directly answers the number-of-nights question in a natural way.\",\n          \"isCorrect\": true,\n          \"text\": \"三泊です。\",\n          \"textRomanization\": \"San-paku desu.\"\n        },\n        {\n          \"feedback\": \"Is check-in at 3 PM? - This asks about check-in time instead of answering how many nights you'll stay. It's a different question; wait until they've recorded your nights or answer first, then ask about times if needed.\",\n          \"isCorrect\": false,\n          \"text\": \"チェックインは午後3時ですか？\",\n          \"textRomanization\": \"Chekku-in wa gogo san-ji desu ka?\"\n        },\n        {\n          \"feedback\": \"I don't need breakfast. - This is unrelated to the number of nights. You can say this later when discussing meal options, but it doesn't answer the receptionist's current question.\",\n          \"isCorrect\": false,\n          \"text\": \"朝食は必要ありません。\",\n          \"textRomanization\": \"Chōshoku wa hitsuyō arimasen.\"\n        },\n        {\n          \"feedback\": \"A single room, please. - The receptionist asked about the length of stay, not the room type. Requesting a room type is fine later, but first answer how many nights you'll stay.\",\n          \"isCorrect\": false,\n          \"text\": \"シングルルームをお願いします。\",\n          \"textRomanization\": \"Shinguru rūmu o onegaishimasu.\"\n        }\n      ]\n    },\n    {\n      \"context\": \"お支払いはカードですか、現金ですか？\",\n      \"contextRomanization\": \"O-shiharai wa kādo desu ka, genkin desu ka?\",\n      \"contextTranslation\": \"Will you be paying by card or cash?\",\n      \"options\": [\n        {\n          \"feedback\": \"Card, please. - Correct. This clearly states your payment method as requested.\",\n          \"isCorrect\": true,\n          \"text\": \"カードでお願いします。\",\n          \"textRomanization\": \"Kādo de onegaishimasu.\"\n        },\n        {\n          \"feedback\": \"Please give me a receipt. - This asks for a receipt but doesn't answer how you'll pay. You should first say whether you'll pay by card or cash, then request a receipt if needed.\",\n          \"isCorrect\": false,\n          \"text\": \"領収書をください。\",\n          \"textRomanization\": \"Ryōshūsho o kudasai.\"\n        },\n        {\n          \"feedback\": \"Is the room non-smoking? - This is about the room policy, not payment. It's a reasonable question but doesn't answer how you'll pay right now.\",\n          \"isCorrect\": false,\n          \"text\": \"部屋は禁煙ですか？\",\n          \"textRomanization\": \"Heya wa kin'en desu ka?\"\n        },\n        {\n          \"feedback\": \"I only have cash. - This states you intend to pay in cash, but because we designated the card response as the correct practice for this step, this option is treated as incorrect here. In real life, this is a valid answer — it just doesn't match the chosen correct option.\",\n          \"isCorrect\": false,\n          \"text\": \"現金しか持っていません。\",\n          \"textRomanization\": \"Genkin shika motteimasen.\"\n        }\n      ]\n    },\n    {\n      \"context\": \"申し訳ありませんが、ご予約の部屋タイプが満室のため、代わりにツインルームをご用意します。差額はありませんが、それでよろしいですか？\",\n      \"contextRomanization\": \"Mōshiwake arimasen ga, go-yoyaku no heya taipu ga manshitsu no tame, kawari ni tsuin rūmu o go-yōi shimasu. Sagaku wa arimasen ga, sore de yoroshii desu ka?\",\n      \"contextTranslation\": \"I'm sorry, your reserved room type is fully booked, so we'll prepare a twin room instead. There is no extra charge—will that be all right?\",\n      \"options\": [\n        {\n          \"feedback\": \"Yes, that's fine. Thank you. - Correct. You accept the offered twin room politely; you also acknowledge there is no extra charge.\",\n          \"isCorrect\": true,\n          \"text\": \"はい、大丈夫です。よろしくお願いします。\",\n          \"textRomanization\": \"Hai, daijōbu desu. Yoroshiku onegaishimasu.\"\n        },\n        {\n          \"feedback\": \"No, I want to exchange the room. - This refuses the offered solution but doesn't propose a concrete alternative. If you prefer a different room type, specify which one or ask when the original room will be available.\",\n          \"isCorrect\": false,\n          \"text\": \"いいえ、私は部屋の交換を望みます。\",\n          \"textRomanization\": \"Iie, watashi wa heya no kōkan o nozomimasu.\"\n        },\n        {\n          \"feedback\": \"How much is the extra charge? - The receptionist already said there is no extra charge. Asking this suggests you didn't catch that information; if you're unsure, you can ask to confirm \\\"差額は本当にありませんか？\\\" instead.\",\n          \"isCorrect\": false,\n          \"text\": \"追加料金はいくらですか？\",\n          \"textRomanization\": \"Tsūka ryōkin wa ikura desu ka?\"\n        },\n        {\n          \"feedback\": \"Please find another hotel. - This asks the staff to look for another hotel, which is an extreme response. If you're unhappy, it's better to politely decline and ask for alternatives or speak to a manager.\",\n          \"isCorrect\": false,\n          \"text\": \"他のホテルを探してください。\",\n          \"textRomanization\": \"Hoka no hoteru o sagashite kudasai.\"\n        }\n      ]\n    },\n    {\n      \"context\": \"お部屋は3階になります。朝食は7時から10時までです。無料のWi‑Fiがあります。何かほかにご質問はございますか？\",\n      \"contextRomanization\": \"O-heya wa sankai ni narimasu. Chōshoku wa shichi-ji kara jū-ji made desu. Muryō no Wi-Fi ga arimasu. Nanika hoka ni go-shitsumon wa gozaimasu ka?\",\n      \"contextTranslation\": \"Your room is on the third floor. Breakfast is from 7 to 10. There's free Wi‑Fi. Do you have any other questions?\",\n      \"options\": [\n        {\n          \"feedback\": \"Could you tell me the Wi‑Fi password? - Correct. You asked a relevant follow-up question about the hotel's Wi‑Fi after the receptionist mentioned it.\",\n          \"isCorrect\": true,\n          \"text\": \"Wi‑Fiのパスワードを教えていただけますか？\",\n          \"textRomanization\": \"Wi‑Fi no pasuwādo o oshiete itadakemasu ka?\"\n        },\n        {\n          \"feedback\": \"Please fix the air conditioner. - This is a request for a maintenance issue before you've even seen the room. If something is wrong after you enter, report it then; for now it's better to ask informational questions.\",\n          \"isCorrect\": false,\n          \"text\": \"エアコンを直してください。\",\n          \"textRomanization\": \"Eakon o naoshite kudasai.\"\n        },\n        {\n          \"feedback\": \"Call me a taxi. - Asking for a taxi is reasonable, but it doesn't directly relate to the details just given. It's not wrong, but here the receptionist just offered basic info; asking specifically about amenities (Wi‑Fi, breakfast) is more on-topic.\",\n          \"isCorrect\": false,\n          \"text\": \"タクシーを呼んでください。\",\n          \"textRomanization\": \"Takushī o yonde kudasai.\"\n        },\n        {\n          \"feedback\": \"Is breakfast free? - The receptionist said there is breakfast service and the times, but didn't say if it's included. This is a reasonable question — however, in this step we've set asking for the Wi‑Fi password as the target. If you want to confirm, phrase it as \\\"朝食は宿泊料金に含まれていますか？\\\" to be specific.\",\n          \"isCorrect\": false,\n          \"text\": \"朝食は無料ですか？\",\n          \"textRomanization\": \"Chōshoku wa muryō desu ka?\"\n        }\n      ]\n    },\n    {\n      \"context\": \"こちらがルームキーです。ご滞在をお楽しみください。\",\n      \"contextRomanization\": \"Kochira ga rūmu kī desu. Go-taizai o o-tanoshimi kudasai.\",\n      \"contextTranslation\": \"Here is your room key. Enjoy your stay.\",\n      \"options\": [\n        {\n          \"feedback\": \"Thank you very much. I appreciate it. - Correct. A polite expression of thanks and goodwill is an appropriate closing at check-in.\",\n          \"isCorrect\": true,\n          \"text\": \"ありがとうございます。よろしくお願いします。\",\n          \"textRomanization\": \"Arigatō gozaimasu. Yoroshiku onegaishimasu.\"\n        },\n        {\n          \"feedback\": \"I'm going home now. - This is odd right after receiving the key. It suggests you're leaving rather than staying; if you mean you're heading to your room, say \\\"部屋に行きます\\\" or simply thank the receptionist.\",\n          \"isCorrect\": false,\n          \"text\": \"もう帰ります。\",\n          \"textRomanization\": \"Mō kaerimasu.\"\n        },\n        {\n          \"feedback\": \"Please clean the room. - This is an immediate complaint before you've seen the room. If you find an issue later, request housekeeping then. For now, a polite thanks is appropriate.\",\n          \"isCorrect\": false,\n          \"text\": \"部屋の掃除をしてください。\",\n          \"textRomanization\": \"Heya no sōji o shite kudasai.\"\n        },\n        {\n          \"feedback\": \"Where is checkout? - This is a useful question but not the most natural closing response right after receiving the key. If you need checkout details, ask specifically: \\\"チェックアウトは何時ですか？\\\"\",\n          \"isCorrect\": false,\n          \"text\": \"チェックアウトはどこですか？\",\n          \"textRomanization\": \"Chekkuauto wa doko desu ka?\"\n        }\n      ]\n    }\n  ]\n}",
      "outputTokens": 7871,
      "systemPrompt": "# Role\n\nYou are an expert language immersion designer specializing in creating realistic, dialogue-driven scenarios that help learners practice language production in authentic contexts. You design experiences that simulate situations learners would encounter when living or traveling in a country where the target language is spoken.\n\n# Goal\n\nCreate an immersive story activity where learners are placed in an everyday situation and must choose appropriate phrases to communicate. The activity simulates real conversations with native speakers, forcing learners to engage with the target language directly rather than relying on translations.\n\nThe activity places learners in a specific scenario (ordering food, asking for directions, checking into a hotel) and guides them through a dialogue where they must select appropriate responses at each step.\n\n# Key Design Principles\n\n## Immersion Over Translation\n\nUnlike other activities where translations help comprehension, this activity intentionally withholds translations from the options. Learners see:\n\n- **Context**: What the native speaker says (in TARGET language with translation)\n- **Options**: Four possible responses (in TARGET language ONLY - no translations)\n\nThis forces learners to:\n\n1. Engage with the target language sounds and patterns\n2. Use context clues to infer meaning\n3. Build recognition before relying on translations\n4. Experience the \"productive uncertainty\" of real conversations\n\nThe translation appears only in the feedback AFTER selection, revealing whether they understood correctly.\n\n## Authentic Scenarios\n\nFocus on situations learners will actually encounter:\n\n| Category       | Example Scenarios                                  |\n| -------------- | -------------------------------------------------- |\n| Food & Dining  | Ordering at a restaurant, asking about ingredients |\n| Transportation | Buying train tickets, asking for directions        |\n| Shopping       | Bargaining at a market, returning an item          |\n| Accommodation  | Checking into a hotel, reporting a problem         |\n| Healthcare     | Describing symptoms at a pharmacy, doctor's visit  |\n| Social         | Meeting neighbors, small talk at a cafe            |\n| Services       | Opening a bank account, getting a phone plan       |\n| Emergencies    | Reporting lost items, asking for help              |\n\n## Supportive Native Speaker\n\nThe character in the story is a friendly native speaker who:\n\n- Speaks naturally but not too fast\n- Helps the learner when they struggle\n- Provides context clues in their responses\n- Never mocks mistakes\n- Gradually introduces more complex language\n\n# Language Handling\n\n## Input Variables\n\n- **TARGET_LANGUAGE**: The language being learned (from `courseTitle`). All dialogue and options are in this language.\n- **NATIVE_LANGUAGE**: The learner's native language (from `language` code). Questions, feedback, and context translations use this language.\n\n## Language Codes\n\n- `en`: US English\n- `pt`: Brazilian Portuguese\n- `es`: Latin American Spanish\n\n## What Appears in Each Language\n\n| Field                        | Language     | Example (Spanish course, English native)                  |\n| ---------------------------- | ------------ | --------------------------------------------------------- |\n| `scenario`                   | NATIVE       | \"You're at a cafe in Madrid and want to order coffee.\"    |\n| `context`                    | TARGET       | \"Buenos dias, que le pongo?\"                              |\n| `contextTranslation`         | NATIVE       | \"Good morning, what can I get you?\"                       |\n| `contextRomanization`        | Romanization | \"\" (empty for Roman scripts)                              |\n| `options[].text`             | TARGET       | \"Un cafe con leche, por favor.\"                           |\n| `options[].textRomanization` | Romanization | \"\" (empty for Roman scripts)                              |\n| `options[].feedback`         | NATIVE       | \"A coffee with milk, please - Perfect! Polite and clear.\" |\n\n# Options Design\n\n## No Translations in Options\n\nThis is the most critical design decision. Options show ONLY:\n\n- `text`: The phrase in TARGET language\n- `textRomanization`: Romanization for non-Roman scripts (empty string for Roman scripts)\n\n**NO translation is shown**. This forces the learner to:\n\n1. Parse the target language directly\n2. Use patterns they've learned\n3. Make educated guesses based on context\n4. Experience the productive struggle of real communication\n\n## Option Quality\n\nAll 4 options must be:\n\n- **Grammatically correct** in the target language\n- **Contextually plausible** (something a learner might say in this situation)\n- **Distinct in meaning** (not just word variations)\n- **Level-appropriate** (using vocabulary/structures the learner knows)\n\n## Distractor Design\n\n**CRITICAL**: Wrong options must be genuinely inappropriate for the situation - they should lead to miscommunication or confusion if used. Do NOT create distractors that are merely \"less polished\" versions of the correct answer.\n\nWrong options should be **clearly wrong** because they:\n\n1. **Answer a different question**: Respond to something the speaker didn't ask (asking about price when asked about quantity)\n2. **Request the wrong thing**: Order/ask for something different than intended (one-way ticket when you need round-trip)\n3. **Are off-topic**: Say something unrelated to the current conversation point (asking for the check when you just arrived)\n4. **Would cause confusion**: Use words that change the meaning entirely (saying \"no\" when you mean \"yes\")\n\n**DO NOT** create distractors that are:\n\n- Just more/less formal versions of the correct answer\n- Slightly different phrasings that would still work\n- Grammatically awkward but still understandable\n\n# Feedback Design\n\nFeedback appears AFTER the learner selects an option. Every feedback message MUST include:\n\n1. **Translation**: What the option actually means in the native language\n2. **Explanation**: Why this choice is correct or incorrect for the situation\n\n## Feedback Structure\n\nFor **correct** options:\n\n```\n\"[Translation of what they said] - [Why this works in context]\"\n```\n\nExample: \"A coffee with milk, please - Perfect! This is polite and clearly communicates what you want.\"\n\nFor **incorrect** options:\n\n```\n\"[Translation of what they said] - [Why this doesn't work and what would be better]\"\n```\n\nExample: \"Where is the bathroom? - You're trying to order coffee, not find the restroom. Tell the barista what you'd like to drink.\"\n\n# Romanization Requirements\n\nFor languages using non-Roman writing systems (Japanese, Chinese, Korean, Arabic, Russian, Greek, Hebrew, Thai, Hindi, etc.), provide romanization for both context and options.\n\n## Standard Systems\n\n- **Japanese**: Romaji using Hepburn romanization\n- **Chinese**: Pinyin with tone marks\n- **Korean**: Revised Romanization of Korean\n- **Russian**: ISO 9 or BGN/PCGN transliteration\n- **Arabic**: Standard romanization\n- **Greek**: Standard transliteration\n- **Thai**: Royal Thai General System\n- **Hindi**: IAST or Hunterian transliteration\n\n## Roman Scripts\n\nFor languages using Roman letters (Spanish, French, German, Portuguese, Italian, etc.), set both `contextRomanization` and `textRomanization` to empty strings `\"\"`.\n\n# Story Arc\n\nEach story should have 5-10 steps following a natural arc:\n\n## Step Progression\n\n1. **Opening** (1-2 steps): Arrive at the location, initial greeting\n2. **Building** (2-4 steps): Main interaction, making requests, clarifying\n3. **Complication** (0-2 steps): Optional challenge that adds realism\n4. **Resolution** (1-2 steps): Complete the transaction\n5. **Closing** (1 step): Thank and goodbye\n\n## Complication Ideas (Recommended)\n\nAdding a complication makes the story more realistic and teaches learners to handle unexpected situations:\n\n- **Item unavailable**: \"Sorry, we're out of that. Would you like something else?\"\n- **Misunderstanding**: \"Did you say two or twelve?\"\n- **Additional requirement**: \"I'll need to see your ID for that.\"\n- **Clarification needed**: \"Which size did you want?\"\n\n## Pacing Guidelines\n\n- Steps should feel like natural conversation beats\n- Each step presents ONE decision point\n- Context should flow naturally from the previous step\n- The native speaker's response should acknowledge what the learner said\n\n# Output Format\n\nReturn an object with this structure (abbreviated examples shown):\n\n**Non-Roman script example (Japanese):**\n\n```json\n{\n  \"scenario\": \"You're at a train station in Tokyo...\",\n  \"steps\": [\n    {\n      \"context\": \"いらっしゃいませ。どちらまで？\",\n      \"contextTranslation\": \"Welcome. Where to?\",\n      \"contextRomanization\": \"Irasshaimase. Dochira made?\",\n      \"options\": [\n        {\n          \"text\": \"京都までお願いします。\",\n          \"textRomanization\": \"Kyouto made onegaishimasu.\",\n          \"isCorrect\": true,\n          \"feedback\": \"To Kyoto, please - Perfect!\"\n        },\n        {\n          \"text\": \"京都は遠いですか？\",\n          \"textRomanization\": \"Kyouto wa tooi desu ka?\",\n          \"isCorrect\": false,\n          \"feedback\": \"Is Kyoto far? - This asks about distance, not for a ticket.\"\n        }\n      ]\n    }\n  ]\n}\n```\n\n**Roman script example (Spanish) - empty romanization fields:**\n\n```json\n{\n  \"scenario\": \"You're at a restaurant in Barcelona...\",\n  \"steps\": [\n    {\n      \"context\": \"Buenas noches. Estan listos para pedir?\",\n      \"contextTranslation\": \"Good evening. Are you ready to order?\",\n      \"contextRomanization\": \"\",\n      \"options\": [\n        {\n          \"text\": \"Si, me gustaria la paella, por favor.\",\n          \"textRomanization\": \"\",\n          \"isCorrect\": true,\n          \"feedback\": \"Yes, I would like the paella, please - Perfect!\"\n        },\n        {\n          \"text\": \"La cuenta, por favor.\",\n          \"textRomanization\": \"\",\n          \"isCorrect\": false,\n          \"feedback\": \"The check, please - You haven't eaten yet!\"\n        }\n      ]\n    }\n  ]\n}\n```\n\nNote: Examples above are abbreviated. Actual output must have 4 options per step and 5-10 steps total.\n\n# Quality Checklist\n\nBefore finalizing, verify:\n\n1. **Grammar accuracy**: All target language text is grammatically correct\n2. **Natural dialogue**: Conversations flow like real interactions\n3. **Appropriate register**: Formality matches the situation (casual cafe vs formal office)\n4. **Cultural accuracy**: Interactions reflect how things work in that culture\n5. **Clear progression**: Steps follow a logical narrative arc\n6. **Distinct options**: Each option represents a meaningfully different choice\n7. **Helpful feedback**: Translations and explanations clarify meaning and context\n8. **Correct romanization**: Follows standard systems for non-Roman scripts, empty for Roman scripts\n9. **Scenario relevance**: The story matches the lesson topic\n10. **Appropriate difficulty**: Language complexity matches learner level\n\n# Common Mistakes to Avoid\n\n1. **Including translations in options**: Options must show TARGET language only\n2. **Trivial distractors**: Options that are obviously wrong or nonsensical\n3. **Inconsistent register**: Mixing formal and informal inappropriately\n4. **Unnatural responses**: Things a native speaker would never actually say\n5. **Missing romanization**: Forgetting to add romanization for non-Roman scripts\n6. **Adding romanization to Roman scripts**: Spanish, French, etc. should have empty strings\n7. **Feedback without translation**: Always include what the option means\n8. **Disconnected steps**: Each step should follow logically from the previous one\n",
      "testCaseId": "en-japanese-hotel-checkin-1",
      "userPrompt": "TARGET_LANGUAGE: Japanese\nNATIVE_LANGUAGE: en\nCHAPTER_TITLE: Travel and Accommodation\nLESSON_TITLE: Hotel Check-in\nLESSON_DESCRIPTION: Learn to check into a hotel, confirm reservations, and ask about room amenities\n\nGenerate an immersive dialogue-driven story activity for this language lesson. Create a realistic everyday scenario where learners practice language production in situations they'd face in a foreign country."
    },
    {
      "duration": 80676.086083,
      "inputTokens": 2654,
      "output": "{\n  \"scenario\": \"Você está em um mercado ao ar livre na Alemanha para comprar frutas e verduras. Pratique pedir produtos, quantidade e pagar no caixa.\",\n  \"steps\": [\n    {\n      \"context\": \"Guten Morgen! Was möchten Sie?\",\n      \"contextRomanization\": \"\",\n      \"contextTranslation\": \"Bom dia! O que o(a) senhor(a) deseja?\",\n      \"options\": [\n        {\n          \"feedback\": \"Bom dia! Eu gostaria de um quilo de maçãs, por favor - Perfeito! Você responde diretamente à pergunta, pedindo o item e a quantidade de forma educada.\",\n          \"isCorrect\": true,\n          \"text\": \"Guten Morgen! Ich hätte gern ein Kilo Äpfel, bitte.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Procuro a casa de banho, por favor - Você respondeu algo fora do contexto. O vendedor perguntou o que deseja comprar; peça o produto ou diga que só está a olhar.\",\n          \"isCorrect\": false,\n          \"text\": \"Ich suche die Toilette, bitte.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Quanto custa uma maçã? - Você perguntou o preço antes de dizer qual tipo/quantidade quer. Primeiro escolha o produto e a quantidade, ou pergunte o preço especificando o que deseja.\",\n          \"isCorrect\": false,\n          \"text\": \"Wie viel kostet ein Apfel?\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Só estou a olhar, obrigado(a) - Esta resposta indica que não quer comprar nada agora; não é adequada se pretende realmente comprar.\",\n          \"isCorrect\": false,\n          \"text\": \"Nur schauen, danke.\",\n          \"textRomanization\": \"\"\n        }\n      ]\n    },\n    {\n      \"context\": \"Wir haben Boskop und Gala. Welche möchten Sie?\",\n      \"contextRomanization\": \"\",\n      \"contextTranslation\": \"Temos Boskop e Gala. Qual prefere?\",\n      \"options\": [\n        {\n          \"feedback\": \"Gala, por favor - Bom! Você escolhe diretamente o tipo de maçã pedido pelo vendedor.\",\n          \"isCorrect\": true,\n          \"text\": \"Gala, bitte.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Eu levo dois quilos, por favor - Você respondeu com a quantidade sem indicar o tipo. O vendedor perguntou qual variedade você prefere; diga o tipo e depois a quantidade.\",\n          \"isCorrect\": false,\n          \"text\": \"Ich nehme zwei Kilo, bitte.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Qual é mais doce? - Isso é uma pergunta de esclarecimento. Não é errado, mas não responde à pergunta; se quiser saber, pergunte antes de escolher.\",\n          \"isCorrect\": false,\n          \"text\": \"Welches ist süßer?\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Gosto de bananas - Comentário fora do tópico. O vendedor perguntou qual variedade de maçã você quer; responda com 'Gala' ou 'Boskop'.\",\n          \"isCorrect\": false,\n          \"text\": \"Ich mag Bananen.\",\n          \"textRomanization\": \"\"\n        }\n      ]\n    },\n    {\n      \"context\": \"Möchten Sie ein ganzes Kilo oder ein halbes Kilo?\",\n      \"contextRomanization\": \"\",\n      \"contextTranslation\": \"Quer um quilo inteiro ou meio quilo?\",\n      \"options\": [\n        {\n          \"feedback\": \"Meio quilo, por favor - Perfeito. Você especifica claramente a quantidade pedida.\",\n          \"isCorrect\": true,\n          \"text\": \"Ein halbes Kilo, bitte.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Sim, por favor - Muito vago. O vendedor ofereceu duas opções; responda com 'ein ganzes Kilo' ou 'ein halbes Kilo' para ser claro.\",\n          \"isCorrect\": false,\n          \"text\": \"Ja, bitte.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Só uma maçã, por favor - Embora seja uma quantidade válida, não responde diretamente à escolha entre 'ganzes Kilo' e 'halbes Kilo'. Seria melhor dizer 'Nur ein Apfel' somente se for isso que realmente quiser.\",\n          \"isCorrect\": false,\n          \"text\": \"Nur ein Apfel, bitte.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Pago com cartão - Resposta fora do assunto. Primeiro indique a quantidade; depois fale sobre o pagamento.\",\n          \"isCorrect\": false,\n          \"text\": \"Ich zahle mit Karte.\",\n          \"textRomanization\": \"\"\n        }\n      ]\n    },\n    {\n      \"context\": \"Es tut mir leid, die Gala sind gerade ausverkauft. Möchten Sie stattdessen Boskop-Äpfel?\",\n      \"contextRomanization\": \"\",\n      \"contextTranslation\": \"Desculpe, as Gala estão esgotadas agora. Gostaria, em vez disso, de maçãs Boskop?\",\n      \"options\": [\n        {\n          \"feedback\": \"Sim, por favor. Boskop está bem - Excelente. Você aceita a alternativa adequada e a conversa segue.\",\n          \"isCorrect\": true,\n          \"text\": \"Ja, bitte. Boskop ist in Ordnung.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Então eu levo bananas - Mudar para outro produto é possível, mas isso ignora a pergunta sobre substituir por Boskop. Se realmente quiser bananas, confirme claramente que prefere outro produto.\",\n          \"isCorrect\": false,\n          \"text\": \"Dann nehme ich Bananen.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Não, é muito caro - Esta reclamação não responde à alternativa oferecida; se o preço for um problema, pergunte sobre o preço do substituto ou escolha outra opção.\",\n          \"isCorrect\": false,\n          \"text\": \"Nein, das ist zu teuer.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Eu espero até a Gala voltar - Dizer que vai esperar é uma opção, mas nem sempre prático. Se quiser realmente esperar, informe por quanto tempo ou deixe seu pedido; caso contrário, aceite uma alternativa.\",\n          \"isCorrect\": false,\n          \"text\": \"Ich warte, bis die Gala wieder da sind.\",\n          \"textRomanization\": \"\"\n        }\n      ]\n    },\n    {\n      \"context\": \"Also, das macht 1,75 Euro. Möchten Sie noch etwas?\",\n      \"contextRomanization\": \"\",\n      \"contextTranslation\": \"Então, dá 1,75 euros. Quer mais alguma coisa?\",\n      \"options\": [\n        {\n          \"feedback\": \"Aqui, por favor, 1,75€ - Perfeito. Você paga o valor exato e aceita a finalização da compra.\",\n          \"isCorrect\": true,\n          \"text\": \"Hier bitte, 1,75€.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Posso pagar com cartão? - Pergunta válida se preferir cartão; porém, muitos vendedores de mercado só aceitam dinheiro. Se quiser pagar com cartão, pergunte primeiro se é possível.\",\n          \"isCorrect\": false,\n          \"text\": \"Kann ich mit Karte zahlen?\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Preciso de um recibo? - Você está pedindo uma informação administrativa em vez de pagar. Se quiser o recibo, pergunte depois de pagar ou enquanto entrega o dinheiro.\",\n          \"isCorrect\": false,\n          \"text\": \"Brauche ich eine Quittung?\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Também levo bananas - Você pode adicionar mais itens, mas o vendedor perguntou especificamente se quer mais algo; se quiser bananas, diga quantas e a variedade.\",\n          \"isCorrect\": false,\n          \"text\": \"Ich nehme auch Bananen.\",\n          \"textRomanization\": \"\"\n        }\n      ]\n    },\n    {\n      \"context\": \"Danke schön! Einen schönen Tag noch!\",\n      \"contextRomanization\": \"\",\n      \"contextTranslation\": \"Muito obrigado! Tenha um bom dia!\",\n      \"options\": [\n        {\n          \"feedback\": \"Obrigado, igualmente! - Correto e cortês; devolve o cumprimento de forma educada.\",\n          \"isCorrect\": true,\n          \"text\": \"Danke, Ihnen auch!\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Adeus! - 'Auf Wiedersehen' também é aceitável, mas é mais formal. Não está errado se quiser despedir-se.\",\n          \"isCorrect\": false,\n          \"text\": \"Auf Wiedersehen!\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Tchau! - 'Tschüss' é mais informal; pode ser usado, mas se você começou formalmente com 'Guten Morgen', 'Danke, Ihnen auch' é mais consistente.\",\n          \"isCorrect\": false,\n          \"text\": \"Tschüss!\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Boa noite! - 'Guten Abend' (boa noite) não é adequado se for de manhã ou de tarde; use uma despedida apropriada ao horário.\",\n          \"isCorrect\": false,\n          \"text\": \"Guten Abend!\",\n          \"textRomanization\": \"\"\n        }\n      ]\n    }\n  ]\n}",
      "outputTokens": 5286,
      "systemPrompt": "# Role\n\nYou are an expert language immersion designer specializing in creating realistic, dialogue-driven scenarios that help learners practice language production in authentic contexts. You design experiences that simulate situations learners would encounter when living or traveling in a country where the target language is spoken.\n\n# Goal\n\nCreate an immersive story activity where learners are placed in an everyday situation and must choose appropriate phrases to communicate. The activity simulates real conversations with native speakers, forcing learners to engage with the target language directly rather than relying on translations.\n\nThe activity places learners in a specific scenario (ordering food, asking for directions, checking into a hotel) and guides them through a dialogue where they must select appropriate responses at each step.\n\n# Key Design Principles\n\n## Immersion Over Translation\n\nUnlike other activities where translations help comprehension, this activity intentionally withholds translations from the options. Learners see:\n\n- **Context**: What the native speaker says (in TARGET language with translation)\n- **Options**: Four possible responses (in TARGET language ONLY - no translations)\n\nThis forces learners to:\n\n1. Engage with the target language sounds and patterns\n2. Use context clues to infer meaning\n3. Build recognition before relying on translations\n4. Experience the \"productive uncertainty\" of real conversations\n\nThe translation appears only in the feedback AFTER selection, revealing whether they understood correctly.\n\n## Authentic Scenarios\n\nFocus on situations learners will actually encounter:\n\n| Category       | Example Scenarios                                  |\n| -------------- | -------------------------------------------------- |\n| Food & Dining  | Ordering at a restaurant, asking about ingredients |\n| Transportation | Buying train tickets, asking for directions        |\n| Shopping       | Bargaining at a market, returning an item          |\n| Accommodation  | Checking into a hotel, reporting a problem         |\n| Healthcare     | Describing symptoms at a pharmacy, doctor's visit  |\n| Social         | Meeting neighbors, small talk at a cafe            |\n| Services       | Opening a bank account, getting a phone plan       |\n| Emergencies    | Reporting lost items, asking for help              |\n\n## Supportive Native Speaker\n\nThe character in the story is a friendly native speaker who:\n\n- Speaks naturally but not too fast\n- Helps the learner when they struggle\n- Provides context clues in their responses\n- Never mocks mistakes\n- Gradually introduces more complex language\n\n# Language Handling\n\n## Input Variables\n\n- **TARGET_LANGUAGE**: The language being learned (from `courseTitle`). All dialogue and options are in this language.\n- **NATIVE_LANGUAGE**: The learner's native language (from `language` code). Questions, feedback, and context translations use this language.\n\n## Language Codes\n\n- `en`: US English\n- `pt`: Brazilian Portuguese\n- `es`: Latin American Spanish\n\n## What Appears in Each Language\n\n| Field                        | Language     | Example (Spanish course, English native)                  |\n| ---------------------------- | ------------ | --------------------------------------------------------- |\n| `scenario`                   | NATIVE       | \"You're at a cafe in Madrid and want to order coffee.\"    |\n| `context`                    | TARGET       | \"Buenos dias, que le pongo?\"                              |\n| `contextTranslation`         | NATIVE       | \"Good morning, what can I get you?\"                       |\n| `contextRomanization`        | Romanization | \"\" (empty for Roman scripts)                              |\n| `options[].text`             | TARGET       | \"Un cafe con leche, por favor.\"                           |\n| `options[].textRomanization` | Romanization | \"\" (empty for Roman scripts)                              |\n| `options[].feedback`         | NATIVE       | \"A coffee with milk, please - Perfect! Polite and clear.\" |\n\n# Options Design\n\n## No Translations in Options\n\nThis is the most critical design decision. Options show ONLY:\n\n- `text`: The phrase in TARGET language\n- `textRomanization`: Romanization for non-Roman scripts (empty string for Roman scripts)\n\n**NO translation is shown**. This forces the learner to:\n\n1. Parse the target language directly\n2. Use patterns they've learned\n3. Make educated guesses based on context\n4. Experience the productive struggle of real communication\n\n## Option Quality\n\nAll 4 options must be:\n\n- **Grammatically correct** in the target language\n- **Contextually plausible** (something a learner might say in this situation)\n- **Distinct in meaning** (not just word variations)\n- **Level-appropriate** (using vocabulary/structures the learner knows)\n\n## Distractor Design\n\n**CRITICAL**: Wrong options must be genuinely inappropriate for the situation - they should lead to miscommunication or confusion if used. Do NOT create distractors that are merely \"less polished\" versions of the correct answer.\n\nWrong options should be **clearly wrong** because they:\n\n1. **Answer a different question**: Respond to something the speaker didn't ask (asking about price when asked about quantity)\n2. **Request the wrong thing**: Order/ask for something different than intended (one-way ticket when you need round-trip)\n3. **Are off-topic**: Say something unrelated to the current conversation point (asking for the check when you just arrived)\n4. **Would cause confusion**: Use words that change the meaning entirely (saying \"no\" when you mean \"yes\")\n\n**DO NOT** create distractors that are:\n\n- Just more/less formal versions of the correct answer\n- Slightly different phrasings that would still work\n- Grammatically awkward but still understandable\n\n# Feedback Design\n\nFeedback appears AFTER the learner selects an option. Every feedback message MUST include:\n\n1. **Translation**: What the option actually means in the native language\n2. **Explanation**: Why this choice is correct or incorrect for the situation\n\n## Feedback Structure\n\nFor **correct** options:\n\n```\n\"[Translation of what they said] - [Why this works in context]\"\n```\n\nExample: \"A coffee with milk, please - Perfect! This is polite and clearly communicates what you want.\"\n\nFor **incorrect** options:\n\n```\n\"[Translation of what they said] - [Why this doesn't work and what would be better]\"\n```\n\nExample: \"Where is the bathroom? - You're trying to order coffee, not find the restroom. Tell the barista what you'd like to drink.\"\n\n# Romanization Requirements\n\nFor languages using non-Roman writing systems (Japanese, Chinese, Korean, Arabic, Russian, Greek, Hebrew, Thai, Hindi, etc.), provide romanization for both context and options.\n\n## Standard Systems\n\n- **Japanese**: Romaji using Hepburn romanization\n- **Chinese**: Pinyin with tone marks\n- **Korean**: Revised Romanization of Korean\n- **Russian**: ISO 9 or BGN/PCGN transliteration\n- **Arabic**: Standard romanization\n- **Greek**: Standard transliteration\n- **Thai**: Royal Thai General System\n- **Hindi**: IAST or Hunterian transliteration\n\n## Roman Scripts\n\nFor languages using Roman letters (Spanish, French, German, Portuguese, Italian, etc.), set both `contextRomanization` and `textRomanization` to empty strings `\"\"`.\n\n# Story Arc\n\nEach story should have 5-10 steps following a natural arc:\n\n## Step Progression\n\n1. **Opening** (1-2 steps): Arrive at the location, initial greeting\n2. **Building** (2-4 steps): Main interaction, making requests, clarifying\n3. **Complication** (0-2 steps): Optional challenge that adds realism\n4. **Resolution** (1-2 steps): Complete the transaction\n5. **Closing** (1 step): Thank and goodbye\n\n## Complication Ideas (Recommended)\n\nAdding a complication makes the story more realistic and teaches learners to handle unexpected situations:\n\n- **Item unavailable**: \"Sorry, we're out of that. Would you like something else?\"\n- **Misunderstanding**: \"Did you say two or twelve?\"\n- **Additional requirement**: \"I'll need to see your ID for that.\"\n- **Clarification needed**: \"Which size did you want?\"\n\n## Pacing Guidelines\n\n- Steps should feel like natural conversation beats\n- Each step presents ONE decision point\n- Context should flow naturally from the previous step\n- The native speaker's response should acknowledge what the learner said\n\n# Output Format\n\nReturn an object with this structure (abbreviated examples shown):\n\n**Non-Roman script example (Japanese):**\n\n```json\n{\n  \"scenario\": \"You're at a train station in Tokyo...\",\n  \"steps\": [\n    {\n      \"context\": \"いらっしゃいませ。どちらまで？\",\n      \"contextTranslation\": \"Welcome. Where to?\",\n      \"contextRomanization\": \"Irasshaimase. Dochira made?\",\n      \"options\": [\n        {\n          \"text\": \"京都までお願いします。\",\n          \"textRomanization\": \"Kyouto made onegaishimasu.\",\n          \"isCorrect\": true,\n          \"feedback\": \"To Kyoto, please - Perfect!\"\n        },\n        {\n          \"text\": \"京都は遠いですか？\",\n          \"textRomanization\": \"Kyouto wa tooi desu ka?\",\n          \"isCorrect\": false,\n          \"feedback\": \"Is Kyoto far? - This asks about distance, not for a ticket.\"\n        }\n      ]\n    }\n  ]\n}\n```\n\n**Roman script example (Spanish) - empty romanization fields:**\n\n```json\n{\n  \"scenario\": \"You're at a restaurant in Barcelona...\",\n  \"steps\": [\n    {\n      \"context\": \"Buenas noches. Estan listos para pedir?\",\n      \"contextTranslation\": \"Good evening. Are you ready to order?\",\n      \"contextRomanization\": \"\",\n      \"options\": [\n        {\n          \"text\": \"Si, me gustaria la paella, por favor.\",\n          \"textRomanization\": \"\",\n          \"isCorrect\": true,\n          \"feedback\": \"Yes, I would like the paella, please - Perfect!\"\n        },\n        {\n          \"text\": \"La cuenta, por favor.\",\n          \"textRomanization\": \"\",\n          \"isCorrect\": false,\n          \"feedback\": \"The check, please - You haven't eaten yet!\"\n        }\n      ]\n    }\n  ]\n}\n```\n\nNote: Examples above are abbreviated. Actual output must have 4 options per step and 5-10 steps total.\n\n# Quality Checklist\n\nBefore finalizing, verify:\n\n1. **Grammar accuracy**: All target language text is grammatically correct\n2. **Natural dialogue**: Conversations flow like real interactions\n3. **Appropriate register**: Formality matches the situation (casual cafe vs formal office)\n4. **Cultural accuracy**: Interactions reflect how things work in that culture\n5. **Clear progression**: Steps follow a logical narrative arc\n6. **Distinct options**: Each option represents a meaningfully different choice\n7. **Helpful feedback**: Translations and explanations clarify meaning and context\n8. **Correct romanization**: Follows standard systems for non-Roman scripts, empty for Roman scripts\n9. **Scenario relevance**: The story matches the lesson topic\n10. **Appropriate difficulty**: Language complexity matches learner level\n\n# Common Mistakes to Avoid\n\n1. **Including translations in options**: Options must show TARGET language only\n2. **Trivial distractors**: Options that are obviously wrong or nonsensical\n3. **Inconsistent register**: Mixing formal and informal inappropriately\n4. **Unnatural responses**: Things a native speaker would never actually say\n5. **Missing romanization**: Forgetting to add romanization for non-Roman scripts\n6. **Adding romanization to Roman scripts**: Spanish, French, etc. should have empty strings\n7. **Feedback without translation**: Always include what the option means\n8. **Disconnected steps**: Each step should follow logically from the previous one\n",
      "testCaseId": "pt-german-market-shopping-1",
      "userPrompt": "TARGET_LANGUAGE: German\nNATIVE_LANGUAGE: pt\nCHAPTER_TITLE: Fazendo Compras\nLESSON_TITLE: No Mercado\nLESSON_DESCRIPTION: Aprenda a comprar frutas, verduras e outros itens em um mercado alemao\n\nGenerate an immersive dialogue-driven story activity for this language lesson. Create a realistic everyday scenario where learners practice language production in situations they'd face in a foreign country."
    },
    {
      "duration": 151514.87537500003,
      "inputTokens": 2654,
      "output": "{\n  \"scenario\": \"Estás en Seúl y necesitas llegar a la estación de tren (서울역). Vas caminando por la calle por la noche y preguntas a una persona amable en la acera cómo llegar.\",\n  \"steps\": [\n    {\n      \"context\": \"저기요, 어디로 가세요?\",\n      \"contextRomanization\": \"Jeogiyo, eodiro gaseyo?\",\n      \"contextTranslation\": \"Disculpe, ¿a dónde va?\",\n      \"options\": [\n        {\n          \"feedback\": \"Quiero ir a la estación de Seúl - Perfecto. Respondes directamente a la pregunta indicando tu destino.\",\n          \"isCorrect\": true,\n          \"text\": \"서울역으로 가고 싶어요.\",\n          \"textRomanization\": \"Seoul-yeok-euro gago sipeoyo.\"\n        },\n        {\n          \"feedback\": \"Quiero tomar el metro - No responde a '¿a dónde va?'. Habla del medio de transporte, no del destino. Para indicar destino di '서울역으로...' u otra ubicación concreta.\",\n          \"isCorrect\": false,\n          \"text\": \"지하철을 타고 싶어요.\",\n          \"textRomanization\": \"Jihacheoreul tago sipeoyo.\"\n        },\n        {\n          \"feedback\": \"¿Dónde está el baño? - Fuera de tema: la persona preguntó a dónde vas, no dónde está el baño. Esto confundiría al interlocutor.\",\n          \"isCorrect\": false,\n          \"text\": \"화장실이 어디예요?\",\n          \"textRomanization\": \"Hwajangsil-i eodiyeyo?\"\n        },\n        {\n          \"feedback\": \"Me perdí - Relacionado con estar desorientado, pero no responde la pregunta sobre tu destino. Si en realidad estás perdido, puedes decir esto, pero si quieren saber a dónde vas, indica el lugar.\",\n          \"isCorrect\": false,\n          \"text\": \"길을 잃었어요.\",\n          \"textRomanization\": \"Gil-eul ilheosseoyo.\"\n        }\n      ]\n    },\n    {\n      \"context\": \"여기서 쭉 가다가 큰 사거리에서 왼쪽으로 도세요. 그러면 약 10분 걸려요.\",\n      \"contextRomanization\": \"Yeogiseo jjuk gadaga keun sageori-eseo oenjjok-euro doseyo. Geureomyeon yak 10 bun geollyeoyo.\",\n      \"contextTranslation\": \"Siga recto desde aquí; en el gran cruce gire a la izquierda. Entonces tardará unos 10 minutos.\",\n      \"options\": [\n        {\n          \"feedback\": \"¿En el gran cruce debo girar a la izquierda? - Muy buen pedido de confirmación. Estás aclarando el punto clave de la dirección antes de seguir.\",\n          \"isCorrect\": true,\n          \"text\": \"큰 사거리에서 왼쪽으로 도는 건가요?\",\n          \"textRomanization\": \"Keun sageori-eseo oenjjok-euro doneun geongayo?\"\n        },\n        {\n          \"feedback\": \"Tomaré un taxi - Respuesta posible, pero no confirma la dirección ni pide aclaración. Cambia de plan sin confirmar la ruta sugerida.\",\n          \"isCorrect\": false,\n          \"text\": \"택시 타고 갈게요.\",\n          \"textRomanization\": \"Taeksi tago galgeyo.\"\n        },\n        {\n          \"feedback\": \"¿Cuánto cuesta? - Off-topic: no tiene relación con la indicación de cómo llegar. Esto confundiría al hablante porque no había pregunta sobre precio.\",\n          \"isCorrect\": false,\n          \"text\": \"가격이 얼마예요?\",\n          \"textRomanization\": \"Gagyeogi eolmayeyo?\"\n        },\n        {\n          \"feedback\": \"¿Si voy a la derecha? - Contradice la indicación dada (que es girar a la izquierda). Preguntar esto sin motivo generará confusión.\",\n          \"isCorrect\": false,\n          \"text\": \"오른쪽으로 가면 되나요?\",\n          \"textRomanization\": \"Oreunjjok-euro gamyeon doenayo?\"\n        }\n      ]\n    },\n    {\n      \"context\": \"밤에는 길이 어두워요. 안전하게 가려면 버스를 타는 게 좋아요.\",\n      \"contextRomanization\": \"Bam-eneun gili eoduwoyo. Anjeonhage garyeomyeon beoseureul taneun ge joayo.\",\n      \"contextTranslation\": \"Por la noche la calle está oscura. Si quieres ir con seguridad, es mejor tomar el autobús.\",\n      \"options\": [\n        {\n          \"feedback\": \"Entonces, ¿dónde cojo el autobús? - Excelente: pides la acción práctica siguiente para seguir su consejo.\",\n          \"isCorrect\": true,\n          \"text\": \"그럼 버스는 어디에서 타요?\",\n          \"textRomanization\": \"Geureom beoseuneun eodieseo tayo?\"\n        },\n        {\n          \"feedback\": \"Caminar solo por la noche está bien - Esto contradice la recomendación del hablante y no avanza en cómo llegar de forma segura.\",\n          \"isCorrect\": false,\n          \"text\": \"밤에 혼자 걷는 건 괜찮아요.\",\n          \"textRomanization\": \"Bam-e honja geonneun geon gwaenchana-yo?\"\n        },\n        {\n          \"feedback\": \"¿Hasta qué hora funciona el metro? - Es una pregunta válida, pero no responde a la sugerencia de tomar el autobús ahora. Si quieres seguir su consejo, pregunta dónde montar el bus.\",\n          \"isCorrect\": false,\n          \"text\": \"지하철역은 몇 시까지 열어요?\",\n          \"textRomanization\": \"Jihacheol-yeok-eun myeot siggaji yeoreoyo?\"\n        },\n        {\n          \"feedback\": \"Iré al restaurante que vi antes - Off-topic: no responde ni pide aclaración sobre la opción más segura que te ofrecieron.\",\n          \"isCorrect\": false,\n          \"text\": \"전에 본 식당으로 갈게요.\",\n          \"textRomanization\": \"Jeone bon sikdang-euro galgeyo.\"\n        }\n      ]\n    },\n    {\n      \"context\": \"버스 정류장은 저 모퉁이에 있어요. 271번을 타면 서울역까지 가고, 버스에서는 카드를 찍으면 됩니다.\",\n      \"contextRomanization\": \"Beoseu jeongryujang-eun jeo motung-ie isseoyo. 271-beon-eul tamyeon Seoul-yeok-kkaji gago, beoseu-eseoneun kadeureul jjigeumyeon doemnida.\",\n      \"contextTranslation\": \"La parada de autobús está en esa esquina. Si toma el 271 llegará a Seoul Station; en el bus basta con pasar la tarjeta.\",\n      \"options\": [\n        {\n          \"feedback\": \"No tengo tarjeta. ¿Puedo pagar en efectivo? - Correcto. Pides la información práctica necesaria si no tienes tarjeta.\",\n          \"isCorrect\": true,\n          \"text\": \"카드가 없어요. 현금으로 탈 수 있나요?\",\n          \"textRomanization\": \"Kadeuga eopseoyo. Hyeongeum-euro tal su issnayo?\"\n        },\n        {\n          \"feedback\": \"Tómame una foto, por favor - Off-topic: pedir una foto no ayuda a resolver cómo pagar o dónde subir al bus. Confundiría al hablante.\",\n          \"isCorrect\": false,\n          \"text\": \"사진 찍어 주세요.\",\n          \"textRomanization\": \"Sajin jjigeo juseyo.\"\n        },\n        {\n          \"feedback\": \"¿El 271 pasa frecuentemente? - Es una pregunta válida sobre frecuencia, pero no responde la duda concreta sobre el pago si no tienes tarjeta. Si eso es lo que te preocupa, pregunta sobre el pago primero.\",\n          \"isCorrect\": false,\n          \"text\": \"271번은 자주 오나요?\",\n          \"textRomanization\": \"271-beon-eun jaju onayo?\"\n        },\n        {\n          \"feedback\": \"¿Tengo que pulsar el timbre para bajar? - Esto es una pregunta práctica sobre el comportamiento en el bus, pero no resuelve el problema del pago si no tienes tarjeta. Es útil, pero no es la respuesta directa a tu situación actual.\",\n          \"isCorrect\": false,\n          \"text\": \"내릴 때 벨을 눌러야 해요?\",\n          \"textRomanization\": \"Naeril ttae bel-eul nullyeoya haeyo?\"\n        }\n      ]\n    },\n    {\n      \"context\": \"죄송해요. 지금 271번은 도로 공사 때문에 우회 운행 중이에요. 대신 102번을 타시면 조금 더 오래 걸리지만 같은 방향으로 갑니다.\",\n      \"contextRomanization\": \"Joesonghaeyo. Jigeum 271-beon-eun doro gongsa ttaemune uhoe unhaeng jung-ieyo. Daesin 102-beon-eul tasimyeon jogeum deo oraeg geollijiman gateun banghyang-euro gamnida.\",\n      \"contextTranslation\": \"Lo siento. Ahora el 271 está desviado por obras. En su lugar tome el 102; tardará un poco más pero va en la misma dirección.\",\n      \"options\": [\n        {\n          \"feedback\": \"¿Dónde cojo el 102? - Correcto. Pides la información inmediata para ajustar tu plan tras la complicación.\",\n          \"isCorrect\": true,\n          \"text\": \"102번은 어디서 타요?\",\n          \"textRomanization\": \"102-beon-eun eodieseo tayo?\"\n        },\n        {\n          \"feedback\": \"Entonces llamaré a un taxi - Posible alternativa, pero no sigue la sugerencia ni pide la ubicación del 102. Es una elección distinta, no la aclaración más útil ahora.\",\n          \"isCorrect\": false,\n          \"text\": \"그럼 택시를 부를래요.\",\n          \"textRomanization\": \"Geureom taeksireul bureullae-yo.\"\n        },\n        {\n          \"feedback\": \"¿Cuándo volverá a funcionar? - Pregunta legítima, pero no ayuda a llegar ahora. Si necesitas llegar ya, pregunta por la alternativa (dónde tomar el 102).\",\n          \"isCorrect\": false,\n          \"text\": \"운행이 언제 다시 시작하나요?\",\n          \"textRomanization\": \"Unhaeng-i eonje dasi sijakhanayo?\"\n        },\n        {\n          \"feedback\": \"¿Dices que lo sientes por las obras? - Esto repite lo que dijo la persona en tono de sorpresa, pero no pide información práctica. Mejor pregunta dónde está el 102.\",\n          \"isCorrect\": false,\n          \"text\": \"공사 때문에 미안하다고요?\",\n          \"textRomanization\": \"Gongsa ttaemune mianhadago-yo?\"\n        }\n      ]\n    },\n    {\n      \"context\": \"102번 정류장은 바로 옆에 있어요. 세 정거장 가서 내리면 오른쪽에 큰 건물이 보이고, 그 건물 지하가 서울역입니다.\",\n      \"contextRomanization\": \"102-beon jeongryujang-eun baro yeop-e isseoyo. Se jeonggeojang gaseo naerimyeon oreunjjok-e keun geonmuri boigo, geu geonmul jiha-ga Seoul-yeok-imnida.\",\n      \"contextTranslation\": \"La parada del 102 está justo al lado. Después de tres paradas bájese; verá un gran edificio a la derecha y la estación está en el sótano de ese edificio.\",\n      \"options\": [\n        {\n          \"feedback\": \"¿Si sigo las señales estará bien? Lo entendí bien. - Correcto. Confirmas que comprendes las instrucciones y pides una forma simple de orientación (seguir señales).\",\n          \"isCorrect\": true,\n          \"text\": \"표지판을 따라가면 되나요? 잘 이해했어요.\",\n          \"textRomanization\": \"Pyojipan-eul ttaragamyeon doenayo? Jal ihaehaesseoyo.\"\n        },\n        {\n          \"feedback\": \"¿Puedo bajarme aquí? - Preguntar si debes bajar 'aquí' es inapropiado si el hablante te dijo que bajes en tres paradas; confundiría la acción correcta.\",\n          \"isCorrect\": false,\n          \"text\": \"여기서 내려도 되는지요?\",\n          \"textRomanization\": \"Yeogiseo naeryeodo doeneunjiyo?\"\n        },\n        {\n          \"feedback\": \"¿Puedo sacar una foto? - Off-topic: no ayuda a llegar. Sería extraño pedir permiso para fotografiar en este punto en vez de confirmar la ruta.\",\n          \"isCorrect\": false,\n          \"text\": \"사진을 찍어도 될까요?\",\n          \"textRomanization\": \"Sajineul jjigeodo doelkkayo?\"\n        },\n        {\n          \"feedback\": \"Por favor vaya despacio - Frase dirigida al conductor; aquí no tiene sentido pedirlo a la persona que te da direcciones. No ayuda a encontrar la estación.\",\n          \"isCorrect\": false,\n          \"text\": \"천천히 가 주세요.\",\n          \"textRomanization\": \"Cheoncheonhi ga juseyo.\"\n        }\n      ]\n    },\n    {\n      \"context\": \"도착하면 연락 주세요. 여행 잘 하세요!\",\n      \"contextRomanization\": \"Dojakhameon yeollak juseyo. Yeohaeng jal haseyo!\",\n      \"contextTranslation\": \"Avísame cuando llegues. ¡Que tengas un buen viaje!\",\n      \"options\": [\n        {\n          \"feedback\": \"Gracias por ayudarme. Realmente es muy amable. - Correcto: agradeces y cierras la conversación de forma educada y apropiada.\",\n          \"isCorrect\": true,\n          \"text\": \"도와주셔서 감사합니다. 정말 친절하시네요.\",\n          \"textRomanization\": \"Dowajusyeoseo gamsahamnida. Jeongmal chinjeolhasineyo.\"\n        },\n        {\n          \"feedback\": \"Hola/adiós (informal) - '안녕' es muy informal y puede sonar inapropiado con alguien que acaba de ayudarte. Es mejor usar fórmulas corteses.\",\n          \"isCorrect\": false,\n          \"text\": \"안녕\",\n          \"textRomanization\": \"Annyeong\"\n        },\n        {\n          \"feedback\": \"Dame dinero - Muy inapropiado y ofensivo en este contexto. No tiene relación con agradecer o despedirse.\",\n          \"isCorrect\": false,\n          \"text\": \"돈 주세요.\",\n          \"textRomanization\": \"Don juseyo.\"\n        },\n        {\n          \"feedback\": \"Vivo aquí - Información irrelevante en este momento. No es una despedida ni agradecimiento.\",\n          \"isCorrect\": false,\n          \"text\": \"나는 여기에 살아요.\",\n          \"textRomanization\": \"Naneun yeogie sarayo.\"\n        }\n      ]\n    }\n  ]\n}",
      "outputTokens": 10026,
      "systemPrompt": "# Role\n\nYou are an expert language immersion designer specializing in creating realistic, dialogue-driven scenarios that help learners practice language production in authentic contexts. You design experiences that simulate situations learners would encounter when living or traveling in a country where the target language is spoken.\n\n# Goal\n\nCreate an immersive story activity where learners are placed in an everyday situation and must choose appropriate phrases to communicate. The activity simulates real conversations with native speakers, forcing learners to engage with the target language directly rather than relying on translations.\n\nThe activity places learners in a specific scenario (ordering food, asking for directions, checking into a hotel) and guides them through a dialogue where they must select appropriate responses at each step.\n\n# Key Design Principles\n\n## Immersion Over Translation\n\nUnlike other activities where translations help comprehension, this activity intentionally withholds translations from the options. Learners see:\n\n- **Context**: What the native speaker says (in TARGET language with translation)\n- **Options**: Four possible responses (in TARGET language ONLY - no translations)\n\nThis forces learners to:\n\n1. Engage with the target language sounds and patterns\n2. Use context clues to infer meaning\n3. Build recognition before relying on translations\n4. Experience the \"productive uncertainty\" of real conversations\n\nThe translation appears only in the feedback AFTER selection, revealing whether they understood correctly.\n\n## Authentic Scenarios\n\nFocus on situations learners will actually encounter:\n\n| Category       | Example Scenarios                                  |\n| -------------- | -------------------------------------------------- |\n| Food & Dining  | Ordering at a restaurant, asking about ingredients |\n| Transportation | Buying train tickets, asking for directions        |\n| Shopping       | Bargaining at a market, returning an item          |\n| Accommodation  | Checking into a hotel, reporting a problem         |\n| Healthcare     | Describing symptoms at a pharmacy, doctor's visit  |\n| Social         | Meeting neighbors, small talk at a cafe            |\n| Services       | Opening a bank account, getting a phone plan       |\n| Emergencies    | Reporting lost items, asking for help              |\n\n## Supportive Native Speaker\n\nThe character in the story is a friendly native speaker who:\n\n- Speaks naturally but not too fast\n- Helps the learner when they struggle\n- Provides context clues in their responses\n- Never mocks mistakes\n- Gradually introduces more complex language\n\n# Language Handling\n\n## Input Variables\n\n- **TARGET_LANGUAGE**: The language being learned (from `courseTitle`). All dialogue and options are in this language.\n- **NATIVE_LANGUAGE**: The learner's native language (from `language` code). Questions, feedback, and context translations use this language.\n\n## Language Codes\n\n- `en`: US English\n- `pt`: Brazilian Portuguese\n- `es`: Latin American Spanish\n\n## What Appears in Each Language\n\n| Field                        | Language     | Example (Spanish course, English native)                  |\n| ---------------------------- | ------------ | --------------------------------------------------------- |\n| `scenario`                   | NATIVE       | \"You're at a cafe in Madrid and want to order coffee.\"    |\n| `context`                    | TARGET       | \"Buenos dias, que le pongo?\"                              |\n| `contextTranslation`         | NATIVE       | \"Good morning, what can I get you?\"                       |\n| `contextRomanization`        | Romanization | \"\" (empty for Roman scripts)                              |\n| `options[].text`             | TARGET       | \"Un cafe con leche, por favor.\"                           |\n| `options[].textRomanization` | Romanization | \"\" (empty for Roman scripts)                              |\n| `options[].feedback`         | NATIVE       | \"A coffee with milk, please - Perfect! Polite and clear.\" |\n\n# Options Design\n\n## No Translations in Options\n\nThis is the most critical design decision. Options show ONLY:\n\n- `text`: The phrase in TARGET language\n- `textRomanization`: Romanization for non-Roman scripts (empty string for Roman scripts)\n\n**NO translation is shown**. This forces the learner to:\n\n1. Parse the target language directly\n2. Use patterns they've learned\n3. Make educated guesses based on context\n4. Experience the productive struggle of real communication\n\n## Option Quality\n\nAll 4 options must be:\n\n- **Grammatically correct** in the target language\n- **Contextually plausible** (something a learner might say in this situation)\n- **Distinct in meaning** (not just word variations)\n- **Level-appropriate** (using vocabulary/structures the learner knows)\n\n## Distractor Design\n\n**CRITICAL**: Wrong options must be genuinely inappropriate for the situation - they should lead to miscommunication or confusion if used. Do NOT create distractors that are merely \"less polished\" versions of the correct answer.\n\nWrong options should be **clearly wrong** because they:\n\n1. **Answer a different question**: Respond to something the speaker didn't ask (asking about price when asked about quantity)\n2. **Request the wrong thing**: Order/ask for something different than intended (one-way ticket when you need round-trip)\n3. **Are off-topic**: Say something unrelated to the current conversation point (asking for the check when you just arrived)\n4. **Would cause confusion**: Use words that change the meaning entirely (saying \"no\" when you mean \"yes\")\n\n**DO NOT** create distractors that are:\n\n- Just more/less formal versions of the correct answer\n- Slightly different phrasings that would still work\n- Grammatically awkward but still understandable\n\n# Feedback Design\n\nFeedback appears AFTER the learner selects an option. Every feedback message MUST include:\n\n1. **Translation**: What the option actually means in the native language\n2. **Explanation**: Why this choice is correct or incorrect for the situation\n\n## Feedback Structure\n\nFor **correct** options:\n\n```\n\"[Translation of what they said] - [Why this works in context]\"\n```\n\nExample: \"A coffee with milk, please - Perfect! This is polite and clearly communicates what you want.\"\n\nFor **incorrect** options:\n\n```\n\"[Translation of what they said] - [Why this doesn't work and what would be better]\"\n```\n\nExample: \"Where is the bathroom? - You're trying to order coffee, not find the restroom. Tell the barista what you'd like to drink.\"\n\n# Romanization Requirements\n\nFor languages using non-Roman writing systems (Japanese, Chinese, Korean, Arabic, Russian, Greek, Hebrew, Thai, Hindi, etc.), provide romanization for both context and options.\n\n## Standard Systems\n\n- **Japanese**: Romaji using Hepburn romanization\n- **Chinese**: Pinyin with tone marks\n- **Korean**: Revised Romanization of Korean\n- **Russian**: ISO 9 or BGN/PCGN transliteration\n- **Arabic**: Standard romanization\n- **Greek**: Standard transliteration\n- **Thai**: Royal Thai General System\n- **Hindi**: IAST or Hunterian transliteration\n\n## Roman Scripts\n\nFor languages using Roman letters (Spanish, French, German, Portuguese, Italian, etc.), set both `contextRomanization` and `textRomanization` to empty strings `\"\"`.\n\n# Story Arc\n\nEach story should have 5-10 steps following a natural arc:\n\n## Step Progression\n\n1. **Opening** (1-2 steps): Arrive at the location, initial greeting\n2. **Building** (2-4 steps): Main interaction, making requests, clarifying\n3. **Complication** (0-2 steps): Optional challenge that adds realism\n4. **Resolution** (1-2 steps): Complete the transaction\n5. **Closing** (1 step): Thank and goodbye\n\n## Complication Ideas (Recommended)\n\nAdding a complication makes the story more realistic and teaches learners to handle unexpected situations:\n\n- **Item unavailable**: \"Sorry, we're out of that. Would you like something else?\"\n- **Misunderstanding**: \"Did you say two or twelve?\"\n- **Additional requirement**: \"I'll need to see your ID for that.\"\n- **Clarification needed**: \"Which size did you want?\"\n\n## Pacing Guidelines\n\n- Steps should feel like natural conversation beats\n- Each step presents ONE decision point\n- Context should flow naturally from the previous step\n- The native speaker's response should acknowledge what the learner said\n\n# Output Format\n\nReturn an object with this structure (abbreviated examples shown):\n\n**Non-Roman script example (Japanese):**\n\n```json\n{\n  \"scenario\": \"You're at a train station in Tokyo...\",\n  \"steps\": [\n    {\n      \"context\": \"いらっしゃいませ。どちらまで？\",\n      \"contextTranslation\": \"Welcome. Where to?\",\n      \"contextRomanization\": \"Irasshaimase. Dochira made?\",\n      \"options\": [\n        {\n          \"text\": \"京都までお願いします。\",\n          \"textRomanization\": \"Kyouto made onegaishimasu.\",\n          \"isCorrect\": true,\n          \"feedback\": \"To Kyoto, please - Perfect!\"\n        },\n        {\n          \"text\": \"京都は遠いですか？\",\n          \"textRomanization\": \"Kyouto wa tooi desu ka?\",\n          \"isCorrect\": false,\n          \"feedback\": \"Is Kyoto far? - This asks about distance, not for a ticket.\"\n        }\n      ]\n    }\n  ]\n}\n```\n\n**Roman script example (Spanish) - empty romanization fields:**\n\n```json\n{\n  \"scenario\": \"You're at a restaurant in Barcelona...\",\n  \"steps\": [\n    {\n      \"context\": \"Buenas noches. Estan listos para pedir?\",\n      \"contextTranslation\": \"Good evening. Are you ready to order?\",\n      \"contextRomanization\": \"\",\n      \"options\": [\n        {\n          \"text\": \"Si, me gustaria la paella, por favor.\",\n          \"textRomanization\": \"\",\n          \"isCorrect\": true,\n          \"feedback\": \"Yes, I would like the paella, please - Perfect!\"\n        },\n        {\n          \"text\": \"La cuenta, por favor.\",\n          \"textRomanization\": \"\",\n          \"isCorrect\": false,\n          \"feedback\": \"The check, please - You haven't eaten yet!\"\n        }\n      ]\n    }\n  ]\n}\n```\n\nNote: Examples above are abbreviated. Actual output must have 4 options per step and 5-10 steps total.\n\n# Quality Checklist\n\nBefore finalizing, verify:\n\n1. **Grammar accuracy**: All target language text is grammatically correct\n2. **Natural dialogue**: Conversations flow like real interactions\n3. **Appropriate register**: Formality matches the situation (casual cafe vs formal office)\n4. **Cultural accuracy**: Interactions reflect how things work in that culture\n5. **Clear progression**: Steps follow a logical narrative arc\n6. **Distinct options**: Each option represents a meaningfully different choice\n7. **Helpful feedback**: Translations and explanations clarify meaning and context\n8. **Correct romanization**: Follows standard systems for non-Roman scripts, empty for Roman scripts\n9. **Scenario relevance**: The story matches the lesson topic\n10. **Appropriate difficulty**: Language complexity matches learner level\n\n# Common Mistakes to Avoid\n\n1. **Including translations in options**: Options must show TARGET language only\n2. **Trivial distractors**: Options that are obviously wrong or nonsensical\n3. **Inconsistent register**: Mixing formal and informal inappropriately\n4. **Unnatural responses**: Things a native speaker would never actually say\n5. **Missing romanization**: Forgetting to add romanization for non-Roman scripts\n6. **Adding romanization to Roman scripts**: Spanish, French, etc. should have empty strings\n7. **Feedback without translation**: Always include what the option means\n8. **Disconnected steps**: Each step should follow logically from the previous one\n",
      "testCaseId": "es-korean-asking-directions-1",
      "userPrompt": "TARGET_LANGUAGE: Korean\nNATIVE_LANGUAGE: es\nCHAPTER_TITLE: Transporte y Direcciones\nLESSON_TITLE: Pidiendo Direcciones\nLESSON_DESCRIPTION: Como pedir direcciones y entender indicaciones basicas en coreano\n\nGenerate an immersive dialogue-driven story activity for this language lesson. Create a realistic everyday scenario where learners practice language production in situations they'd face in a foreign country."
    },
    {
      "duration": 94364.39604199998,
      "inputTokens": 2650,
      "output": "{\n  \"scenario\": \"You're at a pharmacy in Madrid. You need to describe your symptoms and buy medicine for a sore throat and cough.\",\n  \"steps\": [\n    {\n      \"context\": \"Buenos días. ¿En qué puedo ayudarle?\",\n      \"contextRomanization\": \"\",\n      \"contextTranslation\": \"Good morning. How can I help you?\",\n      \"options\": [\n        {\n          \"feedback\": \"Good morning. I have a sore throat and I need something for the pain. - Correct. This clearly explains your main problem and what you want the pharmacist to help with.\",\n          \"isCorrect\": true,\n          \"text\": \"Buenos días. Tengo dolor de garganta y necesito algo para el dolor.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Where is the bathroom? - Incorrect. The pharmacist is asking how they can help with a health problem; asking for the bathroom doesn't address your medical needs.\",\n          \"isCorrect\": false,\n          \"text\": \"¿Dónde está el baño?\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"I would like to open a bank account. - Incorrect. That's unrelated to the pharmacy; it won't help you get medicine.\",\n          \"isCorrect\": false,\n          \"text\": \"Quisiera abrir una cuenta bancaria.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"I need a prescription for diabetes. - Incorrect. That could be a medical request, but it doesn't describe your current symptom (sore throat). It's better to say what hurts now.\",\n          \"isCorrect\": false,\n          \"text\": \"Necesito una receta para la diabetes.\",\n          \"textRomanization\": \"\"\n        }\n      ]\n    },\n    {\n      \"context\": \"¿Desde cuándo le duele la garganta?\",\n      \"contextRomanization\": \"\",\n      \"contextTranslation\": \"Since when has your throat been hurting?\",\n      \"options\": [\n        {\n          \"feedback\": \"For two days. - Correct. This directly answers the pharmacist's question about duration.\",\n          \"isCorrect\": true,\n          \"text\": \"Desde hace dos días.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"The weather is nice today. - Incorrect. This doesn't answer how long you've had the symptom.\",\n          \"isCorrect\": false,\n          \"text\": \"Hace buen tiempo hoy.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"It always hurts when I run. - Incorrect. This gives a general condition but doesn't tell the pharmacist when the current pain started; the pharmacist needs the timeframe.\",\n          \"isCorrect\": false,\n          \"text\": \"Siempre me duele cuando corro.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"I don't know. - Incorrect. If you can, give an estimate (e.g., 'desde hace dos días'); 'I don't know' makes it harder for the pharmacist to choose treatment.\",\n          \"isCorrect\": false,\n          \"text\": \"No sé.\",\n          \"textRomanization\": \"\"\n        }\n      ]\n    },\n    {\n      \"context\": \"¿Tiene fiebre o tos?\",\n      \"contextRomanization\": \"\",\n      \"contextTranslation\": \"Do you have a fever or cough?\",\n      \"options\": [\n        {\n          \"feedback\": \"Yes, I have a little fever and some cough. - Correct. This gives the pharmacist the symptom details they asked for so they can recommend appropriate medicine.\",\n          \"isCorrect\": true,\n          \"text\": \"Sí, tengo un poco de fiebre y algo de tos.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"No, I'm just on vacation. - Incorrect. That doesn't answer whether you have fever or cough; the pharmacist needs specific symptom information.\",\n          \"isCorrect\": false,\n          \"text\": \"No, solo estoy de vacaciones.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"No, but I'm allergic to penicillin. - Incorrect here. The pharmacist asked about fever or cough; mention allergies when they ask about them so the conversation stays clear.\",\n          \"isCorrect\": false,\n          \"text\": \"No, pero soy alérgico a la penicilina.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"I only want sleeping pills. - Incorrect. That doesn't answer the symptom question and requests an unrelated medicine.\",\n          \"isCorrect\": false,\n          \"text\": \"Solo quiero pastillas para dormir.\",\n          \"textRomanization\": \"\"\n        }\n      ]\n    },\n    {\n      \"context\": \"¿Es alérgico a algún medicamento o toma otros ahora?\",\n      \"contextRomanization\": \"\",\n      \"contextTranslation\": \"Are you allergic to any medication or are you taking any others right now?\",\n      \"options\": [\n        {\n          \"feedback\": \"No, I'm not allergic and I'm not taking other medications. - Correct. This directly answers both parts (allergies and current meds), which helps the pharmacist choose safe options.\",\n          \"isCorrect\": true,\n          \"text\": \"No, no soy alérgico y no tomo otros medicamentos.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"I only want vitamins. - Incorrect. That doesn't answer whether you have medication allergies or if you're currently taking medications.\",\n          \"isCorrect\": false,\n          \"text\": \"Solo quiero vitaminas.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"I'm allergic to dust. - Incorrect. A dust allergy is not the same as a drug allergy; the pharmacist specifically asked about medication allergies and current medicines.\",\n          \"isCorrect\": false,\n          \"text\": \"Soy alérgico al polvo.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"I need to speak with my lawyer. - Incorrect. This is unrelated and doesn't answer the pharmacist's medical safety question.\",\n          \"isCorrect\": false,\n          \"text\": \"Necesito hablar con mi abogado.\",\n          \"textRomanization\": \"\"\n        }\n      ]\n    },\n    {\n      \"context\": \"Le recomiendo este jarabe para la tos y pastillas para la garganta. ¿Quiere que le explique la dosis?\",\n      \"contextRomanization\": \"\",\n      \"contextTranslation\": \"I recommend this cough syrup and throat lozenges. Would you like me to explain the dosage?\",\n      \"options\": [\n        {\n          \"feedback\": \"Yes, please explain it to me. - Correct. You accept the recommendation and ask for dosage instructions, which is important for safe use.\",\n          \"isCorrect\": true,\n          \"text\": \"Sí, por favor, explíquemelo.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"No, I want antibiotics without a prescription. - Incorrect. Asking for antibiotics without a prescription is inappropriate; pharmacists will not provide antibiotics OTC and it's unsafe.\",\n          \"isCorrect\": false,\n          \"text\": \"No, quiero antibióticos sin receta.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"I only want the cheapest box. - Incorrect. The pharmacist asked if you want the dosage explained; asking only about price avoids the safety question about how to take the medicine.\",\n          \"isCorrect\": false,\n          \"text\": \"Solo quiero la caja más barata.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Thanks, I'm leaving. - Incorrect. That doesn't respond to the pharmacist's offer to explain dosage; if you plan to take the medicines, it's better to hear the instructions.\",\n          \"isCorrect\": false,\n          \"text\": \"Gracias, me voy.\",\n          \"textRomanization\": \"\"\n        }\n      ]\n    },\n    {\n      \"context\": \"Lo siento, ahora mismo no tenemos el jarabe. ¿Le sirven pastillas y un spray para la garganta?\",\n      \"contextRomanization\": \"\",\n      \"contextTranslation\": \"Sorry, we don't have the syrup right now. Would lozenges and a throat spray work for you?\",\n      \"options\": [\n        {\n          \"feedback\": \"Yes, that's fine. I'll take the lozenges and the spray, please. - Correct. You accept the alternative the pharmacist offered, which keeps the interaction moving toward a solution.\",\n          \"isCorrect\": true,\n          \"text\": \"Sí, está bien. Tomaré pastillas y el spray, por favor.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"No, I want antibiotics. - Incorrect. Again, requesting antibiotics is inappropriate for this OTC situation and may be refused; antibiotics are not the typical response to common colds or sore throats without a prescription.\",\n          \"isCorrect\": false,\n          \"text\": \"No, quiero antibióticos.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"I'll come tomorrow at nine. - Incorrect. This doesn't directly respond to whether the offered alternative works for you now.\",\n          \"isCorrect\": false,\n          \"text\": \"Vengo mañana a las nueve.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Do you only accept cash? - Incorrect. This is a payment question and doesn't answer whether the alternative medicines suit you now.\",\n          \"isCorrect\": false,\n          \"text\": \"¿Solo aceptan efectivo?\",\n          \"textRomanization\": \"\"\n        }\n      ]\n    },\n    {\n      \"context\": \"Serían 12 euros en total. ¿Paga en efectivo o con tarjeta?\",\n      \"contextRomanization\": \"\",\n      \"contextTranslation\": \"That will be 12 euros total. Do you pay in cash or with card?\",\n      \"options\": [\n        {\n          \"feedback\": \"I pay with card, please. - Correct. This clearly answers the payment question so the pharmacist can process the sale.\",\n          \"isCorrect\": true,\n          \"text\": \"Pago con tarjeta, por favor.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"I don't have money. - Incorrect. That doesn't resolve the immediate payment request; if you need help, ask if they accept card or explain another payment method.\",\n          \"isCorrect\": false,\n          \"text\": \"No tengo dinero.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Can you give it to me for free? - Incorrect. Asking for free medicine is inappropriate; better to ask about price, generic options, or insurance coverage if applicable.\",\n          \"isCorrect\": false,\n          \"text\": \"¿Puede dármelo gratis?\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"I want to return the product later. - Incorrect. This doesn't answer how you will pay now; if you plan to return, discuss return policy after purchase.\",\n          \"isCorrect\": false,\n          \"text\": \"Quiero devolver el producto después.\",\n          \"textRomanization\": \"\"\n        }\n      ]\n    },\n    {\n      \"context\": \"Perfecto. Aquí tiene. Que se mejore pronto.\",\n      \"contextRomanization\": \"\",\n      \"contextTranslation\": \"Perfect. Here you go. Get well soon.\",\n      \"options\": [\n        {\n          \"feedback\": \"Thank you very much. Very kind. Goodbye. - Correct. A polite closing thanks the pharmacist and ends the interaction naturally.\",\n          \"isCorrect\": true,\n          \"text\": \"Muchas gracias. Muy amable. Adiós.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"I have another question about my visa. - Incorrect. This is off-topic for the pharmacy interaction; if you have other concerns, ask a different appropriate person or at the correct service desk.\",\n          \"isCorrect\": false,\n          \"text\": \"Tengo otra pregunta sobre mi visa.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"See you never. - Incorrect. This is rude and unnecessary; a polite goodbye is better.\",\n          \"isCorrect\": false,\n          \"text\": \"Hasta nunca.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Can you prescribe me an operation? - Incorrect. This is unrelated and unrealistic; operations require doctors and proper medical evaluation.\",\n          \"isCorrect\": false,\n          \"text\": \"¿Puede recetarme una operación?\",\n          \"textRomanization\": \"\"\n        }\n      ]\n    }\n  ]\n}",
      "outputTokens": 6051,
      "systemPrompt": "# Role\n\nYou are an expert language immersion designer specializing in creating realistic, dialogue-driven scenarios that help learners practice language production in authentic contexts. You design experiences that simulate situations learners would encounter when living or traveling in a country where the target language is spoken.\n\n# Goal\n\nCreate an immersive story activity where learners are placed in an everyday situation and must choose appropriate phrases to communicate. The activity simulates real conversations with native speakers, forcing learners to engage with the target language directly rather than relying on translations.\n\nThe activity places learners in a specific scenario (ordering food, asking for directions, checking into a hotel) and guides them through a dialogue where they must select appropriate responses at each step.\n\n# Key Design Principles\n\n## Immersion Over Translation\n\nUnlike other activities where translations help comprehension, this activity intentionally withholds translations from the options. Learners see:\n\n- **Context**: What the native speaker says (in TARGET language with translation)\n- **Options**: Four possible responses (in TARGET language ONLY - no translations)\n\nThis forces learners to:\n\n1. Engage with the target language sounds and patterns\n2. Use context clues to infer meaning\n3. Build recognition before relying on translations\n4. Experience the \"productive uncertainty\" of real conversations\n\nThe translation appears only in the feedback AFTER selection, revealing whether they understood correctly.\n\n## Authentic Scenarios\n\nFocus on situations learners will actually encounter:\n\n| Category       | Example Scenarios                                  |\n| -------------- | -------------------------------------------------- |\n| Food & Dining  | Ordering at a restaurant, asking about ingredients |\n| Transportation | Buying train tickets, asking for directions        |\n| Shopping       | Bargaining at a market, returning an item          |\n| Accommodation  | Checking into a hotel, reporting a problem         |\n| Healthcare     | Describing symptoms at a pharmacy, doctor's visit  |\n| Social         | Meeting neighbors, small talk at a cafe            |\n| Services       | Opening a bank account, getting a phone plan       |\n| Emergencies    | Reporting lost items, asking for help              |\n\n## Supportive Native Speaker\n\nThe character in the story is a friendly native speaker who:\n\n- Speaks naturally but not too fast\n- Helps the learner when they struggle\n- Provides context clues in their responses\n- Never mocks mistakes\n- Gradually introduces more complex language\n\n# Language Handling\n\n## Input Variables\n\n- **TARGET_LANGUAGE**: The language being learned (from `courseTitle`). All dialogue and options are in this language.\n- **NATIVE_LANGUAGE**: The learner's native language (from `language` code). Questions, feedback, and context translations use this language.\n\n## Language Codes\n\n- `en`: US English\n- `pt`: Brazilian Portuguese\n- `es`: Latin American Spanish\n\n## What Appears in Each Language\n\n| Field                        | Language     | Example (Spanish course, English native)                  |\n| ---------------------------- | ------------ | --------------------------------------------------------- |\n| `scenario`                   | NATIVE       | \"You're at a cafe in Madrid and want to order coffee.\"    |\n| `context`                    | TARGET       | \"Buenos dias, que le pongo?\"                              |\n| `contextTranslation`         | NATIVE       | \"Good morning, what can I get you?\"                       |\n| `contextRomanization`        | Romanization | \"\" (empty for Roman scripts)                              |\n| `options[].text`             | TARGET       | \"Un cafe con leche, por favor.\"                           |\n| `options[].textRomanization` | Romanization | \"\" (empty for Roman scripts)                              |\n| `options[].feedback`         | NATIVE       | \"A coffee with milk, please - Perfect! Polite and clear.\" |\n\n# Options Design\n\n## No Translations in Options\n\nThis is the most critical design decision. Options show ONLY:\n\n- `text`: The phrase in TARGET language\n- `textRomanization`: Romanization for non-Roman scripts (empty string for Roman scripts)\n\n**NO translation is shown**. This forces the learner to:\n\n1. Parse the target language directly\n2. Use patterns they've learned\n3. Make educated guesses based on context\n4. Experience the productive struggle of real communication\n\n## Option Quality\n\nAll 4 options must be:\n\n- **Grammatically correct** in the target language\n- **Contextually plausible** (something a learner might say in this situation)\n- **Distinct in meaning** (not just word variations)\n- **Level-appropriate** (using vocabulary/structures the learner knows)\n\n## Distractor Design\n\n**CRITICAL**: Wrong options must be genuinely inappropriate for the situation - they should lead to miscommunication or confusion if used. Do NOT create distractors that are merely \"less polished\" versions of the correct answer.\n\nWrong options should be **clearly wrong** because they:\n\n1. **Answer a different question**: Respond to something the speaker didn't ask (asking about price when asked about quantity)\n2. **Request the wrong thing**: Order/ask for something different than intended (one-way ticket when you need round-trip)\n3. **Are off-topic**: Say something unrelated to the current conversation point (asking for the check when you just arrived)\n4. **Would cause confusion**: Use words that change the meaning entirely (saying \"no\" when you mean \"yes\")\n\n**DO NOT** create distractors that are:\n\n- Just more/less formal versions of the correct answer\n- Slightly different phrasings that would still work\n- Grammatically awkward but still understandable\n\n# Feedback Design\n\nFeedback appears AFTER the learner selects an option. Every feedback message MUST include:\n\n1. **Translation**: What the option actually means in the native language\n2. **Explanation**: Why this choice is correct or incorrect for the situation\n\n## Feedback Structure\n\nFor **correct** options:\n\n```\n\"[Translation of what they said] - [Why this works in context]\"\n```\n\nExample: \"A coffee with milk, please - Perfect! This is polite and clearly communicates what you want.\"\n\nFor **incorrect** options:\n\n```\n\"[Translation of what they said] - [Why this doesn't work and what would be better]\"\n```\n\nExample: \"Where is the bathroom? - You're trying to order coffee, not find the restroom. Tell the barista what you'd like to drink.\"\n\n# Romanization Requirements\n\nFor languages using non-Roman writing systems (Japanese, Chinese, Korean, Arabic, Russian, Greek, Hebrew, Thai, Hindi, etc.), provide romanization for both context and options.\n\n## Standard Systems\n\n- **Japanese**: Romaji using Hepburn romanization\n- **Chinese**: Pinyin with tone marks\n- **Korean**: Revised Romanization of Korean\n- **Russian**: ISO 9 or BGN/PCGN transliteration\n- **Arabic**: Standard romanization\n- **Greek**: Standard transliteration\n- **Thai**: Royal Thai General System\n- **Hindi**: IAST or Hunterian transliteration\n\n## Roman Scripts\n\nFor languages using Roman letters (Spanish, French, German, Portuguese, Italian, etc.), set both `contextRomanization` and `textRomanization` to empty strings `\"\"`.\n\n# Story Arc\n\nEach story should have 5-10 steps following a natural arc:\n\n## Step Progression\n\n1. **Opening** (1-2 steps): Arrive at the location, initial greeting\n2. **Building** (2-4 steps): Main interaction, making requests, clarifying\n3. **Complication** (0-2 steps): Optional challenge that adds realism\n4. **Resolution** (1-2 steps): Complete the transaction\n5. **Closing** (1 step): Thank and goodbye\n\n## Complication Ideas (Recommended)\n\nAdding a complication makes the story more realistic and teaches learners to handle unexpected situations:\n\n- **Item unavailable**: \"Sorry, we're out of that. Would you like something else?\"\n- **Misunderstanding**: \"Did you say two or twelve?\"\n- **Additional requirement**: \"I'll need to see your ID for that.\"\n- **Clarification needed**: \"Which size did you want?\"\n\n## Pacing Guidelines\n\n- Steps should feel like natural conversation beats\n- Each step presents ONE decision point\n- Context should flow naturally from the previous step\n- The native speaker's response should acknowledge what the learner said\n\n# Output Format\n\nReturn an object with this structure (abbreviated examples shown):\n\n**Non-Roman script example (Japanese):**\n\n```json\n{\n  \"scenario\": \"You're at a train station in Tokyo...\",\n  \"steps\": [\n    {\n      \"context\": \"いらっしゃいませ。どちらまで？\",\n      \"contextTranslation\": \"Welcome. Where to?\",\n      \"contextRomanization\": \"Irasshaimase. Dochira made?\",\n      \"options\": [\n        {\n          \"text\": \"京都までお願いします。\",\n          \"textRomanization\": \"Kyouto made onegaishimasu.\",\n          \"isCorrect\": true,\n          \"feedback\": \"To Kyoto, please - Perfect!\"\n        },\n        {\n          \"text\": \"京都は遠いですか？\",\n          \"textRomanization\": \"Kyouto wa tooi desu ka?\",\n          \"isCorrect\": false,\n          \"feedback\": \"Is Kyoto far? - This asks about distance, not for a ticket.\"\n        }\n      ]\n    }\n  ]\n}\n```\n\n**Roman script example (Spanish) - empty romanization fields:**\n\n```json\n{\n  \"scenario\": \"You're at a restaurant in Barcelona...\",\n  \"steps\": [\n    {\n      \"context\": \"Buenas noches. Estan listos para pedir?\",\n      \"contextTranslation\": \"Good evening. Are you ready to order?\",\n      \"contextRomanization\": \"\",\n      \"options\": [\n        {\n          \"text\": \"Si, me gustaria la paella, por favor.\",\n          \"textRomanization\": \"\",\n          \"isCorrect\": true,\n          \"feedback\": \"Yes, I would like the paella, please - Perfect!\"\n        },\n        {\n          \"text\": \"La cuenta, por favor.\",\n          \"textRomanization\": \"\",\n          \"isCorrect\": false,\n          \"feedback\": \"The check, please - You haven't eaten yet!\"\n        }\n      ]\n    }\n  ]\n}\n```\n\nNote: Examples above are abbreviated. Actual output must have 4 options per step and 5-10 steps total.\n\n# Quality Checklist\n\nBefore finalizing, verify:\n\n1. **Grammar accuracy**: All target language text is grammatically correct\n2. **Natural dialogue**: Conversations flow like real interactions\n3. **Appropriate register**: Formality matches the situation (casual cafe vs formal office)\n4. **Cultural accuracy**: Interactions reflect how things work in that culture\n5. **Clear progression**: Steps follow a logical narrative arc\n6. **Distinct options**: Each option represents a meaningfully different choice\n7. **Helpful feedback**: Translations and explanations clarify meaning and context\n8. **Correct romanization**: Follows standard systems for non-Roman scripts, empty for Roman scripts\n9. **Scenario relevance**: The story matches the lesson topic\n10. **Appropriate difficulty**: Language complexity matches learner level\n\n# Common Mistakes to Avoid\n\n1. **Including translations in options**: Options must show TARGET language only\n2. **Trivial distractors**: Options that are obviously wrong or nonsensical\n3. **Inconsistent register**: Mixing formal and informal inappropriately\n4. **Unnatural responses**: Things a native speaker would never actually say\n5. **Missing romanization**: Forgetting to add romanization for non-Roman scripts\n6. **Adding romanization to Roman scripts**: Spanish, French, etc. should have empty strings\n7. **Feedback without translation**: Always include what the option means\n8. **Disconnected steps**: Each step should follow logically from the previous one\n",
      "testCaseId": "en-spanish-pharmacy-visit-1",
      "userPrompt": "TARGET_LANGUAGE: Spanish\nNATIVE_LANGUAGE: en\nCHAPTER_TITLE: Health and Wellness\nLESSON_TITLE: At the Pharmacy\nLESSON_DESCRIPTION: Learn to describe symptoms and buy medicine at a Spanish pharmacy\n\nGenerate an immersive dialogue-driven story activity for this language lesson. Create a realistic everyday scenario where learners practice language production in situations they'd face in a foreign country."
    }
  ],
  "taskId": "activity-story-language"
}
