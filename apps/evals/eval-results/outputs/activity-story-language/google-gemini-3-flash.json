{
  "generatedAt": "2026-01-21T21:26:38.389Z",
  "modelId": "google/gemini-3-flash",
  "outputs": [
    {
      "duration": 33999.303167000005,
      "inputTokens": 2681,
      "output": "{\n  \"scenario\": \"You're at a traditional French cafe in Paris. You need to find a seat, order a drink and a snack, and eventually pay the bill.\",\n  \"steps\": [\n    {\n      \"context\": \"Bonjour ! Bienvenue au Petit Journal. Une table pour une personne ?\",\n      \"contextRomanization\": \"\",\n      \"contextTranslation\": \"Hello! Welcome to Le Petit Journal. A table for one person?\",\n      \"options\": [\n        {\n          \"feedback\": \"Hello, yes, please - Perfect! This is a polite way to confirm you want a table.\",\n          \"isCorrect\": true,\n          \"text\": \"Bonjour, oui, s'il vous plaît.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"The bill, please - You just arrived! You can't ask for the bill before you've even sat down.\",\n          \"isCorrect\": false,\n          \"text\": \"L'addition, s'il vous plaît.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Where is the train station? - You're at a cafe to eat, not at a tourist information desk.\",\n          \"isCorrect\": false,\n          \"text\": \"Où est la gare ?\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"I'd like a room - This is a cafe, not a hotel. You shouldn't ask for a room here.\",\n          \"isCorrect\": false,\n          \"text\": \"Je voudrais une chambre.\",\n          \"textRomanization\": \"\"\n        }\n      ]\n    },\n    {\n      \"context\": \"Très bien, asseyez-vous. Je vous apporte la carte tout de suite... Qu'est-ce que vous aimeriez boire ?\",\n      \"contextRomanization\": \"\",\n      \"contextTranslation\": \"Very well, have a seat. I'll bring the menu right away... What would you like to drink?\",\n      \"options\": [\n        {\n          \"feedback\": \"I would like a hot chocolate, please - Great choice! This clearly states what you want to drink.\",\n          \"isCorrect\": true,\n          \"text\": \"Je voudrais un chocolat chaud, s'il vous plaît.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"What time is it? - The waiter asked for your drink order, not for the time.\",\n          \"isCorrect\": false,\n          \"text\": \"Il est quelle heure ?\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Nice to meet you - This is a bit too formal and personal for ordering a drink from a waiter.\",\n          \"isCorrect\": false,\n          \"text\": \"Enchanté.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"I'm looking for a taxi - You are already inside the cafe. You should order your drink first.\",\n          \"isCorrect\": false,\n          \"text\": \"Je cherche un taxi.\",\n          \"textRomanization\": \"\"\n        }\n      ]\n    },\n    {\n      \"context\": \"Ah, je suis désolé, la machine à chocolat est en panne. Voulez-vous un thé ou un jus d'orange à la place ?\",\n      \"contextRomanization\": \"\",\n      \"contextTranslation\": \"Ah, I'm sorry, the chocolate machine is broken. Would you like a tea or an orange juice instead?\",\n      \"options\": [\n        {\n          \"feedback\": \"An orange juice, please - Perfect! This responds directly to the waiter's suggestion.\",\n          \"isCorrect\": true,\n          \"text\": \"Un jus d'orange, s'il vous plaît.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Where are the toilets? - You should answer the waiter's question about the drink before asking for the restroom.\",\n          \"isCorrect\": false,\n          \"text\": \"Où sont les toilettes ?\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"It's too expensive - This is a bit rude and doesn't help move the order along.\",\n          \"isCorrect\": false,\n          \"text\": \"C'est trop cher.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"I want a train ticket - You are still at the cafe, not the train station.\",\n          \"isCorrect\": false,\n          \"text\": \"Je veux un billet de train.\",\n          \"textRomanization\": \"\"\n        }\n      ]\n    },\n    {\n      \"context\": \"Très bien, un jus d'orange. Et pour manger ? Nos croissants sont excellents aujourd'hui.\",\n      \"contextRomanization\": \"\",\n      \"contextTranslation\": \"Very well, one orange juice. And to eat? Our croissants are excellent today.\",\n      \"options\": [\n        {\n          \"feedback\": \"I'll take a croissant too, thanks - Excellent! This follows the waiter's recommendation perfectly.\",\n          \"isCorrect\": true,\n          \"text\": \"Je vais prendre un croissant aussi, merci.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Goodbye, sir - You haven't received your drink or food yet! It's too early to leave.\",\n          \"isCorrect\": false,\n          \"text\": \"Au revoir, monsieur.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"What is your name? - It's unusual to ask a waiter's name when ordering food in France.\",\n          \"isCorrect\": false,\n          \"text\": \"Quel est votre nom ?\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"I would like a car - This has nothing to do with ordering food at a cafe.\",\n          \"isCorrect\": false,\n          \"text\": \"Je voudrais une voiture.\",\n          \"textRomanization\": \"\"\n        }\n      ]\n    },\n    {\n      \"context\": \"Parfait. Je vous apporte ça dans un instant... Voilà votre jus et votre croissant. Bon appétit !\",\n      \"contextRomanization\": \"\",\n      \"contextTranslation\": \"Perfect. I'll bring that in a moment... Here is your juice and your croissant. Enjoy your meal!\",\n      \"options\": [\n        {\n          \"feedback\": \"Thank you very much - Correct! It's always important to be polite when the waiter serves you.\",\n          \"isCorrect\": true,\n          \"text\": \"Merci beaucoup.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"It's cold - A croissant is often served at room temperature, and complaining immediately is quite rude.\",\n          \"isCorrect\": false,\n          \"text\": \"C'est froid.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Where is the Eiffel Tower? - You should enjoy your food before asking for directions.\",\n          \"isCorrect\": false,\n          \"text\": \"Où est la tour Eiffel ?\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"I don't understand - The waiter just said 'enjoy your meal', which is a very common phrase.\",\n          \"isCorrect\": false,\n          \"text\": \"Je ne comprends pas.\",\n          \"textRomanization\": \"\"\n        }\n      ]\n    },\n    {\n      \"context\": \"Tout s'est bien passé ? Vous désirez autre chose ?\",\n      \"contextRomanization\": \"\",\n      \"contextTranslation\": \"Did everything go well? Would you like anything else?\",\n      \"options\": [\n        {\n          \"feedback\": \"It was very good, thanks. The bill, please - Perfect! This signals that you've finished and are ready to pay.\",\n          \"isCorrect\": true,\n          \"text\": \"C'était très bon, merci. L'addition, s'il vous plaît.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Hello, sir - You've already been at the cafe for a while; you don't need to greet him again.\",\n          \"isCorrect\": false,\n          \"text\": \"Bonjour, monsieur.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"I'd like a hotel - You are at a cafe. If you need a hotel, you should look for one elsewhere.\",\n          \"isCorrect\": false,\n          \"text\": \"Je voudrais un hôtel.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"My name is Jean - The waiter is asking about your meal, not your name.\",\n          \"isCorrect\": false,\n          \"text\": \"Je m'appelle Jean.\",\n          \"textRomanization\": \"\"\n        }\n      ]\n    },\n    {\n      \"context\": \"Bien sûr. Ça fait neuf euros, s'il vous plaît. Vous payez comment ?\",\n      \"contextRomanization\": \"\",\n      \"contextTranslation\": \"Of course. That's nine euros, please. How are you paying?\",\n      \"options\": [\n        {\n          \"feedback\": \"I'm paying by credit card - Correct! Most French cafes accept card payments for this amount.\",\n          \"isCorrect\": true,\n          \"text\": \"Je paye par carte bancaire.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"I am a tourist - This doesn't answer the question of how you will pay.\",\n          \"isCorrect\": false,\n          \"text\": \"Je suis touriste.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Do you have the time? - You need to pay for your meal before asking questions or leaving.\",\n          \"isCorrect\": false,\n          \"text\": \"Vous avez l'heure ?\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"No, thanks - You cannot say 'no' to paying the bill!\",\n          \"isCorrect\": false,\n          \"text\": \"Non, merci.\",\n          \"textRomanization\": \"\"\n        }\n      ]\n    }\n  ]\n}",
      "outputTokens": 4407,
      "systemPrompt": "# Role\n\nYou are an expert language immersion designer specializing in creating realistic, dialogue-driven scenarios that help learners practice language production in authentic contexts. You design experiences that simulate situations learners would encounter when living or traveling in a country where the target language is spoken.\n\n# Goal\n\nCreate an immersive story activity where learners are placed in an everyday situation and must choose appropriate phrases to communicate. The activity simulates real conversations with native speakers, forcing learners to engage with the target language directly rather than relying on translations.\n\nThe activity places learners in a specific scenario (ordering food, asking for directions, checking into a hotel) and guides them through a dialogue where they must select appropriate responses at each step.\n\n# Key Design Principles\n\n## Immersion Over Translation\n\nUnlike other activities where translations help comprehension, this activity intentionally withholds translations from the options. Learners see:\n\n- **Context**: What the native speaker says (in TARGET language with translation)\n- **Options**: Four possible responses (in TARGET language ONLY - no translations)\n\nThis forces learners to:\n\n1. Engage with the target language sounds and patterns\n2. Use context clues to infer meaning\n3. Build recognition before relying on translations\n4. Experience the \"productive uncertainty\" of real conversations\n\nThe translation appears only in the feedback AFTER selection, revealing whether they understood correctly.\n\n## Authentic Scenarios\n\nFocus on situations learners will actually encounter:\n\n| Category       | Example Scenarios                                  |\n| -------------- | -------------------------------------------------- |\n| Food & Dining  | Ordering at a restaurant, asking about ingredients |\n| Transportation | Buying train tickets, asking for directions        |\n| Shopping       | Bargaining at a market, returning an item          |\n| Accommodation  | Checking into a hotel, reporting a problem         |\n| Healthcare     | Describing symptoms at a pharmacy, doctor's visit  |\n| Social         | Meeting neighbors, small talk at a cafe            |\n| Services       | Opening a bank account, getting a phone plan       |\n| Emergencies    | Reporting lost items, asking for help              |\n\n## Supportive Native Speaker\n\nThe character in the story is a friendly native speaker who:\n\n- Speaks naturally but not too fast\n- Helps the learner when they struggle\n- Provides context clues in their responses\n- Never mocks mistakes\n- Gradually introduces more complex language\n\n# Language Handling\n\n## Input Variables\n\n- **TARGET_LANGUAGE**: The language being learned (from `courseTitle`). All dialogue and options are in this language.\n- **NATIVE_LANGUAGE**: The learner's native language (from `language` code). Questions, feedback, and context translations use this language.\n\n## Language Codes\n\n- `en`: US English\n- `pt`: Brazilian Portuguese\n- `es`: Latin American Spanish\n\n## What Appears in Each Language\n\n| Field                        | Language     | Example (Spanish course, English native)                  |\n| ---------------------------- | ------------ | --------------------------------------------------------- |\n| `scenario`                   | NATIVE       | \"You're at a cafe in Madrid and want to order coffee.\"    |\n| `context`                    | TARGET       | \"Buenos dias, que le pongo?\"                              |\n| `contextTranslation`         | NATIVE       | \"Good morning, what can I get you?\"                       |\n| `contextRomanization`        | Romanization | \"\" (empty for Roman scripts)                              |\n| `options[].text`             | TARGET       | \"Un cafe con leche, por favor.\"                           |\n| `options[].textRomanization` | Romanization | \"\" (empty for Roman scripts)                              |\n| `options[].feedback`         | NATIVE       | \"A coffee with milk, please - Perfect! Polite and clear.\" |\n\n# Options Design\n\n## No Translations in Options\n\nThis is the most critical design decision. Options show ONLY:\n\n- `text`: The phrase in TARGET language\n- `textRomanization`: Romanization for non-Roman scripts (empty string for Roman scripts)\n\n**NO translation is shown**. This forces the learner to:\n\n1. Parse the target language directly\n2. Use patterns they've learned\n3. Make educated guesses based on context\n4. Experience the productive struggle of real communication\n\n## Option Quality\n\nAll 4 options must be:\n\n- **Grammatically correct** in the target language\n- **Contextually plausible** (something a learner might say in this situation)\n- **Distinct in meaning** (not just word variations)\n- **Level-appropriate** (using vocabulary/structures the learner knows)\n\n## Distractor Design\n\n**CRITICAL**: Wrong options must be genuinely inappropriate for the situation - they should lead to miscommunication or confusion if used. Do NOT create distractors that are merely \"less polished\" versions of the correct answer.\n\nWrong options should be **clearly wrong** because they:\n\n1. **Answer a different question**: Respond to something the speaker didn't ask (asking about price when asked about quantity)\n2. **Request the wrong thing**: Order/ask for something different than intended (one-way ticket when you need round-trip)\n3. **Are off-topic**: Say something unrelated to the current conversation point (asking for the check when you just arrived)\n4. **Would cause confusion**: Use words that change the meaning entirely (saying \"no\" when you mean \"yes\")\n\n**DO NOT** create distractors that are:\n\n- Just more/less formal versions of the correct answer\n- Slightly different phrasings that would still work\n- Grammatically awkward but still understandable\n\n# Feedback Design\n\nFeedback appears AFTER the learner selects an option. Every feedback message MUST include:\n\n1. **Translation**: What the option actually means in the native language\n2. **Explanation**: Why this choice is correct or incorrect for the situation\n\n## Feedback Structure\n\nFor **correct** options:\n\n```\n\"[Translation of what they said] - [Why this works in context]\"\n```\n\nExample: \"A coffee with milk, please - Perfect! This is polite and clearly communicates what you want.\"\n\nFor **incorrect** options:\n\n```\n\"[Translation of what they said] - [Why this doesn't work and what would be better]\"\n```\n\nExample: \"Where is the bathroom? - You're trying to order coffee, not find the restroom. Tell the barista what you'd like to drink.\"\n\n# Romanization Requirements\n\nFor languages using non-Roman writing systems (Japanese, Chinese, Korean, Arabic, Russian, Greek, Hebrew, Thai, Hindi, etc.), provide romanization for both context and options.\n\n## Standard Systems\n\n- **Japanese**: Romaji using Hepburn romanization\n- **Chinese**: Pinyin with tone marks\n- **Korean**: Revised Romanization of Korean\n- **Russian**: ISO 9 or BGN/PCGN transliteration\n- **Arabic**: Standard romanization\n- **Greek**: Standard transliteration\n- **Thai**: Royal Thai General System\n- **Hindi**: IAST or Hunterian transliteration\n\n## Roman Scripts\n\nFor languages using Roman letters (Spanish, French, German, Portuguese, Italian, etc.), set both `contextRomanization` and `textRomanization` to empty strings `\"\"`.\n\n# Story Arc\n\nEach story should have 5-10 steps following a natural arc:\n\n## Step Progression\n\n1. **Opening** (1-2 steps): Arrive at the location, initial greeting\n2. **Building** (2-4 steps): Main interaction, making requests, clarifying\n3. **Complication** (0-2 steps): Optional challenge that adds realism\n4. **Resolution** (1-2 steps): Complete the transaction\n5. **Closing** (1 step): Thank and goodbye\n\n## Complication Ideas (Recommended)\n\nAdding a complication makes the story more realistic and teaches learners to handle unexpected situations:\n\n- **Item unavailable**: \"Sorry, we're out of that. Would you like something else?\"\n- **Misunderstanding**: \"Did you say two or twelve?\"\n- **Additional requirement**: \"I'll need to see your ID for that.\"\n- **Clarification needed**: \"Which size did you want?\"\n\n## Pacing Guidelines\n\n- Steps should feel like natural conversation beats\n- Each step presents ONE decision point\n- Context should flow naturally from the previous step\n- The native speaker's response should acknowledge what the learner said\n\n# Output Format\n\nReturn an object with this structure (abbreviated examples shown):\n\n**Non-Roman script example (Japanese):**\n\n```json\n{\n  \"scenario\": \"You're at a train station in Tokyo...\",\n  \"steps\": [\n    {\n      \"context\": \"いらっしゃいませ。どちらまで？\",\n      \"contextTranslation\": \"Welcome. Where to?\",\n      \"contextRomanization\": \"Irasshaimase. Dochira made?\",\n      \"options\": [\n        {\n          \"text\": \"京都までお願いします。\",\n          \"textRomanization\": \"Kyouto made onegaishimasu.\",\n          \"isCorrect\": true,\n          \"feedback\": \"To Kyoto, please - Perfect!\"\n        },\n        {\n          \"text\": \"京都は遠いですか？\",\n          \"textRomanization\": \"Kyouto wa tooi desu ka?\",\n          \"isCorrect\": false,\n          \"feedback\": \"Is Kyoto far? - This asks about distance, not for a ticket.\"\n        }\n      ]\n    }\n  ]\n}\n```\n\n**Roman script example (Spanish) - empty romanization fields:**\n\n```json\n{\n  \"scenario\": \"You're at a restaurant in Barcelona...\",\n  \"steps\": [\n    {\n      \"context\": \"Buenas noches. Estan listos para pedir?\",\n      \"contextTranslation\": \"Good evening. Are you ready to order?\",\n      \"contextRomanization\": \"\",\n      \"options\": [\n        {\n          \"text\": \"Si, me gustaria la paella, por favor.\",\n          \"textRomanization\": \"\",\n          \"isCorrect\": true,\n          \"feedback\": \"Yes, I would like the paella, please - Perfect!\"\n        },\n        {\n          \"text\": \"La cuenta, por favor.\",\n          \"textRomanization\": \"\",\n          \"isCorrect\": false,\n          \"feedback\": \"The check, please - You haven't eaten yet!\"\n        }\n      ]\n    }\n  ]\n}\n```\n\nNote: Examples above are abbreviated. Actual output must have 4 options per step and 5-10 steps total.\n\n# Quality Checklist\n\nBefore finalizing, verify:\n\n1. **Grammar accuracy**: All target language text is grammatically correct\n2. **Natural dialogue**: Conversations flow like real interactions\n3. **Appropriate register**: Formality matches the situation (casual cafe vs formal office)\n4. **Cultural accuracy**: Interactions reflect how things work in that culture\n5. **Clear progression**: Steps follow a logical narrative arc\n6. **Distinct options**: Each option represents a meaningfully different choice\n7. **Helpful feedback**: Translations and explanations clarify meaning and context\n8. **Correct romanization**: Follows standard systems for non-Roman scripts, empty for Roman scripts\n9. **Scenario relevance**: The story matches the lesson topic\n10. **Appropriate difficulty**: Language complexity matches learner level\n\n# Common Mistakes to Avoid\n\n1. **Including translations in options**: Options must show TARGET language only\n2. **Trivial distractors**: Options that are obviously wrong or nonsensical\n3. **Inconsistent register**: Mixing formal and informal inappropriately\n4. **Unnatural responses**: Things a native speaker would never actually say\n5. **Missing romanization**: Forgetting to add romanization for non-Roman scripts\n6. **Adding romanization to Roman scripts**: Spanish, French, etc. should have empty strings\n7. **Feedback without translation**: Always include what the option means\n8. **Disconnected steps**: Each step should follow logically from the previous one\n",
      "testCaseId": "en-french-cafe-ordering-1",
      "userPrompt": "TARGET_LANGUAGE: French\nNATIVE_LANGUAGE: en\nCHAPTER_TITLE: At the Cafe\nLESSON_TITLE: Ordering at a Cafe\nLESSON_DESCRIPTION: Practice ordering drinks and food at a French cafe, including asking for the menu and paying\n\nGenerate an immersive dialogue-driven story activity for this language lesson. Create a realistic everyday scenario where learners practice language production in situations they'd face in a foreign country."
    },
    {
      "duration": 27639.605792,
      "inputTokens": 2679,
      "output": "{\n  \"scenario\": \"You have just arrived at a hotel in Shinjuku, Tokyo after a long flight. You need to check in, confirm your reservation, and ask about the hotel facilities before heading to your room.\",\n  \"steps\": [\n    {\n      \"context\": \"いらっしゃいませ。チェックインですか？\",\n      \"contextRomanization\": \"Irasshaimase. Chekkuin desu ka?\",\n      \"contextTranslation\": \"Welcome. Are you checking in?\",\n      \"options\": [\n        {\n          \"feedback\": \"Yes, I have a reservation - Perfect! You've confirmed your intent and mentioned your reservation.\",\n          \"isCorrect\": true,\n          \"text\": \"はい、予約をしています。\",\n          \"textRomanization\": \"Hai, yoyaku o shite imasu.\"\n        },\n        {\n          \"feedback\": \"I want to eat lunch - You are at the front desk to check in, not to order a meal immediately.\",\n          \"isCorrect\": false,\n          \"text\": \"昼ご飯を食べたいです。\",\n          \"textRomanization\": \"Hirugohan o tabetai desu.\"\n        },\n        {\n          \"feedback\": \"Where is the station? - The staff asked if you are checking in. This is an unrelated question about directions.\",\n          \"isCorrect\": false,\n          \"text\": \"駅はどこですか？\",\n          \"textRomanization\": \"Eki wa doko desu ka?\"\n        },\n        {\n          \"feedback\": \"The room is cold - You haven't even entered the room yet! This doesn't answer the staff's question.\",\n          \"isCorrect\": false,\n          \"text\": \"部屋が寒いです。\",\n          \"textRomanization\": \"Heya ga samui desu.\"\n        }\n      ]\n    },\n    {\n      \"context\": \"はい、承知いたしました。お名前をいただけますか？\",\n      \"contextRomanization\": \"Hai, shōchi itashimashita. O-namae o itadakemasu ka?\",\n      \"contextTranslation\": \"Understood. May I have your name?\",\n      \"options\": [\n        {\n          \"feedback\": \"I am Smith - Correct! Giving your name is the natural next step in the check-in process.\",\n          \"isCorrect\": true,\n          \"text\": \"スミスです。\",\n          \"textRomanization\": \"Sumisu desu.\"\n        },\n        {\n          \"feedback\": \"I am a student - The staff needs your name to find the booking, not your occupation.\",\n          \"isCorrect\": false,\n          \"text\": \"学生です。\",\n          \"textRomanization\": \"Gakusei desu.\"\n        },\n        {\n          \"feedback\": \"I am from America - This tells them your nationality, but doesn't help them find your reservation name.\",\n          \"isCorrect\": false,\n          \"text\": \"アメリカから来ました。\",\n          \"textRomanization\": \"Amerika kara kimashita.\"\n        },\n        {\n          \"feedback\": \"I am fine - This is a response to 'How are you?', not a request for your name.\",\n          \"isCorrect\": false,\n          \"text\": \"元気です。\",\n          \"textRomanization\": \"Genki desu.\"\n        }\n      ]\n    },\n    {\n      \"context\": \"スミス様ですね。予約を確認しました。パスポートを見せてください。\",\n      \"contextRomanization\": \"Sumisu-sama desu ne. Yoyaku o kakunin shimashita. Pasupōto o misete kudasai.\",\n      \"contextTranslation\": \"Mr. Smith, right? I have confirmed your reservation. Please show me your passport.\",\n      \"options\": [\n        {\n          \"feedback\": \"Yes, here it is - Perfect! This is the polite way to hand over requested documents.\",\n          \"isCorrect\": true,\n          \"text\": \"はい、どうぞ。\",\n          \"textRomanization\": \"Hai, dōzo.\"\n        },\n        {\n          \"feedback\": \"I don't have money - The staff asked for your passport, not payment at this moment.\",\n          \"isCorrect\": false,\n          \"text\": \"お金がありません。\",\n          \"textRomanization\": \"Okane ga arimasen.\"\n        },\n        {\n          \"feedback\": \"My passport is big - This is a strange comment that doesn't help the check-in process.\",\n          \"isCorrect\": false,\n          \"text\": \"パスポートは大きいです。\",\n          \"textRomanization\": \"Pasupōto wa ōkii desu.\"\n        },\n        {\n          \"feedback\": \"I like photos - This is completely unrelated to providing your identification.\",\n          \"isCorrect\": false,\n          \"text\": \"写真が好きです。\",\n          \"textRomanization\": \"Shashin ga suki desu.\"\n        }\n      ]\n    },\n    {\n      \"context\": \"ありがとうございます。お部屋は禁煙室でよろしいですか？\",\n      \"contextRomanization\": \"Arigatō gozaimasu. O-heya wa kin'enshitsu de yoroshii desu ka?\",\n      \"contextTranslation\": \"Thank you. Is a non-smoking room okay?\",\n      \"options\": [\n        {\n          \"feedback\": \"Yes, please - Great. You've confirmed your room preference.\",\n          \"isCorrect\": true,\n          \"text\": \"はい、お願いします。\",\n          \"textRomanization\": \"Hai, onegaishimasu.\"\n        },\n        {\n          \"feedback\": \"I smoke - You are answering the question, but in a way that suggests you want a smoking room instead. Let's stick to the preferred non-smoking option for now.\",\n          \"isCorrect\": false,\n          \"text\": \"たばこを吸います。\",\n          \"textRomanization\": \"Tabako o suimasu.\"\n        },\n        {\n          \"feedback\": \"The room is beautiful - This is a compliment, but it doesn't answer whether you are okay with a non-smoking room.\",\n          \"isCorrect\": false,\n          \"text\": \"部屋はれいです。\",\n          \"textRomanization\": \"Heya wa kirei desu.\"\n        },\n        {\n          \"feedback\": \"What is this? - This is confusing. You should be answering the 'yes/no' question about the room type.\",\n          \"isCorrect\": false,\n          \"text\": \"これは何ですか？\",\n          \"textRomanization\": \"Kore wa nan desu ka?\"\n        }\n      ]\n    },\n    {\n      \"context\": \"かしこまりました。こちらが鍵です。Wi-Fiも使えますよ。\",\n      \"contextRomanization\": \"Kashikomarimashita. Kochira ga kagi desu. Waifa mo tsukaemasu yo.\",\n      \"contextTranslation\": \"Certainly. Here is your key. You can also use the Wi-Fi.\",\n      \"options\": [\n        {\n          \"feedback\": \"What is the password? - Excellent. Now you have the information needed to get online.\",\n          \"isCorrect\": true,\n          \"text\": \"パスワードは何ですか？\",\n          \"textRomanization\": \"Pasuwādo wa nan desu ka?\"\n        },\n        {\n          \"feedback\": \"The computer is broken - This is a complaint about a device, not a question about the hotel's Wi-Fi access.\",\n          \"isCorrect\": false,\n          \"text\": \"パソコンが壊れています。\",\n          \"textRomanization\": \"Pasokon ga kowarete imasu.\"\n        },\n        {\n          \"feedback\": \"I don't have a phone - This doesn't help you get the Wi-Fi information for your other devices or the future.\",\n          \"isCorrect\": false,\n          \"text\": \"電話を持っていません。\",\n          \"textRomanization\": \"Denwa o motte imasen.\"\n        },\n        {\n          \"feedback\": \"What is today's date? - This is irrelevant to the discussion about the room key and Wi-Fi.\",\n          \"isCorrect\": false,\n          \"text\": \"今日は何日ですか？\",\n          \"textRomanization\": \"Kyō wa nannichi desu ka?\"\n        }\n      ]\n    },\n    {\n      \"context\": \"パスワードはカードの裏に書いてあります。朝食は明日の朝７時からです。\",\n      \"contextRomanization\": \"Pasuwādo wa kādo no ura ni kaite arimasu. Chōshoku wa ashita no asa shichiji kara desu.\",\n      \"contextTranslation\": \"The password is written on the back of the card. Breakfast starts at 7 AM tomorrow morning.\",\n      \"options\": [\n        {\n          \"feedback\": \"Where do I eat? - Good question! This clarifies the location of the breakfast service.\",\n          \"isCorrect\": true,\n          \"text\": \"どこで食べますか？\",\n          \"textRomanization\": \"Doko de tabemasu ka?\"\n        },\n        {\n          \"feedback\": \"I'm not hungry - Even if you aren't hungry now, you might want to know for tomorrow. It's better to ask for information.\",\n          \"isCorrect\": false,\n          \"text\": \"お腹が空いていません。\",\n          \"textRomanization\": \"Onaka ga suite imasen.\"\n        },\n        {\n          \"feedback\": \"I'm going to sleep now - While true after a flight, it's polite to finish the conversation by clarifying hotel details first.\",\n          \"isCorrect\": false,\n          \"text\": \"今から寝ます。\",\n          \"textRomanization\": \"Ima kara nemasu.\"\n        },\n        {\n          \"feedback\": \"Give me water - This is a demand for a drink, rather than a question about the breakfast location.\",\n          \"isCorrect\": false,\n          \"text\": \"水をください。\",\n          \"textRomanization\": \"Mizu o kudasai.\"\n        }\n      ]\n    },\n    {\n      \"context\": \"一階のレストランです。他にご質問はありますか？\",\n      \"contextRomanization\": \"Ikkai no resutoran desu. Hoka ni go-shitsumon wa arimasu ka?\",\n      \"contextTranslation\": \"It's in the restaurant on the 1st floor. Do you have any other questions?\",\n      \"options\": [\n        {\n          \"feedback\": \"No, I'm okay. Thank you - Perfect closing. You've gotten all the info and thanked the staff politely.\",\n          \"isCorrect\": true,\n          \"text\": \"いいえ、大丈夫です。ありがとうございます。\",\n          \"textRomanization\": \"Iie, daijōbu desu. Arigatō gozaimasu.\"\n        },\n        {\n          \"feedback\": \"I am not a teacher - This is a random statement that doesn't respond to the question about having more inquiries.\",\n          \"isCorrect\": false,\n          \"text\": \"先生ではありません。\",\n          \"textRomanization\": \"Sensei de wa arimasen.\"\n        },\n        {\n          \"feedback\": \"Welcome - This is what staff says to guests, not what a guest says when finishing a check-in.\",\n          \"isCorrect\": false,\n          \"text\": \"いらっしゃいませ。\",\n          \"textRomanization\": \"Irasshaimase.\"\n        },\n        {\n          \"feedback\": \"Excuse me, where is the hotel? - You are already inside the hotel! This is very confusing for the staff.\",\n          \"isCorrect\": false,\n          \"text\": \"すみません、ホテルはどこですか？\",\n          \"textRomanization\": \"Sumimasen, hoteru wa doko desu ka?\"\n        }\n      ]\n    }\n  ]\n}",
      "outputTokens": 4230,
      "systemPrompt": "# Role\n\nYou are an expert language immersion designer specializing in creating realistic, dialogue-driven scenarios that help learners practice language production in authentic contexts. You design experiences that simulate situations learners would encounter when living or traveling in a country where the target language is spoken.\n\n# Goal\n\nCreate an immersive story activity where learners are placed in an everyday situation and must choose appropriate phrases to communicate. The activity simulates real conversations with native speakers, forcing learners to engage with the target language directly rather than relying on translations.\n\nThe activity places learners in a specific scenario (ordering food, asking for directions, checking into a hotel) and guides them through a dialogue where they must select appropriate responses at each step.\n\n# Key Design Principles\n\n## Immersion Over Translation\n\nUnlike other activities where translations help comprehension, this activity intentionally withholds translations from the options. Learners see:\n\n- **Context**: What the native speaker says (in TARGET language with translation)\n- **Options**: Four possible responses (in TARGET language ONLY - no translations)\n\nThis forces learners to:\n\n1. Engage with the target language sounds and patterns\n2. Use context clues to infer meaning\n3. Build recognition before relying on translations\n4. Experience the \"productive uncertainty\" of real conversations\n\nThe translation appears only in the feedback AFTER selection, revealing whether they understood correctly.\n\n## Authentic Scenarios\n\nFocus on situations learners will actually encounter:\n\n| Category       | Example Scenarios                                  |\n| -------------- | -------------------------------------------------- |\n| Food & Dining  | Ordering at a restaurant, asking about ingredients |\n| Transportation | Buying train tickets, asking for directions        |\n| Shopping       | Bargaining at a market, returning an item          |\n| Accommodation  | Checking into a hotel, reporting a problem         |\n| Healthcare     | Describing symptoms at a pharmacy, doctor's visit  |\n| Social         | Meeting neighbors, small talk at a cafe            |\n| Services       | Opening a bank account, getting a phone plan       |\n| Emergencies    | Reporting lost items, asking for help              |\n\n## Supportive Native Speaker\n\nThe character in the story is a friendly native speaker who:\n\n- Speaks naturally but not too fast\n- Helps the learner when they struggle\n- Provides context clues in their responses\n- Never mocks mistakes\n- Gradually introduces more complex language\n\n# Language Handling\n\n## Input Variables\n\n- **TARGET_LANGUAGE**: The language being learned (from `courseTitle`). All dialogue and options are in this language.\n- **NATIVE_LANGUAGE**: The learner's native language (from `language` code). Questions, feedback, and context translations use this language.\n\n## Language Codes\n\n- `en`: US English\n- `pt`: Brazilian Portuguese\n- `es`: Latin American Spanish\n\n## What Appears in Each Language\n\n| Field                        | Language     | Example (Spanish course, English native)                  |\n| ---------------------------- | ------------ | --------------------------------------------------------- |\n| `scenario`                   | NATIVE       | \"You're at a cafe in Madrid and want to order coffee.\"    |\n| `context`                    | TARGET       | \"Buenos dias, que le pongo?\"                              |\n| `contextTranslation`         | NATIVE       | \"Good morning, what can I get you?\"                       |\n| `contextRomanization`        | Romanization | \"\" (empty for Roman scripts)                              |\n| `options[].text`             | TARGET       | \"Un cafe con leche, por favor.\"                           |\n| `options[].textRomanization` | Romanization | \"\" (empty for Roman scripts)                              |\n| `options[].feedback`         | NATIVE       | \"A coffee with milk, please - Perfect! Polite and clear.\" |\n\n# Options Design\n\n## No Translations in Options\n\nThis is the most critical design decision. Options show ONLY:\n\n- `text`: The phrase in TARGET language\n- `textRomanization`: Romanization for non-Roman scripts (empty string for Roman scripts)\n\n**NO translation is shown**. This forces the learner to:\n\n1. Parse the target language directly\n2. Use patterns they've learned\n3. Make educated guesses based on context\n4. Experience the productive struggle of real communication\n\n## Option Quality\n\nAll 4 options must be:\n\n- **Grammatically correct** in the target language\n- **Contextually plausible** (something a learner might say in this situation)\n- **Distinct in meaning** (not just word variations)\n- **Level-appropriate** (using vocabulary/structures the learner knows)\n\n## Distractor Design\n\n**CRITICAL**: Wrong options must be genuinely inappropriate for the situation - they should lead to miscommunication or confusion if used. Do NOT create distractors that are merely \"less polished\" versions of the correct answer.\n\nWrong options should be **clearly wrong** because they:\n\n1. **Answer a different question**: Respond to something the speaker didn't ask (asking about price when asked about quantity)\n2. **Request the wrong thing**: Order/ask for something different than intended (one-way ticket when you need round-trip)\n3. **Are off-topic**: Say something unrelated to the current conversation point (asking for the check when you just arrived)\n4. **Would cause confusion**: Use words that change the meaning entirely (saying \"no\" when you mean \"yes\")\n\n**DO NOT** create distractors that are:\n\n- Just more/less formal versions of the correct answer\n- Slightly different phrasings that would still work\n- Grammatically awkward but still understandable\n\n# Feedback Design\n\nFeedback appears AFTER the learner selects an option. Every feedback message MUST include:\n\n1. **Translation**: What the option actually means in the native language\n2. **Explanation**: Why this choice is correct or incorrect for the situation\n\n## Feedback Structure\n\nFor **correct** options:\n\n```\n\"[Translation of what they said] - [Why this works in context]\"\n```\n\nExample: \"A coffee with milk, please - Perfect! This is polite and clearly communicates what you want.\"\n\nFor **incorrect** options:\n\n```\n\"[Translation of what they said] - [Why this doesn't work and what would be better]\"\n```\n\nExample: \"Where is the bathroom? - You're trying to order coffee, not find the restroom. Tell the barista what you'd like to drink.\"\n\n# Romanization Requirements\n\nFor languages using non-Roman writing systems (Japanese, Chinese, Korean, Arabic, Russian, Greek, Hebrew, Thai, Hindi, etc.), provide romanization for both context and options.\n\n## Standard Systems\n\n- **Japanese**: Romaji using Hepburn romanization\n- **Chinese**: Pinyin with tone marks\n- **Korean**: Revised Romanization of Korean\n- **Russian**: ISO 9 or BGN/PCGN transliteration\n- **Arabic**: Standard romanization\n- **Greek**: Standard transliteration\n- **Thai**: Royal Thai General System\n- **Hindi**: IAST or Hunterian transliteration\n\n## Roman Scripts\n\nFor languages using Roman letters (Spanish, French, German, Portuguese, Italian, etc.), set both `contextRomanization` and `textRomanization` to empty strings `\"\"`.\n\n# Story Arc\n\nEach story should have 5-10 steps following a natural arc:\n\n## Step Progression\n\n1. **Opening** (1-2 steps): Arrive at the location, initial greeting\n2. **Building** (2-4 steps): Main interaction, making requests, clarifying\n3. **Complication** (0-2 steps): Optional challenge that adds realism\n4. **Resolution** (1-2 steps): Complete the transaction\n5. **Closing** (1 step): Thank and goodbye\n\n## Complication Ideas (Recommended)\n\nAdding a complication makes the story more realistic and teaches learners to handle unexpected situations:\n\n- **Item unavailable**: \"Sorry, we're out of that. Would you like something else?\"\n- **Misunderstanding**: \"Did you say two or twelve?\"\n- **Additional requirement**: \"I'll need to see your ID for that.\"\n- **Clarification needed**: \"Which size did you want?\"\n\n## Pacing Guidelines\n\n- Steps should feel like natural conversation beats\n- Each step presents ONE decision point\n- Context should flow naturally from the previous step\n- The native speaker's response should acknowledge what the learner said\n\n# Output Format\n\nReturn an object with this structure (abbreviated examples shown):\n\n**Non-Roman script example (Japanese):**\n\n```json\n{\n  \"scenario\": \"You're at a train station in Tokyo...\",\n  \"steps\": [\n    {\n      \"context\": \"いらっしゃいませ。どちらまで？\",\n      \"contextTranslation\": \"Welcome. Where to?\",\n      \"contextRomanization\": \"Irasshaimase. Dochira made?\",\n      \"options\": [\n        {\n          \"text\": \"京都までお願いします。\",\n          \"textRomanization\": \"Kyouto made onegaishimasu.\",\n          \"isCorrect\": true,\n          \"feedback\": \"To Kyoto, please - Perfect!\"\n        },\n        {\n          \"text\": \"京都は遠いですか？\",\n          \"textRomanization\": \"Kyouto wa tooi desu ka?\",\n          \"isCorrect\": false,\n          \"feedback\": \"Is Kyoto far? - This asks about distance, not for a ticket.\"\n        }\n      ]\n    }\n  ]\n}\n```\n\n**Roman script example (Spanish) - empty romanization fields:**\n\n```json\n{\n  \"scenario\": \"You're at a restaurant in Barcelona...\",\n  \"steps\": [\n    {\n      \"context\": \"Buenas noches. Estan listos para pedir?\",\n      \"contextTranslation\": \"Good evening. Are you ready to order?\",\n      \"contextRomanization\": \"\",\n      \"options\": [\n        {\n          \"text\": \"Si, me gustaria la paella, por favor.\",\n          \"textRomanization\": \"\",\n          \"isCorrect\": true,\n          \"feedback\": \"Yes, I would like the paella, please - Perfect!\"\n        },\n        {\n          \"text\": \"La cuenta, por favor.\",\n          \"textRomanization\": \"\",\n          \"isCorrect\": false,\n          \"feedback\": \"The check, please - You haven't eaten yet!\"\n        }\n      ]\n    }\n  ]\n}\n```\n\nNote: Examples above are abbreviated. Actual output must have 4 options per step and 5-10 steps total.\n\n# Quality Checklist\n\nBefore finalizing, verify:\n\n1. **Grammar accuracy**: All target language text is grammatically correct\n2. **Natural dialogue**: Conversations flow like real interactions\n3. **Appropriate register**: Formality matches the situation (casual cafe vs formal office)\n4. **Cultural accuracy**: Interactions reflect how things work in that culture\n5. **Clear progression**: Steps follow a logical narrative arc\n6. **Distinct options**: Each option represents a meaningfully different choice\n7. **Helpful feedback**: Translations and explanations clarify meaning and context\n8. **Correct romanization**: Follows standard systems for non-Roman scripts, empty for Roman scripts\n9. **Scenario relevance**: The story matches the lesson topic\n10. **Appropriate difficulty**: Language complexity matches learner level\n\n# Common Mistakes to Avoid\n\n1. **Including translations in options**: Options must show TARGET language only\n2. **Trivial distractors**: Options that are obviously wrong or nonsensical\n3. **Inconsistent register**: Mixing formal and informal inappropriately\n4. **Unnatural responses**: Things a native speaker would never actually say\n5. **Missing romanization**: Forgetting to add romanization for non-Roman scripts\n6. **Adding romanization to Roman scripts**: Spanish, French, etc. should have empty strings\n7. **Feedback without translation**: Always include what the option means\n8. **Disconnected steps**: Each step should follow logically from the previous one\n",
      "testCaseId": "en-japanese-hotel-checkin-1",
      "userPrompt": "TARGET_LANGUAGE: Japanese\nNATIVE_LANGUAGE: en\nCHAPTER_TITLE: Travel and Accommodation\nLESSON_TITLE: Hotel Check-in\nLESSON_DESCRIPTION: Learn to check into a hotel, confirm reservations, and ask about room amenities\n\nGenerate an immersive dialogue-driven story activity for this language lesson. Create a realistic everyday scenario where learners practice language production in situations they'd face in a foreign country."
    },
    {
      "duration": 34585.620041999995,
      "inputTokens": 2678,
      "output": "{\n  \"scenario\": \"Você está em um 'Wochenmarkt' (mercado de rua semanal) na Alemanha e quer comprar ingredientes frescos para o jantar.\",\n  \"steps\": [\n    {\n      \"context\": \"Guten Tag! Kann ich Ihnen helfen oder schauen Sie sich erst mal um?\",\n      \"contextRomanization\": \"\",\n      \"contextTranslation\": \"Bom dia! Posso ajudá-lo ou você está apenas dando uma olhadinha primeiro?\",\n      \"options\": [\n        {\n          \"feedback\": \"Bom dia! Eu gostaria de algumas frutas. - Perfeito! É uma forma educada e clara de iniciar seu pedido.\",\n          \"isCorrect\": true,\n          \"text\": \"Guten Tag! Ich hätte gerne etwas Obst.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Tchau! - Você acabou de chegar ao mercado, não deve se despedir agora.\",\n          \"isCorrect\": false,\n          \"text\": \"Auf Wiedersehen!\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Onde fica a estação de trem? - O vendedor perguntou se você precisa de ajuda com as compras, não com direções.\",\n          \"isCorrect\": false,\n          \"text\": \"Wo ist der Bahnhof?\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Eu tenho um carro. - Esta informação não é relevante para o vendedor do mercado.\",\n          \"isCorrect\": false,\n          \"text\": \"Ich habe ein Auto.\",\n          \"textRomanization\": \"\"\n        }\n      ]\n    },\n    {\n      \"context\": \"Gerne. Wir haben heute sehr schöne Äpfel im Angebot. Wie viele möchten Sie?\",\n      \"contextRomanization\": \"\",\n      \"contextTranslation\": \"Com prazer. Temos maçãs muito bonitas em promoção hoje. Quantas você gostaria?\",\n      \"options\": [\n        {\n          \"feedback\": \"Eu levo um quilo de maçãs, por favor. - Excelente! Você especificou a quantidade corretamente.\",\n          \"isCorrect\": true,\n          \"text\": \"Ich nehme ein Kilo Äpfel, bitte.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Eu não gosto de peixe. - O vendedor está falando sobre maçãs, não sobre peixes.\",\n          \"isCorrect\": false,\n          \"text\": \"Ich mag keinen Fisch.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Que horas são? - Esta pergunta ignora o que o vendedor perguntou sobre a quantidade.\",\n          \"isCorrect\": false,\n          \"text\": \"Wie spät ist es?\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"O tempo está bom. - Falar do clima não ajuda a realizar a compra das maçãs.\",\n          \"isCorrect\": false,\n          \"text\": \"Das Wetter ist schön.\",\n          \"textRomanization\": \"\"\n        }\n      ]\n    },\n    {\n      \"context\": \"Sehr gut. Sonst noch etwas? Die Kartoffeln sind heute auch ganz frisch reingekommen.\",\n      \"contextRomanization\": \"\",\n      \"contextTranslation\": \"Muito bem. Mais alguma coisa? As batatas também chegaram bem frescas hoje.\",\n      \"options\": [\n        {\n          \"feedback\": \"Sim, eu também preciso de dois quilos de batatas. - Ótima escolha, respondendo à sugestão do vendedor.\",\n          \"isCorrect\": true,\n          \"text\": \"Ja, ich brauche auch zwei Kilo Kartoffeln.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Não, eu sou professor. - Sua profissão não é necessária para decidir se quer batatas.\",\n          \"isCorrect\": false,\n          \"text\": \"Nein, ich bin Lehrer.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Eu estou procurando minha bolsa. - Isso causaria confusão, a menos que você realmente tenha perdido algo.\",\n          \"isCorrect\": false,\n          \"text\": \"Ich suche meine Tasche.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Isso é um cachorro. - Esta frase é totalmente fora de contexto para uma compra.\",\n          \"isCorrect\": false,\n          \"text\": \"Das ist ein Hund.\",\n          \"textRomanization\": \"\"\n        }\n      ]\n    },\n    {\n      \"context\": \"Möchten Sie lieber die festkochenden oder die mehligen Kartoffeln?\",\n      \"contextRomanization\": \"\",\n      \"contextTranslation\": \"Você prefere as batatas que mantêm a forma após o cozimento (cerosas) ou as farinhentas?\",\n      \"options\": [\n        {\n          \"feedback\": \"Eu levo as que mantêm a forma (cerosas), por favor. - Muito bem! Na Alemanha, o tipo de batata é muito importante para a receita.\",\n          \"isCorrect\": true,\n          \"text\": \"Ich nehme die festkochenden, bitte.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Eu gosto de beber café. - O vendedor perguntou sobre batatas, não sobre suas preferências de bebida.\",\n          \"isCorrect\": false,\n          \"text\": \"Ich trinke gerne Kaffee.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Minha mãe é alta. - Informações familiares não ajudam o vendedor a escolher as batatas.\",\n          \"isCorrect\": false,\n          \"text\": \"Meine Mutter ist groß.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Onde posso estacionar? - Esta pergunta não responde à escolha entre os tipos de batata.\",\n          \"isCorrect\": false,\n          \"text\": \"Wo kann ich parken?\",\n          \"textRomanization\": \"\"\n        }\n      ]\n    },\n    {\n      \"context\": \"Alles klar. Haben Sie noch einen Wunsch?\",\n      \"contextRomanization\": \"\",\n      \"contextTranslation\": \"Tudo certo. Tem mais algum desejo/pedido?\",\n      \"options\": [\n        {\n          \"feedback\": \"Vocês também têm pão fresco? - Perfeito! Você está expandindo sua lista de compras de forma natural.\",\n          \"isCorrect\": true,\n          \"text\": \"Haben Sie auch frisches Brot?\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Eu estou com fome. - Embora seja verdade, não é um pedido de compra específico.\",\n          \"isCorrect\": false,\n          \"text\": \"Ich habe Hunger.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Você sabe dançar? - Esta pergunta é muito pessoal e inadequada para o contexto de mercado.\",\n          \"isCorrect\": false,\n          \"text\": \"Können Sie tanzen?\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Isso é caro demais. - Reclamar do preço sem motivo pode parecer rude antes de saber o valor total.\",\n          \"isCorrect\": false,\n          \"text\": \"Das ist zu teuer.\",\n          \"textRomanization\": \"\"\n        }\n      ]\n    },\n    {\n      \"context\": \"Ja, wir haben heute ein sehr gutes Bauernbrot. Soll ich es einpacken?\",\n      \"contextRomanization\": \"\",\n      \"contextTranslation\": \"Sim, temos hoje um pão de campo muito bom. Devo embalá-lo?\",\n      \"options\": [\n        {\n          \"feedback\": \"Sim, por favor. Quanto dá tudo no total? - Ótimo, você aceitou o produto e perguntou o preço total.\",\n          \"isCorrect\": true,\n          \"text\": \"Ja, bitte. Was macht das insgesamt?\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Meu nome é Hans. - O vendedor não perguntou seu nome, ele perguntou se deve embalar o pão.\",\n          \"isCorrect\": false,\n          \"text\": \"Ich heiße Hans.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Eu venho do Brasil. - Novamente, informações pessoais não são necessárias agora.\",\n          \"isCorrect\": false,\n          \"text\": \"Ich komme aus Brasilien.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Um, dois, três. - Contar números não responde à pergunta do vendedor.\",\n          \"isCorrect\": false,\n          \"text\": \"Eins, zwei, drei.\",\n          \"textRomanization\": \"\"\n        }\n      ]\n    },\n    {\n      \"context\": \"Das macht zusammen fünfzehn Euro achtzig, bitte.\",\n      \"contextRomanization\": \"\",\n      \"contextTranslation\": \"Isso dá no total quinze euros e oitenta, por favor.\",\n      \"options\": [\n        {\n          \"feedback\": \"Aqui estão vinte euros. Pode ficar com o troco. - Excelente! 'Stimmt so' é a forma comum de dar uma pequena gorjeta ou facilitar o troco.\",\n          \"isCorrect\": true,\n          \"text\": \"Hier sind zwanzig Euro. Stimmt so.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Eu estou cansado. - Dizer que está cansado não resolve o pagamento da conta.\",\n          \"isCorrect\": false,\n          \"text\": \"Ich bin müde.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Boa noite. - Ainda é dia e você ainda não terminou a transação.\",\n          \"isCorrect\": false,\n          \"text\": \"Gute Nacht.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"O que é isso? - Perguntar o que é o dinheiro ou a conta seria muito confuso para o vendedor.\",\n          \"isCorrect\": false,\n          \"text\": \"Was ist das?\",\n          \"textRomanization\": \"\"\n        }\n      ]\n    },\n    {\n      \"context\": \"Vielen Dank! Das ist sehr nett. Einen schönen Tag noch!\",\n      \"contextRomanization\": \"\",\n      \"contextTranslation\": \"Muito obrigado! Isso é muito gentil. Tenha um bom dia!\",\n      \"options\": [\n        {\n          \"feedback\": \"Obrigado, igualmente! Tchau! - Finalização perfeita e educada.\",\n          \"isCorrect\": true,\n          \"text\": \"Danke, gleichfalls! Auf Wiedersehen!\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Eu não entendo. - Se você chegou até aqui, provavelmente entendeu o básico!\",\n          \"isCorrect\": false,\n          \"text\": \"Ich verstehe nicht.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Como vai você? - Iniciar uma conversa social agora que a compra acabou é um pouco estranho.\",\n          \"isCorrect\": false,\n          \"text\": \"Wie geht es dir?\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Eu terminei. - Soa um pouco robótico e não é uma despedida comum.\",\n          \"isCorrect\": false,\n          \"text\": \"Ich bin fertig.\",\n          \"textRomanization\": \"\"\n        }\n      ]\n    }\n  ]\n}",
      "outputTokens": 4715,
      "systemPrompt": "# Role\n\nYou are an expert language immersion designer specializing in creating realistic, dialogue-driven scenarios that help learners practice language production in authentic contexts. You design experiences that simulate situations learners would encounter when living or traveling in a country where the target language is spoken.\n\n# Goal\n\nCreate an immersive story activity where learners are placed in an everyday situation and must choose appropriate phrases to communicate. The activity simulates real conversations with native speakers, forcing learners to engage with the target language directly rather than relying on translations.\n\nThe activity places learners in a specific scenario (ordering food, asking for directions, checking into a hotel) and guides them through a dialogue where they must select appropriate responses at each step.\n\n# Key Design Principles\n\n## Immersion Over Translation\n\nUnlike other activities where translations help comprehension, this activity intentionally withholds translations from the options. Learners see:\n\n- **Context**: What the native speaker says (in TARGET language with translation)\n- **Options**: Four possible responses (in TARGET language ONLY - no translations)\n\nThis forces learners to:\n\n1. Engage with the target language sounds and patterns\n2. Use context clues to infer meaning\n3. Build recognition before relying on translations\n4. Experience the \"productive uncertainty\" of real conversations\n\nThe translation appears only in the feedback AFTER selection, revealing whether they understood correctly.\n\n## Authentic Scenarios\n\nFocus on situations learners will actually encounter:\n\n| Category       | Example Scenarios                                  |\n| -------------- | -------------------------------------------------- |\n| Food & Dining  | Ordering at a restaurant, asking about ingredients |\n| Transportation | Buying train tickets, asking for directions        |\n| Shopping       | Bargaining at a market, returning an item          |\n| Accommodation  | Checking into a hotel, reporting a problem         |\n| Healthcare     | Describing symptoms at a pharmacy, doctor's visit  |\n| Social         | Meeting neighbors, small talk at a cafe            |\n| Services       | Opening a bank account, getting a phone plan       |\n| Emergencies    | Reporting lost items, asking for help              |\n\n## Supportive Native Speaker\n\nThe character in the story is a friendly native speaker who:\n\n- Speaks naturally but not too fast\n- Helps the learner when they struggle\n- Provides context clues in their responses\n- Never mocks mistakes\n- Gradually introduces more complex language\n\n# Language Handling\n\n## Input Variables\n\n- **TARGET_LANGUAGE**: The language being learned (from `courseTitle`). All dialogue and options are in this language.\n- **NATIVE_LANGUAGE**: The learner's native language (from `language` code). Questions, feedback, and context translations use this language.\n\n## Language Codes\n\n- `en`: US English\n- `pt`: Brazilian Portuguese\n- `es`: Latin American Spanish\n\n## What Appears in Each Language\n\n| Field                        | Language     | Example (Spanish course, English native)                  |\n| ---------------------------- | ------------ | --------------------------------------------------------- |\n| `scenario`                   | NATIVE       | \"You're at a cafe in Madrid and want to order coffee.\"    |\n| `context`                    | TARGET       | \"Buenos dias, que le pongo?\"                              |\n| `contextTranslation`         | NATIVE       | \"Good morning, what can I get you?\"                       |\n| `contextRomanization`        | Romanization | \"\" (empty for Roman scripts)                              |\n| `options[].text`             | TARGET       | \"Un cafe con leche, por favor.\"                           |\n| `options[].textRomanization` | Romanization | \"\" (empty for Roman scripts)                              |\n| `options[].feedback`         | NATIVE       | \"A coffee with milk, please - Perfect! Polite and clear.\" |\n\n# Options Design\n\n## No Translations in Options\n\nThis is the most critical design decision. Options show ONLY:\n\n- `text`: The phrase in TARGET language\n- `textRomanization`: Romanization for non-Roman scripts (empty string for Roman scripts)\n\n**NO translation is shown**. This forces the learner to:\n\n1. Parse the target language directly\n2. Use patterns they've learned\n3. Make educated guesses based on context\n4. Experience the productive struggle of real communication\n\n## Option Quality\n\nAll 4 options must be:\n\n- **Grammatically correct** in the target language\n- **Contextually plausible** (something a learner might say in this situation)\n- **Distinct in meaning** (not just word variations)\n- **Level-appropriate** (using vocabulary/structures the learner knows)\n\n## Distractor Design\n\n**CRITICAL**: Wrong options must be genuinely inappropriate for the situation - they should lead to miscommunication or confusion if used. Do NOT create distractors that are merely \"less polished\" versions of the correct answer.\n\nWrong options should be **clearly wrong** because they:\n\n1. **Answer a different question**: Respond to something the speaker didn't ask (asking about price when asked about quantity)\n2. **Request the wrong thing**: Order/ask for something different than intended (one-way ticket when you need round-trip)\n3. **Are off-topic**: Say something unrelated to the current conversation point (asking for the check when you just arrived)\n4. **Would cause confusion**: Use words that change the meaning entirely (saying \"no\" when you mean \"yes\")\n\n**DO NOT** create distractors that are:\n\n- Just more/less formal versions of the correct answer\n- Slightly different phrasings that would still work\n- Grammatically awkward but still understandable\n\n# Feedback Design\n\nFeedback appears AFTER the learner selects an option. Every feedback message MUST include:\n\n1. **Translation**: What the option actually means in the native language\n2. **Explanation**: Why this choice is correct or incorrect for the situation\n\n## Feedback Structure\n\nFor **correct** options:\n\n```\n\"[Translation of what they said] - [Why this works in context]\"\n```\n\nExample: \"A coffee with milk, please - Perfect! This is polite and clearly communicates what you want.\"\n\nFor **incorrect** options:\n\n```\n\"[Translation of what they said] - [Why this doesn't work and what would be better]\"\n```\n\nExample: \"Where is the bathroom? - You're trying to order coffee, not find the restroom. Tell the barista what you'd like to drink.\"\n\n# Romanization Requirements\n\nFor languages using non-Roman writing systems (Japanese, Chinese, Korean, Arabic, Russian, Greek, Hebrew, Thai, Hindi, etc.), provide romanization for both context and options.\n\n## Standard Systems\n\n- **Japanese**: Romaji using Hepburn romanization\n- **Chinese**: Pinyin with tone marks\n- **Korean**: Revised Romanization of Korean\n- **Russian**: ISO 9 or BGN/PCGN transliteration\n- **Arabic**: Standard romanization\n- **Greek**: Standard transliteration\n- **Thai**: Royal Thai General System\n- **Hindi**: IAST or Hunterian transliteration\n\n## Roman Scripts\n\nFor languages using Roman letters (Spanish, French, German, Portuguese, Italian, etc.), set both `contextRomanization` and `textRomanization` to empty strings `\"\"`.\n\n# Story Arc\n\nEach story should have 5-10 steps following a natural arc:\n\n## Step Progression\n\n1. **Opening** (1-2 steps): Arrive at the location, initial greeting\n2. **Building** (2-4 steps): Main interaction, making requests, clarifying\n3. **Complication** (0-2 steps): Optional challenge that adds realism\n4. **Resolution** (1-2 steps): Complete the transaction\n5. **Closing** (1 step): Thank and goodbye\n\n## Complication Ideas (Recommended)\n\nAdding a complication makes the story more realistic and teaches learners to handle unexpected situations:\n\n- **Item unavailable**: \"Sorry, we're out of that. Would you like something else?\"\n- **Misunderstanding**: \"Did you say two or twelve?\"\n- **Additional requirement**: \"I'll need to see your ID for that.\"\n- **Clarification needed**: \"Which size did you want?\"\n\n## Pacing Guidelines\n\n- Steps should feel like natural conversation beats\n- Each step presents ONE decision point\n- Context should flow naturally from the previous step\n- The native speaker's response should acknowledge what the learner said\n\n# Output Format\n\nReturn an object with this structure (abbreviated examples shown):\n\n**Non-Roman script example (Japanese):**\n\n```json\n{\n  \"scenario\": \"You're at a train station in Tokyo...\",\n  \"steps\": [\n    {\n      \"context\": \"いらっしゃいませ。どちらまで？\",\n      \"contextTranslation\": \"Welcome. Where to?\",\n      \"contextRomanization\": \"Irasshaimase. Dochira made?\",\n      \"options\": [\n        {\n          \"text\": \"京都までお願いします。\",\n          \"textRomanization\": \"Kyouto made onegaishimasu.\",\n          \"isCorrect\": true,\n          \"feedback\": \"To Kyoto, please - Perfect!\"\n        },\n        {\n          \"text\": \"京都は遠いですか？\",\n          \"textRomanization\": \"Kyouto wa tooi desu ka?\",\n          \"isCorrect\": false,\n          \"feedback\": \"Is Kyoto far? - This asks about distance, not for a ticket.\"\n        }\n      ]\n    }\n  ]\n}\n```\n\n**Roman script example (Spanish) - empty romanization fields:**\n\n```json\n{\n  \"scenario\": \"You're at a restaurant in Barcelona...\",\n  \"steps\": [\n    {\n      \"context\": \"Buenas noches. Estan listos para pedir?\",\n      \"contextTranslation\": \"Good evening. Are you ready to order?\",\n      \"contextRomanization\": \"\",\n      \"options\": [\n        {\n          \"text\": \"Si, me gustaria la paella, por favor.\",\n          \"textRomanization\": \"\",\n          \"isCorrect\": true,\n          \"feedback\": \"Yes, I would like the paella, please - Perfect!\"\n        },\n        {\n          \"text\": \"La cuenta, por favor.\",\n          \"textRomanization\": \"\",\n          \"isCorrect\": false,\n          \"feedback\": \"The check, please - You haven't eaten yet!\"\n        }\n      ]\n    }\n  ]\n}\n```\n\nNote: Examples above are abbreviated. Actual output must have 4 options per step and 5-10 steps total.\n\n# Quality Checklist\n\nBefore finalizing, verify:\n\n1. **Grammar accuracy**: All target language text is grammatically correct\n2. **Natural dialogue**: Conversations flow like real interactions\n3. **Appropriate register**: Formality matches the situation (casual cafe vs formal office)\n4. **Cultural accuracy**: Interactions reflect how things work in that culture\n5. **Clear progression**: Steps follow a logical narrative arc\n6. **Distinct options**: Each option represents a meaningfully different choice\n7. **Helpful feedback**: Translations and explanations clarify meaning and context\n8. **Correct romanization**: Follows standard systems for non-Roman scripts, empty for Roman scripts\n9. **Scenario relevance**: The story matches the lesson topic\n10. **Appropriate difficulty**: Language complexity matches learner level\n\n# Common Mistakes to Avoid\n\n1. **Including translations in options**: Options must show TARGET language only\n2. **Trivial distractors**: Options that are obviously wrong or nonsensical\n3. **Inconsistent register**: Mixing formal and informal inappropriately\n4. **Unnatural responses**: Things a native speaker would never actually say\n5. **Missing romanization**: Forgetting to add romanization for non-Roman scripts\n6. **Adding romanization to Roman scripts**: Spanish, French, etc. should have empty strings\n7. **Feedback without translation**: Always include what the option means\n8. **Disconnected steps**: Each step should follow logically from the previous one\n",
      "testCaseId": "pt-german-market-shopping-1",
      "userPrompt": "TARGET_LANGUAGE: German\nNATIVE_LANGUAGE: pt\nCHAPTER_TITLE: Fazendo Compras\nLESSON_TITLE: No Mercado\nLESSON_DESCRIPTION: Aprenda a comprar frutas, verduras e outros itens em um mercado alemao\n\nGenerate an immersive dialogue-driven story activity for this language lesson. Create a realistic everyday scenario where learners practice language production in situations they'd face in a foreign country."
    },
    {
      "duration": 27176.705541999996,
      "inputTokens": 2676,
      "output": "{\n  \"scenario\": \"Te encuentras en una calle concurrida de Seúl y necesitas llegar a la estación de Myeongdong para encontrarte con un amigo, pero no estás seguro de hacia dónde caminar.\",\n  \"steps\": [\n    {\n      \"context\": \"네, 실례합니다. 무엇을 도와드릴까요?\",\n      \"contextRomanization\": \"Ne, sillyehamnida. Mueoseul dowadeurilkkayo?\",\n      \"contextTranslation\": \"Sí, disculpe. ¿En qué puedo ayudarle?\",\n      \"options\": [\n        {\n          \"feedback\": \"¿Dónde está la estación de Myeongdong? - ¡Perfecto! Has preguntado directamente por tu destino de forma educada.\",\n          \"isCorrect\": true,\n          \"text\": \"실례합니다. 명동역이 어디예요?\",\n          \"textRomanization\": \"Sillyehamnida. Myeongdong-yeogi eodiyeyo?\"\n        },\n        {\n          \"feedback\": \"¿Cuánto cuesta esto? - Esta frase se usa para comprar objetos, no para pedir direcciones.\",\n          \"isCorrect\": false,\n          \"text\": \"이거 얼마예요?\",\n          \"textRomanization\": \"Igeo eolmayeyo?\"\n        },\n        {\n          \"feedback\": \"Tengo hambre. ¿Dónde hay un restaurante? - El transeúnte te preguntó cómo ayudarte, pero esta respuesta no te lleva a la estación.\",\n          \"isCorrect\": false,\n          \"text\": \"배고파요. 식당이 어디예요?\",\n          \"textRomanization\": \"Baegopayo. Sikdangi eodiyeyo?\"\n        },\n        {\n          \"feedback\": \"Adiós (vaya en paz) - Acabas de empezar la conversación, ¡no te despidas todavía!\",\n          \"isCorrect\": false,\n          \"text\": \"안녕히 가세요.\",\n          \"textRomanization\": \"Annyeonghi gaseyo.\"\n        }\n      ]\n    },\n    {\n      \"context\": \"아, 명동역요? 여기서 똑바로 가세요.\",\n      \"contextRomanization\": \"A, Myeongdong-yeogyo? Yeogiseo ttokbaro gaseyo.\",\n      \"contextTranslation\": \"Ah, ¿la estación de Myeongdong? Siga recto desde aquí.\",\n      \"options\": [\n        {\n          \"feedback\": \"¿Está lejos? ¿Puedo ir caminando? - ¡Muy bien! Es importante saber si la distancia es razonable para ir a pie.\",\n          \"isCorrect\": true,\n          \"text\": \"멀어요? 걸어서 갈 수 있어요?\",\n          \"textRomanization\": \"Meoreoyo? Georeoseo gal su isseoyo?\"\n        },\n        {\n          \"feedback\": \"Sí, somos dos personas - Esta frase se usa en restaurantes al pedir mesa, no tiene sentido aquí.\",\n          \"isCorrect\": false,\n          \"text\": \"네, 두 명이에요.\",\n          \"textRomanization\": \"Ne, du myeongieyo.\"\n        },\n        {\n          \"feedback\": \"¿Dónde está el baño? - Estás buscando la estación de metro, no el servicio público.\",\n          \"isCorrect\": false,\n          \"text\": \"화장실이 어디예요?\",\n          \"textRomanization\": \"Hwajangsiri eodiyeyo?\"\n        },\n        {\n          \"feedback\": \"No hablo coreano - Decir esto cortará la comunicación en lugar de ayudarte a llegar a tu destino.\",\n          \"isCorrect\": false,\n          \"text\": \"한국말 못해요.\",\n          \"textRomanization\": \"Hangungmal mothaeyo.\"\n        }\n      ]\n    },\n    {\n      \"context\": \"걸어서 25분 정도 걸려요. 조금 멀어요.\",\n      \"contextRomanization\": \"Georeoseo isip-obun jeongdo geollyeoyo. Jogeum meoreoyo.\",\n      \"contextTranslation\": \"Se tarda unos 25 minutos a pie. Está un poco lejos.\",\n      \"options\": [\n        {\n          \"feedback\": \"¿Puedo ir en autobús? - ¡Exacto! 25 minutos es mucho tiempo, así que buscar transporte público es lo ideal.\",\n          \"isCorrect\": true,\n          \"text\": \"버스로 갈 수 있어요?\",\n          \"textRomanization\": \"Beoseuro gal su isseoyo?\"\n        },\n        {\n          \"feedback\": \"Por favor, deme un café - ¡No estás en una cafetería! Te están dando indicaciones de camino.\",\n          \"isCorrect\": false,\n          \"text\": \"커피 한 잔 주세요.\",\n          \"textRomanization\": \"Keopi han jan juseyo.\"\n        },\n        {\n          \"feedback\": \"La maleta es pesada - Es una observación personal, pero no ayuda a obtener información sobre el autobús.\",\n          \"isCorrect\": false,\n          \"text\": \"가방이 무거워요.\",\n          \"textRomanization\": \"Gabangi mugeowoyo.\"\n        },\n        {\n          \"feedback\": \"¿Cómo se llama usted? - Es demasiado personal e irrelevante para pedir direcciones en la calle.\",\n          \"isCorrect\": false,\n          \"text\": \"성함이 어떻게 되세요?\",\n          \"textRomanization\": \"Seonghami eotteoke doeseyo?\"\n        }\n      ]\n    },\n    {\n      \"context\": \"네, 저기 편의점 앞 정류장에서 버스를 타세요.\",\n      \"contextRomanization\": \"Ne, jeogi pyeonijeom ap jeongnyujang-eseo beoseureul taseyo.\",\n      \"contextTranslation\": \"Sí, tome el autobús en la parada que está frente a esa tienda de conveniencia.\",\n      \"options\": [\n        {\n          \"feedback\": \"¿Qué número de autobús debo tomar? - ¡Excelente! Necesitas el número específico de la línea para no subirte al bus equivocado.\",\n          \"isCorrect\": true,\n          \"text\": \"몇 번 버스를 타야 돼요?\",\n          \"textRomanization\": \"Myeot beon beoseureul taya dwaeyo?\"\n        },\n        {\n          \"feedback\": \"No puedo comer comida picante - Estás hablando de transporte, no de comida.\",\n          \"isCorrect\": false,\n          \"text\": \"매운 것 못 먹어요.\",\n          \"textRomanization\": \"Maeun geot mot meogeoyo.\"\n        },\n        {\n          \"feedback\": \"¿Dónde está la estación de metro? - Ya te dijeron que está lejos y que tomes el bus; ahora necesitas saber cuál.\",\n          \"isCorrect\": false,\n          \"text\": \"지하철역이 어디예요?\",\n          \"textRomanization\": \"Jihacheoryeogi eodiyeyo?\"\n        },\n        {\n          \"feedback\": \"Vine ayer - Esta información no ayuda a saber qué autobús tomar.\",\n          \"isCorrect\": false,\n          \"text\": \"어제 왔어요.\",\n          \"textRomanization\": \"Eoje wasseoyo.\"\n        }\n      ]\n    },\n    {\n      \"context\": \"143번이나 401번을 타세요. 두 정거장만 가면 돼요.\",\n      \"contextRomanization\": \"Baek-sasipsambon-ina sa-baek-ilbeoneul taseyo. Du jeonggeojangman gamyeon dwaeyo.\",\n      \"contextTranslation\": \"Tome el 143 o el 401. Solo son dos paradas.\",\n      \"options\": [\n        {\n          \"feedback\": \"Entiendo. ¡Muchas gracias! - ¡Perfecto! Has recibido toda la información necesaria y agradeces educadamente.\",\n          \"isCorrect\": true,\n          \"text\": \"알겠습니다. 감사합니다!\",\n          \"textRomanization\": \"Algetseumnida. Gamsahamnida!\"\n        },\n        {\n          \"feedback\": \"No, no tengo hambre - Has confundido la instrucción con una invitación a comer.\",\n          \"isCorrect\": false,\n          \"text\": \"아니요, 배 안 고파요.\",\n          \"textRomanization\": \"Aniyo, bae an gopayo.\"\n        },\n        {\n          \"feedback\": \"Por favor, hágame un descuento - Esto se usa en mercados para regatear, no con extraños que te ayudan.\",\n          \"isCorrect\": false,\n          \"text\": \"깎아 주세요.\",\n          \"textRomanization\": \"Kkakka juseyo.\"\n        },\n        {\n          \"feedback\": \"Vaya a la izquierda - Estás dando una orden en lugar de agradecer la ayuda recibida.\",\n          \"isCorrect\": false,\n          \"text\": \"왼쪽으로 가세요.\",\n          \"textRomanization\": \"Oenjjogeuro gaseyo.\"\n        }\n      ]\n    }\n  ]\n}",
      "outputTokens": 4029,
      "systemPrompt": "# Role\n\nYou are an expert language immersion designer specializing in creating realistic, dialogue-driven scenarios that help learners practice language production in authentic contexts. You design experiences that simulate situations learners would encounter when living or traveling in a country where the target language is spoken.\n\n# Goal\n\nCreate an immersive story activity where learners are placed in an everyday situation and must choose appropriate phrases to communicate. The activity simulates real conversations with native speakers, forcing learners to engage with the target language directly rather than relying on translations.\n\nThe activity places learners in a specific scenario (ordering food, asking for directions, checking into a hotel) and guides them through a dialogue where they must select appropriate responses at each step.\n\n# Key Design Principles\n\n## Immersion Over Translation\n\nUnlike other activities where translations help comprehension, this activity intentionally withholds translations from the options. Learners see:\n\n- **Context**: What the native speaker says (in TARGET language with translation)\n- **Options**: Four possible responses (in TARGET language ONLY - no translations)\n\nThis forces learners to:\n\n1. Engage with the target language sounds and patterns\n2. Use context clues to infer meaning\n3. Build recognition before relying on translations\n4. Experience the \"productive uncertainty\" of real conversations\n\nThe translation appears only in the feedback AFTER selection, revealing whether they understood correctly.\n\n## Authentic Scenarios\n\nFocus on situations learners will actually encounter:\n\n| Category       | Example Scenarios                                  |\n| -------------- | -------------------------------------------------- |\n| Food & Dining  | Ordering at a restaurant, asking about ingredients |\n| Transportation | Buying train tickets, asking for directions        |\n| Shopping       | Bargaining at a market, returning an item          |\n| Accommodation  | Checking into a hotel, reporting a problem         |\n| Healthcare     | Describing symptoms at a pharmacy, doctor's visit  |\n| Social         | Meeting neighbors, small talk at a cafe            |\n| Services       | Opening a bank account, getting a phone plan       |\n| Emergencies    | Reporting lost items, asking for help              |\n\n## Supportive Native Speaker\n\nThe character in the story is a friendly native speaker who:\n\n- Speaks naturally but not too fast\n- Helps the learner when they struggle\n- Provides context clues in their responses\n- Never mocks mistakes\n- Gradually introduces more complex language\n\n# Language Handling\n\n## Input Variables\n\n- **TARGET_LANGUAGE**: The language being learned (from `courseTitle`). All dialogue and options are in this language.\n- **NATIVE_LANGUAGE**: The learner's native language (from `language` code). Questions, feedback, and context translations use this language.\n\n## Language Codes\n\n- `en`: US English\n- `pt`: Brazilian Portuguese\n- `es`: Latin American Spanish\n\n## What Appears in Each Language\n\n| Field                        | Language     | Example (Spanish course, English native)                  |\n| ---------------------------- | ------------ | --------------------------------------------------------- |\n| `scenario`                   | NATIVE       | \"You're at a cafe in Madrid and want to order coffee.\"    |\n| `context`                    | TARGET       | \"Buenos dias, que le pongo?\"                              |\n| `contextTranslation`         | NATIVE       | \"Good morning, what can I get you?\"                       |\n| `contextRomanization`        | Romanization | \"\" (empty for Roman scripts)                              |\n| `options[].text`             | TARGET       | \"Un cafe con leche, por favor.\"                           |\n| `options[].textRomanization` | Romanization | \"\" (empty for Roman scripts)                              |\n| `options[].feedback`         | NATIVE       | \"A coffee with milk, please - Perfect! Polite and clear.\" |\n\n# Options Design\n\n## No Translations in Options\n\nThis is the most critical design decision. Options show ONLY:\n\n- `text`: The phrase in TARGET language\n- `textRomanization`: Romanization for non-Roman scripts (empty string for Roman scripts)\n\n**NO translation is shown**. This forces the learner to:\n\n1. Parse the target language directly\n2. Use patterns they've learned\n3. Make educated guesses based on context\n4. Experience the productive struggle of real communication\n\n## Option Quality\n\nAll 4 options must be:\n\n- **Grammatically correct** in the target language\n- **Contextually plausible** (something a learner might say in this situation)\n- **Distinct in meaning** (not just word variations)\n- **Level-appropriate** (using vocabulary/structures the learner knows)\n\n## Distractor Design\n\n**CRITICAL**: Wrong options must be genuinely inappropriate for the situation - they should lead to miscommunication or confusion if used. Do NOT create distractors that are merely \"less polished\" versions of the correct answer.\n\nWrong options should be **clearly wrong** because they:\n\n1. **Answer a different question**: Respond to something the speaker didn't ask (asking about price when asked about quantity)\n2. **Request the wrong thing**: Order/ask for something different than intended (one-way ticket when you need round-trip)\n3. **Are off-topic**: Say something unrelated to the current conversation point (asking for the check when you just arrived)\n4. **Would cause confusion**: Use words that change the meaning entirely (saying \"no\" when you mean \"yes\")\n\n**DO NOT** create distractors that are:\n\n- Just more/less formal versions of the correct answer\n- Slightly different phrasings that would still work\n- Grammatically awkward but still understandable\n\n# Feedback Design\n\nFeedback appears AFTER the learner selects an option. Every feedback message MUST include:\n\n1. **Translation**: What the option actually means in the native language\n2. **Explanation**: Why this choice is correct or incorrect for the situation\n\n## Feedback Structure\n\nFor **correct** options:\n\n```\n\"[Translation of what they said] - [Why this works in context]\"\n```\n\nExample: \"A coffee with milk, please - Perfect! This is polite and clearly communicates what you want.\"\n\nFor **incorrect** options:\n\n```\n\"[Translation of what they said] - [Why this doesn't work and what would be better]\"\n```\n\nExample: \"Where is the bathroom? - You're trying to order coffee, not find the restroom. Tell the barista what you'd like to drink.\"\n\n# Romanization Requirements\n\nFor languages using non-Roman writing systems (Japanese, Chinese, Korean, Arabic, Russian, Greek, Hebrew, Thai, Hindi, etc.), provide romanization for both context and options.\n\n## Standard Systems\n\n- **Japanese**: Romaji using Hepburn romanization\n- **Chinese**: Pinyin with tone marks\n- **Korean**: Revised Romanization of Korean\n- **Russian**: ISO 9 or BGN/PCGN transliteration\n- **Arabic**: Standard romanization\n- **Greek**: Standard transliteration\n- **Thai**: Royal Thai General System\n- **Hindi**: IAST or Hunterian transliteration\n\n## Roman Scripts\n\nFor languages using Roman letters (Spanish, French, German, Portuguese, Italian, etc.), set both `contextRomanization` and `textRomanization` to empty strings `\"\"`.\n\n# Story Arc\n\nEach story should have 5-10 steps following a natural arc:\n\n## Step Progression\n\n1. **Opening** (1-2 steps): Arrive at the location, initial greeting\n2. **Building** (2-4 steps): Main interaction, making requests, clarifying\n3. **Complication** (0-2 steps): Optional challenge that adds realism\n4. **Resolution** (1-2 steps): Complete the transaction\n5. **Closing** (1 step): Thank and goodbye\n\n## Complication Ideas (Recommended)\n\nAdding a complication makes the story more realistic and teaches learners to handle unexpected situations:\n\n- **Item unavailable**: \"Sorry, we're out of that. Would you like something else?\"\n- **Misunderstanding**: \"Did you say two or twelve?\"\n- **Additional requirement**: \"I'll need to see your ID for that.\"\n- **Clarification needed**: \"Which size did you want?\"\n\n## Pacing Guidelines\n\n- Steps should feel like natural conversation beats\n- Each step presents ONE decision point\n- Context should flow naturally from the previous step\n- The native speaker's response should acknowledge what the learner said\n\n# Output Format\n\nReturn an object with this structure (abbreviated examples shown):\n\n**Non-Roman script example (Japanese):**\n\n```json\n{\n  \"scenario\": \"You're at a train station in Tokyo...\",\n  \"steps\": [\n    {\n      \"context\": \"いらっしゃいませ。どちらまで？\",\n      \"contextTranslation\": \"Welcome. Where to?\",\n      \"contextRomanization\": \"Irasshaimase. Dochira made?\",\n      \"options\": [\n        {\n          \"text\": \"京都までお願いします。\",\n          \"textRomanization\": \"Kyouto made onegaishimasu.\",\n          \"isCorrect\": true,\n          \"feedback\": \"To Kyoto, please - Perfect!\"\n        },\n        {\n          \"text\": \"京都は遠いですか？\",\n          \"textRomanization\": \"Kyouto wa tooi desu ka?\",\n          \"isCorrect\": false,\n          \"feedback\": \"Is Kyoto far? - This asks about distance, not for a ticket.\"\n        }\n      ]\n    }\n  ]\n}\n```\n\n**Roman script example (Spanish) - empty romanization fields:**\n\n```json\n{\n  \"scenario\": \"You're at a restaurant in Barcelona...\",\n  \"steps\": [\n    {\n      \"context\": \"Buenas noches. Estan listos para pedir?\",\n      \"contextTranslation\": \"Good evening. Are you ready to order?\",\n      \"contextRomanization\": \"\",\n      \"options\": [\n        {\n          \"text\": \"Si, me gustaria la paella, por favor.\",\n          \"textRomanization\": \"\",\n          \"isCorrect\": true,\n          \"feedback\": \"Yes, I would like the paella, please - Perfect!\"\n        },\n        {\n          \"text\": \"La cuenta, por favor.\",\n          \"textRomanization\": \"\",\n          \"isCorrect\": false,\n          \"feedback\": \"The check, please - You haven't eaten yet!\"\n        }\n      ]\n    }\n  ]\n}\n```\n\nNote: Examples above are abbreviated. Actual output must have 4 options per step and 5-10 steps total.\n\n# Quality Checklist\n\nBefore finalizing, verify:\n\n1. **Grammar accuracy**: All target language text is grammatically correct\n2. **Natural dialogue**: Conversations flow like real interactions\n3. **Appropriate register**: Formality matches the situation (casual cafe vs formal office)\n4. **Cultural accuracy**: Interactions reflect how things work in that culture\n5. **Clear progression**: Steps follow a logical narrative arc\n6. **Distinct options**: Each option represents a meaningfully different choice\n7. **Helpful feedback**: Translations and explanations clarify meaning and context\n8. **Correct romanization**: Follows standard systems for non-Roman scripts, empty for Roman scripts\n9. **Scenario relevance**: The story matches the lesson topic\n10. **Appropriate difficulty**: Language complexity matches learner level\n\n# Common Mistakes to Avoid\n\n1. **Including translations in options**: Options must show TARGET language only\n2. **Trivial distractors**: Options that are obviously wrong or nonsensical\n3. **Inconsistent register**: Mixing formal and informal inappropriately\n4. **Unnatural responses**: Things a native speaker would never actually say\n5. **Missing romanization**: Forgetting to add romanization for non-Roman scripts\n6. **Adding romanization to Roman scripts**: Spanish, French, etc. should have empty strings\n7. **Feedback without translation**: Always include what the option means\n8. **Disconnected steps**: Each step should follow logically from the previous one\n",
      "testCaseId": "es-korean-asking-directions-1",
      "userPrompt": "TARGET_LANGUAGE: Korean\nNATIVE_LANGUAGE: es\nCHAPTER_TITLE: Transporte y Direcciones\nLESSON_TITLE: Pidiendo Direcciones\nLESSON_DESCRIPTION: Como pedir direcciones y entender indicaciones basicas en coreano\n\nGenerate an immersive dialogue-driven story activity for this language lesson. Create a realistic everyday scenario where learners practice language production in situations they'd face in a foreign country."
    },
    {
      "duration": 18156.6945,
      "inputTokens": 2674,
      "output": "{\n  \"scenario\": \"You have a bad headache and feel a bit feverish while traveling in Spain. You walk into a local 'farmacia' (pharmacy) in Madrid to seek help and buy some medicine.\",\n  \"steps\": [\n    {\n      \"context\": \"¡Hola! Buenos días. ¿En qué puedo ayudarle?\",\n      \"contextRomanization\": \"\",\n      \"contextTranslation\": \"Hello! Good morning. How can I help you?\",\n      \"options\": [\n        {\n          \"feedback\": \"Hello, I don't feel very well. - Perfect! This is a natural and polite way to start explaining your situation.\",\n          \"isCorrect\": true,\n          \"text\": \"Hola, no me siento muy bien.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"I want a table for two. - You're at a pharmacy, not a restaurant! Use this at a cafe instead.\",\n          \"isCorrect\": false,\n          \"text\": \"Quiero una mesa para dos.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"I like the color blue. - While grammatically correct, this is irrelevant to your health needs.\",\n          \"isCorrect\": false,\n          \"text\": \"Me gusta el color azul.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"I have a reservation under the name Juan. - This phrase is for a hotel or a restaurant, not a pharmacy.\",\n          \"isCorrect\": false,\n          \"text\": \"Tengo una reserva a nombre de Juan.\",\n          \"textRomanization\": \"\"\n        }\n      ]\n    },\n    {\n      \"context\": \"Lo siento. ¿Qué síntomas tiene?\",\n      \"contextRomanization\": \"\",\n      \"contextTranslation\": \"I'm sorry to hear that. What symptoms do you have?\",\n      \"options\": [\n        {\n          \"feedback\": \"My head hurts a lot and I have a fever. - Great! You clearly identified the symptoms you are experiencing.\",\n          \"isCorrect\": true,\n          \"text\": \"Me duele mucho la cabeza y tengo fiebre.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"I lost my keys in the street. - This describes a lost item, not a physical symptom. The pharmacist can't help with lost keys!\",\n          \"isCorrect\": false,\n          \"text\": \"Perdí mis llaves en la calle.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"I would like to buy a ticket to Madrid. - You are already in Madrid! This is what you would say at a train station.\",\n          \"isCorrect\": false,\n          \"text\": \"Quisiera comprar un billete a Madrid.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"I am not hungry now. - This describes appetite, but doesn't explain the pain or fever the pharmacist asked about.\",\n          \"isCorrect\": false,\n          \"text\": \"No tengo hambre ahora.\",\n          \"textRomanization\": \"\"\n        }\n      ]\n    },\n    {\n      \"context\": \"¿Desde cuándo se siente así?\",\n      \"contextRomanization\": \"\",\n      \"contextTranslation\": \"Since when have you felt like this?\",\n      \"options\": [\n        {\n          \"feedback\": \"Since yesterday afternoon. - Exactly. This answers the 'since when' question perfectly.\",\n          \"isCorrect\": true,\n          \"text\": \"Desde ayer por la tarde.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"At five in the afternoon. - This is a specific time, but it lacks the word 'desde' (since), making it sound like an appointment time.\",\n          \"isCorrect\": false,\n          \"text\": \"A las cinco de la tarde.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"It is very hot today. - This is small talk about the weather, not an answer to how long you've been sick.\",\n          \"isCorrect\": false,\n          \"text\": \"Hace mucho calor hoy.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Tomorrow I am going to the beach. - This is about future plans and doesn't address your current health timeline.\",\n          \"isCorrect\": false,\n          \"text\": \"Mañana voy a la playa.\",\n          \"textRomanization\": \"\"\n        }\n      ]\n    },\n    {\n      \"context\": \"Entiendo. ¿Es alérgico a algún medicamento?\",\n      \"contextRomanization\": \"\",\n      \"contextTranslation\": \"I see. Are you allergic to any medication?\",\n      \"options\": [\n        {\n          \"feedback\": \"No, I don't have allergies. - Perfect. It's important to clarify this before the pharmacist gives you medicine.\",\n          \"isCorrect\": true,\n          \"text\": \"No, no tengo alergias.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Yes, I like medicine. - The pharmacist asked about allergies, not your preferences. This response is confusing.\",\n          \"isCorrect\": false,\n          \"text\": \"Sí, me gusta la medicina.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"I have a cat at home. - While you might be allergic to cats, the pharmacist specifically asked about medication allergies.\",\n          \"isCorrect\": false,\n          \"text\": \"Tengo un gato en casa.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"I don't speak much Spanish. - While possibly true, you need to answer the health question to get the right treatment safely.\",\n          \"isCorrect\": false,\n          \"text\": \"No hablo mucho español.\",\n          \"textRomanization\": \"\"\n        }\n      ]\n    },\n    {\n      \"context\": \"Bien. Le recomiendo este ibuprofeno. Debe tomar uno cada ocho horas con comida. ¿Le parece bien?\",\n      \"contextRomanization\": \"\",\n      \"contextTranslation\": \"Well. I recommend this ibuprofen. You should take one every eight hours with food. Does that sound good?\",\n      \"options\": [\n        {\n          \"feedback\": \"Yes, perfect. How much does it cost? - Great choice. You've accepted the recommendation and are moving to pay.\",\n          \"isCorrect\": true,\n          \"text\": \"Sí, perfecto. ¿Cuánto cuesta?\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"No, I prefer a black coffee. - You are at a pharmacy, not a cafe! You need medicine, not caffeine.\",\n          \"isCorrect\": false,\n          \"text\": \"No, prefiero un café solo.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"It's too late for that. - This sounds like you are rejecting the help for an unclear reason.\",\n          \"isCorrect\": false,\n          \"text\": \"Es demasiado tarde para eso.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Where is the bathroom? - This is a different question entirely and doesn't help you finish your purchase.\",\n          \"isCorrect\": false,\n          \"text\": \"¿Dónde está el baño?\",\n          \"textRomanization\": \"\"\n        }\n      ]\n    },\n    {\n      \"context\": \"Son cinco euros con cincuenta. Aquí tiene. ¡Que se mejore!\",\n      \"contextRomanization\": \"\",\n      \"contextTranslation\": \"It's five euros and fifty cents. Here you go. Get well soon!\",\n      \"options\": [\n        {\n          \"feedback\": \"Thank you very much. Goodbye. - Excellent. This is a polite and natural way to end the interaction.\",\n          \"isCorrect\": true,\n          \"text\": \"Muchas gracias. Adiós.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"The check, please. - You only use 'la cuenta' in restaurants. In a shop, you just pay the price mentioned.\",\n          \"isCorrect\": false,\n          \"text\": \"La cuenta, por favor.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"I don't like the price. - This is rude and unnecessary since you already agreed to the purchase.\",\n          \"isCorrect\": false,\n          \"text\": \"No me gusta el precio.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Welcome to my house. - This is a greeting for a guest entering your home, not a goodbye to a pharmacist.\",\n          \"isCorrect\": false,\n          \"text\": \"Bienvenido a mi casa.\",\n          \"textRomanization\": \"\"\n        }\n      ]\n    }\n  ]\n}",
      "outputTokens": 3072,
      "systemPrompt": "# Role\n\nYou are an expert language immersion designer specializing in creating realistic, dialogue-driven scenarios that help learners practice language production in authentic contexts. You design experiences that simulate situations learners would encounter when living or traveling in a country where the target language is spoken.\n\n# Goal\n\nCreate an immersive story activity where learners are placed in an everyday situation and must choose appropriate phrases to communicate. The activity simulates real conversations with native speakers, forcing learners to engage with the target language directly rather than relying on translations.\n\nThe activity places learners in a specific scenario (ordering food, asking for directions, checking into a hotel) and guides them through a dialogue where they must select appropriate responses at each step.\n\n# Key Design Principles\n\n## Immersion Over Translation\n\nUnlike other activities where translations help comprehension, this activity intentionally withholds translations from the options. Learners see:\n\n- **Context**: What the native speaker says (in TARGET language with translation)\n- **Options**: Four possible responses (in TARGET language ONLY - no translations)\n\nThis forces learners to:\n\n1. Engage with the target language sounds and patterns\n2. Use context clues to infer meaning\n3. Build recognition before relying on translations\n4. Experience the \"productive uncertainty\" of real conversations\n\nThe translation appears only in the feedback AFTER selection, revealing whether they understood correctly.\n\n## Authentic Scenarios\n\nFocus on situations learners will actually encounter:\n\n| Category       | Example Scenarios                                  |\n| -------------- | -------------------------------------------------- |\n| Food & Dining  | Ordering at a restaurant, asking about ingredients |\n| Transportation | Buying train tickets, asking for directions        |\n| Shopping       | Bargaining at a market, returning an item          |\n| Accommodation  | Checking into a hotel, reporting a problem         |\n| Healthcare     | Describing symptoms at a pharmacy, doctor's visit  |\n| Social         | Meeting neighbors, small talk at a cafe            |\n| Services       | Opening a bank account, getting a phone plan       |\n| Emergencies    | Reporting lost items, asking for help              |\n\n## Supportive Native Speaker\n\nThe character in the story is a friendly native speaker who:\n\n- Speaks naturally but not too fast\n- Helps the learner when they struggle\n- Provides context clues in their responses\n- Never mocks mistakes\n- Gradually introduces more complex language\n\n# Language Handling\n\n## Input Variables\n\n- **TARGET_LANGUAGE**: The language being learned (from `courseTitle`). All dialogue and options are in this language.\n- **NATIVE_LANGUAGE**: The learner's native language (from `language` code). Questions, feedback, and context translations use this language.\n\n## Language Codes\n\n- `en`: US English\n- `pt`: Brazilian Portuguese\n- `es`: Latin American Spanish\n\n## What Appears in Each Language\n\n| Field                        | Language     | Example (Spanish course, English native)                  |\n| ---------------------------- | ------------ | --------------------------------------------------------- |\n| `scenario`                   | NATIVE       | \"You're at a cafe in Madrid and want to order coffee.\"    |\n| `context`                    | TARGET       | \"Buenos dias, que le pongo?\"                              |\n| `contextTranslation`         | NATIVE       | \"Good morning, what can I get you?\"                       |\n| `contextRomanization`        | Romanization | \"\" (empty for Roman scripts)                              |\n| `options[].text`             | TARGET       | \"Un cafe con leche, por favor.\"                           |\n| `options[].textRomanization` | Romanization | \"\" (empty for Roman scripts)                              |\n| `options[].feedback`         | NATIVE       | \"A coffee with milk, please - Perfect! Polite and clear.\" |\n\n# Options Design\n\n## No Translations in Options\n\nThis is the most critical design decision. Options show ONLY:\n\n- `text`: The phrase in TARGET language\n- `textRomanization`: Romanization for non-Roman scripts (empty string for Roman scripts)\n\n**NO translation is shown**. This forces the learner to:\n\n1. Parse the target language directly\n2. Use patterns they've learned\n3. Make educated guesses based on context\n4. Experience the productive struggle of real communication\n\n## Option Quality\n\nAll 4 options must be:\n\n- **Grammatically correct** in the target language\n- **Contextually plausible** (something a learner might say in this situation)\n- **Distinct in meaning** (not just word variations)\n- **Level-appropriate** (using vocabulary/structures the learner knows)\n\n## Distractor Design\n\n**CRITICAL**: Wrong options must be genuinely inappropriate for the situation - they should lead to miscommunication or confusion if used. Do NOT create distractors that are merely \"less polished\" versions of the correct answer.\n\nWrong options should be **clearly wrong** because they:\n\n1. **Answer a different question**: Respond to something the speaker didn't ask (asking about price when asked about quantity)\n2. **Request the wrong thing**: Order/ask for something different than intended (one-way ticket when you need round-trip)\n3. **Are off-topic**: Say something unrelated to the current conversation point (asking for the check when you just arrived)\n4. **Would cause confusion**: Use words that change the meaning entirely (saying \"no\" when you mean \"yes\")\n\n**DO NOT** create distractors that are:\n\n- Just more/less formal versions of the correct answer\n- Slightly different phrasings that would still work\n- Grammatically awkward but still understandable\n\n# Feedback Design\n\nFeedback appears AFTER the learner selects an option. Every feedback message MUST include:\n\n1. **Translation**: What the option actually means in the native language\n2. **Explanation**: Why this choice is correct or incorrect for the situation\n\n## Feedback Structure\n\nFor **correct** options:\n\n```\n\"[Translation of what they said] - [Why this works in context]\"\n```\n\nExample: \"A coffee with milk, please - Perfect! This is polite and clearly communicates what you want.\"\n\nFor **incorrect** options:\n\n```\n\"[Translation of what they said] - [Why this doesn't work and what would be better]\"\n```\n\nExample: \"Where is the bathroom? - You're trying to order coffee, not find the restroom. Tell the barista what you'd like to drink.\"\n\n# Romanization Requirements\n\nFor languages using non-Roman writing systems (Japanese, Chinese, Korean, Arabic, Russian, Greek, Hebrew, Thai, Hindi, etc.), provide romanization for both context and options.\n\n## Standard Systems\n\n- **Japanese**: Romaji using Hepburn romanization\n- **Chinese**: Pinyin with tone marks\n- **Korean**: Revised Romanization of Korean\n- **Russian**: ISO 9 or BGN/PCGN transliteration\n- **Arabic**: Standard romanization\n- **Greek**: Standard transliteration\n- **Thai**: Royal Thai General System\n- **Hindi**: IAST or Hunterian transliteration\n\n## Roman Scripts\n\nFor languages using Roman letters (Spanish, French, German, Portuguese, Italian, etc.), set both `contextRomanization` and `textRomanization` to empty strings `\"\"`.\n\n# Story Arc\n\nEach story should have 5-10 steps following a natural arc:\n\n## Step Progression\n\n1. **Opening** (1-2 steps): Arrive at the location, initial greeting\n2. **Building** (2-4 steps): Main interaction, making requests, clarifying\n3. **Complication** (0-2 steps): Optional challenge that adds realism\n4. **Resolution** (1-2 steps): Complete the transaction\n5. **Closing** (1 step): Thank and goodbye\n\n## Complication Ideas (Recommended)\n\nAdding a complication makes the story more realistic and teaches learners to handle unexpected situations:\n\n- **Item unavailable**: \"Sorry, we're out of that. Would you like something else?\"\n- **Misunderstanding**: \"Did you say two or twelve?\"\n- **Additional requirement**: \"I'll need to see your ID for that.\"\n- **Clarification needed**: \"Which size did you want?\"\n\n## Pacing Guidelines\n\n- Steps should feel like natural conversation beats\n- Each step presents ONE decision point\n- Context should flow naturally from the previous step\n- The native speaker's response should acknowledge what the learner said\n\n# Output Format\n\nReturn an object with this structure (abbreviated examples shown):\n\n**Non-Roman script example (Japanese):**\n\n```json\n{\n  \"scenario\": \"You're at a train station in Tokyo...\",\n  \"steps\": [\n    {\n      \"context\": \"いらっしゃいませ。どちらまで？\",\n      \"contextTranslation\": \"Welcome. Where to?\",\n      \"contextRomanization\": \"Irasshaimase. Dochira made?\",\n      \"options\": [\n        {\n          \"text\": \"京都までお願いします。\",\n          \"textRomanization\": \"Kyouto made onegaishimasu.\",\n          \"isCorrect\": true,\n          \"feedback\": \"To Kyoto, please - Perfect!\"\n        },\n        {\n          \"text\": \"京都は遠いですか？\",\n          \"textRomanization\": \"Kyouto wa tooi desu ka?\",\n          \"isCorrect\": false,\n          \"feedback\": \"Is Kyoto far? - This asks about distance, not for a ticket.\"\n        }\n      ]\n    }\n  ]\n}\n```\n\n**Roman script example (Spanish) - empty romanization fields:**\n\n```json\n{\n  \"scenario\": \"You're at a restaurant in Barcelona...\",\n  \"steps\": [\n    {\n      \"context\": \"Buenas noches. Estan listos para pedir?\",\n      \"contextTranslation\": \"Good evening. Are you ready to order?\",\n      \"contextRomanization\": \"\",\n      \"options\": [\n        {\n          \"text\": \"Si, me gustaria la paella, por favor.\",\n          \"textRomanization\": \"\",\n          \"isCorrect\": true,\n          \"feedback\": \"Yes, I would like the paella, please - Perfect!\"\n        },\n        {\n          \"text\": \"La cuenta, por favor.\",\n          \"textRomanization\": \"\",\n          \"isCorrect\": false,\n          \"feedback\": \"The check, please - You haven't eaten yet!\"\n        }\n      ]\n    }\n  ]\n}\n```\n\nNote: Examples above are abbreviated. Actual output must have 4 options per step and 5-10 steps total.\n\n# Quality Checklist\n\nBefore finalizing, verify:\n\n1. **Grammar accuracy**: All target language text is grammatically correct\n2. **Natural dialogue**: Conversations flow like real interactions\n3. **Appropriate register**: Formality matches the situation (casual cafe vs formal office)\n4. **Cultural accuracy**: Interactions reflect how things work in that culture\n5. **Clear progression**: Steps follow a logical narrative arc\n6. **Distinct options**: Each option represents a meaningfully different choice\n7. **Helpful feedback**: Translations and explanations clarify meaning and context\n8. **Correct romanization**: Follows standard systems for non-Roman scripts, empty for Roman scripts\n9. **Scenario relevance**: The story matches the lesson topic\n10. **Appropriate difficulty**: Language complexity matches learner level\n\n# Common Mistakes to Avoid\n\n1. **Including translations in options**: Options must show TARGET language only\n2. **Trivial distractors**: Options that are obviously wrong or nonsensical\n3. **Inconsistent register**: Mixing formal and informal inappropriately\n4. **Unnatural responses**: Things a native speaker would never actually say\n5. **Missing romanization**: Forgetting to add romanization for non-Roman scripts\n6. **Adding romanization to Roman scripts**: Spanish, French, etc. should have empty strings\n7. **Feedback without translation**: Always include what the option means\n8. **Disconnected steps**: Each step should follow logically from the previous one\n",
      "testCaseId": "en-spanish-pharmacy-visit-1",
      "userPrompt": "TARGET_LANGUAGE: Spanish\nNATIVE_LANGUAGE: en\nCHAPTER_TITLE: Health and Wellness\nLESSON_TITLE: At the Pharmacy\nLESSON_DESCRIPTION: Learn to describe symptoms and buy medicine at a Spanish pharmacy\n\nGenerate an immersive dialogue-driven story activity for this language lesson. Create a realistic everyday scenario where learners practice language production in situations they'd face in a foreign country."
    }
  ],
  "taskId": "activity-story-language"
}
