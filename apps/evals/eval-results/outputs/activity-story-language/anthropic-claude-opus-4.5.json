{
  "generatedAt": "2026-01-21T21:29:33.944Z",
  "modelId": "anthropic/claude-opus-4.5",
  "outputs": [
    {
      "duration": 48556.036291,
      "inputTokens": 3735,
      "output": "{\n  \"scenario\": \"You've just arrived at a charming café in Paris on a sunny afternoon. You're ready to experience authentic French café culture and order some refreshments. The waiter approaches your table with a friendly smile.\",\n  \"steps\": [\n    {\n      \"context\": \"Bonjour ! Bienvenue au Café de la Place. Vous désirez ?\",\n      \"contextRomanization\": \"\",\n      \"contextTranslation\": \"Hello! Welcome to Café de la Place. What would you like?\",\n      \"options\": [\n        {\n          \"feedback\": \"Hello! Could I see the menu, please? - Perfect! A polite greeting followed by a courteous request for the menu.\",\n          \"isCorrect\": true,\n          \"text\": \"Bonjour ! Est-ce que je pourrais voir la carte, s'il vous plaît ?\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Where are the toilets? - The waiter just greeted you and asked what you'd like. It's better to greet them back and ask for the menu first.\",\n          \"isCorrect\": false,\n          \"text\": \"Où sont les toilettes ?\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"The check, please. - You've just arrived! You haven't ordered or eaten anything yet.\",\n          \"isCorrect\": false,\n          \"text\": \"L'addition, s'il vous plaît.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"I'm looking for the train station. - You're at a café to order something, not to ask for directions.\",\n          \"isCorrect\": false,\n          \"text\": \"Je cherche la gare.\",\n          \"textRomanization\": \"\"\n        }\n      ]\n    },\n    {\n      \"context\": \"Bien sûr, voici la carte. Je vous laisse quelques minutes pour choisir.\",\n      \"contextRomanization\": \"\",\n      \"contextTranslation\": \"Of course, here's the menu. I'll give you a few minutes to choose.\",\n      \"options\": [\n        {\n          \"feedback\": \"Thank you very much. - Excellent! A simple and polite acknowledgment as the waiter gives you time to decide.\",\n          \"isCorrect\": true,\n          \"text\": \"Merci beaucoup.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"No, I'm not hungry. - But you just asked for the menu! This would be confusing for the waiter.\",\n          \"isCorrect\": false,\n          \"text\": \"Non, je n'ai pas faim.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"It's too expensive. - You haven't even looked at the menu yet. This would be quite rude.\",\n          \"isCorrect\": false,\n          \"text\": \"C'est trop cher.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"I don't speak English. - This doesn't make sense here. The waiter is speaking French to you, not English.\",\n          \"isCorrect\": false,\n          \"text\": \"Je ne parle pas anglais.\",\n          \"textRomanization\": \"\"\n        }\n      ]\n    },\n    {\n      \"context\": \"Alors, vous avez choisi ?\",\n      \"contextRomanization\": \"\",\n      \"contextTranslation\": \"So, have you decided?\",\n      \"options\": [\n        {\n          \"feedback\": \"Yes, I would like a coffee with cream and a croissant, please. - Perfect! A classic French café order, politely phrased.\",\n          \"isCorrect\": true,\n          \"text\": \"Oui, je voudrais un café crème et un croissant, s'il vous plaît.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"No, I'm going to leave now. - You came to the café to order something. Leaving now would be strange!\",\n          \"isCorrect\": false,\n          \"text\": \"Non, je vais partir maintenant.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"What time is it? - The waiter is asking if you're ready to order, not telling you the time.\",\n          \"isCorrect\": false,\n          \"text\": \"Quelle heure est-il ?\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"I would like to reserve a table for tomorrow. - You're already seated and the waiter is waiting for your order right now.\",\n          \"isCorrect\": false,\n          \"text\": \"Je voudrais réserver une table pour demain.\",\n          \"textRomanization\": \"\"\n        }\n      ]\n    },\n    {\n      \"context\": \"Ah, je suis désolé, nous n'avons plus de croissants. Nous avons des pains au chocolat ou des tartes aux pommes.\",\n      \"contextRomanization\": \"\",\n      \"contextTranslation\": \"Ah, I'm sorry, we don't have any more croissants. We have chocolate pastries or apple tarts.\",\n      \"options\": [\n        {\n          \"feedback\": \"Okay, I'll have a chocolate pastry then. - Great choice! You handled the unexpected situation smoothly by selecting an alternative.\",\n          \"isCorrect\": true,\n          \"text\": \"D'accord, je vais prendre un pain au chocolat alors.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"I would like a croissant, please. - The waiter just told you they're out of croissants. You need to choose something else.\",\n          \"isCorrect\": false,\n          \"text\": \"Je voudrais un croissant, s'il vous plaît.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"I don't like coffee. - This doesn't address the pastry situation. The waiter is offering alternatives to the croissant.\",\n          \"isCorrect\": false,\n          \"text\": \"Je n'aime pas le café.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Where is the bakery? - You're already at a café with other pastry options. There's no need to go elsewhere.\",\n          \"isCorrect\": false,\n          \"text\": \"Où est la boulangerie ?\",\n          \"textRomanization\": \"\"\n        }\n      ]\n    },\n    {\n      \"context\": \"Très bien ! Un café crème et un pain au chocolat. Vous désirez autre chose ?\",\n      \"contextRomanization\": \"\",\n      \"contextTranslation\": \"Very good! A coffee with cream and a chocolate pastry. Would you like anything else?\",\n      \"options\": [\n        {\n          \"feedback\": \"Yes, a glass of water, please. - Perfect! It's very common to ask for water with your order in a French café.\",\n          \"isCorrect\": true,\n          \"text\": \"Oui, un verre d'eau, s'il vous plaît.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"I would like to cancel my order. - You just placed your order! Canceling now would be very confusing.\",\n          \"isCorrect\": false,\n          \"text\": \"Je voudrais annuler ma commande.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"I'm looking for a hotel. - The waiter is asking if you want to add anything to your food order, not offering travel advice.\",\n          \"isCorrect\": false,\n          \"text\": \"Je cherche un hôtel.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"What time does the train leave? - This is a café, not a train station. The waiter is asking about your order.\",\n          \"isCorrect\": false,\n          \"text\": \"Le train part à quelle heure ?\",\n          \"textRomanization\": \"\"\n        }\n      ]\n    },\n    {\n      \"context\": \"Voilà votre café crème, votre pain au chocolat et votre verre d'eau. Bon appétit !\",\n      \"contextRomanization\": \"\",\n      \"contextTranslation\": \"Here's your coffee with cream, your chocolate pastry, and your glass of water. Enjoy your meal!\",\n      \"options\": [\n        {\n          \"feedback\": \"Thank you very much! - Excellent! A warm thank you is the perfect response when receiving your order.\",\n          \"isCorrect\": true,\n          \"text\": \"Merci beaucoup !\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"This is not what I ordered. - But it is exactly what you ordered! The waiter brought everything correctly.\",\n          \"isCorrect\": false,\n          \"text\": \"Ce n'est pas ce que j'ai commandé.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"I'm not thirsty. - You just ordered a coffee and water. It would be strange to say this now.\",\n          \"isCorrect\": false,\n          \"text\": \"Je n'ai pas soif.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"I would like to change tables. - Your food has just arrived. It's not the right moment to ask to move.\",\n          \"isCorrect\": false,\n          \"text\": \"Je voudrais changer de table.\",\n          \"textRomanization\": \"\"\n        }\n      ]\n    },\n    {\n      \"context\": \"Tout se passe bien ? Le café est bon ?\",\n      \"contextRomanization\": \"\",\n      \"contextTranslation\": \"Is everything going well? Is the coffee good?\",\n      \"options\": [\n        {\n          \"feedback\": \"Yes, it's delicious, thank you! - Perfect! A friendly and appreciative response to the waiter's check-in.\",\n          \"isCorrect\": true,\n          \"text\": \"Oui, c'est délicieux, merci !\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"I don't understand French. - You've been speaking French this whole time! This would be very confusing.\",\n          \"isCorrect\": false,\n          \"text\": \"Je ne comprends pas le français.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"I would like to speak to the manager. - Everything is fine! There's no reason to escalate anything.\",\n          \"isCorrect\": false,\n          \"text\": \"Je voudrais parler au directeur.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"No, the coffee is cold. - You just received your order and there's no indication anything is wrong. This would be an unnecessary complaint.\",\n          \"isCorrect\": false,\n          \"text\": \"Non, le café est froid.\",\n          \"textRomanization\": \"\"\n        }\n      ]\n    },\n    {\n      \"context\": \"Je suis content que ça vous plaise. Vous désirez un dessert peut-être ?\",\n      \"contextRomanization\": \"\",\n      \"contextTranslation\": \"I'm glad you like it. Would you like a dessert perhaps?\",\n      \"options\": [\n        {\n          \"feedback\": \"No thank you, I'll take the check. - Perfect! A polite way to decline and signal you're ready to pay.\",\n          \"isCorrect\": true,\n          \"text\": \"Non merci, je vais prendre l'addition.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Yes, I would like a coffee with cream. - The waiter asked about dessert, not another drink. Coffee isn't a dessert!\",\n          \"isCorrect\": false,\n          \"text\": \"Oui, je voudrais un café crème.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"I don't know where I am. - This has nothing to do with the waiter's question about dessert.\",\n          \"isCorrect\": false,\n          \"text\": \"Je ne sais pas où je suis.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"What time do you close? - The waiter is offering dessert. This question doesn't answer whether you want one.\",\n          \"isCorrect\": false,\n          \"text\": \"À quelle heure fermez-vous ?\",\n          \"textRomanization\": \"\"\n        }\n      ]\n    },\n    {\n      \"context\": \"Voici l'addition. Ça fait huit euros cinquante.\",\n      \"contextRomanization\": \"\",\n      \"contextTranslation\": \"Here's the check. That's eight euros fifty.\",\n      \"options\": [\n        {\n          \"feedback\": \"Can I pay by card? - Excellent! An important question to ask before trying to pay, as some French cafés prefer cash.\",\n          \"isCorrect\": true,\n          \"text\": \"Est-ce que je peux payer par carte ?\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Is it free? - No, the waiter just told you the total is €8.50. You need to pay for your order.\",\n          \"isCorrect\": false,\n          \"text\": \"C'est gratuit ?\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"I would like to order something else. - You already asked for the check. Ordering more now would be confusing.\",\n          \"isCorrect\": false,\n          \"text\": \"Je voudrais commander autre chose.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Where is the exit? - You need to pay first before leaving the café!\",\n          \"isCorrect\": false,\n          \"text\": \"Où est la sortie ?\",\n          \"textRomanization\": \"\"\n        }\n      ]\n    },\n    {\n      \"context\": \"Oui, bien sûr, on accepte les cartes. Voilà, c'est fait. Merci et bonne journée !\",\n      \"contextRomanization\": \"\",\n      \"contextTranslation\": \"Yes, of course, we accept cards. There you go, it's done. Thank you and have a nice day!\",\n      \"options\": [\n        {\n          \"feedback\": \"Thank you, goodbye and have a nice day to you too! - Perfect! A warm and polite farewell to end your café experience.\",\n          \"isCorrect\": true,\n          \"text\": \"Merci, au revoir et bonne journée à vous aussi !\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"I would like to stay a bit longer. - You've already paid and the waiter said goodbye. It's time to leave.\",\n          \"isCorrect\": false,\n          \"text\": \"Je voudrais rester encore un peu.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"I'm not satisfied. - Everything went well! There's no reason to complain after a pleasant experience.\",\n          \"isCorrect\": false,\n          \"text\": \"Je ne suis pas satisfait.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Do you speak English? - You've successfully completed the entire conversation in French. It's time to say goodbye!\",\n          \"isCorrect\": false,\n          \"text\": \"Vous parlez anglais ?\",\n          \"textRomanization\": \"\"\n        }\n      ]\n    }\n  ]\n}",
      "outputTokens": 3819,
      "systemPrompt": "# Role\n\nYou are an expert language immersion designer specializing in creating realistic, dialogue-driven scenarios that help learners practice language production in authentic contexts. You design experiences that simulate situations learners would encounter when living or traveling in a country where the target language is spoken.\n\n# Goal\n\nCreate an immersive story activity where learners are placed in an everyday situation and must choose appropriate phrases to communicate. The activity simulates real conversations with native speakers, forcing learners to engage with the target language directly rather than relying on translations.\n\nThe activity places learners in a specific scenario (ordering food, asking for directions, checking into a hotel) and guides them through a dialogue where they must select appropriate responses at each step.\n\n# Key Design Principles\n\n## Immersion Over Translation\n\nUnlike other activities where translations help comprehension, this activity intentionally withholds translations from the options. Learners see:\n\n- **Context**: What the native speaker says (in TARGET language with translation)\n- **Options**: Four possible responses (in TARGET language ONLY - no translations)\n\nThis forces learners to:\n\n1. Engage with the target language sounds and patterns\n2. Use context clues to infer meaning\n3. Build recognition before relying on translations\n4. Experience the \"productive uncertainty\" of real conversations\n\nThe translation appears only in the feedback AFTER selection, revealing whether they understood correctly.\n\n## Authentic Scenarios\n\nFocus on situations learners will actually encounter:\n\n| Category       | Example Scenarios                                  |\n| -------------- | -------------------------------------------------- |\n| Food & Dining  | Ordering at a restaurant, asking about ingredients |\n| Transportation | Buying train tickets, asking for directions        |\n| Shopping       | Bargaining at a market, returning an item          |\n| Accommodation  | Checking into a hotel, reporting a problem         |\n| Healthcare     | Describing symptoms at a pharmacy, doctor's visit  |\n| Social         | Meeting neighbors, small talk at a cafe            |\n| Services       | Opening a bank account, getting a phone plan       |\n| Emergencies    | Reporting lost items, asking for help              |\n\n## Supportive Native Speaker\n\nThe character in the story is a friendly native speaker who:\n\n- Speaks naturally but not too fast\n- Helps the learner when they struggle\n- Provides context clues in their responses\n- Never mocks mistakes\n- Gradually introduces more complex language\n\n# Language Handling\n\n## Input Variables\n\n- **TARGET_LANGUAGE**: The language being learned (from `courseTitle`). All dialogue and options are in this language.\n- **NATIVE_LANGUAGE**: The learner's native language (from `language` code). Questions, feedback, and context translations use this language.\n\n## Language Codes\n\n- `en`: US English\n- `pt`: Brazilian Portuguese\n- `es`: Latin American Spanish\n\n## What Appears in Each Language\n\n| Field                        | Language     | Example (Spanish course, English native)                  |\n| ---------------------------- | ------------ | --------------------------------------------------------- |\n| `scenario`                   | NATIVE       | \"You're at a cafe in Madrid and want to order coffee.\"    |\n| `context`                    | TARGET       | \"Buenos dias, que le pongo?\"                              |\n| `contextTranslation`         | NATIVE       | \"Good morning, what can I get you?\"                       |\n| `contextRomanization`        | Romanization | \"\" (empty for Roman scripts)                              |\n| `options[].text`             | TARGET       | \"Un cafe con leche, por favor.\"                           |\n| `options[].textRomanization` | Romanization | \"\" (empty for Roman scripts)                              |\n| `options[].feedback`         | NATIVE       | \"A coffee with milk, please - Perfect! Polite and clear.\" |\n\n# Options Design\n\n## No Translations in Options\n\nThis is the most critical design decision. Options show ONLY:\n\n- `text`: The phrase in TARGET language\n- `textRomanization`: Romanization for non-Roman scripts (empty string for Roman scripts)\n\n**NO translation is shown**. This forces the learner to:\n\n1. Parse the target language directly\n2. Use patterns they've learned\n3. Make educated guesses based on context\n4. Experience the productive struggle of real communication\n\n## Option Quality\n\nAll 4 options must be:\n\n- **Grammatically correct** in the target language\n- **Contextually plausible** (something a learner might say in this situation)\n- **Distinct in meaning** (not just word variations)\n- **Level-appropriate** (using vocabulary/structures the learner knows)\n\n## Distractor Design\n\n**CRITICAL**: Wrong options must be genuinely inappropriate for the situation - they should lead to miscommunication or confusion if used. Do NOT create distractors that are merely \"less polished\" versions of the correct answer.\n\nWrong options should be **clearly wrong** because they:\n\n1. **Answer a different question**: Respond to something the speaker didn't ask (asking about price when asked about quantity)\n2. **Request the wrong thing**: Order/ask for something different than intended (one-way ticket when you need round-trip)\n3. **Are off-topic**: Say something unrelated to the current conversation point (asking for the check when you just arrived)\n4. **Would cause confusion**: Use words that change the meaning entirely (saying \"no\" when you mean \"yes\")\n\n**DO NOT** create distractors that are:\n\n- Just more/less formal versions of the correct answer\n- Slightly different phrasings that would still work\n- Grammatically awkward but still understandable\n\n# Feedback Design\n\nFeedback appears AFTER the learner selects an option. Every feedback message MUST include:\n\n1. **Translation**: What the option actually means in the native language\n2. **Explanation**: Why this choice is correct or incorrect for the situation\n\n## Feedback Structure\n\nFor **correct** options:\n\n```\n\"[Translation of what they said] - [Why this works in context]\"\n```\n\nExample: \"A coffee with milk, please - Perfect! This is polite and clearly communicates what you want.\"\n\nFor **incorrect** options:\n\n```\n\"[Translation of what they said] - [Why this doesn't work and what would be better]\"\n```\n\nExample: \"Where is the bathroom? - You're trying to order coffee, not find the restroom. Tell the barista what you'd like to drink.\"\n\n# Romanization Requirements\n\nFor languages using non-Roman writing systems (Japanese, Chinese, Korean, Arabic, Russian, Greek, Hebrew, Thai, Hindi, etc.), provide romanization for both context and options.\n\n## Standard Systems\n\n- **Japanese**: Romaji using Hepburn romanization\n- **Chinese**: Pinyin with tone marks\n- **Korean**: Revised Romanization of Korean\n- **Russian**: ISO 9 or BGN/PCGN transliteration\n- **Arabic**: Standard romanization\n- **Greek**: Standard transliteration\n- **Thai**: Royal Thai General System\n- **Hindi**: IAST or Hunterian transliteration\n\n## Roman Scripts\n\nFor languages using Roman letters (Spanish, French, German, Portuguese, Italian, etc.), set both `contextRomanization` and `textRomanization` to empty strings `\"\"`.\n\n# Story Arc\n\nEach story should have 5-10 steps following a natural arc:\n\n## Step Progression\n\n1. **Opening** (1-2 steps): Arrive at the location, initial greeting\n2. **Building** (2-4 steps): Main interaction, making requests, clarifying\n3. **Complication** (0-2 steps): Optional challenge that adds realism\n4. **Resolution** (1-2 steps): Complete the transaction\n5. **Closing** (1 step): Thank and goodbye\n\n## Complication Ideas (Recommended)\n\nAdding a complication makes the story more realistic and teaches learners to handle unexpected situations:\n\n- **Item unavailable**: \"Sorry, we're out of that. Would you like something else?\"\n- **Misunderstanding**: \"Did you say two or twelve?\"\n- **Additional requirement**: \"I'll need to see your ID for that.\"\n- **Clarification needed**: \"Which size did you want?\"\n\n## Pacing Guidelines\n\n- Steps should feel like natural conversation beats\n- Each step presents ONE decision point\n- Context should flow naturally from the previous step\n- The native speaker's response should acknowledge what the learner said\n\n# Output Format\n\nReturn an object with this structure (abbreviated examples shown):\n\n**Non-Roman script example (Japanese):**\n\n```json\n{\n  \"scenario\": \"You're at a train station in Tokyo...\",\n  \"steps\": [\n    {\n      \"context\": \"いらっしゃいませ。どちらまで？\",\n      \"contextTranslation\": \"Welcome. Where to?\",\n      \"contextRomanization\": \"Irasshaimase. Dochira made?\",\n      \"options\": [\n        {\n          \"text\": \"京都までお願いします。\",\n          \"textRomanization\": \"Kyouto made onegaishimasu.\",\n          \"isCorrect\": true,\n          \"feedback\": \"To Kyoto, please - Perfect!\"\n        },\n        {\n          \"text\": \"京都は遠いですか？\",\n          \"textRomanization\": \"Kyouto wa tooi desu ka?\",\n          \"isCorrect\": false,\n          \"feedback\": \"Is Kyoto far? - This asks about distance, not for a ticket.\"\n        }\n      ]\n    }\n  ]\n}\n```\n\n**Roman script example (Spanish) - empty romanization fields:**\n\n```json\n{\n  \"scenario\": \"You're at a restaurant in Barcelona...\",\n  \"steps\": [\n    {\n      \"context\": \"Buenas noches. Estan listos para pedir?\",\n      \"contextTranslation\": \"Good evening. Are you ready to order?\",\n      \"contextRomanization\": \"\",\n      \"options\": [\n        {\n          \"text\": \"Si, me gustaria la paella, por favor.\",\n          \"textRomanization\": \"\",\n          \"isCorrect\": true,\n          \"feedback\": \"Yes, I would like the paella, please - Perfect!\"\n        },\n        {\n          \"text\": \"La cuenta, por favor.\",\n          \"textRomanization\": \"\",\n          \"isCorrect\": false,\n          \"feedback\": \"The check, please - You haven't eaten yet!\"\n        }\n      ]\n    }\n  ]\n}\n```\n\nNote: Examples above are abbreviated. Actual output must have 4 options per step and 5-10 steps total.\n\n# Quality Checklist\n\nBefore finalizing, verify:\n\n1. **Grammar accuracy**: All target language text is grammatically correct\n2. **Natural dialogue**: Conversations flow like real interactions\n3. **Appropriate register**: Formality matches the situation (casual cafe vs formal office)\n4. **Cultural accuracy**: Interactions reflect how things work in that culture\n5. **Clear progression**: Steps follow a logical narrative arc\n6. **Distinct options**: Each option represents a meaningfully different choice\n7. **Helpful feedback**: Translations and explanations clarify meaning and context\n8. **Correct romanization**: Follows standard systems for non-Roman scripts, empty for Roman scripts\n9. **Scenario relevance**: The story matches the lesson topic\n10. **Appropriate difficulty**: Language complexity matches learner level\n\n# Common Mistakes to Avoid\n\n1. **Including translations in options**: Options must show TARGET language only\n2. **Trivial distractors**: Options that are obviously wrong or nonsensical\n3. **Inconsistent register**: Mixing formal and informal inappropriately\n4. **Unnatural responses**: Things a native speaker would never actually say\n5. **Missing romanization**: Forgetting to add romanization for non-Roman scripts\n6. **Adding romanization to Roman scripts**: Spanish, French, etc. should have empty strings\n7. **Feedback without translation**: Always include what the option means\n8. **Disconnected steps**: Each step should follow logically from the previous one\n",
      "testCaseId": "en-french-cafe-ordering-1",
      "userPrompt": "TARGET_LANGUAGE: French\nNATIVE_LANGUAGE: en\nCHAPTER_TITLE: At the Cafe\nLESSON_TITLE: Ordering at a Cafe\nLESSON_DESCRIPTION: Practice ordering drinks and food at a French cafe, including asking for the menu and paying\n\nGenerate an immersive dialogue-driven story activity for this language lesson. Create a realistic everyday scenario where learners practice language production in situations they'd face in a foreign country."
    },
    {
      "duration": 62852.6955,
      "inputTokens": 3733,
      "output": "{\n  \"scenario\": \"You've just arrived at a hotel in Tokyo after a long flight. You approach the front desk to check in and confirm your reservation. The friendly front desk clerk greets you warmly.\",\n  \"steps\": [\n    {\n      \"context\": \"いらっしゃいませ。ご予約はございますか？\",\n      \"contextRomanization\": \"Irasshaimase. Goyoyaku wa gozaimasu ka?\",\n      \"contextTranslation\": \"Welcome. Do you have a reservation?\",\n      \"options\": [\n        {\n          \"feedback\": \"Yes, I have a reservation. I booked under the name Tanaka. - Perfect! You confirmed your reservation and provided your name clearly.\",\n          \"isCorrect\": true,\n          \"text\": \"はい、予約があります。田中の名前で予約しました。\",\n          \"textRomanization\": \"Hai, yoyaku ga arimasu. Tanaka no namae de yoyaku shimashita.\"\n        },\n        {\n          \"feedback\": \"What time is checkout? - You haven't even checked in yet! First, you need to confirm your reservation.\",\n          \"isCorrect\": false,\n          \"text\": \"チェックアウトは何時ですか？\",\n          \"textRomanization\": \"Chekkuauto wa nanji desu ka?\"\n        },\n        {\n          \"feedback\": \"Where is the airport? - You just came from the airport! The clerk is asking about your reservation.\",\n          \"isCorrect\": false,\n          \"text\": \"空港はどこですか？\",\n          \"textRomanization\": \"Kuukou wa doko desu ka?\"\n        },\n        {\n          \"feedback\": \"No, I'm fine (declining something). - This doesn't answer the question. You need to confirm you have a reservation.\",\n          \"isCorrect\": false,\n          \"text\": \"いいえ、結構です。\",\n          \"textRomanization\": \"Iie, kekkou desu.\"\n        }\n      ]\n    },\n    {\n      \"context\": \"田中様ですね。少々お待ちください。はい、二泊のご予約ですね。お部屋はシングルとツイン、どちらがよろしいですか？\",\n      \"contextRomanization\": \"Tanaka-sama desu ne. Shoushou omachi kudasai. Hai, nihaku no goyoyaku desu ne. Oheya wa shinguru to tsuin, dochira ga yoroshii desu ka?\",\n      \"contextTranslation\": \"Mr./Ms. Tanaka, right? Please wait a moment. Yes, you have a reservation for two nights. Would you prefer a single or twin room?\",\n      \"options\": [\n        {\n          \"feedback\": \"A twin room, please. - Great choice! You clearly stated your room preference in a polite way.\",\n          \"isCorrect\": true,\n          \"text\": \"ツインルームをお願いします。\",\n          \"textRomanization\": \"Tsuin ruumu wo onegaishimasu.\"\n        },\n        {\n          \"feedback\": \"What time is breakfast? - You can ask about breakfast later. Right now, the clerk needs to know which room type you want.\",\n          \"isCorrect\": false,\n          \"text\": \"朝ごはんは何時ですか？\",\n          \"textRomanization\": \"Asagohan wa nanji desu ka?\"\n        },\n        {\n          \"feedback\": \"Three nights, please. - The clerk already confirmed you have a two-night reservation. They're asking about room type, not the length of stay.\",\n          \"isCorrect\": false,\n          \"text\": \"三泊お願いします。\",\n          \"textRomanization\": \"Sanpaku onegaishimasu.\"\n        },\n        {\n          \"feedback\": \"I want to cancel my reservation. - You just arrived! The clerk is asking which room type you prefer.\",\n          \"isCorrect\": false,\n          \"text\": \"予約をキャンセルしたいです。\",\n          \"textRomanization\": \"Yoyaku wo kyanseru shitai desu.\"\n        }\n      ]\n    },\n    {\n      \"context\": \"かしこまりました。ツインルームですね。申し訳ございませんが、禁煙ルームと喫煙ルーム、どちらがよろしいですか？\",\n      \"contextRomanization\": \"Kashikomarimashita. Tsuin ruumu desu ne. Moushiwake gozaimasen ga, kin'en ruumu to kitsuen ruumu, dochira ga yoroshii desu ka?\",\n      \"contextTranslation\": \"Understood. A twin room, right? I'm sorry to ask, but would you prefer a non-smoking or smoking room?\",\n      \"options\": [\n        {\n          \"feedback\": \"A non-smoking room, please. - Perfect! You clearly communicated your preference for a non-smoking room.\",\n          \"isCorrect\": true,\n          \"text\": \"禁煙ルームをお願いします。\",\n          \"textRomanization\": \"Kin'en ruumu wo onegaishimasu.\"\n        },\n        {\n          \"feedback\": \"Is there Wi-Fi? - Good question, but the clerk is waiting for you to choose between smoking and non-smoking first.\",\n          \"isCorrect\": false,\n          \"text\": \"Wi-Fiはありますか？\",\n          \"textRomanization\": \"Waifai wa arimasu ka?\"\n        },\n        {\n          \"feedback\": \"That's expensive. - The clerk hasn't mentioned the price. They're asking about your smoking preference.\",\n          \"isCorrect\": false,\n          \"text\": \"高いですね。\",\n          \"textRomanization\": \"Takai desu ne.\"\n        },\n        {\n          \"feedback\": \"Where is Tokyo Tower? - You can ask about sightseeing later. First, answer the clerk's question about room type.\",\n          \"isCorrect\": false,\n          \"text\": \"東京タワーはどこですか？\",\n          \"textRomanization\": \"Toukyou tawaa wa doko desu ka?\"\n        }\n      ]\n    },\n    {\n      \"context\": \"はい、禁煙ルームですね。パスポートを見せていただけますか？\",\n      \"contextRomanization\": \"Hai, kin'en ruumu desu ne. Pasupooto wo misete itadakemasu ka?\",\n      \"contextTranslation\": \"Yes, a non-smoking room. May I see your passport?\",\n      \"options\": [\n        {\n          \"feedback\": \"Yes, here you go. Here it is. - Perfect! You politely handed over your passport.\",\n          \"isCorrect\": true,\n          \"text\": \"はい、どうぞ。こちらです。\",\n          \"textRomanization\": \"Hai, douzo. Kochira desu.\"\n        },\n        {\n          \"feedback\": \"I forgot my passport. I'll bring it tomorrow. - You won't be able to check in without your passport! Hotels in Japan require it.\",\n          \"isCorrect\": false,\n          \"text\": \"パスポートを忘れました。明日持ってきます。\",\n          \"textRomanization\": \"Pasupooto wo wasuremashita. Ashita motte kimasu.\"\n        },\n        {\n          \"feedback\": \"I'll pay by credit card. - Payment comes later. The clerk needs to see your passport first for registration.\",\n          \"isCorrect\": false,\n          \"text\": \"クレジットカードで払います。\",\n          \"textRomanization\": \"Kurejitto kaado de haraimasu.\"\n        },\n        {\n          \"feedback\": \"How much is it? - The clerk is asking for your passport, not discussing payment yet.\",\n          \"isCorrect\": false,\n          \"text\": \"いくらですか？\",\n          \"textRomanization\": \"Ikura desu ka?\"\n        }\n      ]\n    },\n    {\n      \"context\": \"ありがとうございます。お部屋は七階の七〇五号室です。Wi-Fiと朝食について、ご質問はありますか？\",\n      \"contextRomanization\": \"Arigatou gozaimasu. Oheya wa nanakai no nana zero go goushitsu desu. Waifai to choushoku ni tsuite, goshitsumon wa arimasu ka?\",\n      \"contextTranslation\": \"Thank you. Your room is on the 7th floor, room 705. Do you have any questions about Wi-Fi or breakfast?\",\n      \"options\": [\n        {\n          \"feedback\": \"Yes, what is the Wi-Fi password? - Great question! This is useful information to ask about at check-in.\",\n          \"isCorrect\": true,\n          \"text\": \"はい、Wi-Fiのパスワードは何ですか？\",\n          \"textRomanization\": \"Hai, waifai no pasuwaado wa nan desu ka?\"\n        },\n        {\n          \"feedback\": \"Please call a taxi. - You just arrived! The clerk is offering to answer questions about amenities.\",\n          \"isCorrect\": false,\n          \"text\": \"タクシーを呼んでください。\",\n          \"textRomanization\": \"Takushii wo yonde kudasai.\"\n        },\n        {\n          \"feedback\": \"I'll check out. - You just checked in! The clerk is asking if you have questions about the amenities.\",\n          \"isCorrect\": false,\n          \"text\": \"チェックアウトします。\",\n          \"textRomanization\": \"Chekkuauto shimasu.\"\n        },\n        {\n          \"feedback\": \"I want to change rooms. - You haven't even seen your room yet! The clerk is offering information about Wi-Fi and breakfast.\",\n          \"isCorrect\": false,\n          \"text\": \"部屋を変えたいです。\",\n          \"textRomanization\": \"Heya wo kaetai desu.\"\n        }\n      ]\n    },\n    {\n      \"context\": \"Wi-Fiのパスワードはお部屋のテーブルにあります。朝食は六時から十時までです。他に何かございますか？\",\n      \"contextRomanization\": \"Waifai no pasuwaado wa oheya no teeburu ni arimasu. Choushoku wa rokuji kara juuji made desu. Hoka ni nanika gozaimasu ka?\",\n      \"contextTranslation\": \"The Wi-Fi password is on the table in your room. Breakfast is from 6 AM to 10 AM. Is there anything else?\",\n      \"options\": [\n        {\n          \"feedback\": \"Where can I eat breakfast? - Excellent follow-up question! It's helpful to know where the breakfast area is located.\",\n          \"isCorrect\": true,\n          \"text\": \"朝食はどこで食べられますか？\",\n          \"textRomanization\": \"Choushoku wa doko de taberaremasu ka?\"\n        },\n        {\n          \"feedback\": \"I want to buy an airplane ticket. - This isn't something the hotel front desk handles. You'd need a travel agency or airline for this.\",\n          \"isCorrect\": false,\n          \"text\": \"飛行機のチケットを買いたいです。\",\n          \"textRomanization\": \"Hikouki no chiketto wo kaitai desu.\"\n        },\n        {\n          \"feedback\": \"Please hold my luggage. It's after checkout. - You just arrived! This request doesn't make sense at check-in.\",\n          \"isCorrect\": false,\n          \"text\": \"荷物を預かってください。チェックアウト後です。\",\n          \"textRomanization\": \"Nimotsu wo azukatte kudasai. Chekkuauto go desu.\"\n        },\n        {\n          \"feedback\": \"Please cancel my reservation. - You're already checking in! The clerk is asking if you have other questions about amenities.\",\n          \"isCorrect\": false,\n          \"text\": \"予約を取り消してください。\",\n          \"textRomanization\": \"Yoyaku wo torikeshite kudasai.\"\n        }\n      ]\n    },\n    {\n      \"context\": \"朝食は一階のレストランでお召し上がりいただけます。エレベーターは右手にございます。\",\n      \"contextRomanization\": \"Choushoku wa ikkai no resutoran de omeshiagari itadakemasu. Erebeetaa wa migite ni gozaimasu.\",\n      \"contextTranslation\": \"You can have breakfast at the restaurant on the first floor. The elevator is on your right.\",\n      \"options\": [\n        {\n          \"feedback\": \"I understand. Thank you. - Perfect! You acknowledged the information politely.\",\n          \"isCorrect\": true,\n          \"text\": \"分かりました。ありがとうございます。\",\n          \"textRomanization\": \"Wakarimashita. Arigatou gozaimasu.\"\n        },\n        {\n          \"feedback\": \"Is the restaurant expensive? - Breakfast is typically included or has a set price at hotels. This question seems out of place here.\",\n          \"isCorrect\": false,\n          \"text\": \"レストランは高いですか？\",\n          \"textRomanization\": \"Resutoran wa takai desu ka?\"\n        },\n        {\n          \"feedback\": \"Where is the first floor? - You're on the first floor right now! The lobby is on the ground floor in Japan.\",\n          \"isCorrect\": false,\n          \"text\": \"一階はどこですか？\",\n          \"textRomanization\": \"Ikkai wa doko desu ka?\"\n        },\n        {\n          \"feedback\": \"I don't need breakfast. - The clerk just helpfully answered your question about where to eat. A thank you would be more appropriate.\",\n          \"isCorrect\": false,\n          \"text\": \"朝食は要りません。\",\n          \"textRomanization\": \"Choushoku wa irimasen.\"\n        }\n      ]\n    },\n    {\n      \"context\": \"どういたしまして。あ、すみません、お部屋にアイロンがございませんが、フロントで貸し出しております。ご利用になりますか？\",\n      \"contextRomanization\": \"Dou itashimashite. A, sumimasen, oheya ni airon ga gozaimasen ga, furonto de kashidashi shite orimasu. Goriyou ni narimasu ka?\",\n      \"contextTranslation\": \"You're welcome. Oh, excuse me, there is no iron in the room, but we can lend you one at the front desk. Would you like to use one?\",\n      \"options\": [\n        {\n          \"feedback\": \"Yes, please. I'd like to borrow one tomorrow morning. - Great! You accepted the offer and specified when you need it.\",\n          \"isCorrect\": true,\n          \"text\": \"はい、お願いします。明日の朝、借りたいです。\",\n          \"textRomanization\": \"Hai, onegaishimasu. Ashita no asa, karitai desu.\"\n        },\n        {\n          \"feedback\": \"I want to buy an iron. - The hotel is offering to lend you one for free. There's no need to buy one!\",\n          \"isCorrect\": false,\n          \"text\": \"アイロンを買いたいです。\",\n          \"textRomanization\": \"Airon wo kaitai desu.\"\n        },\n        {\n          \"feedback\": \"Is there a TV in the room? - The clerk is asking if you want to borrow an iron. Answer their question first.\",\n          \"isCorrect\": false,\n          \"text\": \"部屋にテレビはありますか？\",\n          \"textRomanization\": \"Heya ni terebi wa arimasu ka?\"\n        },\n        {\n          \"feedback\": \"The iron is broken. - You haven't been to your room yet, so you wouldn't know this. The clerk is offering to lend you one.\",\n          \"isCorrect\": false,\n          \"text\": \"アイロンは壊れています。\",\n          \"textRomanization\": \"Airon wa kowarete imasu.\"\n        }\n      ]\n    },\n    {\n      \"context\": \"かしこまりました。明日の朝、フロントにお越しください。こちらがお部屋の鍵です。ごゆっくりどうぞ。\",\n      \"contextRomanization\": \"Kashikomarimashita. Ashita no asa, furonto ni okoshi kudasai. Kochira ga oheya no kagi desu. Goyukkuri douzo.\",\n      \"contextTranslation\": \"Understood. Please come to the front desk tomorrow morning. Here is your room key. Please take your time and relax.\",\n      \"options\": [\n        {\n          \"feedback\": \"Thank you. Good night. - Perfect ending! You thanked the clerk and wished them a good night.\",\n          \"isCorrect\": true,\n          \"text\": \"ありがとうございます。おやすみなさい。\",\n          \"textRomanization\": \"Arigatou gozaimasu. Oyasuminasai.\"\n        },\n        {\n          \"feedback\": \"The key doesn't work. - You just received the key and haven't tried it yet! Thank the clerk for their help.\",\n          \"isCorrect\": false,\n          \"text\": \"鍵が動きません。\",\n          \"textRomanization\": \"Kagi ga ugokimasen.\"\n        },\n        {\n          \"feedback\": \"One more room, please. - The check-in is complete. This is an odd time to request an additional room.\",\n          \"isCorrect\": false,\n          \"text\": \"もう一つ部屋をお願いします。\",\n          \"textRomanization\": \"Mou hitotsu heya wo onegaishimasu.\"\n        },\n        {\n          \"feedback\": \"Can I check out right now? - You just finished checking in! The clerk is handing you your key.\",\n          \"isCorrect\": false,\n          \"text\": \"チェックアウトは今すぐできますか？\",\n          \"textRomanization\": \"Chekkuauto wa imasugu dekimasu ka?\"\n        }\n      ]\n    }\n  ]\n}",
      "outputTokens": 4603,
      "systemPrompt": "# Role\n\nYou are an expert language immersion designer specializing in creating realistic, dialogue-driven scenarios that help learners practice language production in authentic contexts. You design experiences that simulate situations learners would encounter when living or traveling in a country where the target language is spoken.\n\n# Goal\n\nCreate an immersive story activity where learners are placed in an everyday situation and must choose appropriate phrases to communicate. The activity simulates real conversations with native speakers, forcing learners to engage with the target language directly rather than relying on translations.\n\nThe activity places learners in a specific scenario (ordering food, asking for directions, checking into a hotel) and guides them through a dialogue where they must select appropriate responses at each step.\n\n# Key Design Principles\n\n## Immersion Over Translation\n\nUnlike other activities where translations help comprehension, this activity intentionally withholds translations from the options. Learners see:\n\n- **Context**: What the native speaker says (in TARGET language with translation)\n- **Options**: Four possible responses (in TARGET language ONLY - no translations)\n\nThis forces learners to:\n\n1. Engage with the target language sounds and patterns\n2. Use context clues to infer meaning\n3. Build recognition before relying on translations\n4. Experience the \"productive uncertainty\" of real conversations\n\nThe translation appears only in the feedback AFTER selection, revealing whether they understood correctly.\n\n## Authentic Scenarios\n\nFocus on situations learners will actually encounter:\n\n| Category       | Example Scenarios                                  |\n| -------------- | -------------------------------------------------- |\n| Food & Dining  | Ordering at a restaurant, asking about ingredients |\n| Transportation | Buying train tickets, asking for directions        |\n| Shopping       | Bargaining at a market, returning an item          |\n| Accommodation  | Checking into a hotel, reporting a problem         |\n| Healthcare     | Describing symptoms at a pharmacy, doctor's visit  |\n| Social         | Meeting neighbors, small talk at a cafe            |\n| Services       | Opening a bank account, getting a phone plan       |\n| Emergencies    | Reporting lost items, asking for help              |\n\n## Supportive Native Speaker\n\nThe character in the story is a friendly native speaker who:\n\n- Speaks naturally but not too fast\n- Helps the learner when they struggle\n- Provides context clues in their responses\n- Never mocks mistakes\n- Gradually introduces more complex language\n\n# Language Handling\n\n## Input Variables\n\n- **TARGET_LANGUAGE**: The language being learned (from `courseTitle`). All dialogue and options are in this language.\n- **NATIVE_LANGUAGE**: The learner's native language (from `language` code). Questions, feedback, and context translations use this language.\n\n## Language Codes\n\n- `en`: US English\n- `pt`: Brazilian Portuguese\n- `es`: Latin American Spanish\n\n## What Appears in Each Language\n\n| Field                        | Language     | Example (Spanish course, English native)                  |\n| ---------------------------- | ------------ | --------------------------------------------------------- |\n| `scenario`                   | NATIVE       | \"You're at a cafe in Madrid and want to order coffee.\"    |\n| `context`                    | TARGET       | \"Buenos dias, que le pongo?\"                              |\n| `contextTranslation`         | NATIVE       | \"Good morning, what can I get you?\"                       |\n| `contextRomanization`        | Romanization | \"\" (empty for Roman scripts)                              |\n| `options[].text`             | TARGET       | \"Un cafe con leche, por favor.\"                           |\n| `options[].textRomanization` | Romanization | \"\" (empty for Roman scripts)                              |\n| `options[].feedback`         | NATIVE       | \"A coffee with milk, please - Perfect! Polite and clear.\" |\n\n# Options Design\n\n## No Translations in Options\n\nThis is the most critical design decision. Options show ONLY:\n\n- `text`: The phrase in TARGET language\n- `textRomanization`: Romanization for non-Roman scripts (empty string for Roman scripts)\n\n**NO translation is shown**. This forces the learner to:\n\n1. Parse the target language directly\n2. Use patterns they've learned\n3. Make educated guesses based on context\n4. Experience the productive struggle of real communication\n\n## Option Quality\n\nAll 4 options must be:\n\n- **Grammatically correct** in the target language\n- **Contextually plausible** (something a learner might say in this situation)\n- **Distinct in meaning** (not just word variations)\n- **Level-appropriate** (using vocabulary/structures the learner knows)\n\n## Distractor Design\n\n**CRITICAL**: Wrong options must be genuinely inappropriate for the situation - they should lead to miscommunication or confusion if used. Do NOT create distractors that are merely \"less polished\" versions of the correct answer.\n\nWrong options should be **clearly wrong** because they:\n\n1. **Answer a different question**: Respond to something the speaker didn't ask (asking about price when asked about quantity)\n2. **Request the wrong thing**: Order/ask for something different than intended (one-way ticket when you need round-trip)\n3. **Are off-topic**: Say something unrelated to the current conversation point (asking for the check when you just arrived)\n4. **Would cause confusion**: Use words that change the meaning entirely (saying \"no\" when you mean \"yes\")\n\n**DO NOT** create distractors that are:\n\n- Just more/less formal versions of the correct answer\n- Slightly different phrasings that would still work\n- Grammatically awkward but still understandable\n\n# Feedback Design\n\nFeedback appears AFTER the learner selects an option. Every feedback message MUST include:\n\n1. **Translation**: What the option actually means in the native language\n2. **Explanation**: Why this choice is correct or incorrect for the situation\n\n## Feedback Structure\n\nFor **correct** options:\n\n```\n\"[Translation of what they said] - [Why this works in context]\"\n```\n\nExample: \"A coffee with milk, please - Perfect! This is polite and clearly communicates what you want.\"\n\nFor **incorrect** options:\n\n```\n\"[Translation of what they said] - [Why this doesn't work and what would be better]\"\n```\n\nExample: \"Where is the bathroom? - You're trying to order coffee, not find the restroom. Tell the barista what you'd like to drink.\"\n\n# Romanization Requirements\n\nFor languages using non-Roman writing systems (Japanese, Chinese, Korean, Arabic, Russian, Greek, Hebrew, Thai, Hindi, etc.), provide romanization for both context and options.\n\n## Standard Systems\n\n- **Japanese**: Romaji using Hepburn romanization\n- **Chinese**: Pinyin with tone marks\n- **Korean**: Revised Romanization of Korean\n- **Russian**: ISO 9 or BGN/PCGN transliteration\n- **Arabic**: Standard romanization\n- **Greek**: Standard transliteration\n- **Thai**: Royal Thai General System\n- **Hindi**: IAST or Hunterian transliteration\n\n## Roman Scripts\n\nFor languages using Roman letters (Spanish, French, German, Portuguese, Italian, etc.), set both `contextRomanization` and `textRomanization` to empty strings `\"\"`.\n\n# Story Arc\n\nEach story should have 5-10 steps following a natural arc:\n\n## Step Progression\n\n1. **Opening** (1-2 steps): Arrive at the location, initial greeting\n2. **Building** (2-4 steps): Main interaction, making requests, clarifying\n3. **Complication** (0-2 steps): Optional challenge that adds realism\n4. **Resolution** (1-2 steps): Complete the transaction\n5. **Closing** (1 step): Thank and goodbye\n\n## Complication Ideas (Recommended)\n\nAdding a complication makes the story more realistic and teaches learners to handle unexpected situations:\n\n- **Item unavailable**: \"Sorry, we're out of that. Would you like something else?\"\n- **Misunderstanding**: \"Did you say two or twelve?\"\n- **Additional requirement**: \"I'll need to see your ID for that.\"\n- **Clarification needed**: \"Which size did you want?\"\n\n## Pacing Guidelines\n\n- Steps should feel like natural conversation beats\n- Each step presents ONE decision point\n- Context should flow naturally from the previous step\n- The native speaker's response should acknowledge what the learner said\n\n# Output Format\n\nReturn an object with this structure (abbreviated examples shown):\n\n**Non-Roman script example (Japanese):**\n\n```json\n{\n  \"scenario\": \"You're at a train station in Tokyo...\",\n  \"steps\": [\n    {\n      \"context\": \"いらっしゃいませ。どちらまで？\",\n      \"contextTranslation\": \"Welcome. Where to?\",\n      \"contextRomanization\": \"Irasshaimase. Dochira made?\",\n      \"options\": [\n        {\n          \"text\": \"京都までお願いします。\",\n          \"textRomanization\": \"Kyouto made onegaishimasu.\",\n          \"isCorrect\": true,\n          \"feedback\": \"To Kyoto, please - Perfect!\"\n        },\n        {\n          \"text\": \"京都は遠いですか？\",\n          \"textRomanization\": \"Kyouto wa tooi desu ka?\",\n          \"isCorrect\": false,\n          \"feedback\": \"Is Kyoto far? - This asks about distance, not for a ticket.\"\n        }\n      ]\n    }\n  ]\n}\n```\n\n**Roman script example (Spanish) - empty romanization fields:**\n\n```json\n{\n  \"scenario\": \"You're at a restaurant in Barcelona...\",\n  \"steps\": [\n    {\n      \"context\": \"Buenas noches. Estan listos para pedir?\",\n      \"contextTranslation\": \"Good evening. Are you ready to order?\",\n      \"contextRomanization\": \"\",\n      \"options\": [\n        {\n          \"text\": \"Si, me gustaria la paella, por favor.\",\n          \"textRomanization\": \"\",\n          \"isCorrect\": true,\n          \"feedback\": \"Yes, I would like the paella, please - Perfect!\"\n        },\n        {\n          \"text\": \"La cuenta, por favor.\",\n          \"textRomanization\": \"\",\n          \"isCorrect\": false,\n          \"feedback\": \"The check, please - You haven't eaten yet!\"\n        }\n      ]\n    }\n  ]\n}\n```\n\nNote: Examples above are abbreviated. Actual output must have 4 options per step and 5-10 steps total.\n\n# Quality Checklist\n\nBefore finalizing, verify:\n\n1. **Grammar accuracy**: All target language text is grammatically correct\n2. **Natural dialogue**: Conversations flow like real interactions\n3. **Appropriate register**: Formality matches the situation (casual cafe vs formal office)\n4. **Cultural accuracy**: Interactions reflect how things work in that culture\n5. **Clear progression**: Steps follow a logical narrative arc\n6. **Distinct options**: Each option represents a meaningfully different choice\n7. **Helpful feedback**: Translations and explanations clarify meaning and context\n8. **Correct romanization**: Follows standard systems for non-Roman scripts, empty for Roman scripts\n9. **Scenario relevance**: The story matches the lesson topic\n10. **Appropriate difficulty**: Language complexity matches learner level\n\n# Common Mistakes to Avoid\n\n1. **Including translations in options**: Options must show TARGET language only\n2. **Trivial distractors**: Options that are obviously wrong or nonsensical\n3. **Inconsistent register**: Mixing formal and informal inappropriately\n4. **Unnatural responses**: Things a native speaker would never actually say\n5. **Missing romanization**: Forgetting to add romanization for non-Roman scripts\n6. **Adding romanization to Roman scripts**: Spanish, French, etc. should have empty strings\n7. **Feedback without translation**: Always include what the option means\n8. **Disconnected steps**: Each step should follow logically from the previous one\n",
      "testCaseId": "en-japanese-hotel-checkin-1",
      "userPrompt": "TARGET_LANGUAGE: Japanese\nNATIVE_LANGUAGE: en\nCHAPTER_TITLE: Travel and Accommodation\nLESSON_TITLE: Hotel Check-in\nLESSON_DESCRIPTION: Learn to check into a hotel, confirm reservations, and ask about room amenities\n\nGenerate an immersive dialogue-driven story activity for this language lesson. Create a realistic everyday scenario where learners practice language production in situations they'd face in a foreign country."
    },
    {
      "duration": 39078.60154100001,
      "inputTokens": 3739,
      "output": "{\n  \"scenario\": \"Você está em um mercado de agricultores em Berlim em uma manhã de sábado. As barracas estão cheias de frutas e verduras frescas. Você quer comprar alguns itens para preparar o jantar.\",\n  \"steps\": [\n    {\n      \"context\": \"Guten Morgen! Kann ich Ihnen helfen?\",\n      \"contextRomanization\": \"\",\n      \"contextTranslation\": \"Bom dia! Posso ajudá-lo?\",\n      \"options\": [\n        {\n          \"feedback\": \"Bom dia! Sim, eu gostaria de comprar maçãs. - Perfeito! Você cumprimentou educadamente e disse o que quer.\",\n          \"isCorrect\": true,\n          \"text\": \"Guten Morgen! Ja, ich möchte gerne Äpfel kaufen.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Adeus! - Você acabou de chegar! Essa é uma despedida, não um começo de conversa.\",\n          \"isCorrect\": false,\n          \"text\": \"Auf Wiedersehen!\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Onde fica a estação de trem? - Você está em um mercado para fazer compras, não para pedir direções.\",\n          \"isCorrect\": false,\n          \"text\": \"Wo ist der Bahnhof?\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"A conta, por favor. - Você ainda não comprou nada! Primeiro precisa escolher os produtos.\",\n          \"isCorrect\": false,\n          \"text\": \"Die Rechnung, bitte.\",\n          \"textRomanization\": \"\"\n        }\n      ]\n    },\n    {\n      \"context\": \"Sehr gut! Die Äpfel sind heute sehr frisch. Wie viele möchten Sie?\",\n      \"contextRomanization\": \"\",\n      \"contextTranslation\": \"Muito bem! As maçãs estão muito frescas hoje. Quantas você gostaria?\",\n      \"options\": [\n        {\n          \"feedback\": \"Eu levo seis maçãs, por favor. - Ótimo! Você respondeu a pergunta claramente e foi educado.\",\n          \"isCorrect\": true,\n          \"text\": \"Ich nehme sechs Äpfel, bitte.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"As maçãs são vermelhas. - O vendedor perguntou quantas você quer, não a cor delas.\",\n          \"isCorrect\": false,\n          \"text\": \"Die Äpfel sind rot.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Você tem pão? - O vendedor perguntou sobre as maçãs. Responda primeiro antes de perguntar por outros itens.\",\n          \"isCorrect\": false,\n          \"text\": \"Haben Sie Brot?\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Eu não gosto de maçãs. - Mas você acabou de pedir maçãs! Isso seria muito confuso para o vendedor.\",\n          \"isCorrect\": false,\n          \"text\": \"Ich mag keine Äpfel.\",\n          \"textRomanization\": \"\"\n        }\n      ]\n    },\n    {\n      \"context\": \"Sechs Äpfel, alles klar. Brauchen Sie noch etwas?\",\n      \"contextRomanization\": \"\",\n      \"contextTranslation\": \"Seis maçãs, tudo certo. Você precisa de mais alguma coisa?\",\n      \"options\": [\n        {\n          \"feedback\": \"Sim, eu também preciso de tomates e batatas. - Perfeito! Você está aproveitando para comprar mais itens.\",\n          \"isCorrect\": true,\n          \"text\": \"Ja, ich brauche auch Tomaten und Kartoffeln.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Eu estou cansado. - Isso não responde à pergunta do vendedor sobre outros produtos.\",\n          \"isCorrect\": false,\n          \"text\": \"Ich bin müde.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Está chovendo hoje. - O vendedor perguntou se você precisa de mais alguma coisa, não sobre o clima.\",\n          \"isCorrect\": false,\n          \"text\": \"Es regnet heute.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Onde posso estacionar? - Essa pergunta não tem relação com as compras que você está fazendo.\",\n          \"isCorrect\": false,\n          \"text\": \"Wo kann ich parken?\",\n          \"textRomanization\": \"\"\n        }\n      ]\n    },\n    {\n      \"context\": \"Tomaten habe ich hier, aber die Kartoffeln sind leider aus. Möchten Sie stattdessen Zwiebeln?\",\n      \"contextRomanization\": \"\",\n      \"contextTranslation\": \"Tomates eu tenho aqui, mas as batatas infelizmente acabaram. Você gostaria de cebolas no lugar?\",\n      \"options\": [\n        {\n          \"feedback\": \"Sim, cebolas também são boas. Eu levo um quilo. - Excelente! Você lidou bem com a situação inesperada.\",\n          \"isCorrect\": true,\n          \"text\": \"Ja, Zwiebeln sind auch gut. Ich nehme ein Kilo.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Eu quero batatas. - O vendedor acabou de dizer que as batatas acabaram. Você precisa aceitar ou recusar a alternativa.\",\n          \"isCorrect\": false,\n          \"text\": \"Ich möchte Kartoffeln.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Que horas são? - O vendedor está esperando uma resposta sobre as cebolas, não sobre as horas.\",\n          \"isCorrect\": false,\n          \"text\": \"Wie spät ist es?\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Eu não falo alemão. - Mas você está se comunicando muito bem! Isso não ajuda a resolver a questão das cebolas.\",\n          \"isCorrect\": false,\n          \"text\": \"Ich spreche kein Deutsch.\",\n          \"textRomanization\": \"\"\n        }\n      ]\n    },\n    {\n      \"context\": \"Sehr gut! Wie viele Tomaten brauchen Sie?\",\n      \"contextRomanization\": \"\",\n      \"contextTranslation\": \"Muito bem! Quantos tomates você precisa?\",\n      \"options\": [\n        {\n          \"feedback\": \"Meio quilo, por favor. - Perfeito! Você especificou a quantidade de forma clara.\",\n          \"isCorrect\": true,\n          \"text\": \"Ein halbes Kilo, bitte.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Os tomates são caros. - O vendedor perguntou quantos você quer, não sua opinião sobre o preço.\",\n          \"isCorrect\": false,\n          \"text\": \"Die Tomaten sind teuer.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Eu gosto de sopa de tomate. - Interessante, mas não responde quantos tomates você quer comprar.\",\n          \"isCorrect\": false,\n          \"text\": \"Ich mag Tomatensuppe.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Os tomates são da Espanha. - O vendedor perguntou sobre a quantidade, não sobre a origem dos tomates.\",\n          \"isCorrect\": false,\n          \"text\": \"Die Tomaten sind aus Spanien.\",\n          \"textRomanization\": \"\"\n        }\n      ]\n    },\n    {\n      \"context\": \"Alles klar. Sonst noch etwas?\",\n      \"contextRomanization\": \"\",\n      \"contextTranslation\": \"Tudo certo. Mais alguma coisa?\",\n      \"options\": [\n        {\n          \"feedback\": \"Não, obrigado. É só isso. - Ótimo! Você indicou claramente que terminou suas compras.\",\n          \"isCorrect\": true,\n          \"text\": \"Nein, danke. Das ist alles.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Eu tenho um cachorro. - Isso não tem nada a ver com suas compras no mercado.\",\n          \"isCorrect\": false,\n          \"text\": \"Ich habe einen Hund.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Amanhã é segunda-feira. - O vendedor quer saber se você precisa de mais produtos, não que dia é amanhã.\",\n          \"isCorrect\": false,\n          \"text\": \"Morgen ist Montag.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"O tempo está bonito. - O vendedor está perguntando sobre suas compras, não sobre o clima.\",\n          \"isCorrect\": false,\n          \"text\": \"Das Wetter ist schön.\",\n          \"textRomanization\": \"\"\n        }\n      ]\n    },\n    {\n      \"context\": \"Das macht zusammen acht Euro fünfzig.\",\n      \"contextRomanization\": \"\",\n      \"contextTranslation\": \"O total é oito euros e cinquenta centavos.\",\n      \"options\": [\n        {\n          \"feedback\": \"Aqui estão dez euros. - Perfeito! Você está pagando com uma nota maior e receberá troco.\",\n          \"isCorrect\": true,\n          \"text\": \"Hier sind zehn Euro.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Eu não tenho dinheiro. - Isso seria muito constrangedor! Você deveria ter verificado antes de comprar.\",\n          \"isCorrect\": false,\n          \"text\": \"Ich habe kein Geld.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Isso é muito barato. - Normalmente clientes não reclamam que algo é barato demais. Apenas pague.\",\n          \"isCorrect\": false,\n          \"text\": \"Das ist zu billig.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Eu não entendo. - O vendedor disse o preço claramente. Se não entendeu, pode pedir para repetir de outra forma.\",\n          \"isCorrect\": false,\n          \"text\": \"Ich verstehe nicht.\",\n          \"textRomanization\": \"\"\n        }\n      ]\n    },\n    {\n      \"context\": \"Zehn Euro, danke. Hier ist Ihr Wechselgeld: ein Euro fünfzig.\",\n      \"contextRomanization\": \"\",\n      \"contextTranslation\": \"Dez euros, obrigado. Aqui está seu troco: um euro e cinquenta.\",\n      \"options\": [\n        {\n          \"feedback\": \"Muito obrigado! Adeus! - Excelente! Você encerrou a conversa de forma educada e amigável.\",\n          \"isCorrect\": true,\n          \"text\": \"Vielen Dank! Auf Wiedersehen!\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Eu gostaria de comprar mais. - Mas você acabou de dizer que era tudo! Isso confundiria o vendedor.\",\n          \"isCorrect\": false,\n          \"text\": \"Ich möchte mehr kaufen.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"O troco está errado. - Na verdade, 10 - 8,50 = 1,50. O troco está correto!\",\n          \"isCorrect\": false,\n          \"text\": \"Das Wechselgeld ist falsch.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Onde ficam os banheiros? - A transação está completa. É hora de agradecer e se despedir.\",\n          \"isCorrect\": false,\n          \"text\": \"Wo sind die Toiletten?\",\n          \"textRomanization\": \"\"\n        }\n      ]\n    }\n  ]\n}",
      "outputTokens": 3208,
      "systemPrompt": "# Role\n\nYou are an expert language immersion designer specializing in creating realistic, dialogue-driven scenarios that help learners practice language production in authentic contexts. You design experiences that simulate situations learners would encounter when living or traveling in a country where the target language is spoken.\n\n# Goal\n\nCreate an immersive story activity where learners are placed in an everyday situation and must choose appropriate phrases to communicate. The activity simulates real conversations with native speakers, forcing learners to engage with the target language directly rather than relying on translations.\n\nThe activity places learners in a specific scenario (ordering food, asking for directions, checking into a hotel) and guides them through a dialogue where they must select appropriate responses at each step.\n\n# Key Design Principles\n\n## Immersion Over Translation\n\nUnlike other activities where translations help comprehension, this activity intentionally withholds translations from the options. Learners see:\n\n- **Context**: What the native speaker says (in TARGET language with translation)\n- **Options**: Four possible responses (in TARGET language ONLY - no translations)\n\nThis forces learners to:\n\n1. Engage with the target language sounds and patterns\n2. Use context clues to infer meaning\n3. Build recognition before relying on translations\n4. Experience the \"productive uncertainty\" of real conversations\n\nThe translation appears only in the feedback AFTER selection, revealing whether they understood correctly.\n\n## Authentic Scenarios\n\nFocus on situations learners will actually encounter:\n\n| Category       | Example Scenarios                                  |\n| -------------- | -------------------------------------------------- |\n| Food & Dining  | Ordering at a restaurant, asking about ingredients |\n| Transportation | Buying train tickets, asking for directions        |\n| Shopping       | Bargaining at a market, returning an item          |\n| Accommodation  | Checking into a hotel, reporting a problem         |\n| Healthcare     | Describing symptoms at a pharmacy, doctor's visit  |\n| Social         | Meeting neighbors, small talk at a cafe            |\n| Services       | Opening a bank account, getting a phone plan       |\n| Emergencies    | Reporting lost items, asking for help              |\n\n## Supportive Native Speaker\n\nThe character in the story is a friendly native speaker who:\n\n- Speaks naturally but not too fast\n- Helps the learner when they struggle\n- Provides context clues in their responses\n- Never mocks mistakes\n- Gradually introduces more complex language\n\n# Language Handling\n\n## Input Variables\n\n- **TARGET_LANGUAGE**: The language being learned (from `courseTitle`). All dialogue and options are in this language.\n- **NATIVE_LANGUAGE**: The learner's native language (from `language` code). Questions, feedback, and context translations use this language.\n\n## Language Codes\n\n- `en`: US English\n- `pt`: Brazilian Portuguese\n- `es`: Latin American Spanish\n\n## What Appears in Each Language\n\n| Field                        | Language     | Example (Spanish course, English native)                  |\n| ---------------------------- | ------------ | --------------------------------------------------------- |\n| `scenario`                   | NATIVE       | \"You're at a cafe in Madrid and want to order coffee.\"    |\n| `context`                    | TARGET       | \"Buenos dias, que le pongo?\"                              |\n| `contextTranslation`         | NATIVE       | \"Good morning, what can I get you?\"                       |\n| `contextRomanization`        | Romanization | \"\" (empty for Roman scripts)                              |\n| `options[].text`             | TARGET       | \"Un cafe con leche, por favor.\"                           |\n| `options[].textRomanization` | Romanization | \"\" (empty for Roman scripts)                              |\n| `options[].feedback`         | NATIVE       | \"A coffee with milk, please - Perfect! Polite and clear.\" |\n\n# Options Design\n\n## No Translations in Options\n\nThis is the most critical design decision. Options show ONLY:\n\n- `text`: The phrase in TARGET language\n- `textRomanization`: Romanization for non-Roman scripts (empty string for Roman scripts)\n\n**NO translation is shown**. This forces the learner to:\n\n1. Parse the target language directly\n2. Use patterns they've learned\n3. Make educated guesses based on context\n4. Experience the productive struggle of real communication\n\n## Option Quality\n\nAll 4 options must be:\n\n- **Grammatically correct** in the target language\n- **Contextually plausible** (something a learner might say in this situation)\n- **Distinct in meaning** (not just word variations)\n- **Level-appropriate** (using vocabulary/structures the learner knows)\n\n## Distractor Design\n\n**CRITICAL**: Wrong options must be genuinely inappropriate for the situation - they should lead to miscommunication or confusion if used. Do NOT create distractors that are merely \"less polished\" versions of the correct answer.\n\nWrong options should be **clearly wrong** because they:\n\n1. **Answer a different question**: Respond to something the speaker didn't ask (asking about price when asked about quantity)\n2. **Request the wrong thing**: Order/ask for something different than intended (one-way ticket when you need round-trip)\n3. **Are off-topic**: Say something unrelated to the current conversation point (asking for the check when you just arrived)\n4. **Would cause confusion**: Use words that change the meaning entirely (saying \"no\" when you mean \"yes\")\n\n**DO NOT** create distractors that are:\n\n- Just more/less formal versions of the correct answer\n- Slightly different phrasings that would still work\n- Grammatically awkward but still understandable\n\n# Feedback Design\n\nFeedback appears AFTER the learner selects an option. Every feedback message MUST include:\n\n1. **Translation**: What the option actually means in the native language\n2. **Explanation**: Why this choice is correct or incorrect for the situation\n\n## Feedback Structure\n\nFor **correct** options:\n\n```\n\"[Translation of what they said] - [Why this works in context]\"\n```\n\nExample: \"A coffee with milk, please - Perfect! This is polite and clearly communicates what you want.\"\n\nFor **incorrect** options:\n\n```\n\"[Translation of what they said] - [Why this doesn't work and what would be better]\"\n```\n\nExample: \"Where is the bathroom? - You're trying to order coffee, not find the restroom. Tell the barista what you'd like to drink.\"\n\n# Romanization Requirements\n\nFor languages using non-Roman writing systems (Japanese, Chinese, Korean, Arabic, Russian, Greek, Hebrew, Thai, Hindi, etc.), provide romanization for both context and options.\n\n## Standard Systems\n\n- **Japanese**: Romaji using Hepburn romanization\n- **Chinese**: Pinyin with tone marks\n- **Korean**: Revised Romanization of Korean\n- **Russian**: ISO 9 or BGN/PCGN transliteration\n- **Arabic**: Standard romanization\n- **Greek**: Standard transliteration\n- **Thai**: Royal Thai General System\n- **Hindi**: IAST or Hunterian transliteration\n\n## Roman Scripts\n\nFor languages using Roman letters (Spanish, French, German, Portuguese, Italian, etc.), set both `contextRomanization` and `textRomanization` to empty strings `\"\"`.\n\n# Story Arc\n\nEach story should have 5-10 steps following a natural arc:\n\n## Step Progression\n\n1. **Opening** (1-2 steps): Arrive at the location, initial greeting\n2. **Building** (2-4 steps): Main interaction, making requests, clarifying\n3. **Complication** (0-2 steps): Optional challenge that adds realism\n4. **Resolution** (1-2 steps): Complete the transaction\n5. **Closing** (1 step): Thank and goodbye\n\n## Complication Ideas (Recommended)\n\nAdding a complication makes the story more realistic and teaches learners to handle unexpected situations:\n\n- **Item unavailable**: \"Sorry, we're out of that. Would you like something else?\"\n- **Misunderstanding**: \"Did you say two or twelve?\"\n- **Additional requirement**: \"I'll need to see your ID for that.\"\n- **Clarification needed**: \"Which size did you want?\"\n\n## Pacing Guidelines\n\n- Steps should feel like natural conversation beats\n- Each step presents ONE decision point\n- Context should flow naturally from the previous step\n- The native speaker's response should acknowledge what the learner said\n\n# Output Format\n\nReturn an object with this structure (abbreviated examples shown):\n\n**Non-Roman script example (Japanese):**\n\n```json\n{\n  \"scenario\": \"You're at a train station in Tokyo...\",\n  \"steps\": [\n    {\n      \"context\": \"いらっしゃいませ。どちらまで？\",\n      \"contextTranslation\": \"Welcome. Where to?\",\n      \"contextRomanization\": \"Irasshaimase. Dochira made?\",\n      \"options\": [\n        {\n          \"text\": \"京都までお願いします。\",\n          \"textRomanization\": \"Kyouto made onegaishimasu.\",\n          \"isCorrect\": true,\n          \"feedback\": \"To Kyoto, please - Perfect!\"\n        },\n        {\n          \"text\": \"京都は遠いですか？\",\n          \"textRomanization\": \"Kyouto wa tooi desu ka?\",\n          \"isCorrect\": false,\n          \"feedback\": \"Is Kyoto far? - This asks about distance, not for a ticket.\"\n        }\n      ]\n    }\n  ]\n}\n```\n\n**Roman script example (Spanish) - empty romanization fields:**\n\n```json\n{\n  \"scenario\": \"You're at a restaurant in Barcelona...\",\n  \"steps\": [\n    {\n      \"context\": \"Buenas noches. Estan listos para pedir?\",\n      \"contextTranslation\": \"Good evening. Are you ready to order?\",\n      \"contextRomanization\": \"\",\n      \"options\": [\n        {\n          \"text\": \"Si, me gustaria la paella, por favor.\",\n          \"textRomanization\": \"\",\n          \"isCorrect\": true,\n          \"feedback\": \"Yes, I would like the paella, please - Perfect!\"\n        },\n        {\n          \"text\": \"La cuenta, por favor.\",\n          \"textRomanization\": \"\",\n          \"isCorrect\": false,\n          \"feedback\": \"The check, please - You haven't eaten yet!\"\n        }\n      ]\n    }\n  ]\n}\n```\n\nNote: Examples above are abbreviated. Actual output must have 4 options per step and 5-10 steps total.\n\n# Quality Checklist\n\nBefore finalizing, verify:\n\n1. **Grammar accuracy**: All target language text is grammatically correct\n2. **Natural dialogue**: Conversations flow like real interactions\n3. **Appropriate register**: Formality matches the situation (casual cafe vs formal office)\n4. **Cultural accuracy**: Interactions reflect how things work in that culture\n5. **Clear progression**: Steps follow a logical narrative arc\n6. **Distinct options**: Each option represents a meaningfully different choice\n7. **Helpful feedback**: Translations and explanations clarify meaning and context\n8. **Correct romanization**: Follows standard systems for non-Roman scripts, empty for Roman scripts\n9. **Scenario relevance**: The story matches the lesson topic\n10. **Appropriate difficulty**: Language complexity matches learner level\n\n# Common Mistakes to Avoid\n\n1. **Including translations in options**: Options must show TARGET language only\n2. **Trivial distractors**: Options that are obviously wrong or nonsensical\n3. **Inconsistent register**: Mixing formal and informal inappropriately\n4. **Unnatural responses**: Things a native speaker would never actually say\n5. **Missing romanization**: Forgetting to add romanization for non-Roman scripts\n6. **Adding romanization to Roman scripts**: Spanish, French, etc. should have empty strings\n7. **Feedback without translation**: Always include what the option means\n8. **Disconnected steps**: Each step should follow logically from the previous one\n",
      "testCaseId": "pt-german-market-shopping-1",
      "userPrompt": "TARGET_LANGUAGE: German\nNATIVE_LANGUAGE: pt\nCHAPTER_TITLE: Fazendo Compras\nLESSON_TITLE: No Mercado\nLESSON_DESCRIPTION: Aprenda a comprar frutas, verduras e outros itens em um mercado alemao\n\nGenerate an immersive dialogue-driven story activity for this language lesson. Create a realistic everyday scenario where learners practice language production in situations they'd face in a foreign country."
    },
    {
      "duration": 58433.88529100001,
      "inputTokens": 3737,
      "output": "{\n  \"scenario\": \"Estás en el centro de Seúl y necesitas encontrar la estación de metro más cercana. Te acercas a una persona amable en la calle para pedir direcciones.\",\n  \"steps\": [\n    {\n      \"context\": \"안녕하세요! 도와드릴까요?\",\n      \"contextRomanization\": \"Annyeonghaseyo! Dowadeurilkkayo?\",\n      \"contextTranslation\": \"¡Hola! ¿Puedo ayudarle?\",\n      \"options\": [\n        {\n          \"feedback\": \"Sí, ¿dónde está la estación de metro? - ¡Perfecto! Esta es una forma educada y clara de pedir direcciones.\",\n          \"isCorrect\": true,\n          \"text\": \"네, 지하철역이 어디에 있어요?\",\n          \"textRomanization\": \"Ne, jihacheol-yeogi eodie isseoyo?\"\n        },\n        {\n          \"feedback\": \"¿A qué hora abre la estación de metro? - Estás preguntando por el horario, no por la ubicación de la estación.\",\n          \"isCorrect\": false,\n          \"text\": \"지하철역은 몇 시에 열어요?\",\n          \"textRomanization\": \"Jihacheol-yeogeun myeot sie yeoreoyo?\"\n        },\n        {\n          \"feedback\": \"¿Cuánto cuesta el boleto de metro? - Necesitas encontrar la estación primero antes de preguntar por los precios.\",\n          \"isCorrect\": false,\n          \"text\": \"지하철 표가 얼마예요?\",\n          \"textRomanization\": \"Jihacheol pyoga eolmayeyo?\"\n        },\n        {\n          \"feedback\": \"No, estoy bien. - ¡Pero necesitas ayuda para encontrar la estación de metro!\",\n          \"isCorrect\": false,\n          \"text\": \"아니요, 괜찮아요.\",\n          \"textRomanization\": \"Aniyo, gwaenchanayo.\"\n        }\n      ]\n    },\n    {\n      \"context\": \"지하철역요? 여기서 가까워요. 직진하세요.\",\n      \"contextRomanization\": \"Jihacheol-yeogyo? Yeogiseo gakkawayo. Jikjinhaseyo.\",\n      \"contextTranslation\": \"¿La estación de metro? Está cerca de aquí. Vaya recto.\",\n      \"options\": [\n        {\n          \"feedback\": \"Sí, entendido. ¿Y después? - ¡Excelente! Estás pidiendo más indicaciones de manera natural.\",\n          \"isCorrect\": true,\n          \"text\": \"네, 알겠어요. 그 다음에요?\",\n          \"textRomanization\": \"Ne, algesseoyo. Geu daeume-yo?\"\n        },\n        {\n          \"feedback\": \"Gracias. Adiós. - Te estás despidiendo, pero aún no sabes todas las indicaciones para llegar.\",\n          \"isCorrect\": false,\n          \"text\": \"감사합니다. 안녕히 계세요.\",\n          \"textRomanization\": \"Gamsahamnida. Annyeonghi gyeseyo.\"\n        },\n        {\n          \"feedback\": \"¿Dónde está la parada de autobús? - Estabas preguntando por el metro, no por el autobús.\",\n          \"isCorrect\": false,\n          \"text\": \"버스 정류장이 어디에 있어요?\",\n          \"textRomanization\": \"Beoseu jeongnyujangi eodie isseoyo?\"\n        },\n        {\n          \"feedback\": \"¿Cuánto tiempo toma? - Esta pregunta es útil, pero primero necesitas saber todas las direcciones.\",\n          \"isCorrect\": false,\n          \"text\": \"얼마나 걸려요?\",\n          \"textRomanization\": \"Eolmana geollyeoyo?\"\n        }\n      ]\n    },\n    {\n      \"context\": \"첫 번째 사거리에서 오른쪽으로 도세요.\",\n      \"contextRomanization\": \"Cheot beonjjae sageorieseo oreunjjogeuro doseyo.\",\n      \"contextTranslation\": \"En el primer cruce, gire a la derecha.\",\n      \"options\": [\n        {\n          \"feedback\": \"¿A la derecha? Entendido. - ¡Muy bien! Repetir la información clave ayuda a confirmar que entendiste.\",\n          \"isCorrect\": true,\n          \"text\": \"오른쪽이요? 알겠습니다.\",\n          \"textRomanization\": \"Oreunjjogyo? Algesseumnida.\"\n        },\n        {\n          \"feedback\": \"¿Tengo que ir a la izquierda? - No, te dijeron que fueras a la derecha, no a la izquierda.\",\n          \"isCorrect\": false,\n          \"text\": \"왼쪽으로 가면 돼요?\",\n          \"textRomanization\": \"Oenjjogeuro gamyeon dwaeyo?\"\n        },\n        {\n          \"feedback\": \"¿Qué es un cruce? - Esta pregunta es válida si no conoces la palabra, pero no confirma las direcciones.\",\n          \"isCorrect\": false,\n          \"text\": \"사거리가 뭐예요?\",\n          \"textRomanization\": \"Sageoriga mwoyeyo?\"\n        },\n        {\n          \"feedback\": \"¿El segundo cruce? - No, te dijeron el primer cruce, no el segundo.\",\n          \"isCorrect\": false,\n          \"text\": \"두 번째 사거리요?\",\n          \"textRomanization\": \"Du beonjjae sageoriyo?\"\n        }\n      ]\n    },\n    {\n      \"context\": \"네, 맞아요. 그러면 왼쪽에 지하철역이 보여요.\",\n      \"contextRomanization\": \"Ne, majayo. Geureomyeon oenjjoge jihacheol-yeogi boyeoyo.\",\n      \"contextTranslation\": \"Sí, correcto. Entonces verá la estación de metro a la izquierda.\",\n      \"options\": [\n        {\n          \"feedback\": \"¿A la izquierda? ¡Gracias! - ¡Perfecto! Confirmaste la dirección y agradeciste.\",\n          \"isCorrect\": true,\n          \"text\": \"왼쪽에요? 감사합니다!\",\n          \"textRomanization\": \"Oenjjogeyo? Gamsahamnida!\"\n        },\n        {\n          \"feedback\": \"¿Está a la derecha? - No, te dijeron que está a la izquierda, no a la derecha.\",\n          \"isCorrect\": false,\n          \"text\": \"오른쪽에 있어요?\",\n          \"textRomanization\": \"Oreunjjoge isseoyo?\"\n        },\n        {\n          \"feedback\": \"¿No hay estación de metro? - Te acaban de decir dónde está la estación.\",\n          \"isCorrect\": false,\n          \"text\": \"지하철역이 없어요?\",\n          \"textRomanization\": \"Jihacheol-yeogi eopseoyo?\"\n        },\n        {\n          \"feedback\": \"Por favor, repita una vez más. - Esta frase es útil, pero ya entendiste las direcciones.\",\n          \"isCorrect\": false,\n          \"text\": \"다시 한번 말씀해 주세요.\",\n          \"textRomanization\": \"Dasi hanbeon malsseum-hae juseyo.\"\n        }\n      ]\n    },\n    {\n      \"context\": \"천만에요! 아, 잠깐만요. 지금 공사 중이에요.\",\n      \"contextRomanization\": \"Cheonmaneyo! A, jamkkanmanyo. Jigeum gongsa jungieyo.\",\n      \"contextTranslation\": \"¡De nada! Ah, espere un momento. Ahora hay construcción.\",\n      \"options\": [\n        {\n          \"feedback\": \"¿Ah, sí? ¿Hay otro camino? - ¡Excelente! Estás manejando bien esta complicación inesperada.\",\n          \"isCorrect\": true,\n          \"text\": \"아, 그래요? 다른 길이 있어요?\",\n          \"textRomanization\": \"A, geuraeyo? Dareun giri isseoyo?\"\n        },\n        {\n          \"feedback\": \"¿Cuándo termina la construcción? - Esta información no te ayuda a llegar ahora.\",\n          \"isCorrect\": false,\n          \"text\": \"공사가 언제 끝나요?\",\n          \"textRomanization\": \"Gongsaga eonje kkeutnayo?\"\n        },\n        {\n          \"feedback\": \"Está bien, iré de todos modos. - Podría haber un camino bloqueado, mejor pedir alternativas.\",\n          \"isCorrect\": false,\n          \"text\": \"괜찮아요, 그냥 갈게요.\",\n          \"textRomanization\": \"Gwaenchanayo, geunyang galgeyo.\"\n        },\n        {\n          \"feedback\": \"¿Qué es construcción? - Aunque preguntar vocabulario es válido, necesitas resolver cómo llegar primero.\",\n          \"isCorrect\": false,\n          \"text\": \"공사가 뭐예요?\",\n          \"textRomanization\": \"Gongsaga mwoyeyo?\"\n        }\n      ]\n    },\n    {\n      \"context\": \"네, 있어요. 두 번째 사거리에서 왼쪽으로 가세요. 조금 더 멀지만 갈 수 있어요.\",\n      \"contextRomanization\": \"Ne, isseoyo. Du beonjjae sageorieseo oenjjogeuro gaseyo. Jogeum deo meoljiman gal su isseoyo.\",\n      \"contextTranslation\": \"Sí, hay uno. En el segundo cruce, vaya a la izquierda. Es un poco más lejos, pero puede llegar.\",\n      \"options\": [\n        {\n          \"feedback\": \"A la izquierda en el segundo cruce. Entendido. - ¡Muy bien! Repetiste la información para confirmar.\",\n          \"isCorrect\": true,\n          \"text\": \"두 번째 사거리에서 왼쪽이요. 알겠어요.\",\n          \"textRomanization\": \"Du beonjjae sageorieseo oenjjogyo. Algesseoyo.\"\n        },\n        {\n          \"feedback\": \"¿A la derecha en el primer cruce? - No, te dijeron el segundo cruce y a la izquierda.\",\n          \"isCorrect\": false,\n          \"text\": \"첫 번째 사거리에서 오른쪽이요?\",\n          \"textRomanization\": \"Cheot beonjjae sageorieseo oreunjjogyo?\"\n        },\n        {\n          \"feedback\": \"¿Tengo que tomar un taxi? - No es necesario, puedes caminar un poco más.\",\n          \"isCorrect\": false,\n          \"text\": \"택시를 타야 해요?\",\n          \"textRomanization\": \"Taeksireul taya haeyo?\"\n        },\n        {\n          \"feedback\": \"¿Puedo ir en autobús? - Te están dando direcciones para caminar hasta el metro.\",\n          \"isCorrect\": false,\n          \"text\": \"버스로 갈 수 있어요?\",\n          \"textRomanization\": \"Beoseuro gal su isseoyo?\"\n        }\n      ]\n    },\n    {\n      \"context\": \"네, 맞아요. 5분 정도 걸려요.\",\n      \"contextRomanization\": \"Ne, majayo. O-bun jeongdo geollyeoyo.\",\n      \"contextTranslation\": \"Sí, correcto. Toma unos 5 minutos.\",\n      \"options\": [\n        {\n          \"feedback\": \"¿5 minutos? ¡Está cerca! Gracias. - ¡Perfecto! Mostraste entusiasmo y agradecimiento.\",\n          \"isCorrect\": true,\n          \"text\": \"5분이요? 가까워요! 감사합니다.\",\n          \"textRomanization\": \"O-bunyo? Gakkawayo! Gamsahamnida.\"\n        },\n        {\n          \"feedback\": \"Está muy lejos. Quiero tomar un taxi. - ¡5 minutos caminando no es lejos!\",\n          \"isCorrect\": false,\n          \"text\": \"너무 멀어요. 택시 타고 싶어요.\",\n          \"textRomanization\": \"Neomu meoreoyo. Taeksi tago sipeoyo.\"\n        },\n        {\n          \"feedback\": \"¿Cuántas horas? - Te dijeron minutos, no horas. Son solo 5 minutos.\",\n          \"isCorrect\": false,\n          \"text\": \"몇 시간이요?\",\n          \"textRomanization\": \"Myeot siganyo?\"\n        },\n        {\n          \"feedback\": \"¿10 minutos? - No, te dijeron 5 minutos, no 10.\",\n          \"isCorrect\": false,\n          \"text\": \"10분이요?\",\n          \"textRomanization\": \"Sip-bunyo?\"\n        }\n      ]\n    },\n    {\n      \"context\": \"네, 가까워요! 천천히 가세요. 길 찾기 쉬워요.\",\n      \"contextRomanization\": \"Ne, gakkawayo! Cheoncheonhi gaseyo. Gil chatgi swiweoyo.\",\n      \"contextTranslation\": \"¡Sí, está cerca! Vaya despacio. Es fácil encontrar el camino.\",\n      \"options\": [\n        {\n          \"feedback\": \"Sí, iré despacio. ¡Muchas gracias! - ¡Excelente! Respondiste de manera natural y educada.\",\n          \"isCorrect\": true,\n          \"text\": \"네, 천천히 갈게요. 정말 감사합니다!\",\n          \"textRomanization\": \"Ne, cheoncheonhi galgeyo. Jeongmal gamsahamnida!\"\n        },\n        {\n          \"feedback\": \"Tengo que ir rápido. - La persona te sugirió ir despacio para no perderte.\",\n          \"isCorrect\": false,\n          \"text\": \"빨리 가야 해요.\",\n          \"textRomanization\": \"Ppalli gaya haeyo.\"\n        },\n        {\n          \"feedback\": \"Estoy perdido. - Aún no has empezado a caminar, no puedes estar perdido todavía.\",\n          \"isCorrect\": false,\n          \"text\": \"길을 잃었어요.\",\n          \"textRomanization\": \"Gireul ireosseoyo.\"\n        },\n        {\n          \"feedback\": \"¿Es difícil? - Te acaban de decir que es fácil encontrar el camino.\",\n          \"isCorrect\": false,\n          \"text\": \"어려워요?\",\n          \"textRomanization\": \"Eoryeoweoyo?\"\n        }\n      ]\n    },\n    {\n      \"context\": \"천만에요! 좋은 하루 되세요!\",\n      \"contextRomanization\": \"Cheonmaneyo! Joeun haru doeseyo!\",\n      \"contextTranslation\": \"¡De nada! ¡Que tenga un buen día!\",\n      \"options\": [\n        {\n          \"feedback\": \"¡Sí, que tenga un buen día! ¡Adiós! - ¡Perfecto! Te despediste de manera educada y natural.\",\n          \"isCorrect\": true,\n          \"text\": \"네, 좋은 하루 되세요! 안녕히 계세요!\",\n          \"textRomanization\": \"Ne, joeun haru doeseyo! Annyeonghi gyeseyo!\"\n        },\n        {\n          \"feedback\": \"Nos vemos de nuevo. - Esta despedida es para personas que planeas ver otra vez.\",\n          \"isCorrect\": false,\n          \"text\": \"다시 만나요.\",\n          \"textRomanization\": \"Dasi mannayo.\"\n        },\n        {\n          \"feedback\": \"Un momento, tengo una pregunta. - La conversación ya terminó y tienes todas las direcciones.\",\n          \"isCorrect\": false,\n          \"text\": \"잠깐만요, 질문 있어요.\",\n          \"textRomanization\": \"Jamkkanmanyo, jilmun isseoyo.\"\n        },\n        {\n          \"feedback\": \"Sí, entendido. - Esta respuesta es un poco fría. Es mejor corresponder el deseo de buen día.\",\n          \"isCorrect\": false,\n          \"text\": \"네, 알겠어요.\",\n          \"textRomanization\": \"Ne, algesseoyo.\"\n        }\n      ]\n    }\n  ]\n}",
      "outputTokens": 4525,
      "systemPrompt": "# Role\n\nYou are an expert language immersion designer specializing in creating realistic, dialogue-driven scenarios that help learners practice language production in authentic contexts. You design experiences that simulate situations learners would encounter when living or traveling in a country where the target language is spoken.\n\n# Goal\n\nCreate an immersive story activity where learners are placed in an everyday situation and must choose appropriate phrases to communicate. The activity simulates real conversations with native speakers, forcing learners to engage with the target language directly rather than relying on translations.\n\nThe activity places learners in a specific scenario (ordering food, asking for directions, checking into a hotel) and guides them through a dialogue where they must select appropriate responses at each step.\n\n# Key Design Principles\n\n## Immersion Over Translation\n\nUnlike other activities where translations help comprehension, this activity intentionally withholds translations from the options. Learners see:\n\n- **Context**: What the native speaker says (in TARGET language with translation)\n- **Options**: Four possible responses (in TARGET language ONLY - no translations)\n\nThis forces learners to:\n\n1. Engage with the target language sounds and patterns\n2. Use context clues to infer meaning\n3. Build recognition before relying on translations\n4. Experience the \"productive uncertainty\" of real conversations\n\nThe translation appears only in the feedback AFTER selection, revealing whether they understood correctly.\n\n## Authentic Scenarios\n\nFocus on situations learners will actually encounter:\n\n| Category       | Example Scenarios                                  |\n| -------------- | -------------------------------------------------- |\n| Food & Dining  | Ordering at a restaurant, asking about ingredients |\n| Transportation | Buying train tickets, asking for directions        |\n| Shopping       | Bargaining at a market, returning an item          |\n| Accommodation  | Checking into a hotel, reporting a problem         |\n| Healthcare     | Describing symptoms at a pharmacy, doctor's visit  |\n| Social         | Meeting neighbors, small talk at a cafe            |\n| Services       | Opening a bank account, getting a phone plan       |\n| Emergencies    | Reporting lost items, asking for help              |\n\n## Supportive Native Speaker\n\nThe character in the story is a friendly native speaker who:\n\n- Speaks naturally but not too fast\n- Helps the learner when they struggle\n- Provides context clues in their responses\n- Never mocks mistakes\n- Gradually introduces more complex language\n\n# Language Handling\n\n## Input Variables\n\n- **TARGET_LANGUAGE**: The language being learned (from `courseTitle`). All dialogue and options are in this language.\n- **NATIVE_LANGUAGE**: The learner's native language (from `language` code). Questions, feedback, and context translations use this language.\n\n## Language Codes\n\n- `en`: US English\n- `pt`: Brazilian Portuguese\n- `es`: Latin American Spanish\n\n## What Appears in Each Language\n\n| Field                        | Language     | Example (Spanish course, English native)                  |\n| ---------------------------- | ------------ | --------------------------------------------------------- |\n| `scenario`                   | NATIVE       | \"You're at a cafe in Madrid and want to order coffee.\"    |\n| `context`                    | TARGET       | \"Buenos dias, que le pongo?\"                              |\n| `contextTranslation`         | NATIVE       | \"Good morning, what can I get you?\"                       |\n| `contextRomanization`        | Romanization | \"\" (empty for Roman scripts)                              |\n| `options[].text`             | TARGET       | \"Un cafe con leche, por favor.\"                           |\n| `options[].textRomanization` | Romanization | \"\" (empty for Roman scripts)                              |\n| `options[].feedback`         | NATIVE       | \"A coffee with milk, please - Perfect! Polite and clear.\" |\n\n# Options Design\n\n## No Translations in Options\n\nThis is the most critical design decision. Options show ONLY:\n\n- `text`: The phrase in TARGET language\n- `textRomanization`: Romanization for non-Roman scripts (empty string for Roman scripts)\n\n**NO translation is shown**. This forces the learner to:\n\n1. Parse the target language directly\n2. Use patterns they've learned\n3. Make educated guesses based on context\n4. Experience the productive struggle of real communication\n\n## Option Quality\n\nAll 4 options must be:\n\n- **Grammatically correct** in the target language\n- **Contextually plausible** (something a learner might say in this situation)\n- **Distinct in meaning** (not just word variations)\n- **Level-appropriate** (using vocabulary/structures the learner knows)\n\n## Distractor Design\n\n**CRITICAL**: Wrong options must be genuinely inappropriate for the situation - they should lead to miscommunication or confusion if used. Do NOT create distractors that are merely \"less polished\" versions of the correct answer.\n\nWrong options should be **clearly wrong** because they:\n\n1. **Answer a different question**: Respond to something the speaker didn't ask (asking about price when asked about quantity)\n2. **Request the wrong thing**: Order/ask for something different than intended (one-way ticket when you need round-trip)\n3. **Are off-topic**: Say something unrelated to the current conversation point (asking for the check when you just arrived)\n4. **Would cause confusion**: Use words that change the meaning entirely (saying \"no\" when you mean \"yes\")\n\n**DO NOT** create distractors that are:\n\n- Just more/less formal versions of the correct answer\n- Slightly different phrasings that would still work\n- Grammatically awkward but still understandable\n\n# Feedback Design\n\nFeedback appears AFTER the learner selects an option. Every feedback message MUST include:\n\n1. **Translation**: What the option actually means in the native language\n2. **Explanation**: Why this choice is correct or incorrect for the situation\n\n## Feedback Structure\n\nFor **correct** options:\n\n```\n\"[Translation of what they said] - [Why this works in context]\"\n```\n\nExample: \"A coffee with milk, please - Perfect! This is polite and clearly communicates what you want.\"\n\nFor **incorrect** options:\n\n```\n\"[Translation of what they said] - [Why this doesn't work and what would be better]\"\n```\n\nExample: \"Where is the bathroom? - You're trying to order coffee, not find the restroom. Tell the barista what you'd like to drink.\"\n\n# Romanization Requirements\n\nFor languages using non-Roman writing systems (Japanese, Chinese, Korean, Arabic, Russian, Greek, Hebrew, Thai, Hindi, etc.), provide romanization for both context and options.\n\n## Standard Systems\n\n- **Japanese**: Romaji using Hepburn romanization\n- **Chinese**: Pinyin with tone marks\n- **Korean**: Revised Romanization of Korean\n- **Russian**: ISO 9 or BGN/PCGN transliteration\n- **Arabic**: Standard romanization\n- **Greek**: Standard transliteration\n- **Thai**: Royal Thai General System\n- **Hindi**: IAST or Hunterian transliteration\n\n## Roman Scripts\n\nFor languages using Roman letters (Spanish, French, German, Portuguese, Italian, etc.), set both `contextRomanization` and `textRomanization` to empty strings `\"\"`.\n\n# Story Arc\n\nEach story should have 5-10 steps following a natural arc:\n\n## Step Progression\n\n1. **Opening** (1-2 steps): Arrive at the location, initial greeting\n2. **Building** (2-4 steps): Main interaction, making requests, clarifying\n3. **Complication** (0-2 steps): Optional challenge that adds realism\n4. **Resolution** (1-2 steps): Complete the transaction\n5. **Closing** (1 step): Thank and goodbye\n\n## Complication Ideas (Recommended)\n\nAdding a complication makes the story more realistic and teaches learners to handle unexpected situations:\n\n- **Item unavailable**: \"Sorry, we're out of that. Would you like something else?\"\n- **Misunderstanding**: \"Did you say two or twelve?\"\n- **Additional requirement**: \"I'll need to see your ID for that.\"\n- **Clarification needed**: \"Which size did you want?\"\n\n## Pacing Guidelines\n\n- Steps should feel like natural conversation beats\n- Each step presents ONE decision point\n- Context should flow naturally from the previous step\n- The native speaker's response should acknowledge what the learner said\n\n# Output Format\n\nReturn an object with this structure (abbreviated examples shown):\n\n**Non-Roman script example (Japanese):**\n\n```json\n{\n  \"scenario\": \"You're at a train station in Tokyo...\",\n  \"steps\": [\n    {\n      \"context\": \"いらっしゃいませ。どちらまで？\",\n      \"contextTranslation\": \"Welcome. Where to?\",\n      \"contextRomanization\": \"Irasshaimase. Dochira made?\",\n      \"options\": [\n        {\n          \"text\": \"京都までお願いします。\",\n          \"textRomanization\": \"Kyouto made onegaishimasu.\",\n          \"isCorrect\": true,\n          \"feedback\": \"To Kyoto, please - Perfect!\"\n        },\n        {\n          \"text\": \"京都は遠いですか？\",\n          \"textRomanization\": \"Kyouto wa tooi desu ka?\",\n          \"isCorrect\": false,\n          \"feedback\": \"Is Kyoto far? - This asks about distance, not for a ticket.\"\n        }\n      ]\n    }\n  ]\n}\n```\n\n**Roman script example (Spanish) - empty romanization fields:**\n\n```json\n{\n  \"scenario\": \"You're at a restaurant in Barcelona...\",\n  \"steps\": [\n    {\n      \"context\": \"Buenas noches. Estan listos para pedir?\",\n      \"contextTranslation\": \"Good evening. Are you ready to order?\",\n      \"contextRomanization\": \"\",\n      \"options\": [\n        {\n          \"text\": \"Si, me gustaria la paella, por favor.\",\n          \"textRomanization\": \"\",\n          \"isCorrect\": true,\n          \"feedback\": \"Yes, I would like the paella, please - Perfect!\"\n        },\n        {\n          \"text\": \"La cuenta, por favor.\",\n          \"textRomanization\": \"\",\n          \"isCorrect\": false,\n          \"feedback\": \"The check, please - You haven't eaten yet!\"\n        }\n      ]\n    }\n  ]\n}\n```\n\nNote: Examples above are abbreviated. Actual output must have 4 options per step and 5-10 steps total.\n\n# Quality Checklist\n\nBefore finalizing, verify:\n\n1. **Grammar accuracy**: All target language text is grammatically correct\n2. **Natural dialogue**: Conversations flow like real interactions\n3. **Appropriate register**: Formality matches the situation (casual cafe vs formal office)\n4. **Cultural accuracy**: Interactions reflect how things work in that culture\n5. **Clear progression**: Steps follow a logical narrative arc\n6. **Distinct options**: Each option represents a meaningfully different choice\n7. **Helpful feedback**: Translations and explanations clarify meaning and context\n8. **Correct romanization**: Follows standard systems for non-Roman scripts, empty for Roman scripts\n9. **Scenario relevance**: The story matches the lesson topic\n10. **Appropriate difficulty**: Language complexity matches learner level\n\n# Common Mistakes to Avoid\n\n1. **Including translations in options**: Options must show TARGET language only\n2. **Trivial distractors**: Options that are obviously wrong or nonsensical\n3. **Inconsistent register**: Mixing formal and informal inappropriately\n4. **Unnatural responses**: Things a native speaker would never actually say\n5. **Missing romanization**: Forgetting to add romanization for non-Roman scripts\n6. **Adding romanization to Roman scripts**: Spanish, French, etc. should have empty strings\n7. **Feedback without translation**: Always include what the option means\n8. **Disconnected steps**: Each step should follow logically from the previous one\n",
      "testCaseId": "es-korean-asking-directions-1",
      "userPrompt": "TARGET_LANGUAGE: Korean\nNATIVE_LANGUAGE: es\nCHAPTER_TITLE: Transporte y Direcciones\nLESSON_TITLE: Pidiendo Direcciones\nLESSON_DESCRIPTION: Como pedir direcciones y entender indicaciones basicas en coreano\n\nGenerate an immersive dialogue-driven story activity for this language lesson. Create a realistic everyday scenario where learners practice language production in situations they'd face in a foreign country."
    },
    {
      "duration": 41410.711083,
      "inputTokens": 3727,
      "output": "{\n  \"scenario\": \"You're not feeling well and have walked into a pharmacy in Madrid. You need to describe your symptoms to the pharmacist and get some medicine to feel better.\",\n  \"steps\": [\n    {\n      \"context\": \"¡Buenas tardes! ¿En qué puedo ayudarle?\",\n      \"contextRomanization\": \"\",\n      \"contextTranslation\": \"Good afternoon! How can I help you?\",\n      \"options\": [\n        {\n          \"feedback\": \"Good afternoon. I don't feel very well. - Perfect! This is a natural way to start explaining that you need help with a health issue.\",\n          \"isCorrect\": true,\n          \"text\": \"Buenas tardes. No me siento muy bien.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Where is the supermarket? - You're in a pharmacy to get medicine, not to find a supermarket. Tell the pharmacist how you're feeling.\",\n          \"isCorrect\": false,\n          \"text\": \"¿Dónde está el supermercado?\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"I want to return this product. - You haven't bought anything yet. You need to explain that you're not feeling well.\",\n          \"isCorrect\": false,\n          \"text\": \"Quiero devolver este producto.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"What time do you close? - This doesn't address your health problem. Start by telling the pharmacist you don't feel well.\",\n          \"isCorrect\": false,\n          \"text\": \"¿A qué hora cierran?\",\n          \"textRomanization\": \"\"\n        }\n      ]\n    },\n    {\n      \"context\": \"Lo siento mucho. ¿Qué le pasa? ¿Cuáles son sus síntomas?\",\n      \"contextRomanization\": \"\",\n      \"contextTranslation\": \"I'm very sorry. What's wrong? What are your symptoms?\",\n      \"options\": [\n        {\n          \"feedback\": \"My head hurts and I have a fever. - Excellent! You've clearly described two common symptoms that will help the pharmacist recommend the right medicine.\",\n          \"isCorrect\": true,\n          \"text\": \"Me duele la cabeza y tengo fiebre.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"I need toothpaste. - This is a product request, not a symptom description. Tell the pharmacist what hurts or how you feel.\",\n          \"isCorrect\": false,\n          \"text\": \"Necesito pasta de dientes.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"I like this pharmacy. - That's nice, but the pharmacist asked about your symptoms. Describe what's wrong with your health.\",\n          \"isCorrect\": false,\n          \"text\": \"Me gusta esta farmacia.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"I arrived yesterday on vacation. - This doesn't describe your symptoms. Tell the pharmacist about your headache, fever, or other issues.\",\n          \"isCorrect\": false,\n          \"text\": \"Llegué ayer de vacaciones.\",\n          \"textRomanization\": \"\"\n        }\n      ]\n    },\n    {\n      \"context\": \"Entiendo. ¿Tiene otros síntomas? ¿Dolor de garganta o tos?\",\n      \"contextRomanization\": \"\",\n      \"contextTranslation\": \"I understand. Do you have other symptoms? Sore throat or cough?\",\n      \"options\": [\n        {\n          \"feedback\": \"Yes, my throat hurts too. - Great response! You're giving the pharmacist important information to help diagnose your condition.\",\n          \"isCorrect\": true,\n          \"text\": \"Sí, también me duele la garganta.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"I don't speak Spanish. - But you've been communicating just fine! Answer the pharmacist's question about your other symptoms.\",\n          \"isCorrect\": false,\n          \"text\": \"No hablo español.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"How much does the shampoo cost? - The pharmacist is asking about your symptoms, not helping you shop for hair products.\",\n          \"isCorrect\": false,\n          \"text\": \"¿Cuánto cuesta el champú?\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"I want to buy vitamins. - Right now you need medicine for your current symptoms. Answer whether you also have a sore throat or cough.\",\n          \"isCorrect\": false,\n          \"text\": \"Quiero comprar vitaminas.\",\n          \"textRomanization\": \"\"\n        }\n      ]\n    },\n    {\n      \"context\": \"Parece un resfriado. Le recomiendo este medicamento. ¿Es alérgico a algún medicamento?\",\n      \"contextRomanization\": \"\",\n      \"contextTranslation\": \"It seems like a cold. I recommend this medicine. Are you allergic to any medication?\",\n      \"options\": [\n        {\n          \"feedback\": \"No, I don't have any allergies. - Perfect! This is important safety information that the pharmacist needs to know.\",\n          \"isCorrect\": true,\n          \"text\": \"No, no tengo ninguna alergia.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Yes, I'm allergic to cats. - The pharmacist asked about medication allergies, not pet allergies. This won't help with your prescription.\",\n          \"isCorrect\": false,\n          \"text\": \"Sí, soy alérgico a los gatos.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Do you have this medicine in another color? - Medicine color doesn't matter. Answer the important question about drug allergies.\",\n          \"isCorrect\": false,\n          \"text\": \"¿Tiene esta medicina en otro color?\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"I prefer natural remedies. - This doesn't answer the allergy question, which is important for your safety.\",\n          \"isCorrect\": false,\n          \"text\": \"Prefiero remedios naturales.\",\n          \"textRomanization\": \"\"\n        }\n      ]\n    },\n    {\n      \"context\": \"Muy bien. Tome una pastilla cada ocho horas. ¿Necesita algo más?\",\n      \"contextRomanization\": \"\",\n      \"contextTranslation\": \"Very well. Take one pill every eight hours. Do you need anything else?\",\n      \"options\": [\n        {\n          \"feedback\": \"Yes, do you have throat lozenges? - Smart thinking! Since your throat hurts, throat lozenges would provide extra relief.\",\n          \"isCorrect\": true,\n          \"text\": \"Sí, ¿tiene pastillas para la garganta?\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Can I pay with the supermarket credit card? - Supermarket cards don't work at pharmacies. The pharmacist asked if you need more medicine.\",\n          \"isCorrect\": false,\n          \"text\": \"¿Puedo pagar con tarjeta de crédito del supermercado?\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Where is the nearest hospital? - You have a common cold, not an emergency. Focus on getting what you need from the pharmacy.\",\n          \"isCorrect\": false,\n          \"text\": \"¿Dónde está el hospital más cercano?\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"I want an appointment with the doctor. - Pharmacies don't schedule doctor appointments. Answer whether you need additional products.\",\n          \"isCorrect\": false,\n          \"text\": \"Quiero una cita con el médico.\",\n          \"textRomanization\": \"\"\n        }\n      ]\n    },\n    {\n      \"context\": \"Por supuesto, aquí tiene. Estas son muy buenas para el dolor de garganta. ¿Algo más?\",\n      \"contextRomanization\": \"\",\n      \"contextTranslation\": \"Of course, here you go. These are very good for sore throat. Anything else?\",\n      \"options\": [\n        {\n          \"feedback\": \"No, that's all. How much is the total? - Perfect! You've finished shopping and now you're ready to pay.\",\n          \"isCorrect\": true,\n          \"text\": \"No, eso es todo. ¿Cuánto es en total?\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Can I try the pills first? - You can't sample medicine before buying! Ask about the price instead.\",\n          \"isCorrect\": false,\n          \"text\": \"¿Puedo probar las pastillas primero?\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Do you have restaurant service? - This is a pharmacy, not a restaurant. If you're done shopping, ask about the total cost.\",\n          \"isCorrect\": false,\n          \"text\": \"¿Tienen servicio de restaurante?\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"I need a haircut. - Pharmacies don't offer haircuts. Tell the pharmacist if you're finished or ask about the price.\",\n          \"isCorrect\": false,\n          \"text\": \"Necesito un corte de pelo.\",\n          \"textRomanization\": \"\"\n        }\n      ]\n    },\n    {\n      \"context\": \"Son quince euros con cincuenta céntimos. ¿Paga en efectivo o con tarjeta?\",\n      \"contextRomanization\": \"\",\n      \"contextTranslation\": \"That's fifteen euros and fifty cents. Are you paying cash or card?\",\n      \"options\": [\n        {\n          \"feedback\": \"With card, please. - Great! A clear and polite way to indicate your payment method.\",\n          \"isCorrect\": true,\n          \"text\": \"Con tarjeta, por favor.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Do you accept American dollars? - You're in Spain, which uses euros. Choose between cash or card.\",\n          \"isCorrect\": false,\n          \"text\": \"¿Aceptan dólares americanos?\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"It's very expensive, I don't want anything. - But you're sick and need the medicine! Just tell them how you'd like to pay.\",\n          \"isCorrect\": false,\n          \"text\": \"Es muy caro, no quiero nada.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Can you give me a discount? - Spanish pharmacies have fixed prices on medicine. Simply choose your payment method.\",\n          \"isCorrect\": false,\n          \"text\": \"¿Me puede dar un descuento?\",\n          \"textRomanization\": \"\"\n        }\n      ]\n    },\n    {\n      \"context\": \"Perfecto. Aquí tiene su recibo. ¡Que se mejore pronto!\",\n      \"contextRomanization\": \"\",\n      \"contextTranslation\": \"Perfect. Here's your receipt. Get well soon!\",\n      \"options\": [\n        {\n          \"feedback\": \"Thank you very much. Goodbye! - Excellent! A warm and polite way to end the interaction. Now go rest and feel better!\",\n          \"isCorrect\": true,\n          \"text\": \"Muchas gracias. ¡Hasta luego!\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"I don't want the receipt. - It's more polite to accept it and thank the pharmacist for their help.\",\n          \"isCorrect\": false,\n          \"text\": \"No quiero el recibo.\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"Can I use the bathroom? - The transaction is complete. It's time to thank the pharmacist and leave.\",\n          \"isCorrect\": false,\n          \"text\": \"¿Puedo usar el baño?\",\n          \"textRomanization\": \"\"\n        },\n        {\n          \"feedback\": \"I still feel bad. - The medicine needs time to work! Thank the pharmacist and go home to rest.\",\n          \"isCorrect\": false,\n          \"text\": \"Todavía me siento mal.\",\n          \"textRomanization\": \"\"\n        }\n      ]\n    }\n  ]\n}",
      "outputTokens": 3129,
      "systemPrompt": "# Role\n\nYou are an expert language immersion designer specializing in creating realistic, dialogue-driven scenarios that help learners practice language production in authentic contexts. You design experiences that simulate situations learners would encounter when living or traveling in a country where the target language is spoken.\n\n# Goal\n\nCreate an immersive story activity where learners are placed in an everyday situation and must choose appropriate phrases to communicate. The activity simulates real conversations with native speakers, forcing learners to engage with the target language directly rather than relying on translations.\n\nThe activity places learners in a specific scenario (ordering food, asking for directions, checking into a hotel) and guides them through a dialogue where they must select appropriate responses at each step.\n\n# Key Design Principles\n\n## Immersion Over Translation\n\nUnlike other activities where translations help comprehension, this activity intentionally withholds translations from the options. Learners see:\n\n- **Context**: What the native speaker says (in TARGET language with translation)\n- **Options**: Four possible responses (in TARGET language ONLY - no translations)\n\nThis forces learners to:\n\n1. Engage with the target language sounds and patterns\n2. Use context clues to infer meaning\n3. Build recognition before relying on translations\n4. Experience the \"productive uncertainty\" of real conversations\n\nThe translation appears only in the feedback AFTER selection, revealing whether they understood correctly.\n\n## Authentic Scenarios\n\nFocus on situations learners will actually encounter:\n\n| Category       | Example Scenarios                                  |\n| -------------- | -------------------------------------------------- |\n| Food & Dining  | Ordering at a restaurant, asking about ingredients |\n| Transportation | Buying train tickets, asking for directions        |\n| Shopping       | Bargaining at a market, returning an item          |\n| Accommodation  | Checking into a hotel, reporting a problem         |\n| Healthcare     | Describing symptoms at a pharmacy, doctor's visit  |\n| Social         | Meeting neighbors, small talk at a cafe            |\n| Services       | Opening a bank account, getting a phone plan       |\n| Emergencies    | Reporting lost items, asking for help              |\n\n## Supportive Native Speaker\n\nThe character in the story is a friendly native speaker who:\n\n- Speaks naturally but not too fast\n- Helps the learner when they struggle\n- Provides context clues in their responses\n- Never mocks mistakes\n- Gradually introduces more complex language\n\n# Language Handling\n\n## Input Variables\n\n- **TARGET_LANGUAGE**: The language being learned (from `courseTitle`). All dialogue and options are in this language.\n- **NATIVE_LANGUAGE**: The learner's native language (from `language` code). Questions, feedback, and context translations use this language.\n\n## Language Codes\n\n- `en`: US English\n- `pt`: Brazilian Portuguese\n- `es`: Latin American Spanish\n\n## What Appears in Each Language\n\n| Field                        | Language     | Example (Spanish course, English native)                  |\n| ---------------------------- | ------------ | --------------------------------------------------------- |\n| `scenario`                   | NATIVE       | \"You're at a cafe in Madrid and want to order coffee.\"    |\n| `context`                    | TARGET       | \"Buenos dias, que le pongo?\"                              |\n| `contextTranslation`         | NATIVE       | \"Good morning, what can I get you?\"                       |\n| `contextRomanization`        | Romanization | \"\" (empty for Roman scripts)                              |\n| `options[].text`             | TARGET       | \"Un cafe con leche, por favor.\"                           |\n| `options[].textRomanization` | Romanization | \"\" (empty for Roman scripts)                              |\n| `options[].feedback`         | NATIVE       | \"A coffee with milk, please - Perfect! Polite and clear.\" |\n\n# Options Design\n\n## No Translations in Options\n\nThis is the most critical design decision. Options show ONLY:\n\n- `text`: The phrase in TARGET language\n- `textRomanization`: Romanization for non-Roman scripts (empty string for Roman scripts)\n\n**NO translation is shown**. This forces the learner to:\n\n1. Parse the target language directly\n2. Use patterns they've learned\n3. Make educated guesses based on context\n4. Experience the productive struggle of real communication\n\n## Option Quality\n\nAll 4 options must be:\n\n- **Grammatically correct** in the target language\n- **Contextually plausible** (something a learner might say in this situation)\n- **Distinct in meaning** (not just word variations)\n- **Level-appropriate** (using vocabulary/structures the learner knows)\n\n## Distractor Design\n\n**CRITICAL**: Wrong options must be genuinely inappropriate for the situation - they should lead to miscommunication or confusion if used. Do NOT create distractors that are merely \"less polished\" versions of the correct answer.\n\nWrong options should be **clearly wrong** because they:\n\n1. **Answer a different question**: Respond to something the speaker didn't ask (asking about price when asked about quantity)\n2. **Request the wrong thing**: Order/ask for something different than intended (one-way ticket when you need round-trip)\n3. **Are off-topic**: Say something unrelated to the current conversation point (asking for the check when you just arrived)\n4. **Would cause confusion**: Use words that change the meaning entirely (saying \"no\" when you mean \"yes\")\n\n**DO NOT** create distractors that are:\n\n- Just more/less formal versions of the correct answer\n- Slightly different phrasings that would still work\n- Grammatically awkward but still understandable\n\n# Feedback Design\n\nFeedback appears AFTER the learner selects an option. Every feedback message MUST include:\n\n1. **Translation**: What the option actually means in the native language\n2. **Explanation**: Why this choice is correct or incorrect for the situation\n\n## Feedback Structure\n\nFor **correct** options:\n\n```\n\"[Translation of what they said] - [Why this works in context]\"\n```\n\nExample: \"A coffee with milk, please - Perfect! This is polite and clearly communicates what you want.\"\n\nFor **incorrect** options:\n\n```\n\"[Translation of what they said] - [Why this doesn't work and what would be better]\"\n```\n\nExample: \"Where is the bathroom? - You're trying to order coffee, not find the restroom. Tell the barista what you'd like to drink.\"\n\n# Romanization Requirements\n\nFor languages using non-Roman writing systems (Japanese, Chinese, Korean, Arabic, Russian, Greek, Hebrew, Thai, Hindi, etc.), provide romanization for both context and options.\n\n## Standard Systems\n\n- **Japanese**: Romaji using Hepburn romanization\n- **Chinese**: Pinyin with tone marks\n- **Korean**: Revised Romanization of Korean\n- **Russian**: ISO 9 or BGN/PCGN transliteration\n- **Arabic**: Standard romanization\n- **Greek**: Standard transliteration\n- **Thai**: Royal Thai General System\n- **Hindi**: IAST or Hunterian transliteration\n\n## Roman Scripts\n\nFor languages using Roman letters (Spanish, French, German, Portuguese, Italian, etc.), set both `contextRomanization` and `textRomanization` to empty strings `\"\"`.\n\n# Story Arc\n\nEach story should have 5-10 steps following a natural arc:\n\n## Step Progression\n\n1. **Opening** (1-2 steps): Arrive at the location, initial greeting\n2. **Building** (2-4 steps): Main interaction, making requests, clarifying\n3. **Complication** (0-2 steps): Optional challenge that adds realism\n4. **Resolution** (1-2 steps): Complete the transaction\n5. **Closing** (1 step): Thank and goodbye\n\n## Complication Ideas (Recommended)\n\nAdding a complication makes the story more realistic and teaches learners to handle unexpected situations:\n\n- **Item unavailable**: \"Sorry, we're out of that. Would you like something else?\"\n- **Misunderstanding**: \"Did you say two or twelve?\"\n- **Additional requirement**: \"I'll need to see your ID for that.\"\n- **Clarification needed**: \"Which size did you want?\"\n\n## Pacing Guidelines\n\n- Steps should feel like natural conversation beats\n- Each step presents ONE decision point\n- Context should flow naturally from the previous step\n- The native speaker's response should acknowledge what the learner said\n\n# Output Format\n\nReturn an object with this structure (abbreviated examples shown):\n\n**Non-Roman script example (Japanese):**\n\n```json\n{\n  \"scenario\": \"You're at a train station in Tokyo...\",\n  \"steps\": [\n    {\n      \"context\": \"いらっしゃいませ。どちらまで？\",\n      \"contextTranslation\": \"Welcome. Where to?\",\n      \"contextRomanization\": \"Irasshaimase. Dochira made?\",\n      \"options\": [\n        {\n          \"text\": \"京都までお願いします。\",\n          \"textRomanization\": \"Kyouto made onegaishimasu.\",\n          \"isCorrect\": true,\n          \"feedback\": \"To Kyoto, please - Perfect!\"\n        },\n        {\n          \"text\": \"京都は遠いですか？\",\n          \"textRomanization\": \"Kyouto wa tooi desu ka?\",\n          \"isCorrect\": false,\n          \"feedback\": \"Is Kyoto far? - This asks about distance, not for a ticket.\"\n        }\n      ]\n    }\n  ]\n}\n```\n\n**Roman script example (Spanish) - empty romanization fields:**\n\n```json\n{\n  \"scenario\": \"You're at a restaurant in Barcelona...\",\n  \"steps\": [\n    {\n      \"context\": \"Buenas noches. Estan listos para pedir?\",\n      \"contextTranslation\": \"Good evening. Are you ready to order?\",\n      \"contextRomanization\": \"\",\n      \"options\": [\n        {\n          \"text\": \"Si, me gustaria la paella, por favor.\",\n          \"textRomanization\": \"\",\n          \"isCorrect\": true,\n          \"feedback\": \"Yes, I would like the paella, please - Perfect!\"\n        },\n        {\n          \"text\": \"La cuenta, por favor.\",\n          \"textRomanization\": \"\",\n          \"isCorrect\": false,\n          \"feedback\": \"The check, please - You haven't eaten yet!\"\n        }\n      ]\n    }\n  ]\n}\n```\n\nNote: Examples above are abbreviated. Actual output must have 4 options per step and 5-10 steps total.\n\n# Quality Checklist\n\nBefore finalizing, verify:\n\n1. **Grammar accuracy**: All target language text is grammatically correct\n2. **Natural dialogue**: Conversations flow like real interactions\n3. **Appropriate register**: Formality matches the situation (casual cafe vs formal office)\n4. **Cultural accuracy**: Interactions reflect how things work in that culture\n5. **Clear progression**: Steps follow a logical narrative arc\n6. **Distinct options**: Each option represents a meaningfully different choice\n7. **Helpful feedback**: Translations and explanations clarify meaning and context\n8. **Correct romanization**: Follows standard systems for non-Roman scripts, empty for Roman scripts\n9. **Scenario relevance**: The story matches the lesson topic\n10. **Appropriate difficulty**: Language complexity matches learner level\n\n# Common Mistakes to Avoid\n\n1. **Including translations in options**: Options must show TARGET language only\n2. **Trivial distractors**: Options that are obviously wrong or nonsensical\n3. **Inconsistent register**: Mixing formal and informal inappropriately\n4. **Unnatural responses**: Things a native speaker would never actually say\n5. **Missing romanization**: Forgetting to add romanization for non-Roman scripts\n6. **Adding romanization to Roman scripts**: Spanish, French, etc. should have empty strings\n7. **Feedback without translation**: Always include what the option means\n8. **Disconnected steps**: Each step should follow logically from the previous one\n",
      "testCaseId": "en-spanish-pharmacy-visit-1",
      "userPrompt": "TARGET_LANGUAGE: Spanish\nNATIVE_LANGUAGE: en\nCHAPTER_TITLE: Health and Wellness\nLESSON_TITLE: At the Pharmacy\nLESSON_DESCRIPTION: Learn to describe symptoms and buy medicine at a Spanish pharmacy\n\nGenerate an immersive dialogue-driven story activity for this language lesson. Create a realistic everyday scenario where learners practice language production in situations they'd face in a foreign country."
    }
  ],
  "taskId": "activity-story-language"
}
