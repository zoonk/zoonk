{
  "generatedAt": "2026-01-17T19:39:43.077Z",
  "modelId": "google/gemini-3-pro-preview",
  "outputs": [
    {
      "duration": 70493.17245899996,
      "inputTokens": 2144,
      "output": "{\n  \"intro\": \"You are the Lead Architect at DataPulse, a startup processing massive data streams in real-time. Your infrastructure is straining under the load. Every algorithmic choice you make impacts system latency, memory costs, and code maintainability. Your Senior Developer, Alex, needs your guidance to navigate these trade-offs as you scale from thousands to millions of users. {{NAME}}, it's time to choose the right tools for the job.\",\n  \"reflection\": \"Excellent work. You've navigated the core trade-offs of algorithm design. You saw how O(1) speed often demands O(N) memory, how amortized analysis can hide (but not remove) latency spikes, and how optimizing for specific cases like 'Top K' beats generic sorting. In the real world, there is no perfect algorithm—only the right set of compromises for your specific constraints.\",\n  \"steps\": [\n    {\n      \"context\": \"{{NAME}}, we're implementing a firewall to block malicious IPs. We have a list of 10 million bad IPs, and we need to check every single request against it. A Hash Set gives us O(1) lookup but consumes 500MB of RAM we barely have. A Sorted Array uses less memory but lookup is O(log n). What's the move?\",\n      \"options\": [\n        {\n          \"consequence\": \"Requests are processed instantly! However, the memory footprint is massive, forcing us to downsize other caches. Fast, but expensive.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Performance\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Memory Usage\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Use a Hash Set (O(1) lookup)\"\n        },\n        {\n          \"consequence\": \"We saved a ton of RAM! But CPU usage is slightly higher due to the binary search steps. It's a worthy trade-off for our constraints.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Performance\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Memory Usage\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Use a Sorted Array (Binary Search)\"\n        },\n        {\n          \"consequence\": \"Memory usage is tiny and lookups are fast! But the code is complex, and we occasionally block legitimate users due to false positives.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Memory Usage\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Code Complexity\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Use a Bloom Filter (Probabilistic)\"\n        }\n      ],\n      \"question\": \"Which structure balances our constraints?\"\n    },\n    {\n      \"context\": \"The user session tracker is acting up. We used a dynamic array. Access is O(1), but when the array fills up, it doubles in size—copying all elements takes O(N) time. This 'stop-the-world' pause is causing timeouts during traffic spikes.\",\n      \"options\": [\n        {\n          \"consequence\": \"No more resizing spikes! But we've allocated memory for 10 million users when we only have 1 million active. A lot of RAM is sitting empty.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Performance\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Memory Usage\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Pre-allocate maximum capacity\"\n        },\n        {\n          \"consequence\": \"The pauses are gone, but implementing the logic to copy data gradually over many operations was a nightmare to debug.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Performance\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Code Complexity\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Implement incremental resizing\"\n        },\n        {\n          \"consequence\": \"The code remains simple. We accept that 1% of requests will face a latency spike. It's an amortized cost we can live with.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Performance\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Code Complexity\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Keep standard resizing\"\n        }\n      ],\n      \"question\": \"How do we handle the resizing lag?\"\n    },\n    {\n      \"context\": \"Our 'Trending Now' widget is melting the CPU. We're currently sorting the entire list of 5 million active posts just to display the top 10. That's O(N log N) every second. We need to optimize this.\",\n      \"options\": [\n        {\n          \"consequence\": \"Performance improved dramatically! We iterate once, keeping only the top 10 in the heap. Complexity dropped to O(N log k).\",\n          \"effects\": [\n            {\n              \"dimension\": \"Performance\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Code Complexity\",\n              \"impact\": \"neutral\"\n            }\n          ],\n          \"text\": \"Maintain a Min-Heap of size 10\"\n        },\n        {\n          \"consequence\": \"It's blazing fast on average (O(N)), but worst-case performance is unpredictable. We had to add safeguards for specific data patterns.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Performance\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Code Complexity\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Use QuickSelect algorithm\"\n        },\n        {\n          \"consequence\": \"The CPU is still burning. Sorting millions of items just to pick a few is fundamentally inefficient, even if the code is simple.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Performance\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Code Complexity\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Stick to standard Quicksort\"\n        }\n      ],\n      \"question\": \"How do we extract the top 10 efficiently?\"\n    },\n    {\n      \"context\": \"We're storing complex 'User Profile' objects in the RAM cache for O(1) access. We are running out of space. {{NAME}}, we can compress the data, or stop caching the full object and fetch from the database when needed.\",\n      \"options\": [\n        {\n          \"consequence\": \"We reclaimed 50% RAM! But now every read requires CPU cycles to decompress the data, adding slight latency to every request.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Memory Usage\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Performance\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Compress the objects in memory\"\n        },\n        {\n          \"consequence\": \"Memory is free, but performance plummeted. We traded O(1) memory lookup for a slow network call to the database.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Memory Usage\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Performance\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Store IDs only, fetch details on demand\"\n        },\n        {\n          \"consequence\": \"Everything is fast, but we're on the brink of an OutOfMemory error. One big spike and the server crashes.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Performance\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Memory Usage\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Keep full objects cached\"\n        }\n      ],\n      \"question\": \"It's a Time-Space trade-off. What do we prioritize?\"\n    }\n  ]\n}",
      "outputTokens": 7028,
      "systemPrompt": "# Role\n\nYou are an expert educational game designer creating a **Challenge** activity for a learning app. Your mission is to design a choose-your-own-adventure scenario where learners make strategic decisions with meaningful consequences, using the lesson's concepts.\n\nYou specialize in crafting narrative experiences that test strategic thinking — not knowledge recall, but the ability to apply concepts and understand trade-offs.\n\n# Why Narrative Challenges Work\n\nGreat challenges don't quiz — they immerse. Learners face realistic scenarios where every choice has consequences. They experience trade-offs firsthand, making the lesson's principles memorable.\n\n- **No \"Right Answer\"**: Every option has pros and cons. Learners engage with WHY, not just WHAT.\n- **Consequences Over Scores**: Instead of winning or losing, learners see the natural results of their choices.\n- **Strategic Thinking**: Understanding the lesson helps navigate trade-offs, but different strategies lead to different outcomes.\n\n# Inputs\n\n- `LESSON_TITLE`: The topic to create a challenge around\n- `LESSON_DESCRIPTION`: Additional context about what this lesson covers\n- `CHAPTER_TITLE`: The chapter context (for understanding scope)\n- `COURSE_TITLE`: The course context (for understanding audience level)\n- `LANGUAGE`: Output language\n- `EXPLANATION_STEPS`: What the learner has already studied\n\n## Language Guidelines\n\n- `en`: Use US English unless the content is region-specific\n- `pt`: Use Brazilian Portuguese unless the content is region-specific\n- `es`: Use Latin American Spanish unless the content is region-specific\n\n# Requirements\n\n## Introduction\n\nThe `intro` field sets the scene (max 500 characters). It should:\n\n- Establish the scenario and the learner's role\n- Explain what they're navigating (a project, situation, decision-making process)\n- Create stakes that feel meaningful\n- Use `{{NAME}}` to personalize\n\n## Steps\n\nCreate 4-6 steps. Each step presents a decision point with 3-4 options.\n\n### Step Structure\n\n- **context**: Maximum 500 characters. Pure dialogue from a colleague setting up the decision. Conversational, no narrator.\n- **question**: Maximum 100 characters. What needs to be decided.\n- **options**: 3-4 choices, each with:\n  - **text**: The choice (max 80 characters)\n  - **consequence**: What happens as a result (max 300 characters). Shown after choosing. Explains the outcome narratively.\n  - **effects**: Array of 1-3 effects showing how this choice impacts different aspects:\n    - **dimension**: A short name for what this affects (e.g., \"Code Quality\", \"Delivery Speed\", \"Team Morale\"). Use 2-4 different dimensions across all options to create meaningful trade-offs. Important: dimensions must be consistent across all steps.\n    - **impact**: Is this `\"positive\"`, `\"neutral\"`, or `\"negative\"` for that dimension?\n\n### Option Design\n\nEvery option should:\n\n- Be a legitimate choice (no obviously wrong answers)\n- Have a clear consequence that connects to lesson concepts\n- Affect 1-3 dimensions (real decisions rarely affect just one thing)\n- Teach something about trade-offs when the consequence is revealed\n\n**No option should be universally best.** Good options might help one dimension but hurt another. This creates genuine trade-offs.\n\n## Reflection\n\nThe `reflection` field (max 500 characters) provides closing insight after all steps. It should:\n\n- Acknowledge that different approaches have merit\n- Connect the experience back to the lesson's key principles\n- Help learners understand how the concepts apply in practice\n\n## Tone & Style\n\n- **Pure dialogue**: NO narrator, NO character prefixes, NO action descriptions\n- **Natural conversation**: Colleagues working through a problem together\n- **Professional but warm**: Light humor when appropriate\n- **Second-person immersion**: The colleague speaks TO the learner\n- **Use `{{NAME}}`** to personalize dialogue\n\n## What to Avoid\n\n- **Quiz-style questions**: This tests strategic thinking, not recall\n- **Obviously correct answers**: Every option should have genuine trade-offs\n- **Narrator text**: Keep it pure dialogue in context\n- **Disconnected consequences**: Consequences should relate to lesson concepts\n- **Too many or too few dimensions**: Use 2-4 different dimension names across all effects for meaningful trade-offs\n\n## Relationship to Previous Activities\n\nThe learner has completed:\n\n- **Background**: WHY this exists\n- **Explanation**: WHAT it is\n- **Mechanics**: HOW it works\n- **Examples**: WHERE it appears\n- **Story**: WHEN to apply this\n\nYour Challenge activity is the capstone: **CAN YOU NAVIGATE THIS?** It tests whether learners can apply concepts strategically. This should feel like a meaningful simulation, not a test.\n\n# Example\n\nFor a lesson on \"Technical Debt\":\n\n**Step 1:**\n\n```json\n{\n  \"context\": \"{{NAME}}, we've got a deadline crunch. The feature works but the code is messy. Ship it now or clean it up first?\",\n  \"question\": \"How do we handle this?\",\n  \"options\": [\n    {\n      \"text\": \"Ship it now, refactor later\",\n      \"consequence\": \"Feature launched on time! But the messy code made the next sprint's work harder. The team spent extra hours untangling dependencies.\",\n      \"effects\": [\n        { \"dimension\": \"Code Quality\", \"impact\": \"negative\" },\n        { \"dimension\": \"Delivery Speed\", \"impact\": \"positive\" }\n      ]\n    },\n    {\n      \"text\": \"Take two more days to refactor\",\n      \"consequence\": \"The code is clean and maintainable. Stakeholders weren't thrilled about the delay, but future changes will be much easier.\",\n      \"effects\": [\n        { \"dimension\": \"Code Quality\", \"impact\": \"positive\" },\n        { \"dimension\": \"Delivery Speed\", \"impact\": \"negative\" }\n      ]\n    },\n    {\n      \"text\": \"Split the team — half ships, half refactors\",\n      \"consequence\": \"Shipped on time with partial cleanup. Neither task got full attention, and the team felt stretched thin.\",\n      \"effects\": [\n        { \"dimension\": \"Code Quality\", \"impact\": \"neutral\" },\n        { \"dimension\": \"Team Morale\", \"impact\": \"negative\" }\n      ]\n    }\n  ]\n}\n```\n\n# Quality Checks\n\nBefore finalizing, verify:\n\n- [ ] Does the intro establish a clear, engaging scenario?\n- [ ] Does every option have a meaningful consequence?\n- [ ] Are consequences connected to lesson principles?\n- [ ] Is there no obviously \"best\" option in each step?\n- [ ] Do options affect multiple dimensions where realistic?\n- [ ] Are dimension names consistent and lesson-relevant across all effects?\n- [ ] Is `{{NAME}}` used appropriately?\n- [ ] Is all dialogue pure conversation (no narrator)?\n- [ ] Does the reflection tie the experience back to the lesson?\n- [ ] Are all constraints met (intro ≤500, context ≤500, question ≤100, text ≤80, consequence ≤300, reflection ≤500)?\n- [ ] Is the step count between 4 and 6?\n- [ ] Does every step have 3-4 options?\n\n# Output Format\n\nReturn an object with:\n\n- **intro**: Scenario introduction (max 500 chars)\n- **steps**: Array of 4-6 step objects, each with:\n  - **context**: Pure dialogue (max 500 chars)\n  - **question**: Decision prompt (max 100 chars)\n  - **options**: Array of 3-4 objects with:\n    - **text**: Choice description (max 80 chars)\n    - **consequence**: What happens (max 300 chars)\n    - **effects**: Array of 1-3 objects with:\n      - **dimension**: Short name for what this affects (use 2-4 different dimensions total)\n      - **impact**: One of \"positive\", \"neutral\", \"negative\"\n- **reflection**: Closing insight connecting to lesson (max 500 chars)\n",
      "testCaseId": "en-cs-algorithm-complexity-1",
      "userPrompt": "LESSON_TITLE: Algorithm Complexity Trade-offs\nLESSON_DESCRIPTION: Understanding and applying algorithm complexity analysis to make informed trade-offs in software design\nCHAPTER_TITLE: Algorithm Analysis\nCOURSE_TITLE: Data Structures and Algorithms\nLANGUAGE: en\nEXPLANATION_STEPS:\n1. Time Complexity: Time complexity measures how execution time grows with input size. O(n) means linear growth — double the input, double the time. O(n²) means quadratic — double the input, quadruple the time.\n2. Space Complexity: Space complexity measures memory usage growth. Some algorithms trade time for space — storing precomputed results to avoid recalculation. Others trade space for time — using less memory but computing more.\n3. Time-Space Trade-off: The time-space trade-off is fundamental. Hash tables give O(1) lookup but use extra memory. Binary search uses O(1) space but requires sorted data. Choose based on constraints.\n4. Amortized Analysis: Amortized analysis looks at average performance over many operations. ArrayList append is usually O(1), but occasionally O(n) when resizing. Amortized, it's still O(1).\n5. Case Analysis: Best, average, and worst case can differ dramatically. Quicksort averages O(n log n) but worst-cases to O(n²). Know your data distribution to choose wisely."
    },
    {
      "duration": 62053.34520800004,
      "inputTokens": 2095,
      "output": "{\n  \"intro\": \"Welcome to 'Bean Scene', {{NAME}}. You're the manager of the city's busiest coffee spot. But it's not just about brewing espresso—it's about navigating the volatile forces of the market. You'll face changing costs, aggressive competitors, and fickle customers. Every decision impacts your Profitability, Brand Reputation, and Customer Volume. Ready to apply your supply and demand skills to the real world?\",\n  \"reflection\": \"Well handled, {{NAME}}. You've seen firsthand how supply and demand aren't static—they shift constantly based on costs, competition, and trends. You learned that elastic demand requires careful pricing, that supply shocks force tough choices between margins and quality, and that market equilibrium is a moving target. In business, there are rarely perfect solutions, only strategic trade-offs.\",\n  \"steps\": [\n    {\n      \"context\": \"{{NAME}}, we're launching the 'Volcanic Cold Brew' today. Market research shows demand is highly elastic—our main customers are students who watch every penny. If the price is too high, they simply won't buy it. How should we set the launch price?\",\n      \"options\": [\n        {\n          \"consequence\": \"You priced it high to maximize margin, but because demand is elastic, sales volume plummeted. Total revenue is lower than if you'd priced it cheaper.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Profitability\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Customer Volume\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Set a Premium Price ($7.00)\"\n        },\n        {\n          \"consequence\": \"The lower price triggered a massive spike in sales! Revenue is high due to volume, but the baristas are stressed and service is slowing down.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Profitability\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Brand Reputation\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Set a Student Price ($3.50)\"\n        },\n        {\n          \"consequence\": \"A safe middle ground. You made decent sales without overwhelming the team, but you left potential market share on the table.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Profitability\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Customer Volume\",\n              \"impact\": \"neutral\"\n            }\n          ],\n          \"text\": \"Set a Standard Price ($5.00)\"\n        }\n      ],\n      \"question\": \"What is your pricing strategy?\"\n    },\n    {\n      \"context\": \"Bad news, {{NAME}}. A frost in Brazil just spiked global coffee bean prices by 30%. Our input costs have soared, shifting our supply curve to the left. We can't produce at the same cost anymore. We need to react before the monthly report.\",\n      \"options\": [\n        {\n          \"consequence\": \"You passed the cost to the consumer. Margins are protected, but the higher price caused a movement along the demand curve—sales have dropped.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Profitability\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Customer Volume\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Raise prices to match the cost\"\n        },\n        {\n          \"consequence\": \"You decided to eat the cost to keep customers happy. Sales volume remains steady, but the higher input costs are draining our profits.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Profitability\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Brand Reputation\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Absorb the cost (keep prices same)\"\n        },\n        {\n          \"consequence\": \"You switched to a cheaper, lower-quality bean supplier. Margins and prices stay stable, but customers are noticing the bitter taste.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Profitability\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Brand Reputation\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Switch to cheaper ingredients\"\n        }\n      ],\n      \"question\": \"How do we handle the supply shock?\"\n    },\n    {\n      \"context\": \"A trendy new bubble tea shop opened across the street, {{NAME}}. They are a substitute good, and our morning foot traffic has dropped by 15%. Our demand curve is shifting to the left. We need a strategy to stabilize the shop.\",\n      \"options\": [\n        {\n          \"consequence\": \"You slashed prices to compete. It brought some volume back, but we're now in a price war that is killing our profit margins.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Profitability\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Customer Volume\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Lower prices to undercuts them\"\n        },\n        {\n          \"consequence\": \"You invested in a 'Loyalty Week' campaign. It cost money upfront, but it successfully shifted demand back by differentiating our brand.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Profitability\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Brand Reputation\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Launch a marketing campaign\"\n        },\n        {\n          \"consequence\": \"You accepted the new equilibrium and reduced staff hours to match the lower demand. It saved costs, but the shop feels emptier.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Profitability\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Customer Volume\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Cut costs to match lower demand\"\n        }\n      ],\n      \"question\": \"How do we respond to the competition?\"\n    },\n    {\n      \"context\": \"It's Finals Week, {{NAME}}! The library is packed, and students are desperate for caffeine. Demand has shifted massively to the right. We are at capacity, and a line is forming out the door. We're facing a shortage at the current price.\",\n      \"options\": [\n        {\n          \"consequence\": \"You implemented surge pricing. It cleared the market and maximized profit, but students are complaining about 'price gouging' on social media.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Profitability\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Brand Reputation\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Raise prices temporarily (Surge Pricing)\"\n        },\n        {\n          \"consequence\": \"You kept prices stable. The shortage persisted, leading to huge lines and many customers leaving frustrated because they couldn't get served.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Profitability\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Brand Reputation\",\n              \"impact\": \"neutral\"\n            }\n          ],\n          \"text\": \"First come, first served\"\n        },\n        {\n          \"consequence\": \"You called in emergency temp staff. You met the demand and kept the line moving, but the rush wages ate up most of the extra revenue.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Profitability\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Customer Volume\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Increase supply (hire temp staff)\"\n        }\n      ],\n      \"question\": \"How do we manage the excess demand?\"\n    }\n  ]\n}",
      "outputTokens": 6622,
      "systemPrompt": "# Role\n\nYou are an expert educational game designer creating a **Challenge** activity for a learning app. Your mission is to design a choose-your-own-adventure scenario where learners make strategic decisions with meaningful consequences, using the lesson's concepts.\n\nYou specialize in crafting narrative experiences that test strategic thinking — not knowledge recall, but the ability to apply concepts and understand trade-offs.\n\n# Why Narrative Challenges Work\n\nGreat challenges don't quiz — they immerse. Learners face realistic scenarios where every choice has consequences. They experience trade-offs firsthand, making the lesson's principles memorable.\n\n- **No \"Right Answer\"**: Every option has pros and cons. Learners engage with WHY, not just WHAT.\n- **Consequences Over Scores**: Instead of winning or losing, learners see the natural results of their choices.\n- **Strategic Thinking**: Understanding the lesson helps navigate trade-offs, but different strategies lead to different outcomes.\n\n# Inputs\n\n- `LESSON_TITLE`: The topic to create a challenge around\n- `LESSON_DESCRIPTION`: Additional context about what this lesson covers\n- `CHAPTER_TITLE`: The chapter context (for understanding scope)\n- `COURSE_TITLE`: The course context (for understanding audience level)\n- `LANGUAGE`: Output language\n- `EXPLANATION_STEPS`: What the learner has already studied\n\n## Language Guidelines\n\n- `en`: Use US English unless the content is region-specific\n- `pt`: Use Brazilian Portuguese unless the content is region-specific\n- `es`: Use Latin American Spanish unless the content is region-specific\n\n# Requirements\n\n## Introduction\n\nThe `intro` field sets the scene (max 500 characters). It should:\n\n- Establish the scenario and the learner's role\n- Explain what they're navigating (a project, situation, decision-making process)\n- Create stakes that feel meaningful\n- Use `{{NAME}}` to personalize\n\n## Steps\n\nCreate 4-6 steps. Each step presents a decision point with 3-4 options.\n\n### Step Structure\n\n- **context**: Maximum 500 characters. Pure dialogue from a colleague setting up the decision. Conversational, no narrator.\n- **question**: Maximum 100 characters. What needs to be decided.\n- **options**: 3-4 choices, each with:\n  - **text**: The choice (max 80 characters)\n  - **consequence**: What happens as a result (max 300 characters). Shown after choosing. Explains the outcome narratively.\n  - **effects**: Array of 1-3 effects showing how this choice impacts different aspects:\n    - **dimension**: A short name for what this affects (e.g., \"Code Quality\", \"Delivery Speed\", \"Team Morale\"). Use 2-4 different dimensions across all options to create meaningful trade-offs. Important: dimensions must be consistent across all steps.\n    - **impact**: Is this `\"positive\"`, `\"neutral\"`, or `\"negative\"` for that dimension?\n\n### Option Design\n\nEvery option should:\n\n- Be a legitimate choice (no obviously wrong answers)\n- Have a clear consequence that connects to lesson concepts\n- Affect 1-3 dimensions (real decisions rarely affect just one thing)\n- Teach something about trade-offs when the consequence is revealed\n\n**No option should be universally best.** Good options might help one dimension but hurt another. This creates genuine trade-offs.\n\n## Reflection\n\nThe `reflection` field (max 500 characters) provides closing insight after all steps. It should:\n\n- Acknowledge that different approaches have merit\n- Connect the experience back to the lesson's key principles\n- Help learners understand how the concepts apply in practice\n\n## Tone & Style\n\n- **Pure dialogue**: NO narrator, NO character prefixes, NO action descriptions\n- **Natural conversation**: Colleagues working through a problem together\n- **Professional but warm**: Light humor when appropriate\n- **Second-person immersion**: The colleague speaks TO the learner\n- **Use `{{NAME}}`** to personalize dialogue\n\n## What to Avoid\n\n- **Quiz-style questions**: This tests strategic thinking, not recall\n- **Obviously correct answers**: Every option should have genuine trade-offs\n- **Narrator text**: Keep it pure dialogue in context\n- **Disconnected consequences**: Consequences should relate to lesson concepts\n- **Too many or too few dimensions**: Use 2-4 different dimension names across all effects for meaningful trade-offs\n\n## Relationship to Previous Activities\n\nThe learner has completed:\n\n- **Background**: WHY this exists\n- **Explanation**: WHAT it is\n- **Mechanics**: HOW it works\n- **Examples**: WHERE it appears\n- **Story**: WHEN to apply this\n\nYour Challenge activity is the capstone: **CAN YOU NAVIGATE THIS?** It tests whether learners can apply concepts strategically. This should feel like a meaningful simulation, not a test.\n\n# Example\n\nFor a lesson on \"Technical Debt\":\n\n**Step 1:**\n\n```json\n{\n  \"context\": \"{{NAME}}, we've got a deadline crunch. The feature works but the code is messy. Ship it now or clean it up first?\",\n  \"question\": \"How do we handle this?\",\n  \"options\": [\n    {\n      \"text\": \"Ship it now, refactor later\",\n      \"consequence\": \"Feature launched on time! But the messy code made the next sprint's work harder. The team spent extra hours untangling dependencies.\",\n      \"effects\": [\n        { \"dimension\": \"Code Quality\", \"impact\": \"negative\" },\n        { \"dimension\": \"Delivery Speed\", \"impact\": \"positive\" }\n      ]\n    },\n    {\n      \"text\": \"Take two more days to refactor\",\n      \"consequence\": \"The code is clean and maintainable. Stakeholders weren't thrilled about the delay, but future changes will be much easier.\",\n      \"effects\": [\n        { \"dimension\": \"Code Quality\", \"impact\": \"positive\" },\n        { \"dimension\": \"Delivery Speed\", \"impact\": \"negative\" }\n      ]\n    },\n    {\n      \"text\": \"Split the team — half ships, half refactors\",\n      \"consequence\": \"Shipped on time with partial cleanup. Neither task got full attention, and the team felt stretched thin.\",\n      \"effects\": [\n        { \"dimension\": \"Code Quality\", \"impact\": \"neutral\" },\n        { \"dimension\": \"Team Morale\", \"impact\": \"negative\" }\n      ]\n    }\n  ]\n}\n```\n\n# Quality Checks\n\nBefore finalizing, verify:\n\n- [ ] Does the intro establish a clear, engaging scenario?\n- [ ] Does every option have a meaningful consequence?\n- [ ] Are consequences connected to lesson principles?\n- [ ] Is there no obviously \"best\" option in each step?\n- [ ] Do options affect multiple dimensions where realistic?\n- [ ] Are dimension names consistent and lesson-relevant across all effects?\n- [ ] Is `{{NAME}}` used appropriately?\n- [ ] Is all dialogue pure conversation (no narrator)?\n- [ ] Does the reflection tie the experience back to the lesson?\n- [ ] Are all constraints met (intro ≤500, context ≤500, question ≤100, text ≤80, consequence ≤300, reflection ≤500)?\n- [ ] Is the step count between 4 and 6?\n- [ ] Does every step have 3-4 options?\n\n# Output Format\n\nReturn an object with:\n\n- **intro**: Scenario introduction (max 500 chars)\n- **steps**: Array of 4-6 step objects, each with:\n  - **context**: Pure dialogue (max 500 chars)\n  - **question**: Decision prompt (max 100 chars)\n  - **options**: Array of 3-4 objects with:\n    - **text**: Choice description (max 80 chars)\n    - **consequence**: What happens (max 300 chars)\n    - **effects**: Array of 1-3 objects with:\n      - **dimension**: Short name for what this affects (use 2-4 different dimensions total)\n      - **impact**: One of \"positive\", \"neutral\", \"negative\"\n- **reflection**: Closing insight connecting to lesson (max 500 chars)\n",
      "testCaseId": "en-economics-supply-demand-1",
      "userPrompt": "LESSON_TITLE: Supply and Demand in Practice\nLESSON_DESCRIPTION: Applying supply and demand principles to make strategic pricing and market decisions\nCHAPTER_TITLE: Market Dynamics\nCOURSE_TITLE: Microeconomics Fundamentals\nLANGUAGE: en\nEXPLANATION_STEPS:\n1. The Demand Curve: Demand curves slope downward — as price rises, quantity demanded falls. This reflects the law of demand: people buy less when things cost more, all else equal.\n2. The Supply Curve: Supply curves slope upward — as price rises, quantity supplied increases. Higher prices incentivize producers to make more. Lower prices make production less worthwhile.\n3. Market Equilibrium: Equilibrium occurs where supply meets demand. At this price, quantity supplied equals quantity demanded. Prices above equilibrium create surplus; prices below create shortage.\n4. Price Elasticity: Price elasticity measures responsiveness to price changes. Elastic demand (>1) means sales drop sharply with price increases. Inelastic demand (<1) means sales barely change.\n5. Shifts vs. Movements: Shifts vs. movements: A change in price moves along the curve. Changes in other factors (income, preferences, costs) shift the entire curve. This distinction is crucial."
    },
    {
      "duration": 43743.76508400007,
      "inputTokens": 2098,
      "output": "{\n  \"intro\": \"Welcome to Silver Creek Reserve, {{NAME}}. You've been appointed Head Ecologist for this degraded landscape. It's a complex web: invasive species, overpopulation, and crumbling infrastructure. Your goal is to restore the ecosystem's balance, but every biological decision has social and economic costs. There are no perfect solutions here, only trade-offs. Are you ready to manage the dynamics of life?\",\n  \"reflection\": \"Managing an ecosystem isn't about freezing nature in a perfect state; it's about navigating dynamic flux. As you saw, maximizing biodiversity sometimes alienates the public, and ensuring stability can drain your budget. Real conservation requires understanding that interconnected networks, carrying capacities, and trophic cascades don't just exist in textbooks—they react to every choice you make. You balanced the system well, {{NAME}}.\",\n  \"steps\": [\n    {\n      \"context\": \"{{NAME}}, we have a situation with the riverbank. Invasive kudzu vines are choking out the native saplings, reducing biodiversity. However, their massive root systems are the only thing holding the soil together. If we remove them all at once, the next rainstorm could wash the bank away.\",\n      \"options\": [\n        {\n          \"consequence\": \"The natives are free to grow, but a heavy rain last night caused a massive mudslide. We lost soil and water quality plummeted.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Biodiversity\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Ecosystem Stability\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Rip it all out now to prioritize native species.\"\n        },\n        {\n          \"consequence\": \"The bank is stable, but the kudzu is spreading faster than we can cut. Native plants are struggling to find light in the monoculture.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Biodiversity\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Ecosystem Stability\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Leave the kudzu for stability.\"\n        },\n        {\n          \"consequence\": \"It's slow, expensive work. We're replacing patches of kudzu with willow stakes. Erosion is controlled, but recovery will take years.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Budget\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Ecosystem Stability\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Phase removal: replace small sections gradually.\"\n        }\n      ],\n      \"question\": \"How do we handle the invasive species?\"\n    },\n    {\n      \"context\": \"The deer population has exploded, {{NAME}}. They've exceeded the carrying capacity and are grazing every young tree to the ground. The forest cannot regenerate. We need to reduce their numbers to save the vegetation, but the methods available are controversial.\",\n      \"options\": [\n        {\n          \"consequence\": \"A classic trophic cascade! The wolves reduced the deer, and the trees are bouncing back. However, local ranchers are furious and protesting at the gates.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Biodiversity\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Public Support\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Reintroduce wolves (natural predation).\"\n        },\n        {\n          \"consequence\": \"The forest is recovering in the fenced zones, but the deer are starving outside them. We haven't solved the population issue, just moved it.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Biodiversity\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Budget\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Install tall exclusion fences around saplings.\"\n        },\n        {\n          \"consequence\": \"The population is down to manageable levels, and we sold permits to fund the park. It's artificial control, but the ecosystem is breathing again.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Budget\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Ecosystem Stability\",\n              \"impact\": \"neutral\"\n            }\n          ],\n          \"text\": \"Authorize a managed hunting season.\"\n        }\n      ],\n      \"question\": \"The deer are destroying the forest. What's the plan?\"\n    },\n    {\n      \"context\": \"Our wetlands are drying up. Historically, beavers acted as ecosystem engineers here, maintaining the water table. Reintroducing them would restore the wetland biodiversity, but their dams will likely flood the popular hiking trail near the creek.\",\n      \"options\": [\n        {\n          \"consequence\": \"The beavers are back! Waterfowl and amphibians have returned in droves. But the main trail is underwater, and hikers are demanding a refund.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Biodiversity\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Public Support\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Reintroduce the beavers.\"\n        },\n        {\n          \"consequence\": \"We installed pumps and weirs. The wetland is wet, but it's an artificial system that drains our maintenance budget every month.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Ecosystem Stability\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Budget\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Install mechanical water controls.\"\n        },\n        {\n          \"consequence\": \"Without water, the area is transitioning into a dry meadow. We lost the wetland species, but the trails are dry and accessible.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Biodiversity\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Public Support\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Let it transition naturally to meadow.\"\n        }\n      ],\n      \"question\": \"How do we manage the drying wetland?\"\n    },\n    {\n      \"context\": \"Last one, {{NAME}}. Dead wood is piling up on the forest floor. It's natural fuel, but if a wildfire starts, it'll be catastrophic. A prescribed burn would clear it and recycle nutrients, but the smoke will drift into town.\",\n      \"options\": [\n        {\n          \"consequence\": \"The burn cleared the fuel and triggered germination for fire-dependent seeds. The forest is resilient, though the town mayor sent a complaint letter about the smoke.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Ecosystem Stability\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Public Support\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Conduct a prescribed burn.\"\n        },\n        {\n          \"consequence\": \"We paid a crew to haul the wood out manually. The fire risk is low, but the soil is deprived of those recycled nutrients, weakening future growth.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Budget\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Ecosystem Stability\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Manually clear the dead wood.\"\n        },\n        {\n          \"consequence\": \"We saved money and avoided smoke, but the fuel load is critical now. One lightning strike could turn the whole reserve into ash.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Budget\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Ecosystem Stability\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Do nothing; suppress fires if they start.\"\n        }\n      ],\n      \"question\": \"How do we handle the fire risk?\"\n    }\n  ]\n}",
      "outputTokens": 4182,
      "systemPrompt": "# Role\n\nYou are an expert educational game designer creating a **Challenge** activity for a learning app. Your mission is to design a choose-your-own-adventure scenario where learners make strategic decisions with meaningful consequences, using the lesson's concepts.\n\nYou specialize in crafting narrative experiences that test strategic thinking — not knowledge recall, but the ability to apply concepts and understand trade-offs.\n\n# Why Narrative Challenges Work\n\nGreat challenges don't quiz — they immerse. Learners face realistic scenarios where every choice has consequences. They experience trade-offs firsthand, making the lesson's principles memorable.\n\n- **No \"Right Answer\"**: Every option has pros and cons. Learners engage with WHY, not just WHAT.\n- **Consequences Over Scores**: Instead of winning or losing, learners see the natural results of their choices.\n- **Strategic Thinking**: Understanding the lesson helps navigate trade-offs, but different strategies lead to different outcomes.\n\n# Inputs\n\n- `LESSON_TITLE`: The topic to create a challenge around\n- `LESSON_DESCRIPTION`: Additional context about what this lesson covers\n- `CHAPTER_TITLE`: The chapter context (for understanding scope)\n- `COURSE_TITLE`: The course context (for understanding audience level)\n- `LANGUAGE`: Output language\n- `EXPLANATION_STEPS`: What the learner has already studied\n\n## Language Guidelines\n\n- `en`: Use US English unless the content is region-specific\n- `pt`: Use Brazilian Portuguese unless the content is region-specific\n- `es`: Use Latin American Spanish unless the content is region-specific\n\n# Requirements\n\n## Introduction\n\nThe `intro` field sets the scene (max 500 characters). It should:\n\n- Establish the scenario and the learner's role\n- Explain what they're navigating (a project, situation, decision-making process)\n- Create stakes that feel meaningful\n- Use `{{NAME}}` to personalize\n\n## Steps\n\nCreate 4-6 steps. Each step presents a decision point with 3-4 options.\n\n### Step Structure\n\n- **context**: Maximum 500 characters. Pure dialogue from a colleague setting up the decision. Conversational, no narrator.\n- **question**: Maximum 100 characters. What needs to be decided.\n- **options**: 3-4 choices, each with:\n  - **text**: The choice (max 80 characters)\n  - **consequence**: What happens as a result (max 300 characters). Shown after choosing. Explains the outcome narratively.\n  - **effects**: Array of 1-3 effects showing how this choice impacts different aspects:\n    - **dimension**: A short name for what this affects (e.g., \"Code Quality\", \"Delivery Speed\", \"Team Morale\"). Use 2-4 different dimensions across all options to create meaningful trade-offs. Important: dimensions must be consistent across all steps.\n    - **impact**: Is this `\"positive\"`, `\"neutral\"`, or `\"negative\"` for that dimension?\n\n### Option Design\n\nEvery option should:\n\n- Be a legitimate choice (no obviously wrong answers)\n- Have a clear consequence that connects to lesson concepts\n- Affect 1-3 dimensions (real decisions rarely affect just one thing)\n- Teach something about trade-offs when the consequence is revealed\n\n**No option should be universally best.** Good options might help one dimension but hurt another. This creates genuine trade-offs.\n\n## Reflection\n\nThe `reflection` field (max 500 characters) provides closing insight after all steps. It should:\n\n- Acknowledge that different approaches have merit\n- Connect the experience back to the lesson's key principles\n- Help learners understand how the concepts apply in practice\n\n## Tone & Style\n\n- **Pure dialogue**: NO narrator, NO character prefixes, NO action descriptions\n- **Natural conversation**: Colleagues working through a problem together\n- **Professional but warm**: Light humor when appropriate\n- **Second-person immersion**: The colleague speaks TO the learner\n- **Use `{{NAME}}`** to personalize dialogue\n\n## What to Avoid\n\n- **Quiz-style questions**: This tests strategic thinking, not recall\n- **Obviously correct answers**: Every option should have genuine trade-offs\n- **Narrator text**: Keep it pure dialogue in context\n- **Disconnected consequences**: Consequences should relate to lesson concepts\n- **Too many or too few dimensions**: Use 2-4 different dimension names across all effects for meaningful trade-offs\n\n## Relationship to Previous Activities\n\nThe learner has completed:\n\n- **Background**: WHY this exists\n- **Explanation**: WHAT it is\n- **Mechanics**: HOW it works\n- **Examples**: WHERE it appears\n- **Story**: WHEN to apply this\n\nYour Challenge activity is the capstone: **CAN YOU NAVIGATE THIS?** It tests whether learners can apply concepts strategically. This should feel like a meaningful simulation, not a test.\n\n# Example\n\nFor a lesson on \"Technical Debt\":\n\n**Step 1:**\n\n```json\n{\n  \"context\": \"{{NAME}}, we've got a deadline crunch. The feature works but the code is messy. Ship it now or clean it up first?\",\n  \"question\": \"How do we handle this?\",\n  \"options\": [\n    {\n      \"text\": \"Ship it now, refactor later\",\n      \"consequence\": \"Feature launched on time! But the messy code made the next sprint's work harder. The team spent extra hours untangling dependencies.\",\n      \"effects\": [\n        { \"dimension\": \"Code Quality\", \"impact\": \"negative\" },\n        { \"dimension\": \"Delivery Speed\", \"impact\": \"positive\" }\n      ]\n    },\n    {\n      \"text\": \"Take two more days to refactor\",\n      \"consequence\": \"The code is clean and maintainable. Stakeholders weren't thrilled about the delay, but future changes will be much easier.\",\n      \"effects\": [\n        { \"dimension\": \"Code Quality\", \"impact\": \"positive\" },\n        { \"dimension\": \"Delivery Speed\", \"impact\": \"negative\" }\n      ]\n    },\n    {\n      \"text\": \"Split the team — half ships, half refactors\",\n      \"consequence\": \"Shipped on time with partial cleanup. Neither task got full attention, and the team felt stretched thin.\",\n      \"effects\": [\n        { \"dimension\": \"Code Quality\", \"impact\": \"neutral\" },\n        { \"dimension\": \"Team Morale\", \"impact\": \"negative\" }\n      ]\n    }\n  ]\n}\n```\n\n# Quality Checks\n\nBefore finalizing, verify:\n\n- [ ] Does the intro establish a clear, engaging scenario?\n- [ ] Does every option have a meaningful consequence?\n- [ ] Are consequences connected to lesson principles?\n- [ ] Is there no obviously \"best\" option in each step?\n- [ ] Do options affect multiple dimensions where realistic?\n- [ ] Are dimension names consistent and lesson-relevant across all effects?\n- [ ] Is `{{NAME}}` used appropriately?\n- [ ] Is all dialogue pure conversation (no narrator)?\n- [ ] Does the reflection tie the experience back to the lesson?\n- [ ] Are all constraints met (intro ≤500, context ≤500, question ≤100, text ≤80, consequence ≤300, reflection ≤500)?\n- [ ] Is the step count between 4 and 6?\n- [ ] Does every step have 3-4 options?\n\n# Output Format\n\nReturn an object with:\n\n- **intro**: Scenario introduction (max 500 chars)\n- **steps**: Array of 4-6 step objects, each with:\n  - **context**: Pure dialogue (max 500 chars)\n  - **question**: Decision prompt (max 100 chars)\n  - **options**: Array of 3-4 objects with:\n    - **text**: Choice description (max 80 chars)\n    - **consequence**: What happens (max 300 chars)\n    - **effects**: Array of 1-3 objects with:\n      - **dimension**: Short name for what this affects (use 2-4 different dimensions total)\n      - **impact**: One of \"positive\", \"neutral\", \"negative\"\n- **reflection**: Closing insight connecting to lesson (max 500 chars)\n",
      "testCaseId": "en-biology-ecosystem-balance-1",
      "userPrompt": "LESSON_TITLE: Ecosystem Balance and Management\nLESSON_DESCRIPTION: Applying ecological principles to make informed ecosystem management decisions\nCHAPTER_TITLE: Ecosystem Dynamics\nCOURSE_TITLE: Ecology and Conservation\nLANGUAGE: en\nEXPLANATION_STEPS:\n1. Interconnected Networks: Ecosystems are interconnected networks. Removing one species affects others through food webs. Keystone species have disproportionate impact — their loss cascades through the system.\n2. Carrying Capacity: Carrying capacity is the maximum population an environment can sustain. Exceed it, and resources deplete, populations crash. Stay well below, and you're not maximizing the ecosystem's potential.\n3. Biodiversity and Resilience: Biodiversity provides resilience. More species means more ways to respond to change. Monocultures are efficient but fragile. Diverse systems are robust but complex to manage.\n4. Trophic Cascades: Trophic cascades occur when changes at one level ripple through others. Remove predators, and prey populations explode, overgrazing vegetation, affecting everything that depends on those plants.\n5. Ecological Succession: Ecological succession is the process of change over time. Pioneer species prepare the way for later ones. Managing ecosystems means deciding where in succession you want to be."
    },
    {
      "duration": 42114.35691600002,
      "inputTokens": 2161,
      "output": "{\n  \"intro\": \"Bem-vindo à planta química, {{NAME}}. Hoje é um dia crítico: precisamos otimizar nossa produção de Amônia (NH3). A reação é exotérmica e envolve redução de volume gasoso (N2 + 3H2 ⇌ 2NH3). Eu sou a Carla, sua engenheira sênior. Suas escolhas vão definir se batemos a meta de produção ou se explodimos o orçamento (ou o reator). Lembre-se: na indústria, o equilíbrio químico é uma batalha entre a química perfeita e a realidade econômica.\",\n  \"reflection\": \"Excelente trabalho no controle do processo. Você viu na prática que Le Chatelier não é apenas teoria. Aumentar a pressão e remover produtos favorece o rendimento, mas tem custos. A temperatura é um compromisso delicado entre termodinâmica (rendimento) e cinética (velocidade). E, crucialmente, catalisadores economizam tempo, não matéria-prima. O segredo industrial é encontrar o ponto ótimo onde o lucro é maximizado, não necessariamente a conversão química total.\",\n  \"steps\": [\n    {\n      \"context\": \"{{NAME}}, vamos começar com a alimentação do reator. Temos nitrogênio (N2) e hidrogênio (H2). O hidrogênio é muito mais caro para produzir. Para deslocar o equilíbrio para a direita e maximizar o uso do H2, como devemos ajustar as concentrações iniciais?\",\n      \"options\": [\n        {\n          \"consequence\": \"Boa jogada. O excesso do reagente barato (N2) empurrou o equilíbrio para consumir o reagente caro (H2). O rendimento subiu sem gastar muito.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Rendimento\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Custo\",\n              \"impact\": \"neutral\"\n            }\n          ],\n          \"text\": \"Adicionar N2 em excesso\"\n        },\n        {\n          \"consequence\": \"Proporção estequiométrica parece lógica, mas desperdiçamos oportunidade. O equilíbrio não foi forçado ao máximo, e sobrou H2 caro sem reagir.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Rendimento\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Custo\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Manter proporção exata 1:3\"\n        },\n        {\n          \"consequence\": \"Adicionar excesso de H2 deslocou o equilíbrio, sim. Mas o H2 é caríssimo! O aumento no rendimento não pagou a conta da matéria-prima desperdiçada.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Rendimento\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Custo\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Adicionar H2 em excesso\"\n        }\n      ],\n      \"question\": \"Qual estratégia de reagentes usamos?\"\n    },\n    {\n      \"context\": \"Ok, reagentes no tanque. Agora a pressão. Lembra que temos 4 mols de gás virando 2 mols. O compressor está disponível, mas operar em alta pressão gasta uma energia absurda e desgasta a tubulação. Qual nível definimos?\",\n      \"options\": [\n        {\n          \"consequence\": \"A 1000 atm, o rendimento foi espetacular, o equilíbrio foi todo para os produtos! Mas a conta de luz veio altíssima e surgiu uma rachadura numa válvula.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Rendimento\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Custo\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Pressão máxima (1000 atm)\"\n        },\n        {\n          \"consequence\": \"A 200 atm, conseguimos um rendimento decente. Não convertemos tudo, mas o equipamento está seguro e o custo de energia é pagável. O equilíbrio industrial.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Rendimento\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Custo\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Pressão moderada (200 atm)\"\n        },\n        {\n          \"consequence\": \"Em baixa pressão, o princípio de Le Chatelier jogou contra nós. O equilíbrio favoreceu os reagentes (maior volume). Produzimos quase nada.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Rendimento\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Custo\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Pressão baixa (1 atm)\"\n        }\n      ],\n      \"question\": \"Como ajustamos a pressão?\"\n    },\n    {\n      \"context\": \"A reação começou, {{NAME}}. É exotérmica (libera calor). Se deixarmos esquentar demais, o calor atua como 'produto' e empurra o equilíbrio de volta para os reagentes. Mas se esfriarmos demais, a reação fica lenta. O que fazemos com a temperatura?\",\n      \"options\": [\n        {\n          \"consequence\": \"Esfriamos o reator. Termodinamicamente perfeito: o rendimento potencial é máximo! Mas a reação está tão lenta que vamos demorar dias para encher um tanque.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Rendimento\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Velocidade\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Baixa temperatura (200°C)\"\n        },\n        {\n          \"consequence\": \"Aumentamos o fogo! A reação é rapidíssima, mas o calor excessivo deslocou o equilíbrio para a esquerda. Produzimos pouco NH3 e sobrou muito reagente.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Rendimento\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Velocidade\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Alta temperatura (700°C)\"\n        },\n        {\n          \"consequence\": \"Temperatura intermediária. Perdemos um pouco do rendimento máximo teórico, mas a velocidade é comercialmente viável. É o 'ponto ótimo'.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Rendimento\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Velocidade\",\n              \"impact\": \"neutral\"\n            }\n          ],\n          \"text\": \"Temperatura média (450°C)\"\n        }\n      ],\n      \"question\": \"Qual o ajuste térmico?\"\n    },\n    {\n      \"context\": \"Última decisão. O diretor financeiro está reclamando que o rendimento (quantidade total produzida por lote) está baixo comparado à teoria. Ele quer comprar um catalisador novo e caríssimo para 'deslocar mais o equilíbrio'. O que eu respondo?\",\n      \"options\": [\n        {\n          \"consequence\": \"Você explicou que catalisador só muda a velocidade, não a posição do equilíbrio. Economizamos milhões evitando uma compra inútil para esse fim.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Rendimento\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Custo\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Não compre. Catalisador não altera rendimento.\"\n        },\n        {\n          \"consequence\": \"Compramos. A reação atingiu o equilíbrio muito rápido! Mas a quantidade final de produto foi exatamente a mesma. O diretor está furioso com o gasto.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Velocidade\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Custo\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Compre! Vai aumentar o produto final.\"\n        },\n        {\n          \"consequence\": \"Decidimos remover o produto (NH3) conforme ele se forma, em vez de usar catalisador. Isso sim deslocou o equilíbrio para a direita continuamente!\",\n          \"effects\": [\n            {\n              \"dimension\": \"Rendimento\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Custo\",\n              \"impact\": \"neutral\"\n            }\n          ],\n          \"text\": \"Invista em remoção contínua do produto.\"\n        }\n      ],\n      \"question\": \"O catalisador resolve o rendimento?\"\n    }\n  ]\n}",
      "outputTokens": 4051,
      "systemPrompt": "# Role\n\nYou are an expert educational game designer creating a **Challenge** activity for a learning app. Your mission is to design a choose-your-own-adventure scenario where learners make strategic decisions with meaningful consequences, using the lesson's concepts.\n\nYou specialize in crafting narrative experiences that test strategic thinking — not knowledge recall, but the ability to apply concepts and understand trade-offs.\n\n# Why Narrative Challenges Work\n\nGreat challenges don't quiz — they immerse. Learners face realistic scenarios where every choice has consequences. They experience trade-offs firsthand, making the lesson's principles memorable.\n\n- **No \"Right Answer\"**: Every option has pros and cons. Learners engage with WHY, not just WHAT.\n- **Consequences Over Scores**: Instead of winning or losing, learners see the natural results of their choices.\n- **Strategic Thinking**: Understanding the lesson helps navigate trade-offs, but different strategies lead to different outcomes.\n\n# Inputs\n\n- `LESSON_TITLE`: The topic to create a challenge around\n- `LESSON_DESCRIPTION`: Additional context about what this lesson covers\n- `CHAPTER_TITLE`: The chapter context (for understanding scope)\n- `COURSE_TITLE`: The course context (for understanding audience level)\n- `LANGUAGE`: Output language\n- `EXPLANATION_STEPS`: What the learner has already studied\n\n## Language Guidelines\n\n- `en`: Use US English unless the content is region-specific\n- `pt`: Use Brazilian Portuguese unless the content is region-specific\n- `es`: Use Latin American Spanish unless the content is region-specific\n\n# Requirements\n\n## Introduction\n\nThe `intro` field sets the scene (max 500 characters). It should:\n\n- Establish the scenario and the learner's role\n- Explain what they're navigating (a project, situation, decision-making process)\n- Create stakes that feel meaningful\n- Use `{{NAME}}` to personalize\n\n## Steps\n\nCreate 4-6 steps. Each step presents a decision point with 3-4 options.\n\n### Step Structure\n\n- **context**: Maximum 500 characters. Pure dialogue from a colleague setting up the decision. Conversational, no narrator.\n- **question**: Maximum 100 characters. What needs to be decided.\n- **options**: 3-4 choices, each with:\n  - **text**: The choice (max 80 characters)\n  - **consequence**: What happens as a result (max 300 characters). Shown after choosing. Explains the outcome narratively.\n  - **effects**: Array of 1-3 effects showing how this choice impacts different aspects:\n    - **dimension**: A short name for what this affects (e.g., \"Code Quality\", \"Delivery Speed\", \"Team Morale\"). Use 2-4 different dimensions across all options to create meaningful trade-offs. Important: dimensions must be consistent across all steps.\n    - **impact**: Is this `\"positive\"`, `\"neutral\"`, or `\"negative\"` for that dimension?\n\n### Option Design\n\nEvery option should:\n\n- Be a legitimate choice (no obviously wrong answers)\n- Have a clear consequence that connects to lesson concepts\n- Affect 1-3 dimensions (real decisions rarely affect just one thing)\n- Teach something about trade-offs when the consequence is revealed\n\n**No option should be universally best.** Good options might help one dimension but hurt another. This creates genuine trade-offs.\n\n## Reflection\n\nThe `reflection` field (max 500 characters) provides closing insight after all steps. It should:\n\n- Acknowledge that different approaches have merit\n- Connect the experience back to the lesson's key principles\n- Help learners understand how the concepts apply in practice\n\n## Tone & Style\n\n- **Pure dialogue**: NO narrator, NO character prefixes, NO action descriptions\n- **Natural conversation**: Colleagues working through a problem together\n- **Professional but warm**: Light humor when appropriate\n- **Second-person immersion**: The colleague speaks TO the learner\n- **Use `{{NAME}}`** to personalize dialogue\n\n## What to Avoid\n\n- **Quiz-style questions**: This tests strategic thinking, not recall\n- **Obviously correct answers**: Every option should have genuine trade-offs\n- **Narrator text**: Keep it pure dialogue in context\n- **Disconnected consequences**: Consequences should relate to lesson concepts\n- **Too many or too few dimensions**: Use 2-4 different dimension names across all effects for meaningful trade-offs\n\n## Relationship to Previous Activities\n\nThe learner has completed:\n\n- **Background**: WHY this exists\n- **Explanation**: WHAT it is\n- **Mechanics**: HOW it works\n- **Examples**: WHERE it appears\n- **Story**: WHEN to apply this\n\nYour Challenge activity is the capstone: **CAN YOU NAVIGATE THIS?** It tests whether learners can apply concepts strategically. This should feel like a meaningful simulation, not a test.\n\n# Example\n\nFor a lesson on \"Technical Debt\":\n\n**Step 1:**\n\n```json\n{\n  \"context\": \"{{NAME}}, we've got a deadline crunch. The feature works but the code is messy. Ship it now or clean it up first?\",\n  \"question\": \"How do we handle this?\",\n  \"options\": [\n    {\n      \"text\": \"Ship it now, refactor later\",\n      \"consequence\": \"Feature launched on time! But the messy code made the next sprint's work harder. The team spent extra hours untangling dependencies.\",\n      \"effects\": [\n        { \"dimension\": \"Code Quality\", \"impact\": \"negative\" },\n        { \"dimension\": \"Delivery Speed\", \"impact\": \"positive\" }\n      ]\n    },\n    {\n      \"text\": \"Take two more days to refactor\",\n      \"consequence\": \"The code is clean and maintainable. Stakeholders weren't thrilled about the delay, but future changes will be much easier.\",\n      \"effects\": [\n        { \"dimension\": \"Code Quality\", \"impact\": \"positive\" },\n        { \"dimension\": \"Delivery Speed\", \"impact\": \"negative\" }\n      ]\n    },\n    {\n      \"text\": \"Split the team — half ships, half refactors\",\n      \"consequence\": \"Shipped on time with partial cleanup. Neither task got full attention, and the team felt stretched thin.\",\n      \"effects\": [\n        { \"dimension\": \"Code Quality\", \"impact\": \"neutral\" },\n        { \"dimension\": \"Team Morale\", \"impact\": \"negative\" }\n      ]\n    }\n  ]\n}\n```\n\n# Quality Checks\n\nBefore finalizing, verify:\n\n- [ ] Does the intro establish a clear, engaging scenario?\n- [ ] Does every option have a meaningful consequence?\n- [ ] Are consequences connected to lesson principles?\n- [ ] Is there no obviously \"best\" option in each step?\n- [ ] Do options affect multiple dimensions where realistic?\n- [ ] Are dimension names consistent and lesson-relevant across all effects?\n- [ ] Is `{{NAME}}` used appropriately?\n- [ ] Is all dialogue pure conversation (no narrator)?\n- [ ] Does the reflection tie the experience back to the lesson?\n- [ ] Are all constraints met (intro ≤500, context ≤500, question ≤100, text ≤80, consequence ≤300, reflection ≤500)?\n- [ ] Is the step count between 4 and 6?\n- [ ] Does every step have 3-4 options?\n\n# Output Format\n\nReturn an object with:\n\n- **intro**: Scenario introduction (max 500 chars)\n- **steps**: Array of 4-6 step objects, each with:\n  - **context**: Pure dialogue (max 500 chars)\n  - **question**: Decision prompt (max 100 chars)\n  - **options**: Array of 3-4 objects with:\n    - **text**: Choice description (max 80 chars)\n    - **consequence**: What happens (max 300 chars)\n    - **effects**: Array of 1-3 objects with:\n      - **dimension**: Short name for what this affects (use 2-4 different dimensions total)\n      - **impact**: One of \"positive\", \"neutral\", \"negative\"\n- **reflection**: Closing insight connecting to lesson (max 500 chars)\n",
      "testCaseId": "pt-chemistry-reaction-equilibrium-1",
      "userPrompt": "LESSON_TITLE: Equilibrio Quimico na Pratica\nLESSON_DESCRIPTION: Aplicando o principio de Le Chatelier para otimizar reacoes quimicas e processos industriais\nCHAPTER_TITLE: Equilibrio Quimico\nCOURSE_TITLE: Quimica Geral II\nLANGUAGE: pt\nEXPLANATION_STEPS:\n1. Principio de Le Chatelier: O principio de Le Chatelier diz que um sistema em equilibrio responde a perturbacoes minimizando a mudanca. Adicione reagente, o equilibrio desloca para consumir esse reagente.\n2. Efeito da Concentracao: Mudancas de concentracao deslocam o equilibrio. Adicionar reagentes desloca para produtos. Remover produtos tambem desloca para produtos. O sistema busca restaurar o equilibrio.\n3. Efeito da Pressao: A pressao afeta equilibrios gasosos. Aumentar pressao favorece o lado com menos moles de gas. Diminuir pressao favorece o lado com mais moles. Gases inertes nao afetam.\n4. Efeito da Temperatura: Temperatura e diferente — ela muda a constante de equilibrio. Reacoes exotermicas: aumento de temperatura desloca para reagentes. Reacoes endotermicas: aumento favorece produtos.\n5. Papel dos Catalisadores: Catalisadores aceleram ambas as direcoes igualmente. Eles nao deslocam o equilibrio — apenas ajudam a alcancar o equilibrio mais rapido. Util para processos industriais."
    },
    {
      "duration": 41020.32837499998,
      "inputTokens": 2162,
      "output": "{\n  \"intro\": \"Hola {{NAME}}, eres el ingeniero jefe del nuevo Eco-Resort 'Cumbres Verdes'. El sitio es remoto y no hay red eléctrica. El dueño quiere un sistema sostenible, pero tenemos un presupuesto límite y las leyes de la termodinámica no perdonan. Cada conversión de energía que elijamos tendrá un costo en eficiencia o dinero. Tus decisiones determinarán si este proyecto es un modelo de ingeniería o un fracaso costoso. ¿Empezamos?\",\n  \"reflection\": \"Has completado el diseño. Como viste, no existe la 'energía gratis'. Cada vez que transformamos o almacenamos energía, pagamos un 'impuesto' termodinámico en forma de calor y pérdidas. La ingeniería real no se trata de buscar la perfección teórica, sino de gestionar esas pérdidas para encontrar el equilibrio óptimo entre eficiencia, costo y sostenibilidad. ¡Buen trabajo navegando estos compromisos!\",\n  \"steps\": [\n    {\n      \"context\": \"{{NAME}}, necesitamos decidir la fuente principal. Los generadores diésel tienen alta densidad energética y son baratos de instalar, pero su eficiencia térmica es baja. Los paneles solares son limpios, pero la densidad es baja y necesitamos muchas hectáreas. ¿Qué priorizamos para la carga base?\",\n      \"options\": [\n        {\n          \"consequence\": \"Instalamos diésel. Es barato y potente, pero ruidoso. Solo aprovechamos el 35% de la energía del combustible; el resto se pierde como calor y humo.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Eficiencia del Sistema\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Presupuesto\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Sostenibilidad\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Generadores Diésel modernos\"\n        },\n        {\n          \"consequence\": \"El campo solar es enorme y caro, pero la energía operativa es 'gratis'. Sin embargo, la conversión de luz a electricidad solo tiene una eficiencia del 20%.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Presupuesto\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Sostenibilidad\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Gran campo fotovoltaico\"\n        },\n        {\n          \"consequence\": \"Aprovechamos el río cercano. La eficiencia mecánica es alta (90%), pero la obra civil para la tubería de presión elevó los costos iniciales significativamente.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Eficiencia del Sistema\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Presupuesto\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Sostenibilidad\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Micro-hidroeléctrica\"\n        }\n      ],\n      \"question\": \"¿Cuál será nuestra fuente primaria?\"\n    },\n    {\n      \"context\": \"Bien, ahora la distribución. Las cabañas están muy dispersas. Si usamos corriente alterna (AC) estándar, perderemos energía en los transformadores. Si usamos corriente continua (DC), evitamos inversores, pero las pérdidas por resistencia en los cables aumentan con la distancia.\",\n      \"options\": [\n        {\n          \"consequence\": \"Usamos AC estándar. Es barato y compatible con todo, pero cada inversor y transformador se come un 5-10% de energía en calor residual.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Eficiencia del Sistema\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Presupuesto\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Red AC estándar (220V)\"\n        },\n        {\n          \"consequence\": \"Elegimos DC de alto voltaje. Minimizamos conversiones AC/DC, haciendo el sistema muy eficiente, pero los equipos especializados nos costaron una fortuna.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Eficiencia del Sistema\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Presupuesto\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Micro-red DC inteligente\"\n        },\n        {\n          \"consequence\": \"Cableado barato en DC de bajo voltaje. Fue un error. La resistencia eléctrica en las distancias largas disipó mucha energía como calor. Los focos apenas alumbran al final.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Eficiencia del Sistema\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Presupuesto\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Red DC de bajo voltaje\"\n        }\n      ],\n      \"question\": \"¿Cómo llevamos la electricidad a las cabañas?\"\n    },\n    {\n      \"context\": \"Llega la noche, {{NAME}}. Necesitamos almacenamiento. Las baterías de litio son eficientes pero caras. Podríamos bombear agua a un tanque elevado durante el día y soltarla de noche, pero la conversión de energía eléctrica a potencial y viceversa tiene pérdidas.\",\n      \"options\": [\n        {\n          \"consequence\": \"Baterías de Litio. Retenemos el 95% de la energía guardada. Excelente rendimiento técnico, pero el presupuesto del proyecto se ha quedado temblando.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Eficiencia del Sistema\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Presupuesto\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Banco de baterías de Litio\"\n        },\n        {\n          \"consequence\": \"Bombeo hidráulico. Funciona, pero perdemos el 30% de la energía en fricción y turbulencia al subir y bajar el agua. Es sostenible y barato a largo plazo.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Eficiencia del Sistema\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Sostenibilidad\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Almacenamiento por bombeo\"\n        },\n        {\n          \"consequence\": \"Hidrógeno verde. Convertimos electricidad en gas H2. La densidad energética es brutal, pero la eficiencia del ciclo completo es terrible (apenas 40%). Mucha energía perdida.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Eficiencia del Sistema\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Sostenibilidad\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Celdas de Hidrógeno\"\n        }\n      ],\n      \"question\": \"¿Cómo almacenamos la energía para la noche?\"\n    },\n    {\n      \"context\": \"Hace frío en la montaña. Los huéspedes quieren agua caliente. Calentar agua con resistencias eléctricas es 100% eficiente convirtiendo electricidad, pero usar electricidad de baterías es un 'lujo' termodinámico. ¿Qué sistema instalamos?\",\n      \"options\": [\n        {\n          \"consequence\": \"Calentadores eléctricos directos. Eficientes en conversión, pero agotan nuestras baterías rápidamente. Convertir energía química a eléctrica para volver a calor es un desperdicio de calidad.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Eficiencia del Sistema\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Presupuesto\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Resistencias eléctricas baratas\"\n        },\n        {\n          \"consequence\": \"Bombas de calor. Mueven calor del aire exterior al agua. Por cada 1 kW de electricidad, obtenemos 3 kW de calor. ¡Mágicamente eficiente, aunque la inversión inicial duele!\",\n          \"effects\": [\n            {\n              \"dimension\": \"Eficiencia del Sistema\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Presupuesto\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Bombas de calor aerotérmicas\"\n        },\n        {\n          \"consequence\": \"Colectores solares térmicos. Usan el sol directamente para calentar agua. Eficiencia altísima y cero uso de baterías, pero necesitamos un tanque de respaldo para días nublados.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Sostenibilidad\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Presupuesto\",\n              \"impact\": \"neutral\"\n            }\n          ],\n          \"text\": \"Solar térmica directa\"\n        }\n      ],\n      \"question\": \"¿Cuál es la mejor estrategia térmica?\"\n    },\n    {\n      \"context\": \"Último paso, {{NAME}}. A veces la demanda supera nuestra capacidad (todos encienden secadores de pelo a la vez). Sobredimensionar todo el sistema para esos 15 minutos es carísimo e ineficiente. ¿Cómo manejamos los picos?\",\n      \"options\": [\n        {\n          \"consequence\": \"Sobredimensionamos todo. Tenemos capacidad de sobra que no se usa el 99% del tiempo. Una inversión de capital masiva con un retorno de inversión pésimo.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Presupuesto\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Eficiencia del Sistema\",\n              \"impact\": \"neutral\"\n            }\n          ],\n          \"text\": \"Construir para el pico máximo\"\n        },\n        {\n          \"consequence\": \"Generador de respaldo pequeño. Se enciende solo en picos. Quema combustible y es ineficiente, pero salvamos el presupuesto evitando baterías gigantes.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Sostenibilidad\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Presupuesto\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Apoyo diésel puntual\"\n        },\n        {\n          \"consequence\": \"Gestión de carga inteligente. El sistema apaga automáticamente cargas no esenciales (lavandería, bombas piscina) durante los picos. Eficiencia pura sin costo extra.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Eficiencia del Sistema\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Sostenibilidad\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Deslastre de carga automático\"\n        }\n      ],\n      \"question\": \"¿Estrategia para picos de demanda?\"\n    }\n  ]\n}",
      "outputTokens": 4332,
      "systemPrompt": "# Role\n\nYou are an expert educational game designer creating a **Challenge** activity for a learning app. Your mission is to design a choose-your-own-adventure scenario where learners make strategic decisions with meaningful consequences, using the lesson's concepts.\n\nYou specialize in crafting narrative experiences that test strategic thinking — not knowledge recall, but the ability to apply concepts and understand trade-offs.\n\n# Why Narrative Challenges Work\n\nGreat challenges don't quiz — they immerse. Learners face realistic scenarios where every choice has consequences. They experience trade-offs firsthand, making the lesson's principles memorable.\n\n- **No \"Right Answer\"**: Every option has pros and cons. Learners engage with WHY, not just WHAT.\n- **Consequences Over Scores**: Instead of winning or losing, learners see the natural results of their choices.\n- **Strategic Thinking**: Understanding the lesson helps navigate trade-offs, but different strategies lead to different outcomes.\n\n# Inputs\n\n- `LESSON_TITLE`: The topic to create a challenge around\n- `LESSON_DESCRIPTION`: Additional context about what this lesson covers\n- `CHAPTER_TITLE`: The chapter context (for understanding scope)\n- `COURSE_TITLE`: The course context (for understanding audience level)\n- `LANGUAGE`: Output language\n- `EXPLANATION_STEPS`: What the learner has already studied\n\n## Language Guidelines\n\n- `en`: Use US English unless the content is region-specific\n- `pt`: Use Brazilian Portuguese unless the content is region-specific\n- `es`: Use Latin American Spanish unless the content is region-specific\n\n# Requirements\n\n## Introduction\n\nThe `intro` field sets the scene (max 500 characters). It should:\n\n- Establish the scenario and the learner's role\n- Explain what they're navigating (a project, situation, decision-making process)\n- Create stakes that feel meaningful\n- Use `{{NAME}}` to personalize\n\n## Steps\n\nCreate 4-6 steps. Each step presents a decision point with 3-4 options.\n\n### Step Structure\n\n- **context**: Maximum 500 characters. Pure dialogue from a colleague setting up the decision. Conversational, no narrator.\n- **question**: Maximum 100 characters. What needs to be decided.\n- **options**: 3-4 choices, each with:\n  - **text**: The choice (max 80 characters)\n  - **consequence**: What happens as a result (max 300 characters). Shown after choosing. Explains the outcome narratively.\n  - **effects**: Array of 1-3 effects showing how this choice impacts different aspects:\n    - **dimension**: A short name for what this affects (e.g., \"Code Quality\", \"Delivery Speed\", \"Team Morale\"). Use 2-4 different dimensions across all options to create meaningful trade-offs. Important: dimensions must be consistent across all steps.\n    - **impact**: Is this `\"positive\"`, `\"neutral\"`, or `\"negative\"` for that dimension?\n\n### Option Design\n\nEvery option should:\n\n- Be a legitimate choice (no obviously wrong answers)\n- Have a clear consequence that connects to lesson concepts\n- Affect 1-3 dimensions (real decisions rarely affect just one thing)\n- Teach something about trade-offs when the consequence is revealed\n\n**No option should be universally best.** Good options might help one dimension but hurt another. This creates genuine trade-offs.\n\n## Reflection\n\nThe `reflection` field (max 500 characters) provides closing insight after all steps. It should:\n\n- Acknowledge that different approaches have merit\n- Connect the experience back to the lesson's key principles\n- Help learners understand how the concepts apply in practice\n\n## Tone & Style\n\n- **Pure dialogue**: NO narrator, NO character prefixes, NO action descriptions\n- **Natural conversation**: Colleagues working through a problem together\n- **Professional but warm**: Light humor when appropriate\n- **Second-person immersion**: The colleague speaks TO the learner\n- **Use `{{NAME}}`** to personalize dialogue\n\n## What to Avoid\n\n- **Quiz-style questions**: This tests strategic thinking, not recall\n- **Obviously correct answers**: Every option should have genuine trade-offs\n- **Narrator text**: Keep it pure dialogue in context\n- **Disconnected consequences**: Consequences should relate to lesson concepts\n- **Too many or too few dimensions**: Use 2-4 different dimension names across all effects for meaningful trade-offs\n\n## Relationship to Previous Activities\n\nThe learner has completed:\n\n- **Background**: WHY this exists\n- **Explanation**: WHAT it is\n- **Mechanics**: HOW it works\n- **Examples**: WHERE it appears\n- **Story**: WHEN to apply this\n\nYour Challenge activity is the capstone: **CAN YOU NAVIGATE THIS?** It tests whether learners can apply concepts strategically. This should feel like a meaningful simulation, not a test.\n\n# Example\n\nFor a lesson on \"Technical Debt\":\n\n**Step 1:**\n\n```json\n{\n  \"context\": \"{{NAME}}, we've got a deadline crunch. The feature works but the code is messy. Ship it now or clean it up first?\",\n  \"question\": \"How do we handle this?\",\n  \"options\": [\n    {\n      \"text\": \"Ship it now, refactor later\",\n      \"consequence\": \"Feature launched on time! But the messy code made the next sprint's work harder. The team spent extra hours untangling dependencies.\",\n      \"effects\": [\n        { \"dimension\": \"Code Quality\", \"impact\": \"negative\" },\n        { \"dimension\": \"Delivery Speed\", \"impact\": \"positive\" }\n      ]\n    },\n    {\n      \"text\": \"Take two more days to refactor\",\n      \"consequence\": \"The code is clean and maintainable. Stakeholders weren't thrilled about the delay, but future changes will be much easier.\",\n      \"effects\": [\n        { \"dimension\": \"Code Quality\", \"impact\": \"positive\" },\n        { \"dimension\": \"Delivery Speed\", \"impact\": \"negative\" }\n      ]\n    },\n    {\n      \"text\": \"Split the team — half ships, half refactors\",\n      \"consequence\": \"Shipped on time with partial cleanup. Neither task got full attention, and the team felt stretched thin.\",\n      \"effects\": [\n        { \"dimension\": \"Code Quality\", \"impact\": \"neutral\" },\n        { \"dimension\": \"Team Morale\", \"impact\": \"negative\" }\n      ]\n    }\n  ]\n}\n```\n\n# Quality Checks\n\nBefore finalizing, verify:\n\n- [ ] Does the intro establish a clear, engaging scenario?\n- [ ] Does every option have a meaningful consequence?\n- [ ] Are consequences connected to lesson principles?\n- [ ] Is there no obviously \"best\" option in each step?\n- [ ] Do options affect multiple dimensions where realistic?\n- [ ] Are dimension names consistent and lesson-relevant across all effects?\n- [ ] Is `{{NAME}}` used appropriately?\n- [ ] Is all dialogue pure conversation (no narrator)?\n- [ ] Does the reflection tie the experience back to the lesson?\n- [ ] Are all constraints met (intro ≤500, context ≤500, question ≤100, text ≤80, consequence ≤300, reflection ≤500)?\n- [ ] Is the step count between 4 and 6?\n- [ ] Does every step have 3-4 options?\n\n# Output Format\n\nReturn an object with:\n\n- **intro**: Scenario introduction (max 500 chars)\n- **steps**: Array of 4-6 step objects, each with:\n  - **context**: Pure dialogue (max 500 chars)\n  - **question**: Decision prompt (max 100 chars)\n  - **options**: Array of 3-4 objects with:\n    - **text**: Choice description (max 80 chars)\n    - **consequence**: What happens (max 300 chars)\n    - **effects**: Array of 1-3 objects with:\n      - **dimension**: Short name for what this affects (use 2-4 different dimensions total)\n      - **impact**: One of \"positive\", \"neutral\", \"negative\"\n- **reflection**: Closing insight connecting to lesson (max 500 chars)\n",
      "testCaseId": "es-physics-energy-conservation-1",
      "userPrompt": "LESSON_TITLE: Conservacion de Energia en Sistemas Reales\nLESSON_DESCRIPTION: Aplicando principios de conservacion de energia para disenar y optimizar sistemas energeticos\nCHAPTER_TITLE: Energia y Trabajo\nCOURSE_TITLE: Fisica Aplicada\nLANGUAGE: es\nEXPLANATION_STEPS:\n1. Conservacion de la Energia: La energia no se crea ni se destruye, solo se transforma. En cada conversion, la energia total se conserva, pero la energia util disminuye. Parte siempre se convierte en calor no aprovechable.\n2. Eficiencia Energetica: La eficiencia mide cuanta energia de entrada se convierte en trabajo util. Ningun proceso es 100% eficiente — siempre hay perdidas. La segunda ley de la termodinamica lo garantiza.\n3. Perdidas en Cadena: Las cadenas de conversion acumulan perdidas. Si cada paso es 90% eficiente, tres pasos dan 0.9³ = 73% eficiencia total. Menos conversiones significa menos perdidas.\n4. Costo del Almacenamiento: El almacenamiento de energia tiene su propio costo energetico. Cargar y descargar baterias pierde energia. Bombear agua cuesta arriba para hidroelectrica tambien. El almacenamiento no es gratis.\n5. Densidad Energetica: La densidad energetica importa. Combustibles fosiles almacenan mucha energia por kilogramo. Las baterias almacenan menos. Esto afecta que es practico para cada aplicacion."
    }
  ],
  "taskId": "activity-challenge"
}
