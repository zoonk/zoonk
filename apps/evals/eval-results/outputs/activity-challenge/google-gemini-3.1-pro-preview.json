{
  "generatedAt": "2026-02-21T22:56:15.478Z",
  "modelId": "google/gemini-3.1-pro-preview",
  "outputs": [
    {
      "duration": 53642.85612499993,
      "inputTokens": 2144,
      "output": "{\n  \"intro\": \"You are the lead architect for a rapidly growing e-commerce platform, {{NAME}}. As Black Friday approaches, the system is struggling under the load. You must make critical engineering decisions to optimize the codebase. Every choice involves trading off speed, memory, or stability. Can you balance the system?\",\n  \"reflection\": \"Algorithm design is rarely about finding a flawless solution; it's about choosing the right compromises. As you experienced, optimizing for speed often costs memory, and planning for the worst case can impact average performance. Understanding these constraints makes you a strategic engineer.\",\n  \"steps\": [\n    {\n      \"context\": \"{{NAME}}, the new product search is way too slow. Users are waiting seconds for autocomplete suggestions. We have a million products now. We can precompute the suggestions, but I'm worried about maxing out the server RAM.\",\n      \"options\": [\n        {\n          \"consequence\": \"Lightning-fast suggestions! But the structure consumed a massive chunk of RAM, triggering an alert from ops. We had to quickly provision more expensive servers.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Time Performance\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Space Efficiency\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Build a Trie in memory for O(1) prefix lookups\"\n        },\n        {\n          \"consequence\": \"Memory stays low, but the database is getting hammered under heavy load. It's slower for users, but the infrastructure manages to stay upright without crashing.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Time Performance\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Space Efficiency\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Query the database directly using indexed columns\"\n        },\n        {\n          \"consequence\": \"The most popular searches are instant with a minimal memory hit. Rare items still take a bit longer to load, but it's a solid middle ground.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Time Performance\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"System Stability\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Cache the top 10,000 most searched prefixes only\"\n        }\n      ],\n      \"question\": \"How should we optimize the search autocomplete?\"\n    },\n    {\n      \"context\": \"Hey {{NAME}}, the nightly analytics job is failing. It sorts the daily transaction logs, but sometimes the data is already mostly sorted, and occasionally it's completely randomized. Which sorting approach do we drop in?\",\n      \"options\": [\n        {\n          \"consequence\": \"Usually blazing fast, but on days when the logs are already sorted, it hits its worst-case O(n²) time and completely misses the reporting deadline.\",\n          \"effects\": [\n            {\n              \"dimension\": \"System Stability\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Time Performance\",\n              \"impact\": \"neutral\"\n            }\n          ],\n          \"text\": \"Use Quicksort for its excellent average-case speed\"\n        },\n        {\n          \"consequence\": \"The job always finishes on time regardless of the data distribution! However, it requires allocating massive temporary arrays, spiking our memory usage every night.\",\n          \"effects\": [\n            {\n              \"dimension\": \"System Stability\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Space Efficiency\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Use Merge Sort for guaranteed O(n log n) time\"\n        },\n        {\n          \"consequence\": \"It flies through mostly sorted days with zero extra memory, but crawls to an absolute halt when the data is highly randomized.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Space Efficiency\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Time Performance\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Use Insertion Sort since it's fast on sorted data\"\n        }\n      ],\n      \"question\": \"Which sorting algorithm fits our unpredictable data distribution?\"\n    },\n    {\n      \"context\": \"We're storing user activity feeds in dynamic arrays. Most appends are fast, but {{NAME}}, when the array resizes, the app freezes for a second copying data. Users are constantly complaining about the lag spikes.\",\n      \"options\": [\n        {\n          \"consequence\": \"Amortized time stays O(1) and freezes happen far less often, but when they do, they are severe. Plus, we're wasting a lot of allocated but unused memory for dormant users.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Space Efficiency\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"System Stability\",\n              \"impact\": \"neutral\"\n            }\n          ],\n          \"text\": \"Double the array capacity on every resize\"\n        },\n        {\n          \"consequence\": \"Appends are now strictly O(1) with no resize freezes! But accessing specific older feed items now requires traversing the list, slowing down page loads drastically.\",\n          \"effects\": [\n            {\n              \"dimension\": \"System Stability\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Time Performance\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Switch the data structure to a Linked List\"\n        },\n        {\n          \"consequence\": \"Memory waste is minimized, but the array has to resize constantly. The amortized time degrades, and the app feels universally sluggish for everyone.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Space Efficiency\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Time Performance\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Increase capacity by a fixed small chunk instead\"\n        }\n      ],\n      \"question\": \"How do we fix the dynamic array resizing lag?\"\n    },\n    {\n      \"context\": \"{{NAME}}, the fraud detection service needs to check if incoming IP addresses are in our blacklist of 50 million IPs. We need this check to be virtually instant, but we're running incredibly tight on cache memory.\",\n      \"options\": [\n        {\n          \"consequence\": \"Lookups are strictly O(1) and perfectly accurate, but storing 50 million full IP strings blew out our cache limits, forcing us to drop other important application data.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Time Performance\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Space Efficiency\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Use a Hash Set for instant lookups\"\n        },\n        {\n          \"consequence\": \"Extremely memory efficient and fast! We occasionally get false positives and have to do a slower database check, but it scales perfectly within our memory limits.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Space Efficiency\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"System Stability\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Use a Bloom Filter to test for membership\"\n        },\n        {\n          \"consequence\": \"No extra memory needed beyond the array itself. But O(log n) lookups on 50 million records add just enough latency to cause bottlenecks during peak Black Friday traffic.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Space Efficiency\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Time Performance\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Sort the IPs and use Binary Search\"\n        }\n      ],\n      \"question\": \"How should we store and check the IP blacklist?\"\n    },\n    {\n      \"context\": \"The new global sales leaderboard is live, {{NAME}}. Right now, it recalculates everyone's rank by scanning the whole database every time a sale is made. It's an O(n) operation and the DB is starting to lock up.\",\n      \"options\": [\n        {\n          \"consequence\": \"Updates and lookups are balanced and fast. It took some complex engineering to implement the tree structure, but the database load is finally manageable.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Time Performance\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"System Stability\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Keep an ordered balanced tree of scores\"\n        },\n        {\n          \"consequence\": \"System load completely vanished! But users are furious that their rankings aren't real-time anymore, significantly hurting engagement during the promotion.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Time Performance\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"System Stability\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Batch updates and recalculate once per hour\"\n        },\n        {\n          \"consequence\": \"O(1) updates! But allocating an array for millions of possible score values ate up a ridiculous amount of RAM for mostly empty slots.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Time Performance\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Space Efficiency\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Preallocate an array with every possible score\"\n        }\n      ],\n      \"question\": \"How do we optimize the leaderboard ranking?\"\n    }\n  ]\n}",
      "outputTokens": 4459,
      "systemPrompt": "# Role\n\nYou are an expert educational game designer creating a **Challenge** activity for a learning app. Your mission is to design a choose-your-own-adventure scenario where learners make strategic decisions with meaningful consequences, using the lesson's concepts.\n\nYou specialize in crafting narrative experiences that test strategic thinking — not knowledge recall, but the ability to apply concepts and understand trade-offs.\n\n# Why Narrative Challenges Work\n\nGreat challenges don't quiz — they immerse. Learners face realistic scenarios where every choice has consequences. They experience trade-offs firsthand, making the lesson's principles memorable.\n\n- **No \"Right Answer\"**: Every option has pros and cons. Learners engage with WHY, not just WHAT.\n- **Consequences Over Scores**: Instead of winning or losing, learners see the natural results of their choices.\n- **Strategic Thinking**: Understanding the lesson helps navigate trade-offs, but different strategies lead to different outcomes.\n\n# Inputs\n\n- `LESSON_TITLE`: The topic to create a challenge around\n- `LESSON_DESCRIPTION`: Additional context about what this lesson covers\n- `CHAPTER_TITLE`: The chapter context (for understanding scope)\n- `COURSE_TITLE`: The course context (for understanding audience level)\n- `LANGUAGE`: Output language\n- `EXPLANATION_STEPS`: What the learner has already studied\n\n## Language Guidelines\n\n- `en`: Use US English unless the content is region-specific\n- `pt`: Use Brazilian Portuguese unless the content is region-specific\n- `es`: Use Latin American Spanish unless the content is region-specific\n\n# Requirements\n\n## Introduction\n\nThe `intro` field sets the scene (max 500 characters). It should:\n\n- Establish the scenario and the learner's role\n- Explain what they're navigating (a project, situation, decision-making process)\n- Create stakes that feel meaningful\n- Use `{{NAME}}` to personalize\n\n## Steps\n\nCreate 4-6 steps. Each step presents a decision point with 3-4 options.\n\n### Step Structure\n\n- **context**: Maximum 500 characters. Pure dialogue from a colleague setting up the decision. Conversational, no narrator.\n- **question**: Maximum 100 characters. What needs to be decided.\n- **options**: 3-4 choices, each with:\n  - **text**: The choice (max 80 characters)\n  - **consequence**: What happens as a result (max 300 characters). Shown after choosing. Explains the outcome narratively.\n  - **effects**: Array of 1-3 effects showing how this choice impacts different aspects:\n    - **dimension**: A short name for what this affects (e.g., \"Code Quality\", \"Delivery Speed\", \"Team Morale\"). Use 2-4 different dimensions across all options to create meaningful trade-offs. Important: dimensions must be consistent across all steps.\n    - **impact**: Is this `\"positive\"`, `\"neutral\"`, or `\"negative\"` for that dimension?\n\n### Option Design\n\nEvery option should:\n\n- Be a legitimate choice (no obviously wrong answers)\n- Have a clear consequence that connects to lesson concepts\n- Affect 1-3 dimensions (real decisions rarely affect just one thing)\n- Teach something about trade-offs when the consequence is revealed\n\n**No option should be universally best.** Good options might help one dimension but hurt another. This creates genuine trade-offs.\n\n## Reflection\n\nThe `reflection` field (max 500 characters) provides closing insight after all steps. It should:\n\n- Acknowledge that different approaches have merit\n- Connect the experience back to the lesson's key principles\n- Help learners understand how the concepts apply in practice\n\n## Tone & Style\n\n- **Pure dialogue**: NO narrator, NO character prefixes, NO action descriptions\n- **Natural conversation**: Colleagues working through a problem together\n- **Professional but warm**: Light humor when appropriate\n- **Second-person immersion**: The colleague speaks TO the learner\n- **Use `{{NAME}}`** to personalize dialogue\n\n## What to Avoid\n\n- **Quiz-style questions**: This tests strategic thinking, not recall\n- **Obviously correct answers**: Every option should have genuine trade-offs\n- **Narrator text**: Keep it pure dialogue in context\n- **Disconnected consequences**: Consequences should relate to lesson concepts\n- **Too many or too few dimensions**: Use 2-4 different dimension names across all effects for meaningful trade-offs\n\n## Relationship to Previous Activities\n\nThe learner has completed:\n\n- **Background**: WHY this exists\n- **Explanation**: WHAT it is\n- **Mechanics**: HOW it works\n- **Examples**: WHERE it appears\n- **Story**: WHEN to apply this\n\nYour Challenge activity is the capstone: **CAN YOU NAVIGATE THIS?** It tests whether learners can apply concepts strategically. This should feel like a meaningful simulation, not a test.\n\n# Example\n\nFor a lesson on \"Technical Debt\":\n\n**Step 1:**\n\n```json\n{\n  \"context\": \"{{NAME}}, we've got a deadline crunch. The feature works but the code is messy. Ship it now or clean it up first?\",\n  \"question\": \"How do we handle this?\",\n  \"options\": [\n    {\n      \"text\": \"Ship it now, refactor later\",\n      \"consequence\": \"Feature launched on time! But the messy code made the next sprint's work harder. The team spent extra hours untangling dependencies.\",\n      \"effects\": [\n        { \"dimension\": \"Code Quality\", \"impact\": \"negative\" },\n        { \"dimension\": \"Delivery Speed\", \"impact\": \"positive\" }\n      ]\n    },\n    {\n      \"text\": \"Take two more days to refactor\",\n      \"consequence\": \"The code is clean and maintainable. Stakeholders weren't thrilled about the delay, but future changes will be much easier.\",\n      \"effects\": [\n        { \"dimension\": \"Code Quality\", \"impact\": \"positive\" },\n        { \"dimension\": \"Delivery Speed\", \"impact\": \"negative\" }\n      ]\n    },\n    {\n      \"text\": \"Split the team — half ships, half refactors\",\n      \"consequence\": \"Shipped on time with partial cleanup. Neither task got full attention, and the team felt stretched thin.\",\n      \"effects\": [\n        { \"dimension\": \"Code Quality\", \"impact\": \"neutral\" },\n        { \"dimension\": \"Team Morale\", \"impact\": \"negative\" }\n      ]\n    }\n  ]\n}\n```\n\n# Quality Checks\n\nBefore finalizing, verify:\n\n- [ ] Does the intro establish a clear, engaging scenario?\n- [ ] Does every option have a meaningful consequence?\n- [ ] Are consequences connected to lesson principles?\n- [ ] Is there no obviously \"best\" option in each step?\n- [ ] Do options affect multiple dimensions where realistic?\n- [ ] Are dimension names consistent and lesson-relevant across all effects?\n- [ ] Is `{{NAME}}` used appropriately?\n- [ ] Is all dialogue pure conversation (no narrator)?\n- [ ] Does the reflection tie the experience back to the lesson?\n- [ ] Are all constraints met (intro ≤500, context ≤500, question ≤100, text ≤80, consequence ≤300, reflection ≤500)?\n- [ ] Is the step count between 4 and 6?\n- [ ] Does every step have 3-4 options?\n\n# Output Format\n\nReturn an object with:\n\n- **intro**: Scenario introduction (max 500 chars)\n- **steps**: Array of 4-6 step objects, each with:\n  - **context**: Pure dialogue (max 500 chars)\n  - **question**: Decision prompt (max 100 chars)\n  - **options**: Array of 3-4 objects with:\n    - **text**: Choice description (max 80 chars)\n    - **consequence**: What happens (max 300 chars)\n    - **effects**: Array of 1-3 objects with:\n      - **dimension**: Short name for what this affects (use 2-4 different dimensions total)\n      - **impact**: One of \"positive\", \"neutral\", \"negative\"\n- **reflection**: Closing insight connecting to lesson (max 500 chars)\n",
      "testCaseId": "en-cs-algorithm-complexity-1",
      "userPrompt": "LESSON_TITLE: Algorithm Complexity Trade-offs\nLESSON_DESCRIPTION: Understanding and applying algorithm complexity analysis to make informed trade-offs in software design\nCHAPTER_TITLE: Algorithm Analysis\nCOURSE_TITLE: Data Structures and Algorithms\nLANGUAGE: en\nEXPLANATION_STEPS:\n1. Time Complexity: Time complexity measures how execution time grows with input size. O(n) means linear growth — double the input, double the time. O(n²) means quadratic — double the input, quadruple the time.\n2. Space Complexity: Space complexity measures memory usage growth. Some algorithms trade time for space — storing precomputed results to avoid recalculation. Others trade space for time — using less memory but computing more.\n3. Time-Space Trade-off: The time-space trade-off is fundamental. Hash tables give O(1) lookup but use extra memory. Binary search uses O(1) space but requires sorted data. Choose based on constraints.\n4. Amortized Analysis: Amortized analysis looks at average performance over many operations. ArrayList append is usually O(1), but occasionally O(n) when resizing. Amortized, it's still O(1).\n5. Case Analysis: Best, average, and worst case can differ dramatically. Quicksort averages O(n log n) but worst-cases to O(n²). Know your data distribution to choose wisely."
    },
    {
      "duration": 96419.01387500006,
      "inputTokens": 2054,
      "output": "{\n  \"intro\": \"As the new Pricing Strategist for Velocity e-bikes, {{NAME}}, you are stepping into a volatile market. The flagship V-Max model just launched, but material costs are fluctuating and competitors are aggressive. You will need to apply principles of supply and demand to adjust pricing, manage inventory shortages, and respond to changing consumer tastes. Your choices will shape the company's profitability, market share, and customer loyalty over the next fiscal year.\",\n  \"reflection\": \"Pricing isn't just math; it's navigating human behavior. As you saw, shifting a curve often yields better long-term results than simply moving along it by slashing prices. Whether managing shortages, testing elasticity, or reacting to external shocks, every decision requires trading off immediate profit for market share or brand loyalty. Understanding supply and demand helps you anticipate these trade-offs before you make them, ensuring sustainable growth for the business.\",\n  \"steps\": [\n    {\n      \"context\": \"{{NAME}}, our Q1 sales for the V-Max are slightly below target. The board wants a quick 10% price cut to boost volume immediately. But remember, e-bikes are a premium purchase. Do we just slash the price to move down the demand curve, or should we try to shift the entire curve instead?\",\n      \"options\": [\n        {\n          \"consequence\": \"Moving down the demand curve increased quantity demanded, but not enough to offset the lower margin. The V-Max feels less premium now, though we cleared inventory.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Profitability\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Market Share\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Slash the price by 10% to move units.\"\n        },\n        {\n          \"consequence\": \"Shifting the demand curve outward worked! We maintained our premium price point and margins, but the heavy upfront marketing cost meant our net cash flow stayed flat.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Profitability\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Customer Loyalty\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Market Share\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Keep price, invest in an influencer campaign.\"\n        },\n        {\n          \"consequence\": \"We effectively lowered the price without changing the sticker, moving along the curve. People loved the perceived value, but sourcing the helmets ate into margins.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Customer Loyalty\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Profitability\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Keep price, bundle with a premium helmet.\"\n        }\n      ],\n      \"question\": \"How should we increase our Q1 sales volume?\"\n    },\n    {\n      \"context\": \"Good news and bad news, {{NAME}}. City transit fares just doubled, so demand for alternative commuting is spiking. But our battery supplier just raised prices by 15%. If we pass that cost to consumers by raising the V-Max price, we might lose our new commuter audience.\",\n      \"options\": [\n        {\n          \"consequence\": \"E-bike demand from desperate commuters proved highly inelastic. They bought them anyway! We maintained margins, but the steep price hike sparked angry reviews online.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Profitability\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Customer Loyalty\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Pass the full 15% cost to customers.\"\n        },\n        {\n          \"consequence\": \"We captured a massive chunk of the commuter market. Volume went through the roof, but our per-unit margin vanished. We are moving a lot of metal for very little return.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Market Share\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Profitability\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Eat the cost and keep prices flat.\"\n        },\n        {\n          \"consequence\": \"We found a middle ground. The slight price bump didn't deter many buyers, but the shorter range on the new battery caused some grumbling in commuter forums.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Profitability\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Market Share\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Customer Loyalty\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Raise price by 5% and use a cheaper battery.\"\n        }\n      ],\n      \"question\": \"How do we handle the increased battery costs?\"\n    },\n    {\n      \"context\": \"{{NAME}}, that tech blog review went viral! Demand just shifted massively to the right. We have 2,000 units in stock, but waitlist signups hit 8,000 overnight. We are facing a massive shortage at our current equilibrium price.\",\n      \"options\": [\n        {\n          \"consequence\": \"Raising prices cleared the shortage and maximized profit per unit. We found the new equilibrium, but early fans accused us of price gouging, damaging community trust.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Profitability\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Customer Loyalty\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Implement surge pricing to reach equilibrium.\"\n        },\n        {\n          \"consequence\": \"The shortage persisted. While customers respected our commitment to fair pricing, frustrated buyers who couldn't wait ended up buying from our competitors instead.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Customer Loyalty\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Market Share\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Keep the price and enforce a strict waitlist.\"\n        },\n        {\n          \"consequence\": \"We secured cash upfront. However, maintaining the shortage equilibrium meant many canceled their orders after three months when competitor bikes became available.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Market Share\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Profitability\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Take discounted pre-orders for a later delivery.\"\n        }\n      ],\n      \"question\": \"What is our strategy for the viral stockout?\"\n    },\n    {\n      \"context\": \"The government just announced a huge subsidy for green transit. Our production costs are dropping significantly! We can finally shift our supply curve to the right. How do we want to play this, {{NAME}}?\",\n      \"options\": [\n        {\n          \"consequence\": \"Our margins have never looked better! We didn't pass the savings on, so our market share stayed exactly the same, but the board is thrilled with the quarterly earnings.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Profitability\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Market Share\",\n              \"impact\": \"neutral\"\n            }\n          ],\n          \"text\": \"Hold price steady, pocket the subsidy as profit.\"\n        },\n        {\n          \"consequence\": \"Lowering the price increased quantity demanded significantly. We gained massive market share, though we gave up the opportunity for record-breaking profit margins.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Market Share\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Profitability\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Customer Loyalty\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Lower the price to match the new production cost.\"\n        },\n        {\n          \"consequence\": \"We didn't change the current market equilibrium, but the R&D investment led to a revolutionary new motor design that boosted our brand reputation among enthusiasts.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Market Share\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Customer Loyalty\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Keep price steady, reinvest subsidy into R&D.\"\n        }\n      ],\n      \"question\": \"How should we utilize the new manufacturing subsidy?\"\n    },\n    {\n      \"context\": \"{{NAME}}, the city is rolling out a massive network of protected bike lanes. This is a huge complementary good for our e-bikes. Demand is going to shift right again, but our factory is at maximum capacity.\",\n      \"options\": [\n        {\n          \"consequence\": \"We hit a highly profitable equilibrium. By matching price to our maximum supply capacity, we maximized revenue, though we priced out many eager new riders.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Profitability\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Market Share\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Raise prices to throttle demand to factory limit.\"\n        },\n        {\n          \"consequence\": \"We shifted our supply curve right to meet the new demand! Volume exploded, but the third-party bikes had quality control issues that hurt our brand image.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Market Share\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Customer Loyalty\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"License our design to a third-party manufacturer.\"\n        },\n        {\n          \"consequence\": \"We leveraged the e-bike shortage by heavily pushing helmets and locks. Revenue spiked without needing more bikes, but core riders felt we lost focus on our main product.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Profitability\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Customer Loyalty\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Keep price steady but heavily push accessories.\"\n        }\n      ],\n      \"question\": \"How do we capitalize on the new bike lane infrastructure?\"\n    }\n  ]\n}",
      "outputTokens": 8818,
      "systemPrompt": "# Role\n\nYou are an expert educational game designer creating a **Challenge** activity for a learning app. Your mission is to design a choose-your-own-adventure scenario where learners make strategic decisions with meaningful consequences, using the lesson's concepts.\n\nYou specialize in crafting narrative experiences that test strategic thinking — not knowledge recall, but the ability to apply concepts and understand trade-offs.\n\n# Why Narrative Challenges Work\n\nGreat challenges don't quiz — they immerse. Learners face realistic scenarios where every choice has consequences. They experience trade-offs firsthand, making the lesson's principles memorable.\n\n- **No \"Right Answer\"**: Every option has pros and cons. Learners engage with WHY, not just WHAT.\n- **Consequences Over Scores**: Instead of winning or losing, learners see the natural results of their choices.\n- **Strategic Thinking**: Understanding the lesson helps navigate trade-offs, but different strategies lead to different outcomes.\n\n# Inputs\n\n- `LESSON_TITLE`: The topic to create a challenge around\n- `LESSON_DESCRIPTION`: Additional context about what this lesson covers\n- `CHAPTER_TITLE`: The chapter context (for understanding scope)\n- `COURSE_TITLE`: The course context (for understanding audience level)\n- `LANGUAGE`: Output language\n- `EXPLANATION_STEPS`: What the learner has already studied\n\n## Language Guidelines\n\n- `en`: Use US English unless the content is region-specific\n- `pt`: Use Brazilian Portuguese unless the content is region-specific\n- `es`: Use Latin American Spanish unless the content is region-specific\n\n# Requirements\n\n## Introduction\n\nThe `intro` field sets the scene (max 500 characters). It should:\n\n- Establish the scenario and the learner's role\n- Explain what they're navigating (a project, situation, decision-making process)\n- Create stakes that feel meaningful\n- Use `{{NAME}}` to personalize\n\n## Steps\n\nCreate 4-6 steps. Each step presents a decision point with 3-4 options.\n\n### Step Structure\n\n- **context**: Maximum 500 characters. Pure dialogue from a colleague setting up the decision. Conversational, no narrator.\n- **question**: Maximum 100 characters. What needs to be decided.\n- **options**: 3-4 choices, each with:\n  - **text**: The choice (max 80 characters)\n  - **consequence**: What happens as a result (max 300 characters). Shown after choosing. Explains the outcome narratively.\n  - **effects**: Array of 1-3 effects showing how this choice impacts different aspects:\n    - **dimension**: A short name for what this affects (e.g., \"Code Quality\", \"Delivery Speed\", \"Team Morale\"). Use 2-4 different dimensions across all options to create meaningful trade-offs. Important: dimensions must be consistent across all steps.\n    - **impact**: Is this `\"positive\"`, `\"neutral\"`, or `\"negative\"` for that dimension?\n\n### Option Design\n\nEvery option should:\n\n- Be a legitimate choice (no obviously wrong answers)\n- Have a clear consequence that connects to lesson concepts\n- Affect 1-3 dimensions (real decisions rarely affect just one thing)\n- Teach something about trade-offs when the consequence is revealed\n\n**No option should be universally best.** Good options might help one dimension but hurt another. This creates genuine trade-offs.\n\n## Reflection\n\nThe `reflection` field (max 500 characters) provides closing insight after all steps. It should:\n\n- Acknowledge that different approaches have merit\n- Connect the experience back to the lesson's key principles\n- Help learners understand how the concepts apply in practice\n\n## Tone & Style\n\n- **Pure dialogue**: NO narrator, NO character prefixes, NO action descriptions\n- **Natural conversation**: Colleagues working through a problem together\n- **Professional but warm**: Light humor when appropriate\n- **Second-person immersion**: The colleague speaks TO the learner\n- **Use `{{NAME}}`** to personalize dialogue\n\n## What to Avoid\n\n- **Quiz-style questions**: This tests strategic thinking, not recall\n- **Obviously correct answers**: Every option should have genuine trade-offs\n- **Narrator text**: Keep it pure dialogue in context\n- **Disconnected consequences**: Consequences should relate to lesson concepts\n- **Too many or too few dimensions**: Use 2-4 different dimension names across all effects for meaningful trade-offs\n\n## Relationship to Previous Activities\n\nThe learner has completed:\n\n- **Background**: WHY this exists\n- **Explanation**: WHAT it is\n- **Mechanics**: HOW it works\n- **Examples**: WHERE it appears\n- **Story**: WHEN to apply this\n\nYour Challenge activity is the capstone: **CAN YOU NAVIGATE THIS?** It tests whether learners can apply concepts strategically. This should feel like a meaningful simulation, not a test.\n\n# Example\n\nFor a lesson on \"Technical Debt\":\n\n**Step 1:**\n\n```json\n{\n  \"context\": \"{{NAME}}, we've got a deadline crunch. The feature works but the code is messy. Ship it now or clean it up first?\",\n  \"question\": \"How do we handle this?\",\n  \"options\": [\n    {\n      \"text\": \"Ship it now, refactor later\",\n      \"consequence\": \"Feature launched on time! But the messy code made the next sprint's work harder. The team spent extra hours untangling dependencies.\",\n      \"effects\": [\n        { \"dimension\": \"Code Quality\", \"impact\": \"negative\" },\n        { \"dimension\": \"Delivery Speed\", \"impact\": \"positive\" }\n      ]\n    },\n    {\n      \"text\": \"Take two more days to refactor\",\n      \"consequence\": \"The code is clean and maintainable. Stakeholders weren't thrilled about the delay, but future changes will be much easier.\",\n      \"effects\": [\n        { \"dimension\": \"Code Quality\", \"impact\": \"positive\" },\n        { \"dimension\": \"Delivery Speed\", \"impact\": \"negative\" }\n      ]\n    },\n    {\n      \"text\": \"Split the team — half ships, half refactors\",\n      \"consequence\": \"Shipped on time with partial cleanup. Neither task got full attention, and the team felt stretched thin.\",\n      \"effects\": [\n        { \"dimension\": \"Code Quality\", \"impact\": \"neutral\" },\n        { \"dimension\": \"Team Morale\", \"impact\": \"negative\" }\n      ]\n    }\n  ]\n}\n```\n\n# Quality Checks\n\nBefore finalizing, verify:\n\n- [ ] Does the intro establish a clear, engaging scenario?\n- [ ] Does every option have a meaningful consequence?\n- [ ] Are consequences connected to lesson principles?\n- [ ] Is there no obviously \"best\" option in each step?\n- [ ] Do options affect multiple dimensions where realistic?\n- [ ] Are dimension names consistent and lesson-relevant across all effects?\n- [ ] Is `{{NAME}}` used appropriately?\n- [ ] Is all dialogue pure conversation (no narrator)?\n- [ ] Does the reflection tie the experience back to the lesson?\n- [ ] Are all constraints met (intro ≤500, context ≤500, question ≤100, text ≤80, consequence ≤300, reflection ≤500)?\n- [ ] Is the step count between 4 and 6?\n- [ ] Does every step have 3-4 options?\n\n# Output Format\n\nReturn an object with:\n\n- **intro**: Scenario introduction (max 500 chars)\n- **steps**: Array of 4-6 step objects, each with:\n  - **context**: Pure dialogue (max 500 chars)\n  - **question**: Decision prompt (max 100 chars)\n  - **options**: Array of 3-4 objects with:\n    - **text**: Choice description (max 80 chars)\n    - **consequence**: What happens (max 300 chars)\n    - **effects**: Array of 1-3 objects with:\n      - **dimension**: Short name for what this affects (use 2-4 different dimensions total)\n      - **impact**: One of \"positive\", \"neutral\", \"negative\"\n- **reflection**: Closing insight connecting to lesson (max 500 chars)\n",
      "testCaseId": "en-economics-supply-demand-1",
      "userPrompt": "LESSON_TITLE: Supply and Demand in Practice\nLESSON_DESCRIPTION: Applying supply and demand principles to make strategic pricing and market decisions\nCHAPTER_TITLE: Market Dynamics\nCOURSE_TITLE: Microeconomics Fundamentals\nLANGUAGE: en\nEXPLANATION_STEPS:\n1. The Demand Curve: Demand curves slope downward — as price rises, quantity demanded falls. This reflects the law of demand: people buy less when things cost more, all else equal.\n2. The Supply Curve: Supply curves slope upward — as price rises, quantity supplied increases. Higher prices incentivize producers to make more. Lower prices make production less worthwhile.\n3. Market Equilibrium: Equilibrium occurs where supply meets demand. At this price, quantity supplied equals quantity demanded. Prices above equilibrium create surplus; prices below create shortage.\n4. Price Elasticity: Price elasticity measures responsiveness to price changes. Elastic demand (>1) means sales drop sharply with price increases. Inelastic demand (<1) means sales barely change.\n5. Shifts vs. Movements: Shifts vs. movements: A change in price moves along the curve. Changes in other factors (income, preferences, costs) shift the entire curve. This distinction is crucial."
    },
    {
      "duration": 59402.765625,
      "inputTokens": 2098,
      "output": "{\n  \"intro\": \"Welcome to Pine Valley Reserve, {{NAME}}. As our new Lead Ecologist, you're taking over a complex, interconnected environment. Every decision you make here will ripple through the food web, affect our carrying capacity, and impact the local community. I'm Sarah, the head ranger, and I'll be bringing you the field reports. We have some urgent situations to address today, and you'll have to balance the science with the reality on the ground. Let's get started.\",\n  \"reflection\": \"You've just experienced the reality of ecosystem management. Every intervention causes a ripple effect. Whether you're managing carrying capacity, navigating trophic cascades, or balancing biodiversity against public interests, there is rarely a perfect solution. True conservation isn't about freezing nature in time; it's about making strategic trade-offs to maintain long-term resilience and functionality.\",\n  \"steps\": [\n    {\n      \"context\": \"{{NAME}}, the deer population in the lower valley is exploding. We're way over carrying capacity, and they're eating all the young saplings. If we don't act soon, the entire forest understory will be gone by next year, which means no habitat for our ground-nesting birds.\",\n      \"options\": [\n        {\n          \"consequence\": \"The wolves naturally curbed the deer numbers and the understory recovered beautifully. However, local farmers are furious after a few livestock were spooked, and we're dealing with a PR nightmare.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Ecosystem Stability\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Public Support\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Biodiversity\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Introduce apex predators like wolves\"\n        },\n        {\n          \"consequence\": \"The hunt brought in quick revenue and reduced deer numbers, pleasing locals. But it didn't change the deer's foraging behavior like a natural predator would, so the saplings are still struggling to bounce back.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Public Support\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Ecosystem Stability\",\n              \"impact\": \"neutral\"\n            }\n          ],\n          \"text\": \"Organize a controlled community hunting season\"\n        },\n        {\n          \"consequence\": \"Providing feed saved the young trees temporarily, but the deer population continued to skyrocket past carrying capacity. Now we have an even bigger starvation crisis looming for winter.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Ecosystem Stability\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Public Support\",\n              \"impact\": \"neutral\"\n            }\n          ],\n          \"text\": \"Provide supplemental feed to draw them away from saplings\"\n        }\n      ],\n      \"question\": \"How should we manage the deer overpopulation?\"\n    },\n    {\n      \"context\": \"That area that burned last spring is seeing aggressive growth of a non-native pioneer weed. It's fantastic for preventing soil erosion right now, but it's completely shading out the native seeds that are trying to sprout.\",\n      \"options\": [\n        {\n          \"consequence\": \"The native seeds finally got sunlight, but the chemicals harmed local insect populations. Plus, without the weed's dense roots, we lost a lot of valuable topsoil to rain runoff.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Biodiversity\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Ecosystem Stability\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Spray herbicides to kill the invasive weed\"\n        },\n        {\n          \"consequence\": \"The soil was perfectly preserved! Unfortunately, the area is now essentially a monoculture. The native species couldn't compete, reducing the overall resilience of that sector.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Biodiversity\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Ecosystem Stability\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Let the pioneer weed run its course to save the soil\"\n        },\n        {\n          \"consequence\": \"Hand-pulling allowed native plants to emerge while keeping enough weed roots to hold the soil. It was labor-intensive, but the community loved getting their hands dirty for conservation.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Public Support\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Biodiversity\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Ecosystem Stability\",\n              \"impact\": \"neutral\"\n            }\n          ],\n          \"text\": \"Send volunteer teams to manually thin the weed\"\n        }\n      ],\n      \"question\": \"What's the plan for the burned sector?\"\n    },\n    {\n      \"context\": \"We've got a great problem, {{NAME}}. Visitor numbers are up 40%! But the heavy foot traffic is compacting soil and driving nesting birds away from the lakeshore. The mayor really wants us to keep the tourists coming.\",\n      \"options\": [\n        {\n          \"consequence\": \"The lakeshore ecosystems bounced back quickly, and the birds returned. However, the town mayor and local business owners are incredibly frustrated by the sudden loss of tourism revenue.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Ecosystem Stability\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Public Support\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Cap daily visitor numbers immediately\"\n        },\n        {\n          \"consequence\": \"The infrastructure kept people off the sensitive soil, and tourists loved the new walkways. However, the construction permanently altered the habitat, displacing some ground-nesting species forever.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Public Support\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Biodiversity\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Build paved paths and viewing platforms\"\n        },\n        {\n          \"consequence\": \"The lakeshore recovered, but routing tourists into the deep woods introduced noise pollution to previously untouched zones. We basically just moved the ecological stress to a new area.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Ecosystem Stability\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Biodiversity\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Close the lakeshore, open the deep woods trails\"\n        }\n      ],\n      \"question\": \"How do we handle the surge in visitors?\"\n    },\n    {\n      \"context\": \"Bad news from the lab. A fungal blight is spreading through our ancient oak trees. They're a keystone species here—so many insects and birds rely on them. If we lose the oaks, the whole food web might collapse.\",\n      \"options\": [\n        {\n          \"consequence\": \"The fungicide saved most of the ancient oaks! Unfortunately, it also wiped out several beneficial soil fungi, disrupting nutrient cycles and harming the undergrowth long-term.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Ecosystem Stability\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Biodiversity\",\n              \"impact\": \"neutral\"\n            }\n          ],\n          \"text\": \"Aggressively apply fungicides forest-wide\"\n        },\n        {\n          \"consequence\": \"We stopped the spread, but losing those massive old trees caused a sudden trophic cascade. The bird and insect populations that relied on them plummeted, drastically changing the forest dynamics.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Biodiversity\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Ecosystem Stability\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Public Support\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Cut down all infected oaks immediately\"\n        },\n        {\n          \"consequence\": \"We lost many old oaks, but the new resistant species stabilized the canopy over time. It's a very different forest now—not quite historical, but it's functioning, diverse, and adapting well.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Ecosystem Stability\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Biodiversity\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Public Support\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Let it run, but under-plant with resistant non-natives\"\n        }\n      ],\n      \"question\": \"How should we address the fungal blight?\"\n    }\n  ]\n}",
      "outputTokens": 4483,
      "systemPrompt": "# Role\n\nYou are an expert educational game designer creating a **Challenge** activity for a learning app. Your mission is to design a choose-your-own-adventure scenario where learners make strategic decisions with meaningful consequences, using the lesson's concepts.\n\nYou specialize in crafting narrative experiences that test strategic thinking — not knowledge recall, but the ability to apply concepts and understand trade-offs.\n\n# Why Narrative Challenges Work\n\nGreat challenges don't quiz — they immerse. Learners face realistic scenarios where every choice has consequences. They experience trade-offs firsthand, making the lesson's principles memorable.\n\n- **No \"Right Answer\"**: Every option has pros and cons. Learners engage with WHY, not just WHAT.\n- **Consequences Over Scores**: Instead of winning or losing, learners see the natural results of their choices.\n- **Strategic Thinking**: Understanding the lesson helps navigate trade-offs, but different strategies lead to different outcomes.\n\n# Inputs\n\n- `LESSON_TITLE`: The topic to create a challenge around\n- `LESSON_DESCRIPTION`: Additional context about what this lesson covers\n- `CHAPTER_TITLE`: The chapter context (for understanding scope)\n- `COURSE_TITLE`: The course context (for understanding audience level)\n- `LANGUAGE`: Output language\n- `EXPLANATION_STEPS`: What the learner has already studied\n\n## Language Guidelines\n\n- `en`: Use US English unless the content is region-specific\n- `pt`: Use Brazilian Portuguese unless the content is region-specific\n- `es`: Use Latin American Spanish unless the content is region-specific\n\n# Requirements\n\n## Introduction\n\nThe `intro` field sets the scene (max 500 characters). It should:\n\n- Establish the scenario and the learner's role\n- Explain what they're navigating (a project, situation, decision-making process)\n- Create stakes that feel meaningful\n- Use `{{NAME}}` to personalize\n\n## Steps\n\nCreate 4-6 steps. Each step presents a decision point with 3-4 options.\n\n### Step Structure\n\n- **context**: Maximum 500 characters. Pure dialogue from a colleague setting up the decision. Conversational, no narrator.\n- **question**: Maximum 100 characters. What needs to be decided.\n- **options**: 3-4 choices, each with:\n  - **text**: The choice (max 80 characters)\n  - **consequence**: What happens as a result (max 300 characters). Shown after choosing. Explains the outcome narratively.\n  - **effects**: Array of 1-3 effects showing how this choice impacts different aspects:\n    - **dimension**: A short name for what this affects (e.g., \"Code Quality\", \"Delivery Speed\", \"Team Morale\"). Use 2-4 different dimensions across all options to create meaningful trade-offs. Important: dimensions must be consistent across all steps.\n    - **impact**: Is this `\"positive\"`, `\"neutral\"`, or `\"negative\"` for that dimension?\n\n### Option Design\n\nEvery option should:\n\n- Be a legitimate choice (no obviously wrong answers)\n- Have a clear consequence that connects to lesson concepts\n- Affect 1-3 dimensions (real decisions rarely affect just one thing)\n- Teach something about trade-offs when the consequence is revealed\n\n**No option should be universally best.** Good options might help one dimension but hurt another. This creates genuine trade-offs.\n\n## Reflection\n\nThe `reflection` field (max 500 characters) provides closing insight after all steps. It should:\n\n- Acknowledge that different approaches have merit\n- Connect the experience back to the lesson's key principles\n- Help learners understand how the concepts apply in practice\n\n## Tone & Style\n\n- **Pure dialogue**: NO narrator, NO character prefixes, NO action descriptions\n- **Natural conversation**: Colleagues working through a problem together\n- **Professional but warm**: Light humor when appropriate\n- **Second-person immersion**: The colleague speaks TO the learner\n- **Use `{{NAME}}`** to personalize dialogue\n\n## What to Avoid\n\n- **Quiz-style questions**: This tests strategic thinking, not recall\n- **Obviously correct answers**: Every option should have genuine trade-offs\n- **Narrator text**: Keep it pure dialogue in context\n- **Disconnected consequences**: Consequences should relate to lesson concepts\n- **Too many or too few dimensions**: Use 2-4 different dimension names across all effects for meaningful trade-offs\n\n## Relationship to Previous Activities\n\nThe learner has completed:\n\n- **Background**: WHY this exists\n- **Explanation**: WHAT it is\n- **Mechanics**: HOW it works\n- **Examples**: WHERE it appears\n- **Story**: WHEN to apply this\n\nYour Challenge activity is the capstone: **CAN YOU NAVIGATE THIS?** It tests whether learners can apply concepts strategically. This should feel like a meaningful simulation, not a test.\n\n# Example\n\nFor a lesson on \"Technical Debt\":\n\n**Step 1:**\n\n```json\n{\n  \"context\": \"{{NAME}}, we've got a deadline crunch. The feature works but the code is messy. Ship it now or clean it up first?\",\n  \"question\": \"How do we handle this?\",\n  \"options\": [\n    {\n      \"text\": \"Ship it now, refactor later\",\n      \"consequence\": \"Feature launched on time! But the messy code made the next sprint's work harder. The team spent extra hours untangling dependencies.\",\n      \"effects\": [\n        { \"dimension\": \"Code Quality\", \"impact\": \"negative\" },\n        { \"dimension\": \"Delivery Speed\", \"impact\": \"positive\" }\n      ]\n    },\n    {\n      \"text\": \"Take two more days to refactor\",\n      \"consequence\": \"The code is clean and maintainable. Stakeholders weren't thrilled about the delay, but future changes will be much easier.\",\n      \"effects\": [\n        { \"dimension\": \"Code Quality\", \"impact\": \"positive\" },\n        { \"dimension\": \"Delivery Speed\", \"impact\": \"negative\" }\n      ]\n    },\n    {\n      \"text\": \"Split the team — half ships, half refactors\",\n      \"consequence\": \"Shipped on time with partial cleanup. Neither task got full attention, and the team felt stretched thin.\",\n      \"effects\": [\n        { \"dimension\": \"Code Quality\", \"impact\": \"neutral\" },\n        { \"dimension\": \"Team Morale\", \"impact\": \"negative\" }\n      ]\n    }\n  ]\n}\n```\n\n# Quality Checks\n\nBefore finalizing, verify:\n\n- [ ] Does the intro establish a clear, engaging scenario?\n- [ ] Does every option have a meaningful consequence?\n- [ ] Are consequences connected to lesson principles?\n- [ ] Is there no obviously \"best\" option in each step?\n- [ ] Do options affect multiple dimensions where realistic?\n- [ ] Are dimension names consistent and lesson-relevant across all effects?\n- [ ] Is `{{NAME}}` used appropriately?\n- [ ] Is all dialogue pure conversation (no narrator)?\n- [ ] Does the reflection tie the experience back to the lesson?\n- [ ] Are all constraints met (intro ≤500, context ≤500, question ≤100, text ≤80, consequence ≤300, reflection ≤500)?\n- [ ] Is the step count between 4 and 6?\n- [ ] Does every step have 3-4 options?\n\n# Output Format\n\nReturn an object with:\n\n- **intro**: Scenario introduction (max 500 chars)\n- **steps**: Array of 4-6 step objects, each with:\n  - **context**: Pure dialogue (max 500 chars)\n  - **question**: Decision prompt (max 100 chars)\n  - **options**: Array of 3-4 objects with:\n    - **text**: Choice description (max 80 chars)\n    - **consequence**: What happens (max 300 chars)\n    - **effects**: Array of 1-3 objects with:\n      - **dimension**: Short name for what this affects (use 2-4 different dimensions total)\n      - **impact**: One of \"positive\", \"neutral\", \"negative\"\n- **reflection**: Closing insight connecting to lesson (max 500 chars)\n",
      "testCaseId": "en-biology-ecosystem-balance-1",
      "userPrompt": "LESSON_TITLE: Ecosystem Balance and Management\nLESSON_DESCRIPTION: Applying ecological principles to make informed ecosystem management decisions\nCHAPTER_TITLE: Ecosystem Dynamics\nCOURSE_TITLE: Ecology and Conservation\nLANGUAGE: en\nEXPLANATION_STEPS:\n1. Interconnected Networks: Ecosystems are interconnected networks. Removing one species affects others through food webs. Keystone species have disproportionate impact — their loss cascades through the system.\n2. Carrying Capacity: Carrying capacity is the maximum population an environment can sustain. Exceed it, and resources deplete, populations crash. Stay well below, and you're not maximizing the ecosystem's potential.\n3. Biodiversity and Resilience: Biodiversity provides resilience. More species means more ways to respond to change. Monocultures are efficient but fragile. Diverse systems are robust but complex to manage.\n4. Trophic Cascades: Trophic cascades occur when changes at one level ripple through others. Remove predators, and prey populations explode, overgrazing vegetation, affecting everything that depends on those plants.\n5. Ecological Succession: Ecological succession is the process of change over time. Pioneer species prepare the way for later ones. Managing ecosystems means deciding where in succession you want to be."
    },
    {
      "duration": 67045.97212499997,
      "inputTokens": 2161,
      "output": "{\n  \"intro\": \"Você acaba de assumir como engenheiro-chefe da nossa planta química, {{NAME}}. Nossa principal linha de produção utiliza uma reação gasosa e exotérmica para criar um gás industrial essencial. Você precisa aplicar o Princípio de Le Chatelier para otimizar o processo. Suas escolhas ditarão o equilíbrio entre produzir o máximo possível, fazer isso rápido, ou manter a fábrica segura e dentro do orçamento. A diretoria e os investidores estão acompanhando cada passo seu.\",\n  \"reflection\": \"O Princípio de Le Chatelier mostra como a natureza reage a mudanças. Na indústria, o cenário ideal teórico de rendimento muitas vezes esbarra em custos, riscos e lentidão. Você percebeu que um engenheiro de sucesso não busca apenas o equilíbrio químico, mas o equilíbrio estratégico: unindo cinética, termodinâmica e economia para que a produção seja realmente viável.\",\n  \"steps\": [\n    {\n      \"context\": \"{{NAME}}, a reação atingiu o equilíbrio, mas precisamos de mais produto final para bater a meta. O reator está cheio, mas não queremos alterar a temperatura ainda. O que você sugere para deslocar o equilíbrio a nosso favor?\",\n      \"options\": [\n        {\n          \"consequence\": \"Aumentar a concentração dos reagentes deslocou o equilíbrio para os produtos! O rendimento subiu, mas a injeção forçada de tanto gás exigiu compressores mais fortes, o que estourou nosso orçamento de energia.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Rendimento\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Segurança e Custos\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Injetar um volume gigantesco de reagentes de uma vez.\"\n        },\n        {\n          \"consequence\": \"Ao retirar o produto constantemente, você impediu que a reação reversa ganhasse força. O sistema continuou se deslocando para a direita, garantindo ótimo rendimento sem estressar os equipamentos.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Rendimento\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Segurança e Custos\",\n              \"impact\": \"neutral\"\n            }\n          ],\n          \"text\": \"Instalar um sistema para drenar o produto continuamente.\"\n        },\n        {\n          \"consequence\": \"O gás nobre que você colocou não participou da reação e não alterou as pressões parciais dos nossos reagentes. O equilíbrio químico nem se moveu, e desperdiçamos dinheiro com cilindros de gás à toa.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Rendimento\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Segurança e Custos\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Adicionar um gás inerte, como argônio, para encher o reator.\"\n        }\n      ],\n      \"question\": \"Como vamos alterar a concentração no reator?\"\n    },\n    {\n      \"context\": \"A diretoria notou que temos 4 mols de reagentes gasosos formando apenas 2 mols de produto. Eles sugeriram alterar o volume do reator físico para mexer na pressão. Qual a melhor jogada estratégica aqui, {{NAME}}?\",\n      \"options\": [\n        {\n          \"consequence\": \"A pressão subiu e o sistema minimizou o impacto deslocando para o lado de menor volume (os produtos). Rendimento incrível! Porém, o reator agora opera sob risco altíssimo de ruptura e exige manutenção cara.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Rendimento\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Segurança e Custos\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Diminuir o volume do reator para aumentar a pressão.\"\n        },\n        {\n          \"consequence\": \"Com mais espaço, a pressão caiu. O sistema tentou compensar favorecendo o lado com mais mols (os reagentes). A fábrica está super segura operando em baixa pressão, mas quase não produzimos nada.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Rendimento\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Segurança e Custos\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Aumentar o volume do reator para diminuir a pressão.\"\n        },\n        {\n          \"consequence\": \"Deixamos a estrutura do reator em paz. A operação continua perfeitamente segura e barata. Perdemos a chance de forçar um ganho massivo de produção por pressão, mas dormimos tranquilos à noite.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Segurança e Custos\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Rendimento\",\n              \"impact\": \"neutral\"\n            }\n          ],\n          \"text\": \"Manter o volume original e não mexer na pressão.\"\n        }\n      ],\n      \"question\": \"Como devemos ajustar a pressão do sistema?\"\n    },\n    {\n      \"context\": \"Sabemos que a nossa reação de síntese libera muito calor, é altamente exotérmica. Para conseguir o máximo de produto no equilíbrio, a equipe precisa saber como configurar os trocadores de calor. O que fazemos, {{NAME}}?\",\n      \"options\": [\n        {\n          \"consequence\": \"Como a reação libera calor, aquecer mais fez o sistema tentar absorver energia, favorecendo a reação inversa (reagentes). Atingimos o equilíbrio rápido, mas nosso rendimento de produto foi péssimo.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Rendimento\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Velocidade\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Elevar bastante a temperatura do reator.\"\n        },\n        {\n          \"consequence\": \"O sistema respondeu ao frio deslocando fortemente para o produto (exotérmica). O rendimento teórico ficou perfeito! O problema? O frio deixou a agitação molecular tão baixa que a reação quase não andou.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Rendimento\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Velocidade\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Reduzir a temperatura ao máximo possível.\"\n        },\n        {\n          \"consequence\": \"Um meio-termo ideal. Não atingimos o rendimento máximo de um sistema congelado, mas a reação ocorre numa velocidade operacional aceitável. O fluxo de produção estabilizou de forma muito consistente.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Velocidade\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Rendimento\",\n              \"impact\": \"neutral\"\n            }\n          ],\n          \"text\": \"Manter uma temperatura branda e equilibrada.\"\n        }\n      ],\n      \"question\": \"Qual a nossa estratégia térmica?\"\n    },\n    {\n      \"context\": \"{{NAME}}, a equipe de P&D trouxe um novo catalisador metálico caríssimo. Disseram que ele pode resolver nosso dilema entre ter a temperatura fria ideal para o rendimento e o tempo que a reação demora. O que decidimos?\",\n      \"options\": [\n        {\n          \"consequence\": \"Golpe de mestre! O frio aumentou muito a conversão em produtos, e o catalisador compensou a lentidão do resfriamento. Excelente eficiência, embora tenhamos consumido o lucro extra pagando pelo catalisador.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Rendimento\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Velocidade\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Segurança e Custos\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Comprar o catalisador e abaixar a temperatura da reação.\"\n        },\n        {\n          \"consequence\": \"O catalisador fez a reação voar! Porém, como mantivemos tudo muito quente, o equilíbrio continuou severamente deslocado para os reagentes. Chegamos muito rápido num resultado de produção terrível.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Velocidade\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Rendimento\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Comprar o catalisador, mas manter a temperatura alta.\"\n        },\n        {\n          \"consequence\": \"Você economizou muito rejeitando o catalisador. A parte financeira agradece, mas a fábrica continua obrigada a operar mais quente para ter velocidade, limitando a quantidade de produto final no mês.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Segurança e Custos\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Velocidade\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Recusar a compra, é um custo desnecessário.\"\n        }\n      ],\n      \"question\": \"O que fazemos com o catalisador de P&D?\"\n    }\n  ]\n}",
      "outputTokens": 5512,
      "systemPrompt": "# Role\n\nYou are an expert educational game designer creating a **Challenge** activity for a learning app. Your mission is to design a choose-your-own-adventure scenario where learners make strategic decisions with meaningful consequences, using the lesson's concepts.\n\nYou specialize in crafting narrative experiences that test strategic thinking — not knowledge recall, but the ability to apply concepts and understand trade-offs.\n\n# Why Narrative Challenges Work\n\nGreat challenges don't quiz — they immerse. Learners face realistic scenarios where every choice has consequences. They experience trade-offs firsthand, making the lesson's principles memorable.\n\n- **No \"Right Answer\"**: Every option has pros and cons. Learners engage with WHY, not just WHAT.\n- **Consequences Over Scores**: Instead of winning or losing, learners see the natural results of their choices.\n- **Strategic Thinking**: Understanding the lesson helps navigate trade-offs, but different strategies lead to different outcomes.\n\n# Inputs\n\n- `LESSON_TITLE`: The topic to create a challenge around\n- `LESSON_DESCRIPTION`: Additional context about what this lesson covers\n- `CHAPTER_TITLE`: The chapter context (for understanding scope)\n- `COURSE_TITLE`: The course context (for understanding audience level)\n- `LANGUAGE`: Output language\n- `EXPLANATION_STEPS`: What the learner has already studied\n\n## Language Guidelines\n\n- `en`: Use US English unless the content is region-specific\n- `pt`: Use Brazilian Portuguese unless the content is region-specific\n- `es`: Use Latin American Spanish unless the content is region-specific\n\n# Requirements\n\n## Introduction\n\nThe `intro` field sets the scene (max 500 characters). It should:\n\n- Establish the scenario and the learner's role\n- Explain what they're navigating (a project, situation, decision-making process)\n- Create stakes that feel meaningful\n- Use `{{NAME}}` to personalize\n\n## Steps\n\nCreate 4-6 steps. Each step presents a decision point with 3-4 options.\n\n### Step Structure\n\n- **context**: Maximum 500 characters. Pure dialogue from a colleague setting up the decision. Conversational, no narrator.\n- **question**: Maximum 100 characters. What needs to be decided.\n- **options**: 3-4 choices, each with:\n  - **text**: The choice (max 80 characters)\n  - **consequence**: What happens as a result (max 300 characters). Shown after choosing. Explains the outcome narratively.\n  - **effects**: Array of 1-3 effects showing how this choice impacts different aspects:\n    - **dimension**: A short name for what this affects (e.g., \"Code Quality\", \"Delivery Speed\", \"Team Morale\"). Use 2-4 different dimensions across all options to create meaningful trade-offs. Important: dimensions must be consistent across all steps.\n    - **impact**: Is this `\"positive\"`, `\"neutral\"`, or `\"negative\"` for that dimension?\n\n### Option Design\n\nEvery option should:\n\n- Be a legitimate choice (no obviously wrong answers)\n- Have a clear consequence that connects to lesson concepts\n- Affect 1-3 dimensions (real decisions rarely affect just one thing)\n- Teach something about trade-offs when the consequence is revealed\n\n**No option should be universally best.** Good options might help one dimension but hurt another. This creates genuine trade-offs.\n\n## Reflection\n\nThe `reflection` field (max 500 characters) provides closing insight after all steps. It should:\n\n- Acknowledge that different approaches have merit\n- Connect the experience back to the lesson's key principles\n- Help learners understand how the concepts apply in practice\n\n## Tone & Style\n\n- **Pure dialogue**: NO narrator, NO character prefixes, NO action descriptions\n- **Natural conversation**: Colleagues working through a problem together\n- **Professional but warm**: Light humor when appropriate\n- **Second-person immersion**: The colleague speaks TO the learner\n- **Use `{{NAME}}`** to personalize dialogue\n\n## What to Avoid\n\n- **Quiz-style questions**: This tests strategic thinking, not recall\n- **Obviously correct answers**: Every option should have genuine trade-offs\n- **Narrator text**: Keep it pure dialogue in context\n- **Disconnected consequences**: Consequences should relate to lesson concepts\n- **Too many or too few dimensions**: Use 2-4 different dimension names across all effects for meaningful trade-offs\n\n## Relationship to Previous Activities\n\nThe learner has completed:\n\n- **Background**: WHY this exists\n- **Explanation**: WHAT it is\n- **Mechanics**: HOW it works\n- **Examples**: WHERE it appears\n- **Story**: WHEN to apply this\n\nYour Challenge activity is the capstone: **CAN YOU NAVIGATE THIS?** It tests whether learners can apply concepts strategically. This should feel like a meaningful simulation, not a test.\n\n# Example\n\nFor a lesson on \"Technical Debt\":\n\n**Step 1:**\n\n```json\n{\n  \"context\": \"{{NAME}}, we've got a deadline crunch. The feature works but the code is messy. Ship it now or clean it up first?\",\n  \"question\": \"How do we handle this?\",\n  \"options\": [\n    {\n      \"text\": \"Ship it now, refactor later\",\n      \"consequence\": \"Feature launched on time! But the messy code made the next sprint's work harder. The team spent extra hours untangling dependencies.\",\n      \"effects\": [\n        { \"dimension\": \"Code Quality\", \"impact\": \"negative\" },\n        { \"dimension\": \"Delivery Speed\", \"impact\": \"positive\" }\n      ]\n    },\n    {\n      \"text\": \"Take two more days to refactor\",\n      \"consequence\": \"The code is clean and maintainable. Stakeholders weren't thrilled about the delay, but future changes will be much easier.\",\n      \"effects\": [\n        { \"dimension\": \"Code Quality\", \"impact\": \"positive\" },\n        { \"dimension\": \"Delivery Speed\", \"impact\": \"negative\" }\n      ]\n    },\n    {\n      \"text\": \"Split the team — half ships, half refactors\",\n      \"consequence\": \"Shipped on time with partial cleanup. Neither task got full attention, and the team felt stretched thin.\",\n      \"effects\": [\n        { \"dimension\": \"Code Quality\", \"impact\": \"neutral\" },\n        { \"dimension\": \"Team Morale\", \"impact\": \"negative\" }\n      ]\n    }\n  ]\n}\n```\n\n# Quality Checks\n\nBefore finalizing, verify:\n\n- [ ] Does the intro establish a clear, engaging scenario?\n- [ ] Does every option have a meaningful consequence?\n- [ ] Are consequences connected to lesson principles?\n- [ ] Is there no obviously \"best\" option in each step?\n- [ ] Do options affect multiple dimensions where realistic?\n- [ ] Are dimension names consistent and lesson-relevant across all effects?\n- [ ] Is `{{NAME}}` used appropriately?\n- [ ] Is all dialogue pure conversation (no narrator)?\n- [ ] Does the reflection tie the experience back to the lesson?\n- [ ] Are all constraints met (intro ≤500, context ≤500, question ≤100, text ≤80, consequence ≤300, reflection ≤500)?\n- [ ] Is the step count between 4 and 6?\n- [ ] Does every step have 3-4 options?\n\n# Output Format\n\nReturn an object with:\n\n- **intro**: Scenario introduction (max 500 chars)\n- **steps**: Array of 4-6 step objects, each with:\n  - **context**: Pure dialogue (max 500 chars)\n  - **question**: Decision prompt (max 100 chars)\n  - **options**: Array of 3-4 objects with:\n    - **text**: Choice description (max 80 chars)\n    - **consequence**: What happens (max 300 chars)\n    - **effects**: Array of 1-3 objects with:\n      - **dimension**: Short name for what this affects (use 2-4 different dimensions total)\n      - **impact**: One of \"positive\", \"neutral\", \"negative\"\n- **reflection**: Closing insight connecting to lesson (max 500 chars)\n",
      "testCaseId": "pt-chemistry-reaction-equilibrium-1",
      "userPrompt": "LESSON_TITLE: Equilibrio Quimico na Pratica\nLESSON_DESCRIPTION: Aplicando o principio de Le Chatelier para otimizar reacoes quimicas e processos industriais\nCHAPTER_TITLE: Equilibrio Quimico\nCOURSE_TITLE: Quimica Geral II\nLANGUAGE: pt\nEXPLANATION_STEPS:\n1. Principio de Le Chatelier: O principio de Le Chatelier diz que um sistema em equilibrio responde a perturbacoes minimizando a mudanca. Adicione reagente, o equilibrio desloca para consumir esse reagente.\n2. Efeito da Concentracao: Mudancas de concentracao deslocam o equilibrio. Adicionar reagentes desloca para produtos. Remover produtos tambem desloca para produtos. O sistema busca restaurar o equilibrio.\n3. Efeito da Pressao: A pressao afeta equilibrios gasosos. Aumentar pressao favorece o lado com menos moles de gas. Diminuir pressao favorece o lado com mais moles. Gases inertes nao afetam.\n4. Efeito da Temperatura: Temperatura e diferente — ela muda a constante de equilibrio. Reacoes exotermicas: aumento de temperatura desloca para reagentes. Reacoes endotermicas: aumento favorece produtos.\n5. Papel dos Catalisadores: Catalisadores aceleram ambas as direcoes igualmente. Eles nao deslocam o equilibrio — apenas ajudam a alcancar o equilibrio mais rapido. Util para processos industriais."
    },
    {
      "duration": 62854.10670799995,
      "inputTokens": 2162,
      "output": "{\n  \"intro\": \"¡Bienvenido al equipo, {{NAME}}! Somos los encargados de diseñar el nuevo sistema energético para la estación de investigación \\\"Cumbre Sur\\\", totalmente aislada de la red eléctrica. Nuestro objetivo es que funcione de manera constante y eficiente, sin que el presupuesto explote. Tendremos que tomar decisiones difíciles sobre cómo capturar, almacenar y utilizar la energía, enfrentando las realidades físicas de las conversiones. ¿Listo para el desafío?\",\n  \"reflection\": \"Diseñar sistemas energéticos es el arte de gestionar pérdidas. Como viste, cada conversión de energía cobra su \\\"impuesto\\\" termodinámico. No existe un sistema perfecto: evitar cadenas largas mejora la eficiencia, pero el almacenamiento tiene su propio costo energético. Maximizar la eficiencia suele aumentar los costos económicos, mientras que asegurar la confiabilidad exige considerar la densidad energética de cada tecnología.\",\n  \"steps\": [\n    {\n      \"context\": \"{{NAME}}, necesitamos decidir la fuente primaria. Tenemos mucho sol de día. Podemos instalar paneles solares fotovoltaicos y usar la electricidad directamente, instalar una planta termosolar que caliente un fluido para mover turbinas de vapor, o traer generadores de combustible.\",\n      \"options\": [\n        {\n          \"consequence\": \"Maximizamos la eficiencia inmediata porque evitamos múltiples pasos de conversión. Sin embargo, al depender directamente del sol, la producción cae a cero en cuanto pasa una nube gruesa.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Eficiencia Energética\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Confiabilidad\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Paneles solares fotovoltaicos (directos)\"\n        },\n        {\n          \"consequence\": \"Perdimos mucha energía en la cadena de calor a vapor y luego a electricidad por la segunda ley de la termodinámica. Pero la inercia térmica nos da energía constante incluso en días nublados.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Eficiencia Energética\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Confiabilidad\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Planta termosolar con turbinas de vapor\"\n        },\n        {\n          \"consequence\": \"La altísima densidad energética del combustible nos asegura potencia 24/7 sin importar el clima. Sin embargo, el costo de traer los barriles hasta aquí en helicóptero destruyó nuestro presupuesto operativo.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Confiabilidad\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Viabilidad Económica\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Generadores de combustible fósil\"\n        }\n      ],\n      \"question\": \"¿Qué sistema principal instalamos?\"\n    },\n    {\n      \"context\": \"El sol se oculta y la estación sigue operando. Necesitamos almacenar la energía que sobra durante el día. Podemos usar un banco de baterías de litio, construir un sistema hidroeléctrico bombeando agua a un lago cercano, o generar hidrógeno.\",\n      \"options\": [\n        {\n          \"consequence\": \"La eficiencia de carga y descarga es excelente, perdiendo muy poco en calor. Pero el costo inicial para la gigantesca capacidad que necesitamos se llevó casi todo el capital del proyecto.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Eficiencia Energética\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Viabilidad Económica\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Banco de baterías de litio\"\n        },\n        {\n          \"consequence\": \"Invertimos mucha energía subiendo el agua y perdimos más por fricción al bajarla. El almacenamiento no fue gratis energéticamente, pero el sistema fue muy barato de construir a esta escala.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Eficiencia Energética\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Viabilidad Económica\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Bombeo hidroeléctrico al lago\"\n        },\n        {\n          \"consequence\": \"Usamos la energía excedente para separar agua en hidrógeno. Aunque el gas es fácil de guardar, la electrólisis desperdicia muchísimo calor. Perdimos casi el 40% de la energía útil en el proceso.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Eficiencia Energética\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Viabilidad Económica\",\n              \"impact\": \"neutral\"\n            }\n          ],\n          \"text\": \"Producción y almacenamiento de hidrógeno\"\n        }\n      ],\n      \"question\": \"¿Cómo almacenamos la energía excedente?\"\n    },\n    {\n      \"context\": \"Hace mucho frío por la noche, {{NAME}}, y los laboratorios deben estar a 20 grados. Podemos conectar estufas de resistencia eléctrica directa, instalar bombas de calor, o rediseñar la ventilación para usar el calor de los servidores.\",\n      \"options\": [\n        {\n          \"consequence\": \"Convertimos electricidad en calor con casi 100% de eficiencia local. Sin embargo, usar energía eléctrica de alta calidad para algo tan básico drenó nuestras reservas nocturnas rapidísimo.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Confiabilidad\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Viabilidad Económica\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Estufas de resistencia eléctrica\"\n        },\n        {\n          \"consequence\": \"En lugar de generar calor, usamos electricidad para moverlo desde afuera. Gastamos 1kW eléctrico para obtener 3kW de calor. Aprovechamos la energía maravillosamente, aunque los equipos son costosos.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Eficiencia Energética\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Viabilidad Económica\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Bombas de calor de alta eficiencia\"\n        },\n        {\n          \"consequence\": \"Redirigimos el aire caliente del cuarto de servidores. Como dice la termodinámica, todo uso de energía termina como calor residual. Al aprovecharlo, nuestra demanda eléctrica para calefacción bajó a casi cero.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Eficiencia Energética\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Confiabilidad\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Recuperar calor residual de los equipos\"\n        }\n      ],\n      \"question\": \"¿Qué método usamos para la calefacción?\"\n    },\n    {\n      \"context\": \"El último tema es el transporte. Los investigadores necesitan recorrer terrenos empinados. ¿Compramos vehículos 100% a batería que cargamos con nuestros paneles, o vehículos ligeros de biocombustible que traemos de la ciudad?\",\n      \"options\": [\n        {\n          \"consequence\": \"Aprovechamos nuestra propia red eléctrica limpiamente. Pero debido a la baja densidad energética de las baterías, los vehículos son pesados y tienen poca autonomía para las montañas.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Eficiencia Energética\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Confiabilidad\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Vehículos pesados a batería\"\n        },\n        {\n          \"consequence\": \"La alta densidad energética del líquido permite a los investigadores llevar tanques extras y hacer viajes largos sin preocuparse por el peso. Pero la logística de importar combustible encareció todo.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Confiabilidad\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Viabilidad Económica\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Vehículos ligeros a biocombustible\"\n        },\n        {\n          \"consequence\": \"Usamos vehículos eléctricos con baterías pequeñas intercambiables para reducir peso, mejorando el rendimiento mecánico de los motores. Funciona bien, pero construir estaciones de recambio por toda la montaña fue carísimo.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Eficiencia Energética\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Viabilidad Económica\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Vehículos eléctricos con baterías modulares\"\n        }\n      ],\n      \"question\": \"¿Qué tecnología elegimos para los vehículos?\"\n    }\n  ]\n}",
      "outputTokens": 4773,
      "systemPrompt": "# Role\n\nYou are an expert educational game designer creating a **Challenge** activity for a learning app. Your mission is to design a choose-your-own-adventure scenario where learners make strategic decisions with meaningful consequences, using the lesson's concepts.\n\nYou specialize in crafting narrative experiences that test strategic thinking — not knowledge recall, but the ability to apply concepts and understand trade-offs.\n\n# Why Narrative Challenges Work\n\nGreat challenges don't quiz — they immerse. Learners face realistic scenarios where every choice has consequences. They experience trade-offs firsthand, making the lesson's principles memorable.\n\n- **No \"Right Answer\"**: Every option has pros and cons. Learners engage with WHY, not just WHAT.\n- **Consequences Over Scores**: Instead of winning or losing, learners see the natural results of their choices.\n- **Strategic Thinking**: Understanding the lesson helps navigate trade-offs, but different strategies lead to different outcomes.\n\n# Inputs\n\n- `LESSON_TITLE`: The topic to create a challenge around\n- `LESSON_DESCRIPTION`: Additional context about what this lesson covers\n- `CHAPTER_TITLE`: The chapter context (for understanding scope)\n- `COURSE_TITLE`: The course context (for understanding audience level)\n- `LANGUAGE`: Output language\n- `EXPLANATION_STEPS`: What the learner has already studied\n\n## Language Guidelines\n\n- `en`: Use US English unless the content is region-specific\n- `pt`: Use Brazilian Portuguese unless the content is region-specific\n- `es`: Use Latin American Spanish unless the content is region-specific\n\n# Requirements\n\n## Introduction\n\nThe `intro` field sets the scene (max 500 characters). It should:\n\n- Establish the scenario and the learner's role\n- Explain what they're navigating (a project, situation, decision-making process)\n- Create stakes that feel meaningful\n- Use `{{NAME}}` to personalize\n\n## Steps\n\nCreate 4-6 steps. Each step presents a decision point with 3-4 options.\n\n### Step Structure\n\n- **context**: Maximum 500 characters. Pure dialogue from a colleague setting up the decision. Conversational, no narrator.\n- **question**: Maximum 100 characters. What needs to be decided.\n- **options**: 3-4 choices, each with:\n  - **text**: The choice (max 80 characters)\n  - **consequence**: What happens as a result (max 300 characters). Shown after choosing. Explains the outcome narratively.\n  - **effects**: Array of 1-3 effects showing how this choice impacts different aspects:\n    - **dimension**: A short name for what this affects (e.g., \"Code Quality\", \"Delivery Speed\", \"Team Morale\"). Use 2-4 different dimensions across all options to create meaningful trade-offs. Important: dimensions must be consistent across all steps.\n    - **impact**: Is this `\"positive\"`, `\"neutral\"`, or `\"negative\"` for that dimension?\n\n### Option Design\n\nEvery option should:\n\n- Be a legitimate choice (no obviously wrong answers)\n- Have a clear consequence that connects to lesson concepts\n- Affect 1-3 dimensions (real decisions rarely affect just one thing)\n- Teach something about trade-offs when the consequence is revealed\n\n**No option should be universally best.** Good options might help one dimension but hurt another. This creates genuine trade-offs.\n\n## Reflection\n\nThe `reflection` field (max 500 characters) provides closing insight after all steps. It should:\n\n- Acknowledge that different approaches have merit\n- Connect the experience back to the lesson's key principles\n- Help learners understand how the concepts apply in practice\n\n## Tone & Style\n\n- **Pure dialogue**: NO narrator, NO character prefixes, NO action descriptions\n- **Natural conversation**: Colleagues working through a problem together\n- **Professional but warm**: Light humor when appropriate\n- **Second-person immersion**: The colleague speaks TO the learner\n- **Use `{{NAME}}`** to personalize dialogue\n\n## What to Avoid\n\n- **Quiz-style questions**: This tests strategic thinking, not recall\n- **Obviously correct answers**: Every option should have genuine trade-offs\n- **Narrator text**: Keep it pure dialogue in context\n- **Disconnected consequences**: Consequences should relate to lesson concepts\n- **Too many or too few dimensions**: Use 2-4 different dimension names across all effects for meaningful trade-offs\n\n## Relationship to Previous Activities\n\nThe learner has completed:\n\n- **Background**: WHY this exists\n- **Explanation**: WHAT it is\n- **Mechanics**: HOW it works\n- **Examples**: WHERE it appears\n- **Story**: WHEN to apply this\n\nYour Challenge activity is the capstone: **CAN YOU NAVIGATE THIS?** It tests whether learners can apply concepts strategically. This should feel like a meaningful simulation, not a test.\n\n# Example\n\nFor a lesson on \"Technical Debt\":\n\n**Step 1:**\n\n```json\n{\n  \"context\": \"{{NAME}}, we've got a deadline crunch. The feature works but the code is messy. Ship it now or clean it up first?\",\n  \"question\": \"How do we handle this?\",\n  \"options\": [\n    {\n      \"text\": \"Ship it now, refactor later\",\n      \"consequence\": \"Feature launched on time! But the messy code made the next sprint's work harder. The team spent extra hours untangling dependencies.\",\n      \"effects\": [\n        { \"dimension\": \"Code Quality\", \"impact\": \"negative\" },\n        { \"dimension\": \"Delivery Speed\", \"impact\": \"positive\" }\n      ]\n    },\n    {\n      \"text\": \"Take two more days to refactor\",\n      \"consequence\": \"The code is clean and maintainable. Stakeholders weren't thrilled about the delay, but future changes will be much easier.\",\n      \"effects\": [\n        { \"dimension\": \"Code Quality\", \"impact\": \"positive\" },\n        { \"dimension\": \"Delivery Speed\", \"impact\": \"negative\" }\n      ]\n    },\n    {\n      \"text\": \"Split the team — half ships, half refactors\",\n      \"consequence\": \"Shipped on time with partial cleanup. Neither task got full attention, and the team felt stretched thin.\",\n      \"effects\": [\n        { \"dimension\": \"Code Quality\", \"impact\": \"neutral\" },\n        { \"dimension\": \"Team Morale\", \"impact\": \"negative\" }\n      ]\n    }\n  ]\n}\n```\n\n# Quality Checks\n\nBefore finalizing, verify:\n\n- [ ] Does the intro establish a clear, engaging scenario?\n- [ ] Does every option have a meaningful consequence?\n- [ ] Are consequences connected to lesson principles?\n- [ ] Is there no obviously \"best\" option in each step?\n- [ ] Do options affect multiple dimensions where realistic?\n- [ ] Are dimension names consistent and lesson-relevant across all effects?\n- [ ] Is `{{NAME}}` used appropriately?\n- [ ] Is all dialogue pure conversation (no narrator)?\n- [ ] Does the reflection tie the experience back to the lesson?\n- [ ] Are all constraints met (intro ≤500, context ≤500, question ≤100, text ≤80, consequence ≤300, reflection ≤500)?\n- [ ] Is the step count between 4 and 6?\n- [ ] Does every step have 3-4 options?\n\n# Output Format\n\nReturn an object with:\n\n- **intro**: Scenario introduction (max 500 chars)\n- **steps**: Array of 4-6 step objects, each with:\n  - **context**: Pure dialogue (max 500 chars)\n  - **question**: Decision prompt (max 100 chars)\n  - **options**: Array of 3-4 objects with:\n    - **text**: Choice description (max 80 chars)\n    - **consequence**: What happens (max 300 chars)\n    - **effects**: Array of 1-3 objects with:\n      - **dimension**: Short name for what this affects (use 2-4 different dimensions total)\n      - **impact**: One of \"positive\", \"neutral\", \"negative\"\n- **reflection**: Closing insight connecting to lesson (max 500 chars)\n",
      "testCaseId": "es-physics-energy-conservation-1",
      "userPrompt": "LESSON_TITLE: Conservacion de Energia en Sistemas Reales\nLESSON_DESCRIPTION: Aplicando principios de conservacion de energia para disenar y optimizar sistemas energeticos\nCHAPTER_TITLE: Energia y Trabajo\nCOURSE_TITLE: Fisica Aplicada\nLANGUAGE: es\nEXPLANATION_STEPS:\n1. Conservacion de la Energia: La energia no se crea ni se destruye, solo se transforma. En cada conversion, la energia total se conserva, pero la energia util disminuye. Parte siempre se convierte en calor no aprovechable.\n2. Eficiencia Energetica: La eficiencia mide cuanta energia de entrada se convierte en trabajo util. Ningun proceso es 100% eficiente — siempre hay perdidas. La segunda ley de la termodinamica lo garantiza.\n3. Perdidas en Cadena: Las cadenas de conversion acumulan perdidas. Si cada paso es 90% eficiente, tres pasos dan 0.9³ = 73% eficiencia total. Menos conversiones significa menos perdidas.\n4. Costo del Almacenamiento: El almacenamiento de energia tiene su propio costo energetico. Cargar y descargar baterias pierde energia. Bombear agua cuesta arriba para hidroelectrica tambien. El almacenamiento no es gratis.\n5. Densidad Energetica: La densidad energetica importa. Combustibles fosiles almacenan mucha energia por kilogramo. Las baterias almacenan menos. Esto afecta que es practico para cada aplicacion."
    }
  ],
  "taskId": "activity-challenge"
}
