{
  "generatedAt": "2026-02-21T22:55:21.992Z",
  "modelId": "anthropic/claude-sonnet-4.6",
  "outputs": [
    {
      "duration": 47550.99662500003,
      "inputTokens": 2763,
      "output": "{\n  \"intro\": \"{{NAME}}, welcome to ByteStream's backend team! You're the lead engineer on a high-traffic recommendation engine launching in 6 weeks. Every decision you make will affect performance, infrastructure costs, and team velocity. The choices won't always be obvious — sometimes the fastest algorithm isn't the right one. Ready to make some tough calls?\",\n  \"reflection\": \"No single strategy dominated every dimension. Choosing O(1) lookup costs memory; reducing space costs time; optimizing for average case risks worst-case spikes. Real-world algorithm design means understanding your constraints — traffic patterns, hardware limits, deadlines — and making deliberate trade-offs. That's what complexity analysis is really for: not just measuring algorithms, but empowering smarter decisions.\",\n  \"steps\": [\n    {\n      \"context\": \"{{NAME}}, we need to match users to recommended items — millions of lookups per second. I'm torn between two approaches. A hash table gives us O(1) average lookup but chews through RAM. A binary search on a sorted array is O(log n) and barely uses memory. Our servers have 16GB RAM and we're already at 70% usage.\",\n      \"options\": [\n        {\n          \"consequence\": \"Lookups are blazing fast — users get instant recommendations. But memory spikes to 95% under peak load, causing three near-outages in week one. Ops is not happy.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Runtime Performance\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Memory Usage\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Go with hash table for O(1) lookup\"\n        },\n        {\n          \"consequence\": \"Memory stays comfortable, but at 10M users O(log n) adds measurable latency. A/B tests show a 12% drop in recommendation click-through. Fast enough, but not great.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Runtime Performance\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Memory Usage\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Use sorted array with binary search\"\n        },\n        {\n          \"consequence\": \"Cache hit rate of 80% keeps most lookups O(1) while RAM stays at 78%. Cache misses fall back to binary search. Some complexity added to the codebase, but a solid balance.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Runtime Performance\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Memory Usage\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Code Complexity\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Hybrid: cache hot users, binary search the rest\"\n        }\n      ],\n      \"question\": \"Which lookup strategy do we use for the recommendation engine?\"\n    },\n    {\n      \"context\": \"Our item catalog has 2 million entries and users search it constantly. A junior dev wrote a nested-loop approach — it works but it's O(n²). I benchmarked it: fine at 1,000 items, painfully slow at 2 million. We could rewrite it with sorting plus binary search for O(n log n), but that's a week of work. Launch is in 5 weeks.\",\n      \"options\": [\n        {\n          \"consequence\": \"Shipping on time felt great until search times hit 40 seconds under real load. We had to hotfix the week after launch anyway — except now we're doing it under pressure with angry users.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Delivery Speed\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Runtime Performance\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Ship O(n²) now, optimize post-launch\"\n        },\n        {\n          \"consequence\": \"Week delay hurts, but the O(n log n) solution handles 2M items smoothly at launch. Stakeholders grumble about the slip, but no performance fires to fight post-launch.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Runtime Performance\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Delivery Speed\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Delay launch 1 week to implement O(n log n)\"\n        },\n        {\n          \"consequence\": \"The O(n log n) rewrite is done but rough. Two edge case bugs slip through. The team worked nights to hit the deadline and morale dips. Performance is solid, stress levels are high.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Runtime Performance\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Delivery Speed\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Team Morale\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Crunch and rewrite it before launch anyway\"\n        }\n      ],\n      \"question\": \"How do we handle the O(n²) catalog search before launch?\"\n    },\n    {\n      \"context\": \"{{NAME}}, I've been looking at our sorting routine for ranking recommendations. We default to Quicksort — O(n log n) average — but I just realized that if users have already-sorted data, we hit O(n²) worst case constantly. Heapsort guarantees O(n log n) always, but it's slower in practice due to cache misses. Merge sort is stable and predictable, but needs O(n) extra space.\",\n      \"options\": [\n        {\n          \"consequence\": \"Works great for random data. But 30% of our users have nearly-sorted histories, and those hit worst case. Tail latency spikes to 8x the average. Median looks fine; p99 looks terrible.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Runtime Performance\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Memory Usage\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Keep Quicksort — best average case\"\n        },\n        {\n          \"consequence\": \"Worst-case latency disappears entirely. But heap's poor cache locality makes average performance 20-30% slower than Quicksort. Consistent, but consistently slower.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Runtime Performance\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Memory Usage\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Switch to Heapsort — guaranteed O(n log n)\"\n        },\n        {\n          \"consequence\": \"Stable, predictable O(n log n) in all cases. Memory overhead is manageable given our data sizes. No worst-case surprises. Slightly more RAM used, but the engineering team loves the predictability.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Runtime Performance\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Memory Usage\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Team Morale\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Use Merge Sort — predictable with O(n) space\"\n        }\n      ],\n      \"question\": \"Which sorting algorithm do we use for ranking recommendations?\"\n    },\n    {\n      \"context\": \"The recommendation list grows dynamically as users scroll. I implemented it with a linked list — O(1) insert anywhere. But a teammate says we should use an ArrayList. Sure, ArrayList resize is occasionally O(n), but amortized it's O(1) append — and cache-friendly traversal is way faster. Our typical list size is 50-500 items.\",\n      \"options\": [\n        {\n          \"consequence\": \"Inserts are always O(1), but cache-unfriendly traversal tanks read performance — we traverse way more than we insert. Users scrolling through recs see stuttering on slower devices.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Runtime Performance\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Code Complexity\",\n              \"impact\": \"neutral\"\n            }\n          ],\n          \"text\": \"Keep linked list for guaranteed O(1) inserts\"\n        },\n        {\n          \"consequence\": \"Traversal is cache-friendly and fast. Occasional resize costs are negligible amortized. At 50-500 elements, resize almost never triggers. Scrolling feels smooth across all devices.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Runtime Performance\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Memory Usage\",\n              \"impact\": \"neutral\"\n            }\n          ],\n          \"text\": \"Switch to ArrayList — amortized O(1) is enough\"\n        },\n        {\n          \"consequence\": \"You benchmark both. ArrayList wins on traversal by 3x for your data size. The amortized analysis confirms resize cost is trivial. You switch with confidence and document the reasoning clearly.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Runtime Performance\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Code Complexity\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Team Morale\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Benchmark first, then decide based on actual data\"\n        }\n      ],\n      \"question\": \"Linked list or ArrayList for the dynamic recommendation list?\"\n    },\n    {\n      \"context\": \"{{NAME}}, we're seeing occasional 10-second freezes in production. I suspect it's our graph traversal for finding related items — it's BFS, which is O(V+E). But for dense graphs it gets heavy. We could precompute relationships nightly and store them — O(1) lookup during requests, but a 50GB storage cost and a complex ETL pipeline. Or we can keep computing on the fly and just optimize the BFS implementation.\",\n      \"options\": [\n        {\n          \"consequence\": \"Freezes drop to near-zero. Lookup is instant. But the ETL job fails twice in the first month, serving stale data. Storage costs balloon. The ops team files three incident reports about the pipeline.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Runtime Performance\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Memory Usage\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Code Complexity\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Precompute everything — trade space for O(1) time\"\n        },\n        {\n          \"consequence\": \"Optimized BFS cuts freeze frequency by 60%. But dense-graph edge cases still cause spikes. For 95% of users it's fine; the other 5% still see delays. Good enough, or not good enough?\",\n          \"effects\": [\n            {\n              \"dimension\": \"Runtime Performance\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Memory Usage\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Optimize BFS — keep computation, reduce constant factors\"\n        },\n        {\n          \"consequence\": \"Top 10% of dense graphs get precomputed; the rest stay BFS. Storage drops to 5GB. Freezes nearly disappear. It's more logic to maintain, but the trade-off is well-calibrated to actual usage patterns.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Runtime Performance\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Memory Usage\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Code Complexity\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Selective precomputation based on graph density\"\n        }\n      ],\n      \"question\": \"How do we fix the graph traversal performance spikes?\"\n    }\n  ]\n}",
      "outputTokens": 2130,
      "systemPrompt": "# Role\n\nYou are an expert educational game designer creating a **Challenge** activity for a learning app. Your mission is to design a choose-your-own-adventure scenario where learners make strategic decisions with meaningful consequences, using the lesson's concepts.\n\nYou specialize in crafting narrative experiences that test strategic thinking — not knowledge recall, but the ability to apply concepts and understand trade-offs.\n\n# Why Narrative Challenges Work\n\nGreat challenges don't quiz — they immerse. Learners face realistic scenarios where every choice has consequences. They experience trade-offs firsthand, making the lesson's principles memorable.\n\n- **No \"Right Answer\"**: Every option has pros and cons. Learners engage with WHY, not just WHAT.\n- **Consequences Over Scores**: Instead of winning or losing, learners see the natural results of their choices.\n- **Strategic Thinking**: Understanding the lesson helps navigate trade-offs, but different strategies lead to different outcomes.\n\n# Inputs\n\n- `LESSON_TITLE`: The topic to create a challenge around\n- `LESSON_DESCRIPTION`: Additional context about what this lesson covers\n- `CHAPTER_TITLE`: The chapter context (for understanding scope)\n- `COURSE_TITLE`: The course context (for understanding audience level)\n- `LANGUAGE`: Output language\n- `EXPLANATION_STEPS`: What the learner has already studied\n\n## Language Guidelines\n\n- `en`: Use US English unless the content is region-specific\n- `pt`: Use Brazilian Portuguese unless the content is region-specific\n- `es`: Use Latin American Spanish unless the content is region-specific\n\n# Requirements\n\n## Introduction\n\nThe `intro` field sets the scene (max 500 characters). It should:\n\n- Establish the scenario and the learner's role\n- Explain what they're navigating (a project, situation, decision-making process)\n- Create stakes that feel meaningful\n- Use `{{NAME}}` to personalize\n\n## Steps\n\nCreate 4-6 steps. Each step presents a decision point with 3-4 options.\n\n### Step Structure\n\n- **context**: Maximum 500 characters. Pure dialogue from a colleague setting up the decision. Conversational, no narrator.\n- **question**: Maximum 100 characters. What needs to be decided.\n- **options**: 3-4 choices, each with:\n  - **text**: The choice (max 80 characters)\n  - **consequence**: What happens as a result (max 300 characters). Shown after choosing. Explains the outcome narratively.\n  - **effects**: Array of 1-3 effects showing how this choice impacts different aspects:\n    - **dimension**: A short name for what this affects (e.g., \"Code Quality\", \"Delivery Speed\", \"Team Morale\"). Use 2-4 different dimensions across all options to create meaningful trade-offs. Important: dimensions must be consistent across all steps.\n    - **impact**: Is this `\"positive\"`, `\"neutral\"`, or `\"negative\"` for that dimension?\n\n### Option Design\n\nEvery option should:\n\n- Be a legitimate choice (no obviously wrong answers)\n- Have a clear consequence that connects to lesson concepts\n- Affect 1-3 dimensions (real decisions rarely affect just one thing)\n- Teach something about trade-offs when the consequence is revealed\n\n**No option should be universally best.** Good options might help one dimension but hurt another. This creates genuine trade-offs.\n\n## Reflection\n\nThe `reflection` field (max 500 characters) provides closing insight after all steps. It should:\n\n- Acknowledge that different approaches have merit\n- Connect the experience back to the lesson's key principles\n- Help learners understand how the concepts apply in practice\n\n## Tone & Style\n\n- **Pure dialogue**: NO narrator, NO character prefixes, NO action descriptions\n- **Natural conversation**: Colleagues working through a problem together\n- **Professional but warm**: Light humor when appropriate\n- **Second-person immersion**: The colleague speaks TO the learner\n- **Use `{{NAME}}`** to personalize dialogue\n\n## What to Avoid\n\n- **Quiz-style questions**: This tests strategic thinking, not recall\n- **Obviously correct answers**: Every option should have genuine trade-offs\n- **Narrator text**: Keep it pure dialogue in context\n- **Disconnected consequences**: Consequences should relate to lesson concepts\n- **Too many or too few dimensions**: Use 2-4 different dimension names across all effects for meaningful trade-offs\n\n## Relationship to Previous Activities\n\nThe learner has completed:\n\n- **Background**: WHY this exists\n- **Explanation**: WHAT it is\n- **Mechanics**: HOW it works\n- **Examples**: WHERE it appears\n- **Story**: WHEN to apply this\n\nYour Challenge activity is the capstone: **CAN YOU NAVIGATE THIS?** It tests whether learners can apply concepts strategically. This should feel like a meaningful simulation, not a test.\n\n# Example\n\nFor a lesson on \"Technical Debt\":\n\n**Step 1:**\n\n```json\n{\n  \"context\": \"{{NAME}}, we've got a deadline crunch. The feature works but the code is messy. Ship it now or clean it up first?\",\n  \"question\": \"How do we handle this?\",\n  \"options\": [\n    {\n      \"text\": \"Ship it now, refactor later\",\n      \"consequence\": \"Feature launched on time! But the messy code made the next sprint's work harder. The team spent extra hours untangling dependencies.\",\n      \"effects\": [\n        { \"dimension\": \"Code Quality\", \"impact\": \"negative\" },\n        { \"dimension\": \"Delivery Speed\", \"impact\": \"positive\" }\n      ]\n    },\n    {\n      \"text\": \"Take two more days to refactor\",\n      \"consequence\": \"The code is clean and maintainable. Stakeholders weren't thrilled about the delay, but future changes will be much easier.\",\n      \"effects\": [\n        { \"dimension\": \"Code Quality\", \"impact\": \"positive\" },\n        { \"dimension\": \"Delivery Speed\", \"impact\": \"negative\" }\n      ]\n    },\n    {\n      \"text\": \"Split the team — half ships, half refactors\",\n      \"consequence\": \"Shipped on time with partial cleanup. Neither task got full attention, and the team felt stretched thin.\",\n      \"effects\": [\n        { \"dimension\": \"Code Quality\", \"impact\": \"neutral\" },\n        { \"dimension\": \"Team Morale\", \"impact\": \"negative\" }\n      ]\n    }\n  ]\n}\n```\n\n# Quality Checks\n\nBefore finalizing, verify:\n\n- [ ] Does the intro establish a clear, engaging scenario?\n- [ ] Does every option have a meaningful consequence?\n- [ ] Are consequences connected to lesson principles?\n- [ ] Is there no obviously \"best\" option in each step?\n- [ ] Do options affect multiple dimensions where realistic?\n- [ ] Are dimension names consistent and lesson-relevant across all effects?\n- [ ] Is `{{NAME}}` used appropriately?\n- [ ] Is all dialogue pure conversation (no narrator)?\n- [ ] Does the reflection tie the experience back to the lesson?\n- [ ] Are all constraints met (intro ≤500, context ≤500, question ≤100, text ≤80, consequence ≤300, reflection ≤500)?\n- [ ] Is the step count between 4 and 6?\n- [ ] Does every step have 3-4 options?\n\n# Output Format\n\nReturn an object with:\n\n- **intro**: Scenario introduction (max 500 chars)\n- **steps**: Array of 4-6 step objects, each with:\n  - **context**: Pure dialogue (max 500 chars)\n  - **question**: Decision prompt (max 100 chars)\n  - **options**: Array of 3-4 objects with:\n    - **text**: Choice description (max 80 chars)\n    - **consequence**: What happens (max 300 chars)\n    - **effects**: Array of 1-3 objects with:\n      - **dimension**: Short name for what this affects (use 2-4 different dimensions total)\n      - **impact**: One of \"positive\", \"neutral\", \"negative\"\n- **reflection**: Closing insight connecting to lesson (max 500 chars)\n",
      "testCaseId": "en-cs-algorithm-complexity-1",
      "userPrompt": "LESSON_TITLE: Algorithm Complexity Trade-offs\nLESSON_DESCRIPTION: Understanding and applying algorithm complexity analysis to make informed trade-offs in software design\nCHAPTER_TITLE: Algorithm Analysis\nCOURSE_TITLE: Data Structures and Algorithms\nLANGUAGE: en\nEXPLANATION_STEPS:\n1. Time Complexity: Time complexity measures how execution time grows with input size. O(n) means linear growth — double the input, double the time. O(n²) means quadratic — double the input, quadruple the time.\n2. Space Complexity: Space complexity measures memory usage growth. Some algorithms trade time for space — storing precomputed results to avoid recalculation. Others trade space for time — using less memory but computing more.\n3. Time-Space Trade-off: The time-space trade-off is fundamental. Hash tables give O(1) lookup but use extra memory. Binary search uses O(1) space but requires sorted data. Choose based on constraints.\n4. Amortized Analysis: Amortized analysis looks at average performance over many operations. ArrayList append is usually O(1), but occasionally O(n) when resizing. Amortized, it's still O(1).\n5. Case Analysis: Best, average, and worst case can differ dramatically. Quicksort averages O(n log n) but worst-cases to O(n²). Know your data distribution to choose wisely."
    },
    {
      "duration": 47083.51320799999,
      "inputTokens": 2729,
      "output": "{\n  \"intro\": \"{{NAME}}, welcome to your first week as a pricing strategist at Mova, a growing consumer tech startup. The team is under pressure — a competitor just cut prices, a new product launch is weeks away, and the data is pointing in different directions. Your job is to help the team navigate critical pricing and market decisions. Every choice has trade-offs. Let's see how you think.\",\n  \"reflection\": \"Different choices reflect different strategic priorities — and that's exactly how real markets work. Supply and demand principles don't hand you a single right answer; they clarify trade-offs. Equilibrium guides pricing, elasticity shapes risk, and curve shifts reveal hidden opportunities. The skill isn't memorizing theory — it's knowing which principle to apply when the stakes are real.\",\n  \"steps\": [\n    {\n      \"context\": \"{{NAME}}, our competitor just dropped their price by 15%. Sales data shows our customers are pretty loyal — they rarely switch brands even when prices differ. Leadership wants to match the cut immediately to avoid losing market share. But our margins are already thin. What do you think we should do?\",\n      \"options\": [\n        {\n          \"consequence\": \"We held margins and most loyal customers stayed. A small segment switched to the competitor, but our revenue held up. Inelastic demand worked in our favor — price sensitivity was low, just as the data suggested.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Revenue\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Market Share\",\n              \"impact\": \"neutral\"\n            }\n          ],\n          \"text\": \"Hold our price — our demand is inelastic\"\n        },\n        {\n          \"consequence\": \"We matched the cut and protected volume, but margins took a serious hit. Since demand was already inelastic, the move wasn't necessary — we essentially gave up profit without meaningfully changing behavior.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Revenue\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Market Share\",\n              \"impact\": \"neutral\"\n            }\n          ],\n          \"text\": \"Match the competitor's price cut immediately\"\n        },\n        {\n          \"consequence\": \"The small discount signaled responsiveness without destroying margins. Some customers appreciated it. But it muddied our premium positioning and set a precedent for future price negotiations.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Revenue\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Market Share\",\n              \"impact\": \"neutral\"\n            }\n          ],\n          \"text\": \"Offer a modest 5% discount as a middle ground\"\n        }\n      ],\n      \"question\": \"How do you respond to the competitor's price cut?\"\n    },\n    {\n      \"context\": \"We're about to launch our new smart speaker, the Mova Echo. R&D costs were high, and the board wants to recover investment quickly. Marketing says early adopters will pay a premium, but our ops team says a lower launch price would move more units fast and lock in market share. {{NAME}}, what's your call on launch pricing?\",\n      \"options\": [\n        {\n          \"consequence\": \"Early adopters paid the premium and margins were strong. But mass-market adoption was slow. When we eventually cut the price, some early buyers felt burned — a classic skimming risk. Demand for the broader segment remained untapped.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Revenue\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Market Share\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Launch high — price skimming for early adopters\"\n        },\n        {\n          \"consequence\": \"Volume surged and we quickly built a loyal user base. But recovering R&D costs took much longer, and investors questioned profitability. We moved along the demand curve fast, but margins stayed thin for months.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Market Share\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Revenue\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Launch low — penetration pricing to grab share\"\n        },\n        {\n          \"consequence\": \"We captured mid-market customers and maintained decent margins. Neither extreme worked fully in our favor — some premium buyers passed, and budget shoppers looked elsewhere. A stable but unremarkable launch.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Revenue\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Market Share\",\n              \"impact\": \"neutral\"\n            }\n          ],\n          \"text\": \"Launch at equilibrium price based on market data\"\n        }\n      ],\n      \"question\": \"What's the right launch pricing strategy for Mova Echo?\"\n    },\n    {\n      \"context\": \"{{NAME}}, supply chain just flagged a problem — a key component shortage is hitting our production capacity hard. We can only make 60% of our usual volume next quarter. Finance wants to raise prices to manage the reduced supply. But customer success is worried about backlash. How should we handle this?\",\n      \"options\": [\n        {\n          \"consequence\": \"The price increase reflected the new supply-demand equilibrium. Some customers pushed back, but shortages were avoided and margins improved. Clear communication about supply constraints helped soften the reaction.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Revenue\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Customer Trust\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Raise prices to reflect reduced supply\"\n        },\n        {\n          \"consequence\": \"We kept prices steady but couldn't meet demand. Shortages frustrated customers, created chaos in distribution, and left revenue on the table. Holding price below equilibrium created a classic shortage scenario.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Customer Trust\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Revenue\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Keep prices the same and manage shortages\"\n        },\n        {\n          \"consequence\": \"We prioritized high-margin segments and offered waitlists to others. Revenue held up, but smaller customers felt deprioritized. Efficient in the short run, but some relationships were damaged.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Revenue\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Customer Trust\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Allocate limited supply to highest-paying customers\"\n        }\n      ],\n      \"question\": \"How do you respond to the supply shortage?\"\n    },\n    {\n      \"context\": \"Great news — a major lifestyle magazine just featured Mova Echo in their 'Top Gadgets' list. Demand is spiking way beyond our forecast. This is a demand curve shift, not just movement along it. {{NAME}}, how do we capitalize without overextending? Operations says scaling up takes at least 6 weeks.\",\n      \"options\": [\n        {\n          \"consequence\": \"We captured the surge's full value and revenue jumped. But stockouts hit after two weeks, frustrated late buyers, and created negative reviews. The short-term gain came with a brand trust cost.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Revenue\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Customer Trust\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Raise prices temporarily to slow demand\"\n        },\n        {\n          \"consequence\": \"We kept customers happy and built goodwill. But we left significant revenue on the table — the demand curve had shifted right, meaning customers were willing to pay more. A missed pricing opportunity.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Customer Trust\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Revenue\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Keep prices stable and fulfill orders as they come\"\n        },\n        {\n          \"consequence\": \"The waitlist preserved demand and set expectations. Customers appreciated transparency. Revenue was delayed but the surge was captured over a longer window without brand damage or margin sacrifice.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Customer Trust\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Revenue\",\n              \"impact\": \"neutral\"\n            }\n          ],\n          \"text\": \"Launch a waitlist and communicate supply timelines\"\n        },\n        {\n          \"consequence\": \"Bundling shifted some demand to complementary products, easing pressure on Echo inventory. Revenue per transaction rose. But some customers just wanted the speaker and were put off by the upsell.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Revenue\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Market Share\",\n              \"impact\": \"neutral\"\n            }\n          ],\n          \"text\": \"Bundle Echo with accessories to manage demand\"\n        }\n      ],\n      \"question\": \"How do you handle the unexpected demand surge?\"\n    },\n    {\n      \"context\": \"{{NAME}}, it's end of quarter and we have excess inventory — about 30% more units than projected. The demand forecast was off. Leadership is pushing for a flash sale to clear stock, but brand management warns that frequent discounting trains customers to wait for sales. What do you recommend?\",\n      \"options\": [\n        {\n          \"consequence\": \"Stock cleared quickly and cash flow improved. But the discount signaled desperation to the market, and several customers who paid full price complained. Surplus eliminated, but brand equity took a small hit.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Revenue\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Customer Trust\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Run the flash sale — clear inventory fast\"\n        },\n        {\n          \"consequence\": \"We avoided brand damage and maintained pricing integrity. But the surplus carried into next quarter, tying up capital and warehouse space. A disciplined choice with real short-term costs.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Customer Trust\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Revenue\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Hold firm on price — no discounting\"\n        },\n        {\n          \"consequence\": \"Bundles moved inventory without advertising a price cut. Customers perceived added value rather than desperation. Margin compression was moderate, and brand positioning stayed intact.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Revenue\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Customer Trust\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Bundle slow-moving inventory with popular products\"\n        },\n        {\n          \"consequence\": \"B2B deals moved large volumes quietly without public discounting. Margins were thin but acceptable, and retail pricing stayed protected. Took time to negotiate — not all surplus cleared before quarter end.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Revenue\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Market Share\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Sell excess inventory to a B2B partner at bulk pricing\"\n        }\n      ],\n      \"question\": \"How do you handle the inventory surplus?\"\n    }\n  ]\n}",
      "outputTokens": 1961,
      "systemPrompt": "# Role\n\nYou are an expert educational game designer creating a **Challenge** activity for a learning app. Your mission is to design a choose-your-own-adventure scenario where learners make strategic decisions with meaningful consequences, using the lesson's concepts.\n\nYou specialize in crafting narrative experiences that test strategic thinking — not knowledge recall, but the ability to apply concepts and understand trade-offs.\n\n# Why Narrative Challenges Work\n\nGreat challenges don't quiz — they immerse. Learners face realistic scenarios where every choice has consequences. They experience trade-offs firsthand, making the lesson's principles memorable.\n\n- **No \"Right Answer\"**: Every option has pros and cons. Learners engage with WHY, not just WHAT.\n- **Consequences Over Scores**: Instead of winning or losing, learners see the natural results of their choices.\n- **Strategic Thinking**: Understanding the lesson helps navigate trade-offs, but different strategies lead to different outcomes.\n\n# Inputs\n\n- `LESSON_TITLE`: The topic to create a challenge around\n- `LESSON_DESCRIPTION`: Additional context about what this lesson covers\n- `CHAPTER_TITLE`: The chapter context (for understanding scope)\n- `COURSE_TITLE`: The course context (for understanding audience level)\n- `LANGUAGE`: Output language\n- `EXPLANATION_STEPS`: What the learner has already studied\n\n## Language Guidelines\n\n- `en`: Use US English unless the content is region-specific\n- `pt`: Use Brazilian Portuguese unless the content is region-specific\n- `es`: Use Latin American Spanish unless the content is region-specific\n\n# Requirements\n\n## Introduction\n\nThe `intro` field sets the scene (max 500 characters). It should:\n\n- Establish the scenario and the learner's role\n- Explain what they're navigating (a project, situation, decision-making process)\n- Create stakes that feel meaningful\n- Use `{{NAME}}` to personalize\n\n## Steps\n\nCreate 4-6 steps. Each step presents a decision point with 3-4 options.\n\n### Step Structure\n\n- **context**: Maximum 500 characters. Pure dialogue from a colleague setting up the decision. Conversational, no narrator.\n- **question**: Maximum 100 characters. What needs to be decided.\n- **options**: 3-4 choices, each with:\n  - **text**: The choice (max 80 characters)\n  - **consequence**: What happens as a result (max 300 characters). Shown after choosing. Explains the outcome narratively.\n  - **effects**: Array of 1-3 effects showing how this choice impacts different aspects:\n    - **dimension**: A short name for what this affects (e.g., \"Code Quality\", \"Delivery Speed\", \"Team Morale\"). Use 2-4 different dimensions across all options to create meaningful trade-offs. Important: dimensions must be consistent across all steps.\n    - **impact**: Is this `\"positive\"`, `\"neutral\"`, or `\"negative\"` for that dimension?\n\n### Option Design\n\nEvery option should:\n\n- Be a legitimate choice (no obviously wrong answers)\n- Have a clear consequence that connects to lesson concepts\n- Affect 1-3 dimensions (real decisions rarely affect just one thing)\n- Teach something about trade-offs when the consequence is revealed\n\n**No option should be universally best.** Good options might help one dimension but hurt another. This creates genuine trade-offs.\n\n## Reflection\n\nThe `reflection` field (max 500 characters) provides closing insight after all steps. It should:\n\n- Acknowledge that different approaches have merit\n- Connect the experience back to the lesson's key principles\n- Help learners understand how the concepts apply in practice\n\n## Tone & Style\n\n- **Pure dialogue**: NO narrator, NO character prefixes, NO action descriptions\n- **Natural conversation**: Colleagues working through a problem together\n- **Professional but warm**: Light humor when appropriate\n- **Second-person immersion**: The colleague speaks TO the learner\n- **Use `{{NAME}}`** to personalize dialogue\n\n## What to Avoid\n\n- **Quiz-style questions**: This tests strategic thinking, not recall\n- **Obviously correct answers**: Every option should have genuine trade-offs\n- **Narrator text**: Keep it pure dialogue in context\n- **Disconnected consequences**: Consequences should relate to lesson concepts\n- **Too many or too few dimensions**: Use 2-4 different dimension names across all effects for meaningful trade-offs\n\n## Relationship to Previous Activities\n\nThe learner has completed:\n\n- **Background**: WHY this exists\n- **Explanation**: WHAT it is\n- **Mechanics**: HOW it works\n- **Examples**: WHERE it appears\n- **Story**: WHEN to apply this\n\nYour Challenge activity is the capstone: **CAN YOU NAVIGATE THIS?** It tests whether learners can apply concepts strategically. This should feel like a meaningful simulation, not a test.\n\n# Example\n\nFor a lesson on \"Technical Debt\":\n\n**Step 1:**\n\n```json\n{\n  \"context\": \"{{NAME}}, we've got a deadline crunch. The feature works but the code is messy. Ship it now or clean it up first?\",\n  \"question\": \"How do we handle this?\",\n  \"options\": [\n    {\n      \"text\": \"Ship it now, refactor later\",\n      \"consequence\": \"Feature launched on time! But the messy code made the next sprint's work harder. The team spent extra hours untangling dependencies.\",\n      \"effects\": [\n        { \"dimension\": \"Code Quality\", \"impact\": \"negative\" },\n        { \"dimension\": \"Delivery Speed\", \"impact\": \"positive\" }\n      ]\n    },\n    {\n      \"text\": \"Take two more days to refactor\",\n      \"consequence\": \"The code is clean and maintainable. Stakeholders weren't thrilled about the delay, but future changes will be much easier.\",\n      \"effects\": [\n        { \"dimension\": \"Code Quality\", \"impact\": \"positive\" },\n        { \"dimension\": \"Delivery Speed\", \"impact\": \"negative\" }\n      ]\n    },\n    {\n      \"text\": \"Split the team — half ships, half refactors\",\n      \"consequence\": \"Shipped on time with partial cleanup. Neither task got full attention, and the team felt stretched thin.\",\n      \"effects\": [\n        { \"dimension\": \"Code Quality\", \"impact\": \"neutral\" },\n        { \"dimension\": \"Team Morale\", \"impact\": \"negative\" }\n      ]\n    }\n  ]\n}\n```\n\n# Quality Checks\n\nBefore finalizing, verify:\n\n- [ ] Does the intro establish a clear, engaging scenario?\n- [ ] Does every option have a meaningful consequence?\n- [ ] Are consequences connected to lesson principles?\n- [ ] Is there no obviously \"best\" option in each step?\n- [ ] Do options affect multiple dimensions where realistic?\n- [ ] Are dimension names consistent and lesson-relevant across all effects?\n- [ ] Is `{{NAME}}` used appropriately?\n- [ ] Is all dialogue pure conversation (no narrator)?\n- [ ] Does the reflection tie the experience back to the lesson?\n- [ ] Are all constraints met (intro ≤500, context ≤500, question ≤100, text ≤80, consequence ≤300, reflection ≤500)?\n- [ ] Is the step count between 4 and 6?\n- [ ] Does every step have 3-4 options?\n\n# Output Format\n\nReturn an object with:\n\n- **intro**: Scenario introduction (max 500 chars)\n- **steps**: Array of 4-6 step objects, each with:\n  - **context**: Pure dialogue (max 500 chars)\n  - **question**: Decision prompt (max 100 chars)\n  - **options**: Array of 3-4 objects with:\n    - **text**: Choice description (max 80 chars)\n    - **consequence**: What happens (max 300 chars)\n    - **effects**: Array of 1-3 objects with:\n      - **dimension**: Short name for what this affects (use 2-4 different dimensions total)\n      - **impact**: One of \"positive\", \"neutral\", \"negative\"\n- **reflection**: Closing insight connecting to lesson (max 500 chars)\n",
      "testCaseId": "en-economics-supply-demand-1",
      "userPrompt": "LESSON_TITLE: Supply and Demand in Practice\nLESSON_DESCRIPTION: Applying supply and demand principles to make strategic pricing and market decisions\nCHAPTER_TITLE: Market Dynamics\nCOURSE_TITLE: Microeconomics Fundamentals\nLANGUAGE: en\nEXPLANATION_STEPS:\n1. The Demand Curve: Demand curves slope downward — as price rises, quantity demanded falls. This reflects the law of demand: people buy less when things cost more, all else equal.\n2. The Supply Curve: Supply curves slope upward — as price rises, quantity supplied increases. Higher prices incentivize producers to make more. Lower prices make production less worthwhile.\n3. Market Equilibrium: Equilibrium occurs where supply meets demand. At this price, quantity supplied equals quantity demanded. Prices above equilibrium create surplus; prices below create shortage.\n4. Price Elasticity: Price elasticity measures responsiveness to price changes. Elastic demand (>1) means sales drop sharply with price increases. Inelastic demand (<1) means sales barely change.\n5. Shifts vs. Movements: Shifts vs. movements: A change in price moves along the curve. Changes in other factors (income, preferences, costs) shift the entire curve. This distinction is crucial."
    },
    {
      "duration": 50986.66983400006,
      "inputTokens": 2742,
      "output": "{\n  \"intro\": \"{{NAME}}, welcome to Ridgewood Valley — a mixed woodland ecosystem under your care as the new conservation manager. The valley is showing signs of stress: elk populations are rising, some plant communities are thinning, and local stakeholders have competing demands. Every decision you make will ripple through the food web. Let's see how you navigate it.\",\n  \"reflection\": \"Every choice you made reflected real ecological trade-offs. No single strategy dominates — quick interventions can destabilize succession, while inaction lets imbalances compound. Biodiversity, carrying capacity, trophic dynamics, and stakeholder trust are all connected. Great ecosystem management means accepting complexity and thinking several steps ahead.\",\n  \"steps\": [\n    {\n      \"context\": \"{{NAME}}, the elk census just came in — population is up 40% from last year. We're seeing overgrazing along the riverbank, and riparian plants are struggling. Some folks want to cull, others want to reintroduce wolves. What's your call?\",\n      \"options\": [\n        {\n          \"consequence\": \"Numbers dropped quickly and overgrazing slowed. But stakeholders are upset, hunting pressure is uneven across the valley, and the ecosystem still lacks a natural regulator. You've bought time, not a solution.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Ecosystem Balance\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Stakeholder Trust\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Biodiversity\",\n              \"impact\": \"neutral\"\n            }\n          ],\n          \"text\": \"Authorize a managed elk cull\"\n        },\n        {\n          \"consequence\": \"Wolves returned and elk began avoiding riparian zones — a classic trophic cascade. Vegetation recovered. But ranchers near the valley edge are reporting livestock stress and demanding compensation.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Ecosystem Balance\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Biodiversity\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Stakeholder Trust\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Reintroduce gray wolves\"\n        },\n        {\n          \"consequence\": \"Elk numbers stabilized but vegetation recovery is slow. Fencing is expensive and must be maintained indefinitely. You've treated the symptom without addressing the underlying imbalance.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Ecosystem Balance\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Biodiversity\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Stakeholder Trust\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Install protective fencing around riparian zones\"\n        },\n        {\n          \"consequence\": \"The coalition is engaged and trust is high, but the process takes months. Overgrazing continues in the meantime, and early successional plants begin replacing the riparian community.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Stakeholder Trust\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Ecosystem Balance\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Biodiversity\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Convene a stakeholder working group first\"\n        }\n      ],\n      \"question\": \"How do you address the elk overpopulation?\"\n    },\n    {\n      \"context\": \"The oak grove in the valley's center is aging. Few young oaks are establishing — the canopy is too dense for seedlings. A colleague suggests a controlled burn to reset succession and open the understory. Residents near the grove are nervous about fire.\",\n      \"options\": [\n        {\n          \"consequence\": \"The burn worked beautifully. Pioneer species moved in, sunlight reached the floor, and oak seedlings are establishing. Smoke caused two days of community tension, but long-term succession is back on track.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Ecosystem Balance\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Biodiversity\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Stakeholder Trust\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Proceed with a prescribed burn\"\n        },\n        {\n          \"consequence\": \"Selective logging opened gaps in the canopy. Seedlings are establishing, but the disturbance pattern is uneven and some cleared areas are being colonized by invasive shrubs instead of oaks.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Biodiversity\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Ecosystem Balance\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Stakeholder Trust\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Selectively log the oldest trees instead\"\n        },\n        {\n          \"consequence\": \"The grove continues declining. Canopy gaps form naturally but slowly, and invasive species are capitalizing on each one faster than native seedlings can. Succession is drifting in an unplanned direction.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Ecosystem Balance\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Biodiversity\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Stakeholder Trust\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Leave it alone — let natural succession proceed\"\n        },\n        {\n          \"consequence\": \"Seeding helped in accessible areas, but without canopy reduction the seedlings are etiolated and struggling. You've spent budget without addressing the root cause of the succession stall.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Ecosystem Balance\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Stakeholder Trust\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Biodiversity\",\n              \"impact\": \"neutral\"\n            }\n          ],\n          \"text\": \"Plant native oak seedlings in gaps without burning\"\n        }\n      ],\n      \"question\": \"How do you manage the aging oak grove?\"\n    },\n    {\n      \"context\": \"{{NAME}}, our meadow section is being considered for a wildflower seed program. One vendor offers a high-yield mix of just three native species — fast, cheap, cost-effective. Another offers a 22-species diverse mix that's slower to establish and pricier. Budget is tight this season.\",\n      \"options\": [\n        {\n          \"consequence\": \"The meadow greened up fast and looks great in photos. But one species dominated, and pollinators with specialized needs aren't showing up. The meadow is productive but ecologically shallow.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Biodiversity\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Ecosystem Balance\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Stakeholder Trust\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Go with the efficient 3-species mix\"\n        },\n        {\n          \"consequence\": \"Establishment is slow and patchy. But by year two, pollinator diversity is up significantly, and the meadow is showing resistance to a drought event that damaged neighboring monocultures.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Biodiversity\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Ecosystem Balance\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Stakeholder Trust\",\n              \"impact\": \"neutral\"\n            }\n          ],\n          \"text\": \"Invest in the 22-species diverse mix\"\n        },\n        {\n          \"consequence\": \"A pragmatic split: core zones got the diverse mix, high-visibility edges got the fast mix. Results are mixed — biodiversity gains are partial, and neither zone reached its full potential.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Biodiversity\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Ecosystem Balance\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Stakeholder Trust\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Use the cheap mix in half, diverse mix in half\"\n        },\n        {\n          \"consequence\": \"You preserved budget and the meadow recovered naturally with local seed rain. But recovery is slow and weedy. Some invasive annuals established before native perennials could compete.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Ecosystem Balance\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Biodiversity\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Stakeholder Trust\",\n              \"impact\": \"neutral\"\n            }\n          ],\n          \"text\": \"Defer seeding — let the meadow self-restore\"\n        }\n      ],\n      \"question\": \"Which seeding approach do you choose for the meadow?\"\n    },\n    {\n      \"context\": \"A regional agency is offering funding to convert 15% of the valley's mixed woodland into a fast-growing timber plantation — monoculture pines. It would bring in revenue and local jobs. Several board members are enthusiastic. You've seen how monocultures behave under stress.\",\n      \"options\": [\n        {\n          \"consequence\": \"Revenue flows in and the board is pleased. But within three years, a pine bark beetle outbreak — common in monocultures — sweeps through the plantation. The adjacent native woodland is unaffected but the economic argument is now complicated.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Ecosystem Balance\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Stakeholder Trust\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Biodiversity\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Accept the plantation proposal as offered\"\n        },\n        {\n          \"consequence\": \"The agency accepts the modification. Biodiversity corridors kept the monoculture's risks contained. Revenue came in, though slightly reduced. Not ideal ecologically, but a meaningful compromise.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Ecosystem Balance\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Biodiversity\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Stakeholder Trust\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Negotiate: accept funding with mandatory buffer zones\"\n        },\n        {\n          \"consequence\": \"Board members are frustrated by lost revenue. You spend months making the ecological case. Eventually, an ecotourism grant partially replaces the funding — but relations with some stakeholders remain strained.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Ecosystem Balance\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Biodiversity\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Stakeholder Trust\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Decline the proposal and seek alternative funding\"\n        },\n        {\n          \"consequence\": \"The study delays the decision for eight months. During that time, the agency redirects funding elsewhere. The valley misses the revenue opportunity and the board questions your decisiveness.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Stakeholder Trust\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Ecosystem Balance\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Biodiversity\",\n              \"impact\": \"neutral\"\n            }\n          ],\n          \"text\": \"Commission a 6-month ecological impact study first\"\n        }\n      ],\n      \"question\": \"How do you respond to the plantation funding offer?\"\n    },\n    {\n      \"context\": \"{{NAME}}, monitoring shows a rare native butterfly depends on a specific early-succession meadow patch that's naturally transitioning to shrubland. If succession continues, the butterfly loses its habitat. Intervening means keeping the ecosystem at an earlier successional stage indefinitely.\",\n      \"options\": [\n        {\n          \"consequence\": \"The butterfly population stabilizes and conservationists applaud the decision. But you're now committed to recurring management costs and must justify halting natural succession to ecologists who prefer hands-off approaches.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Biodiversity\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Ecosystem Balance\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Stakeholder Trust\",\n              \"impact\": \"neutral\"\n            }\n          ],\n          \"text\": \"Actively manage the patch to halt succession\"\n        },\n        {\n          \"consequence\": \"Succession proceeds. The butterfly population declines sharply within two seasons. The shrubland that replaces it supports different species, but the rare butterfly may be locally lost.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Ecosystem Balance\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Biodiversity\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Stakeholder Trust\",\n              \"impact\": \"neutral\"\n            }\n          ],\n          \"text\": \"Allow natural succession — don't intervene\"\n        },\n        {\n          \"consequence\": \"Some eggs were collected before the habitat changed. Captive breeding was partially successful. Reintroduction into a managed patch elsewhere helped, but population genetics suffered from the bottleneck.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Biodiversity\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Ecosystem Balance\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Stakeholder Trust\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Start a captive breeding program as a backup\"\n        },\n        {\n          \"consequence\": \"A new patch was prepared, but the butterfly didn't colonize it naturally within the window needed. The managed patch continued transitioning. You've created potential future habitat but lost the present population.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Biodiversity\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Ecosystem Balance\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Stakeholder Trust\",\n              \"impact\": \"neutral\"\n            }\n          ],\n          \"text\": \"Create alternative early-succession habitat nearby\"\n        }\n      ],\n      \"question\": \"How do you protect the rare butterfly's habitat?\"\n    }\n  ]\n}",
      "outputTokens": 2447,
      "systemPrompt": "# Role\n\nYou are an expert educational game designer creating a **Challenge** activity for a learning app. Your mission is to design a choose-your-own-adventure scenario where learners make strategic decisions with meaningful consequences, using the lesson's concepts.\n\nYou specialize in crafting narrative experiences that test strategic thinking — not knowledge recall, but the ability to apply concepts and understand trade-offs.\n\n# Why Narrative Challenges Work\n\nGreat challenges don't quiz — they immerse. Learners face realistic scenarios where every choice has consequences. They experience trade-offs firsthand, making the lesson's principles memorable.\n\n- **No \"Right Answer\"**: Every option has pros and cons. Learners engage with WHY, not just WHAT.\n- **Consequences Over Scores**: Instead of winning or losing, learners see the natural results of their choices.\n- **Strategic Thinking**: Understanding the lesson helps navigate trade-offs, but different strategies lead to different outcomes.\n\n# Inputs\n\n- `LESSON_TITLE`: The topic to create a challenge around\n- `LESSON_DESCRIPTION`: Additional context about what this lesson covers\n- `CHAPTER_TITLE`: The chapter context (for understanding scope)\n- `COURSE_TITLE`: The course context (for understanding audience level)\n- `LANGUAGE`: Output language\n- `EXPLANATION_STEPS`: What the learner has already studied\n\n## Language Guidelines\n\n- `en`: Use US English unless the content is region-specific\n- `pt`: Use Brazilian Portuguese unless the content is region-specific\n- `es`: Use Latin American Spanish unless the content is region-specific\n\n# Requirements\n\n## Introduction\n\nThe `intro` field sets the scene (max 500 characters). It should:\n\n- Establish the scenario and the learner's role\n- Explain what they're navigating (a project, situation, decision-making process)\n- Create stakes that feel meaningful\n- Use `{{NAME}}` to personalize\n\n## Steps\n\nCreate 4-6 steps. Each step presents a decision point with 3-4 options.\n\n### Step Structure\n\n- **context**: Maximum 500 characters. Pure dialogue from a colleague setting up the decision. Conversational, no narrator.\n- **question**: Maximum 100 characters. What needs to be decided.\n- **options**: 3-4 choices, each with:\n  - **text**: The choice (max 80 characters)\n  - **consequence**: What happens as a result (max 300 characters). Shown after choosing. Explains the outcome narratively.\n  - **effects**: Array of 1-3 effects showing how this choice impacts different aspects:\n    - **dimension**: A short name for what this affects (e.g., \"Code Quality\", \"Delivery Speed\", \"Team Morale\"). Use 2-4 different dimensions across all options to create meaningful trade-offs. Important: dimensions must be consistent across all steps.\n    - **impact**: Is this `\"positive\"`, `\"neutral\"`, or `\"negative\"` for that dimension?\n\n### Option Design\n\nEvery option should:\n\n- Be a legitimate choice (no obviously wrong answers)\n- Have a clear consequence that connects to lesson concepts\n- Affect 1-3 dimensions (real decisions rarely affect just one thing)\n- Teach something about trade-offs when the consequence is revealed\n\n**No option should be universally best.** Good options might help one dimension but hurt another. This creates genuine trade-offs.\n\n## Reflection\n\nThe `reflection` field (max 500 characters) provides closing insight after all steps. It should:\n\n- Acknowledge that different approaches have merit\n- Connect the experience back to the lesson's key principles\n- Help learners understand how the concepts apply in practice\n\n## Tone & Style\n\n- **Pure dialogue**: NO narrator, NO character prefixes, NO action descriptions\n- **Natural conversation**: Colleagues working through a problem together\n- **Professional but warm**: Light humor when appropriate\n- **Second-person immersion**: The colleague speaks TO the learner\n- **Use `{{NAME}}`** to personalize dialogue\n\n## What to Avoid\n\n- **Quiz-style questions**: This tests strategic thinking, not recall\n- **Obviously correct answers**: Every option should have genuine trade-offs\n- **Narrator text**: Keep it pure dialogue in context\n- **Disconnected consequences**: Consequences should relate to lesson concepts\n- **Too many or too few dimensions**: Use 2-4 different dimension names across all effects for meaningful trade-offs\n\n## Relationship to Previous Activities\n\nThe learner has completed:\n\n- **Background**: WHY this exists\n- **Explanation**: WHAT it is\n- **Mechanics**: HOW it works\n- **Examples**: WHERE it appears\n- **Story**: WHEN to apply this\n\nYour Challenge activity is the capstone: **CAN YOU NAVIGATE THIS?** It tests whether learners can apply concepts strategically. This should feel like a meaningful simulation, not a test.\n\n# Example\n\nFor a lesson on \"Technical Debt\":\n\n**Step 1:**\n\n```json\n{\n  \"context\": \"{{NAME}}, we've got a deadline crunch. The feature works but the code is messy. Ship it now or clean it up first?\",\n  \"question\": \"How do we handle this?\",\n  \"options\": [\n    {\n      \"text\": \"Ship it now, refactor later\",\n      \"consequence\": \"Feature launched on time! But the messy code made the next sprint's work harder. The team spent extra hours untangling dependencies.\",\n      \"effects\": [\n        { \"dimension\": \"Code Quality\", \"impact\": \"negative\" },\n        { \"dimension\": \"Delivery Speed\", \"impact\": \"positive\" }\n      ]\n    },\n    {\n      \"text\": \"Take two more days to refactor\",\n      \"consequence\": \"The code is clean and maintainable. Stakeholders weren't thrilled about the delay, but future changes will be much easier.\",\n      \"effects\": [\n        { \"dimension\": \"Code Quality\", \"impact\": \"positive\" },\n        { \"dimension\": \"Delivery Speed\", \"impact\": \"negative\" }\n      ]\n    },\n    {\n      \"text\": \"Split the team — half ships, half refactors\",\n      \"consequence\": \"Shipped on time with partial cleanup. Neither task got full attention, and the team felt stretched thin.\",\n      \"effects\": [\n        { \"dimension\": \"Code Quality\", \"impact\": \"neutral\" },\n        { \"dimension\": \"Team Morale\", \"impact\": \"negative\" }\n      ]\n    }\n  ]\n}\n```\n\n# Quality Checks\n\nBefore finalizing, verify:\n\n- [ ] Does the intro establish a clear, engaging scenario?\n- [ ] Does every option have a meaningful consequence?\n- [ ] Are consequences connected to lesson principles?\n- [ ] Is there no obviously \"best\" option in each step?\n- [ ] Do options affect multiple dimensions where realistic?\n- [ ] Are dimension names consistent and lesson-relevant across all effects?\n- [ ] Is `{{NAME}}` used appropriately?\n- [ ] Is all dialogue pure conversation (no narrator)?\n- [ ] Does the reflection tie the experience back to the lesson?\n- [ ] Are all constraints met (intro ≤500, context ≤500, question ≤100, text ≤80, consequence ≤300, reflection ≤500)?\n- [ ] Is the step count between 4 and 6?\n- [ ] Does every step have 3-4 options?\n\n# Output Format\n\nReturn an object with:\n\n- **intro**: Scenario introduction (max 500 chars)\n- **steps**: Array of 4-6 step objects, each with:\n  - **context**: Pure dialogue (max 500 chars)\n  - **question**: Decision prompt (max 100 chars)\n  - **options**: Array of 3-4 objects with:\n    - **text**: Choice description (max 80 chars)\n    - **consequence**: What happens (max 300 chars)\n    - **effects**: Array of 1-3 objects with:\n      - **dimension**: Short name for what this affects (use 2-4 different dimensions total)\n      - **impact**: One of \"positive\", \"neutral\", \"negative\"\n- **reflection**: Closing insight connecting to lesson (max 500 chars)\n",
      "testCaseId": "en-biology-ecosystem-balance-1",
      "userPrompt": "LESSON_TITLE: Ecosystem Balance and Management\nLESSON_DESCRIPTION: Applying ecological principles to make informed ecosystem management decisions\nCHAPTER_TITLE: Ecosystem Dynamics\nCOURSE_TITLE: Ecology and Conservation\nLANGUAGE: en\nEXPLANATION_STEPS:\n1. Interconnected Networks: Ecosystems are interconnected networks. Removing one species affects others through food webs. Keystone species have disproportionate impact — their loss cascades through the system.\n2. Carrying Capacity: Carrying capacity is the maximum population an environment can sustain. Exceed it, and resources deplete, populations crash. Stay well below, and you're not maximizing the ecosystem's potential.\n3. Biodiversity and Resilience: Biodiversity provides resilience. More species means more ways to respond to change. Monocultures are efficient but fragile. Diverse systems are robust but complex to manage.\n4. Trophic Cascades: Trophic cascades occur when changes at one level ripple through others. Remove predators, and prey populations explode, overgrazing vegetation, affecting everything that depends on those plants.\n5. Ecological Succession: Ecological succession is the process of change over time. Pioneer species prepare the way for later ones. Managing ecosystems means deciding where in succession you want to be."
    },
    {
      "duration": 45504.34224999999,
      "inputTokens": 2845,
      "output": "{\n  \"intro\": \"{{NAME}}, você acaba de ser contratado como engenheiro de processos em uma planta química que produz amônia pelo Processo Haber. A demanda aumentou, mas a produção está abaixo do esperado. Você precisa tomar decisões rápidas para otimizar o rendimento sem comprometer a segurança e os custos. Cada escolha terá consequências reais na planta!\",\n  \"reflection\": \"Diferentes estratégias podem funcionar dependendo do contexto. O Princípio de Le Chatelier guia nossas decisões, mas cada perturbação tem custos e benefícios. Temperatura afeta a constante de equilíbrio, pressão e concentração deslocam o equilíbrio sem mudá-la, e catalisadores aceleram sem deslocar. Otimizar processos reais exige equilibrar rendimento, velocidade e custo — exatamente como na indústria química moderna.\",\n  \"steps\": [\n    {\n      \"context\": \"{{NAME}}, a reação de síntese de amônia é N₂ + 3H₂ ⇌ 2NH₃, exotérmica. Nossos operadores perceberam que a conversão está baixa. O chefe de produção quer aumentar o rendimento agora. Temos três opções na mesa para mexer na concentração dos reagentes. O que você decide?\",\n      \"options\": [\n        {\n          \"consequence\": \"O equilíbrio deslocou para produtos, aumentando a produção de amônia. Porém, o custo com nitrogênio adicional subiu 18% e o excesso não reagido precisa ser reciclado, gerando custos operacionais.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Rendimento\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Custo Operacional\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Injetar mais nitrogênio no reator\"\n        },\n        {\n          \"consequence\": \"Ótimo resultado! H₂ é o reagente limitante e seu aumento deslocou bastante o equilíbrio para amônia. O custo é moderado, mas H₂ requer cuidados de segurança extras no armazenamento.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Rendimento\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Segurança\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Aumentar a alimentação de hidrogênio\"\n        },\n        {\n          \"consequence\": \"Remover NH₃ continuamente desloca o equilíbrio para produtos de forma consistente. A implementação exige um sistema de separação eficiente, mas é uma estratégia sustentável a longo prazo.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Rendimento\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Custo Operacional\",\n              \"impact\": \"neutral\"\n            }\n          ],\n          \"text\": \"Remover amônia produzida continuamente\"\n        }\n      ],\n      \"question\": \"Como aumentar a concentração de produtos?\"\n    },\n    {\n      \"context\": \"{{NAME}}, resolvemos a questão da concentração, mas o engenheiro sênior trouxe outro problema: a pressão do reator está em 150 atm. Sabendo que N₂ + 3H₂ → 2NH₃ tem 4 moles de gás nos reagentes e 2 nos produtos, ele quer ajustar a pressão. Qual é a sua recomendação?\",\n      \"options\": [\n        {\n          \"consequence\": \"Perfeito! Com menos moles de gás nos produtos, aumentar a pressão favorece a formação de NH₃. O rendimento subiu significativamente. Porém, equipamentos de alta pressão custam mais e exigem manutenção rigorosa.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Rendimento\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Custo Operacional\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Segurança\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Aumentar a pressão para 300 atm\"\n        },\n        {\n          \"consequence\": \"A pressão menor favoreceu o lado com mais moles de gás — os reagentes. O rendimento de amônia caiu consideravelmente. Não foi a melhor decisão para este sistema.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Rendimento\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Custo Operacional\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Segurança\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Reduzir a pressão para 80 atm\"\n        },\n        {\n          \"consequence\": \"Adicionar argônio (inerte) não afeta o equilíbrio químico, pois não participa da reação. A pressão total subiu, mas as pressões parciais dos reagentes não mudaram. Nenhum efeito no rendimento.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Rendimento\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Custo Operacional\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Adicionar gás argônio inerte ao sistema\"\n        }\n      ],\n      \"question\": \"Como ajustar a pressão para melhorar o rendimento?\"\n    },\n    {\n      \"context\": \"Ótimo trabalho, {{NAME}}! Agora vem o dilema clássico do Processo Haber: a reação é exotérmica. Em alta temperatura a reação é rápida, mas o equilíbrio é desfavorável. Em baixa temperatura o equilíbrio é favorável, mas a reação é lenta demais. O gerente quer sua opinião sobre a temperatura ideal.\",\n      \"options\": [\n        {\n          \"consequence\": \"Alta temperatura acelerou a reação, mas deslocou o equilíbrio para os reagentes (reação exotérmica). Você ganhou velocidade mas perdeu rendimento de equilíbrio. A constante K diminuiu.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Rendimento\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Velocidade de Reação\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Operar a 600°C para máxima velocidade\"\n        },\n        {\n          \"consequence\": \"Temperatura muito baixa favorece o equilíbrio (K maior para exotérmicas), mas a cinética é péssima. O sistema chega ao equilíbrio muito lentamente, tornando o processo inviável industrialmente.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Rendimento\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Velocidade de Reação\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Operar a 150°C para máximo rendimento\"\n        },\n        {\n          \"consequence\": \"A faixa intermediária (400–500°C) é o compromisso industrial clássico. Rendimento razoável com velocidade aceitável. É exatamente o que o Processo Haber real utiliza — um balanço entre termodinâmica e cinética.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Rendimento\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Velocidade de Reação\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Custo Operacional\",\n              \"impact\": \"neutral\"\n            }\n          ],\n          \"text\": \"Operar entre 400–500°C como compromisso\"\n        }\n      ],\n      \"question\": \"Qual temperatura escolher para o reator?\"\n    },\n    {\n      \"context\": \"{{NAME}}, a planta está quase otimizada! O último ponto em discussão é o uso de catalisador. Temos um catalisador de ferro disponível. Alguns engenheiros dizem que ele vai aumentar o rendimento, outros discordam. Há também a proposta de usar dois reatores em série. O que você decide?\",\n      \"options\": [\n        {\n          \"consequence\": \"O catalisador de ferro acelerou muito a chegada ao equilíbrio em ambas as direções igualmente. O rendimento final não mudou — a constante K é a mesma — mas o tempo para atingi-lo foi drasticamente reduzido. Produção mais eficiente!\",\n          \"effects\": [\n            {\n              \"dimension\": \"Velocidade de Reação\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Rendimento\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Custo Operacional\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Usar catalisador de ferro no reator\"\n        },\n        {\n          \"consequence\": \"Sem catalisador, o sistema atinge o equilíbrio muito lentamente. O rendimento teórico é o mesmo, mas o tempo de residência necessário é enorme, tornando a planta pouco eficiente e aumentando custos.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Velocidade de Reação\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Rendimento\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Custo Operacional\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Operar sem catalisador\"\n        },\n        {\n          \"consequence\": \"Dois reatores em série com remoção de NH₃ entre eles deslocam o equilíbrio progressivamente. Combinado com catalisador, é uma estratégia poderosa, mas o custo de capital é alto e a complexidade operacional aumenta.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Rendimento\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Custo Operacional\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Velocidade de Reação\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Dois reatores em série com catalisador\"\n        }\n      ],\n      \"question\": \"Qual estratégia de catálise adotar?\"\n    },\n    {\n      \"context\": \"{{NAME}}, tivemos um imprevisto: a temperatura do reator subiu acidentalmente para 700°C por uma falha no sistema de resfriamento. O equilíbrio foi perturbado. A equipe precisa de uma decisão rápida para reestabelecer a produção. Cada minuto conta!\",\n      \"options\": [\n        {\n          \"consequence\": \"Resfriar rapidamente restabeleceu a temperatura operacional. O equilíbrio voltou à condição favorável. Boa decisão! Houve perda de produção temporária, mas o sistema foi recuperado com segurança.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Rendimento\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Segurança\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Velocidade de Reação\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Resfriar o reator imediatamente\"\n        },\n        {\n          \"consequence\": \"Manter 700°C manteve a reação rápida, mas a constante de equilíbrio K caiu muito para essa reação exotérmica. A produção de amônia despencou. Velocidade sem rendimento não resolve o problema.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Rendimento\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Velocidade de Reação\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Segurança\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Manter temperatura alta e aumentar alimentação\"\n        },\n        {\n          \"consequence\": \"Reduzir pressão enquanto a temperatura está alta ameniza o desequilíbrio, mas não resolve o problema principal — a temperatura ainda desloca o equilíbrio para reagentes. Uma solução parcial que compra tempo, mas não resolve.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Rendimento\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Segurança\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Custo Operacional\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Reduzir pressão para compensar o efeito\"\n        }\n      ],\n      \"question\": \"Como responder à falha de temperatura?\"\n    }\n  ]\n}",
      "outputTokens": 2566,
      "systemPrompt": "# Role\n\nYou are an expert educational game designer creating a **Challenge** activity for a learning app. Your mission is to design a choose-your-own-adventure scenario where learners make strategic decisions with meaningful consequences, using the lesson's concepts.\n\nYou specialize in crafting narrative experiences that test strategic thinking — not knowledge recall, but the ability to apply concepts and understand trade-offs.\n\n# Why Narrative Challenges Work\n\nGreat challenges don't quiz — they immerse. Learners face realistic scenarios where every choice has consequences. They experience trade-offs firsthand, making the lesson's principles memorable.\n\n- **No \"Right Answer\"**: Every option has pros and cons. Learners engage with WHY, not just WHAT.\n- **Consequences Over Scores**: Instead of winning or losing, learners see the natural results of their choices.\n- **Strategic Thinking**: Understanding the lesson helps navigate trade-offs, but different strategies lead to different outcomes.\n\n# Inputs\n\n- `LESSON_TITLE`: The topic to create a challenge around\n- `LESSON_DESCRIPTION`: Additional context about what this lesson covers\n- `CHAPTER_TITLE`: The chapter context (for understanding scope)\n- `COURSE_TITLE`: The course context (for understanding audience level)\n- `LANGUAGE`: Output language\n- `EXPLANATION_STEPS`: What the learner has already studied\n\n## Language Guidelines\n\n- `en`: Use US English unless the content is region-specific\n- `pt`: Use Brazilian Portuguese unless the content is region-specific\n- `es`: Use Latin American Spanish unless the content is region-specific\n\n# Requirements\n\n## Introduction\n\nThe `intro` field sets the scene (max 500 characters). It should:\n\n- Establish the scenario and the learner's role\n- Explain what they're navigating (a project, situation, decision-making process)\n- Create stakes that feel meaningful\n- Use `{{NAME}}` to personalize\n\n## Steps\n\nCreate 4-6 steps. Each step presents a decision point with 3-4 options.\n\n### Step Structure\n\n- **context**: Maximum 500 characters. Pure dialogue from a colleague setting up the decision. Conversational, no narrator.\n- **question**: Maximum 100 characters. What needs to be decided.\n- **options**: 3-4 choices, each with:\n  - **text**: The choice (max 80 characters)\n  - **consequence**: What happens as a result (max 300 characters). Shown after choosing. Explains the outcome narratively.\n  - **effects**: Array of 1-3 effects showing how this choice impacts different aspects:\n    - **dimension**: A short name for what this affects (e.g., \"Code Quality\", \"Delivery Speed\", \"Team Morale\"). Use 2-4 different dimensions across all options to create meaningful trade-offs. Important: dimensions must be consistent across all steps.\n    - **impact**: Is this `\"positive\"`, `\"neutral\"`, or `\"negative\"` for that dimension?\n\n### Option Design\n\nEvery option should:\n\n- Be a legitimate choice (no obviously wrong answers)\n- Have a clear consequence that connects to lesson concepts\n- Affect 1-3 dimensions (real decisions rarely affect just one thing)\n- Teach something about trade-offs when the consequence is revealed\n\n**No option should be universally best.** Good options might help one dimension but hurt another. This creates genuine trade-offs.\n\n## Reflection\n\nThe `reflection` field (max 500 characters) provides closing insight after all steps. It should:\n\n- Acknowledge that different approaches have merit\n- Connect the experience back to the lesson's key principles\n- Help learners understand how the concepts apply in practice\n\n## Tone & Style\n\n- **Pure dialogue**: NO narrator, NO character prefixes, NO action descriptions\n- **Natural conversation**: Colleagues working through a problem together\n- **Professional but warm**: Light humor when appropriate\n- **Second-person immersion**: The colleague speaks TO the learner\n- **Use `{{NAME}}`** to personalize dialogue\n\n## What to Avoid\n\n- **Quiz-style questions**: This tests strategic thinking, not recall\n- **Obviously correct answers**: Every option should have genuine trade-offs\n- **Narrator text**: Keep it pure dialogue in context\n- **Disconnected consequences**: Consequences should relate to lesson concepts\n- **Too many or too few dimensions**: Use 2-4 different dimension names across all effects for meaningful trade-offs\n\n## Relationship to Previous Activities\n\nThe learner has completed:\n\n- **Background**: WHY this exists\n- **Explanation**: WHAT it is\n- **Mechanics**: HOW it works\n- **Examples**: WHERE it appears\n- **Story**: WHEN to apply this\n\nYour Challenge activity is the capstone: **CAN YOU NAVIGATE THIS?** It tests whether learners can apply concepts strategically. This should feel like a meaningful simulation, not a test.\n\n# Example\n\nFor a lesson on \"Technical Debt\":\n\n**Step 1:**\n\n```json\n{\n  \"context\": \"{{NAME}}, we've got a deadline crunch. The feature works but the code is messy. Ship it now or clean it up first?\",\n  \"question\": \"How do we handle this?\",\n  \"options\": [\n    {\n      \"text\": \"Ship it now, refactor later\",\n      \"consequence\": \"Feature launched on time! But the messy code made the next sprint's work harder. The team spent extra hours untangling dependencies.\",\n      \"effects\": [\n        { \"dimension\": \"Code Quality\", \"impact\": \"negative\" },\n        { \"dimension\": \"Delivery Speed\", \"impact\": \"positive\" }\n      ]\n    },\n    {\n      \"text\": \"Take two more days to refactor\",\n      \"consequence\": \"The code is clean and maintainable. Stakeholders weren't thrilled about the delay, but future changes will be much easier.\",\n      \"effects\": [\n        { \"dimension\": \"Code Quality\", \"impact\": \"positive\" },\n        { \"dimension\": \"Delivery Speed\", \"impact\": \"negative\" }\n      ]\n    },\n    {\n      \"text\": \"Split the team — half ships, half refactors\",\n      \"consequence\": \"Shipped on time with partial cleanup. Neither task got full attention, and the team felt stretched thin.\",\n      \"effects\": [\n        { \"dimension\": \"Code Quality\", \"impact\": \"neutral\" },\n        { \"dimension\": \"Team Morale\", \"impact\": \"negative\" }\n      ]\n    }\n  ]\n}\n```\n\n# Quality Checks\n\nBefore finalizing, verify:\n\n- [ ] Does the intro establish a clear, engaging scenario?\n- [ ] Does every option have a meaningful consequence?\n- [ ] Are consequences connected to lesson principles?\n- [ ] Is there no obviously \"best\" option in each step?\n- [ ] Do options affect multiple dimensions where realistic?\n- [ ] Are dimension names consistent and lesson-relevant across all effects?\n- [ ] Is `{{NAME}}` used appropriately?\n- [ ] Is all dialogue pure conversation (no narrator)?\n- [ ] Does the reflection tie the experience back to the lesson?\n- [ ] Are all constraints met (intro ≤500, context ≤500, question ≤100, text ≤80, consequence ≤300, reflection ≤500)?\n- [ ] Is the step count between 4 and 6?\n- [ ] Does every step have 3-4 options?\n\n# Output Format\n\nReturn an object with:\n\n- **intro**: Scenario introduction (max 500 chars)\n- **steps**: Array of 4-6 step objects, each with:\n  - **context**: Pure dialogue (max 500 chars)\n  - **question**: Decision prompt (max 100 chars)\n  - **options**: Array of 3-4 objects with:\n    - **text**: Choice description (max 80 chars)\n    - **consequence**: What happens (max 300 chars)\n    - **effects**: Array of 1-3 objects with:\n      - **dimension**: Short name for what this affects (use 2-4 different dimensions total)\n      - **impact**: One of \"positive\", \"neutral\", \"negative\"\n- **reflection**: Closing insight connecting to lesson (max 500 chars)\n",
      "testCaseId": "pt-chemistry-reaction-equilibrium-1",
      "userPrompt": "LESSON_TITLE: Equilibrio Quimico na Pratica\nLESSON_DESCRIPTION: Aplicando o principio de Le Chatelier para otimizar reacoes quimicas e processos industriais\nCHAPTER_TITLE: Equilibrio Quimico\nCOURSE_TITLE: Quimica Geral II\nLANGUAGE: pt\nEXPLANATION_STEPS:\n1. Principio de Le Chatelier: O principio de Le Chatelier diz que um sistema em equilibrio responde a perturbacoes minimizando a mudanca. Adicione reagente, o equilibrio desloca para consumir esse reagente.\n2. Efeito da Concentracao: Mudancas de concentracao deslocam o equilibrio. Adicionar reagentes desloca para produtos. Remover produtos tambem desloca para produtos. O sistema busca restaurar o equilibrio.\n3. Efeito da Pressao: A pressao afeta equilibrios gasosos. Aumentar pressao favorece o lado com menos moles de gas. Diminuir pressao favorece o lado com mais moles. Gases inertes nao afetam.\n4. Efeito da Temperatura: Temperatura e diferente — ela muda a constante de equilibrio. Reacoes exotermicas: aumento de temperatura desloca para reagentes. Reacoes endotermicas: aumento favorece produtos.\n5. Papel dos Catalisadores: Catalisadores aceleram ambas as direcoes igualmente. Eles nao deslocam o equilibrio — apenas ajudam a alcancar o equilibrio mais rapido. Util para processos industriais."
    },
    {
      "duration": 49954.05479099997,
      "inputTokens": 2842,
      "output": "{\n  \"intro\": \"{{NAME}}, eres el ingeniero energético recién contratado en una planta industrial mediana. La dirección quiere reducir costos y emisiones sin detener la producción. Tienes presupuesto limitado, datos de consumo y equipos con distintas eficiencias. Cada decisión que tomes afectará el rendimiento global, el costo operativo y la huella energética de la planta. ¿Estás listo para optimizar el sistema?\",\n  \"reflection\": \"Optimizar sistemas reales exige equilibrar eficiencia, costo, almacenamiento y viabilidad práctica. No hay solución perfecta: menos conversiones reducen pérdidas en cadena, pero el almacenamiento tiene su propio costo. La densidad energética limita opciones móviles. La segunda ley siempre cobra su parte. El mejor ingeniero no busca la perfección, sino el balance más inteligente según las restricciones reales.\",\n  \"steps\": [\n    {\n      \"context\": \"{{NAME}}, el motor principal de la planta tiene 15 años y opera al 68% de eficiencia. Uno nuevo alcanza el 89%. Pero también podríamos mantener el actual y añadir recuperadores de calor residual para aprovechar las pérdidas térmicas. El presupuesto solo alcanza para una de las dos opciones. ¿Qué hacemos?\",\n      \"options\": [\n        {\n          \"consequence\": \"El nuevo motor eleva la eficiencia base de inmediato. Sin embargo, el calor residual sigue desperdiciándose. La mejora es significativa pero no aprovecha todas las pérdidas térmicas ya existentes.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Eficiencia del Sistema\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Costo de Inversión\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Reemplazar el motor viejo por uno nuevo y eficiente\"\n        },\n        {\n          \"consequence\": \"Los recuperadores capturan calor que antes se perdía, reduciendo el consumo neto. El motor sigue siendo ineficiente de base, pero el calor residual ahora genera valor. Solución creativa con buen retorno.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Eficiencia del Sistema\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Costo de Inversión\",\n              \"impact\": \"neutral\"\n            }\n          ],\n          \"text\": \"Mantener el motor y añadir recuperadores de calor\"\n        },\n        {\n          \"consequence\": \"Sin inversión, el sistema sigue operando al 68%. Los costos operativos permanecen altos y las pérdidas continúan. Se conserva el presupuesto, pero se pierde la oportunidad de mejorar la cadena de conversión.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Eficiencia del Sistema\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Costo de Inversión\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"No invertir ahora, esperar mejor oportunidad\"\n        }\n      ],\n      \"question\": \"¿Cómo mejoramos la eficiencia del motor principal?\"\n    },\n    {\n      \"context\": \"Mira estos datos, {{NAME}}. Tenemos tres conversiones de energía entre la fuente y el punto de uso final: generación, transformación y distribución. Cada etapa tiene 88% de eficiencia. El resultado total es 0.88³ ≈ 68%. Podemos rediseñar el sistema para eliminar una etapa intermedia, pero requiere reorganizar el cableado. ¿Lo hacemos?\",\n      \"options\": [\n        {\n          \"consequence\": \"Con dos conversiones en lugar de tres, la eficiencia sube a 0.88² ≈ 77%. Menos pérdidas en cadena, más energía útil al final. La reorganización fue costosa en tiempo, pero los ahorros continuos justifican el esfuerzo.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Eficiencia del Sistema\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Tiempo de Implementación\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Eliminar una etapa intermedia reorganizando el sistema\"\n        },\n        {\n          \"consequence\": \"El sistema sigue con tres conversiones. La eficiencia no mejora, pero la operación continúa sin interrupciones. Las pérdidas acumuladas siguen siendo del 32% del total. Una oportunidad de mejora real desperdiciada.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Eficiencia del Sistema\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Tiempo de Implementación\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Conservar las tres etapas para evitar interrupciones\"\n        },\n        {\n          \"consequence\": \"Eliminar dos etapas llevaría la eficiencia a 0.88¹ ≈ 88%, pero la reorganización masiva detiene producción por semanas. El ahorro energético es máximo, pero el costo operativo durante la pausa es enorme.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Eficiencia del Sistema\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Tiempo de Implementación\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Costo de Inversión\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Eliminar dos etapas a la vez para maximizar la mejora\"\n        }\n      ],\n      \"question\": \"¿Reducimos las conversiones intermedias en la cadena?\"\n    },\n    {\n      \"context\": \"{{NAME}}, la gerencia propone instalar baterías para almacenar energía barata en horas valle y usarla en horas pico. Suena bien en papel, pero cada ciclo de carga y descarga tiene pérdidas. Con 90% de eficiencia en carga y 90% en descarga, recuperamos solo el 81% de lo que guardamos. ¿Vale la pena el almacenamiento?\",\n      \"options\": [\n        {\n          \"consequence\": \"El arbitraje de precio compensa las pérdidas del ciclo. Pagas menos por la energía barata nocturna y evitas la tarifa punta. El 19% perdido en el ciclo se compensa económicamente, aunque la eficiencia energética total baja.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Eficiencia del Sistema\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Costo de Inversión\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Instalar baterías para aprovechar precios valle-punta\"\n        },\n        {\n          \"consequence\": \"Sin almacenamiento, no hay pérdidas de ciclo. La planta consume directamente de la red en todo momento. Pagas tarifas punta cuando la demanda es alta, pero evitas las pérdidas inherentes al almacenamiento.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Eficiencia del Sistema\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Costo de Inversión\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"No instalar baterías, conectarse directo a la red\"\n        },\n        {\n          \"consequence\": \"El sistema hidroeléctrico tiene pérdidas similares al bombear y generar, pero puede escalar mejor y dura décadas. La inversión inicial es mayor, pero el costo energético por ciclo es comparable a las baterías.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Eficiencia del Sistema\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Costo de Inversión\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Tiempo de Implementación\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Explorar almacenamiento hidroeléctrico por bombeo\"\n        }\n      ],\n      \"question\": \"¿Implementamos almacenamiento energético en la planta?\"\n    },\n    {\n      \"context\": \"Oye {{NAME}}, estamos evaluando electrificar la flota de vehículos internos de la planta. Los eléctricos son más eficientes en el motor, pero las baterías tienen menor densidad energética que el diésel. Los vehículos necesitan recargar más seguido. Para rutas cortas internas funciona bien, pero para transporte de materiales entre almacenes lejanos puede ser problemático. ¿Qué decides?\",\n      \"options\": [\n        {\n          \"consequence\": \"En rutas cortas, los eléctricos brillan. Alta eficiencia de motor, sin emisiones locales, costos operativos bajos. La menor densidad energética no es problema porque recargan durante pausas. Decisión inteligente para ese contexto.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Eficiencia del Sistema\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Costo de Inversión\",\n              \"impact\": \"neutral\"\n            }\n          ],\n          \"text\": \"Electrificar solo los vehículos de rutas cortas internas\"\n        },\n        {\n          \"consequence\": \"Los vehículos de largo recorrido sufren la baja densidad energética. Paradas frecuentes para recargar reducen productividad. La eficiencia del motor mejora, pero la logística se complica. No era el contexto ideal para baterías.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Eficiencia del Sistema\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Tiempo de Implementación\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Electrificar toda la flota incluyendo rutas largas\"\n        },\n        {\n          \"consequence\": \"El diésel ofrece alta densidad energética para largas distancias. Sin embargo, la eficiencia del motor diésel es menor que el eléctrico y las emisiones locales continúan. Solución conocida pero con mayores pérdidas energéticas.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Eficiencia del Sistema\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Costo de Inversión\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Mantener flota diésel actual en todos los vehículos\"\n        }\n      ],\n      \"question\": \"¿Cómo electrificamos la flota de la planta?\"\n    },\n    {\n      \"context\": \"{{NAME}}, llegó el momento de presentar resultados a la dirección. Hemos mejorado varios sistemas, pero quieren saber: ¿cuál es nuestra eficiencia global real ahora? Algunos directivos esperan que lleguemos al 100% con suficiente tecnología. ¿Cómo comunicas las limitaciones termodinámicas fundamentales sin desanimar al equipo?\",\n      \"options\": [\n        {\n          \"consequence\": \"La honestidad genera confianza. Explicar que la segunda ley garantiza pérdidas irreducibles enfoca los esfuerzos en minimizar pérdidas reales, no perseguir imposibles. La dirección ajusta expectativas y celebra las mejoras logradas.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Eficiencia del Sistema\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Tiempo de Implementación\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Explicar que 100% es imposible por la segunda ley\"\n        },\n        {\n          \"consequence\": \"La promesa de eficiencia perfecta crea expectativas falsas. Cuando los límites físicos aparezcan, la credibilidad del equipo caerá. A corto plazo hay entusiasmo, pero las decepciones futuras costarán caro en confianza.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Eficiencia del Sistema\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Costo de Inversión\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Prometer que con más inversión llegaremos al 100%\"\n        },\n        {\n          \"consequence\": \"Mostrar el salto de 68% a 81% en eficiencia global con datos concretos es poderoso. Los logros hablan por sí solos. Y al presentar las metas futuras realistas, queda implícito que hay un techo termodinámico sin necesidad de debate filosófico.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Eficiencia del Sistema\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Costo de Inversión\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Tiempo de Implementación\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Mostrar mejoras logradas y metas futuras realistas\"\n        }\n      ],\n      \"question\": \"¿Cómo presentas los límites de eficiencia a la dirección?\"\n    }\n  ]\n}",
      "outputTokens": 2712,
      "systemPrompt": "# Role\n\nYou are an expert educational game designer creating a **Challenge** activity for a learning app. Your mission is to design a choose-your-own-adventure scenario where learners make strategic decisions with meaningful consequences, using the lesson's concepts.\n\nYou specialize in crafting narrative experiences that test strategic thinking — not knowledge recall, but the ability to apply concepts and understand trade-offs.\n\n# Why Narrative Challenges Work\n\nGreat challenges don't quiz — they immerse. Learners face realistic scenarios where every choice has consequences. They experience trade-offs firsthand, making the lesson's principles memorable.\n\n- **No \"Right Answer\"**: Every option has pros and cons. Learners engage with WHY, not just WHAT.\n- **Consequences Over Scores**: Instead of winning or losing, learners see the natural results of their choices.\n- **Strategic Thinking**: Understanding the lesson helps navigate trade-offs, but different strategies lead to different outcomes.\n\n# Inputs\n\n- `LESSON_TITLE`: The topic to create a challenge around\n- `LESSON_DESCRIPTION`: Additional context about what this lesson covers\n- `CHAPTER_TITLE`: The chapter context (for understanding scope)\n- `COURSE_TITLE`: The course context (for understanding audience level)\n- `LANGUAGE`: Output language\n- `EXPLANATION_STEPS`: What the learner has already studied\n\n## Language Guidelines\n\n- `en`: Use US English unless the content is region-specific\n- `pt`: Use Brazilian Portuguese unless the content is region-specific\n- `es`: Use Latin American Spanish unless the content is region-specific\n\n# Requirements\n\n## Introduction\n\nThe `intro` field sets the scene (max 500 characters). It should:\n\n- Establish the scenario and the learner's role\n- Explain what they're navigating (a project, situation, decision-making process)\n- Create stakes that feel meaningful\n- Use `{{NAME}}` to personalize\n\n## Steps\n\nCreate 4-6 steps. Each step presents a decision point with 3-4 options.\n\n### Step Structure\n\n- **context**: Maximum 500 characters. Pure dialogue from a colleague setting up the decision. Conversational, no narrator.\n- **question**: Maximum 100 characters. What needs to be decided.\n- **options**: 3-4 choices, each with:\n  - **text**: The choice (max 80 characters)\n  - **consequence**: What happens as a result (max 300 characters). Shown after choosing. Explains the outcome narratively.\n  - **effects**: Array of 1-3 effects showing how this choice impacts different aspects:\n    - **dimension**: A short name for what this affects (e.g., \"Code Quality\", \"Delivery Speed\", \"Team Morale\"). Use 2-4 different dimensions across all options to create meaningful trade-offs. Important: dimensions must be consistent across all steps.\n    - **impact**: Is this `\"positive\"`, `\"neutral\"`, or `\"negative\"` for that dimension?\n\n### Option Design\n\nEvery option should:\n\n- Be a legitimate choice (no obviously wrong answers)\n- Have a clear consequence that connects to lesson concepts\n- Affect 1-3 dimensions (real decisions rarely affect just one thing)\n- Teach something about trade-offs when the consequence is revealed\n\n**No option should be universally best.** Good options might help one dimension but hurt another. This creates genuine trade-offs.\n\n## Reflection\n\nThe `reflection` field (max 500 characters) provides closing insight after all steps. It should:\n\n- Acknowledge that different approaches have merit\n- Connect the experience back to the lesson's key principles\n- Help learners understand how the concepts apply in practice\n\n## Tone & Style\n\n- **Pure dialogue**: NO narrator, NO character prefixes, NO action descriptions\n- **Natural conversation**: Colleagues working through a problem together\n- **Professional but warm**: Light humor when appropriate\n- **Second-person immersion**: The colleague speaks TO the learner\n- **Use `{{NAME}}`** to personalize dialogue\n\n## What to Avoid\n\n- **Quiz-style questions**: This tests strategic thinking, not recall\n- **Obviously correct answers**: Every option should have genuine trade-offs\n- **Narrator text**: Keep it pure dialogue in context\n- **Disconnected consequences**: Consequences should relate to lesson concepts\n- **Too many or too few dimensions**: Use 2-4 different dimension names across all effects for meaningful trade-offs\n\n## Relationship to Previous Activities\n\nThe learner has completed:\n\n- **Background**: WHY this exists\n- **Explanation**: WHAT it is\n- **Mechanics**: HOW it works\n- **Examples**: WHERE it appears\n- **Story**: WHEN to apply this\n\nYour Challenge activity is the capstone: **CAN YOU NAVIGATE THIS?** It tests whether learners can apply concepts strategically. This should feel like a meaningful simulation, not a test.\n\n# Example\n\nFor a lesson on \"Technical Debt\":\n\n**Step 1:**\n\n```json\n{\n  \"context\": \"{{NAME}}, we've got a deadline crunch. The feature works but the code is messy. Ship it now or clean it up first?\",\n  \"question\": \"How do we handle this?\",\n  \"options\": [\n    {\n      \"text\": \"Ship it now, refactor later\",\n      \"consequence\": \"Feature launched on time! But the messy code made the next sprint's work harder. The team spent extra hours untangling dependencies.\",\n      \"effects\": [\n        { \"dimension\": \"Code Quality\", \"impact\": \"negative\" },\n        { \"dimension\": \"Delivery Speed\", \"impact\": \"positive\" }\n      ]\n    },\n    {\n      \"text\": \"Take two more days to refactor\",\n      \"consequence\": \"The code is clean and maintainable. Stakeholders weren't thrilled about the delay, but future changes will be much easier.\",\n      \"effects\": [\n        { \"dimension\": \"Code Quality\", \"impact\": \"positive\" },\n        { \"dimension\": \"Delivery Speed\", \"impact\": \"negative\" }\n      ]\n    },\n    {\n      \"text\": \"Split the team — half ships, half refactors\",\n      \"consequence\": \"Shipped on time with partial cleanup. Neither task got full attention, and the team felt stretched thin.\",\n      \"effects\": [\n        { \"dimension\": \"Code Quality\", \"impact\": \"neutral\" },\n        { \"dimension\": \"Team Morale\", \"impact\": \"negative\" }\n      ]\n    }\n  ]\n}\n```\n\n# Quality Checks\n\nBefore finalizing, verify:\n\n- [ ] Does the intro establish a clear, engaging scenario?\n- [ ] Does every option have a meaningful consequence?\n- [ ] Are consequences connected to lesson principles?\n- [ ] Is there no obviously \"best\" option in each step?\n- [ ] Do options affect multiple dimensions where realistic?\n- [ ] Are dimension names consistent and lesson-relevant across all effects?\n- [ ] Is `{{NAME}}` used appropriately?\n- [ ] Is all dialogue pure conversation (no narrator)?\n- [ ] Does the reflection tie the experience back to the lesson?\n- [ ] Are all constraints met (intro ≤500, context ≤500, question ≤100, text ≤80, consequence ≤300, reflection ≤500)?\n- [ ] Is the step count between 4 and 6?\n- [ ] Does every step have 3-4 options?\n\n# Output Format\n\nReturn an object with:\n\n- **intro**: Scenario introduction (max 500 chars)\n- **steps**: Array of 4-6 step objects, each with:\n  - **context**: Pure dialogue (max 500 chars)\n  - **question**: Decision prompt (max 100 chars)\n  - **options**: Array of 3-4 objects with:\n    - **text**: Choice description (max 80 chars)\n    - **consequence**: What happens (max 300 chars)\n    - **effects**: Array of 1-3 objects with:\n      - **dimension**: Short name for what this affects (use 2-4 different dimensions total)\n      - **impact**: One of \"positive\", \"neutral\", \"negative\"\n- **reflection**: Closing insight connecting to lesson (max 500 chars)\n",
      "testCaseId": "es-physics-energy-conservation-1",
      "userPrompt": "LESSON_TITLE: Conservacion de Energia en Sistemas Reales\nLESSON_DESCRIPTION: Aplicando principios de conservacion de energia para disenar y optimizar sistemas energeticos\nCHAPTER_TITLE: Energia y Trabajo\nCOURSE_TITLE: Fisica Aplicada\nLANGUAGE: es\nEXPLANATION_STEPS:\n1. Conservacion de la Energia: La energia no se crea ni se destruye, solo se transforma. En cada conversion, la energia total se conserva, pero la energia util disminuye. Parte siempre se convierte en calor no aprovechable.\n2. Eficiencia Energetica: La eficiencia mide cuanta energia de entrada se convierte en trabajo util. Ningun proceso es 100% eficiente — siempre hay perdidas. La segunda ley de la termodinamica lo garantiza.\n3. Perdidas en Cadena: Las cadenas de conversion acumulan perdidas. Si cada paso es 90% eficiente, tres pasos dan 0.9³ = 73% eficiencia total. Menos conversiones significa menos perdidas.\n4. Costo del Almacenamiento: El almacenamiento de energia tiene su propio costo energetico. Cargar y descargar baterias pierde energia. Bombear agua cuesta arriba para hidroelectrica tambien. El almacenamiento no es gratis.\n5. Densidad Energetica: La densidad energetica importa. Combustibles fosiles almacenan mucha energia por kilogramo. Las baterias almacenan menos. Esto afecta que es practico para cada aplicacion."
    }
  ],
  "taskId": "activity-challenge"
}
