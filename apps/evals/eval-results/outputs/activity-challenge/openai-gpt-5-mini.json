{
  "generatedAt": "2026-01-17T19:39:54.122Z",
  "modelId": "openai/gpt-5-mini",
  "outputs": [
    {
      "duration": 40008.845625000016,
      "inputTokens": 2119,
      "output": "{\n  \"intro\": \"{{NAME}}, you're the tech lead for a data-processing service under tight SLAs and memory caps. Over the next day you'll make five architecture choices—each affects latency, memory, complexity, and predictability. Decide strategically; there are trade-offs, not a single right answer.\",\n  \"reflection\": \"Different strategies are reasonable depending on constraints: low latency, limited RAM, or predictable behavior. You balanced Time Efficiency, Space Usage, Implementation Complexity, and Predictability—applying time/space trade-offs, amortized thinking, and case analysis to make pragmatic choices.\",\n  \"steps\": [\n    {\n      \"context\": \"{{NAME}}, users need fast lookups across a large dataset that updates frequently. Do we build an index, sort the data, or scan on demand?\",\n      \"options\": [\n        {\n          \"consequence\": \"You add a hash index. Lookups are near-instant, but writes now require index maintenance and memory use spikes. Overall latency drops, but peak RAM and update code complexity rise.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Time Efficiency\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Space Usage\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Implementation Complexity\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Predictability\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Maintain a hash index for O(1) lookups\"\n        },\n        {\n          \"consequence\": \"You keep data sorted and use binary search. Lookups are fast and memory cost is low, but keeping data sorted on frequent writes slows updates and can complicate concurrency.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Time Efficiency\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Space Usage\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Implementation Complexity\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Predictability\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Keep data sorted and use binary search\"\n        },\n        {\n          \"consequence\": \"You do on-demand linear scans without extra structures. Implementation stays simple and writes are cheap, but average lookups are slow and latency grows with data size.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Time Efficiency\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Space Usage\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Implementation Complexity\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Predictability\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Scan on demand—no extra index\"\n        }\n      ],\n      \"question\": \"Which lookup strategy do you choose?\"\n    },\n    {\n      \"context\": \"{{NAME}}, some computations are expensive but repeatable. Stakeholders want lower latency at peak times. Do we cache results, compute each time, or use a limited cache?\",\n      \"options\": [\n        {\n          \"consequence\": \"You precompute and cache aggressively. Peak latency drops dramatically, but memory spikes and cold starts require a warm-up plan. Cache invalidation adds complexity.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Time Efficiency\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Space Usage\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Implementation Complexity\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Predictability\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Precompute and cache most results\"\n        },\n        {\n          \"consequence\": \"You compute every request. Memory stays low and correctness is simple, but latency is consistent and higher—users feel slower responses with larger inputs.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Time Efficiency\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Space Usage\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Implementation Complexity\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Predictability\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Compute on demand—no caching\"\n        },\n        {\n          \"consequence\": \"You add an LRU cache. Hot paths are fast and memory bounded, but performance varies with access patterns and cache miss spikes can still occur.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Time Efficiency\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Space Usage\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Implementation Complexity\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Predictability\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Use an LRU cache with bounded size\"\n        }\n      ],\n      \"question\": \"How should we handle repeated computations?\"\n    },\n    {\n      \"context\": \"{{NAME}}, we must sort large datasets for analytics. Should we optimize for average speed, worst-case safety, or handle datasets that exceed memory?\",\n      \"options\": [\n        {\n          \"consequence\": \"You pick in-place quicksort. It's fast on average and uses minimal extra memory, but worst-case inputs can blow up latency unless you add safeguards.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Time Efficiency\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Space Usage\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Implementation Complexity\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Predictability\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Use in-place quicksort for average speed\"\n        },\n        {\n          \"consequence\": \"You use merge sort. Performance is stable and predictable even on adversarial inputs, but it uses extra memory and can be slower on small arrays.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Time Efficiency\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Space Usage\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Implementation Complexity\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Predictability\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Choose merge sort for stable, predictable performance\"\n        },\n        {\n          \"consequence\": \"You implement an external/streaming sort for out-of-memory datasets. It handles scale but is more complex and adds IO overhead, increasing job duration.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Time Efficiency\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Space Usage\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Implementation Complexity\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Predictability\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Do an external sort to handle huge datasets\"\n        }\n      ],\n      \"question\": \"Which sorting strategy do you adopt?\"\n    },\n    {\n      \"context\": \"{{NAME}}, we can parallelize processing across cores, keep a single-threaded optimized pipeline, or batch work into distributed jobs. Which route reduces SLA risk?\",\n      \"options\": [\n        {\n          \"consequence\": \"You parallelize across cores. Throughput improves for CPU-bound tasks, but synchronization bugs and contention increase complexity and latency can vary.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Time Efficiency\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Space Usage\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Implementation Complexity\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Predictability\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Parallelize workloads across available cores\"\n        },\n        {\n          \"consequence\": \"You optimize a single-threaded pipeline for locality and caching. Predictable latency improves and complexity stays low, but maximum throughput is limited.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Time Efficiency\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Space Usage\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Implementation Complexity\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Predictability\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Tighten single-threaded performance and data locality\"\n        },\n        {\n          \"consequence\": \"You batch into distributed jobs. You gain horizontal scale and resilience, but job latency increases and system complexity and resource use rise.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Time Efficiency\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Space Usage\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Implementation Complexity\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Predictability\",\n              \"impact\": \"neutral\"\n            }\n          ],\n          \"text\": \"Batch work into distributed jobs for scale\"\n        }\n      ],\n      \"question\": \"How do we scale processing?\"\n    },\n    {\n      \"context\": \"{{NAME}}, for a costly computation we can return exact results, an approximation, or adapt by input size. Stakeholders differ on accuracy versus speed—what do we deliver?\",\n      \"options\": [\n        {\n          \"consequence\": \"You deliver exact results. Accuracy is guaranteed and behavior is predictable, but compute time and memory can spike, impacting SLAs under heavy load.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Time Efficiency\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Space Usage\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Implementation Complexity\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Predictability\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Always compute exact results\"\n        },\n        {\n          \"consequence\": \"You use an approximate algorithm (sketches). Latency and memory drop, enabling scale, but results carry error bounds and some stakeholders may distrust approximations.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Time Efficiency\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Space Usage\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Implementation Complexity\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Predictability\",\n              \"impact\": \"neutral\"\n            }\n          ],\n          \"text\": \"Return approximate results with known error bounds\"\n        },\n        {\n          \"consequence\": \"You adapt: exact for small inputs, approximate when large. You balance accuracy and performance, but the hybrid adds branching logic and testing overhead.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Time Efficiency\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Space Usage\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Implementation Complexity\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Predictability\",\n              \"impact\": \"neutral\"\n            }\n          ],\n          \"text\": \"Use exact for small inputs, approximate for large ones\"\n        }\n      ],\n      \"question\": \"Exact, approximate, or hybrid approach?\"\n    }\n  ]\n}",
      "outputTokens": 3179,
      "systemPrompt": "# Role\n\nYou are an expert educational game designer creating a **Challenge** activity for a learning app. Your mission is to design a choose-your-own-adventure scenario where learners make strategic decisions with meaningful consequences, using the lesson's concepts.\n\nYou specialize in crafting narrative experiences that test strategic thinking — not knowledge recall, but the ability to apply concepts and understand trade-offs.\n\n# Why Narrative Challenges Work\n\nGreat challenges don't quiz — they immerse. Learners face realistic scenarios where every choice has consequences. They experience trade-offs firsthand, making the lesson's principles memorable.\n\n- **No \"Right Answer\"**: Every option has pros and cons. Learners engage with WHY, not just WHAT.\n- **Consequences Over Scores**: Instead of winning or losing, learners see the natural results of their choices.\n- **Strategic Thinking**: Understanding the lesson helps navigate trade-offs, but different strategies lead to different outcomes.\n\n# Inputs\n\n- `LESSON_TITLE`: The topic to create a challenge around\n- `LESSON_DESCRIPTION`: Additional context about what this lesson covers\n- `CHAPTER_TITLE`: The chapter context (for understanding scope)\n- `COURSE_TITLE`: The course context (for understanding audience level)\n- `LANGUAGE`: Output language\n- `EXPLANATION_STEPS`: What the learner has already studied\n\n## Language Guidelines\n\n- `en`: Use US English unless the content is region-specific\n- `pt`: Use Brazilian Portuguese unless the content is region-specific\n- `es`: Use Latin American Spanish unless the content is region-specific\n\n# Requirements\n\n## Introduction\n\nThe `intro` field sets the scene (max 500 characters). It should:\n\n- Establish the scenario and the learner's role\n- Explain what they're navigating (a project, situation, decision-making process)\n- Create stakes that feel meaningful\n- Use `{{NAME}}` to personalize\n\n## Steps\n\nCreate 4-6 steps. Each step presents a decision point with 3-4 options.\n\n### Step Structure\n\n- **context**: Maximum 500 characters. Pure dialogue from a colleague setting up the decision. Conversational, no narrator.\n- **question**: Maximum 100 characters. What needs to be decided.\n- **options**: 3-4 choices, each with:\n  - **text**: The choice (max 80 characters)\n  - **consequence**: What happens as a result (max 300 characters). Shown after choosing. Explains the outcome narratively.\n  - **effects**: Array of 1-3 effects showing how this choice impacts different aspects:\n    - **dimension**: A short name for what this affects (e.g., \"Code Quality\", \"Delivery Speed\", \"Team Morale\"). Use 2-4 different dimensions across all options to create meaningful trade-offs. Important: dimensions must be consistent across all steps.\n    - **impact**: Is this `\"positive\"`, `\"neutral\"`, or `\"negative\"` for that dimension?\n\n### Option Design\n\nEvery option should:\n\n- Be a legitimate choice (no obviously wrong answers)\n- Have a clear consequence that connects to lesson concepts\n- Affect 1-3 dimensions (real decisions rarely affect just one thing)\n- Teach something about trade-offs when the consequence is revealed\n\n**No option should be universally best.** Good options might help one dimension but hurt another. This creates genuine trade-offs.\n\n## Reflection\n\nThe `reflection` field (max 500 characters) provides closing insight after all steps. It should:\n\n- Acknowledge that different approaches have merit\n- Connect the experience back to the lesson's key principles\n- Help learners understand how the concepts apply in practice\n\n## Tone & Style\n\n- **Pure dialogue**: NO narrator, NO character prefixes, NO action descriptions\n- **Natural conversation**: Colleagues working through a problem together\n- **Professional but warm**: Light humor when appropriate\n- **Second-person immersion**: The colleague speaks TO the learner\n- **Use `{{NAME}}`** to personalize dialogue\n\n## What to Avoid\n\n- **Quiz-style questions**: This tests strategic thinking, not recall\n- **Obviously correct answers**: Every option should have genuine trade-offs\n- **Narrator text**: Keep it pure dialogue in context\n- **Disconnected consequences**: Consequences should relate to lesson concepts\n- **Too many or too few dimensions**: Use 2-4 different dimension names across all effects for meaningful trade-offs\n\n## Relationship to Previous Activities\n\nThe learner has completed:\n\n- **Background**: WHY this exists\n- **Explanation**: WHAT it is\n- **Mechanics**: HOW it works\n- **Examples**: WHERE it appears\n- **Story**: WHEN to apply this\n\nYour Challenge activity is the capstone: **CAN YOU NAVIGATE THIS?** It tests whether learners can apply concepts strategically. This should feel like a meaningful simulation, not a test.\n\n# Example\n\nFor a lesson on \"Technical Debt\":\n\n**Step 1:**\n\n```json\n{\n  \"context\": \"{{NAME}}, we've got a deadline crunch. The feature works but the code is messy. Ship it now or clean it up first?\",\n  \"question\": \"How do we handle this?\",\n  \"options\": [\n    {\n      \"text\": \"Ship it now, refactor later\",\n      \"consequence\": \"Feature launched on time! But the messy code made the next sprint's work harder. The team spent extra hours untangling dependencies.\",\n      \"effects\": [\n        { \"dimension\": \"Code Quality\", \"impact\": \"negative\" },\n        { \"dimension\": \"Delivery Speed\", \"impact\": \"positive\" }\n      ]\n    },\n    {\n      \"text\": \"Take two more days to refactor\",\n      \"consequence\": \"The code is clean and maintainable. Stakeholders weren't thrilled about the delay, but future changes will be much easier.\",\n      \"effects\": [\n        { \"dimension\": \"Code Quality\", \"impact\": \"positive\" },\n        { \"dimension\": \"Delivery Speed\", \"impact\": \"negative\" }\n      ]\n    },\n    {\n      \"text\": \"Split the team — half ships, half refactors\",\n      \"consequence\": \"Shipped on time with partial cleanup. Neither task got full attention, and the team felt stretched thin.\",\n      \"effects\": [\n        { \"dimension\": \"Code Quality\", \"impact\": \"neutral\" },\n        { \"dimension\": \"Team Morale\", \"impact\": \"negative\" }\n      ]\n    }\n  ]\n}\n```\n\n# Quality Checks\n\nBefore finalizing, verify:\n\n- [ ] Does the intro establish a clear, engaging scenario?\n- [ ] Does every option have a meaningful consequence?\n- [ ] Are consequences connected to lesson principles?\n- [ ] Is there no obviously \"best\" option in each step?\n- [ ] Do options affect multiple dimensions where realistic?\n- [ ] Are dimension names consistent and lesson-relevant across all effects?\n- [ ] Is `{{NAME}}` used appropriately?\n- [ ] Is all dialogue pure conversation (no narrator)?\n- [ ] Does the reflection tie the experience back to the lesson?\n- [ ] Are all constraints met (intro ≤500, context ≤500, question ≤100, text ≤80, consequence ≤300, reflection ≤500)?\n- [ ] Is the step count between 4 and 6?\n- [ ] Does every step have 3-4 options?\n\n# Output Format\n\nReturn an object with:\n\n- **intro**: Scenario introduction (max 500 chars)\n- **steps**: Array of 4-6 step objects, each with:\n  - **context**: Pure dialogue (max 500 chars)\n  - **question**: Decision prompt (max 100 chars)\n  - **options**: Array of 3-4 objects with:\n    - **text**: Choice description (max 80 chars)\n    - **consequence**: What happens (max 300 chars)\n    - **effects**: Array of 1-3 objects with:\n      - **dimension**: Short name for what this affects (use 2-4 different dimensions total)\n      - **impact**: One of \"positive\", \"neutral\", \"negative\"\n- **reflection**: Closing insight connecting to lesson (max 500 chars)\n",
      "testCaseId": "en-cs-algorithm-complexity-1",
      "userPrompt": "LESSON_TITLE: Algorithm Complexity Trade-offs\nLESSON_DESCRIPTION: Understanding and applying algorithm complexity analysis to make informed trade-offs in software design\nCHAPTER_TITLE: Algorithm Analysis\nCOURSE_TITLE: Data Structures and Algorithms\nLANGUAGE: en\nEXPLANATION_STEPS:\n1. Time Complexity: Time complexity measures how execution time grows with input size. O(n) means linear growth — double the input, double the time. O(n²) means quadratic — double the input, quadruple the time.\n2. Space Complexity: Space complexity measures memory usage growth. Some algorithms trade time for space — storing precomputed results to avoid recalculation. Others trade space for time — using less memory but computing more.\n3. Time-Space Trade-off: The time-space trade-off is fundamental. Hash tables give O(1) lookup but use extra memory. Binary search uses O(1) space but requires sorted data. Choose based on constraints.\n4. Amortized Analysis: Amortized analysis looks at average performance over many operations. ArrayList append is usually O(1), but occasionally O(n) when resizing. Amortized, it's still O(1).\n5. Case Analysis: Best, average, and worst case can differ dramatically. Quicksort averages O(n log n) but worst-cases to O(n²). Know your data distribution to choose wisely."
    },
    {
      "duration": 57112.21324999997,
      "inputTokens": 2086,
      "output": "{\n  \"intro\": \"{{NAME}}, you're the product lead for a new consumer device. Over the next quarter you'll set prices, respond to competitors, and balance production — every choice affects demand, supply, and profits. Can you steer the market toward a stable, profitable equilibrium?\",\n  \"reflection\": \"There’s no single right move — each choice trades off price, volume, profit, and inventory. Use elasticity to predict how customers react, recognize supply shifts vs. movements along curves, and pick strategies that match your market position and time horizon.\",\n  \"steps\": [\n    {\n      \"context\": \"{{NAME}}, we're about to launch the device next week. Do we price it high, low, or in line with the market?\",\n      \"options\": [\n        {\n          \"consequence\": \"You set a premium price. Early adopters buy, but many price-sensitive shoppers wait. Inventory moves slower while per-unit margins are healthy.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Selling Price\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Sales Volume\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Profit Margin\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Set a premium price\"\n        },\n        {\n          \"consequence\": \"You launch with a low penetration price. Sales spike, inventory clears quickly, and we grab share, but margins are thin and scaling costs rise.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Selling Price\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Sales Volume\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Profit Margin\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Use a low penetration price\"\n        },\n        {\n          \"consequence\": \"You match the market average. Demand and inventory stay predictable; growth is steady but less dramatic than bold moves.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Selling Price\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Sales Volume\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Profit Margin\",\n              \"impact\": \"neutral\"\n            }\n          ],\n          \"text\": \"Price at market average\"\n        }\n      ],\n      \"question\": \"Which pricing strategy do you choose?\"\n    },\n    {\n      \"context\": \"{{NAME}}, a competitor cut their price 15% this morning and marketing is panicking. Do we follow or respond differently?\",\n      \"options\": [\n        {\n          \"consequence\": \"We match the price cut. Market share stabilizes if demand is elastic, but our margins shrink and profitability drops until volumes rise enough.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Selling Price\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Profit Margin\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Sales Volume\",\n              \"impact\": \"neutral\"\n            }\n          ],\n          \"text\": \"Match the competitor's price\"\n        },\n        {\n          \"consequence\": \"We keep our price and push quality messaging. Some bargain hunters defect, but loyal customers stay and margins hold if demand is relatively inelastic.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Selling Price\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Sales Volume\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Profit Margin\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Hold price and emphasize quality\"\n        },\n        {\n          \"consequence\": \"We run a short, targeted promotion. Sales jump temporarily and inventory moves faster without committing to a permanent price drop.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Selling Price\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Sales Volume\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Inventory Levels\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Offer a time-limited promotion\"\n        }\n      ],\n      \"question\": \"How should we respond?\"\n    },\n    {\n      \"context\": \"{{NAME}}, our supplier raised raw-material costs, shifting supply up. Production will be more expensive. What’s our plan?\",\n      \"options\": [\n        {\n          \"consequence\": \"We raise prices to pass costs on. Demand falls somewhat as customers adjust, but per-unit margins are preserved and we avoid losses.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Selling Price\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Sales Volume\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Profit Margin\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Increase price to cover costs\"\n        },\n        {\n          \"consequence\": \"We absorb the cost to keep price stable. Sales stay steady, but our margins shrink and profitability weakens until costs normalize.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Selling Price\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Sales Volume\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Profit Margin\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Absorb the cost temporarily\"\n        },\n        {\n          \"consequence\": \"We cut production of low-margin SKUs and focus on best-sellers. Supply tightens on some items, reducing waste but lowering total units sold.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Sales Volume\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Inventory Levels\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Profit Margin\",\n              \"impact\": \"neutral\"\n            }\n          ],\n          \"text\": \"Prioritize top-selling SKUs\"\n        }\n      ],\n      \"question\": \"How do we handle the cost increase?\"\n    },\n    {\n      \"context\": \"{{NAME}}, our device just went viral and demand far exceeds supply. We’re facing shortages and unhappy customers. Options?\",\n      \"options\": [\n        {\n          \"consequence\": \"We raise price to temper demand. The shortage eases, revenue per unit rises, but some potential customers are priced out.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Selling Price\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Sales Volume\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Profit Margin\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Raise price to ration demand\"\n        },\n        {\n          \"consequence\": \"We ramp up production quickly. We meet more demand and build market share, but incur higher short-term inventory and supply-chain strain.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Sales Volume\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Inventory Levels\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Profit Margin\",\n              \"impact\": \"neutral\"\n            }\n          ],\n          \"text\": \"Increase production rapidly\"\n        },\n        {\n          \"consequence\": \"We limit purchases per customer. That keeps distribution fair and reduces hoarding, but limits revenue and frustrates some buyers.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Sales Volume\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Inventory Levels\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Profit Margin\",\n              \"impact\": \"neutral\"\n            }\n          ],\n          \"text\": \"Limit units per customer\"\n        }\n      ],\n      \"question\": \"What's our shortage strategy?\"\n    },\n    {\n      \"context\": \"{{NAME}}, looking out a year: do we expand capacity, reposition the product, or adopt dynamic pricing to stay competitive?\",\n      \"options\": [\n        {\n          \"consequence\": \"We invest in production capacity. Supply constraints ease, we can meet demand spikes, and market share grows, but upfront costs depress short-term profit.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Inventory Levels\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Sales Volume\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Profit Margin\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Invest in production capacity\"\n        },\n        {\n          \"consequence\": \"We differentiate the product with features and branding. If successful, demand shifts out and becomes less price-sensitive, supporting higher prices and volume over time.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Selling Price\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Sales Volume\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Profit Margin\",\n              \"impact\": \"neutral\"\n            }\n          ],\n          \"text\": \"Differentiate to shift demand\"\n        },\n        {\n          \"consequence\": \"We implement dynamic pricing. Revenue management improves and margins rise, but customers may notice price variability and react unpredictably.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Profit Margin\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Sales Volume\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Selling Price\",\n              \"impact\": \"neutral\"\n            }\n          ],\n          \"text\": \"Adopt dynamic pricing algorithms\"\n        }\n      ],\n      \"question\": \"Which long-term strategy do you choose?\"\n    }\n  ]\n}",
      "outputTokens": 4542,
      "systemPrompt": "# Role\n\nYou are an expert educational game designer creating a **Challenge** activity for a learning app. Your mission is to design a choose-your-own-adventure scenario where learners make strategic decisions with meaningful consequences, using the lesson's concepts.\n\nYou specialize in crafting narrative experiences that test strategic thinking — not knowledge recall, but the ability to apply concepts and understand trade-offs.\n\n# Why Narrative Challenges Work\n\nGreat challenges don't quiz — they immerse. Learners face realistic scenarios where every choice has consequences. They experience trade-offs firsthand, making the lesson's principles memorable.\n\n- **No \"Right Answer\"**: Every option has pros and cons. Learners engage with WHY, not just WHAT.\n- **Consequences Over Scores**: Instead of winning or losing, learners see the natural results of their choices.\n- **Strategic Thinking**: Understanding the lesson helps navigate trade-offs, but different strategies lead to different outcomes.\n\n# Inputs\n\n- `LESSON_TITLE`: The topic to create a challenge around\n- `LESSON_DESCRIPTION`: Additional context about what this lesson covers\n- `CHAPTER_TITLE`: The chapter context (for understanding scope)\n- `COURSE_TITLE`: The course context (for understanding audience level)\n- `LANGUAGE`: Output language\n- `EXPLANATION_STEPS`: What the learner has already studied\n\n## Language Guidelines\n\n- `en`: Use US English unless the content is region-specific\n- `pt`: Use Brazilian Portuguese unless the content is region-specific\n- `es`: Use Latin American Spanish unless the content is region-specific\n\n# Requirements\n\n## Introduction\n\nThe `intro` field sets the scene (max 500 characters). It should:\n\n- Establish the scenario and the learner's role\n- Explain what they're navigating (a project, situation, decision-making process)\n- Create stakes that feel meaningful\n- Use `{{NAME}}` to personalize\n\n## Steps\n\nCreate 4-6 steps. Each step presents a decision point with 3-4 options.\n\n### Step Structure\n\n- **context**: Maximum 500 characters. Pure dialogue from a colleague setting up the decision. Conversational, no narrator.\n- **question**: Maximum 100 characters. What needs to be decided.\n- **options**: 3-4 choices, each with:\n  - **text**: The choice (max 80 characters)\n  - **consequence**: What happens as a result (max 300 characters). Shown after choosing. Explains the outcome narratively.\n  - **effects**: Array of 1-3 effects showing how this choice impacts different aspects:\n    - **dimension**: A short name for what this affects (e.g., \"Code Quality\", \"Delivery Speed\", \"Team Morale\"). Use 2-4 different dimensions across all options to create meaningful trade-offs. Important: dimensions must be consistent across all steps.\n    - **impact**: Is this `\"positive\"`, `\"neutral\"`, or `\"negative\"` for that dimension?\n\n### Option Design\n\nEvery option should:\n\n- Be a legitimate choice (no obviously wrong answers)\n- Have a clear consequence that connects to lesson concepts\n- Affect 1-3 dimensions (real decisions rarely affect just one thing)\n- Teach something about trade-offs when the consequence is revealed\n\n**No option should be universally best.** Good options might help one dimension but hurt another. This creates genuine trade-offs.\n\n## Reflection\n\nThe `reflection` field (max 500 characters) provides closing insight after all steps. It should:\n\n- Acknowledge that different approaches have merit\n- Connect the experience back to the lesson's key principles\n- Help learners understand how the concepts apply in practice\n\n## Tone & Style\n\n- **Pure dialogue**: NO narrator, NO character prefixes, NO action descriptions\n- **Natural conversation**: Colleagues working through a problem together\n- **Professional but warm**: Light humor when appropriate\n- **Second-person immersion**: The colleague speaks TO the learner\n- **Use `{{NAME}}`** to personalize dialogue\n\n## What to Avoid\n\n- **Quiz-style questions**: This tests strategic thinking, not recall\n- **Obviously correct answers**: Every option should have genuine trade-offs\n- **Narrator text**: Keep it pure dialogue in context\n- **Disconnected consequences**: Consequences should relate to lesson concepts\n- **Too many or too few dimensions**: Use 2-4 different dimension names across all effects for meaningful trade-offs\n\n## Relationship to Previous Activities\n\nThe learner has completed:\n\n- **Background**: WHY this exists\n- **Explanation**: WHAT it is\n- **Mechanics**: HOW it works\n- **Examples**: WHERE it appears\n- **Story**: WHEN to apply this\n\nYour Challenge activity is the capstone: **CAN YOU NAVIGATE THIS?** It tests whether learners can apply concepts strategically. This should feel like a meaningful simulation, not a test.\n\n# Example\n\nFor a lesson on \"Technical Debt\":\n\n**Step 1:**\n\n```json\n{\n  \"context\": \"{{NAME}}, we've got a deadline crunch. The feature works but the code is messy. Ship it now or clean it up first?\",\n  \"question\": \"How do we handle this?\",\n  \"options\": [\n    {\n      \"text\": \"Ship it now, refactor later\",\n      \"consequence\": \"Feature launched on time! But the messy code made the next sprint's work harder. The team spent extra hours untangling dependencies.\",\n      \"effects\": [\n        { \"dimension\": \"Code Quality\", \"impact\": \"negative\" },\n        { \"dimension\": \"Delivery Speed\", \"impact\": \"positive\" }\n      ]\n    },\n    {\n      \"text\": \"Take two more days to refactor\",\n      \"consequence\": \"The code is clean and maintainable. Stakeholders weren't thrilled about the delay, but future changes will be much easier.\",\n      \"effects\": [\n        { \"dimension\": \"Code Quality\", \"impact\": \"positive\" },\n        { \"dimension\": \"Delivery Speed\", \"impact\": \"negative\" }\n      ]\n    },\n    {\n      \"text\": \"Split the team — half ships, half refactors\",\n      \"consequence\": \"Shipped on time with partial cleanup. Neither task got full attention, and the team felt stretched thin.\",\n      \"effects\": [\n        { \"dimension\": \"Code Quality\", \"impact\": \"neutral\" },\n        { \"dimension\": \"Team Morale\", \"impact\": \"negative\" }\n      ]\n    }\n  ]\n}\n```\n\n# Quality Checks\n\nBefore finalizing, verify:\n\n- [ ] Does the intro establish a clear, engaging scenario?\n- [ ] Does every option have a meaningful consequence?\n- [ ] Are consequences connected to lesson principles?\n- [ ] Is there no obviously \"best\" option in each step?\n- [ ] Do options affect multiple dimensions where realistic?\n- [ ] Are dimension names consistent and lesson-relevant across all effects?\n- [ ] Is `{{NAME}}` used appropriately?\n- [ ] Is all dialogue pure conversation (no narrator)?\n- [ ] Does the reflection tie the experience back to the lesson?\n- [ ] Are all constraints met (intro ≤500, context ≤500, question ≤100, text ≤80, consequence ≤300, reflection ≤500)?\n- [ ] Is the step count between 4 and 6?\n- [ ] Does every step have 3-4 options?\n\n# Output Format\n\nReturn an object with:\n\n- **intro**: Scenario introduction (max 500 chars)\n- **steps**: Array of 4-6 step objects, each with:\n  - **context**: Pure dialogue (max 500 chars)\n  - **question**: Decision prompt (max 100 chars)\n  - **options**: Array of 3-4 objects with:\n    - **text**: Choice description (max 80 chars)\n    - **consequence**: What happens (max 300 chars)\n    - **effects**: Array of 1-3 objects with:\n      - **dimension**: Short name for what this affects (use 2-4 different dimensions total)\n      - **impact**: One of \"positive\", \"neutral\", \"negative\"\n- **reflection**: Closing insight connecting to lesson (max 500 chars)\n",
      "testCaseId": "en-economics-supply-demand-1",
      "userPrompt": "LESSON_TITLE: Supply and Demand in Practice\nLESSON_DESCRIPTION: Applying supply and demand principles to make strategic pricing and market decisions\nCHAPTER_TITLE: Market Dynamics\nCOURSE_TITLE: Microeconomics Fundamentals\nLANGUAGE: en\nEXPLANATION_STEPS:\n1. The Demand Curve: Demand curves slope downward — as price rises, quantity demanded falls. This reflects the law of demand: people buy less when things cost more, all else equal.\n2. The Supply Curve: Supply curves slope upward — as price rises, quantity supplied increases. Higher prices incentivize producers to make more. Lower prices make production less worthwhile.\n3. Market Equilibrium: Equilibrium occurs where supply meets demand. At this price, quantity supplied equals quantity demanded. Prices above equilibrium create surplus; prices below create shortage.\n4. Price Elasticity: Price elasticity measures responsiveness to price changes. Elastic demand (>1) means sales drop sharply with price increases. Inelastic demand (<1) means sales barely change.\n5. Shifts vs. Movements: Shifts vs. movements: A change in price moves along the curve. Changes in other factors (income, preferences, costs) shift the entire curve. This distinction is crucial."
    },
    {
      "duration": 41902.065416999976,
      "inputTokens": 2094,
      "output": "{\n  \"intro\": \"You're the lead manager of a mixed-use reserve facing invasive species, grazing pressure, and tourism demand. {{NAME}}, every decision shifts food webs, local livelihoods, and the reserve's future. Navigate trade-offs between short-term gains and long-term ecosystem balance.\",\n  \"reflection\": \"There wasn't one 'right' path — each choice traded biodiversity, productivity, resilience, and stakeholder support. Good management names the trade-offs: use knowledge of keystone species, carrying capacity, succession, and trophic cascades to pick strategies that balance short-term needs with long-term ecosystem health.\",\n  \"steps\": [\n    {\n      \"context\": \"{{NAME}}, the invasive reed is spreading through the wet meadow and choking native plants. We need to act before wetland specialists disappear.\",\n      \"options\": [\n        {\n          \"consequence\": \"Crews removed the reed mechanically. Native plants recovered slowly where cleared, but costs were high and some seed banks were disturbed.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Biodiversity\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Productivity\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Stakeholder Support\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Fund an intensive mechanical removal campaign\"\n        },\n        {\n          \"consequence\": \"A controlled burn reset succession and gave pioneers room to return. It reduced the reed but risked nearby nests and drew local criticism.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Biodiversity\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Resilience\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Stakeholder Support\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Use a controlled burn to reset the meadow\"\n        },\n        {\n          \"consequence\": \"We introduced a grazing specialist that prefers the reed. The reed declined, but the grazer also ate some native sprouts and its population needs ongoing control.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Biodiversity\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Resilience\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Productivity\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Introduce a biocontrol grazer\"\n        },\n        {\n          \"consequence\": \"We monitored and only removed patches. The reed slowly spread into remote areas but sensitive species in core zones persisted undisturbed.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Biodiversity\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Stakeholder Support\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Resilience\",\n              \"impact\": \"neutral\"\n            }\n          ],\n          \"text\": \"Monitor and respond only to hotspots\"\n        }\n      ],\n      \"question\": \"How should we address the invasive reed?\"\n    },\n    {\n      \"context\": \"{{NAME}}, deer numbers have surged and are overbrowsing saplings. Without action the forest can't regenerate.\",\n      \"options\": [\n        {\n          \"consequence\": \"A targeted cull reduced deer quickly. Saplings rebounded but the move angered some locals and reduced opportunities for photo-tourism.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Biodiversity\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Stakeholder Support\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Productivity\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Authorise a targeted population cull\"\n        },\n        {\n          \"consequence\": \"We translocated deer to nearby reserves. Pressure eased locally but moving animals was costly, and some individuals didn't survive transport.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Resilience\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Productivity\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Stakeholder Support\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Translocate surplus deer to other parks\"\n        },\n        {\n          \"consequence\": \"We fenced young-forest plots. Saplings thrived in protected patches, but fencing fragments habitat and limits animal movement.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Biodiversity\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Resilience\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Stakeholder Support\",\n              \"impact\": \"neutral\"\n            }\n          ],\n          \"text\": \"Fence regeneration plots to protect saplings\"\n        },\n        {\n          \"consequence\": \"We invested in community-led hunting licences. Deer declines were gradual and locals gained income, but outcomes were uneven.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Stakeholder Support\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Biodiversity\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Productivity\",\n              \"impact\": \"neutral\"\n            }\n          ],\n          \"text\": \"Set up regulated community harvests\"\n        }\n      ],\n      \"question\": \"What population control strategy do you choose?\"\n    },\n    {\n      \"context\": \"{{NAME}}, scientists suggest reintroducing a keystone carnivore to control herbivores and restore balance. Neighbors fear livestock losses.\",\n      \"options\": [\n        {\n          \"consequence\": \"Full reintroduction restored predator-prey dynamics and vegetation recovered, but livestock incidents rose and compensation costs ballooned.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Biodiversity\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Resilience\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Stakeholder Support\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Proceed with full predator reintroduction\"\n        },\n        {\n          \"consequence\": \"A small pilot reintroduction let us monitor impacts and adapt. Benefits appeared slowly and critics argued it was too cautious.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Resilience\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Stakeholder Support\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Biodiversity\",\n              \"impact\": \"neutral\"\n            }\n          ],\n          \"text\": \"Start with a limited, closely monitored pilot\"\n        },\n        {\n          \"consequence\": \"We avoided reintroduction and invested in livestock protection. Predation ceased but herbivore numbers stayed high and plant diversity declined.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Stakeholder Support\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Biodiversity\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Productivity\",\n              \"impact\": \"neutral\"\n            }\n          ],\n          \"text\": \"Protect livestock and postpone reintroduction\"\n        },\n        {\n          \"consequence\": \"We created compensation and incentive schemes for neighbours tied to conservation outcomes. Support grew but the program required complex administration.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Stakeholder Support\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Resilience\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Productivity\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Link compensation and incentives to conservation\"\n        }\n      ],\n      \"question\": \"Do we reintroduce the keystone predator?\"\n    },\n    {\n      \"context\": \"{{NAME}}, a 50-hectare former field could be left to natural succession, actively replanted, turned into mixed habitat, or converted to grazing pasture to boost local income.\",\n      \"options\": [\n        {\n          \"consequence\": \"Passive regeneration produced a diverse mosaic over years but left the area vulnerable to invasive species early on.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Biodiversity\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Productivity\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Resilience\",\n              \"impact\": \"neutral\"\n            }\n          ],\n          \"text\": \"Allow natural succession with minimal intervention\"\n        },\n        {\n          \"consequence\": \"Active planting accelerated forest recovery and increased native cover, but it was costly and favored certain species over rarer pioneers.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Resilience\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Biodiversity\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Productivity\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Replant with native pioneers and canopy species\"\n        },\n        {\n          \"consequence\": \"We designed a mosaic of meadow, scrub, and young forest to maximize niches. Management is complex but species variety and visitor experiences improved.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Biodiversity\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Productivity\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Stakeholder Support\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Create a managed habitat mosaic\"\n        },\n        {\n          \"consequence\": \"Converting to pasture increased short-term income and predictable grazing, but biodiversity dropped and long-term resilience weakened.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Productivity\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Biodiversity\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Resilience\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Turn it into high-yield grazing pasture\"\n        }\n      ],\n      \"question\": \"How do we manage the former field?\"\n    },\n    {\n      \"context\": \"{{NAME}}, visitor numbers are spiking. Expanding trails would increase revenue but may harm habitats; restricting access angers tour operators.\",\n      \"options\": [\n        {\n          \"consequence\": \"We expanded trails and facilities. Visitor revenue rose but sensitive areas saw trampling and nesting disturbance.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Productivity\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Biodiversity\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Stakeholder Support\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Open new trails and build facilities\"\n        },\n        {\n          \"consequence\": \"We kept trails as-is but raised fees and invested in interpretation. Visitor numbers stabilized and revenue matched conservation spending, though some tourists balked.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Stakeholder Support\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Productivity\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Biodiversity\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Limit access, raise fees, and improve interpretation\"\n        },\n        {\n          \"consequence\": \"Seasonal closures protected breeding sites but reduced off-season income and required clear communication to avoid complaints.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Biodiversity\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Productivity\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Stakeholder Support\",\n              \"impact\": \"neutral\"\n            }\n          ],\n          \"text\": \"Implement seasonal closures for sensitive zones\"\n        },\n        {\n          \"consequence\": \"We partnered with local guides for low-impact ecotours. Revenue and local buy-in increased, but scaling quickly strained guide quality control.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Stakeholder Support\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Productivity\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Resilience\",\n              \"impact\": \"neutral\"\n            }\n          ],\n          \"text\": \"Develop community-led low-impact ecotourism\"\n        }\n      ],\n      \"question\": \"What tourism policy do you implement?\"\n    }\n  ]\n}",
      "outputTokens": 3326,
      "systemPrompt": "# Role\n\nYou are an expert educational game designer creating a **Challenge** activity for a learning app. Your mission is to design a choose-your-own-adventure scenario where learners make strategic decisions with meaningful consequences, using the lesson's concepts.\n\nYou specialize in crafting narrative experiences that test strategic thinking — not knowledge recall, but the ability to apply concepts and understand trade-offs.\n\n# Why Narrative Challenges Work\n\nGreat challenges don't quiz — they immerse. Learners face realistic scenarios where every choice has consequences. They experience trade-offs firsthand, making the lesson's principles memorable.\n\n- **No \"Right Answer\"**: Every option has pros and cons. Learners engage with WHY, not just WHAT.\n- **Consequences Over Scores**: Instead of winning or losing, learners see the natural results of their choices.\n- **Strategic Thinking**: Understanding the lesson helps navigate trade-offs, but different strategies lead to different outcomes.\n\n# Inputs\n\n- `LESSON_TITLE`: The topic to create a challenge around\n- `LESSON_DESCRIPTION`: Additional context about what this lesson covers\n- `CHAPTER_TITLE`: The chapter context (for understanding scope)\n- `COURSE_TITLE`: The course context (for understanding audience level)\n- `LANGUAGE`: Output language\n- `EXPLANATION_STEPS`: What the learner has already studied\n\n## Language Guidelines\n\n- `en`: Use US English unless the content is region-specific\n- `pt`: Use Brazilian Portuguese unless the content is region-specific\n- `es`: Use Latin American Spanish unless the content is region-specific\n\n# Requirements\n\n## Introduction\n\nThe `intro` field sets the scene (max 500 characters). It should:\n\n- Establish the scenario and the learner's role\n- Explain what they're navigating (a project, situation, decision-making process)\n- Create stakes that feel meaningful\n- Use `{{NAME}}` to personalize\n\n## Steps\n\nCreate 4-6 steps. Each step presents a decision point with 3-4 options.\n\n### Step Structure\n\n- **context**: Maximum 500 characters. Pure dialogue from a colleague setting up the decision. Conversational, no narrator.\n- **question**: Maximum 100 characters. What needs to be decided.\n- **options**: 3-4 choices, each with:\n  - **text**: The choice (max 80 characters)\n  - **consequence**: What happens as a result (max 300 characters). Shown after choosing. Explains the outcome narratively.\n  - **effects**: Array of 1-3 effects showing how this choice impacts different aspects:\n    - **dimension**: A short name for what this affects (e.g., \"Code Quality\", \"Delivery Speed\", \"Team Morale\"). Use 2-4 different dimensions across all options to create meaningful trade-offs. Important: dimensions must be consistent across all steps.\n    - **impact**: Is this `\"positive\"`, `\"neutral\"`, or `\"negative\"` for that dimension?\n\n### Option Design\n\nEvery option should:\n\n- Be a legitimate choice (no obviously wrong answers)\n- Have a clear consequence that connects to lesson concepts\n- Affect 1-3 dimensions (real decisions rarely affect just one thing)\n- Teach something about trade-offs when the consequence is revealed\n\n**No option should be universally best.** Good options might help one dimension but hurt another. This creates genuine trade-offs.\n\n## Reflection\n\nThe `reflection` field (max 500 characters) provides closing insight after all steps. It should:\n\n- Acknowledge that different approaches have merit\n- Connect the experience back to the lesson's key principles\n- Help learners understand how the concepts apply in practice\n\n## Tone & Style\n\n- **Pure dialogue**: NO narrator, NO character prefixes, NO action descriptions\n- **Natural conversation**: Colleagues working through a problem together\n- **Professional but warm**: Light humor when appropriate\n- **Second-person immersion**: The colleague speaks TO the learner\n- **Use `{{NAME}}`** to personalize dialogue\n\n## What to Avoid\n\n- **Quiz-style questions**: This tests strategic thinking, not recall\n- **Obviously correct answers**: Every option should have genuine trade-offs\n- **Narrator text**: Keep it pure dialogue in context\n- **Disconnected consequences**: Consequences should relate to lesson concepts\n- **Too many or too few dimensions**: Use 2-4 different dimension names across all effects for meaningful trade-offs\n\n## Relationship to Previous Activities\n\nThe learner has completed:\n\n- **Background**: WHY this exists\n- **Explanation**: WHAT it is\n- **Mechanics**: HOW it works\n- **Examples**: WHERE it appears\n- **Story**: WHEN to apply this\n\nYour Challenge activity is the capstone: **CAN YOU NAVIGATE THIS?** It tests whether learners can apply concepts strategically. This should feel like a meaningful simulation, not a test.\n\n# Example\n\nFor a lesson on \"Technical Debt\":\n\n**Step 1:**\n\n```json\n{\n  \"context\": \"{{NAME}}, we've got a deadline crunch. The feature works but the code is messy. Ship it now or clean it up first?\",\n  \"question\": \"How do we handle this?\",\n  \"options\": [\n    {\n      \"text\": \"Ship it now, refactor later\",\n      \"consequence\": \"Feature launched on time! But the messy code made the next sprint's work harder. The team spent extra hours untangling dependencies.\",\n      \"effects\": [\n        { \"dimension\": \"Code Quality\", \"impact\": \"negative\" },\n        { \"dimension\": \"Delivery Speed\", \"impact\": \"positive\" }\n      ]\n    },\n    {\n      \"text\": \"Take two more days to refactor\",\n      \"consequence\": \"The code is clean and maintainable. Stakeholders weren't thrilled about the delay, but future changes will be much easier.\",\n      \"effects\": [\n        { \"dimension\": \"Code Quality\", \"impact\": \"positive\" },\n        { \"dimension\": \"Delivery Speed\", \"impact\": \"negative\" }\n      ]\n    },\n    {\n      \"text\": \"Split the team — half ships, half refactors\",\n      \"consequence\": \"Shipped on time with partial cleanup. Neither task got full attention, and the team felt stretched thin.\",\n      \"effects\": [\n        { \"dimension\": \"Code Quality\", \"impact\": \"neutral\" },\n        { \"dimension\": \"Team Morale\", \"impact\": \"negative\" }\n      ]\n    }\n  ]\n}\n```\n\n# Quality Checks\n\nBefore finalizing, verify:\n\n- [ ] Does the intro establish a clear, engaging scenario?\n- [ ] Does every option have a meaningful consequence?\n- [ ] Are consequences connected to lesson principles?\n- [ ] Is there no obviously \"best\" option in each step?\n- [ ] Do options affect multiple dimensions where realistic?\n- [ ] Are dimension names consistent and lesson-relevant across all effects?\n- [ ] Is `{{NAME}}` used appropriately?\n- [ ] Is all dialogue pure conversation (no narrator)?\n- [ ] Does the reflection tie the experience back to the lesson?\n- [ ] Are all constraints met (intro ≤500, context ≤500, question ≤100, text ≤80, consequence ≤300, reflection ≤500)?\n- [ ] Is the step count between 4 and 6?\n- [ ] Does every step have 3-4 options?\n\n# Output Format\n\nReturn an object with:\n\n- **intro**: Scenario introduction (max 500 chars)\n- **steps**: Array of 4-6 step objects, each with:\n  - **context**: Pure dialogue (max 500 chars)\n  - **question**: Decision prompt (max 100 chars)\n  - **options**: Array of 3-4 objects with:\n    - **text**: Choice description (max 80 chars)\n    - **consequence**: What happens (max 300 chars)\n    - **effects**: Array of 1-3 objects with:\n      - **dimension**: Short name for what this affects (use 2-4 different dimensions total)\n      - **impact**: One of \"positive\", \"neutral\", \"negative\"\n- **reflection**: Closing insight connecting to lesson (max 500 chars)\n",
      "testCaseId": "en-biology-ecosystem-balance-1",
      "userPrompt": "LESSON_TITLE: Ecosystem Balance and Management\nLESSON_DESCRIPTION: Applying ecological principles to make informed ecosystem management decisions\nCHAPTER_TITLE: Ecosystem Dynamics\nCOURSE_TITLE: Ecology and Conservation\nLANGUAGE: en\nEXPLANATION_STEPS:\n1. Interconnected Networks: Ecosystems are interconnected networks. Removing one species affects others through food webs. Keystone species have disproportionate impact — their loss cascades through the system.\n2. Carrying Capacity: Carrying capacity is the maximum population an environment can sustain. Exceed it, and resources deplete, populations crash. Stay well below, and you're not maximizing the ecosystem's potential.\n3. Biodiversity and Resilience: Biodiversity provides resilience. More species means more ways to respond to change. Monocultures are efficient but fragile. Diverse systems are robust but complex to manage.\n4. Trophic Cascades: Trophic cascades occur when changes at one level ripple through others. Remove predators, and prey populations explode, overgrazing vegetation, affecting everything that depends on those plants.\n5. Ecological Succession: Ecological succession is the process of change over time. Pioneer species prepare the way for later ones. Managing ecosystems means deciding where in succession you want to be."
    },
    {
      "duration": 56289.867624999955,
      "inputTokens": 2146,
      "output": "{\n  \"intro\": \"Estamos numa planta piloto produzindo o produto P por A + B ⇌ P (reação exotérmica). {{NAME}}, você decide ajustes operacionais para equilibrar rendimento, tempo, custo e segurança — cada escolha tem trade-offs reais.\",\n  \"reflection\": \"Boa escolha: não há solução única. Aplicar Le Chatelier ajuda a prever direção das mudanças, mas pressão, temperatura, remoção de produto e catalisadores criam trade-offs entre rendimento, tempo, custo e segurança. Reflita sobre prioridades do processo antes de decidir.\",\n  \"steps\": [\n    {\n      \"context\": \"{{NAME}}, a conversão atual está baixa. Podemos aumentar conversão adicionando reagente, removendo produto continuamente ou reciclando o não convertido. O que prefere?\",\n      \"options\": [\n        {\n          \"consequence\": \"Adicionar excesso de A desloca o equilíbrio para produtos e aumenta a conversão imediatamente, mas o custo do reagente sobe e haverá maior necessidade de separação downstream.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Rendimento\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Custo\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Tempo\",\n              \"impact\": \"neutral\"\n            }\n          ],\n          \"text\": \"Injetar excesso de reagente A\"\n        },\n        {\n          \"consequence\": \"Remoção contínua do produto via destilação aumenta o deslocamento para produtos e rendimento. Equipamento extra eleva custo e manuseio adicional pode reduzir segurança operacional.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Rendimento\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Custo\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Segurança\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Remover produto continuamente (destilação)\"\n        },\n        {\n          \"consequence\": \"Reciclar o não convertido melhora conversão cumulativa sem aumentar muito o gasto de reagente, mas aumenta o tempo médio de residência e exige bombas/compressores extras.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Rendimento\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Tempo\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Custo\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Reintentar e reciclar fluxo não convertido\"\n        }\n      ],\n      \"question\": \"Como aumentar conversão agora?\"\n    },\n    {\n      \"context\": \"{{NAME}}, a reação envolve gases e o lado produto tem menos moles gasosos. Podemos aumentar pressão, reduzir pressão ou injetar gás inerte. O que faria?\",\n      \"options\": [\n        {\n          \"consequence\": \"Aumentar a pressão favorece formação de P (mais rendimento). Compressão consome energia e exige vasos de alta pressão, elevando custos e riscos operacionais.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Rendimento\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Custo\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Segurança\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Compressão — operar a pressão mais alta\"\n        },\n        {\n          \"consequence\": \"Reduzir pressão torna a operação mais segura e barata, mas desloca o equilíbrio para reagentes e reduz rendimento final.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Rendimento\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Custo\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Segurança\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Baixar pressão para operar mais seguro e barato\"\n        },\n        {\n          \"consequence\": \"Adicionar gás inerte a volume constante tende a aumentar a pressão total sem alterar diretamente os equilíbrios parciais — pouco ganho de rendimento, mas custo e complexidade aumentam.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Rendimento\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Custo\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Segurança\",\n              \"impact\": \"neutral\"\n            }\n          ],\n          \"text\": \"Adicionar gás inerte ao sistema\"\n        }\n      ],\n      \"question\": \"Ajustamos a pressão?\"\n    },\n    {\n      \"context\": \"{{NAME}}, a reação é exotérmica. Ajustar temperatura afeta tanto o rendimento quanto a velocidade. Subir ou descer a temperatura — ou compensar com catalisador?\",\n      \"options\": [\n        {\n          \"consequence\": \"Resfriar o reator desloca o equilíbrio para produtos e aumenta o rendimento, mas reduz a velocidade da reação, exigindo tempos maiores ou mais catalisador.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Rendimento\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Tempo\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Custo\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Resfriar para favorecer produtos\"\n        },\n        {\n          \"consequence\": \"Aumentar a temperatura acelera a reação e reduz tempo até equilíbrio, porém desloca o equilíbrio para reagentes e diminui rendimento final; há também riscos térmicos.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Tempo\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Rendimento\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Segurança\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Elevar temperatura para acelerar a reação\"\n        },\n        {\n          \"consequence\": \"Manter temperatura moderada e usar catalisador acelera a cinética sem mudar o equilíbrio; rendimento fica parecido, tempo melhora, mas há custo e necessidade de manejo do catalisador.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Tempo\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Rendimento\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Custo\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Usar catalisador com temperatura moderada\"\n        }\n      ],\n      \"question\": \"Qual estratégia térmica escolher?\"\n    },\n    {\n      \"context\": \"{{NAME}}, podemos introduzir um catalisador, aumentar o tempo de residência ou projetar reatores em série com resfriamento entre estágios. Qual opção prefere?\",\n      \"options\": [\n        {\n          \"consequence\": \"Adicionar um catalisador acelera a aproximação ao equilíbrio sem alterar o rendimento máximo. Implementação tem custo inicial e exige controle de vida útil do catalisador.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Tempo\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Rendimento\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Custo\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Instalar catalisador ativo no reator\"\n        },\n        {\n          \"consequence\": \"Aumentar o tempo de residência melhora conversão por permitir maior aproximação ao equilíbrio, mas reduz vazão e aumenta custos operacionais por hora de processamento.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Rendimento\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Tempo\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Custo\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Aumentar tempo de residência (reduzir vazão)\"\n        },\n        {\n          \"consequence\": \"Reatores em série com resfriamento entre estágios removem calor e deslocam equilíbrio a cada estágio, melhorando conversão. Solução cara e mais complexa, com riscos operacionais maiores.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Rendimento\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Custo\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Segurança\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Usar reatores em série com resfriamento intersticial\"\n        }\n      ],\n      \"question\": \"Como otimizar cinética vs conversão?\"\n    },\n    {\n      \"context\": \"{{NAME}}, estamos prontos para escala. Decida a estratégia operacional: forte compressão e longas campanhas, operar rápido a menor pressão, ou investir em reciclo e separação intensiva.\",\n      \"options\": [\n        {\n          \"consequence\": \"Operar a alta pressão com campanhas longas maximiza rendimento por lote. Expectativa de maior produtividade por produção, mas investimento e risco por alta pressão aumentam.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Rendimento\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Custo\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Segurança\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Escala a alta pressão e campanhas longas\"\n        },\n        {\n          \"consequence\": \"Operar a menor pressão e alta vazão reduz custo e riscos, melhora throughput (tempo), mas sacrifica rendimento por passagem, o que pode aumentar necessidade de reciclo.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Rendimento\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Tempo\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Custo\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Operar a baixa pressão com alta vazão\"\n        },\n        {\n          \"consequence\": \"Investir em reciclo e unidades de separação aumenta conversão global e permite operar em condições mais moderadas, mas eleva custo de capital e complexidade operacional.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Rendimento\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Custo\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Tempo\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Investir em reciclo + separação intensiva\"\n        }\n      ],\n      \"question\": \"Qual plano de escala seguimos?\"\n    }\n  ]\n}",
      "outputTokens": 4467,
      "systemPrompt": "# Role\n\nYou are an expert educational game designer creating a **Challenge** activity for a learning app. Your mission is to design a choose-your-own-adventure scenario where learners make strategic decisions with meaningful consequences, using the lesson's concepts.\n\nYou specialize in crafting narrative experiences that test strategic thinking — not knowledge recall, but the ability to apply concepts and understand trade-offs.\n\n# Why Narrative Challenges Work\n\nGreat challenges don't quiz — they immerse. Learners face realistic scenarios where every choice has consequences. They experience trade-offs firsthand, making the lesson's principles memorable.\n\n- **No \"Right Answer\"**: Every option has pros and cons. Learners engage with WHY, not just WHAT.\n- **Consequences Over Scores**: Instead of winning or losing, learners see the natural results of their choices.\n- **Strategic Thinking**: Understanding the lesson helps navigate trade-offs, but different strategies lead to different outcomes.\n\n# Inputs\n\n- `LESSON_TITLE`: The topic to create a challenge around\n- `LESSON_DESCRIPTION`: Additional context about what this lesson covers\n- `CHAPTER_TITLE`: The chapter context (for understanding scope)\n- `COURSE_TITLE`: The course context (for understanding audience level)\n- `LANGUAGE`: Output language\n- `EXPLANATION_STEPS`: What the learner has already studied\n\n## Language Guidelines\n\n- `en`: Use US English unless the content is region-specific\n- `pt`: Use Brazilian Portuguese unless the content is region-specific\n- `es`: Use Latin American Spanish unless the content is region-specific\n\n# Requirements\n\n## Introduction\n\nThe `intro` field sets the scene (max 500 characters). It should:\n\n- Establish the scenario and the learner's role\n- Explain what they're navigating (a project, situation, decision-making process)\n- Create stakes that feel meaningful\n- Use `{{NAME}}` to personalize\n\n## Steps\n\nCreate 4-6 steps. Each step presents a decision point with 3-4 options.\n\n### Step Structure\n\n- **context**: Maximum 500 characters. Pure dialogue from a colleague setting up the decision. Conversational, no narrator.\n- **question**: Maximum 100 characters. What needs to be decided.\n- **options**: 3-4 choices, each with:\n  - **text**: The choice (max 80 characters)\n  - **consequence**: What happens as a result (max 300 characters). Shown after choosing. Explains the outcome narratively.\n  - **effects**: Array of 1-3 effects showing how this choice impacts different aspects:\n    - **dimension**: A short name for what this affects (e.g., \"Code Quality\", \"Delivery Speed\", \"Team Morale\"). Use 2-4 different dimensions across all options to create meaningful trade-offs. Important: dimensions must be consistent across all steps.\n    - **impact**: Is this `\"positive\"`, `\"neutral\"`, or `\"negative\"` for that dimension?\n\n### Option Design\n\nEvery option should:\n\n- Be a legitimate choice (no obviously wrong answers)\n- Have a clear consequence that connects to lesson concepts\n- Affect 1-3 dimensions (real decisions rarely affect just one thing)\n- Teach something about trade-offs when the consequence is revealed\n\n**No option should be universally best.** Good options might help one dimension but hurt another. This creates genuine trade-offs.\n\n## Reflection\n\nThe `reflection` field (max 500 characters) provides closing insight after all steps. It should:\n\n- Acknowledge that different approaches have merit\n- Connect the experience back to the lesson's key principles\n- Help learners understand how the concepts apply in practice\n\n## Tone & Style\n\n- **Pure dialogue**: NO narrator, NO character prefixes, NO action descriptions\n- **Natural conversation**: Colleagues working through a problem together\n- **Professional but warm**: Light humor when appropriate\n- **Second-person immersion**: The colleague speaks TO the learner\n- **Use `{{NAME}}`** to personalize dialogue\n\n## What to Avoid\n\n- **Quiz-style questions**: This tests strategic thinking, not recall\n- **Obviously correct answers**: Every option should have genuine trade-offs\n- **Narrator text**: Keep it pure dialogue in context\n- **Disconnected consequences**: Consequences should relate to lesson concepts\n- **Too many or too few dimensions**: Use 2-4 different dimension names across all effects for meaningful trade-offs\n\n## Relationship to Previous Activities\n\nThe learner has completed:\n\n- **Background**: WHY this exists\n- **Explanation**: WHAT it is\n- **Mechanics**: HOW it works\n- **Examples**: WHERE it appears\n- **Story**: WHEN to apply this\n\nYour Challenge activity is the capstone: **CAN YOU NAVIGATE THIS?** It tests whether learners can apply concepts strategically. This should feel like a meaningful simulation, not a test.\n\n# Example\n\nFor a lesson on \"Technical Debt\":\n\n**Step 1:**\n\n```json\n{\n  \"context\": \"{{NAME}}, we've got a deadline crunch. The feature works but the code is messy. Ship it now or clean it up first?\",\n  \"question\": \"How do we handle this?\",\n  \"options\": [\n    {\n      \"text\": \"Ship it now, refactor later\",\n      \"consequence\": \"Feature launched on time! But the messy code made the next sprint's work harder. The team spent extra hours untangling dependencies.\",\n      \"effects\": [\n        { \"dimension\": \"Code Quality\", \"impact\": \"negative\" },\n        { \"dimension\": \"Delivery Speed\", \"impact\": \"positive\" }\n      ]\n    },\n    {\n      \"text\": \"Take two more days to refactor\",\n      \"consequence\": \"The code is clean and maintainable. Stakeholders weren't thrilled about the delay, but future changes will be much easier.\",\n      \"effects\": [\n        { \"dimension\": \"Code Quality\", \"impact\": \"positive\" },\n        { \"dimension\": \"Delivery Speed\", \"impact\": \"negative\" }\n      ]\n    },\n    {\n      \"text\": \"Split the team — half ships, half refactors\",\n      \"consequence\": \"Shipped on time with partial cleanup. Neither task got full attention, and the team felt stretched thin.\",\n      \"effects\": [\n        { \"dimension\": \"Code Quality\", \"impact\": \"neutral\" },\n        { \"dimension\": \"Team Morale\", \"impact\": \"negative\" }\n      ]\n    }\n  ]\n}\n```\n\n# Quality Checks\n\nBefore finalizing, verify:\n\n- [ ] Does the intro establish a clear, engaging scenario?\n- [ ] Does every option have a meaningful consequence?\n- [ ] Are consequences connected to lesson principles?\n- [ ] Is there no obviously \"best\" option in each step?\n- [ ] Do options affect multiple dimensions where realistic?\n- [ ] Are dimension names consistent and lesson-relevant across all effects?\n- [ ] Is `{{NAME}}` used appropriately?\n- [ ] Is all dialogue pure conversation (no narrator)?\n- [ ] Does the reflection tie the experience back to the lesson?\n- [ ] Are all constraints met (intro ≤500, context ≤500, question ≤100, text ≤80, consequence ≤300, reflection ≤500)?\n- [ ] Is the step count between 4 and 6?\n- [ ] Does every step have 3-4 options?\n\n# Output Format\n\nReturn an object with:\n\n- **intro**: Scenario introduction (max 500 chars)\n- **steps**: Array of 4-6 step objects, each with:\n  - **context**: Pure dialogue (max 500 chars)\n  - **question**: Decision prompt (max 100 chars)\n  - **options**: Array of 3-4 objects with:\n    - **text**: Choice description (max 80 chars)\n    - **consequence**: What happens (max 300 chars)\n    - **effects**: Array of 1-3 objects with:\n      - **dimension**: Short name for what this affects (use 2-4 different dimensions total)\n      - **impact**: One of \"positive\", \"neutral\", \"negative\"\n- **reflection**: Closing insight connecting to lesson (max 500 chars)\n",
      "testCaseId": "pt-chemistry-reaction-equilibrium-1",
      "userPrompt": "LESSON_TITLE: Equilibrio Quimico na Pratica\nLESSON_DESCRIPTION: Aplicando o principio de Le Chatelier para otimizar reacoes quimicas e processos industriais\nCHAPTER_TITLE: Equilibrio Quimico\nCOURSE_TITLE: Quimica Geral II\nLANGUAGE: pt\nEXPLANATION_STEPS:\n1. Principio de Le Chatelier: O principio de Le Chatelier diz que um sistema em equilibrio responde a perturbacoes minimizando a mudanca. Adicione reagente, o equilibrio desloca para consumir esse reagente.\n2. Efeito da Concentracao: Mudancas de concentracao deslocam o equilibrio. Adicionar reagentes desloca para produtos. Remover produtos tambem desloca para produtos. O sistema busca restaurar o equilibrio.\n3. Efeito da Pressao: A pressao afeta equilibrios gasosos. Aumentar pressao favorece o lado com menos moles de gas. Diminuir pressao favorece o lado com mais moles. Gases inertes nao afetam.\n4. Efeito da Temperatura: Temperatura e diferente — ela muda a constante de equilibrio. Reacoes exotermicas: aumento de temperatura desloca para reagentes. Reacoes endotermicas: aumento favorece produtos.\n5. Papel dos Catalisadores: Catalisadores aceleram ambas as direcoes igualmente. Eles nao deslocam o equilibrio — apenas ajudam a alcancar o equilibrio mais rapido. Util para processos industriais."
    },
    {
      "duration": 56368.16179199994,
      "inputTokens": 2147,
      "output": "{\n  \"intro\": \"{{NAME}}, la Municipalidad te pidió diseñar la microred de una aldea: deben ser confiables, baratas y respetuosas con el entorno. Vas a decidir fuentes, conversiones, almacenamiento y operación — cada elección afecta eficiencia, costo, fiabilidad y la cantidad de energía util disponible.\",\n  \"reflection\": \"Buen trabajo, {{NAME}}. No hay solución perfecta: cada camino preserva energía de formas distintas. Aplicaste la conservación de la energía, evaluaste pérdidas en las conversiones, el costo del almacenamiento y la densidad energética. Estas son las mismas compensaciones que verás en proyectos reales: busca equilibrio según prioridades.\",\n  \"steps\": [\n    {\n      \"context\": \"{{NAME}}, el alcalde quiere energía ahora: ¿centramos todo en combustible, renovables con baterías, pequeña hidráulica o una solución híbrida?\",\n      \"options\": [\n        {\n          \"consequence\": \"El generador diesel arranca rápido y funciona con carga variable; el combustible tiene alta densidad y garantiza suministro, pero el costo operativo y las emisiones son elevados.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Costo\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Fiabilidad\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Densidad Energética\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Generador diesel como fuente principal\"\n        },\n        {\n          \"consequence\": \"Paneles + baterías reducen emisiones y operan barato a largo plazo, pero las pérdidas en conversión y almacenamiento y el gasto inicial son altos; la densidad energética es baja.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Eficiencia\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Costo\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Densidad Energética\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Solar fotovoltaica con baterías\"\n        },\n        {\n          \"consequence\": \"La mini-hidráulica ofrece conversiones eficientes y baja operación si el caudal es estable; la inversión inicial puede ser grande, pero la fiabilidad y eficiencia suelen ser altas.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Eficiencia\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Costo\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Fiabilidad\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Mini-hidráulica local\"\n        },\n        {\n          \"consequence\": \"Combinar PV con un diesel de respaldo reduce consumo de combustible y mejora disponibilidad; la complejidad y el costo suben, pero se equilibran fiabilidad y menores pérdidas en horas soleadas.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Eficiencia\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Costo\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Fiabilidad\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Híbrido PV + diesel\"\n        }\n      ],\n      \"question\": \"¿Qué fuente primaria eliges?\"\n    },\n    {\n      \"context\": \"{{NAME}}, si usamos AC tradicional añadimos inversores y transformadores; una red DC reduce conversiones pero cambia la infraestructura. ¿Cómo simplificamos las conversiones?\",\n      \"options\": [\n        {\n          \"consequence\": \"Mantener AC usa equipos probados y facilita integración de appliances; habrá más conversiones (inversor/transformador) y pérdidas, pero la operación es familiar y robusta.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Eficiencia\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Fiabilidad\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Red AC estándar (más conversiones)\"\n        },\n        {\n          \"consequence\": \"Diseñar una red DC reduce etapas de conversión para PV y baterías, mejorando la eficiencia del sistema; el equipamiento y la gestión pueden ser más caros y especializados.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Eficiencia\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Costo\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Red DC para cargas críticas\"\n        },\n        {\n          \"consequence\": \"Híbrido: DC para cargas sensibles y AC para lo demás. Balancea pérdidas y compatibilidad, pero añade control y coordinación entre dominios.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Eficiencia\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Fiabilidad\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Mezcla DC/AC por prioridad de cargas\"\n        }\n      ],\n      \"question\": \"¿Cuántas conversiones permites?\"\n    },\n    {\n      \"context\": \"{{NAME}}, necesitamos unas 6 horas de respaldo. Podemos usar baterías, bombeo o almacenar combustible. Cada opción tiene pérdidas y diferencia en densidad energética.\",\n      \"options\": [\n        {\n          \"consequence\": \"Baterías ofrecen alta eficiencia de ida y vuelta y respuesta rápida; su costo inicial y la baja densidad por kg implican mayor inversión y volumen de almacenamiento.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Eficiencia\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Costo\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Densidad Energética\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Baterías Li-ion bien dimensionadas\"\n        },\n        {\n          \"consequence\": \"Pumped hydro implica mayores pérdidas round-trip y requiere obra civil; el costo inicial es alto, pero la vida útil puede ser larga y fiable si hay topografía adecuada.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Eficiencia\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Costo\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Fiabilidad\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Almacenamiento por bombeo\"\n        },\n        {\n          \"consequence\": \"Mantener combustible líquido como reserva evita conversiones eléctricas para almacenar energía y tiene alta densidad, pero sus pérdidas por combustión y costos operativos y ambientales son considerables.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Eficiencia\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Densidad Energética\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Costo\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Reserva de combustible líquido\"\n        }\n      ],\n      \"question\": \"¿Qué sistema de almacenamiento eliges?\"\n    },\n    {\n      \"context\": \"{{NAME}}, podemos sobredimensionar generación (más paneles) para reducir almacenamiento, o mantener generación ajustada y confiar en más baterías. ¿Qué estrategia priorizamos?\",\n      \"options\": [\n        {\n          \"consequence\": \"Sobredimensionar PV reduce horas en que dependes del almacenamiento, disminuye conversiones acumuladas y mejora energía útil en días soleados, pero eleva la inversión inicial.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Eficiencia\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Costo\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Sobredimensionar generación solar\"\n        },\n        {\n          \"consequence\": \"Aumentar capacidad de almacenamiento mejora autonomía nocturna y días nublados, pero agrega pérdidas por carga/descarga y mayor costo.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Eficiencia\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Costo\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Fiabilidad\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Ampliar almacenamiento (más baterías)\"\n        },\n        {\n          \"consequence\": \"Equilibrar un aumento moderado de generación con almacenamiento optimizado reduce pérdidas totales y controla costos, pero requiere diseño y controles más finos.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Eficiencia\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Costo\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Fiabilidad\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Balancear generación y almacenamiento\"\n        }\n      ],\n      \"question\": \"¿Sobredimensionas generación o almacenamiento?\"\n    },\n    {\n      \"context\": \"{{NAME}}, para mantener el sistema en el tiempo podemos invertir en mantenimiento constante o en redundancia de equipos. ¿Dónde pones el presupuesto operativo?\",\n      \"options\": [\n        {\n          \"consequence\": \"Un programa de mantenimiento preventivo mantiene eficiencia alta y prolonga vida útil; implica costos continuos, pero reduce pérdidas acumuladas y fallas inesperadas.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Eficiencia\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Costo\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Fiabilidad\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Invertir en mantenimiento preventivo\"\n        },\n        {\n          \"consequence\": \"Comprar equipos redundantes reduce riesgo de caída inmediata y mejora disponibilidad, pero genera costo de capital y equipos ociosos que no optimizan la energía.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Eficiencia\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Costo\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Fiabilidad\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Priorizar redundancia (equipos de sobra)\"\n        },\n        {\n          \"consequence\": \"Reparar sólo cuando falla baja costos a corto plazo, pero la eficiencia cae con equipos degradados y la fiabilidad se resiente; al final las pérdidas y urgencias suben el costo total.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Eficiencia\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Costo\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Fiabilidad\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Mantenimiento reactivo (economizar hoy)\"\n        }\n      ],\n      \"question\": \"¿Mantenimiento o redundancia?\"\n    }\n  ]\n}",
      "outputTokens": 4444,
      "systemPrompt": "# Role\n\nYou are an expert educational game designer creating a **Challenge** activity for a learning app. Your mission is to design a choose-your-own-adventure scenario where learners make strategic decisions with meaningful consequences, using the lesson's concepts.\n\nYou specialize in crafting narrative experiences that test strategic thinking — not knowledge recall, but the ability to apply concepts and understand trade-offs.\n\n# Why Narrative Challenges Work\n\nGreat challenges don't quiz — they immerse. Learners face realistic scenarios where every choice has consequences. They experience trade-offs firsthand, making the lesson's principles memorable.\n\n- **No \"Right Answer\"**: Every option has pros and cons. Learners engage with WHY, not just WHAT.\n- **Consequences Over Scores**: Instead of winning or losing, learners see the natural results of their choices.\n- **Strategic Thinking**: Understanding the lesson helps navigate trade-offs, but different strategies lead to different outcomes.\n\n# Inputs\n\n- `LESSON_TITLE`: The topic to create a challenge around\n- `LESSON_DESCRIPTION`: Additional context about what this lesson covers\n- `CHAPTER_TITLE`: The chapter context (for understanding scope)\n- `COURSE_TITLE`: The course context (for understanding audience level)\n- `LANGUAGE`: Output language\n- `EXPLANATION_STEPS`: What the learner has already studied\n\n## Language Guidelines\n\n- `en`: Use US English unless the content is region-specific\n- `pt`: Use Brazilian Portuguese unless the content is region-specific\n- `es`: Use Latin American Spanish unless the content is region-specific\n\n# Requirements\n\n## Introduction\n\nThe `intro` field sets the scene (max 500 characters). It should:\n\n- Establish the scenario and the learner's role\n- Explain what they're navigating (a project, situation, decision-making process)\n- Create stakes that feel meaningful\n- Use `{{NAME}}` to personalize\n\n## Steps\n\nCreate 4-6 steps. Each step presents a decision point with 3-4 options.\n\n### Step Structure\n\n- **context**: Maximum 500 characters. Pure dialogue from a colleague setting up the decision. Conversational, no narrator.\n- **question**: Maximum 100 characters. What needs to be decided.\n- **options**: 3-4 choices, each with:\n  - **text**: The choice (max 80 characters)\n  - **consequence**: What happens as a result (max 300 characters). Shown after choosing. Explains the outcome narratively.\n  - **effects**: Array of 1-3 effects showing how this choice impacts different aspects:\n    - **dimension**: A short name for what this affects (e.g., \"Code Quality\", \"Delivery Speed\", \"Team Morale\"). Use 2-4 different dimensions across all options to create meaningful trade-offs. Important: dimensions must be consistent across all steps.\n    - **impact**: Is this `\"positive\"`, `\"neutral\"`, or `\"negative\"` for that dimension?\n\n### Option Design\n\nEvery option should:\n\n- Be a legitimate choice (no obviously wrong answers)\n- Have a clear consequence that connects to lesson concepts\n- Affect 1-3 dimensions (real decisions rarely affect just one thing)\n- Teach something about trade-offs when the consequence is revealed\n\n**No option should be universally best.** Good options might help one dimension but hurt another. This creates genuine trade-offs.\n\n## Reflection\n\nThe `reflection` field (max 500 characters) provides closing insight after all steps. It should:\n\n- Acknowledge that different approaches have merit\n- Connect the experience back to the lesson's key principles\n- Help learners understand how the concepts apply in practice\n\n## Tone & Style\n\n- **Pure dialogue**: NO narrator, NO character prefixes, NO action descriptions\n- **Natural conversation**: Colleagues working through a problem together\n- **Professional but warm**: Light humor when appropriate\n- **Second-person immersion**: The colleague speaks TO the learner\n- **Use `{{NAME}}`** to personalize dialogue\n\n## What to Avoid\n\n- **Quiz-style questions**: This tests strategic thinking, not recall\n- **Obviously correct answers**: Every option should have genuine trade-offs\n- **Narrator text**: Keep it pure dialogue in context\n- **Disconnected consequences**: Consequences should relate to lesson concepts\n- **Too many or too few dimensions**: Use 2-4 different dimension names across all effects for meaningful trade-offs\n\n## Relationship to Previous Activities\n\nThe learner has completed:\n\n- **Background**: WHY this exists\n- **Explanation**: WHAT it is\n- **Mechanics**: HOW it works\n- **Examples**: WHERE it appears\n- **Story**: WHEN to apply this\n\nYour Challenge activity is the capstone: **CAN YOU NAVIGATE THIS?** It tests whether learners can apply concepts strategically. This should feel like a meaningful simulation, not a test.\n\n# Example\n\nFor a lesson on \"Technical Debt\":\n\n**Step 1:**\n\n```json\n{\n  \"context\": \"{{NAME}}, we've got a deadline crunch. The feature works but the code is messy. Ship it now or clean it up first?\",\n  \"question\": \"How do we handle this?\",\n  \"options\": [\n    {\n      \"text\": \"Ship it now, refactor later\",\n      \"consequence\": \"Feature launched on time! But the messy code made the next sprint's work harder. The team spent extra hours untangling dependencies.\",\n      \"effects\": [\n        { \"dimension\": \"Code Quality\", \"impact\": \"negative\" },\n        { \"dimension\": \"Delivery Speed\", \"impact\": \"positive\" }\n      ]\n    },\n    {\n      \"text\": \"Take two more days to refactor\",\n      \"consequence\": \"The code is clean and maintainable. Stakeholders weren't thrilled about the delay, but future changes will be much easier.\",\n      \"effects\": [\n        { \"dimension\": \"Code Quality\", \"impact\": \"positive\" },\n        { \"dimension\": \"Delivery Speed\", \"impact\": \"negative\" }\n      ]\n    },\n    {\n      \"text\": \"Split the team — half ships, half refactors\",\n      \"consequence\": \"Shipped on time with partial cleanup. Neither task got full attention, and the team felt stretched thin.\",\n      \"effects\": [\n        { \"dimension\": \"Code Quality\", \"impact\": \"neutral\" },\n        { \"dimension\": \"Team Morale\", \"impact\": \"negative\" }\n      ]\n    }\n  ]\n}\n```\n\n# Quality Checks\n\nBefore finalizing, verify:\n\n- [ ] Does the intro establish a clear, engaging scenario?\n- [ ] Does every option have a meaningful consequence?\n- [ ] Are consequences connected to lesson principles?\n- [ ] Is there no obviously \"best\" option in each step?\n- [ ] Do options affect multiple dimensions where realistic?\n- [ ] Are dimension names consistent and lesson-relevant across all effects?\n- [ ] Is `{{NAME}}` used appropriately?\n- [ ] Is all dialogue pure conversation (no narrator)?\n- [ ] Does the reflection tie the experience back to the lesson?\n- [ ] Are all constraints met (intro ≤500, context ≤500, question ≤100, text ≤80, consequence ≤300, reflection ≤500)?\n- [ ] Is the step count between 4 and 6?\n- [ ] Does every step have 3-4 options?\n\n# Output Format\n\nReturn an object with:\n\n- **intro**: Scenario introduction (max 500 chars)\n- **steps**: Array of 4-6 step objects, each with:\n  - **context**: Pure dialogue (max 500 chars)\n  - **question**: Decision prompt (max 100 chars)\n  - **options**: Array of 3-4 objects with:\n    - **text**: Choice description (max 80 chars)\n    - **consequence**: What happens (max 300 chars)\n    - **effects**: Array of 1-3 objects with:\n      - **dimension**: Short name for what this affects (use 2-4 different dimensions total)\n      - **impact**: One of \"positive\", \"neutral\", \"negative\"\n- **reflection**: Closing insight connecting to lesson (max 500 chars)\n",
      "testCaseId": "es-physics-energy-conservation-1",
      "userPrompt": "LESSON_TITLE: Conservacion de Energia en Sistemas Reales\nLESSON_DESCRIPTION: Aplicando principios de conservacion de energia para disenar y optimizar sistemas energeticos\nCHAPTER_TITLE: Energia y Trabajo\nCOURSE_TITLE: Fisica Aplicada\nLANGUAGE: es\nEXPLANATION_STEPS:\n1. Conservacion de la Energia: La energia no se crea ni se destruye, solo se transforma. En cada conversion, la energia total se conserva, pero la energia util disminuye. Parte siempre se convierte en calor no aprovechable.\n2. Eficiencia Energetica: La eficiencia mide cuanta energia de entrada se convierte en trabajo util. Ningun proceso es 100% eficiente — siempre hay perdidas. La segunda ley de la termodinamica lo garantiza.\n3. Perdidas en Cadena: Las cadenas de conversion acumulan perdidas. Si cada paso es 90% eficiente, tres pasos dan 0.9³ = 73% eficiencia total. Menos conversiones significa menos perdidas.\n4. Costo del Almacenamiento: El almacenamiento de energia tiene su propio costo energetico. Cargar y descargar baterias pierde energia. Bombear agua cuesta arriba para hidroelectrica tambien. El almacenamiento no es gratis.\n5. Densidad Energetica: La densidad energetica importa. Combustibles fosiles almacenan mucha energia por kilogramo. Las baterias almacenan menos. Esto afecta que es practico para cada aplicacion."
    }
  ],
  "taskId": "activity-challenge"
}
