{
  "generatedAt": "2026-01-17T19:39:12.795Z",
  "modelId": "google/gemini-3-flash",
  "outputs": [
    {
      "duration": 25470.94658300001,
      "inputTokens": 2144,
      "output": "{\n  \"intro\": \"Welcome, {{NAME}}. You've been hired as the Lead Architect for 'DataStream', a growing analytics firm. Our current systems are buckling under new traffic. Your mission is to navigate the complex trade-offs between execution speed and memory usage as we prepare for a major client launch. Remember: in algorithm design, there are rarely perfect answers—only choices and consequences. Let's see how you handle the architecture of our core engine.\",\n  \"reflection\": \"Great work navigating those trade-offs, {{NAME}}. You've seen firsthand that algorithm analysis isn't just about 'faster'—it's about understanding your constraints. Whether it's trading memory for speed with hash tables or managing worst-case scenarios in sorting, every architectural choice has a cost. By using Big O as your guide, you can make informed decisions that align with your project's specific needs and resource limits.\",\n  \"steps\": [\n    {\n      \"context\": \"{{NAME}}, the user ID lookup is killing our latency. Right now, it's a linear scan through a massive list of a million users. It's O(n) and users are noticing the lag. Should we move to a Hash Map or try sorting the list for binary search?\",\n      \"options\": [\n        {\n          \"consequence\": \"Lookups are now nearly instant (O(1))! However, the DevOps team is reporting a significant jump in server RAM usage to maintain the hash buckets.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Execution Speed\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Memory Usage\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Implement a Hash Map for O(1) lookups.\"\n        },\n        {\n          \"consequence\": \"Better than a scan, but the O(log n) lookup is still slower than a hash table. We saved on memory, but the overhead of keeping the list sorted is causing delays during user registration.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Execution Speed\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Memory Usage\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Sort the list and use Binary Search.\"\n        },\n        {\n          \"consequence\": \"We saved on memory costs, but the app feels sluggish. Some users are already reporting timeout errors during peak hours as the scan takes too long.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Execution Speed\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"User Experience\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Keep the linear scan to save memory.\"\n        }\n      ],\n      \"question\": \"How should we optimize the lookup?\"\n    },\n    {\n      \"context\": \"We're processing incoming sensor data. Usually, it's 'mostly' sorted, but occasionally a sensor goes haywire and sends a completely random mess. Do we risk QuickSort or play it safe with MergeSort?\",\n      \"options\": [\n        {\n          \"consequence\": \"It's blazing fast 99% of the time. But yesterday, a messy batch hit the O(n²) worst-case scenario, and the system locked up, causing a minor outage.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Execution Speed\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"User Experience\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Use QuickSort for its average-case speed.\"\n        },\n        {\n          \"consequence\": \"We have guaranteed O(n log n) performance regardless of how messy the data is. However, we had to upgrade our cloud instances to handle the extra O(n) space required for merging.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Execution Speed\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Memory Usage\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Use MergeSort for guaranteed performance.\"\n        },\n        {\n          \"consequence\": \"Since the data is usually 'mostly' sorted, it's actually very efficient and uses no extra memory. But when the messy batches arrive, processing slows down significantly.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Execution Speed\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Memory Usage\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Use Insertion Sort for the mostly-sorted data.\"\n        }\n      ],\n      \"question\": \"Pick a sorting strategy.\"\n    },\n    {\n      \"context\": \"{{NAME}}, our log collector needs a dynamic list to store entries. If we use a standard ArrayList, the O(n) resizing might cause a lag spike during high traffic. How do we want to handle this?\",\n      \"options\": [\n        {\n          \"consequence\": \"Memory usage is very efficient, but every now and then, the system experiences a 'hiccup' when the internal array doubles in size and copies all data.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Execution Speed\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Memory Usage\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Use a standard ArrayList (Amortized O(1)).\"\n        },\n        {\n          \"consequence\": \"Performance is silky smooth with zero resizing lag! However, our monitoring shows we're wasting 60% of our allocated memory on empty slots.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Execution Speed\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Memory Usage\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Pre-allocate a massive fixed-size array.\"\n        },\n        {\n          \"consequence\": \"No resize spikes at all! But the constant small memory allocations for each individual node are slowing down our batch processing speed.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Execution Speed\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Memory Usage\",\n              \"impact\": \"neutral\"\n            }\n          ],\n          \"text\": \"Use a LinkedList to avoid resizing spikes.\"\n        }\n      ],\n      \"question\": \"How should we handle the dynamic list?\"\n    },\n    {\n      \"context\": \"Our dashboard needs to show the 'Top 10' trending items. Calculating this on the fly for every user request is getting expensive. Should we cache the results in memory?\",\n      \"options\": [\n        {\n          \"consequence\": \"The dashboard is incredibly fast now. Users love the instant loading. However, our memory usage is creeping toward the limit, leaving little room for actual data processing.\",\n          \"effects\": [\n            {\n              \"dimension\": \"User Experience\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Memory Usage\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Cache the Top 10 results in RAM.\"\n        },\n        {\n          \"consequence\": \"No extra memory is used, and the data is always 100% accurate. However, users are complaining that the dashboard takes several seconds to load during every visit.\",\n          \"effects\": [\n            {\n              \"dimension\": \"User Experience\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Memory Usage\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Calculate from scratch on every request.\"\n        },\n        {\n          \"consequence\": \"We saved RAM, but reading from the disk is slower than memory. It's a decent middle ground, but the dashboard still feels a bit 'heavy' to the users.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Execution Speed\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"User Experience\",\n              \"impact\": \"neutral\"\n            }\n          ],\n          \"text\": \"Use a slower, disk-based cache.\"\n        }\n      ],\n      \"question\": \"Decide on a caching strategy.\"\n    }\n  ]\n}",
      "outputTokens": 3905,
      "systemPrompt": "# Role\n\nYou are an expert educational game designer creating a **Challenge** activity for a learning app. Your mission is to design a choose-your-own-adventure scenario where learners make strategic decisions with meaningful consequences, using the lesson's concepts.\n\nYou specialize in crafting narrative experiences that test strategic thinking — not knowledge recall, but the ability to apply concepts and understand trade-offs.\n\n# Why Narrative Challenges Work\n\nGreat challenges don't quiz — they immerse. Learners face realistic scenarios where every choice has consequences. They experience trade-offs firsthand, making the lesson's principles memorable.\n\n- **No \"Right Answer\"**: Every option has pros and cons. Learners engage with WHY, not just WHAT.\n- **Consequences Over Scores**: Instead of winning or losing, learners see the natural results of their choices.\n- **Strategic Thinking**: Understanding the lesson helps navigate trade-offs, but different strategies lead to different outcomes.\n\n# Inputs\n\n- `LESSON_TITLE`: The topic to create a challenge around\n- `LESSON_DESCRIPTION`: Additional context about what this lesson covers\n- `CHAPTER_TITLE`: The chapter context (for understanding scope)\n- `COURSE_TITLE`: The course context (for understanding audience level)\n- `LANGUAGE`: Output language\n- `EXPLANATION_STEPS`: What the learner has already studied\n\n## Language Guidelines\n\n- `en`: Use US English unless the content is region-specific\n- `pt`: Use Brazilian Portuguese unless the content is region-specific\n- `es`: Use Latin American Spanish unless the content is region-specific\n\n# Requirements\n\n## Introduction\n\nThe `intro` field sets the scene (max 500 characters). It should:\n\n- Establish the scenario and the learner's role\n- Explain what they're navigating (a project, situation, decision-making process)\n- Create stakes that feel meaningful\n- Use `{{NAME}}` to personalize\n\n## Steps\n\nCreate 4-6 steps. Each step presents a decision point with 3-4 options.\n\n### Step Structure\n\n- **context**: Maximum 500 characters. Pure dialogue from a colleague setting up the decision. Conversational, no narrator.\n- **question**: Maximum 100 characters. What needs to be decided.\n- **options**: 3-4 choices, each with:\n  - **text**: The choice (max 80 characters)\n  - **consequence**: What happens as a result (max 300 characters). Shown after choosing. Explains the outcome narratively.\n  - **effects**: Array of 1-3 effects showing how this choice impacts different aspects:\n    - **dimension**: A short name for what this affects (e.g., \"Code Quality\", \"Delivery Speed\", \"Team Morale\"). Use 2-4 different dimensions across all options to create meaningful trade-offs. Important: dimensions must be consistent across all steps.\n    - **impact**: Is this `\"positive\"`, `\"neutral\"`, or `\"negative\"` for that dimension?\n\n### Option Design\n\nEvery option should:\n\n- Be a legitimate choice (no obviously wrong answers)\n- Have a clear consequence that connects to lesson concepts\n- Affect 1-3 dimensions (real decisions rarely affect just one thing)\n- Teach something about trade-offs when the consequence is revealed\n\n**No option should be universally best.** Good options might help one dimension but hurt another. This creates genuine trade-offs.\n\n## Reflection\n\nThe `reflection` field (max 500 characters) provides closing insight after all steps. It should:\n\n- Acknowledge that different approaches have merit\n- Connect the experience back to the lesson's key principles\n- Help learners understand how the concepts apply in practice\n\n## Tone & Style\n\n- **Pure dialogue**: NO narrator, NO character prefixes, NO action descriptions\n- **Natural conversation**: Colleagues working through a problem together\n- **Professional but warm**: Light humor when appropriate\n- **Second-person immersion**: The colleague speaks TO the learner\n- **Use `{{NAME}}`** to personalize dialogue\n\n## What to Avoid\n\n- **Quiz-style questions**: This tests strategic thinking, not recall\n- **Obviously correct answers**: Every option should have genuine trade-offs\n- **Narrator text**: Keep it pure dialogue in context\n- **Disconnected consequences**: Consequences should relate to lesson concepts\n- **Too many or too few dimensions**: Use 2-4 different dimension names across all effects for meaningful trade-offs\n\n## Relationship to Previous Activities\n\nThe learner has completed:\n\n- **Background**: WHY this exists\n- **Explanation**: WHAT it is\n- **Mechanics**: HOW it works\n- **Examples**: WHERE it appears\n- **Story**: WHEN to apply this\n\nYour Challenge activity is the capstone: **CAN YOU NAVIGATE THIS?** It tests whether learners can apply concepts strategically. This should feel like a meaningful simulation, not a test.\n\n# Example\n\nFor a lesson on \"Technical Debt\":\n\n**Step 1:**\n\n```json\n{\n  \"context\": \"{{NAME}}, we've got a deadline crunch. The feature works but the code is messy. Ship it now or clean it up first?\",\n  \"question\": \"How do we handle this?\",\n  \"options\": [\n    {\n      \"text\": \"Ship it now, refactor later\",\n      \"consequence\": \"Feature launched on time! But the messy code made the next sprint's work harder. The team spent extra hours untangling dependencies.\",\n      \"effects\": [\n        { \"dimension\": \"Code Quality\", \"impact\": \"negative\" },\n        { \"dimension\": \"Delivery Speed\", \"impact\": \"positive\" }\n      ]\n    },\n    {\n      \"text\": \"Take two more days to refactor\",\n      \"consequence\": \"The code is clean and maintainable. Stakeholders weren't thrilled about the delay, but future changes will be much easier.\",\n      \"effects\": [\n        { \"dimension\": \"Code Quality\", \"impact\": \"positive\" },\n        { \"dimension\": \"Delivery Speed\", \"impact\": \"negative\" }\n      ]\n    },\n    {\n      \"text\": \"Split the team — half ships, half refactors\",\n      \"consequence\": \"Shipped on time with partial cleanup. Neither task got full attention, and the team felt stretched thin.\",\n      \"effects\": [\n        { \"dimension\": \"Code Quality\", \"impact\": \"neutral\" },\n        { \"dimension\": \"Team Morale\", \"impact\": \"negative\" }\n      ]\n    }\n  ]\n}\n```\n\n# Quality Checks\n\nBefore finalizing, verify:\n\n- [ ] Does the intro establish a clear, engaging scenario?\n- [ ] Does every option have a meaningful consequence?\n- [ ] Are consequences connected to lesson principles?\n- [ ] Is there no obviously \"best\" option in each step?\n- [ ] Do options affect multiple dimensions where realistic?\n- [ ] Are dimension names consistent and lesson-relevant across all effects?\n- [ ] Is `{{NAME}}` used appropriately?\n- [ ] Is all dialogue pure conversation (no narrator)?\n- [ ] Does the reflection tie the experience back to the lesson?\n- [ ] Are all constraints met (intro ≤500, context ≤500, question ≤100, text ≤80, consequence ≤300, reflection ≤500)?\n- [ ] Is the step count between 4 and 6?\n- [ ] Does every step have 3-4 options?\n\n# Output Format\n\nReturn an object with:\n\n- **intro**: Scenario introduction (max 500 chars)\n- **steps**: Array of 4-6 step objects, each with:\n  - **context**: Pure dialogue (max 500 chars)\n  - **question**: Decision prompt (max 100 chars)\n  - **options**: Array of 3-4 objects with:\n    - **text**: Choice description (max 80 chars)\n    - **consequence**: What happens (max 300 chars)\n    - **effects**: Array of 1-3 objects with:\n      - **dimension**: Short name for what this affects (use 2-4 different dimensions total)\n      - **impact**: One of \"positive\", \"neutral\", \"negative\"\n- **reflection**: Closing insight connecting to lesson (max 500 chars)\n",
      "testCaseId": "en-cs-algorithm-complexity-1",
      "userPrompt": "LESSON_TITLE: Algorithm Complexity Trade-offs\nLESSON_DESCRIPTION: Understanding and applying algorithm complexity analysis to make informed trade-offs in software design\nCHAPTER_TITLE: Algorithm Analysis\nCOURSE_TITLE: Data Structures and Algorithms\nLANGUAGE: en\nEXPLANATION_STEPS:\n1. Time Complexity: Time complexity measures how execution time grows with input size. O(n) means linear growth — double the input, double the time. O(n²) means quadratic — double the input, quadruple the time.\n2. Space Complexity: Space complexity measures memory usage growth. Some algorithms trade time for space — storing precomputed results to avoid recalculation. Others trade space for time — using less memory but computing more.\n3. Time-Space Trade-off: The time-space trade-off is fundamental. Hash tables give O(1) lookup but use extra memory. Binary search uses O(1) space but requires sorted data. Choose based on constraints.\n4. Amortized Analysis: Amortized analysis looks at average performance over many operations. ArrayList append is usually O(1), but occasionally O(n) when resizing. Amortized, it's still O(1).\n5. Case Analysis: Best, average, and worst case can differ dramatically. Quicksort averages O(n log n) but worst-cases to O(n²). Know your data distribution to choose wisely."
    },
    {
      "duration": 30206.964749999985,
      "inputTokens": 2095,
      "output": "{\n  \"intro\": \"Welcome to the team, {{NAME}}! You've just stepped in as the Strategy Lead for Volt-Bike, a premium electric bicycle startup. Our flagship model, the Apex-1, is hitting the market, but the industry is volatile. To succeed, you must navigate the laws of supply and demand, handle shifting costs, and manage market equilibrium. Your decisions on pricing and production will determine if Volt-Bike becomes a household name or a forgotten experiment. Good luck!\",\n  \"reflection\": \"Well handled, {{NAME}}! You've seen firsthand how supply and demand are more than just intersecting lines on a graph. Every price change moves us along a curve, while external events like tech breakthroughs or viral trends shift those curves entirely. Balancing high margins with market share and customer loyalty is the core of microeconomic strategy. As you move forward, remember that the 'right' price is always a moving target in a dynamic market.\",\n  \"steps\": [\n    {\n      \"context\": \"Alright {{NAME}}, the Apex-1 is ready for launch. Our manufacturing costs are high, but the hype is real. Some want us to price at $3,500 to protect our margins, while others say we need to match the $2,800 market average to gain any traction. The law of demand suggests if we go too high, we'll be sitting on a lot of unsold inventory. What's our starting move?\",\n      \"options\": [\n        {\n          \"consequence\": \"Profit per unit is excellent, but the high price drove many potential buyers to competitors. We have a surplus of bikes in the warehouse and low market presence.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Revenue Growth\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Market Share\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Set a premium price of $3,500\"\n        },\n        {\n          \"consequence\": \"We're moving units at a steady pace! We've captured a respectable portion of the market, though our profit per bike is modest. It's a balanced start.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Market Share\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Revenue Growth\",\n              \"impact\": \"neutral\"\n            }\n          ],\n          \"text\": \"Match the market at $2,800\"\n        },\n        {\n          \"consequence\": \"Demand is massive! We've sold out instantly, but we're actually losing money on every bike due to overhead. We've gained huge share but at a high cost.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Market Share\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Revenue Growth\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Aggressive entry price of $2,200\"\n        }\n      ],\n      \"question\": \"How should we price the Apex-1 for its market debut?\"\n    },\n    {\n      \"context\": \"Bad news, {{NAME}}. A global lithium shortage just drove up our battery costs. This is a classic leftward shift in the supply curve—it now costs us more to produce every single bike. If we keep our prices the same, our margins will vanish. If we raise prices, we might lose customers. How do you want to play this supply shock?\",\n      \"options\": [\n        {\n          \"consequence\": \"Customers appreciate the price stability, and our brand loyalty is through the roof. However, the company is barely breaking even this quarter.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Customer Loyalty\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Revenue Growth\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Keep prices stable and absorb the cost\"\n        },\n        {\n          \"consequence\": \"We've protected our profit margins, but the price hike led to a noticeable drop in quantity demanded. We're a smaller, but still profitable, operation now.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Revenue Growth\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Market Share\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Raise the retail price by $400\"\n        },\n        {\n          \"consequence\": \"We've kept the price and the margin, but the cheaper motors are prone to failure. Our reputation for quality is taking a serious hit.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Revenue Growth\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Customer Loyalty\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Switch to cheaper, lower-quality motors\"\n        }\n      ],\n      \"question\": \"What is our response to the increased production costs?\"\n    },\n    {\n      \"context\": \"Listen to this, {{NAME}}! Our biggest competitor just issued a massive recall and pulled their bikes from the market. This has caused a huge rightward shift in demand for the Apex-1. We have a massive shortage—customers are begging for bikes we don't have yet. We can raise prices to find a new equilibrium or keep them steady to win over their frustrated customers.\",\n      \"options\": [\n        {\n          \"consequence\": \"Revenue is hitting record highs as we capitalize on the shortage! However, some see us as opportunistic, which might hurt us in the long run.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Revenue Growth\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Customer Loyalty\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Raise prices by 20% immediately\"\n        },\n        {\n          \"consequence\": \"We've gained a massive amount of new users who appreciate the fair pricing. Unfortunately, our 'Out of Stock' sign is everywhere, and we're missing out on potential cash.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Market Share\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Revenue Growth\",\n              \"impact\": \"neutral\"\n            }\n          ],\n          \"text\": \"Maintain price but start a waitlist\"\n        },\n        {\n          \"consequence\": \"We're meeting the demand, but the overtime and rush shipping costs have made these units incredibly expensive to produce. Revenue is flat despite the sales surge.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Market Share\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Revenue Growth\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Pay for rush production to fill the gap\"\n        }\n      ],\n      \"question\": \"How do we handle this sudden surge in demand?\"\n    },\n    {\n      \"context\": \"{{NAME}}, a famous tech influencer just did a 'Day in the Life' video featuring the Apex-1. It went viral! Demand has become much more inelastic—people want our bike specifically and are less sensitive to the price. This is a rare opportunity to rethink our positioning. Do we stay a 'bike for everyone' or lean into the 'must-have' luxury status?\",\n      \"options\": [\n        {\n          \"consequence\": \"By focusing on the high-end, we've increased our prestige and revenue per unit. We aren't selling to everyone, but those who buy are paying a massive premium.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Revenue Growth\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Market Share\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Increase price and brand as a luxury item\"\n        },\n        {\n          \"consequence\": \"We've reached the masses! The Apex-1 is the most common e-bike on the street. The 'exclusive' feel is gone, but our market dominance is undisputed.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Market Share\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Customer Loyalty\",\n              \"impact\": \"neutral\"\n            }\n          ],\n          \"text\": \"Keep prices low to maximize market share\"\n        },\n        {\n          \"consequence\": \"Fans love the extra attention, and they're spending more on upgrades. It's a solid way to increase revenue without a risky price hike on the base bike.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Customer Loyalty\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Revenue Growth\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Keep bike price same, launch premium add-ons\"\n        }\n      ],\n      \"question\": \"How do we leverage our newfound 'inelastic' demand?\"\n    },\n    {\n      \"context\": \"Incredible news, {{NAME}}. Our R&D team developed a new assembly process that cuts manufacturing time and cost by 30%. This shifts our supply curve to the right—we can now supply much more at a lower cost than before. This is a major strategic crossroad for Volt-Bike's future.\",\n      \"options\": [\n        {\n          \"consequence\": \"Competitors can't keep up! We've forced them out of the market and become the industry standard. Our margins are lower, but we own the market.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Market Share\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Revenue Growth\",\n              \"impact\": \"neutral\"\n            }\n          ],\n          \"text\": \"Lower prices to pass savings to customers\"\n        },\n        {\n          \"consequence\": \"Our bank account is looking very healthy. We're using the extra profit to fund even more innovation, though we haven't gained any new customer segments yet.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Revenue Growth\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Customer Loyalty\",\n              \"impact\": \"neutral\"\n            }\n          ],\n          \"text\": \"Keep prices the same and pocket the profit\"\n        },\n        {\n          \"consequence\": \"We're not the cheapest, but we're the only ones offering these features. Customer satisfaction is at an all-time high, and we've justified our price point.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Customer Loyalty\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Revenue Growth\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Keep prices the same but add new features\"\n        }\n      ],\n      \"question\": \"What's our strategy for this supply-side breakthrough?\"\n    }\n  ]\n}",
      "outputTokens": 4650,
      "systemPrompt": "# Role\n\nYou are an expert educational game designer creating a **Challenge** activity for a learning app. Your mission is to design a choose-your-own-adventure scenario where learners make strategic decisions with meaningful consequences, using the lesson's concepts.\n\nYou specialize in crafting narrative experiences that test strategic thinking — not knowledge recall, but the ability to apply concepts and understand trade-offs.\n\n# Why Narrative Challenges Work\n\nGreat challenges don't quiz — they immerse. Learners face realistic scenarios where every choice has consequences. They experience trade-offs firsthand, making the lesson's principles memorable.\n\n- **No \"Right Answer\"**: Every option has pros and cons. Learners engage with WHY, not just WHAT.\n- **Consequences Over Scores**: Instead of winning or losing, learners see the natural results of their choices.\n- **Strategic Thinking**: Understanding the lesson helps navigate trade-offs, but different strategies lead to different outcomes.\n\n# Inputs\n\n- `LESSON_TITLE`: The topic to create a challenge around\n- `LESSON_DESCRIPTION`: Additional context about what this lesson covers\n- `CHAPTER_TITLE`: The chapter context (for understanding scope)\n- `COURSE_TITLE`: The course context (for understanding audience level)\n- `LANGUAGE`: Output language\n- `EXPLANATION_STEPS`: What the learner has already studied\n\n## Language Guidelines\n\n- `en`: Use US English unless the content is region-specific\n- `pt`: Use Brazilian Portuguese unless the content is region-specific\n- `es`: Use Latin American Spanish unless the content is region-specific\n\n# Requirements\n\n## Introduction\n\nThe `intro` field sets the scene (max 500 characters). It should:\n\n- Establish the scenario and the learner's role\n- Explain what they're navigating (a project, situation, decision-making process)\n- Create stakes that feel meaningful\n- Use `{{NAME}}` to personalize\n\n## Steps\n\nCreate 4-6 steps. Each step presents a decision point with 3-4 options.\n\n### Step Structure\n\n- **context**: Maximum 500 characters. Pure dialogue from a colleague setting up the decision. Conversational, no narrator.\n- **question**: Maximum 100 characters. What needs to be decided.\n- **options**: 3-4 choices, each with:\n  - **text**: The choice (max 80 characters)\n  - **consequence**: What happens as a result (max 300 characters). Shown after choosing. Explains the outcome narratively.\n  - **effects**: Array of 1-3 effects showing how this choice impacts different aspects:\n    - **dimension**: A short name for what this affects (e.g., \"Code Quality\", \"Delivery Speed\", \"Team Morale\"). Use 2-4 different dimensions across all options to create meaningful trade-offs. Important: dimensions must be consistent across all steps.\n    - **impact**: Is this `\"positive\"`, `\"neutral\"`, or `\"negative\"` for that dimension?\n\n### Option Design\n\nEvery option should:\n\n- Be a legitimate choice (no obviously wrong answers)\n- Have a clear consequence that connects to lesson concepts\n- Affect 1-3 dimensions (real decisions rarely affect just one thing)\n- Teach something about trade-offs when the consequence is revealed\n\n**No option should be universally best.** Good options might help one dimension but hurt another. This creates genuine trade-offs.\n\n## Reflection\n\nThe `reflection` field (max 500 characters) provides closing insight after all steps. It should:\n\n- Acknowledge that different approaches have merit\n- Connect the experience back to the lesson's key principles\n- Help learners understand how the concepts apply in practice\n\n## Tone & Style\n\n- **Pure dialogue**: NO narrator, NO character prefixes, NO action descriptions\n- **Natural conversation**: Colleagues working through a problem together\n- **Professional but warm**: Light humor when appropriate\n- **Second-person immersion**: The colleague speaks TO the learner\n- **Use `{{NAME}}`** to personalize dialogue\n\n## What to Avoid\n\n- **Quiz-style questions**: This tests strategic thinking, not recall\n- **Obviously correct answers**: Every option should have genuine trade-offs\n- **Narrator text**: Keep it pure dialogue in context\n- **Disconnected consequences**: Consequences should relate to lesson concepts\n- **Too many or too few dimensions**: Use 2-4 different dimension names across all effects for meaningful trade-offs\n\n## Relationship to Previous Activities\n\nThe learner has completed:\n\n- **Background**: WHY this exists\n- **Explanation**: WHAT it is\n- **Mechanics**: HOW it works\n- **Examples**: WHERE it appears\n- **Story**: WHEN to apply this\n\nYour Challenge activity is the capstone: **CAN YOU NAVIGATE THIS?** It tests whether learners can apply concepts strategically. This should feel like a meaningful simulation, not a test.\n\n# Example\n\nFor a lesson on \"Technical Debt\":\n\n**Step 1:**\n\n```json\n{\n  \"context\": \"{{NAME}}, we've got a deadline crunch. The feature works but the code is messy. Ship it now or clean it up first?\",\n  \"question\": \"How do we handle this?\",\n  \"options\": [\n    {\n      \"text\": \"Ship it now, refactor later\",\n      \"consequence\": \"Feature launched on time! But the messy code made the next sprint's work harder. The team spent extra hours untangling dependencies.\",\n      \"effects\": [\n        { \"dimension\": \"Code Quality\", \"impact\": \"negative\" },\n        { \"dimension\": \"Delivery Speed\", \"impact\": \"positive\" }\n      ]\n    },\n    {\n      \"text\": \"Take two more days to refactor\",\n      \"consequence\": \"The code is clean and maintainable. Stakeholders weren't thrilled about the delay, but future changes will be much easier.\",\n      \"effects\": [\n        { \"dimension\": \"Code Quality\", \"impact\": \"positive\" },\n        { \"dimension\": \"Delivery Speed\", \"impact\": \"negative\" }\n      ]\n    },\n    {\n      \"text\": \"Split the team — half ships, half refactors\",\n      \"consequence\": \"Shipped on time with partial cleanup. Neither task got full attention, and the team felt stretched thin.\",\n      \"effects\": [\n        { \"dimension\": \"Code Quality\", \"impact\": \"neutral\" },\n        { \"dimension\": \"Team Morale\", \"impact\": \"negative\" }\n      ]\n    }\n  ]\n}\n```\n\n# Quality Checks\n\nBefore finalizing, verify:\n\n- [ ] Does the intro establish a clear, engaging scenario?\n- [ ] Does every option have a meaningful consequence?\n- [ ] Are consequences connected to lesson principles?\n- [ ] Is there no obviously \"best\" option in each step?\n- [ ] Do options affect multiple dimensions where realistic?\n- [ ] Are dimension names consistent and lesson-relevant across all effects?\n- [ ] Is `{{NAME}}` used appropriately?\n- [ ] Is all dialogue pure conversation (no narrator)?\n- [ ] Does the reflection tie the experience back to the lesson?\n- [ ] Are all constraints met (intro ≤500, context ≤500, question ≤100, text ≤80, consequence ≤300, reflection ≤500)?\n- [ ] Is the step count between 4 and 6?\n- [ ] Does every step have 3-4 options?\n\n# Output Format\n\nReturn an object with:\n\n- **intro**: Scenario introduction (max 500 chars)\n- **steps**: Array of 4-6 step objects, each with:\n  - **context**: Pure dialogue (max 500 chars)\n  - **question**: Decision prompt (max 100 chars)\n  - **options**: Array of 3-4 objects with:\n    - **text**: Choice description (max 80 chars)\n    - **consequence**: What happens (max 300 chars)\n    - **effects**: Array of 1-3 objects with:\n      - **dimension**: Short name for what this affects (use 2-4 different dimensions total)\n      - **impact**: One of \"positive\", \"neutral\", \"negative\"\n- **reflection**: Closing insight connecting to lesson (max 500 chars)\n",
      "testCaseId": "en-economics-supply-demand-1",
      "userPrompt": "LESSON_TITLE: Supply and Demand in Practice\nLESSON_DESCRIPTION: Applying supply and demand principles to make strategic pricing and market decisions\nCHAPTER_TITLE: Market Dynamics\nCOURSE_TITLE: Microeconomics Fundamentals\nLANGUAGE: en\nEXPLANATION_STEPS:\n1. The Demand Curve: Demand curves slope downward — as price rises, quantity demanded falls. This reflects the law of demand: people buy less when things cost more, all else equal.\n2. The Supply Curve: Supply curves slope upward — as price rises, quantity supplied increases. Higher prices incentivize producers to make more. Lower prices make production less worthwhile.\n3. Market Equilibrium: Equilibrium occurs where supply meets demand. At this price, quantity supplied equals quantity demanded. Prices above equilibrium create surplus; prices below create shortage.\n4. Price Elasticity: Price elasticity measures responsiveness to price changes. Elastic demand (>1) means sales drop sharply with price increases. Inelastic demand (<1) means sales barely change.\n5. Shifts vs. Movements: Shifts vs. movements: A change in price moves along the curve. Changes in other factors (income, preferences, costs) shift the entire curve. This distinction is crucial."
    },
    {
      "duration": 27576.17670900002,
      "inputTokens": 2098,
      "output": "{\n  \"intro\": \"Welcome to Emerald Ridge National Park, {{NAME}}. As our lead ecologist, you're tasked with managing our delicate landscape. Our elk population is booming, our forests are aging, and the local community is watching closely. You'll need to apply what you've learned about food webs, carrying capacity, and biodiversity to keep this ecosystem from crashing. Every decision has a ripple effect, so consider the trade-offs carefully.\",\n  \"reflection\": \"Management is about navigating ripples, {{NAME}}. You've seen how trophic cascades and carrying capacity aren't just concepts—they are the reality of land management. There is rarely a 'perfect' choice, only different paths toward resilience. Whether you prioritize biodiversity or stakeholder support, understanding how these ecological systems interconnect is the key to preserving Emerald Ridge for the future.\",\n  \"steps\": [\n    {\n      \"context\": \"{{NAME}}, the elk population is skyrocketing and they're stripping the riverbanks bare. We've got a proposal to reintroduce gray wolves to keep them in check. It's a classic trophic cascade play, but the local ranchers are already calling my office to complain about their livestock. What's our move?\",\n      \"options\": [\n        {\n          \"consequence\": \"The wolves reduced the elk numbers, allowing the willows to return. Birds and beavers are back, but the community is furious about livestock safety.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Biodiversity\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Public Support\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Reintroduce the wolves\"\n        },\n        {\n          \"consequence\": \"Hunters are happy, and elk numbers are down temporarily. However, without a constant predator presence, the elk just hide in the woods and graze elsewhere, leaving the riparian zones still damaged.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Public Support\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Ecosystem Health\",\n              \"impact\": \"neutral\"\n            }\n          ],\n          \"text\": \"Authorize a controlled elk cull\"\n        },\n        {\n          \"consequence\": \"The riverbanks eroded further. We lost several native fish species because the water got too warm without shade. At least we didn't start a political war with the neighbors.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Biodiversity\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Ecosystem Health\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Avoid predator introduction for now\"\n        }\n      ],\n      \"question\": \"Should we reintroduce wolves to the park?\"\n    },\n    {\n      \"context\": \"The mountain goat population is nearing carrying capacity. If they eat through the alpine lichen, the whole population might crash during a hard winter. But tourism relies on those goats being visible for photos. How do we handle the limits of this environment, {{NAME}}?\",\n      \"options\": [\n        {\n          \"consequence\": \"By relocating some goats, we protected the vegetation. The remaining herd is much healthier, but the local tour guides are complaining that sightings are way down.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Ecosystem Health\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Public Support\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Relocate a portion of the herd\"\n        },\n        {\n          \"consequence\": \"Feeding them kept the population high, but it spread disease and stopped them from naturally migrating. The goats have lost their wild instincts and the ecosystem is now dependent on us.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Ecosystem Health\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Public Support\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Provide supplementary winter feed\"\n        },\n        {\n          \"consequence\": \"A massive die-off occurred after a heavy frost due to lack of resources. The lichen is recovering slowly, but the ecosystem felt a huge shock that will take years to stabilize.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Biodiversity\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Ecosystem Health\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Let nature take its course\"\n        }\n      ],\n      \"question\": \"How should we manage the goat population?\"\n    },\n    {\n      \"context\": \"We have a large area of 'dead' land from the old fire. We can plant fast-growing pine for quick cover and future timber revenue, or a mix of twenty native species that will take twice as long to establish. {{NAME}}, what’s the plan for reforestation?\",\n      \"options\": [\n        {\n          \"consequence\": \"It's taking a long time, but the forest is incredibly hardy. It's resisting the current beetle outbreak much better than the neighbors' single-species plots.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Biodiversity\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Ecosystem Health\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Plant a diverse native mix\"\n        },\n        {\n          \"consequence\": \"The green cover returned quickly, which looked great for donors. However, a single pest species just wiped out half of the trees in one month because there was no variety to stop the spread.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Ecosystem Health\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Public Support\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Focus on fast-growing pine\"\n        },\n        {\n          \"consequence\": \"The variety of life appearing is staggering, but the local community thinks the park looks abandoned and messy. It will take decades to look like a forest again.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Biodiversity\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Public Support\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Allow for natural succession\"\n        }\n      ],\n      \"question\": \"Which reforestation strategy do we implement?\"\n    },\n    {\n      \"context\": \"Our meadows are slowly turning into forests as shrubs take over. This is natural succession, but we’ll lose the habitat for several rare butterfly species that only live in open grasslands. Do we intervene and stop the clock, or let the forest grow?\",\n      \"options\": [\n        {\n          \"consequence\": \"The fire cleared the brush and the butterflies are thriving. However, the smoke caused a local health advisory, and the community is nervous about fire safety.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Biodiversity\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Public Support\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Conduct controlled burns\"\n        },\n        {\n          \"consequence\": \"The new forest is sequestering more carbon, but those unique meadow species have vanished from our park. We've lost a significant part of our local biodiversity.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Biodiversity\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Ecosystem Health\",\n              \"impact\": \"neutral\"\n            }\n          ],\n          \"text\": \"Let succession continue\"\n        },\n        {\n          \"consequence\": \"Using mowers kept the meadows open without the smoke. It's very expensive and loud, and the heavy machinery accidentally crushed the nesting sites of ground birds.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Ecosystem Health\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Public Support\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Use mechanical clearing\"\n        }\n      ],\n      \"question\": \"Should we halt succession to save the meadows?\"\n    },\n    {\n      \"context\": \"{{NAME}}, we've spotted an invasive aquatic weed in the north lake. If it takes over, it'll choke out everything. We can use a chemical treatment or try manual removal with volunteers. What's our strategy for this network?\",\n      \"options\": [\n        {\n          \"consequence\": \"The invasive weed is gone! But the chemical had side effects on the local amphibian population, causing a temporary dip in their numbers.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Ecosystem Health\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Biodiversity\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Use targeted chemical treatment\"\n        },\n        {\n          \"consequence\": \"The community loved getting involved! Unfortunately, we missed several root systems, and the plant is already growing back faster than we can pull it.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Public Support\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Ecosystem Health\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Organize volunteer removal days\"\n        },\n        {\n          \"consequence\": \"The beetles are eating the weeds, but now they've started nibbling on our native water lilies. We've replaced one problem with a new, unpredictable one.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Biodiversity\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Ecosystem Health\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Introduce a biological control\"\n        }\n      ],\n      \"question\": \"How do we tackle the invasive species?\"\n    }\n  ]\n}",
      "outputTokens": 4390,
      "systemPrompt": "# Role\n\nYou are an expert educational game designer creating a **Challenge** activity for a learning app. Your mission is to design a choose-your-own-adventure scenario where learners make strategic decisions with meaningful consequences, using the lesson's concepts.\n\nYou specialize in crafting narrative experiences that test strategic thinking — not knowledge recall, but the ability to apply concepts and understand trade-offs.\n\n# Why Narrative Challenges Work\n\nGreat challenges don't quiz — they immerse. Learners face realistic scenarios where every choice has consequences. They experience trade-offs firsthand, making the lesson's principles memorable.\n\n- **No \"Right Answer\"**: Every option has pros and cons. Learners engage with WHY, not just WHAT.\n- **Consequences Over Scores**: Instead of winning or losing, learners see the natural results of their choices.\n- **Strategic Thinking**: Understanding the lesson helps navigate trade-offs, but different strategies lead to different outcomes.\n\n# Inputs\n\n- `LESSON_TITLE`: The topic to create a challenge around\n- `LESSON_DESCRIPTION`: Additional context about what this lesson covers\n- `CHAPTER_TITLE`: The chapter context (for understanding scope)\n- `COURSE_TITLE`: The course context (for understanding audience level)\n- `LANGUAGE`: Output language\n- `EXPLANATION_STEPS`: What the learner has already studied\n\n## Language Guidelines\n\n- `en`: Use US English unless the content is region-specific\n- `pt`: Use Brazilian Portuguese unless the content is region-specific\n- `es`: Use Latin American Spanish unless the content is region-specific\n\n# Requirements\n\n## Introduction\n\nThe `intro` field sets the scene (max 500 characters). It should:\n\n- Establish the scenario and the learner's role\n- Explain what they're navigating (a project, situation, decision-making process)\n- Create stakes that feel meaningful\n- Use `{{NAME}}` to personalize\n\n## Steps\n\nCreate 4-6 steps. Each step presents a decision point with 3-4 options.\n\n### Step Structure\n\n- **context**: Maximum 500 characters. Pure dialogue from a colleague setting up the decision. Conversational, no narrator.\n- **question**: Maximum 100 characters. What needs to be decided.\n- **options**: 3-4 choices, each with:\n  - **text**: The choice (max 80 characters)\n  - **consequence**: What happens as a result (max 300 characters). Shown after choosing. Explains the outcome narratively.\n  - **effects**: Array of 1-3 effects showing how this choice impacts different aspects:\n    - **dimension**: A short name for what this affects (e.g., \"Code Quality\", \"Delivery Speed\", \"Team Morale\"). Use 2-4 different dimensions across all options to create meaningful trade-offs. Important: dimensions must be consistent across all steps.\n    - **impact**: Is this `\"positive\"`, `\"neutral\"`, or `\"negative\"` for that dimension?\n\n### Option Design\n\nEvery option should:\n\n- Be a legitimate choice (no obviously wrong answers)\n- Have a clear consequence that connects to lesson concepts\n- Affect 1-3 dimensions (real decisions rarely affect just one thing)\n- Teach something about trade-offs when the consequence is revealed\n\n**No option should be universally best.** Good options might help one dimension but hurt another. This creates genuine trade-offs.\n\n## Reflection\n\nThe `reflection` field (max 500 characters) provides closing insight after all steps. It should:\n\n- Acknowledge that different approaches have merit\n- Connect the experience back to the lesson's key principles\n- Help learners understand how the concepts apply in practice\n\n## Tone & Style\n\n- **Pure dialogue**: NO narrator, NO character prefixes, NO action descriptions\n- **Natural conversation**: Colleagues working through a problem together\n- **Professional but warm**: Light humor when appropriate\n- **Second-person immersion**: The colleague speaks TO the learner\n- **Use `{{NAME}}`** to personalize dialogue\n\n## What to Avoid\n\n- **Quiz-style questions**: This tests strategic thinking, not recall\n- **Obviously correct answers**: Every option should have genuine trade-offs\n- **Narrator text**: Keep it pure dialogue in context\n- **Disconnected consequences**: Consequences should relate to lesson concepts\n- **Too many or too few dimensions**: Use 2-4 different dimension names across all effects for meaningful trade-offs\n\n## Relationship to Previous Activities\n\nThe learner has completed:\n\n- **Background**: WHY this exists\n- **Explanation**: WHAT it is\n- **Mechanics**: HOW it works\n- **Examples**: WHERE it appears\n- **Story**: WHEN to apply this\n\nYour Challenge activity is the capstone: **CAN YOU NAVIGATE THIS?** It tests whether learners can apply concepts strategically. This should feel like a meaningful simulation, not a test.\n\n# Example\n\nFor a lesson on \"Technical Debt\":\n\n**Step 1:**\n\n```json\n{\n  \"context\": \"{{NAME}}, we've got a deadline crunch. The feature works but the code is messy. Ship it now or clean it up first?\",\n  \"question\": \"How do we handle this?\",\n  \"options\": [\n    {\n      \"text\": \"Ship it now, refactor later\",\n      \"consequence\": \"Feature launched on time! But the messy code made the next sprint's work harder. The team spent extra hours untangling dependencies.\",\n      \"effects\": [\n        { \"dimension\": \"Code Quality\", \"impact\": \"negative\" },\n        { \"dimension\": \"Delivery Speed\", \"impact\": \"positive\" }\n      ]\n    },\n    {\n      \"text\": \"Take two more days to refactor\",\n      \"consequence\": \"The code is clean and maintainable. Stakeholders weren't thrilled about the delay, but future changes will be much easier.\",\n      \"effects\": [\n        { \"dimension\": \"Code Quality\", \"impact\": \"positive\" },\n        { \"dimension\": \"Delivery Speed\", \"impact\": \"negative\" }\n      ]\n    },\n    {\n      \"text\": \"Split the team — half ships, half refactors\",\n      \"consequence\": \"Shipped on time with partial cleanup. Neither task got full attention, and the team felt stretched thin.\",\n      \"effects\": [\n        { \"dimension\": \"Code Quality\", \"impact\": \"neutral\" },\n        { \"dimension\": \"Team Morale\", \"impact\": \"negative\" }\n      ]\n    }\n  ]\n}\n```\n\n# Quality Checks\n\nBefore finalizing, verify:\n\n- [ ] Does the intro establish a clear, engaging scenario?\n- [ ] Does every option have a meaningful consequence?\n- [ ] Are consequences connected to lesson principles?\n- [ ] Is there no obviously \"best\" option in each step?\n- [ ] Do options affect multiple dimensions where realistic?\n- [ ] Are dimension names consistent and lesson-relevant across all effects?\n- [ ] Is `{{NAME}}` used appropriately?\n- [ ] Is all dialogue pure conversation (no narrator)?\n- [ ] Does the reflection tie the experience back to the lesson?\n- [ ] Are all constraints met (intro ≤500, context ≤500, question ≤100, text ≤80, consequence ≤300, reflection ≤500)?\n- [ ] Is the step count between 4 and 6?\n- [ ] Does every step have 3-4 options?\n\n# Output Format\n\nReturn an object with:\n\n- **intro**: Scenario introduction (max 500 chars)\n- **steps**: Array of 4-6 step objects, each with:\n  - **context**: Pure dialogue (max 500 chars)\n  - **question**: Decision prompt (max 100 chars)\n  - **options**: Array of 3-4 objects with:\n    - **text**: Choice description (max 80 chars)\n    - **consequence**: What happens (max 300 chars)\n    - **effects**: Array of 1-3 objects with:\n      - **dimension**: Short name for what this affects (use 2-4 different dimensions total)\n      - **impact**: One of \"positive\", \"neutral\", \"negative\"\n- **reflection**: Closing insight connecting to lesson (max 500 chars)\n",
      "testCaseId": "en-biology-ecosystem-balance-1",
      "userPrompt": "LESSON_TITLE: Ecosystem Balance and Management\nLESSON_DESCRIPTION: Applying ecological principles to make informed ecosystem management decisions\nCHAPTER_TITLE: Ecosystem Dynamics\nCOURSE_TITLE: Ecology and Conservation\nLANGUAGE: en\nEXPLANATION_STEPS:\n1. Interconnected Networks: Ecosystems are interconnected networks. Removing one species affects others through food webs. Keystone species have disproportionate impact — their loss cascades through the system.\n2. Carrying Capacity: Carrying capacity is the maximum population an environment can sustain. Exceed it, and resources deplete, populations crash. Stay well below, and you're not maximizing the ecosystem's potential.\n3. Biodiversity and Resilience: Biodiversity provides resilience. More species means more ways to respond to change. Monocultures are efficient but fragile. Diverse systems are robust but complex to manage.\n4. Trophic Cascades: Trophic cascades occur when changes at one level ripple through others. Remove predators, and prey populations explode, overgrazing vegetation, affecting everything that depends on those plants.\n5. Ecological Succession: Ecological succession is the process of change over time. Pioneer species prepare the way for later ones. Managing ecosystems means deciding where in succession you want to be."
    },
    {
      "duration": 28055.986041000055,
      "inputTokens": 2161,
      "output": "{\n  \"intro\": \"Bem-vindo à planta de síntese de amônia, {{NAME}}! Como engenheiro assistente, você deve gerenciar o reator principal. O objetivo é aplicar o Princípio de Le Chatelier para otimizar a produção. Lembre-se: toda mudança no equilíbrio químico traz consequências para o custo, a velocidade e o rendimento da fábrica. Pronto para o turno?\",\n  \"reflection\": \"Gerenciar processos industriais é a arte de equilibrar o Princípio de Le Chatelier com a realidade econômica. Como você viu, {{NAME}}, deslocar o equilíbrio para os produtos muitas vezes exige mais energia ou compromete a velocidade da reação. O domínio desses conceitos permite que você tome decisões estratégicas para maximizar a eficiência sem ignorar as limitações físicas e financeiras do sistema.\",\n  \"steps\": [\n    {\n      \"context\": \"{{NAME}}, o reator atingiu o equilíbrio, mas a taxa de amônia na saída está abaixo da meta. Se injetarmos um excesso de nitrogênio gasoso no tanque agora, o que você espera que aconteça com a produção final?\",\n      \"options\": [\n        {\n          \"consequence\": \"O sistema deslocou-se para consumir o excesso de nitrogênio, produzindo mais amônia! O rendimento subiu, mas o custo com matéria-prima também aumentou.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Rendimento\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Custos Operacionais\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Injetar excesso de nitrogênio\"\n        },\n        {\n          \"consequence\": \"Excelente escolha técnica! Ao remover o produto, o equilíbrio nunca é atingido plenamente, forçando a reação a continuar produzindo amônia sem parar.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Rendimento\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Custos Operacionais\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Remover a amônia continuamente\"\n        },\n        {\n          \"consequence\": \"Economizamos reagentes, mas o sistema deslocou-se para a esquerda para repor o hidrogênio, reduzindo drasticamente nossa amônia final.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Rendimento\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Custos Operacionais\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Reduzir a carga de hidrogênio\"\n        }\n      ],\n      \"question\": \"Qual a sua estratégia de concentração?\"\n    },\n    {\n      \"context\": \"O medidor de pressão está à sua disposição, {{NAME}}. A reação de síntese transforma 4 moles de gás em apenas 2 moles de produto. Se aumentarmos a pressão interna do reator, o que acontece?\",\n      \"options\": [\n        {\n          \"consequence\": \"O sistema buscou o lado com menor volume gasoso, favorecendo a amônia! O rendimento é alto, mas manter essa pressão exige compressores caros.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Rendimento\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Custos Operacionais\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Aumentar a pressão do reator\"\n        },\n        {\n          \"consequence\": \"O equilíbrio deslocou-se para o lado com mais moles de gás (reagentes). Produzimos menos, embora o custo de compressão tenha caído.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Rendimento\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Custos Operacionais\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Trabalhar com pressão reduzida\"\n        },\n        {\n          \"consequence\": \"A pressão total subiu, mas as pressões parciais dos reagentes não mudaram. O equilíbrio não se deslocou e gastamos dinheiro com gás inútil.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Rendimento\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Custos Operacionais\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Adicionar gás argônio (inerte)\"\n        }\n      ],\n      \"question\": \"Como configurar o compressor?\"\n    },\n    {\n      \"context\": \"Esta reação libera calor, {{NAME}}. Se o reator esquentar demais, a constante de equilíbrio favorecerá os reagentes. Mas se esfriarmos demais, a reação fica lenta. Como você quer lidar com a temperatura?\",\n      \"options\": [\n        {\n          \"consequence\": \"Pelo Princípio de Le Chatelier, o sistema favorece a reação exotérmica. Temos muito produto, mas a reação demora muito para completar o ciclo.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Rendimento\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Velocidade da Reação\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Resfriar o sistema drasticamente\"\n        },\n        {\n          \"consequence\": \"As moléculas colidem mais rápido, mas o equilíbrio deslocou-se para os reagentes. A produção de amônia caiu, apesar da rapidez.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Rendimento\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Velocidade da Reação\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Aumentar o aquecimento do reator\"\n        },\n        {\n          \"consequence\": \"Conseguimos um compromisso entre a termodinâmica e a cinética. O rendimento é aceitável e o tempo de reação não compromete a entrega.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Rendimento\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Velocidade da Reação\",\n              \"impact\": \"neutral\"\n            }\n          ],\n          \"text\": \"Manter temperatura moderada\"\n        }\n      ],\n      \"question\": \"Qual ajuste térmico você fará?\"\n    },\n    {\n      \"context\": \"{{NAME}}, o gerente financeiro quer cortar o custo do catalisador de ferro. Ele argumenta que o equilíbrio final será o mesmo. Ele está certo, mas o que isso faria com a nossa operação diária?\",\n      \"options\": [\n        {\n          \"consequence\": \"O catalisador não desloca o equilíbrio, mas sem ele, levaríamos semanas para atingir o estado final. A fábrica parou por lentidão.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Velocidade da Reação\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Custos Operacionais\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Remover o uso de catalisadores\"\n        },\n        {\n          \"consequence\": \"O investimento compensa! O equilíbrio é atingido rapidamente, permitindo mais ciclos de produção por dia, sem alterar o rendimento químico.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Velocidade da Reação\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Custos Operacionais\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Manter o catalisador de ferro\"\n        },\n        {\n          \"consequence\": \"O novo catalisador é caro, mas a velocidade subiu tanto que podemos operar em temperaturas menores, melhorando o rendimento termodinâmico.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Velocidade da Reação\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Rendimento\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Investir em um catalisador premium\"\n        }\n      ],\n      \"question\": \"Devemos manter o catalisador?\"\n    }\n  ]\n}",
      "outputTokens": 4121,
      "systemPrompt": "# Role\n\nYou are an expert educational game designer creating a **Challenge** activity for a learning app. Your mission is to design a choose-your-own-adventure scenario where learners make strategic decisions with meaningful consequences, using the lesson's concepts.\n\nYou specialize in crafting narrative experiences that test strategic thinking — not knowledge recall, but the ability to apply concepts and understand trade-offs.\n\n# Why Narrative Challenges Work\n\nGreat challenges don't quiz — they immerse. Learners face realistic scenarios where every choice has consequences. They experience trade-offs firsthand, making the lesson's principles memorable.\n\n- **No \"Right Answer\"**: Every option has pros and cons. Learners engage with WHY, not just WHAT.\n- **Consequences Over Scores**: Instead of winning or losing, learners see the natural results of their choices.\n- **Strategic Thinking**: Understanding the lesson helps navigate trade-offs, but different strategies lead to different outcomes.\n\n# Inputs\n\n- `LESSON_TITLE`: The topic to create a challenge around\n- `LESSON_DESCRIPTION`: Additional context about what this lesson covers\n- `CHAPTER_TITLE`: The chapter context (for understanding scope)\n- `COURSE_TITLE`: The course context (for understanding audience level)\n- `LANGUAGE`: Output language\n- `EXPLANATION_STEPS`: What the learner has already studied\n\n## Language Guidelines\n\n- `en`: Use US English unless the content is region-specific\n- `pt`: Use Brazilian Portuguese unless the content is region-specific\n- `es`: Use Latin American Spanish unless the content is region-specific\n\n# Requirements\n\n## Introduction\n\nThe `intro` field sets the scene (max 500 characters). It should:\n\n- Establish the scenario and the learner's role\n- Explain what they're navigating (a project, situation, decision-making process)\n- Create stakes that feel meaningful\n- Use `{{NAME}}` to personalize\n\n## Steps\n\nCreate 4-6 steps. Each step presents a decision point with 3-4 options.\n\n### Step Structure\n\n- **context**: Maximum 500 characters. Pure dialogue from a colleague setting up the decision. Conversational, no narrator.\n- **question**: Maximum 100 characters. What needs to be decided.\n- **options**: 3-4 choices, each with:\n  - **text**: The choice (max 80 characters)\n  - **consequence**: What happens as a result (max 300 characters). Shown after choosing. Explains the outcome narratively.\n  - **effects**: Array of 1-3 effects showing how this choice impacts different aspects:\n    - **dimension**: A short name for what this affects (e.g., \"Code Quality\", \"Delivery Speed\", \"Team Morale\"). Use 2-4 different dimensions across all options to create meaningful trade-offs. Important: dimensions must be consistent across all steps.\n    - **impact**: Is this `\"positive\"`, `\"neutral\"`, or `\"negative\"` for that dimension?\n\n### Option Design\n\nEvery option should:\n\n- Be a legitimate choice (no obviously wrong answers)\n- Have a clear consequence that connects to lesson concepts\n- Affect 1-3 dimensions (real decisions rarely affect just one thing)\n- Teach something about trade-offs when the consequence is revealed\n\n**No option should be universally best.** Good options might help one dimension but hurt another. This creates genuine trade-offs.\n\n## Reflection\n\nThe `reflection` field (max 500 characters) provides closing insight after all steps. It should:\n\n- Acknowledge that different approaches have merit\n- Connect the experience back to the lesson's key principles\n- Help learners understand how the concepts apply in practice\n\n## Tone & Style\n\n- **Pure dialogue**: NO narrator, NO character prefixes, NO action descriptions\n- **Natural conversation**: Colleagues working through a problem together\n- **Professional but warm**: Light humor when appropriate\n- **Second-person immersion**: The colleague speaks TO the learner\n- **Use `{{NAME}}`** to personalize dialogue\n\n## What to Avoid\n\n- **Quiz-style questions**: This tests strategic thinking, not recall\n- **Obviously correct answers**: Every option should have genuine trade-offs\n- **Narrator text**: Keep it pure dialogue in context\n- **Disconnected consequences**: Consequences should relate to lesson concepts\n- **Too many or too few dimensions**: Use 2-4 different dimension names across all effects for meaningful trade-offs\n\n## Relationship to Previous Activities\n\nThe learner has completed:\n\n- **Background**: WHY this exists\n- **Explanation**: WHAT it is\n- **Mechanics**: HOW it works\n- **Examples**: WHERE it appears\n- **Story**: WHEN to apply this\n\nYour Challenge activity is the capstone: **CAN YOU NAVIGATE THIS?** It tests whether learners can apply concepts strategically. This should feel like a meaningful simulation, not a test.\n\n# Example\n\nFor a lesson on \"Technical Debt\":\n\n**Step 1:**\n\n```json\n{\n  \"context\": \"{{NAME}}, we've got a deadline crunch. The feature works but the code is messy. Ship it now or clean it up first?\",\n  \"question\": \"How do we handle this?\",\n  \"options\": [\n    {\n      \"text\": \"Ship it now, refactor later\",\n      \"consequence\": \"Feature launched on time! But the messy code made the next sprint's work harder. The team spent extra hours untangling dependencies.\",\n      \"effects\": [\n        { \"dimension\": \"Code Quality\", \"impact\": \"negative\" },\n        { \"dimension\": \"Delivery Speed\", \"impact\": \"positive\" }\n      ]\n    },\n    {\n      \"text\": \"Take two more days to refactor\",\n      \"consequence\": \"The code is clean and maintainable. Stakeholders weren't thrilled about the delay, but future changes will be much easier.\",\n      \"effects\": [\n        { \"dimension\": \"Code Quality\", \"impact\": \"positive\" },\n        { \"dimension\": \"Delivery Speed\", \"impact\": \"negative\" }\n      ]\n    },\n    {\n      \"text\": \"Split the team — half ships, half refactors\",\n      \"consequence\": \"Shipped on time with partial cleanup. Neither task got full attention, and the team felt stretched thin.\",\n      \"effects\": [\n        { \"dimension\": \"Code Quality\", \"impact\": \"neutral\" },\n        { \"dimension\": \"Team Morale\", \"impact\": \"negative\" }\n      ]\n    }\n  ]\n}\n```\n\n# Quality Checks\n\nBefore finalizing, verify:\n\n- [ ] Does the intro establish a clear, engaging scenario?\n- [ ] Does every option have a meaningful consequence?\n- [ ] Are consequences connected to lesson principles?\n- [ ] Is there no obviously \"best\" option in each step?\n- [ ] Do options affect multiple dimensions where realistic?\n- [ ] Are dimension names consistent and lesson-relevant across all effects?\n- [ ] Is `{{NAME}}` used appropriately?\n- [ ] Is all dialogue pure conversation (no narrator)?\n- [ ] Does the reflection tie the experience back to the lesson?\n- [ ] Are all constraints met (intro ≤500, context ≤500, question ≤100, text ≤80, consequence ≤300, reflection ≤500)?\n- [ ] Is the step count between 4 and 6?\n- [ ] Does every step have 3-4 options?\n\n# Output Format\n\nReturn an object with:\n\n- **intro**: Scenario introduction (max 500 chars)\n- **steps**: Array of 4-6 step objects, each with:\n  - **context**: Pure dialogue (max 500 chars)\n  - **question**: Decision prompt (max 100 chars)\n  - **options**: Array of 3-4 objects with:\n    - **text**: Choice description (max 80 chars)\n    - **consequence**: What happens (max 300 chars)\n    - **effects**: Array of 1-3 objects with:\n      - **dimension**: Short name for what this affects (use 2-4 different dimensions total)\n      - **impact**: One of \"positive\", \"neutral\", \"negative\"\n- **reflection**: Closing insight connecting to lesson (max 500 chars)\n",
      "testCaseId": "pt-chemistry-reaction-equilibrium-1",
      "userPrompt": "LESSON_TITLE: Equilibrio Quimico na Pratica\nLESSON_DESCRIPTION: Aplicando o principio de Le Chatelier para otimizar reacoes quimicas e processos industriais\nCHAPTER_TITLE: Equilibrio Quimico\nCOURSE_TITLE: Quimica Geral II\nLANGUAGE: pt\nEXPLANATION_STEPS:\n1. Principio de Le Chatelier: O principio de Le Chatelier diz que um sistema em equilibrio responde a perturbacoes minimizando a mudanca. Adicione reagente, o equilibrio desloca para consumir esse reagente.\n2. Efeito da Concentracao: Mudancas de concentracao deslocam o equilibrio. Adicionar reagentes desloca para produtos. Remover produtos tambem desloca para produtos. O sistema busca restaurar o equilibrio.\n3. Efeito da Pressao: A pressao afeta equilibrios gasosos. Aumentar pressao favorece o lado com menos moles de gas. Diminuir pressao favorece o lado com mais moles. Gases inertes nao afetam.\n4. Efeito da Temperatura: Temperatura e diferente — ela muda a constante de equilibrio. Reacoes exotermicas: aumento de temperatura desloca para reagentes. Reacoes endotermicas: aumento favorece produtos.\n5. Papel dos Catalisadores: Catalisadores aceleram ambas as direcoes igualmente. Eles nao deslocam o equilibrio — apenas ajudam a alcancar o equilibrio mais rapido. Util para processos industriais."
    },
    {
      "duration": 29939.451625000045,
      "inputTokens": 2162,
      "output": "{\n  \"intro\": \"¡Bienvenido al equipo de ingeniería, {{NAME}}! Estamos diseñando el sistema energético de una base científica aislada en los Andes. No hay conexión a la red eléctrica, así que cada julio de energía cuenta. Tu misión es equilibrar la eficiencia de las conversiones, los costos de almacenamiento y la estabilidad del suministro. Recuerda que en el mundo real, la energía siempre se transforma y nunca se aprovecha al 100%. ¿Podrás mantener la base funcionando sin desperdiciar recursos?\",\n  \"reflection\": \"¡Gran trabajo navegando estos compromisos técnicos, {{NAME}}! Como has visto, la conservación de la energía en sistemas reales no se trata solo de fórmulas, sino de entender que cada conversión tiene un precio en eficiencia. No existe el sistema perfecto, solo el sistema mejor optimizado para sus prioridades. Ya sea priorizando la densidad energética o minimizando las pérdidas en cadena, ahora comprendes cómo se aplican las leyes de la termodinámica en la práctica profesional.\",\n  \"steps\": [\n    {\n      \"context\": \"{{NAME}}, necesitamos decidir la fuente base. El generador diésel tiene una densidad energética enorme y es muy fiable, pero las pérdidas por calor son masivas. Los paneles solares son más eficientes en su transformación directa, pero el costo inicial es alto y dependen del clima.\",\n      \"options\": [\n        {\n          \"consequence\": \"Tenemos energía constante, pero el gasto en combustible es alto debido a que gran parte de la energía se pierde como calor residual en el motor.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Eficiencia\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Estabilidad\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Priorizar el generador diésel por su fiabilidad\"\n        },\n        {\n          \"consequence\": \"La eficiencia de transformación es excelente y el costo operativo es nulo, pero la inversión inicial agotó gran parte de nuestro presupuesto mensual.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Eficiencia\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Costo\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Instalar un parque solar de alta eficiencia\"\n        },\n        {\n          \"consequence\": \"Logramos un equilibrio técnico, aunque la complejidad de integrar ambas fuentes aumentó los costos de instalación significativamente.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Estabilidad\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Costo\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Implementar un sistema híbrido diésel-solar\"\n        }\n      ],\n      \"question\": \"¿Qué fuente de energía principal elegimos?\"\n    },\n    {\n      \"context\": \"El almacenamiento es un problema, {{NAME}}. Las baterías de litio son eficientes en los ciclos de carga, pero caras. Podríamos usar bombeo de agua a un tanque elevado; es más robusto y barato, pero perdemos un 30% de energía por fricción y eficiencia mecánica.\",\n      \"options\": [\n        {\n          \"consequence\": \"Retenemos la mayor parte de la energía generada con mínimas pérdidas internas, aunque el presupuesto quedó muy ajustado para otros equipos.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Eficiencia\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Costo\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Usar bancos de baterías de litio de última generación\"\n        },\n        {\n          \"consequence\": \"Ahorramos dinero en equipos, pero tenemos que generar un 30% más de energía solo para compensar lo que se pierde en el proceso de bombeo.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Eficiencia\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Costo\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Instalar un sistema de almacenamiento por bombeo hidráulico\"\n        },\n        {\n          \"consequence\": \"Sin almacenamiento, desperdiciamos el excedente solar del mediodía y dependemos totalmente del diésel por la noche.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Eficiencia\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Estabilidad\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"No usar almacenamiento y depender de la generación en tiempo real\"\n        }\n      ],\n      \"question\": \"¿Cómo gestionamos el almacenamiento de energía?\"\n    },\n    {\n      \"context\": \"Cada vez que transformamos la energía de los paneles de CC a CA para los enchufes normales, perdemos un 10%. {{NAME}}, podríamos alimentar los laboratorios directamente en corriente continua (CC), pero tendríamos que comprar equipos especiales más caros.\",\n      \"options\": [\n        {\n          \"consequence\": \"Eliminamos un paso de conversión y sus pérdidas asociadas, mejorando el rendimiento total del sistema, pero los equipos costaron el doble.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Eficiencia\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Costo\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Implementar una red de corriente continua directa para laboratorios\"\n        },\n        {\n          \"consequence\": \"Usamos equipos estándar baratos, pero la cadena de inversores y transformadores genera un calor que debemos disipar constantemente.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Eficiencia\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Costo\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Convertir todo a CA estándar para usar equipos comunes\"\n        },\n        {\n          \"consequence\": \"Redujimos las pérdidas donde era crítico y mantuvimos la estabilidad, aunque la red se volvió más difícil de mantener.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Eficiencia\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Estabilidad\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Usar un sistema mixto con convertidores locales de alta eficiencia\"\n        }\n      ],\n      \"question\": \"¿Cómo reducimos las pérdidas en la cadena de conversión?\"\n    },\n    {\n      \"context\": \"La sala de servidores genera mucho calor. Es energía que ya pagamos pero que se está desperdiciando. Podríamos instalar un sistema de recuperación para calentar el agua de la base, o simplemente poner extractores para que no se quemen los equipos. ¿Qué decides, {{NAME}}?\",\n      \"options\": [\n        {\n          \"consequence\": \"Aumentamos la eficiencia global del sistema al reutilizar el calor residual, aunque la instalación de tuberías fue compleja y costosa.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Eficiencia\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Costo\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Instalar un sistema de cogeneración para aprovechar el calor\"\n        },\n        {\n          \"consequence\": \"La solución fue barata y rápida, pero seguimos necesitando energía extra para calentar el agua, desperdiciando el calor de los servidores.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Eficiencia\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Costo\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Usar ventilación simple y calentadores eléctricos independientes\"\n        }\n      ],\n      \"question\": \"¿Cómo aprovechamos la energía residual?\"\n    },\n    {\n      \"context\": \"¡{{NAME}}! La demanda ha subido y los cables se están calentando por el efecto Joule. Esto aumenta la resistencia y perdemos aún más energía. ¿Mejoramos el grosor de los cables para reducir la resistencia o limitamos el uso de los equipos de los científicos?\",\n      \"options\": [\n        {\n          \"consequence\": \"Redujimos las pérdidas por transporte significativamente, asegurando que la energía llegue a su destino, aunque el cobre es caro.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Eficiencia\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Costo\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Reemplazar el cableado por uno de mayor sección y menor resistencia\"\n        },\n        {\n          \"consequence\": \"Mantenemos el sistema bajo control sin gastos extra, pero los científicos están molestos porque no pueden avanzar en sus investigaciones.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Eficiencia\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Estabilidad\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Racionar el consumo para evitar el sobrecalentamiento\"\n        },\n        {\n          \"consequence\": \"El sistema opera al límite. Las pérdidas por calor son altísimas y corremos el riesgo de un fallo por degradación térmica de los aislantes.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Eficiencia\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Estabilidad\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Mantener la carga actual y monitorear la temperatura\"\n        }\n      ],\n      \"question\": \"¿Cómo manejamos la ineficiencia por transporte?\"\n    }\n  ]\n}",
      "outputTokens": 4518,
      "systemPrompt": "# Role\n\nYou are an expert educational game designer creating a **Challenge** activity for a learning app. Your mission is to design a choose-your-own-adventure scenario where learners make strategic decisions with meaningful consequences, using the lesson's concepts.\n\nYou specialize in crafting narrative experiences that test strategic thinking — not knowledge recall, but the ability to apply concepts and understand trade-offs.\n\n# Why Narrative Challenges Work\n\nGreat challenges don't quiz — they immerse. Learners face realistic scenarios where every choice has consequences. They experience trade-offs firsthand, making the lesson's principles memorable.\n\n- **No \"Right Answer\"**: Every option has pros and cons. Learners engage with WHY, not just WHAT.\n- **Consequences Over Scores**: Instead of winning or losing, learners see the natural results of their choices.\n- **Strategic Thinking**: Understanding the lesson helps navigate trade-offs, but different strategies lead to different outcomes.\n\n# Inputs\n\n- `LESSON_TITLE`: The topic to create a challenge around\n- `LESSON_DESCRIPTION`: Additional context about what this lesson covers\n- `CHAPTER_TITLE`: The chapter context (for understanding scope)\n- `COURSE_TITLE`: The course context (for understanding audience level)\n- `LANGUAGE`: Output language\n- `EXPLANATION_STEPS`: What the learner has already studied\n\n## Language Guidelines\n\n- `en`: Use US English unless the content is region-specific\n- `pt`: Use Brazilian Portuguese unless the content is region-specific\n- `es`: Use Latin American Spanish unless the content is region-specific\n\n# Requirements\n\n## Introduction\n\nThe `intro` field sets the scene (max 500 characters). It should:\n\n- Establish the scenario and the learner's role\n- Explain what they're navigating (a project, situation, decision-making process)\n- Create stakes that feel meaningful\n- Use `{{NAME}}` to personalize\n\n## Steps\n\nCreate 4-6 steps. Each step presents a decision point with 3-4 options.\n\n### Step Structure\n\n- **context**: Maximum 500 characters. Pure dialogue from a colleague setting up the decision. Conversational, no narrator.\n- **question**: Maximum 100 characters. What needs to be decided.\n- **options**: 3-4 choices, each with:\n  - **text**: The choice (max 80 characters)\n  - **consequence**: What happens as a result (max 300 characters). Shown after choosing. Explains the outcome narratively.\n  - **effects**: Array of 1-3 effects showing how this choice impacts different aspects:\n    - **dimension**: A short name for what this affects (e.g., \"Code Quality\", \"Delivery Speed\", \"Team Morale\"). Use 2-4 different dimensions across all options to create meaningful trade-offs. Important: dimensions must be consistent across all steps.\n    - **impact**: Is this `\"positive\"`, `\"neutral\"`, or `\"negative\"` for that dimension?\n\n### Option Design\n\nEvery option should:\n\n- Be a legitimate choice (no obviously wrong answers)\n- Have a clear consequence that connects to lesson concepts\n- Affect 1-3 dimensions (real decisions rarely affect just one thing)\n- Teach something about trade-offs when the consequence is revealed\n\n**No option should be universally best.** Good options might help one dimension but hurt another. This creates genuine trade-offs.\n\n## Reflection\n\nThe `reflection` field (max 500 characters) provides closing insight after all steps. It should:\n\n- Acknowledge that different approaches have merit\n- Connect the experience back to the lesson's key principles\n- Help learners understand how the concepts apply in practice\n\n## Tone & Style\n\n- **Pure dialogue**: NO narrator, NO character prefixes, NO action descriptions\n- **Natural conversation**: Colleagues working through a problem together\n- **Professional but warm**: Light humor when appropriate\n- **Second-person immersion**: The colleague speaks TO the learner\n- **Use `{{NAME}}`** to personalize dialogue\n\n## What to Avoid\n\n- **Quiz-style questions**: This tests strategic thinking, not recall\n- **Obviously correct answers**: Every option should have genuine trade-offs\n- **Narrator text**: Keep it pure dialogue in context\n- **Disconnected consequences**: Consequences should relate to lesson concepts\n- **Too many or too few dimensions**: Use 2-4 different dimension names across all effects for meaningful trade-offs\n\n## Relationship to Previous Activities\n\nThe learner has completed:\n\n- **Background**: WHY this exists\n- **Explanation**: WHAT it is\n- **Mechanics**: HOW it works\n- **Examples**: WHERE it appears\n- **Story**: WHEN to apply this\n\nYour Challenge activity is the capstone: **CAN YOU NAVIGATE THIS?** It tests whether learners can apply concepts strategically. This should feel like a meaningful simulation, not a test.\n\n# Example\n\nFor a lesson on \"Technical Debt\":\n\n**Step 1:**\n\n```json\n{\n  \"context\": \"{{NAME}}, we've got a deadline crunch. The feature works but the code is messy. Ship it now or clean it up first?\",\n  \"question\": \"How do we handle this?\",\n  \"options\": [\n    {\n      \"text\": \"Ship it now, refactor later\",\n      \"consequence\": \"Feature launched on time! But the messy code made the next sprint's work harder. The team spent extra hours untangling dependencies.\",\n      \"effects\": [\n        { \"dimension\": \"Code Quality\", \"impact\": \"negative\" },\n        { \"dimension\": \"Delivery Speed\", \"impact\": \"positive\" }\n      ]\n    },\n    {\n      \"text\": \"Take two more days to refactor\",\n      \"consequence\": \"The code is clean and maintainable. Stakeholders weren't thrilled about the delay, but future changes will be much easier.\",\n      \"effects\": [\n        { \"dimension\": \"Code Quality\", \"impact\": \"positive\" },\n        { \"dimension\": \"Delivery Speed\", \"impact\": \"negative\" }\n      ]\n    },\n    {\n      \"text\": \"Split the team — half ships, half refactors\",\n      \"consequence\": \"Shipped on time with partial cleanup. Neither task got full attention, and the team felt stretched thin.\",\n      \"effects\": [\n        { \"dimension\": \"Code Quality\", \"impact\": \"neutral\" },\n        { \"dimension\": \"Team Morale\", \"impact\": \"negative\" }\n      ]\n    }\n  ]\n}\n```\n\n# Quality Checks\n\nBefore finalizing, verify:\n\n- [ ] Does the intro establish a clear, engaging scenario?\n- [ ] Does every option have a meaningful consequence?\n- [ ] Are consequences connected to lesson principles?\n- [ ] Is there no obviously \"best\" option in each step?\n- [ ] Do options affect multiple dimensions where realistic?\n- [ ] Are dimension names consistent and lesson-relevant across all effects?\n- [ ] Is `{{NAME}}` used appropriately?\n- [ ] Is all dialogue pure conversation (no narrator)?\n- [ ] Does the reflection tie the experience back to the lesson?\n- [ ] Are all constraints met (intro ≤500, context ≤500, question ≤100, text ≤80, consequence ≤300, reflection ≤500)?\n- [ ] Is the step count between 4 and 6?\n- [ ] Does every step have 3-4 options?\n\n# Output Format\n\nReturn an object with:\n\n- **intro**: Scenario introduction (max 500 chars)\n- **steps**: Array of 4-6 step objects, each with:\n  - **context**: Pure dialogue (max 500 chars)\n  - **question**: Decision prompt (max 100 chars)\n  - **options**: Array of 3-4 objects with:\n    - **text**: Choice description (max 80 chars)\n    - **consequence**: What happens (max 300 chars)\n    - **effects**: Array of 1-3 objects with:\n      - **dimension**: Short name for what this affects (use 2-4 different dimensions total)\n      - **impact**: One of \"positive\", \"neutral\", \"negative\"\n- **reflection**: Closing insight connecting to lesson (max 500 chars)\n",
      "testCaseId": "es-physics-energy-conservation-1",
      "userPrompt": "LESSON_TITLE: Conservacion de Energia en Sistemas Reales\nLESSON_DESCRIPTION: Aplicando principios de conservacion de energia para disenar y optimizar sistemas energeticos\nCHAPTER_TITLE: Energia y Trabajo\nCOURSE_TITLE: Fisica Aplicada\nLANGUAGE: es\nEXPLANATION_STEPS:\n1. Conservacion de la Energia: La energia no se crea ni se destruye, solo se transforma. En cada conversion, la energia total se conserva, pero la energia util disminuye. Parte siempre se convierte en calor no aprovechable.\n2. Eficiencia Energetica: La eficiencia mide cuanta energia de entrada se convierte en trabajo util. Ningun proceso es 100% eficiente — siempre hay perdidas. La segunda ley de la termodinamica lo garantiza.\n3. Perdidas en Cadena: Las cadenas de conversion acumulan perdidas. Si cada paso es 90% eficiente, tres pasos dan 0.9³ = 73% eficiencia total. Menos conversiones significa menos perdidas.\n4. Costo del Almacenamiento: El almacenamiento de energia tiene su propio costo energetico. Cargar y descargar baterias pierde energia. Bombear agua cuesta arriba para hidroelectrica tambien. El almacenamiento no es gratis.\n5. Densidad Energetica: La densidad energetica importa. Combustibles fosiles almacenan mucha energia por kilogramo. Las baterias almacenan menos. Esto afecta que es practico para cada aplicacion."
    }
  ],
  "taskId": "activity-challenge"
}
