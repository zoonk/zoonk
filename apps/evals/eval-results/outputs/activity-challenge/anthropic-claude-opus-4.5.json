{
  "generatedAt": "2026-01-17T19:38:57.621Z",
  "modelId": "anthropic/claude-opus-4.5",
  "outputs": [
    {
      "duration": 46702.943417,
      "inputTokens": 2762,
      "output": "{\n  \"intro\": \"{{NAME}}, welcome to your first week at StreamScale, a video streaming startup. We're rebuilding our recommendation engine, and every choice you make will affect millions of users. Our infrastructure is modest, our deadlines are tight, and the CEO watches our metrics like a hawk. Ready to make some tough calls?\",\n  \"reflection\": \"There's rarely a perfect algorithm — only the right algorithm for your constraints. You navigated trade-offs between time and space, worst-case safety and average-case speed, memory costs and computation costs. The best engineers don't memorize solutions; they analyze constraints and choose deliberately. Understanding complexity isn't about finding the 'fastest' option — it's about knowing what you're trading away.\",\n  \"steps\": [\n    {\n      \"context\": \"Hey {{NAME}}, glad you're here! So our recommendation engine needs to check if a user has already watched a video before suggesting it. We're talking 50 million users, each with thousands of watched videos. We could store watch history in a sorted list and binary search, or use a hash set. What's your call?\",\n      \"options\": [\n        {\n          \"consequence\": \"The hash set delivers instant lookups and recommendations feel snappy. But memory usage spiked 40%. Finance is asking questions about our AWS bill, and we're now storing redundant data across services.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Response Time\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Memory Usage\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Infrastructure Cost\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Use hash sets — O(1) lookup is worth the memory\"\n        },\n        {\n          \"consequence\": \"Memory stays lean and costs are controlled. But with thousands of videos per user, even O(log n) adds up. Recommendation latency increased noticeably during peak hours.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Response Time\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Memory Usage\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Infrastructure Cost\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Use sorted lists with binary search — save that memory\"\n        },\n        {\n          \"consequence\": \"Smart compromise! Active users get fast lookups, and we're not paying to keep casual viewers' data in expensive hash structures. Implementation took longer, but metrics look balanced.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Response Time\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Memory Usage\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Code Complexity\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Hybrid approach — hash sets for active users, sorted lists for others\"\n        }\n      ],\n      \"question\": \"How should we store and search watch history?\"\n    },\n    {\n      \"context\": \"{{NAME}}, we've got a problem. Our trending videos algorithm sorts view counts every minute. The data is almost sorted since counts change incrementally. Quicksort is fast on average, but I'm worried about worst-case scenarios. Should we switch to merge sort for guaranteed O(n log n)?\",\n      \"options\": [\n        {\n          \"consequence\": \"Rock solid performance — no surprises during traffic spikes. But merge sort's extra memory allocation is causing garbage collection pauses. Users notice the micro-stutters.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Response Time\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Memory Usage\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"System Stability\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Switch to merge sort — predictability matters\"\n        },\n        {\n          \"consequence\": \"Blazing fast on our nearly-sorted data! Until a viral video reshuffled everything and quicksort hit its worst case. The trending page froze for 8 seconds during prime time.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Response Time\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Memory Usage\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"System Stability\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Keep quicksort — average case is what matters\"\n        },\n        {\n          \"consequence\": \"Best of both worlds for this use case. Insertion sort flies through nearly-sorted data, and quicksort handles the rare chaos. Took extra time to tune the threshold, but worth it.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Response Time\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Memory Usage\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Code Complexity\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Use hybrid timsort — optimized for nearly-sorted data\"\n        }\n      ],\n      \"question\": \"What sorting strategy should we use?\"\n    },\n    {\n      \"context\": \"Our video cache is getting hammered, {{NAME}}. We need an eviction policy. LRU cache gives us O(1) operations but needs a hash map plus doubly-linked list. Simple FIFO queue is lighter but might evict popular videos. What do you think?\",\n      \"options\": [\n        {\n          \"consequence\": \"Cache hit rates are excellent — popular videos stay cached. But the dual data structure doubled our cache metadata overhead. We're caching fewer videos than before.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Response Time\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Memory Usage\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Code Complexity\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"LRU cache — keep the popular content ready\"\n        },\n        {\n          \"consequence\": \"Simple and memory-efficient. But our most-watched show got evicted right before everyone's evening binge. Cache misses spiked and the CDN bill hurt.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Response Time\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Memory Usage\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Infrastructure Cost\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"FIFO queue — simple and lightweight\"\n        },\n        {\n          \"consequence\": \"Smart shortcut! The sampling adds slight overhead but catches most hot content. Occasionally a trending video slips through, but the trade-off works for our scale.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Response Time\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Memory Usage\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"System Stability\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Approximate LRU with sampling — good enough, less overhead\"\n        }\n      ],\n      \"question\": \"Which cache eviction strategy should we implement?\"\n    },\n    {\n      \"context\": \"{{NAME}}, users are complaining about slow search. Our trie-based autocomplete uses a lot of memory. Someone suggested switching to binary search on a sorted array of terms. Another option is compressing the trie. Thoughts?\",\n      \"options\": [\n        {\n          \"consequence\": \"Memory dropped 60%! But autocomplete now takes 50ms instead of 5ms. Users type faster than we can suggest, and engagement metrics are slipping.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Response Time\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Memory Usage\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"User Engagement\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Binary search — memory is our bottleneck\"\n        },\n        {\n          \"consequence\": \"Memory down 40% with minimal speed impact. But debugging compressed structures is a nightmare. Last week's bug took three days to trace through the optimized code.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Response Time\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Memory Usage\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Code Complexity\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Compressed trie — best of both worlds\"\n        },\n        {\n          \"consequence\": \"Instant suggestions keep users engaged and searching more. But we had to upgrade our server tier to handle the memory load. The feature pays for itself... barely.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Response Time\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Memory Usage\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"User Engagement\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Keep the trie — user experience is worth the memory\"\n        }\n      ],\n      \"question\": \"How do we fix the autocomplete performance?\"\n    },\n    {\n      \"context\": \"Final call, {{NAME}}. We're building a feature to find 'users who watched similar videos.' We can precompute all similarity scores nightly with O(n²) time but O(n²) space, or compute on-demand with less storage. Our user base is growing fast.\",\n      \"options\": [\n        {\n          \"consequence\": \"Recommendations are instant and users love it. But storage costs are growing quadratically with users. At this rate, we'll need a data architecture overhaul in six months.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Response Time\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Infrastructure Cost\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"System Stability\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Precompute everything — speed wins\"\n        },\n        {\n          \"consequence\": \"Storage stays linear and manageable. But computing similarities on each request adds 200ms latency. Users scroll past recommendations before they load.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Response Time\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Infrastructure Cost\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"User Engagement\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Compute on-demand — storage costs will kill us\"\n        },\n        {\n          \"consequence\": \"Clever amortization! Popular pairs are instant, rare combinations take longer. Occasionally users see 'loading' for niche recommendations, but overall experience is solid.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Response Time\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Infrastructure Cost\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Code Complexity\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Cache hot pairs, compute cold pairs on-demand\"\n        }\n      ],\n      \"question\": \"How should we handle similarity computations?\"\n    }\n  ]\n}",
      "outputTokens": 1900,
      "systemPrompt": "# Role\n\nYou are an expert educational game designer creating a **Challenge** activity for a learning app. Your mission is to design a choose-your-own-adventure scenario where learners make strategic decisions with meaningful consequences, using the lesson's concepts.\n\nYou specialize in crafting narrative experiences that test strategic thinking — not knowledge recall, but the ability to apply concepts and understand trade-offs.\n\n# Why Narrative Challenges Work\n\nGreat challenges don't quiz — they immerse. Learners face realistic scenarios where every choice has consequences. They experience trade-offs firsthand, making the lesson's principles memorable.\n\n- **No \"Right Answer\"**: Every option has pros and cons. Learners engage with WHY, not just WHAT.\n- **Consequences Over Scores**: Instead of winning or losing, learners see the natural results of their choices.\n- **Strategic Thinking**: Understanding the lesson helps navigate trade-offs, but different strategies lead to different outcomes.\n\n# Inputs\n\n- `LESSON_TITLE`: The topic to create a challenge around\n- `LESSON_DESCRIPTION`: Additional context about what this lesson covers\n- `CHAPTER_TITLE`: The chapter context (for understanding scope)\n- `COURSE_TITLE`: The course context (for understanding audience level)\n- `LANGUAGE`: Output language\n- `EXPLANATION_STEPS`: What the learner has already studied\n\n## Language Guidelines\n\n- `en`: Use US English unless the content is region-specific\n- `pt`: Use Brazilian Portuguese unless the content is region-specific\n- `es`: Use Latin American Spanish unless the content is region-specific\n\n# Requirements\n\n## Introduction\n\nThe `intro` field sets the scene (max 500 characters). It should:\n\n- Establish the scenario and the learner's role\n- Explain what they're navigating (a project, situation, decision-making process)\n- Create stakes that feel meaningful\n- Use `{{NAME}}` to personalize\n\n## Steps\n\nCreate 4-6 steps. Each step presents a decision point with 3-4 options.\n\n### Step Structure\n\n- **context**: Maximum 500 characters. Pure dialogue from a colleague setting up the decision. Conversational, no narrator.\n- **question**: Maximum 100 characters. What needs to be decided.\n- **options**: 3-4 choices, each with:\n  - **text**: The choice (max 80 characters)\n  - **consequence**: What happens as a result (max 300 characters). Shown after choosing. Explains the outcome narratively.\n  - **effects**: Array of 1-3 effects showing how this choice impacts different aspects:\n    - **dimension**: A short name for what this affects (e.g., \"Code Quality\", \"Delivery Speed\", \"Team Morale\"). Use 2-4 different dimensions across all options to create meaningful trade-offs. Important: dimensions must be consistent across all steps.\n    - **impact**: Is this `\"positive\"`, `\"neutral\"`, or `\"negative\"` for that dimension?\n\n### Option Design\n\nEvery option should:\n\n- Be a legitimate choice (no obviously wrong answers)\n- Have a clear consequence that connects to lesson concepts\n- Affect 1-3 dimensions (real decisions rarely affect just one thing)\n- Teach something about trade-offs when the consequence is revealed\n\n**No option should be universally best.** Good options might help one dimension but hurt another. This creates genuine trade-offs.\n\n## Reflection\n\nThe `reflection` field (max 500 characters) provides closing insight after all steps. It should:\n\n- Acknowledge that different approaches have merit\n- Connect the experience back to the lesson's key principles\n- Help learners understand how the concepts apply in practice\n\n## Tone & Style\n\n- **Pure dialogue**: NO narrator, NO character prefixes, NO action descriptions\n- **Natural conversation**: Colleagues working through a problem together\n- **Professional but warm**: Light humor when appropriate\n- **Second-person immersion**: The colleague speaks TO the learner\n- **Use `{{NAME}}`** to personalize dialogue\n\n## What to Avoid\n\n- **Quiz-style questions**: This tests strategic thinking, not recall\n- **Obviously correct answers**: Every option should have genuine trade-offs\n- **Narrator text**: Keep it pure dialogue in context\n- **Disconnected consequences**: Consequences should relate to lesson concepts\n- **Too many or too few dimensions**: Use 2-4 different dimension names across all effects for meaningful trade-offs\n\n## Relationship to Previous Activities\n\nThe learner has completed:\n\n- **Background**: WHY this exists\n- **Explanation**: WHAT it is\n- **Mechanics**: HOW it works\n- **Examples**: WHERE it appears\n- **Story**: WHEN to apply this\n\nYour Challenge activity is the capstone: **CAN YOU NAVIGATE THIS?** It tests whether learners can apply concepts strategically. This should feel like a meaningful simulation, not a test.\n\n# Example\n\nFor a lesson on \"Technical Debt\":\n\n**Step 1:**\n\n```json\n{\n  \"context\": \"{{NAME}}, we've got a deadline crunch. The feature works but the code is messy. Ship it now or clean it up first?\",\n  \"question\": \"How do we handle this?\",\n  \"options\": [\n    {\n      \"text\": \"Ship it now, refactor later\",\n      \"consequence\": \"Feature launched on time! But the messy code made the next sprint's work harder. The team spent extra hours untangling dependencies.\",\n      \"effects\": [\n        { \"dimension\": \"Code Quality\", \"impact\": \"negative\" },\n        { \"dimension\": \"Delivery Speed\", \"impact\": \"positive\" }\n      ]\n    },\n    {\n      \"text\": \"Take two more days to refactor\",\n      \"consequence\": \"The code is clean and maintainable. Stakeholders weren't thrilled about the delay, but future changes will be much easier.\",\n      \"effects\": [\n        { \"dimension\": \"Code Quality\", \"impact\": \"positive\" },\n        { \"dimension\": \"Delivery Speed\", \"impact\": \"negative\" }\n      ]\n    },\n    {\n      \"text\": \"Split the team — half ships, half refactors\",\n      \"consequence\": \"Shipped on time with partial cleanup. Neither task got full attention, and the team felt stretched thin.\",\n      \"effects\": [\n        { \"dimension\": \"Code Quality\", \"impact\": \"neutral\" },\n        { \"dimension\": \"Team Morale\", \"impact\": \"negative\" }\n      ]\n    }\n  ]\n}\n```\n\n# Quality Checks\n\nBefore finalizing, verify:\n\n- [ ] Does the intro establish a clear, engaging scenario?\n- [ ] Does every option have a meaningful consequence?\n- [ ] Are consequences connected to lesson principles?\n- [ ] Is there no obviously \"best\" option in each step?\n- [ ] Do options affect multiple dimensions where realistic?\n- [ ] Are dimension names consistent and lesson-relevant across all effects?\n- [ ] Is `{{NAME}}` used appropriately?\n- [ ] Is all dialogue pure conversation (no narrator)?\n- [ ] Does the reflection tie the experience back to the lesson?\n- [ ] Are all constraints met (intro ≤500, context ≤500, question ≤100, text ≤80, consequence ≤300, reflection ≤500)?\n- [ ] Is the step count between 4 and 6?\n- [ ] Does every step have 3-4 options?\n\n# Output Format\n\nReturn an object with:\n\n- **intro**: Scenario introduction (max 500 chars)\n- **steps**: Array of 4-6 step objects, each with:\n  - **context**: Pure dialogue (max 500 chars)\n  - **question**: Decision prompt (max 100 chars)\n  - **options**: Array of 3-4 objects with:\n    - **text**: Choice description (max 80 chars)\n    - **consequence**: What happens (max 300 chars)\n    - **effects**: Array of 1-3 objects with:\n      - **dimension**: Short name for what this affects (use 2-4 different dimensions total)\n      - **impact**: One of \"positive\", \"neutral\", \"negative\"\n- **reflection**: Closing insight connecting to lesson (max 500 chars)\n",
      "testCaseId": "en-cs-algorithm-complexity-1",
      "userPrompt": "LESSON_TITLE: Algorithm Complexity Trade-offs\nLESSON_DESCRIPTION: Understanding and applying algorithm complexity analysis to make informed trade-offs in software design\nCHAPTER_TITLE: Algorithm Analysis\nCOURSE_TITLE: Data Structures and Algorithms\nLANGUAGE: en\nEXPLANATION_STEPS:\n1. Time Complexity: Time complexity measures how execution time grows with input size. O(n) means linear growth — double the input, double the time. O(n²) means quadratic — double the input, quadruple the time.\n2. Space Complexity: Space complexity measures memory usage growth. Some algorithms trade time for space — storing precomputed results to avoid recalculation. Others trade space for time — using less memory but computing more.\n3. Time-Space Trade-off: The time-space trade-off is fundamental. Hash tables give O(1) lookup but use extra memory. Binary search uses O(1) space but requires sorted data. Choose based on constraints.\n4. Amortized Analysis: Amortized analysis looks at average performance over many operations. ArrayList append is usually O(1), but occasionally O(n) when resizing. Amortized, it's still O(1).\n5. Case Analysis: Best, average, and worst case can differ dramatically. Quicksort averages O(n log n) but worst-cases to O(n²). Know your data distribution to choose wisely."
    },
    {
      "duration": 46986.00658300001,
      "inputTokens": 2728,
      "output": "{\n  \"intro\": \"{{NAME}}, welcome to your first week as Pricing Manager at Northwind Coffee Roasters. We're a mid-sized specialty coffee company facing some tough market decisions. Our CEO wants fresh thinking on pricing strategy, and you'll be making calls that affect everything from revenue to customer loyalty. The coffee market is competitive, and every decision has trade-offs. Let's see how you navigate this.\",\n  \"reflection\": \"There's rarely a perfect pricing decision — only trade-offs you're willing to accept. Understanding demand elasticity helped you predict customer reactions. Recognizing equilibrium dynamics showed when to hold firm versus adapt. Distinguishing between shifts and movements revealed what you could control. The best strategists don't just know these principles — they weigh them against real business constraints like brand positioning and competitive pressure.\",\n  \"steps\": [\n    {\n      \"context\": \"Hey {{NAME}}, glad you're here! So our flagship Ethiopian blend is selling well, but costs just jumped 15% due to shipping. Finance says we need to pass it on to customers. Marketing thinks our loyal customers will revolt. Our blend has a pretty loyal following — people don't switch easily once they love a coffee. What's your read on this?\",\n      \"options\": [\n        {\n          \"consequence\": \"Sales volume barely dipped — just 3%. Your loyal customers grumbled but kept buying. Revenue actually increased, though a few vocal critics hit social media.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Revenue\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Brand Perception\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Raise prices to cover the full cost increase\"\n        },\n        {\n          \"consequence\": \"You absorbed some margin hit, but customers appreciated the restraint. Competitors who raised prices fully lost some customers to you.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Revenue\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Customer Loyalty\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Raise prices halfway and absorb some costs\"\n        },\n        {\n          \"consequence\": \"Margins are squeezed tight now. Finance is concerned about sustainability, but your customer base stayed completely intact and even grew slightly.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Revenue\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Customer Loyalty\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Market Share\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Hold prices steady and find other cost savings\"\n        }\n      ],\n      \"question\": \"How should we handle the cost increase?\"\n    },\n    {\n      \"context\": \"Interesting development, {{NAME}}. A big grocery chain wants to carry our coffee, but they're demanding we sell to them at 40% below our retail price. That's barely above our cost. They're saying the volume will make up for it. We'd reach thousands of new customers, but our specialty cafés that currently stock us are nervous about being undercut.\",\n      \"options\": [\n        {\n          \"consequence\": \"Volume exploded — you're moving three times the product. But two specialty café partners dropped you, saying they can't compete. Your brand is now seen as more mainstream.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Market Share\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Brand Perception\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Revenue\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Take the deal — volume matters for growth\"\n        },\n        {\n          \"consequence\": \"The chain accepted a smaller discount. You kept your café partners happy, though the chain is giving you less shelf space than they offered originally.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Revenue\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Customer Loyalty\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Market Share\",\n              \"impact\": \"neutral\"\n            }\n          ],\n          \"text\": \"Negotiate for a smaller discount with limited SKUs\"\n        },\n        {\n          \"consequence\": \"Your specialty partners are thrilled with your loyalty. But you're watching competitors gain mainstream visibility while you stay niche. Growth is slower but margins are strong.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Brand Perception\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Market Share\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Revenue\",\n              \"impact\": \"neutral\"\n            }\n          ],\n          \"text\": \"Decline — protect our premium positioning\"\n        }\n      ],\n      \"question\": \"Should we partner with the grocery chain?\"\n    },\n    {\n      \"context\": \"{{NAME}}, we've got a curveball. A new study just came out linking coffee consumption to health benefits — it's all over the news. Demand for specialty coffee is surging across the industry. Our competitors are raising prices. We could do the same, or we could try to capture market share while everyone else gets greedy. What's the move?\",\n      \"options\": [\n        {\n          \"consequence\": \"Revenue per bag jumped nicely. You're riding the demand wave like everyone else. But when the hype fades, you'll need to justify the higher price point.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Revenue\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Customer Loyalty\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Raise prices while demand is hot\"\n        },\n        {\n          \"consequence\": \"New customers flooded in while competitors got more expensive. You gained significant market share. Margins are thinner but your customer base grew substantially.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Market Share\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Revenue\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Customer Loyalty\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Hold prices and capture new customers\"\n        },\n        {\n          \"consequence\": \"The bundle flew off shelves — new customers tried multiple products. It was operationally complex, but you converted casual buyers into loyal fans.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Market Share\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Revenue\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Brand Perception\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Create a limited bundle deal to attract first-timers\"\n        }\n      ],\n      \"question\": \"How do we respond to the demand surge?\"\n    },\n    {\n      \"context\": \"Okay {{NAME}}, here's a tricky one. Our cold brew line has been underperforming. We priced it premium like our hot coffee, but sales are weak. Research shows cold brew buyers are way more price-sensitive than our regular customers — they'll switch brands over a dollar. Should we reposition?\",\n      \"options\": [\n        {\n          \"consequence\": \"Cold brew sales tripled almost overnight. You're now competing on volume, but margins are razor-thin and you've trained customers to expect low prices.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Market Share\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Revenue\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Brand Perception\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Drop prices significantly to match demand elasticity\"\n        },\n        {\n          \"consequence\": \"Sales improved moderately. The rebranding cost money upfront, but you maintained premium positioning. Some price-sensitive buyers still went elsewhere.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Revenue\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Brand Perception\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Market Share\",\n              \"impact\": \"neutral\"\n            }\n          ],\n          \"text\": \"Moderate price cut with new budget-friendly branding\"\n        },\n        {\n          \"consequence\": \"You discontinued a struggling product line. Resources shifted to your strengths. Some wondered if you gave up too easily, but focus improved.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Revenue\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Brand Perception\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Market Share\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Kill the cold brew line and focus on our strengths\"\n        }\n      ],\n      \"question\": \"What do we do about cold brew?\"\n    },\n    {\n      \"context\": \"{{NAME}}, end of quarter reality check. A major competitor just slashed prices 20% across the board — they're clearly trying to grab market share. Our sales team is panicking, saying we'll lose customers if we don't match. But our CFO warns that a price war could hurt everyone's margins for years. The market feels unstable right now.\",\n      \"options\": [\n        {\n          \"consequence\": \"You matched their prices and kept most customers, but margins collapsed. Both companies are now stuck in a low-price equilibrium that's hard to escape.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Market Share\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Revenue\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Customer Loyalty\",\n              \"impact\": \"neutral\"\n            }\n          ],\n          \"text\": \"Match their prices — we can't lose customers\"\n        },\n        {\n          \"consequence\": \"You lost some price-sensitive customers short-term. But your quality messaging resonated with your core base, and your margins stayed healthy.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Market Share\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Revenue\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Brand Perception\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Hold firm and emphasize quality differentiation\"\n        },\n        {\n          \"consequence\": \"Loyal customers felt rewarded and stayed. New customer acquisition slowed, but you avoided the race to the bottom while keeping your base intact.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Customer Loyalty\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Market Share\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Revenue\",\n              \"impact\": \"neutral\"\n            }\n          ],\n          \"text\": \"Selective discounts only for existing loyal customers\"\n        }\n      ],\n      \"question\": \"How do we respond to the competitor's price war?\"\n    }\n  ]\n}",
      "outputTokens": 1833,
      "systemPrompt": "# Role\n\nYou are an expert educational game designer creating a **Challenge** activity for a learning app. Your mission is to design a choose-your-own-adventure scenario where learners make strategic decisions with meaningful consequences, using the lesson's concepts.\n\nYou specialize in crafting narrative experiences that test strategic thinking — not knowledge recall, but the ability to apply concepts and understand trade-offs.\n\n# Why Narrative Challenges Work\n\nGreat challenges don't quiz — they immerse. Learners face realistic scenarios where every choice has consequences. They experience trade-offs firsthand, making the lesson's principles memorable.\n\n- **No \"Right Answer\"**: Every option has pros and cons. Learners engage with WHY, not just WHAT.\n- **Consequences Over Scores**: Instead of winning or losing, learners see the natural results of their choices.\n- **Strategic Thinking**: Understanding the lesson helps navigate trade-offs, but different strategies lead to different outcomes.\n\n# Inputs\n\n- `LESSON_TITLE`: The topic to create a challenge around\n- `LESSON_DESCRIPTION`: Additional context about what this lesson covers\n- `CHAPTER_TITLE`: The chapter context (for understanding scope)\n- `COURSE_TITLE`: The course context (for understanding audience level)\n- `LANGUAGE`: Output language\n- `EXPLANATION_STEPS`: What the learner has already studied\n\n## Language Guidelines\n\n- `en`: Use US English unless the content is region-specific\n- `pt`: Use Brazilian Portuguese unless the content is region-specific\n- `es`: Use Latin American Spanish unless the content is region-specific\n\n# Requirements\n\n## Introduction\n\nThe `intro` field sets the scene (max 500 characters). It should:\n\n- Establish the scenario and the learner's role\n- Explain what they're navigating (a project, situation, decision-making process)\n- Create stakes that feel meaningful\n- Use `{{NAME}}` to personalize\n\n## Steps\n\nCreate 4-6 steps. Each step presents a decision point with 3-4 options.\n\n### Step Structure\n\n- **context**: Maximum 500 characters. Pure dialogue from a colleague setting up the decision. Conversational, no narrator.\n- **question**: Maximum 100 characters. What needs to be decided.\n- **options**: 3-4 choices, each with:\n  - **text**: The choice (max 80 characters)\n  - **consequence**: What happens as a result (max 300 characters). Shown after choosing. Explains the outcome narratively.\n  - **effects**: Array of 1-3 effects showing how this choice impacts different aspects:\n    - **dimension**: A short name for what this affects (e.g., \"Code Quality\", \"Delivery Speed\", \"Team Morale\"). Use 2-4 different dimensions across all options to create meaningful trade-offs. Important: dimensions must be consistent across all steps.\n    - **impact**: Is this `\"positive\"`, `\"neutral\"`, or `\"negative\"` for that dimension?\n\n### Option Design\n\nEvery option should:\n\n- Be a legitimate choice (no obviously wrong answers)\n- Have a clear consequence that connects to lesson concepts\n- Affect 1-3 dimensions (real decisions rarely affect just one thing)\n- Teach something about trade-offs when the consequence is revealed\n\n**No option should be universally best.** Good options might help one dimension but hurt another. This creates genuine trade-offs.\n\n## Reflection\n\nThe `reflection` field (max 500 characters) provides closing insight after all steps. It should:\n\n- Acknowledge that different approaches have merit\n- Connect the experience back to the lesson's key principles\n- Help learners understand how the concepts apply in practice\n\n## Tone & Style\n\n- **Pure dialogue**: NO narrator, NO character prefixes, NO action descriptions\n- **Natural conversation**: Colleagues working through a problem together\n- **Professional but warm**: Light humor when appropriate\n- **Second-person immersion**: The colleague speaks TO the learner\n- **Use `{{NAME}}`** to personalize dialogue\n\n## What to Avoid\n\n- **Quiz-style questions**: This tests strategic thinking, not recall\n- **Obviously correct answers**: Every option should have genuine trade-offs\n- **Narrator text**: Keep it pure dialogue in context\n- **Disconnected consequences**: Consequences should relate to lesson concepts\n- **Too many or too few dimensions**: Use 2-4 different dimension names across all effects for meaningful trade-offs\n\n## Relationship to Previous Activities\n\nThe learner has completed:\n\n- **Background**: WHY this exists\n- **Explanation**: WHAT it is\n- **Mechanics**: HOW it works\n- **Examples**: WHERE it appears\n- **Story**: WHEN to apply this\n\nYour Challenge activity is the capstone: **CAN YOU NAVIGATE THIS?** It tests whether learners can apply concepts strategically. This should feel like a meaningful simulation, not a test.\n\n# Example\n\nFor a lesson on \"Technical Debt\":\n\n**Step 1:**\n\n```json\n{\n  \"context\": \"{{NAME}}, we've got a deadline crunch. The feature works but the code is messy. Ship it now or clean it up first?\",\n  \"question\": \"How do we handle this?\",\n  \"options\": [\n    {\n      \"text\": \"Ship it now, refactor later\",\n      \"consequence\": \"Feature launched on time! But the messy code made the next sprint's work harder. The team spent extra hours untangling dependencies.\",\n      \"effects\": [\n        { \"dimension\": \"Code Quality\", \"impact\": \"negative\" },\n        { \"dimension\": \"Delivery Speed\", \"impact\": \"positive\" }\n      ]\n    },\n    {\n      \"text\": \"Take two more days to refactor\",\n      \"consequence\": \"The code is clean and maintainable. Stakeholders weren't thrilled about the delay, but future changes will be much easier.\",\n      \"effects\": [\n        { \"dimension\": \"Code Quality\", \"impact\": \"positive\" },\n        { \"dimension\": \"Delivery Speed\", \"impact\": \"negative\" }\n      ]\n    },\n    {\n      \"text\": \"Split the team — half ships, half refactors\",\n      \"consequence\": \"Shipped on time with partial cleanup. Neither task got full attention, and the team felt stretched thin.\",\n      \"effects\": [\n        { \"dimension\": \"Code Quality\", \"impact\": \"neutral\" },\n        { \"dimension\": \"Team Morale\", \"impact\": \"negative\" }\n      ]\n    }\n  ]\n}\n```\n\n# Quality Checks\n\nBefore finalizing, verify:\n\n- [ ] Does the intro establish a clear, engaging scenario?\n- [ ] Does every option have a meaningful consequence?\n- [ ] Are consequences connected to lesson principles?\n- [ ] Is there no obviously \"best\" option in each step?\n- [ ] Do options affect multiple dimensions where realistic?\n- [ ] Are dimension names consistent and lesson-relevant across all effects?\n- [ ] Is `{{NAME}}` used appropriately?\n- [ ] Is all dialogue pure conversation (no narrator)?\n- [ ] Does the reflection tie the experience back to the lesson?\n- [ ] Are all constraints met (intro ≤500, context ≤500, question ≤100, text ≤80, consequence ≤300, reflection ≤500)?\n- [ ] Is the step count between 4 and 6?\n- [ ] Does every step have 3-4 options?\n\n# Output Format\n\nReturn an object with:\n\n- **intro**: Scenario introduction (max 500 chars)\n- **steps**: Array of 4-6 step objects, each with:\n  - **context**: Pure dialogue (max 500 chars)\n  - **question**: Decision prompt (max 100 chars)\n  - **options**: Array of 3-4 objects with:\n    - **text**: Choice description (max 80 chars)\n    - **consequence**: What happens (max 300 chars)\n    - **effects**: Array of 1-3 objects with:\n      - **dimension**: Short name for what this affects (use 2-4 different dimensions total)\n      - **impact**: One of \"positive\", \"neutral\", \"negative\"\n- **reflection**: Closing insight connecting to lesson (max 500 chars)\n",
      "testCaseId": "en-economics-supply-demand-1",
      "userPrompt": "LESSON_TITLE: Supply and Demand in Practice\nLESSON_DESCRIPTION: Applying supply and demand principles to make strategic pricing and market decisions\nCHAPTER_TITLE: Market Dynamics\nCOURSE_TITLE: Microeconomics Fundamentals\nLANGUAGE: en\nEXPLANATION_STEPS:\n1. The Demand Curve: Demand curves slope downward — as price rises, quantity demanded falls. This reflects the law of demand: people buy less when things cost more, all else equal.\n2. The Supply Curve: Supply curves slope upward — as price rises, quantity supplied increases. Higher prices incentivize producers to make more. Lower prices make production less worthwhile.\n3. Market Equilibrium: Equilibrium occurs where supply meets demand. At this price, quantity supplied equals quantity demanded. Prices above equilibrium create surplus; prices below create shortage.\n4. Price Elasticity: Price elasticity measures responsiveness to price changes. Elastic demand (>1) means sales drop sharply with price increases. Inelastic demand (<1) means sales barely change.\n5. Shifts vs. Movements: Shifts vs. movements: A change in price moves along the curve. Changes in other factors (income, preferences, costs) shift the entire curve. This distinction is crucial."
    },
    {
      "duration": 46141.134541999956,
      "inputTokens": 2741,
      "output": "{\n  \"intro\": \"{{NAME}}, welcome to your first week as the new ecosystem manager at Clearwater Valley Nature Reserve. This 5,000-acre protected area has been struggling with imbalances from past management decisions. The board expects you to stabilize the ecosystem while keeping stakeholders happy. Every choice you make will ripple through the food web.\",\n  \"reflection\": \"Ecosystem management is never about finding perfect solutions — it's about understanding trade-offs. Every intervention affects multiple species through food webs and trophic cascades. Sometimes quick fixes create long-term problems; sometimes patience tests stakeholder confidence. The key is recognizing that ecosystems are interconnected networks where your decisions at one level ripple through all others.\",\n  \"steps\": [\n    {\n      \"context\": \"{{NAME}}, we've got a deer problem. Population's nearly double the carrying capacity. They're stripping vegetation bare, and songbird nesting habitat is disappearing. Hunters want permits opened up immediately. Conservation groups want natural predator reintroduction. The board wants results before the annual review.\",\n      \"options\": [\n        {\n          \"consequence\": \"Deer numbers dropped fast, vegetation is recovering. But the sudden population crash stressed the remaining deer, and some hunters took non-target animals. Songbirds are slowly returning.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Ecosystem Balance\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Stakeholder Relations\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Long-term Stability\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Expand hunting permits for immediate population control\"\n        },\n        {\n          \"consequence\": \"A wolf pack was released. Deer behavior changed immediately — they avoid open meadows now. Vegetation is recovering in those areas, but local ranchers are furious about livestock risks.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Ecosystem Balance\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Stakeholder Relations\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Long-term Stability\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Begin a wolf reintroduction program\"\n        },\n        {\n          \"consequence\": \"Progress is slow but steady. The deer are gradually declining as food becomes scarce. Some board members are questioning whether you're being decisive enough.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Ecosystem Balance\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Stakeholder Relations\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Long-term Stability\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Let natural resource limits reduce the population over time\"\n        }\n      ],\n      \"question\": \"How should we address the deer overpopulation?\"\n    },\n    {\n      \"context\": \"Interesting development, {{NAME}}. The beaver population is exploding now that vegetation along streams is recovering. Their dams are creating wetlands, which is great for biodiversity, but they're flooding a popular hiking trail and some adjacent farmland.\",\n      \"options\": [\n        {\n          \"consequence\": \"The wetlands are thriving — new amphibian species spotted, waterfowl moving in. But three farms filed complaints with the county, and the trail closure frustrated regular visitors.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Biodiversity\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Stakeholder Relations\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Long-term Stability\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Let the beavers continue — wetlands increase biodiversity\"\n        },\n        {\n          \"consequence\": \"Flood damage stopped immediately. Farmers are relieved. But you've lost a keystone species' engineering work, and the downstream areas are already showing reduced water retention.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Biodiversity\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Stakeholder Relations\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Long-term Stability\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Relocate beavers to minimize human-wildlife conflict\"\n        },\n        {\n          \"consequence\": \"Installed flow devices that maintain pond levels without flooding. Expensive, but both ecosystems and neighbors are functioning. Maintenance will be ongoing.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Biodiversity\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Stakeholder Relations\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Ecosystem Balance\",\n              \"impact\": \"neutral\"\n            }\n          ],\n          \"text\": \"Install flow devices to control water levels while keeping beavers\"\n        }\n      ],\n      \"question\": \"What's our approach to the beaver situation?\"\n    },\n    {\n      \"context\": \"{{NAME}}, the eastern meadow hasn't been burned in fifteen years. It's transitioning to forest — woody shrubs everywhere. The meadow-dependent species like ground-nesting birds and native grasses are declining. But the emerging forest supports different species. Some researchers want the meadow preserved; others say let succession proceed.\",\n      \"options\": [\n        {\n          \"consequence\": \"Fire cleared the shrubs beautifully. Meadow species are rebounding, but we lost three years of oak sapling growth and the species that had colonized the transitional habitat.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Biodiversity\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Ecosystem Balance\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Long-term Stability\",\n              \"impact\": \"neutral\"\n            }\n          ],\n          \"text\": \"Conduct a prescribed burn to reset succession\"\n        },\n        {\n          \"consequence\": \"The meadow is now young forest. Ground-nesting birds relocated or disappeared, but we're seeing new woodland species. The ecosystem shifted, not collapsed — just became something different.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Biodiversity\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Ecosystem Balance\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Long-term Stability\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Allow natural succession to continue toward forest\"\n        },\n        {\n          \"consequence\": \"You've created habitat diversity — meadow core, forest edge, transitional zones. Managing three habitats is complex, but species richness across the area increased significantly.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Biodiversity\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Ecosystem Balance\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Long-term Stability\",\n              \"impact\": \"neutral\"\n            }\n          ],\n          \"text\": \"Create a mosaic — burn some sections, let others succeed\"\n        }\n      ],\n      \"question\": \"What should we do with the transitioning meadow?\"\n    },\n    {\n      \"context\": \"Bad news. An invasive plant species is spreading along the creek — Japanese knotweed. It's outcompeting native riparian plants, and our native insects can't eat it. Complete eradication would require herbicides near water. Mechanical removal is labor-intensive and often fails.\",\n      \"options\": [\n        {\n          \"consequence\": \"Knotweed is dying back, but so is everything else within the spray zone. The creek's insect populations crashed temporarily. Native plants are slowly recolonizing the bare ground.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Ecosystem Balance\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Biodiversity\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Long-term Stability\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Apply targeted herbicides to eradicate it quickly\"\n        },\n        {\n          \"consequence\": \"You're controlling spread but not winning. Volunteer fatigue is setting in, and knotweed keeps resprouting from root fragments. It's a holding action at best.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Ecosystem Balance\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Stakeholder Relations\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Long-term Stability\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Organize volunteer crews for ongoing mechanical removal\"\n        },\n        {\n          \"consequence\": \"The goats love knotweed. It's being suppressed effectively, and you've created an educational attraction. But goats are also eating some native plants you'd prefer they didn't.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Ecosystem Balance\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Biodiversity\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Stakeholder Relations\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Introduce grazing goats as biological control\"\n        }\n      ],\n      \"question\": \"How do we handle the invasive knotweed?\"\n    },\n    {\n      \"context\": \"{{NAME}}, here's a tricky one. A rare native orchid colony was discovered in the old-growth section. Botanists want to protect it strictly — no public access. But that section has our most popular trail, and closing it would hurt visitor numbers and educational programs.\",\n      \"options\": [\n        {\n          \"consequence\": \"Orchid population is thriving and expanding. But trail closure dropped visitor numbers 30%, and the education team lost their best outdoor classroom. Funding conversations are getting harder.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Biodiversity\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Stakeholder Relations\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Long-term Stability\",\n              \"impact\": \"neutral\"\n            }\n          ],\n          \"text\": \"Close the area to protect the orchid colony\"\n        },\n        {\n          \"consequence\": \"Orchids are surviving but not thriving — foot traffic compacted soil nearby, and one clump was accidentally trampled. Visitors love the new viewing platform though.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Biodiversity\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Stakeholder Relations\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Ecosystem Balance\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Reroute the trail with viewing platforms for the orchids\"\n        },\n        {\n          \"consequence\": \"Visitation actually increased — people love the exclusive guided tours. Orchids are protected. But you've created a two-tier system where only some visitors access the best areas.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Biodiversity\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Stakeholder Relations\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Long-term Stability\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Allow limited guided access during non-blooming season only\"\n        }\n      ],\n      \"question\": \"What's the right balance for the orchid habitat?\"\n    }\n  ]\n}",
      "outputTokens": 1975,
      "systemPrompt": "# Role\n\nYou are an expert educational game designer creating a **Challenge** activity for a learning app. Your mission is to design a choose-your-own-adventure scenario where learners make strategic decisions with meaningful consequences, using the lesson's concepts.\n\nYou specialize in crafting narrative experiences that test strategic thinking — not knowledge recall, but the ability to apply concepts and understand trade-offs.\n\n# Why Narrative Challenges Work\n\nGreat challenges don't quiz — they immerse. Learners face realistic scenarios where every choice has consequences. They experience trade-offs firsthand, making the lesson's principles memorable.\n\n- **No \"Right Answer\"**: Every option has pros and cons. Learners engage with WHY, not just WHAT.\n- **Consequences Over Scores**: Instead of winning or losing, learners see the natural results of their choices.\n- **Strategic Thinking**: Understanding the lesson helps navigate trade-offs, but different strategies lead to different outcomes.\n\n# Inputs\n\n- `LESSON_TITLE`: The topic to create a challenge around\n- `LESSON_DESCRIPTION`: Additional context about what this lesson covers\n- `CHAPTER_TITLE`: The chapter context (for understanding scope)\n- `COURSE_TITLE`: The course context (for understanding audience level)\n- `LANGUAGE`: Output language\n- `EXPLANATION_STEPS`: What the learner has already studied\n\n## Language Guidelines\n\n- `en`: Use US English unless the content is region-specific\n- `pt`: Use Brazilian Portuguese unless the content is region-specific\n- `es`: Use Latin American Spanish unless the content is region-specific\n\n# Requirements\n\n## Introduction\n\nThe `intro` field sets the scene (max 500 characters). It should:\n\n- Establish the scenario and the learner's role\n- Explain what they're navigating (a project, situation, decision-making process)\n- Create stakes that feel meaningful\n- Use `{{NAME}}` to personalize\n\n## Steps\n\nCreate 4-6 steps. Each step presents a decision point with 3-4 options.\n\n### Step Structure\n\n- **context**: Maximum 500 characters. Pure dialogue from a colleague setting up the decision. Conversational, no narrator.\n- **question**: Maximum 100 characters. What needs to be decided.\n- **options**: 3-4 choices, each with:\n  - **text**: The choice (max 80 characters)\n  - **consequence**: What happens as a result (max 300 characters). Shown after choosing. Explains the outcome narratively.\n  - **effects**: Array of 1-3 effects showing how this choice impacts different aspects:\n    - **dimension**: A short name for what this affects (e.g., \"Code Quality\", \"Delivery Speed\", \"Team Morale\"). Use 2-4 different dimensions across all options to create meaningful trade-offs. Important: dimensions must be consistent across all steps.\n    - **impact**: Is this `\"positive\"`, `\"neutral\"`, or `\"negative\"` for that dimension?\n\n### Option Design\n\nEvery option should:\n\n- Be a legitimate choice (no obviously wrong answers)\n- Have a clear consequence that connects to lesson concepts\n- Affect 1-3 dimensions (real decisions rarely affect just one thing)\n- Teach something about trade-offs when the consequence is revealed\n\n**No option should be universally best.** Good options might help one dimension but hurt another. This creates genuine trade-offs.\n\n## Reflection\n\nThe `reflection` field (max 500 characters) provides closing insight after all steps. It should:\n\n- Acknowledge that different approaches have merit\n- Connect the experience back to the lesson's key principles\n- Help learners understand how the concepts apply in practice\n\n## Tone & Style\n\n- **Pure dialogue**: NO narrator, NO character prefixes, NO action descriptions\n- **Natural conversation**: Colleagues working through a problem together\n- **Professional but warm**: Light humor when appropriate\n- **Second-person immersion**: The colleague speaks TO the learner\n- **Use `{{NAME}}`** to personalize dialogue\n\n## What to Avoid\n\n- **Quiz-style questions**: This tests strategic thinking, not recall\n- **Obviously correct answers**: Every option should have genuine trade-offs\n- **Narrator text**: Keep it pure dialogue in context\n- **Disconnected consequences**: Consequences should relate to lesson concepts\n- **Too many or too few dimensions**: Use 2-4 different dimension names across all effects for meaningful trade-offs\n\n## Relationship to Previous Activities\n\nThe learner has completed:\n\n- **Background**: WHY this exists\n- **Explanation**: WHAT it is\n- **Mechanics**: HOW it works\n- **Examples**: WHERE it appears\n- **Story**: WHEN to apply this\n\nYour Challenge activity is the capstone: **CAN YOU NAVIGATE THIS?** It tests whether learners can apply concepts strategically. This should feel like a meaningful simulation, not a test.\n\n# Example\n\nFor a lesson on \"Technical Debt\":\n\n**Step 1:**\n\n```json\n{\n  \"context\": \"{{NAME}}, we've got a deadline crunch. The feature works but the code is messy. Ship it now or clean it up first?\",\n  \"question\": \"How do we handle this?\",\n  \"options\": [\n    {\n      \"text\": \"Ship it now, refactor later\",\n      \"consequence\": \"Feature launched on time! But the messy code made the next sprint's work harder. The team spent extra hours untangling dependencies.\",\n      \"effects\": [\n        { \"dimension\": \"Code Quality\", \"impact\": \"negative\" },\n        { \"dimension\": \"Delivery Speed\", \"impact\": \"positive\" }\n      ]\n    },\n    {\n      \"text\": \"Take two more days to refactor\",\n      \"consequence\": \"The code is clean and maintainable. Stakeholders weren't thrilled about the delay, but future changes will be much easier.\",\n      \"effects\": [\n        { \"dimension\": \"Code Quality\", \"impact\": \"positive\" },\n        { \"dimension\": \"Delivery Speed\", \"impact\": \"negative\" }\n      ]\n    },\n    {\n      \"text\": \"Split the team — half ships, half refactors\",\n      \"consequence\": \"Shipped on time with partial cleanup. Neither task got full attention, and the team felt stretched thin.\",\n      \"effects\": [\n        { \"dimension\": \"Code Quality\", \"impact\": \"neutral\" },\n        { \"dimension\": \"Team Morale\", \"impact\": \"negative\" }\n      ]\n    }\n  ]\n}\n```\n\n# Quality Checks\n\nBefore finalizing, verify:\n\n- [ ] Does the intro establish a clear, engaging scenario?\n- [ ] Does every option have a meaningful consequence?\n- [ ] Are consequences connected to lesson principles?\n- [ ] Is there no obviously \"best\" option in each step?\n- [ ] Do options affect multiple dimensions where realistic?\n- [ ] Are dimension names consistent and lesson-relevant across all effects?\n- [ ] Is `{{NAME}}` used appropriately?\n- [ ] Is all dialogue pure conversation (no narrator)?\n- [ ] Does the reflection tie the experience back to the lesson?\n- [ ] Are all constraints met (intro ≤500, context ≤500, question ≤100, text ≤80, consequence ≤300, reflection ≤500)?\n- [ ] Is the step count between 4 and 6?\n- [ ] Does every step have 3-4 options?\n\n# Output Format\n\nReturn an object with:\n\n- **intro**: Scenario introduction (max 500 chars)\n- **steps**: Array of 4-6 step objects, each with:\n  - **context**: Pure dialogue (max 500 chars)\n  - **question**: Decision prompt (max 100 chars)\n  - **options**: Array of 3-4 objects with:\n    - **text**: Choice description (max 80 chars)\n    - **consequence**: What happens (max 300 chars)\n    - **effects**: Array of 1-3 objects with:\n      - **dimension**: Short name for what this affects (use 2-4 different dimensions total)\n      - **impact**: One of \"positive\", \"neutral\", \"negative\"\n- **reflection**: Closing insight connecting to lesson (max 500 chars)\n",
      "testCaseId": "en-biology-ecosystem-balance-1",
      "userPrompt": "LESSON_TITLE: Ecosystem Balance and Management\nLESSON_DESCRIPTION: Applying ecological principles to make informed ecosystem management decisions\nCHAPTER_TITLE: Ecosystem Dynamics\nCOURSE_TITLE: Ecology and Conservation\nLANGUAGE: en\nEXPLANATION_STEPS:\n1. Interconnected Networks: Ecosystems are interconnected networks. Removing one species affects others through food webs. Keystone species have disproportionate impact — their loss cascades through the system.\n2. Carrying Capacity: Carrying capacity is the maximum population an environment can sustain. Exceed it, and resources deplete, populations crash. Stay well below, and you're not maximizing the ecosystem's potential.\n3. Biodiversity and Resilience: Biodiversity provides resilience. More species means more ways to respond to change. Monocultures are efficient but fragile. Diverse systems are robust but complex to manage.\n4. Trophic Cascades: Trophic cascades occur when changes at one level ripple through others. Remove predators, and prey populations explode, overgrazing vegetation, affecting everything that depends on those plants.\n5. Ecological Succession: Ecological succession is the process of change over time. Pioneer species prepare the way for later ones. Managing ecosystems means deciding where in succession you want to be."
    },
    {
      "duration": 46702.16758399998,
      "inputTokens": 2844,
      "output": "{\n  \"intro\": \"{{NAME}}, você acaba de assumir como engenheiro(a) químico(a) na PlantaChem, uma indústria que produz amônia pelo processo Haber. A produção caiu 15% no último mês e a diretoria quer respostas. Seu colega Marcos, técnico sênior da planta, vai te guiar pelos sistemas. As decisões que você tomar vão impactar produção, custos e segurança. A reação é: N₂ + 3H₂ ⇌ 2NH₃ (exotérmica).\",\n  \"reflection\": \"Otimizar processos químicos é sobre entender trade-offs. Le Chatelier nos diz COMO o sistema responde, mas cabe a nós decidir o que priorizar. Alta pressão favorece amônia, mas custa caro. Baixa temperatura favorece produto, mas é lenta. Catalisadores aceleram, mas não mudam o equilíbrio. Na prática, o melhor processo equilibra termodinâmica, cinética, custos e segurança.\",\n  \"steps\": [\n    {\n      \"context\": \"{{NAME}}, bem-vindo(a)! Olha, nosso reator principal está operando a 200 atm e 450°C. A conversão tá baixa. Eu sei que a reação produz menos moles de gás no lado dos produtos. O que você acha — subimos a pressão pra 300 atm ou tentamos outra coisa?\",\n      \"options\": [\n        {\n          \"consequence\": \"A conversão aumentou significativamente! Mais pressão favoreceu o lado com menos moles (produtos). Porém, os custos de compressão subiram 40% e a manutenção ficou mais frequente.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Produção\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Custos Operacionais\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Segurança\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Aumentar pressão para 300 atm\"\n        },\n        {\n          \"consequence\": \"Boa análise! A temperatura mais baixa realmente favorece produtos em reações exotérmicas. A conversão melhorou, mas a reação ficou mais lenta. Vamos precisar de mais catalisador.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Produção\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Custos Operacionais\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Segurança\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Diminuir temperatura para 400°C\"\n        },\n        {\n          \"consequence\": \"Entendi o raciocínio, mas catalisadores não deslocam equilíbrio — só aceleram. A conversão final ficou igual. Pelo menos não piorou nada.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Produção\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Custos Operacionais\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Segurança\",\n              \"impact\": \"neutral\"\n            }\n          ],\n          \"text\": \"Adicionar mais catalisador ao reator\"\n        }\n      ],\n      \"question\": \"Como aumentamos a conversão em amônia?\"\n    },\n    {\n      \"context\": \"{{NAME}}, temos amônia acumulando na saída do reator. O pessoal da operação quer saber: a gente deixa ela ali ou instala um sistema de condensação pra remover continuamente? Isso muda o equilíbrio, né?\",\n      \"options\": [\n        {\n          \"consequence\": \"Excelente! Remover produto desloca o equilíbrio para formar mais produto. A conversão global aumentou bastante. O investimento inicial foi alto, mas valeu.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Produção\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Custos Operacionais\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Segurança\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Instalar condensador para remover NH₃\"\n        },\n        {\n          \"consequence\": \"A amônia acumulada está limitando a conversão. O equilíbrio não avança porque o produto não é removido. Economizamos no curto prazo, mas a produção ficou estagnada.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Produção\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Custos Operacionais\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Segurança\",\n              \"impact\": \"neutral\"\n            }\n          ],\n          \"text\": \"Manter como está para economizar\"\n        },\n        {\n          \"consequence\": \"Recircular ajuda a aproveitar reagentes não convertidos, mas sem remover a amônia, o equilíbrio continua limitado. Melhora parcial.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Produção\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Custos Operacionais\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Segurança\",\n              \"impact\": \"neutral\"\n            }\n          ],\n          \"text\": \"Recircular sem condensação\"\n        }\n      ],\n      \"question\": \"O que fazemos com a amônia produzida?\"\n    },\n    {\n      \"context\": \"O fornecedor de nitrogênio ligou — podem entregar 30% mais N₂ pelo mesmo preço esta semana. Mas nosso tanque de hidrogênio tá no limite. Se a gente aceitar, vai ter excesso de nitrogênio no sistema. Isso ajuda ou atrapalha?\",\n      \"options\": [\n        {\n          \"consequence\": \"Mais nitrogênio desloca o equilíbrio para produtos! Mas o excesso de N₂ sem H₂ proporcional limitou o ganho. Ainda assim, produção subiu um pouco.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Produção\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Custos Operacionais\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Segurança\",\n              \"impact\": \"neutral\"\n            }\n          ],\n          \"text\": \"Aceitar o nitrogênio extra\"\n        },\n        {\n          \"consequence\": \"Boa cautela! Sem hidrogênio proporcional (razão 1:3), o excesso de N₂ seria ineficiente. Mantivemos a estequiometria ideal.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Produção\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Custos Operacionais\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Segurança\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Recusar e manter proporção atual\"\n        },\n        {\n          \"consequence\": \"Perfeito! Adicionar ambos os reagentes na proporção certa maximiza o deslocamento para produtos. A produção aumentou significativamente.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Produção\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Custos Operacionais\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Segurança\",\n              \"impact\": \"neutral\"\n            }\n          ],\n          \"text\": \"Aceitar e comprar mais H₂ também\"\n        }\n      ],\n      \"question\": \"Aceitamos a oferta de nitrogênio?\"\n    },\n    {\n      \"context\": \"{{NAME}}, o turno da noite injetou gás argônio no sistema achando que ia ajudar a pressão. Agora temos 10% de argônio no reator. A diretoria quer saber se isso mudou nosso equilíbrio.\",\n      \"options\": [\n        {\n          \"consequence\": \"Correto! Gases inertes a volume constante não afetam pressões parciais dos reagentes. O equilíbrio não foi alterado. Bom conhecimento de Le Chatelier!\",\n          \"effects\": [\n            {\n              \"dimension\": \"Produção\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Custos Operacionais\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Segurança\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Explicar que gás inerte não afeta equilíbrio\"\n        },\n        {\n          \"consequence\": \"A purga removeu o argônio, mas também perdemos reagentes valiosos. Custos subiram e a produção caiu temporariamente durante o procedimento.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Produção\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Custos Operacionais\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Segurança\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Purgar todo o sistema imediatamente\"\n        },\n        {\n          \"consequence\": \"O sistema já estava operando normalmente. A parada desnecessária custou horas de produção perdida.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Produção\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Custos Operacionais\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Segurança\",\n              \"impact\": \"neutral\"\n            }\n          ],\n          \"text\": \"Parar produção até analisar riscos\"\n        }\n      ],\n      \"question\": \"Como lidamos com o argônio no sistema?\"\n    },\n    {\n      \"context\": \"A diretoria quer aumentar produção em 25% para o próximo trimestre. O time de engenharia propôs três estratégias diferentes. Cada uma tem seus trade-offs. Qual caminho você recomenda, {{NAME}}?\",\n      \"options\": [\n        {\n          \"consequence\": \"Pressão extrema maximiza conversão termodinâmica, mas os custos de equipamento e energia dispararam. A margem de lucro caiu mesmo com mais produção.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Produção\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Custos Operacionais\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Segurança\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Investir em compressores para 400 atm\"\n        },\n        {\n          \"consequence\": \"Estratégia equilibrada! Temperatura moderada favorece produtos (exotérmico), catalisador compensa a cinética mais lenta. Atingimos a meta com custos controlados.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Produção\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Custos Operacionais\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Segurança\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Otimizar temperatura e catalisador juntos\"\n        },\n        {\n          \"consequence\": \"Mais reatores aumentam capacidade total, mas é o maior investimento. A produção cresceu, porém o retorno financeiro vai demorar anos.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Produção\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Custos Operacionais\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Segurança\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Construir segundo reator em paralelo\"\n        }\n      ],\n      \"question\": \"Qual estratégia para aumentar produção?\"\n    }\n  ]\n}",
      "outputTokens": 2323,
      "systemPrompt": "# Role\n\nYou are an expert educational game designer creating a **Challenge** activity for a learning app. Your mission is to design a choose-your-own-adventure scenario where learners make strategic decisions with meaningful consequences, using the lesson's concepts.\n\nYou specialize in crafting narrative experiences that test strategic thinking — not knowledge recall, but the ability to apply concepts and understand trade-offs.\n\n# Why Narrative Challenges Work\n\nGreat challenges don't quiz — they immerse. Learners face realistic scenarios where every choice has consequences. They experience trade-offs firsthand, making the lesson's principles memorable.\n\n- **No \"Right Answer\"**: Every option has pros and cons. Learners engage with WHY, not just WHAT.\n- **Consequences Over Scores**: Instead of winning or losing, learners see the natural results of their choices.\n- **Strategic Thinking**: Understanding the lesson helps navigate trade-offs, but different strategies lead to different outcomes.\n\n# Inputs\n\n- `LESSON_TITLE`: The topic to create a challenge around\n- `LESSON_DESCRIPTION`: Additional context about what this lesson covers\n- `CHAPTER_TITLE`: The chapter context (for understanding scope)\n- `COURSE_TITLE`: The course context (for understanding audience level)\n- `LANGUAGE`: Output language\n- `EXPLANATION_STEPS`: What the learner has already studied\n\n## Language Guidelines\n\n- `en`: Use US English unless the content is region-specific\n- `pt`: Use Brazilian Portuguese unless the content is region-specific\n- `es`: Use Latin American Spanish unless the content is region-specific\n\n# Requirements\n\n## Introduction\n\nThe `intro` field sets the scene (max 500 characters). It should:\n\n- Establish the scenario and the learner's role\n- Explain what they're navigating (a project, situation, decision-making process)\n- Create stakes that feel meaningful\n- Use `{{NAME}}` to personalize\n\n## Steps\n\nCreate 4-6 steps. Each step presents a decision point with 3-4 options.\n\n### Step Structure\n\n- **context**: Maximum 500 characters. Pure dialogue from a colleague setting up the decision. Conversational, no narrator.\n- **question**: Maximum 100 characters. What needs to be decided.\n- **options**: 3-4 choices, each with:\n  - **text**: The choice (max 80 characters)\n  - **consequence**: What happens as a result (max 300 characters). Shown after choosing. Explains the outcome narratively.\n  - **effects**: Array of 1-3 effects showing how this choice impacts different aspects:\n    - **dimension**: A short name for what this affects (e.g., \"Code Quality\", \"Delivery Speed\", \"Team Morale\"). Use 2-4 different dimensions across all options to create meaningful trade-offs. Important: dimensions must be consistent across all steps.\n    - **impact**: Is this `\"positive\"`, `\"neutral\"`, or `\"negative\"` for that dimension?\n\n### Option Design\n\nEvery option should:\n\n- Be a legitimate choice (no obviously wrong answers)\n- Have a clear consequence that connects to lesson concepts\n- Affect 1-3 dimensions (real decisions rarely affect just one thing)\n- Teach something about trade-offs when the consequence is revealed\n\n**No option should be universally best.** Good options might help one dimension but hurt another. This creates genuine trade-offs.\n\n## Reflection\n\nThe `reflection` field (max 500 characters) provides closing insight after all steps. It should:\n\n- Acknowledge that different approaches have merit\n- Connect the experience back to the lesson's key principles\n- Help learners understand how the concepts apply in practice\n\n## Tone & Style\n\n- **Pure dialogue**: NO narrator, NO character prefixes, NO action descriptions\n- **Natural conversation**: Colleagues working through a problem together\n- **Professional but warm**: Light humor when appropriate\n- **Second-person immersion**: The colleague speaks TO the learner\n- **Use `{{NAME}}`** to personalize dialogue\n\n## What to Avoid\n\n- **Quiz-style questions**: This tests strategic thinking, not recall\n- **Obviously correct answers**: Every option should have genuine trade-offs\n- **Narrator text**: Keep it pure dialogue in context\n- **Disconnected consequences**: Consequences should relate to lesson concepts\n- **Too many or too few dimensions**: Use 2-4 different dimension names across all effects for meaningful trade-offs\n\n## Relationship to Previous Activities\n\nThe learner has completed:\n\n- **Background**: WHY this exists\n- **Explanation**: WHAT it is\n- **Mechanics**: HOW it works\n- **Examples**: WHERE it appears\n- **Story**: WHEN to apply this\n\nYour Challenge activity is the capstone: **CAN YOU NAVIGATE THIS?** It tests whether learners can apply concepts strategically. This should feel like a meaningful simulation, not a test.\n\n# Example\n\nFor a lesson on \"Technical Debt\":\n\n**Step 1:**\n\n```json\n{\n  \"context\": \"{{NAME}}, we've got a deadline crunch. The feature works but the code is messy. Ship it now or clean it up first?\",\n  \"question\": \"How do we handle this?\",\n  \"options\": [\n    {\n      \"text\": \"Ship it now, refactor later\",\n      \"consequence\": \"Feature launched on time! But the messy code made the next sprint's work harder. The team spent extra hours untangling dependencies.\",\n      \"effects\": [\n        { \"dimension\": \"Code Quality\", \"impact\": \"negative\" },\n        { \"dimension\": \"Delivery Speed\", \"impact\": \"positive\" }\n      ]\n    },\n    {\n      \"text\": \"Take two more days to refactor\",\n      \"consequence\": \"The code is clean and maintainable. Stakeholders weren't thrilled about the delay, but future changes will be much easier.\",\n      \"effects\": [\n        { \"dimension\": \"Code Quality\", \"impact\": \"positive\" },\n        { \"dimension\": \"Delivery Speed\", \"impact\": \"negative\" }\n      ]\n    },\n    {\n      \"text\": \"Split the team — half ships, half refactors\",\n      \"consequence\": \"Shipped on time with partial cleanup. Neither task got full attention, and the team felt stretched thin.\",\n      \"effects\": [\n        { \"dimension\": \"Code Quality\", \"impact\": \"neutral\" },\n        { \"dimension\": \"Team Morale\", \"impact\": \"negative\" }\n      ]\n    }\n  ]\n}\n```\n\n# Quality Checks\n\nBefore finalizing, verify:\n\n- [ ] Does the intro establish a clear, engaging scenario?\n- [ ] Does every option have a meaningful consequence?\n- [ ] Are consequences connected to lesson principles?\n- [ ] Is there no obviously \"best\" option in each step?\n- [ ] Do options affect multiple dimensions where realistic?\n- [ ] Are dimension names consistent and lesson-relevant across all effects?\n- [ ] Is `{{NAME}}` used appropriately?\n- [ ] Is all dialogue pure conversation (no narrator)?\n- [ ] Does the reflection tie the experience back to the lesson?\n- [ ] Are all constraints met (intro ≤500, context ≤500, question ≤100, text ≤80, consequence ≤300, reflection ≤500)?\n- [ ] Is the step count between 4 and 6?\n- [ ] Does every step have 3-4 options?\n\n# Output Format\n\nReturn an object with:\n\n- **intro**: Scenario introduction (max 500 chars)\n- **steps**: Array of 4-6 step objects, each with:\n  - **context**: Pure dialogue (max 500 chars)\n  - **question**: Decision prompt (max 100 chars)\n  - **options**: Array of 3-4 objects with:\n    - **text**: Choice description (max 80 chars)\n    - **consequence**: What happens (max 300 chars)\n    - **effects**: Array of 1-3 objects with:\n      - **dimension**: Short name for what this affects (use 2-4 different dimensions total)\n      - **impact**: One of \"positive\", \"neutral\", \"negative\"\n- **reflection**: Closing insight connecting to lesson (max 500 chars)\n",
      "testCaseId": "pt-chemistry-reaction-equilibrium-1",
      "userPrompt": "LESSON_TITLE: Equilibrio Quimico na Pratica\nLESSON_DESCRIPTION: Aplicando o principio de Le Chatelier para otimizar reacoes quimicas e processos industriais\nCHAPTER_TITLE: Equilibrio Quimico\nCOURSE_TITLE: Quimica Geral II\nLANGUAGE: pt\nEXPLANATION_STEPS:\n1. Principio de Le Chatelier: O principio de Le Chatelier diz que um sistema em equilibrio responde a perturbacoes minimizando a mudanca. Adicione reagente, o equilibrio desloca para consumir esse reagente.\n2. Efeito da Concentracao: Mudancas de concentracao deslocam o equilibrio. Adicionar reagentes desloca para produtos. Remover produtos tambem desloca para produtos. O sistema busca restaurar o equilibrio.\n3. Efeito da Pressao: A pressao afeta equilibrios gasosos. Aumentar pressao favorece o lado com menos moles de gas. Diminuir pressao favorece o lado com mais moles. Gases inertes nao afetam.\n4. Efeito da Temperatura: Temperatura e diferente — ela muda a constante de equilibrio. Reacoes exotermicas: aumento de temperatura desloca para reagentes. Reacoes endotermicas: aumento favorece produtos.\n5. Papel dos Catalisadores: Catalisadores aceleram ambas as direcoes igualmente. Eles nao deslocam o equilibrio — apenas ajudam a alcancar o equilibrio mais rapido. Util para processos industriais."
    },
    {
      "duration": 48878.375374999945,
      "inputTokens": 2841,
      "output": "{\n  \"intro\": \"{{NAME}}, bienvenido al equipo de ingeniería de GreenTech Solutions. Nos han contratado para rediseñar el sistema energético de una fábrica de componentes electrónicos. El cliente quiere reducir costos y su huella de carbono, pero tiene restricciones de presupuesto y espacio. Cada decisión que tomes afectará la eficiencia final, los costos y la viabilidad del proyecto.\",\n  \"reflection\": \"No existe un diseño perfecto en sistemas energéticos reales. Cada decisión implica equilibrar eficiencia, costos y practicidad. Lo importante es entender que las pérdidas se acumulan en cada conversión, que el almacenamiento tiene su precio energético, y que la densidad energética determina qué soluciones son viables. Diseñar bien significa minimizar conversiones innecesarias y elegir tecnologías apropiadas para cada contexto.\",\n  \"steps\": [\n    {\n      \"context\": \"{{NAME}}, la fábrica actualmente usa electricidad de la red para todo: iluminación, maquinaria y hornos industriales. Los hornos necesitan calor a 400°C y consumen el 60% de la energía. Estoy pensando que convertir electricidad en calor no es la única opción. ¿Qué estrategia base proponemos?\",\n      \"options\": [\n        {\n          \"consequence\": \"Excelente eficiencia térmica, el gas natural se convierte directamente en calor sin pasos intermedios. Sin embargo, seguimos dependiendo de combustibles fósiles y sus emisiones de CO2.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Eficiencia\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Huella de Carbono\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Costos Operativos\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Gas natural directo para los hornos, electricidad para el resto\"\n        },\n        {\n          \"consequence\": \"La electricidad solar pasa por inversores antes de llegar a los hornos. Cada conversión resta eficiencia, pero eliminamos emisiones directas y reducimos dependencia de la red.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Eficiencia\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Huella de Carbono\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Costos Operativos\",\n              \"impact\": \"neutral\"\n            }\n          ],\n          \"text\": \"Paneles solares con conversión eléctrica para todo\"\n        },\n        {\n          \"consequence\": \"Los colectores solares térmicos calientan directamente sin conversiones eléctricas intermedias. Muy eficiente para calor, pero solo funciona con sol y necesita mucho espacio en el techo.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Eficiencia\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Huella de Carbono\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Viabilidad Técnica\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Concentradores solares térmicos para hornos, red para el resto\"\n        }\n      ],\n      \"question\": \"¿Qué fuente de energía usamos para los hornos industriales?\"\n    },\n    {\n      \"context\": \"Buena base, {{NAME}}. Ahora, la fábrica opera en tres turnos pero la demanda varía mucho. El turno nocturno usa solo 30% de la capacidad. El cliente pregunta si debería almacenar energía para cubrir picos y aprovechar tarifas nocturnas más baratas.\",\n      \"options\": [\n        {\n          \"consequence\": \"Las baterías permiten arbitraje de tarifas, pero cada ciclo de carga-descarga pierde entre 10-15% de energía. Con ciclos diarios, las pérdidas acumuladas son significativas a largo plazo.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Eficiencia\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Costos Operativos\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Viabilidad Técnica\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Instalar banco de baterías de litio\"\n        },\n        {\n          \"consequence\": \"El almacenamiento térmico es más simple y eficiente para calor que convertir electricidad-batería-electricidad-calor. Menos conversiones, menos pérdidas. Pero solo sirve para los hornos.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Eficiencia\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Costos Operativos\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Viabilidad Técnica\",\n              \"impact\": \"neutral\"\n            }\n          ],\n          \"text\": \"Almacenamiento térmico con sales fundidas\"\n        },\n        {\n          \"consequence\": \"Sin almacenamiento evitamos las pérdidas de conversión. Dependemos de la red pero aprovechamos su estabilidad. Los ahorros por tarifas variables se pierden.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Eficiencia\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Costos Operativos\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Viabilidad Técnica\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Sin almacenamiento, usar red como respaldo\"\n        }\n      ],\n      \"question\": \"¿Implementamos almacenamiento de energía?\"\n    },\n    {\n      \"context\": \"{{NAME}}, revisando los procesos encontré algo interesante. La maquinaria de precisión genera calor residual a 80°C que actualmente se ventila al exterior. Son megavatios desperdiciados. ¿Qué hacemos con ese calor?\",\n      \"options\": [\n        {\n          \"consequence\": \"Precalentar el agua de proceso aprovecha el calor residual directamente, sin conversiones adicionales. Es la opción más eficiente porque usamos el calor como calor, no lo convertimos.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Eficiencia\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Costos Operativos\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Huella de Carbono\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Recuperar calor para precalentar agua de proceso\"\n        },\n        {\n          \"consequence\": \"Los motores termoeléctricos convierten calor en electricidad, pero a 80°C la eficiencia de conversión es muy baja, apenas 5-8%. Recuperamos algo, pero perdemos mucho en la conversión.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Eficiencia\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Costos Operativos\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Viabilidad Técnica\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Generar electricidad con motores termoeléctricos\"\n        },\n        {\n          \"consequence\": \"Vender calor residual a la lavandería vecina elimina una conversión para ellos también. Ganamos dinero y mejoramos la eficiencia del sistema completo, aunque requiere negociación y tuberías.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Eficiencia\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Costos Operativos\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Viabilidad Técnica\",\n              \"impact\": \"neutral\"\n            }\n          ],\n          \"text\": \"Vender el calor a la lavandería industrial vecina\"\n        }\n      ],\n      \"question\": \"¿Cómo aprovechamos el calor residual?\"\n    },\n    {\n      \"context\": \"El cliente quiere una flota de vehículos eléctricos para logística interna. Actualmente usan montacargas de gas propano. Me preocupa la cadena de conversiones: generación eléctrica, transmisión, carga de batería, motor. ¿Vale la pena el cambio?\",\n      \"options\": [\n        {\n          \"consequence\": \"La cadena eléctrica tiene más conversiones, pero los motores eléctricos son 90%+ eficientes versus 25% de los de combustión. A pesar de más pasos, la eficiencia total puede ser mayor con electricidad limpia.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Eficiencia\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Huella de Carbono\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Costos Operativos\",\n              \"impact\": \"neutral\"\n            }\n          ],\n          \"text\": \"Cambiar a montacargas eléctricos\"\n        },\n        {\n          \"consequence\": \"El hidrógeno tiene baja densidad energética volumétrica y la cadena electrólisis-compresión-celda de combustible pierde mucha energía. Tecnología prometedora pero ineficiente hoy.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Eficiencia\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Huella de Carbono\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Viabilidad Técnica\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Montacargas de hidrógeno con electrólisis local\"\n        },\n        {\n          \"consequence\": \"El propano tiene alta densidad energética y la infraestructura ya existe. Mantenemos emisiones pero evitamos inversión en conversión. Los motores de combustión siguen siendo ineficientes.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Eficiencia\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Huella de Carbono\",\n              \"impact\": \"negative\"\n            },\n            {\n              \"dimension\": \"Costos Operativos\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Mantener propano y optimizar rutas\"\n        }\n      ],\n      \"question\": \"¿Qué hacemos con la flota de vehículos?\"\n    },\n    {\n      \"context\": \"{{NAME}}, última decisión importante. El techo tiene espacio limitado: podemos instalar paneles solares fotovoltaicos O colectores solares térmicos, pero no ambos. La fábrica necesita tanto electricidad como calor. ¿Qué priorizamos?\",\n      \"options\": [\n        {\n          \"consequence\": \"La electricidad es versátil pero convertirla en calor añade pérdidas. Si la mayor demanda es térmica, estamos agregando conversiones innecesarias. Funciona, pero no es óptimo para esta fábrica.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Eficiencia\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Viabilidad Técnica\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Costos Operativos\",\n              \"impact\": \"neutral\"\n            }\n          ],\n          \"text\": \"Paneles fotovoltaicos, el calor lo generamos de la red\"\n        },\n        {\n          \"consequence\": \"Los colectores térmicos alimentan directamente los hornos sin conversiones. Dado que el 60% de la demanda es calor, esto minimiza las pérdidas en la mayor parte del consumo.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Eficiencia\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Viabilidad Técnica\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Huella de Carbono\",\n              \"impact\": \"positive\"\n            }\n          ],\n          \"text\": \"Colectores térmicos, la electricidad viene de la red\"\n        },\n        {\n          \"consequence\": \"La división reduce el impacto de ambas tecnologías. Ni generamos suficiente calor ni electricidad para ser autosuficientes en ninguno. Diversificamos riesgo pero perdemos economías de escala.\",\n          \"effects\": [\n            {\n              \"dimension\": \"Eficiencia\",\n              \"impact\": \"neutral\"\n            },\n            {\n              \"dimension\": \"Viabilidad Técnica\",\n              \"impact\": \"positive\"\n            },\n            {\n              \"dimension\": \"Costos Operativos\",\n              \"impact\": \"negative\"\n            }\n          ],\n          \"text\": \"Dividir el espacio 50-50 entre ambas tecnologías\"\n        }\n      ],\n      \"question\": \"¿Fotovoltaico o térmico para el techo?\"\n    }\n  ]\n}",
      "outputTokens": 2543,
      "systemPrompt": "# Role\n\nYou are an expert educational game designer creating a **Challenge** activity for a learning app. Your mission is to design a choose-your-own-adventure scenario where learners make strategic decisions with meaningful consequences, using the lesson's concepts.\n\nYou specialize in crafting narrative experiences that test strategic thinking — not knowledge recall, but the ability to apply concepts and understand trade-offs.\n\n# Why Narrative Challenges Work\n\nGreat challenges don't quiz — they immerse. Learners face realistic scenarios where every choice has consequences. They experience trade-offs firsthand, making the lesson's principles memorable.\n\n- **No \"Right Answer\"**: Every option has pros and cons. Learners engage with WHY, not just WHAT.\n- **Consequences Over Scores**: Instead of winning or losing, learners see the natural results of their choices.\n- **Strategic Thinking**: Understanding the lesson helps navigate trade-offs, but different strategies lead to different outcomes.\n\n# Inputs\n\n- `LESSON_TITLE`: The topic to create a challenge around\n- `LESSON_DESCRIPTION`: Additional context about what this lesson covers\n- `CHAPTER_TITLE`: The chapter context (for understanding scope)\n- `COURSE_TITLE`: The course context (for understanding audience level)\n- `LANGUAGE`: Output language\n- `EXPLANATION_STEPS`: What the learner has already studied\n\n## Language Guidelines\n\n- `en`: Use US English unless the content is region-specific\n- `pt`: Use Brazilian Portuguese unless the content is region-specific\n- `es`: Use Latin American Spanish unless the content is region-specific\n\n# Requirements\n\n## Introduction\n\nThe `intro` field sets the scene (max 500 characters). It should:\n\n- Establish the scenario and the learner's role\n- Explain what they're navigating (a project, situation, decision-making process)\n- Create stakes that feel meaningful\n- Use `{{NAME}}` to personalize\n\n## Steps\n\nCreate 4-6 steps. Each step presents a decision point with 3-4 options.\n\n### Step Structure\n\n- **context**: Maximum 500 characters. Pure dialogue from a colleague setting up the decision. Conversational, no narrator.\n- **question**: Maximum 100 characters. What needs to be decided.\n- **options**: 3-4 choices, each with:\n  - **text**: The choice (max 80 characters)\n  - **consequence**: What happens as a result (max 300 characters). Shown after choosing. Explains the outcome narratively.\n  - **effects**: Array of 1-3 effects showing how this choice impacts different aspects:\n    - **dimension**: A short name for what this affects (e.g., \"Code Quality\", \"Delivery Speed\", \"Team Morale\"). Use 2-4 different dimensions across all options to create meaningful trade-offs. Important: dimensions must be consistent across all steps.\n    - **impact**: Is this `\"positive\"`, `\"neutral\"`, or `\"negative\"` for that dimension?\n\n### Option Design\n\nEvery option should:\n\n- Be a legitimate choice (no obviously wrong answers)\n- Have a clear consequence that connects to lesson concepts\n- Affect 1-3 dimensions (real decisions rarely affect just one thing)\n- Teach something about trade-offs when the consequence is revealed\n\n**No option should be universally best.** Good options might help one dimension but hurt another. This creates genuine trade-offs.\n\n## Reflection\n\nThe `reflection` field (max 500 characters) provides closing insight after all steps. It should:\n\n- Acknowledge that different approaches have merit\n- Connect the experience back to the lesson's key principles\n- Help learners understand how the concepts apply in practice\n\n## Tone & Style\n\n- **Pure dialogue**: NO narrator, NO character prefixes, NO action descriptions\n- **Natural conversation**: Colleagues working through a problem together\n- **Professional but warm**: Light humor when appropriate\n- **Second-person immersion**: The colleague speaks TO the learner\n- **Use `{{NAME}}`** to personalize dialogue\n\n## What to Avoid\n\n- **Quiz-style questions**: This tests strategic thinking, not recall\n- **Obviously correct answers**: Every option should have genuine trade-offs\n- **Narrator text**: Keep it pure dialogue in context\n- **Disconnected consequences**: Consequences should relate to lesson concepts\n- **Too many or too few dimensions**: Use 2-4 different dimension names across all effects for meaningful trade-offs\n\n## Relationship to Previous Activities\n\nThe learner has completed:\n\n- **Background**: WHY this exists\n- **Explanation**: WHAT it is\n- **Mechanics**: HOW it works\n- **Examples**: WHERE it appears\n- **Story**: WHEN to apply this\n\nYour Challenge activity is the capstone: **CAN YOU NAVIGATE THIS?** It tests whether learners can apply concepts strategically. This should feel like a meaningful simulation, not a test.\n\n# Example\n\nFor a lesson on \"Technical Debt\":\n\n**Step 1:**\n\n```json\n{\n  \"context\": \"{{NAME}}, we've got a deadline crunch. The feature works but the code is messy. Ship it now or clean it up first?\",\n  \"question\": \"How do we handle this?\",\n  \"options\": [\n    {\n      \"text\": \"Ship it now, refactor later\",\n      \"consequence\": \"Feature launched on time! But the messy code made the next sprint's work harder. The team spent extra hours untangling dependencies.\",\n      \"effects\": [\n        { \"dimension\": \"Code Quality\", \"impact\": \"negative\" },\n        { \"dimension\": \"Delivery Speed\", \"impact\": \"positive\" }\n      ]\n    },\n    {\n      \"text\": \"Take two more days to refactor\",\n      \"consequence\": \"The code is clean and maintainable. Stakeholders weren't thrilled about the delay, but future changes will be much easier.\",\n      \"effects\": [\n        { \"dimension\": \"Code Quality\", \"impact\": \"positive\" },\n        { \"dimension\": \"Delivery Speed\", \"impact\": \"negative\" }\n      ]\n    },\n    {\n      \"text\": \"Split the team — half ships, half refactors\",\n      \"consequence\": \"Shipped on time with partial cleanup. Neither task got full attention, and the team felt stretched thin.\",\n      \"effects\": [\n        { \"dimension\": \"Code Quality\", \"impact\": \"neutral\" },\n        { \"dimension\": \"Team Morale\", \"impact\": \"negative\" }\n      ]\n    }\n  ]\n}\n```\n\n# Quality Checks\n\nBefore finalizing, verify:\n\n- [ ] Does the intro establish a clear, engaging scenario?\n- [ ] Does every option have a meaningful consequence?\n- [ ] Are consequences connected to lesson principles?\n- [ ] Is there no obviously \"best\" option in each step?\n- [ ] Do options affect multiple dimensions where realistic?\n- [ ] Are dimension names consistent and lesson-relevant across all effects?\n- [ ] Is `{{NAME}}` used appropriately?\n- [ ] Is all dialogue pure conversation (no narrator)?\n- [ ] Does the reflection tie the experience back to the lesson?\n- [ ] Are all constraints met (intro ≤500, context ≤500, question ≤100, text ≤80, consequence ≤300, reflection ≤500)?\n- [ ] Is the step count between 4 and 6?\n- [ ] Does every step have 3-4 options?\n\n# Output Format\n\nReturn an object with:\n\n- **intro**: Scenario introduction (max 500 chars)\n- **steps**: Array of 4-6 step objects, each with:\n  - **context**: Pure dialogue (max 500 chars)\n  - **question**: Decision prompt (max 100 chars)\n  - **options**: Array of 3-4 objects with:\n    - **text**: Choice description (max 80 chars)\n    - **consequence**: What happens (max 300 chars)\n    - **effects**: Array of 1-3 objects with:\n      - **dimension**: Short name for what this affects (use 2-4 different dimensions total)\n      - **impact**: One of \"positive\", \"neutral\", \"negative\"\n- **reflection**: Closing insight connecting to lesson (max 500 chars)\n",
      "testCaseId": "es-physics-energy-conservation-1",
      "userPrompt": "LESSON_TITLE: Conservacion de Energia en Sistemas Reales\nLESSON_DESCRIPTION: Aplicando principios de conservacion de energia para disenar y optimizar sistemas energeticos\nCHAPTER_TITLE: Energia y Trabajo\nCOURSE_TITLE: Fisica Aplicada\nLANGUAGE: es\nEXPLANATION_STEPS:\n1. Conservacion de la Energia: La energia no se crea ni se destruye, solo se transforma. En cada conversion, la energia total se conserva, pero la energia util disminuye. Parte siempre se convierte en calor no aprovechable.\n2. Eficiencia Energetica: La eficiencia mide cuanta energia de entrada se convierte en trabajo util. Ningun proceso es 100% eficiente — siempre hay perdidas. La segunda ley de la termodinamica lo garantiza.\n3. Perdidas en Cadena: Las cadenas de conversion acumulan perdidas. Si cada paso es 90% eficiente, tres pasos dan 0.9³ = 73% eficiencia total. Menos conversiones significa menos perdidas.\n4. Costo del Almacenamiento: El almacenamiento de energia tiene su propio costo energetico. Cargar y descargar baterias pierde energia. Bombear agua cuesta arriba para hidroelectrica tambien. El almacenamiento no es gratis.\n5. Densidad Energetica: La densidad energetica importa. Combustibles fosiles almacenan mucha energia por kilogramo. Las baterias almacenan menos. Esto afecta que es practico para cada aplicacion."
    }
  ],
  "taskId": "activity-challenge"
}
