{
  "generatedAt": "2026-01-17T17:48:17.863Z",
  "modelId": "openai/gpt-5.2",
  "outputs": [
    {
      "duration": 30708.404958,
      "inputTokens": 3570,
      "output": "{\n  \"intro\": \"{{NAME}}, we’re about to ship a feature that powers real-time product search for a flash sale. We can’t have timeouts, but we also can’t blow memory on our smallest servers. Your job: make a few design calls that balance runtime, memory, and reliability before the traffic spike hits.\",\n  \"inventory\": [\n    {\n      \"name\": \"P95 Latency\",\n      \"startValue\": 60,\n      \"winConditions\": [\n        {\n          \"operator\": \"lte\",\n          \"value\": 55\n        }\n      ]\n    },\n    {\n      \"name\": \"Memory Footprint\",\n      \"startValue\": 55,\n      \"winConditions\": [\n        {\n          \"operator\": \"lte\",\n          \"value\": 65\n        }\n      ]\n    },\n    {\n      \"name\": \"Correctness Risk\",\n      \"startValue\": 45,\n      \"winConditions\": [\n        {\n          \"operator\": \"lte\",\n          \"value\": 55\n        }\n      ]\n    },\n    {\n      \"name\": \"Engineering Time\",\n      \"startValue\": 50,\n      \"winConditions\": [\n        {\n          \"operator\": \"lte\",\n          \"value\": 65\n        }\n      ]\n    }\n  ],\n  \"steps\": [\n    {\n      \"context\": \"{{NAME}}, first decision: do we optimize lookups with extra data structures, or keep it lean and compute more on the fly? The sale traffic is spiky, so worst-case behavior matters.\",\n      \"options\": [\n        {\n          \"effects\": [\n            {\n              \"change\": -15,\n              \"variable\": \"P95 Latency\"\n            },\n            {\n              \"change\": 15,\n              \"variable\": \"Memory Footprint\"\n            },\n            {\n              \"change\": 5,\n              \"variable\": \"Engineering Time\"\n            }\n          ],\n          \"feedback\": \"Caching and hash-based indexes cut repeated work, so latency drops. But precomputed tables live in RAM, and building/validating them takes some extra engineering time.\",\n          \"text\": \"Add hash-based indexes + caching for hot queries\"\n        },\n        {\n          \"effects\": [\n            {\n              \"change\": 5,\n              \"variable\": \"P95 Latency\"\n            },\n            {\n              \"change\": -10,\n              \"variable\": \"Memory Footprint\"\n            },\n            {\n              \"change\": -5,\n              \"variable\": \"Engineering Time\"\n            }\n          ],\n          \"feedback\": \"Computing results on demand keeps memory low and is faster to implement. But you pay in repeated computation, so latency rises under load.\",\n          \"text\": \"Compute on demand; avoid extra indexes/caches\"\n        },\n        {\n          \"effects\": [\n            {\n              \"change\": -10,\n              \"variable\": \"P95 Latency\"\n            },\n            {\n              \"change\": 5,\n              \"variable\": \"Memory Footprint\"\n            },\n            {\n              \"change\": 5,\n              \"variable\": \"Correctness Risk\"\n            }\n          ],\n          \"feedback\": \"A hybrid cache helps average case (amortized wins) but adds invalidation paths. That complexity can introduce subtle stale-data bugs, raising correctness risk.\",\n          \"text\": \"Hybrid: small LRU cache with partial indexing\"\n        },\n        {\n          \"effects\": [\n            {\n              \"change\": -5,\n              \"variable\": \"P95 Latency\"\n            },\n            {\n              \"change\": -5,\n              \"variable\": \"Memory Footprint\"\n            },\n            {\n              \"change\": -10,\n              \"variable\": \"Correctness Risk\"\n            },\n            {\n              \"change\": 10,\n              \"variable\": \"Engineering Time\"\n            }\n          ],\n          \"feedback\": \"Tighter validation and simpler data flow reduce correctness risk. But safer designs often take longer to build, and without aggressive optimization you only modestly improve latency and memory.\",\n          \"text\": \"Prioritize safety: simpler pipeline + extra validation tests\"\n        }\n      ],\n      \"question\": \"How do we handle lookups for the sale surge?\"\n    },\n    {\n      \"context\": \"Now about sorting and selection. We need to rank results, and the dataset size changes constantly. If we pick the wrong approach, worst-case could bite us at peak traffic.\",\n      \"options\": [\n        {\n          \"effects\": [\n            {\n              \"change\": -10,\n              \"variable\": \"P95 Latency\"\n            },\n            {\n              \"change\": 5,\n              \"variable\": \"Engineering Time\"\n            },\n            {\n              \"change\": 5,\n              \"variable\": \"Correctness Risk\"\n            }\n          ],\n          \"feedback\": \"Quicksort is typically fast (average O(n log n)), so latency improves. But if the pivot selection is poor on certain distributions, worst-case behavior and edge cases raise risk and require more careful implementation.\",\n          \"text\": \"Use Quicksort for ranking (fast average case)\"\n        },\n        {\n          \"effects\": [\n            {\n              \"change\": -5,\n              \"variable\": \"P95 Latency\"\n            },\n            {\n              \"change\": -5,\n              \"variable\": \"Correctness Risk\"\n            },\n            {\n              \"change\": 10,\n              \"variable\": \"Engineering Time\"\n            }\n          ],\n          \"feedback\": \"A worst-case-safe sort strategy (like introsort/merge-based behavior) reduces pathological slowdowns and stabilizes correctness. It takes longer to implement and validate, but avoids nasty spikes.\",\n          \"text\": \"Use worst-case-safe sorting strategy\"\n        },\n        {\n          \"effects\": [\n            {\n              \"change\": 5,\n              \"variable\": \"P95 Latency\"\n            },\n            {\n              \"change\": -10,\n              \"variable\": \"Engineering Time\"\n            },\n            {\n              \"change\": -5,\n              \"variable\": \"Correctness Risk\"\n            }\n          ],\n          \"feedback\": \"Avoiding full sorting (like partial selection/top-K approximations) can be simpler and less bug-prone, but it may return less optimally ordered results, increasing latency from extra filtering passes.\",\n          \"text\": \"Skip full sort; use simpler top-K selection approach\"\n        },\n        {\n          \"effects\": [\n            {\n              \"change\": -15,\n              \"variable\": \"P95 Latency\"\n            },\n            {\n              \"change\": 10,\n              \"variable\": \"Memory Footprint\"\n            },\n            {\n              \"change\": 5,\n              \"variable\": \"Engineering Time\"\n            }\n          ],\n          \"feedback\": \"Pre-sorting and keeping multiple ranked views makes query-time fast, lowering latency. But you pay with extra memory to store structures and extra work maintaining them as data updates.\",\n          \"text\": \"Maintain pre-sorted structures for common filters\"\n        }\n      ],\n      \"question\": \"What ranking/sorting approach do we commit to?\"\n    },\n    {\n      \"context\": \"We’re seeing bursts where traffic doubles in seconds. The question is how we size and grow internal arrays and buffers. Resizes are rare but painful when they happen.\",\n      \"options\": [\n        {\n          \"effects\": [\n            {\n              \"change\": -10,\n              \"variable\": \"P95 Latency\"\n            },\n            {\n              \"change\": 10,\n              \"variable\": \"Memory Footprint\"\n            },\n            {\n              \"change\": -5,\n              \"variable\": \"Correctness Risk\"\n            }\n          ],\n          \"feedback\": \"Over-allocating reduces resize frequency, improving amortized performance and cutting latency spikes. But it increases memory footprint; fewer resizes also lowers bug surface from complex resize paths.\",\n          \"text\": \"Over-allocate buffers to reduce resizes\"\n        },\n        {\n          \"effects\": [\n            {\n              \"change\": 10,\n              \"variable\": \"P95 Latency\"\n            },\n            {\n              \"change\": -10,\n              \"variable\": \"Memory Footprint\"\n            },\n            {\n              \"change\": -5,\n              \"variable\": \"Engineering Time\"\n            }\n          ],\n          \"feedback\": \"Tight memory means more frequent resizes/copies under bursts, so latency rises. It’s straightforward to implement and keeps memory low.\",\n          \"text\": \"Keep buffers tight; accept more frequent resizing\"\n        },\n        {\n          \"effects\": [\n            {\n              \"change\": -5,\n              \"variable\": \"P95 Latency\"\n            },\n            {\n              \"change\": 5,\n              \"variable\": \"Memory Footprint\"\n            },\n            {\n              \"change\": 5,\n              \"variable\": \"Engineering Time\"\n            },\n            {\n              \"change\": -5,\n              \"variable\": \"Correctness Risk\"\n            }\n          ],\n          \"feedback\": \"Smarter growth (dynamic sizing, tuned thresholds) balances amortized cost and memory. But tuning takes time; the payoff is fewer spikes without huge memory waste, and predictable behavior lowers risk.\",\n          \"text\": \"Implement adaptive growth policy with tuning\"\n        },\n        {\n          \"effects\": [\n            {\n              \"change\": -10,\n              \"variable\": \"Correctness Risk\"\n            },\n            {\n              \"change\": 5,\n              \"variable\": \"Engineering Time\"\n            },\n            {\n              \"change\": 5,\n              \"variable\": \"P95 Latency\"\n            }\n          ],\n          \"feedback\": \"Adding guardrails (bounds checks, assertions, property tests) lowers correctness risk. It takes time, and extra checks can add slight overhead that nudges latency upward.\",\n          \"text\": \"Add safety checks + property tests around resizing\"\n        }\n      ],\n      \"question\": \"How should we manage growth and resizing under bursts?\"\n    },\n    {\n      \"context\": \"Last call, {{NAME}}. Observability and fallback behavior. If the algorithm choice behaves badly on a rare input, do we fail fast, degrade, or spend time building a more complex fallback path?\",\n      \"options\": [\n        {\n          \"effects\": [\n            {\n              \"change\": -10,\n              \"variable\": \"Correctness Risk\"\n            },\n            {\n              \"change\": 10,\n              \"variable\": \"Engineering Time\"\n            },\n            {\n              \"change\": -5,\n              \"variable\": \"P95 Latency\"\n            }\n          ],\n          \"feedback\": \"A robust fallback (switching strategies when performance degrades) reduces worst-case risk and can even improve tail latency. But building and testing multiple paths costs engineering time.\",\n          \"text\": \"Build a fallback path for worst-case inputs\"\n        },\n        {\n          \"effects\": [\n            {\n              \"change\": 5,\n              \"variable\": \"P95 Latency\"\n            },\n            {\n              \"change\": -10,\n              \"variable\": \"Engineering Time\"\n            },\n            {\n              \"change\": 10,\n              \"variable\": \"Correctness Risk\"\n            }\n          ],\n          \"feedback\": \"Keeping one simple path is quick, but if the input distribution shifts, you can get worst-case blowups and brittle behavior. Tail latency and correctness risk rise when edge cases appear.\",\n          \"text\": \"Ship a single simple path; no fallback\"\n        },\n        {\n          \"effects\": [\n            {\n              \"change\": -10,\n              \"variable\": \"P95 Latency\"\n            },\n            {\n              \"change\": 5,\n              \"variable\": \"Memory Footprint\"\n            },\n            {\n              \"change\": 5,\n              \"variable\": \"Engineering Time\"\n            },\n            {\n              \"change\": -5,\n              \"variable\": \"Correctness Risk\"\n            }\n          ],\n          \"feedback\": \"Extra metrics and lightweight sampling help catch tail issues early and allow safe tuning. Instrumentation costs some memory and time, but reduces risk by making problems visible.\",\n          \"text\": \"Add detailed instrumentation + sampling for tuning\"\n        },\n        {\n          \"effects\": [\n            {\n              \"change\": -5,\n              \"variable\": \"P95 Latency\"\n            },\n            {\n              \"change\": -5,\n              \"variable\": \"Memory Footprint\"\n            },\n            {\n              \"change\": -10,\n              \"variable\": \"Engineering Time\"\n            },\n            {\n              \"change\": 5,\n              \"variable\": \"Correctness Risk\"\n            }\n          ],\n          \"feedback\": \"Turning off expensive features reduces load and memory quickly, improving latency. But fast toggles can create inconsistent behavior and corner cases, increasing correctness risk.\",\n          \"text\": \"Add feature flags to disable expensive behaviors quickly\"\n        }\n      ],\n      \"question\": \"What’s our safety plan for worst-case surprises?\"\n    }\n  ]\n}",
      "outputTokens": 1768,
      "systemPrompt": "# Role\n\nYou are an expert educational game designer creating a **Challenge** activity for a learning app. Your mission is to design a strategic simulation where learners make decisions that affect inventory variables, navigating trade-offs to meet win conditions using the lesson's concepts.\n\nYou specialize in crafting game-like experiences that test strategic thinking and problem-solving — not just knowledge recall, but the ability to apply concepts under constraints.\n\n# The Art of Strategic Learning\n\nA great Challenge activity doesn't quiz — it simulates. Learners face realistic constraints where every choice has consequences. They must think strategically about trade-offs, just like real-world decision-making.\n\n## Why Trade-Off-Based Scenarios Work\n\n1. **Authentic Complexity**: Real problems have multiple variables that interact. Improving one often affects another.\n\n2. **Strategic Reasoning**: Learners must think several steps ahead, considering how choices compound.\n\n3. **No \"Right Answer\"**: When every option has pros and cons, learners engage with the WHY behind principles.\n\n4. **Memorable Stakes**: Managing resources and meeting goals creates emotional investment in outcomes.\n\n## The Trade-Off Principle\n\nEvery great Challenge activity creates genuine dilemmas:\n\n- **No Perfect Options**: Each choice improves some variables while affecting others\n- **Interconnected Systems**: Variables influence each other meaningfully\n- **Strategic Planning**: Success requires thinking beyond the immediate step\n- **Concept Application**: Understanding the lesson's principles helps navigate trade-offs\n\n# Inputs\n\n- `LESSON_TITLE`: The topic to create a challenge around\n- `LESSON_DESCRIPTION`: Additional context about what this lesson covers\n- `CHAPTER_TITLE`: The chapter context (for understanding scope)\n- `COURSE_TITLE`: The course context (for understanding audience level)\n- `LANGUAGE`: Output language\n- `EXPLANATION_STEPS`: Array of {title, text} from all explanation activities (Background, Explanation, Mechanics, Examples) the learner completed before this one\n\n## Language Guidelines\n\n- `en`: Use US English unless the content is region-specific\n- `pt`: Use Brazilian Portuguese unless the content is region-specific\n- `es`: Use Latin American Spanish unless the content is region-specific\n\n# Requirements\n\n## Introduction\n\nThe `intro` field sets the scene (max 500 characters). It should:\n\n- Establish the scenario and the learner's role\n- Explain what they're trying to achieve\n- Create stakes that feel meaningful\n- Use `{{NAME}}` to personalize\n\n## Inventory Design\n\nDesign 3-5 inventory items. Each item includes:\n\n- **name**: Variable name (intuitive, e.g., \"Budget\", \"Team Morale\", \"Code Quality\")\n- **startValue**: Initial value (typically 40-70, leaving room for gains and losses)\n- **winConditions**: Array of 1-2 conditions the learner must meet for this variable\n\nEach variable must:\n\n- **Represent lesson concepts**: Connect to something the learner studied\n- **Have clear meanings**: Names should be intuitive and unambiguous\n- **Interact meaningfully**: Actions that help one variable should plausibly affect others\n- **Name precisely**: Use specific names (e.g., \"Quantity Demanded\" not \"Market Demand\")\n\n### Win Conditions Structure\n\nEach inventory item's `winConditions` array defines success criteria:\n\n- **operator**: `gte` (>=), `lte` (<=), `gt` (>), `lt` (<), `eq` (==)\n- **value**: Target number the variable must meet\n\n**Common patterns:**\n\n- **Minimum threshold**: `[{ \"operator\": \"gte\", \"value\": 30 }]` — \"Don't let Budget drop below 30\"\n- **Maximum threshold**: `[{ \"operator\": \"lte\", \"value\": 70 }]` — \"Keep Risk below 70\"\n- **Range constraint** (two conditions): `[{ \"operator\": \"gte\", \"value\": 20 }, { \"operator\": \"lte\", \"value\": 80 }]` — \"Keep Budget balanced\"\n\n**Example inventory item:**\n\n```json\n{\n  \"name\": \"Budget\",\n  \"startValue\": 50,\n  \"winConditions\": [\n    { \"operator\": \"gte\", \"value\": 20 },\n    { \"operator\": \"lte\", \"value\": 80 }\n  ]\n}\n```\n\n### Win Condition Achievability Check\n\n**MANDATORY**: Before finalizing, verify each win condition is mathematically achievable:\n\n1. Start with `startValue`, calculate achievable range based on cumulative effects\n2. For `gte` conditions: Target ≤ `startValue + (steps × max_positive_effect_per_step)`\n3. For `lte` conditions: Target ≥ `startValue + (steps × max_negative_effect_per_step)`\n4. Leave margin for strategic flexibility — don't require perfect play to win\n\n**Common mistake**: Setting `lte` targets too LOW or `gte` targets too HIGH. If a variable starts at 55 with max -15 per step across 4 steps, minimum achievable is -5. A target of `lte 5` requires dropping 50 points — verify your effects allow this!\n\n## Step Structure\n\nEach step must have:\n\n- **context**: Maximum 500 characters. Pure dialogue from your colleague setting up the decision. Use a conversational style: no narrator, no character prefixes.\n- **question**: Maximum 100 characters. A clear question about what to do.\n- **options**: **EXACTLY 3-4 choices** (never fewer than 3), each with:\n  - **text**: The choice description (max 80 characters)\n  - **effects**: Array of {variable, change} pairs showing how this choice affects inventory\n  - **feedback**: Why this choice has these effects — max 300 characters. Should explain the reasoning, not just state the outcome.\n\n**CRITICAL**: Every step MUST have at least 3 options. Having only 2 options is a format violation.\n\n## Step Count\n\n- Minimum: 3 steps\n- Maximum: 6 steps\n\n## Tone & Style\n\n- **Pure dialogue**: NO narrator, NO character prefixes, NO action descriptions\n- **Natural conversation**: Colleagues working through a problem together\n- **Professional but warm**: Light humor when appropriate\n- **Second-person immersion**: The colleague speaks TO the learner\n- **Strategic framing**: Dialogue should hint at trade-offs without giving away optimal choices\n\n## The {{NAME}} Placeholder\n\nUse `{{NAME}}` wherever the learner's name should appear. For example:\n\n- \"{{NAME}}, we need to make a call here.\"\n- \"Good thinking, {{NAME}}. But we should consider the trade-offs.\"\n\n## Effect Design\n\nEvery option must:\n\n- **Have meaningful effects**: At least 1-2 variables should change\n- **Show trade-offs**: Most options should help some variables while hurting others\n- **Use realistic magnitudes**: Changes of 5-20 points are typical; dramatic swings (30+) should be rare\n- **Connect to lesson concepts**: The REASON for effects should reflect lesson principles\n\nExample effects structure:\n\n```json\n{\n  \"effects\": [\n    { \"variable\": \"Budget\", \"change\": -15 },\n    { \"variable\": \"Quality\", \"change\": 10 }\n  ]\n}\n```\n\n## Effect Direction: The Measurement Rule\n\n**ONE RULE**: The sign reflects whether the MEASURED NUMBER goes up or down.\n\n### The Algorithm\n\nFor EVERY effect, apply this test:\n\n1. Imagine a meter/gauge displaying the variable's current value as a number\n2. After this action, will the number on that meter be HIGHER or LOWER?\n3. Higher → positive (+) / Lower → negative (-)\n\nThat's it. Ignore whether the outcome is \"good\" or \"bad\" for the player.\n\n### Why This Works\n\nVariables measure QUANTITIES. The sign indicates CHANGE IN QUANTITY:\n\n- Cost measures dollars spent → spending less → number goes DOWN → negative\n- Time measures duration → finishing faster → number goes DOWN → negative\n- Quality measures goodness → better work → number goes UP → positive\n- Risk measures danger level → safer choice → number goes DOWN → negative\n\n### Self-Check\n\nBefore finalizing each effect, ask:\n\n> \"If this variable were displayed as a number on screen, would this action make that number go UP or DOWN?\"\n\n- UP → use positive (+)\n- DOWN → use negative (-)\n\nThe player's happiness about the outcome is IRRELEVANT to the sign.\n\n## What to Avoid\n\n- **Dominant options**: No choice should be obviously best across all variables\n- **Trivial decisions**: Every step should require real thought about trade-offs\n- **Disconnected variables**: Effects should make conceptual sense\n- **Extreme swings**: Avoid changes that guarantee win/loss in one step\n- **Narrator text or descriptions**: Keep it pure dialogue\n- **Quiz-style questions**: This tests strategic thinking and problem-solving, not recall\n- **Inverted effect signs**: Never confuse \"good outcome\" with \"positive change\". Apply the Measurement Rule: would the NUMBER go up or down?\n- **Single-path variables**: NEVER create a variable that can only be improved by ONE option in the entire game. Every win condition variable MUST be influenceable by options in multiple steps. Otherwise, that option becomes mandatory and removes player agency\n\n## Scope\n\n- **Stay focused**: The scenario should require THIS lesson's concepts to navigate well\n- **Meaningful variables**: Each inventory variable should connect to lesson principles\n- **Realistic trade-offs**: The trade-offs should reflect how these concepts work in practice\n\n## Relationship to Previous Activities\n\nThe learner has already completed:\n\n- **Background**: WHY this exists (origin story, problems solved, historical context)\n- **Explanation**: WHAT it is (core concepts, components, definitions)\n- **Mechanics**: HOW it works (processes in action, cause-effect chains)\n- **Examples**: WHERE it appears (real-world contexts, applications)\n- **Story**: WHEN to apply this (dialogue-based problem solving)\n\nYour Challenge activity is the capstone: **CAN YOU HANDLE THIS?** It tests whether learners can apply concepts strategically under constraints. This is the most challenging activity — it should feel like a real test of understanding.\n\n- Background: \"WHY did we need this?\"\n- Explanation: \"WHAT exactly is it?\"\n- Mechanics: \"HOW does it actually work?\"\n- Examples: \"WHERE will I encounter this?\"\n- Story: \"WHEN do I apply this?\"\n- **Challenge: \"CAN I navigate complex trade-offs using this?\"**\n\n# Structure Guide\n\nA typical Challenge follows this arc:\n\n1. **Setup**: Establish the scenario, variables, and goal in the intro\n2. **Initial Decision**: First choice with clear trade-offs to teach the mechanics\n3. **Escalating Complexity**: Middle decisions where variables interact more\n4. **Critical Choice**: A pivotal decision that significantly affects outcomes\n5. **Resolution Setup**: Final decision that determines if win conditions are met\n\nNote: The challenge should feel winnable but require understanding the lesson's principles to succeed consistently.\n\n# Dialogue Tone Examples\n\n## Setting Up Trade-Offs\n\n> \"{{NAME}}, here's our situation. We can push for faster delivery, but that means cutting corners on testing. Or we take our time and risk missing the window. What's our priority?\"\n\n> \"The client wants both lower costs AND higher quality. {{NAME}}, we both know we can't maximize both. Where do we compromise?\"\n\n## Explaining Consequences\n\n> \"Interesting choice, {{NAME}}. Going that route saved us time, but I'm already seeing signs of technical debt building up. Let's see how this plays out.\"\n\n> \"That definitely boosted our short-term numbers. But {{NAME}}, remember — these variables are connected. Watch what happens next.\"\n\n## Strategic Moments\n\n> \"{{NAME}}, we're at a crossroads. Our budget is tight, but team morale is dropping. If we don't address one, the other gets worse. What's your call?\"\n\n> \"This is the big one, {{NAME}}. The choice we make here pretty much determines whether we hit our targets. No pressure.\"\n\n# Quality Checks\n\nBefore finalizing, verify:\n\n- [ ] Does the intro clearly establish the scenario, goal, and stakes?\n- [ ] Do inventory variables connect meaningfully to lesson concepts?\n- [ ] MATHEMATICAL ACHIEVABILITY: For each win condition, is the target mathematically reachable given startValue and cumulative effect ranges? (Calculate: startValue + sum of max effects in desired direction)\n- [ ] Does every option have genuine trade-offs (no dominant choices)?\n- [ ] Do effects make conceptual sense given the lesson content?\n- [ ] Is `{{NAME}}` used appropriately throughout?\n- [ ] Is all dialogue pure conversation (no narrator, no prefixes)?\n- [ ] Does feedback explain WHY effects occur, not just state them?\n- [ ] Is the scope exactly the lesson topic?\n- [ ] Are all constraints met (intro ≤500 chars, context ≤500 chars, question ≤100 chars, text ≤80 chars, feedback ≤300 chars)?\n- [ ] Is the step count between 3 and 6?\n- [ ] Do inventory values start in a reasonable range (typically 40-70)?\n- [ ] Are effect magnitudes reasonable (typically 5-20 points)?\n- [ ] For EACH effect, apply the Measurement Rule: if this variable were a number on screen, would this action make it go UP (+) or DOWN (-)?\n- [ ] Does EVERY step have at least 3 options? (Never just 2 options)\n- [ ] Does each inventory item have at least one win condition?\n- [ ] For each variable, are there multiple options across different steps that can affect it? (No single-path variables)\n\n# Output Format\n\nReturn an object with:\n\n- **intro**: Scenario introduction (max 500 chars)\n- **inventory**: Array of 3-5 inventory items, each with:\n  - **name**: Variable name\n  - **startValue**: Initial value (typically 40-70)\n  - **winConditions**: Array of 1-2 conditions, each with:\n    - **operator**: One of \"gte\", \"lte\", \"gt\", \"lt\", \"eq\"\n    - **value**: Target number\n- **steps**: Array of 3-6 step objects, each with:\n  - **context**: Pure dialogue (max 500 chars)\n  - **question**: Decision prompt (max 100 chars)\n  - **options**: Array of 3-4 objects with:\n    - **text**: Choice description (max 80 chars)\n    - **effects**: Array of {variable, change} pairs\n    - **feedback**: Explanation of effects (max 300 chars)\n",
      "testCaseId": "en-cs-algorithm-complexity-1",
      "userPrompt": "LESSON_TITLE: Algorithm Complexity Trade-offs\nLESSON_DESCRIPTION: Understanding and applying algorithm complexity analysis to make informed trade-offs in software design\nCHAPTER_TITLE: Algorithm Analysis\nCOURSE_TITLE: Data Structures and Algorithms\nLANGUAGE: en\nEXPLANATION_STEPS:\n1. Time Complexity: Time complexity measures how execution time grows with input size. O(n) means linear growth — double the input, double the time. O(n²) means quadratic — double the input, quadruple the time.\n2. Space Complexity: Space complexity measures memory usage growth. Some algorithms trade time for space — storing precomputed results to avoid recalculation. Others trade space for time — using less memory but computing more.\n3. Time-Space Trade-off: The time-space trade-off is fundamental. Hash tables give O(1) lookup but use extra memory. Binary search uses O(1) space but requires sorted data. Choose based on constraints.\n4. Amortized Analysis: Amortized analysis looks at average performance over many operations. ArrayList append is usually O(1), but occasionally O(n) when resizing. Amortized, it's still O(1).\n5. Case Analysis: Best, average, and worst case can differ dramatically. Quicksort averages O(n log n) but worst-cases to O(n²). Know your data distribution to choose wisely."
    },
    {
      "duration": 27737.692124999998,
      "inputTokens": 3537,
      "output": "{\n  \"intro\": \"{{NAME}}, you’re advising a startup selling reusable water bottles. We need a pricing and production plan for the next month. Hit strong profit without causing ugly shortages or piles of unsold stock, and keep customers from turning on us. Your calls will move us along—or shift—supply and demand.\",\n  \"inventory\": [\n    {\n      \"name\": \"Monthly Profit Index\",\n      \"startValue\": 55,\n      \"winConditions\": [\n        {\n          \"operator\": \"gte\",\n          \"value\": 70\n        }\n      ]\n    },\n    {\n      \"name\": \"Inventory Imbalance\",\n      \"startValue\": 45,\n      \"winConditions\": [\n        {\n          \"operator\": \"lte\",\n          \"value\": 55\n        }\n      ]\n    },\n    {\n      \"name\": \"Customer Goodwill\",\n      \"startValue\": 60,\n      \"winConditions\": [\n        {\n          \"operator\": \"gte\",\n          \"value\": 55\n        }\n      ]\n    },\n    {\n      \"name\": \"Unit Cost Level\",\n      \"startValue\": 50,\n      \"winConditions\": [\n        {\n          \"operator\": \"lte\",\n          \"value\": 55\n        }\n      ]\n    }\n  ],\n  \"steps\": [\n    {\n      \"context\": \"{{NAME}}, first decision: set the list price. Our demand is pretty price-sensitive right now, but we also can’t run this like a charity. If we miss equilibrium badly, we’ll feel it immediately.\",\n      \"options\": [\n        {\n          \"effects\": [\n            {\n              \"change\": 15,\n              \"variable\": \"Monthly Profit Index\"\n            },\n            {\n              \"change\": 10,\n              \"variable\": \"Inventory Imbalance\"\n            },\n            {\n              \"change\": -8,\n              \"variable\": \"Customer Goodwill\"\n            }\n          ],\n          \"feedback\": \"A higher price can raise margin, but with elastic-ish demand it cuts quantity demanded and tends to create surplus, pushing imbalance up. Some customers feel squeezed, so goodwill drops.\",\n          \"text\": \"Raise price aggressively\"\n        },\n        {\n          \"effects\": [\n            {\n              \"change\": 6,\n              \"variable\": \"Monthly Profit Index\"\n            },\n            {\n              \"change\": -8,\n              \"variable\": \"Inventory Imbalance\"\n            },\n            {\n              \"change\": 2,\n              \"variable\": \"Customer Goodwill\"\n            }\n          ],\n          \"feedback\": \"A moderate price aims closer to equilibrium: fewer shortages/surpluses, so imbalance falls. You still improve profit some, and customers generally see it as fair.\",\n          \"text\": \"Set a moderate, near-market price\"\n        },\n        {\n          \"effects\": [\n            {\n              \"change\": -5,\n              \"variable\": \"Monthly Profit Index\"\n            },\n            {\n              \"change\": 12,\n              \"variable\": \"Inventory Imbalance\"\n            },\n            {\n              \"change\": 10,\n              \"variable\": \"Customer Goodwill\"\n            }\n          ],\n          \"feedback\": \"A low price boosts quantity demanded, risking shortages if supply can’t keep up—imbalance rises. Goodwill improves, but profit takes a hit from thinner margins (even with more sales).\",\n          \"text\": \"Cut price to gain share\"\n        }\n      ],\n      \"question\": \"How do we price the bottle this month?\"\n    },\n    {\n      \"context\": \"Okay, now production. Suppliers warned us resin prices might jump, so expanding output could get expensive. But if we underproduce after a strong demand month, we’ll be apologizing on social media.\",\n      \"options\": [\n        {\n          \"effects\": [\n            {\n              \"change\": 10,\n              \"variable\": \"Monthly Profit Index\"\n            },\n            {\n              \"change\": -10,\n              \"variable\": \"Inventory Imbalance\"\n            },\n            {\n              \"change\": 10,\n              \"variable\": \"Unit Cost Level\"\n            }\n          ],\n          \"feedback\": \"Ramping output reduces shortage risk (lower imbalance), but overtime, rush shipping, and higher input use raise unit costs. If demand is there, more units sold can lift profit despite cost pressure.\",\n          \"text\": \"Ramp up production hard\"\n        },\n        {\n          \"effects\": [\n            {\n              \"change\": 4,\n              \"variable\": \"Monthly Profit Index\"\n            },\n            {\n              \"change\": -5,\n              \"variable\": \"Inventory Imbalance\"\n            },\n            {\n              \"change\": 3,\n              \"variable\": \"Unit Cost Level\"\n            }\n          ],\n          \"feedback\": \"A measured increase nudges supply toward demand without a huge cost spike. It’s a safer move when you’re unsure whether you’re above or below equilibrium.\",\n          \"text\": \"Increase production slightly\"\n        },\n        {\n          \"effects\": [\n            {\n              \"change\": -2,\n              \"variable\": \"Monthly Profit Index\"\n            },\n            {\n              \"change\": 8,\n              \"variable\": \"Inventory Imbalance\"\n            },\n            {\n              \"change\": -8,\n              \"variable\": \"Unit Cost Level\"\n            }\n          ],\n          \"feedback\": \"Cutting production lowers unit costs by avoiding overtime and waste, but it increases the chance of shortages if demand stays strong—imbalance rises and can cap profit.\",\n          \"text\": \"Hold back production to protect costs\"\n        },\n        {\n          \"effects\": [\n            {\n              \"change\": 2,\n              \"variable\": \"Monthly Profit Index\"\n            },\n            {\n              \"change\": -6,\n              \"variable\": \"Inventory Imbalance\"\n            },\n            {\n              \"change\": -2,\n              \"variable\": \"Unit Cost Level\"\n            },\n            {\n              \"change\": -4,\n              \"variable\": \"Customer Goodwill\"\n            }\n          ],\n          \"feedback\": \"Outsourcing can fill gaps without fully inflating your own unit cost, and it can reduce imbalance. But inconsistent quality/lead times can annoy customers, lowering goodwill.\",\n          \"text\": \"Outsource a portion to a contract manufacturer\"\n        }\n      ],\n      \"question\": \"What’s our supply plan?\"\n    },\n    {\n      \"context\": \"We just got market intel. A popular fitness influencer is about to feature reusable bottles. That’s a demand shifter, not a price move. We can lean into it, ignore it, or try to blunt the risk of whiplash.\",\n      \"options\": [\n        {\n          \"effects\": [\n            {\n              \"change\": 12,\n              \"variable\": \"Monthly Profit Index\"\n            },\n            {\n              \"change\": -6,\n              \"variable\": \"Inventory Imbalance\"\n            },\n            {\n              \"change\": -6,\n              \"variable\": \"Customer Goodwill\"\n            },\n            {\n              \"change\": 4,\n              \"variable\": \"Unit Cost Level\"\n            }\n          ],\n          \"feedback\": \"Riding the hype with a small price bump can raise profit, and the higher price reduces shortage pressure (lower imbalance). But some customers will call it price-gouging, hurting goodwill, and scaling marketing/support can raise costs.\",\n          \"text\": \"Raise price a bit and lean into the hype\"\n        },\n        {\n          \"effects\": [\n            {\n              \"change\": 8,\n              \"variable\": \"Monthly Profit Index\"\n            },\n            {\n              \"change\": 10,\n              \"variable\": \"Inventory Imbalance\"\n            },\n            {\n              \"change\": 6,\n              \"variable\": \"Customer Goodwill\"\n            },\n            {\n              \"change\": 2,\n              \"variable\": \"Unit Cost Level\"\n            }\n          ],\n          \"feedback\": \"Keeping price steady while demand shifts right boosts sales and goodwill. But without enough supply response, you can create shortages—imbalance rises. Some added costs come from support and fulfillment strain.\",\n          \"text\": \"Keep price, run a promo to capture demand\"\n        },\n        {\n          \"effects\": [\n            {\n              \"change\": 4,\n              \"variable\": \"Monthly Profit Index\"\n            },\n            {\n              \"change\": -4,\n              \"variable\": \"Inventory Imbalance\"\n            },\n            {\n              \"change\": 1,\n              \"variable\": \"Customer Goodwill\"\n            },\n            {\n              \"change\": -1,\n              \"variable\": \"Unit Cost Level\"\n            }\n          ],\n          \"feedback\": \"A waitlist/backorder policy manages quantity demanded timing, reducing shortages and smoothing the mismatch (lower imbalance). It’s not as profit-maximizing as full hype mode, but it preserves goodwill and can reduce operational waste.\",\n          \"text\": \"Use waitlist/backorders to smooth demand\"\n        },\n        {\n          \"effects\": [\n            {\n              \"change\": -3,\n              \"variable\": \"Monthly Profit Index\"\n            },\n            {\n              \"change\": -8,\n              \"variable\": \"Inventory Imbalance\"\n            },\n            {\n              \"change\": -2,\n              \"variable\": \"Customer Goodwill\"\n            },\n            {\n              \"change\": -4,\n              \"variable\": \"Unit Cost Level\"\n            }\n          ],\n          \"feedback\": \"Pulling back marketing reduces demand pressure, which lowers imbalance risk, and it can lower unit costs by easing rush operations. But you leave money on the table and look less exciting to customers.\",\n          \"text\": \"Avoid the spotlight; pause extra marketing\"\n        }\n      ],\n      \"question\": \"How do we respond to the demand shift?\"\n    },\n    {\n      \"context\": \"Last call, {{NAME}}. We’re seeing complaints about occasional leaks. Fixing it shifts demand via reputation, but it also changes our costs. We need to choose how hard we go before month-end numbers close.\",\n      \"options\": [\n        {\n          \"effects\": [\n            {\n              \"change\": 10,\n              \"variable\": \"Customer Goodwill\"\n            },\n            {\n              \"change\": -10,\n              \"variable\": \"Inventory Imbalance\"\n            },\n            {\n              \"change\": 8,\n              \"variable\": \"Unit Cost Level\"\n            },\n            {\n              \"change\": -2,\n              \"variable\": \"Monthly Profit Index\"\n            }\n          ],\n          \"feedback\": \"A redesign/QA push improves product perception, shifting demand right through trust and reducing returns (lower imbalance). But better materials and testing raise unit costs, and short-term profit can dip during rework.\",\n          \"text\": \"Invest in redesign + stricter QA now\"\n        },\n        {\n          \"effects\": [\n            {\n              \"change\": 6,\n              \"variable\": \"Customer Goodwill\"\n            },\n            {\n              \"change\": -6,\n              \"variable\": \"Inventory Imbalance\"\n            },\n            {\n              \"change\": 4,\n              \"variable\": \"Unit Cost Level\"\n            },\n            {\n              \"change\": 2,\n              \"variable\": \"Monthly Profit Index\"\n            }\n          ],\n          \"feedback\": \"A targeted fix (better gasket, quick QA checks) boosts goodwill and reduces mismatch from returns without blowing up costs. Profit can still rise if fewer refunds and higher repeat purchases offset the expense.\",\n          \"text\": \"Do a targeted fix and limited QA boost\"\n        },\n        {\n          \"effects\": [\n            {\n              \"change\": -5,\n              \"variable\": \"Customer Goodwill\"\n            },\n            {\n              \"change\": 6,\n              \"variable\": \"Inventory Imbalance\"\n            },\n            {\n              \"change\": -6,\n              \"variable\": \"Unit Cost Level\"\n            },\n            {\n              \"change\": 6,\n              \"variable\": \"Monthly Profit Index\"\n            }\n          ],\n          \"feedback\": \"Ignoring the issue saves cost (unit cost falls) and can lift short-term profit, but goodwill drops and returns/negative reviews increase mismatch between what’s supplied and what customers actually keep (imbalance rises).\",\n          \"text\": \"Defer fixes to protect margins\"\n        }\n      ],\n      \"question\": \"How do we handle the quality issue?\"\n    }\n  ]\n}",
      "outputTokens": 1687,
      "systemPrompt": "# Role\n\nYou are an expert educational game designer creating a **Challenge** activity for a learning app. Your mission is to design a strategic simulation where learners make decisions that affect inventory variables, navigating trade-offs to meet win conditions using the lesson's concepts.\n\nYou specialize in crafting game-like experiences that test strategic thinking and problem-solving — not just knowledge recall, but the ability to apply concepts under constraints.\n\n# The Art of Strategic Learning\n\nA great Challenge activity doesn't quiz — it simulates. Learners face realistic constraints where every choice has consequences. They must think strategically about trade-offs, just like real-world decision-making.\n\n## Why Trade-Off-Based Scenarios Work\n\n1. **Authentic Complexity**: Real problems have multiple variables that interact. Improving one often affects another.\n\n2. **Strategic Reasoning**: Learners must think several steps ahead, considering how choices compound.\n\n3. **No \"Right Answer\"**: When every option has pros and cons, learners engage with the WHY behind principles.\n\n4. **Memorable Stakes**: Managing resources and meeting goals creates emotional investment in outcomes.\n\n## The Trade-Off Principle\n\nEvery great Challenge activity creates genuine dilemmas:\n\n- **No Perfect Options**: Each choice improves some variables while affecting others\n- **Interconnected Systems**: Variables influence each other meaningfully\n- **Strategic Planning**: Success requires thinking beyond the immediate step\n- **Concept Application**: Understanding the lesson's principles helps navigate trade-offs\n\n# Inputs\n\n- `LESSON_TITLE`: The topic to create a challenge around\n- `LESSON_DESCRIPTION`: Additional context about what this lesson covers\n- `CHAPTER_TITLE`: The chapter context (for understanding scope)\n- `COURSE_TITLE`: The course context (for understanding audience level)\n- `LANGUAGE`: Output language\n- `EXPLANATION_STEPS`: Array of {title, text} from all explanation activities (Background, Explanation, Mechanics, Examples) the learner completed before this one\n\n## Language Guidelines\n\n- `en`: Use US English unless the content is region-specific\n- `pt`: Use Brazilian Portuguese unless the content is region-specific\n- `es`: Use Latin American Spanish unless the content is region-specific\n\n# Requirements\n\n## Introduction\n\nThe `intro` field sets the scene (max 500 characters). It should:\n\n- Establish the scenario and the learner's role\n- Explain what they're trying to achieve\n- Create stakes that feel meaningful\n- Use `{{NAME}}` to personalize\n\n## Inventory Design\n\nDesign 3-5 inventory items. Each item includes:\n\n- **name**: Variable name (intuitive, e.g., \"Budget\", \"Team Morale\", \"Code Quality\")\n- **startValue**: Initial value (typically 40-70, leaving room for gains and losses)\n- **winConditions**: Array of 1-2 conditions the learner must meet for this variable\n\nEach variable must:\n\n- **Represent lesson concepts**: Connect to something the learner studied\n- **Have clear meanings**: Names should be intuitive and unambiguous\n- **Interact meaningfully**: Actions that help one variable should plausibly affect others\n- **Name precisely**: Use specific names (e.g., \"Quantity Demanded\" not \"Market Demand\")\n\n### Win Conditions Structure\n\nEach inventory item's `winConditions` array defines success criteria:\n\n- **operator**: `gte` (>=), `lte` (<=), `gt` (>), `lt` (<), `eq` (==)\n- **value**: Target number the variable must meet\n\n**Common patterns:**\n\n- **Minimum threshold**: `[{ \"operator\": \"gte\", \"value\": 30 }]` — \"Don't let Budget drop below 30\"\n- **Maximum threshold**: `[{ \"operator\": \"lte\", \"value\": 70 }]` — \"Keep Risk below 70\"\n- **Range constraint** (two conditions): `[{ \"operator\": \"gte\", \"value\": 20 }, { \"operator\": \"lte\", \"value\": 80 }]` — \"Keep Budget balanced\"\n\n**Example inventory item:**\n\n```json\n{\n  \"name\": \"Budget\",\n  \"startValue\": 50,\n  \"winConditions\": [\n    { \"operator\": \"gte\", \"value\": 20 },\n    { \"operator\": \"lte\", \"value\": 80 }\n  ]\n}\n```\n\n### Win Condition Achievability Check\n\n**MANDATORY**: Before finalizing, verify each win condition is mathematically achievable:\n\n1. Start with `startValue`, calculate achievable range based on cumulative effects\n2. For `gte` conditions: Target ≤ `startValue + (steps × max_positive_effect_per_step)`\n3. For `lte` conditions: Target ≥ `startValue + (steps × max_negative_effect_per_step)`\n4. Leave margin for strategic flexibility — don't require perfect play to win\n\n**Common mistake**: Setting `lte` targets too LOW or `gte` targets too HIGH. If a variable starts at 55 with max -15 per step across 4 steps, minimum achievable is -5. A target of `lte 5` requires dropping 50 points — verify your effects allow this!\n\n## Step Structure\n\nEach step must have:\n\n- **context**: Maximum 500 characters. Pure dialogue from your colleague setting up the decision. Use a conversational style: no narrator, no character prefixes.\n- **question**: Maximum 100 characters. A clear question about what to do.\n- **options**: **EXACTLY 3-4 choices** (never fewer than 3), each with:\n  - **text**: The choice description (max 80 characters)\n  - **effects**: Array of {variable, change} pairs showing how this choice affects inventory\n  - **feedback**: Why this choice has these effects — max 300 characters. Should explain the reasoning, not just state the outcome.\n\n**CRITICAL**: Every step MUST have at least 3 options. Having only 2 options is a format violation.\n\n## Step Count\n\n- Minimum: 3 steps\n- Maximum: 6 steps\n\n## Tone & Style\n\n- **Pure dialogue**: NO narrator, NO character prefixes, NO action descriptions\n- **Natural conversation**: Colleagues working through a problem together\n- **Professional but warm**: Light humor when appropriate\n- **Second-person immersion**: The colleague speaks TO the learner\n- **Strategic framing**: Dialogue should hint at trade-offs without giving away optimal choices\n\n## The {{NAME}} Placeholder\n\nUse `{{NAME}}` wherever the learner's name should appear. For example:\n\n- \"{{NAME}}, we need to make a call here.\"\n- \"Good thinking, {{NAME}}. But we should consider the trade-offs.\"\n\n## Effect Design\n\nEvery option must:\n\n- **Have meaningful effects**: At least 1-2 variables should change\n- **Show trade-offs**: Most options should help some variables while hurting others\n- **Use realistic magnitudes**: Changes of 5-20 points are typical; dramatic swings (30+) should be rare\n- **Connect to lesson concepts**: The REASON for effects should reflect lesson principles\n\nExample effects structure:\n\n```json\n{\n  \"effects\": [\n    { \"variable\": \"Budget\", \"change\": -15 },\n    { \"variable\": \"Quality\", \"change\": 10 }\n  ]\n}\n```\n\n## Effect Direction: The Measurement Rule\n\n**ONE RULE**: The sign reflects whether the MEASURED NUMBER goes up or down.\n\n### The Algorithm\n\nFor EVERY effect, apply this test:\n\n1. Imagine a meter/gauge displaying the variable's current value as a number\n2. After this action, will the number on that meter be HIGHER or LOWER?\n3. Higher → positive (+) / Lower → negative (-)\n\nThat's it. Ignore whether the outcome is \"good\" or \"bad\" for the player.\n\n### Why This Works\n\nVariables measure QUANTITIES. The sign indicates CHANGE IN QUANTITY:\n\n- Cost measures dollars spent → spending less → number goes DOWN → negative\n- Time measures duration → finishing faster → number goes DOWN → negative\n- Quality measures goodness → better work → number goes UP → positive\n- Risk measures danger level → safer choice → number goes DOWN → negative\n\n### Self-Check\n\nBefore finalizing each effect, ask:\n\n> \"If this variable were displayed as a number on screen, would this action make that number go UP or DOWN?\"\n\n- UP → use positive (+)\n- DOWN → use negative (-)\n\nThe player's happiness about the outcome is IRRELEVANT to the sign.\n\n## What to Avoid\n\n- **Dominant options**: No choice should be obviously best across all variables\n- **Trivial decisions**: Every step should require real thought about trade-offs\n- **Disconnected variables**: Effects should make conceptual sense\n- **Extreme swings**: Avoid changes that guarantee win/loss in one step\n- **Narrator text or descriptions**: Keep it pure dialogue\n- **Quiz-style questions**: This tests strategic thinking and problem-solving, not recall\n- **Inverted effect signs**: Never confuse \"good outcome\" with \"positive change\". Apply the Measurement Rule: would the NUMBER go up or down?\n- **Single-path variables**: NEVER create a variable that can only be improved by ONE option in the entire game. Every win condition variable MUST be influenceable by options in multiple steps. Otherwise, that option becomes mandatory and removes player agency\n\n## Scope\n\n- **Stay focused**: The scenario should require THIS lesson's concepts to navigate well\n- **Meaningful variables**: Each inventory variable should connect to lesson principles\n- **Realistic trade-offs**: The trade-offs should reflect how these concepts work in practice\n\n## Relationship to Previous Activities\n\nThe learner has already completed:\n\n- **Background**: WHY this exists (origin story, problems solved, historical context)\n- **Explanation**: WHAT it is (core concepts, components, definitions)\n- **Mechanics**: HOW it works (processes in action, cause-effect chains)\n- **Examples**: WHERE it appears (real-world contexts, applications)\n- **Story**: WHEN to apply this (dialogue-based problem solving)\n\nYour Challenge activity is the capstone: **CAN YOU HANDLE THIS?** It tests whether learners can apply concepts strategically under constraints. This is the most challenging activity — it should feel like a real test of understanding.\n\n- Background: \"WHY did we need this?\"\n- Explanation: \"WHAT exactly is it?\"\n- Mechanics: \"HOW does it actually work?\"\n- Examples: \"WHERE will I encounter this?\"\n- Story: \"WHEN do I apply this?\"\n- **Challenge: \"CAN I navigate complex trade-offs using this?\"**\n\n# Structure Guide\n\nA typical Challenge follows this arc:\n\n1. **Setup**: Establish the scenario, variables, and goal in the intro\n2. **Initial Decision**: First choice with clear trade-offs to teach the mechanics\n3. **Escalating Complexity**: Middle decisions where variables interact more\n4. **Critical Choice**: A pivotal decision that significantly affects outcomes\n5. **Resolution Setup**: Final decision that determines if win conditions are met\n\nNote: The challenge should feel winnable but require understanding the lesson's principles to succeed consistently.\n\n# Dialogue Tone Examples\n\n## Setting Up Trade-Offs\n\n> \"{{NAME}}, here's our situation. We can push for faster delivery, but that means cutting corners on testing. Or we take our time and risk missing the window. What's our priority?\"\n\n> \"The client wants both lower costs AND higher quality. {{NAME}}, we both know we can't maximize both. Where do we compromise?\"\n\n## Explaining Consequences\n\n> \"Interesting choice, {{NAME}}. Going that route saved us time, but I'm already seeing signs of technical debt building up. Let's see how this plays out.\"\n\n> \"That definitely boosted our short-term numbers. But {{NAME}}, remember — these variables are connected. Watch what happens next.\"\n\n## Strategic Moments\n\n> \"{{NAME}}, we're at a crossroads. Our budget is tight, but team morale is dropping. If we don't address one, the other gets worse. What's your call?\"\n\n> \"This is the big one, {{NAME}}. The choice we make here pretty much determines whether we hit our targets. No pressure.\"\n\n# Quality Checks\n\nBefore finalizing, verify:\n\n- [ ] Does the intro clearly establish the scenario, goal, and stakes?\n- [ ] Do inventory variables connect meaningfully to lesson concepts?\n- [ ] MATHEMATICAL ACHIEVABILITY: For each win condition, is the target mathematically reachable given startValue and cumulative effect ranges? (Calculate: startValue + sum of max effects in desired direction)\n- [ ] Does every option have genuine trade-offs (no dominant choices)?\n- [ ] Do effects make conceptual sense given the lesson content?\n- [ ] Is `{{NAME}}` used appropriately throughout?\n- [ ] Is all dialogue pure conversation (no narrator, no prefixes)?\n- [ ] Does feedback explain WHY effects occur, not just state them?\n- [ ] Is the scope exactly the lesson topic?\n- [ ] Are all constraints met (intro ≤500 chars, context ≤500 chars, question ≤100 chars, text ≤80 chars, feedback ≤300 chars)?\n- [ ] Is the step count between 3 and 6?\n- [ ] Do inventory values start in a reasonable range (typically 40-70)?\n- [ ] Are effect magnitudes reasonable (typically 5-20 points)?\n- [ ] For EACH effect, apply the Measurement Rule: if this variable were a number on screen, would this action make it go UP (+) or DOWN (-)?\n- [ ] Does EVERY step have at least 3 options? (Never just 2 options)\n- [ ] Does each inventory item have at least one win condition?\n- [ ] For each variable, are there multiple options across different steps that can affect it? (No single-path variables)\n\n# Output Format\n\nReturn an object with:\n\n- **intro**: Scenario introduction (max 500 chars)\n- **inventory**: Array of 3-5 inventory items, each with:\n  - **name**: Variable name\n  - **startValue**: Initial value (typically 40-70)\n  - **winConditions**: Array of 1-2 conditions, each with:\n    - **operator**: One of \"gte\", \"lte\", \"gt\", \"lt\", \"eq\"\n    - **value**: Target number\n- **steps**: Array of 3-6 step objects, each with:\n  - **context**: Pure dialogue (max 500 chars)\n  - **question**: Decision prompt (max 100 chars)\n  - **options**: Array of 3-4 objects with:\n    - **text**: Choice description (max 80 chars)\n    - **effects**: Array of {variable, change} pairs\n    - **feedback**: Explanation of effects (max 300 chars)\n",
      "testCaseId": "en-economics-supply-demand-1",
      "userPrompt": "LESSON_TITLE: Supply and Demand in Practice\nLESSON_DESCRIPTION: Applying supply and demand principles to make strategic pricing and market decisions\nCHAPTER_TITLE: Market Dynamics\nCOURSE_TITLE: Microeconomics Fundamentals\nLANGUAGE: en\nEXPLANATION_STEPS:\n1. The Demand Curve: Demand curves slope downward — as price rises, quantity demanded falls. This reflects the law of demand: people buy less when things cost more, all else equal.\n2. The Supply Curve: Supply curves slope upward — as price rises, quantity supplied increases. Higher prices incentivize producers to make more. Lower prices make production less worthwhile.\n3. Market Equilibrium: Equilibrium occurs where supply meets demand. At this price, quantity supplied equals quantity demanded. Prices above equilibrium create surplus; prices below create shortage.\n4. Price Elasticity: Price elasticity measures responsiveness to price changes. Elastic demand (>1) means sales drop sharply with price increases. Inelastic demand (<1) means sales barely change.\n5. Shifts vs. Movements: Shifts vs. movements: A change in price moves along the curve. Changes in other factors (income, preferences, costs) shift the entire curve. This distinction is crucial."
    },
    {
      "duration": 31491.211000000003,
      "inputTokens": 3545,
      "output": "{\n  \"intro\": \"{{NAME}}, you’re advising a park manager after a rough year: predator sightings are down, herbivores are up, and visitors are complaining about bare hillsides. You need a plan that stabilizes the food web without overusing the habitat. Keep the ecosystem resilient, avoid a population crash, and stay within what the land can support.\",\n  \"inventory\": [\n    {\n      \"name\": \"Food Web Stability\",\n      \"startValue\": 55,\n      \"winConditions\": [\n        {\n          \"operator\": \"gte\",\n          \"value\": 65\n        }\n      ]\n    },\n    {\n      \"name\": \"Herbivore Pressure\",\n      \"startValue\": 65,\n      \"winConditions\": [\n        {\n          \"operator\": \"lte\",\n          \"value\": 55\n        }\n      ]\n    },\n    {\n      \"name\": \"Biodiversity Index\",\n      \"startValue\": 50,\n      \"winConditions\": [\n        {\n          \"operator\": \"gte\",\n          \"value\": 60\n        }\n      ]\n    },\n    {\n      \"name\": \"Habitat Resource Use\",\n      \"startValue\": 60,\n      \"winConditions\": [\n        {\n          \"operator\": \"lte\",\n          \"value\": 70\n        }\n      ]\n    }\n  ],\n  \"steps\": [\n    {\n      \"context\": \"{{NAME}}, the rangers think our predator population is too low, and the elk are stripping young trees. We can intervene, but every move shifts the whole web. Where do we start?\",\n      \"options\": [\n        {\n          \"effects\": [\n            {\n              \"change\": 14,\n              \"variable\": \"Food Web Stability\"\n            },\n            {\n              \"change\": -12,\n              \"variable\": \"Herbivore Pressure\"\n            },\n            {\n              \"change\": -4,\n              \"variable\": \"Habitat Resource Use\"\n            }\n          ],\n          \"feedback\": \"Reintroducing predators rebuilds top-down control, easing overgrazing (lower herbivore pressure). With fewer herbivores hammering plants, the habitat recovers and resource use drops a bit while the food web becomes more balanced.\",\n          \"text\": \"Reintroduce a small number of predators\"\n        },\n        {\n          \"effects\": [\n            {\n              \"change\": -10,\n              \"variable\": \"Food Web Stability\"\n            },\n            {\n              \"change\": -10,\n              \"variable\": \"Habitat Resource Use\"\n            },\n            {\n              \"change\": -6,\n              \"variable\": \"Herbivore Pressure\"\n            }\n          ],\n          \"feedback\": \"A targeted cull reduces immediate grazing and lowers resource use, but it can destabilize the network if it removes key age/sex classes and doesn’t restore natural predator-prey feedbacks.\",\n          \"text\": \"Reduce herbivores with a targeted cull\"\n        },\n        {\n          \"effects\": [\n            {\n              \"change\": 8,\n              \"variable\": \"Food Web Stability\"\n            },\n            {\n              \"change\": 6,\n              \"variable\": \"Biodiversity Index\"\n            },\n            {\n              \"change\": 10,\n              \"variable\": \"Habitat Resource Use\"\n            }\n          ],\n          \"feedback\": \"Adding water sources and forage boosts multiple species and can smooth short-term stress, but it also increases total resource use and may push the system closer to carrying capacity if populations grow too fast.\",\n          \"text\": \"Boost resources with water points and supplemental forage\"\n        },\n        {\n          \"effects\": [\n            {\n              \"change\": -8,\n              \"variable\": \"Food Web Stability\"\n            },\n            {\n              \"change\": 6,\n              \"variable\": \"Biodiversity Index\"\n            },\n            {\n              \"change\": -6,\n              \"variable\": \"Habitat Resource Use\"\n            }\n          ],\n          \"feedback\": \"Fencing protects hotspots and lets plant communities rebound (succession and diversity improve), but it can fragment movement routes and disrupt interactions, reducing overall food web stability even as resource use drops.\",\n          \"text\": \"Fence sensitive areas to protect regrowth\"\n        }\n      ],\n      \"question\": \"What’s our first intervention?\"\n    },\n    {\n      \"context\": \"Okay, we’ve got a direction. Now the botany team is warning that shrubs and young trees aren’t recruiting, and that could lock us into an early-succession state. But if we push succession too hard, we might squeeze out pioneers. What do you want to manage for?\",\n      \"options\": [\n        {\n          \"effects\": [\n            {\n              \"change\": 12,\n              \"variable\": \"Biodiversity Index\"\n            },\n            {\n              \"change\": -10,\n              \"variable\": \"Herbivore Pressure\"\n            },\n            {\n              \"change\": -6,\n              \"variable\": \"Habitat Resource Use\"\n            }\n          ],\n          \"feedback\": \"Restoring native plant diversity increases resilience and creates more niches. More browse options and structure can spread herbivory across species, reducing concentrated pressure, and healthier vegetation can lower overall resource stress.\",\n          \"text\": \"Restore native plant diversity across riparian zones\"\n        },\n        {\n          \"effects\": [\n            {\n              \"change\": 10,\n              \"variable\": \"Food Web Stability\"\n            },\n            {\n              \"change\": 5,\n              \"variable\": \"Biodiversity Index\"\n            },\n            {\n              \"change\": 8,\n              \"variable\": \"Habitat Resource Use\"\n            }\n          ],\n          \"feedback\": \"Prescribed burns reset patches to pioneer stages, creating a mosaic that supports varied species and stabilizes dynamics. But regrowth is resource-hungry at first, raising habitat resource use.\",\n          \"text\": \"Use prescribed burns to create a patchwork mosaic\"\n        },\n        {\n          \"effects\": [\n            {\n              \"change\": -8,\n              \"variable\": \"Biodiversity Index\"\n            },\n            {\n              \"change\": -10,\n              \"variable\": \"Habitat Resource Use\"\n            },\n            {\n              \"change\": -6,\n              \"variable\": \"Food Web Stability\"\n            }\n          ],\n          \"feedback\": \"Prioritizing one fast-growing species simplifies management and reduces near-term resource use, but it lowers biodiversity and makes the system less resilient—small shocks can ripple harder through the web.\",\n          \"text\": \"Prioritize a single fast-growing plant for quick cover\"\n        },\n        {\n          \"effects\": [\n            {\n              \"change\": 4,\n              \"variable\": \"Food Web Stability\"\n            },\n            {\n              \"change\": -12,\n              \"variable\": \"Habitat Resource Use\"\n            },\n            {\n              \"change\": 2,\n              \"variable\": \"Biodiversity Index\"\n            }\n          ],\n          \"feedback\": \"Removing invasives relieves competition and reduces resource drain. It helps multiple natives rebound (small biodiversity gain) and can improve stability, but it’s slower than direct replanting.\",\n          \"text\": \"Intensify invasive species removal and monitoring\"\n        }\n      ],\n      \"question\": \"How should we steer succession this season?\"\n    },\n    {\n      \"context\": \"{{NAME}}, the latest counts show herbivores rebounding in some valleys. The public is split: some want “hands off,” others want aggressive control. Meanwhile, we can’t exceed what the habitat can sustain. How do we manage carrying capacity risks?\",\n      \"options\": [\n        {\n          \"effects\": [\n            {\n              \"change\": -14,\n              \"variable\": \"Habitat Resource Use\"\n            },\n            {\n              \"change\": -6,\n              \"variable\": \"Food Web Stability\"\n            },\n            {\n              \"change\": -4,\n              \"variable\": \"Herbivore Pressure\"\n            }\n          ],\n          \"feedback\": \"Letting the system self-regulate reduces management inputs and overall resource use, but if predators and vegetation are still out of sync, the mismatch can keep stability low and herbivore pressure only slowly improves.\",\n          \"text\": \"Do minimal intervention and monitor closely\"\n        },\n        {\n          \"effects\": [\n            {\n              \"change\": -12,\n              \"variable\": \"Habitat Resource Use\"\n            },\n            {\n              \"change\": -10,\n              \"variable\": \"Herbivore Pressure\"\n            },\n            {\n              \"change\": 4,\n              \"variable\": \"Food Web Stability\"\n            }\n          ],\n          \"feedback\": \"Contraception slows population growth without sudden die-offs, easing pressure and reducing total resource use over time. Stability improves modestly because the change is gradual, though it doesn’t rebuild trophic links like predators do.\",\n          \"text\": \"Use fertility control in high-density herds\"\n        },\n        {\n          \"effects\": [\n            {\n              \"change\": -16,\n              \"variable\": \"Herbivore Pressure\"\n            },\n            {\n              \"change\": -8,\n              \"variable\": \"Habitat Resource Use\"\n            },\n            {\n              \"change\": -8,\n              \"variable\": \"Biodiversity Index\"\n            }\n          ],\n          \"feedback\": \"Moving animals out quickly reduces grazing and resource use, but it can simplify local interactions and disturb dispersal patterns; losing a major herbivore presence can reduce habitat heterogeneity that supports some species.\",\n          \"text\": \"Relocate herbivores to reduce local density fast\"\n        },\n        {\n          \"effects\": [\n            {\n              \"change\": -14,\n              \"variable\": \"Herbivore Pressure\"\n            },\n            {\n              \"change\": 8,\n              \"variable\": \"Food Web Stability\"\n            },\n            {\n              \"change\": -6,\n              \"variable\": \"Biodiversity Index\"\n            },\n            {\n              \"change\": 4,\n              \"variable\": \"Habitat Resource Use\"\n            }\n          ],\n          \"feedback\": \"Strategic predator protection (corridors, conflict mitigation) strengthens top-down control and stabilizes the web, lowering herbivore pressure. But it can reduce some prey-dependent scavengers or edge species temporarily, and it requires resources to implement.\",\n          \"text\": \"Protect predator corridors and reduce human-wildlife conflict\"\n        }\n      ],\n      \"question\": \"What’s our move to stay under carrying capacity?\"\n    },\n    {\n      \"context\": \"We’re close to the seasonal deadline, {{NAME}}. The board wants a clear plan that improves resilience and avoids a vegetation crash. We can make one more big push: prioritize stability, biodiversity, or low resource use. What do you want to lock in?\",\n      \"options\": [\n        {\n          \"effects\": [\n            {\n              \"change\": 10,\n              \"variable\": \"Food Web Stability\"\n            },\n            {\n              \"change\": -10,\n              \"variable\": \"Herbivore Pressure\"\n            },\n            {\n              \"change\": 6,\n              \"variable\": \"Habitat Resource Use\"\n            }\n          ],\n          \"feedback\": \"A focused predator-prey management package strengthens trophic links and reduces grazing pressure, but it requires staff time, outreach, and monitoring—raising habitat resource use through management intensity.\",\n          \"text\": \"Double down on trophic balance (predators + monitoring)\"\n        },\n        {\n          \"effects\": [\n            {\n              \"change\": 12,\n              \"variable\": \"Biodiversity Index\"\n            },\n            {\n              \"change\": -6,\n              \"variable\": \"Food Web Stability\"\n            },\n            {\n              \"change\": 4,\n              \"variable\": \"Habitat Resource Use\"\n            }\n          ],\n          \"feedback\": \"Creating microhabitats and species-rich plantings boosts resilience, but complexity can temporarily reduce stability while species re-sort, and added restoration work increases resource use.\",\n          \"text\": \"Invest in biodiversity hotspots and habitat complexity\"\n        },\n        {\n          \"effects\": [\n            {\n              \"change\": -12,\n              \"variable\": \"Habitat Resource Use\"\n            },\n            {\n              \"change\": -6,\n              \"variable\": \"Biodiversity Index\"\n            },\n            {\n              \"change\": -4,\n              \"variable\": \"Food Web Stability\"\n            }\n          ],\n          \"feedback\": \"Cutting projects and access reduces disturbance and resource use, but fewer interventions can slow recovery and reduced habitat work can lower biodiversity gains and stability improvements.\",\n          \"text\": \"Scale back interventions to reduce overall resource use\"\n        },\n        {\n          \"effects\": [\n            {\n              \"change\": -8,\n              \"variable\": \"Habitat Resource Use\"\n            },\n            {\n              \"change\": 8,\n              \"variable\": \"Food Web Stability\"\n            },\n            {\n              \"change\": 6,\n              \"variable\": \"Biodiversity Index\"\n            }\n          ],\n          \"feedback\": \"A mixed strategy builds redundancy (biodiversity) while reinforcing key interactions (stability), and it avoids overinvesting in any single lever—keeping resource use in check with targeted actions.\",\n          \"text\": \"Balance actions: moderate restoration + targeted predator support\"\n        }\n      ],\n      \"question\": \"What final priority do we commit to?\"\n    }\n  ]\n}",
      "outputTokens": 1904,
      "systemPrompt": "# Role\n\nYou are an expert educational game designer creating a **Challenge** activity for a learning app. Your mission is to design a strategic simulation where learners make decisions that affect inventory variables, navigating trade-offs to meet win conditions using the lesson's concepts.\n\nYou specialize in crafting game-like experiences that test strategic thinking and problem-solving — not just knowledge recall, but the ability to apply concepts under constraints.\n\n# The Art of Strategic Learning\n\nA great Challenge activity doesn't quiz — it simulates. Learners face realistic constraints where every choice has consequences. They must think strategically about trade-offs, just like real-world decision-making.\n\n## Why Trade-Off-Based Scenarios Work\n\n1. **Authentic Complexity**: Real problems have multiple variables that interact. Improving one often affects another.\n\n2. **Strategic Reasoning**: Learners must think several steps ahead, considering how choices compound.\n\n3. **No \"Right Answer\"**: When every option has pros and cons, learners engage with the WHY behind principles.\n\n4. **Memorable Stakes**: Managing resources and meeting goals creates emotional investment in outcomes.\n\n## The Trade-Off Principle\n\nEvery great Challenge activity creates genuine dilemmas:\n\n- **No Perfect Options**: Each choice improves some variables while affecting others\n- **Interconnected Systems**: Variables influence each other meaningfully\n- **Strategic Planning**: Success requires thinking beyond the immediate step\n- **Concept Application**: Understanding the lesson's principles helps navigate trade-offs\n\n# Inputs\n\n- `LESSON_TITLE`: The topic to create a challenge around\n- `LESSON_DESCRIPTION`: Additional context about what this lesson covers\n- `CHAPTER_TITLE`: The chapter context (for understanding scope)\n- `COURSE_TITLE`: The course context (for understanding audience level)\n- `LANGUAGE`: Output language\n- `EXPLANATION_STEPS`: Array of {title, text} from all explanation activities (Background, Explanation, Mechanics, Examples) the learner completed before this one\n\n## Language Guidelines\n\n- `en`: Use US English unless the content is region-specific\n- `pt`: Use Brazilian Portuguese unless the content is region-specific\n- `es`: Use Latin American Spanish unless the content is region-specific\n\n# Requirements\n\n## Introduction\n\nThe `intro` field sets the scene (max 500 characters). It should:\n\n- Establish the scenario and the learner's role\n- Explain what they're trying to achieve\n- Create stakes that feel meaningful\n- Use `{{NAME}}` to personalize\n\n## Inventory Design\n\nDesign 3-5 inventory items. Each item includes:\n\n- **name**: Variable name (intuitive, e.g., \"Budget\", \"Team Morale\", \"Code Quality\")\n- **startValue**: Initial value (typically 40-70, leaving room for gains and losses)\n- **winConditions**: Array of 1-2 conditions the learner must meet for this variable\n\nEach variable must:\n\n- **Represent lesson concepts**: Connect to something the learner studied\n- **Have clear meanings**: Names should be intuitive and unambiguous\n- **Interact meaningfully**: Actions that help one variable should plausibly affect others\n- **Name precisely**: Use specific names (e.g., \"Quantity Demanded\" not \"Market Demand\")\n\n### Win Conditions Structure\n\nEach inventory item's `winConditions` array defines success criteria:\n\n- **operator**: `gte` (>=), `lte` (<=), `gt` (>), `lt` (<), `eq` (==)\n- **value**: Target number the variable must meet\n\n**Common patterns:**\n\n- **Minimum threshold**: `[{ \"operator\": \"gte\", \"value\": 30 }]` — \"Don't let Budget drop below 30\"\n- **Maximum threshold**: `[{ \"operator\": \"lte\", \"value\": 70 }]` — \"Keep Risk below 70\"\n- **Range constraint** (two conditions): `[{ \"operator\": \"gte\", \"value\": 20 }, { \"operator\": \"lte\", \"value\": 80 }]` — \"Keep Budget balanced\"\n\n**Example inventory item:**\n\n```json\n{\n  \"name\": \"Budget\",\n  \"startValue\": 50,\n  \"winConditions\": [\n    { \"operator\": \"gte\", \"value\": 20 },\n    { \"operator\": \"lte\", \"value\": 80 }\n  ]\n}\n```\n\n### Win Condition Achievability Check\n\n**MANDATORY**: Before finalizing, verify each win condition is mathematically achievable:\n\n1. Start with `startValue`, calculate achievable range based on cumulative effects\n2. For `gte` conditions: Target ≤ `startValue + (steps × max_positive_effect_per_step)`\n3. For `lte` conditions: Target ≥ `startValue + (steps × max_negative_effect_per_step)`\n4. Leave margin for strategic flexibility — don't require perfect play to win\n\n**Common mistake**: Setting `lte` targets too LOW or `gte` targets too HIGH. If a variable starts at 55 with max -15 per step across 4 steps, minimum achievable is -5. A target of `lte 5` requires dropping 50 points — verify your effects allow this!\n\n## Step Structure\n\nEach step must have:\n\n- **context**: Maximum 500 characters. Pure dialogue from your colleague setting up the decision. Use a conversational style: no narrator, no character prefixes.\n- **question**: Maximum 100 characters. A clear question about what to do.\n- **options**: **EXACTLY 3-4 choices** (never fewer than 3), each with:\n  - **text**: The choice description (max 80 characters)\n  - **effects**: Array of {variable, change} pairs showing how this choice affects inventory\n  - **feedback**: Why this choice has these effects — max 300 characters. Should explain the reasoning, not just state the outcome.\n\n**CRITICAL**: Every step MUST have at least 3 options. Having only 2 options is a format violation.\n\n## Step Count\n\n- Minimum: 3 steps\n- Maximum: 6 steps\n\n## Tone & Style\n\n- **Pure dialogue**: NO narrator, NO character prefixes, NO action descriptions\n- **Natural conversation**: Colleagues working through a problem together\n- **Professional but warm**: Light humor when appropriate\n- **Second-person immersion**: The colleague speaks TO the learner\n- **Strategic framing**: Dialogue should hint at trade-offs without giving away optimal choices\n\n## The {{NAME}} Placeholder\n\nUse `{{NAME}}` wherever the learner's name should appear. For example:\n\n- \"{{NAME}}, we need to make a call here.\"\n- \"Good thinking, {{NAME}}. But we should consider the trade-offs.\"\n\n## Effect Design\n\nEvery option must:\n\n- **Have meaningful effects**: At least 1-2 variables should change\n- **Show trade-offs**: Most options should help some variables while hurting others\n- **Use realistic magnitudes**: Changes of 5-20 points are typical; dramatic swings (30+) should be rare\n- **Connect to lesson concepts**: The REASON for effects should reflect lesson principles\n\nExample effects structure:\n\n```json\n{\n  \"effects\": [\n    { \"variable\": \"Budget\", \"change\": -15 },\n    { \"variable\": \"Quality\", \"change\": 10 }\n  ]\n}\n```\n\n## Effect Direction: The Measurement Rule\n\n**ONE RULE**: The sign reflects whether the MEASURED NUMBER goes up or down.\n\n### The Algorithm\n\nFor EVERY effect, apply this test:\n\n1. Imagine a meter/gauge displaying the variable's current value as a number\n2. After this action, will the number on that meter be HIGHER or LOWER?\n3. Higher → positive (+) / Lower → negative (-)\n\nThat's it. Ignore whether the outcome is \"good\" or \"bad\" for the player.\n\n### Why This Works\n\nVariables measure QUANTITIES. The sign indicates CHANGE IN QUANTITY:\n\n- Cost measures dollars spent → spending less → number goes DOWN → negative\n- Time measures duration → finishing faster → number goes DOWN → negative\n- Quality measures goodness → better work → number goes UP → positive\n- Risk measures danger level → safer choice → number goes DOWN → negative\n\n### Self-Check\n\nBefore finalizing each effect, ask:\n\n> \"If this variable were displayed as a number on screen, would this action make that number go UP or DOWN?\"\n\n- UP → use positive (+)\n- DOWN → use negative (-)\n\nThe player's happiness about the outcome is IRRELEVANT to the sign.\n\n## What to Avoid\n\n- **Dominant options**: No choice should be obviously best across all variables\n- **Trivial decisions**: Every step should require real thought about trade-offs\n- **Disconnected variables**: Effects should make conceptual sense\n- **Extreme swings**: Avoid changes that guarantee win/loss in one step\n- **Narrator text or descriptions**: Keep it pure dialogue\n- **Quiz-style questions**: This tests strategic thinking and problem-solving, not recall\n- **Inverted effect signs**: Never confuse \"good outcome\" with \"positive change\". Apply the Measurement Rule: would the NUMBER go up or down?\n- **Single-path variables**: NEVER create a variable that can only be improved by ONE option in the entire game. Every win condition variable MUST be influenceable by options in multiple steps. Otherwise, that option becomes mandatory and removes player agency\n\n## Scope\n\n- **Stay focused**: The scenario should require THIS lesson's concepts to navigate well\n- **Meaningful variables**: Each inventory variable should connect to lesson principles\n- **Realistic trade-offs**: The trade-offs should reflect how these concepts work in practice\n\n## Relationship to Previous Activities\n\nThe learner has already completed:\n\n- **Background**: WHY this exists (origin story, problems solved, historical context)\n- **Explanation**: WHAT it is (core concepts, components, definitions)\n- **Mechanics**: HOW it works (processes in action, cause-effect chains)\n- **Examples**: WHERE it appears (real-world contexts, applications)\n- **Story**: WHEN to apply this (dialogue-based problem solving)\n\nYour Challenge activity is the capstone: **CAN YOU HANDLE THIS?** It tests whether learners can apply concepts strategically under constraints. This is the most challenging activity — it should feel like a real test of understanding.\n\n- Background: \"WHY did we need this?\"\n- Explanation: \"WHAT exactly is it?\"\n- Mechanics: \"HOW does it actually work?\"\n- Examples: \"WHERE will I encounter this?\"\n- Story: \"WHEN do I apply this?\"\n- **Challenge: \"CAN I navigate complex trade-offs using this?\"**\n\n# Structure Guide\n\nA typical Challenge follows this arc:\n\n1. **Setup**: Establish the scenario, variables, and goal in the intro\n2. **Initial Decision**: First choice with clear trade-offs to teach the mechanics\n3. **Escalating Complexity**: Middle decisions where variables interact more\n4. **Critical Choice**: A pivotal decision that significantly affects outcomes\n5. **Resolution Setup**: Final decision that determines if win conditions are met\n\nNote: The challenge should feel winnable but require understanding the lesson's principles to succeed consistently.\n\n# Dialogue Tone Examples\n\n## Setting Up Trade-Offs\n\n> \"{{NAME}}, here's our situation. We can push for faster delivery, but that means cutting corners on testing. Or we take our time and risk missing the window. What's our priority?\"\n\n> \"The client wants both lower costs AND higher quality. {{NAME}}, we both know we can't maximize both. Where do we compromise?\"\n\n## Explaining Consequences\n\n> \"Interesting choice, {{NAME}}. Going that route saved us time, but I'm already seeing signs of technical debt building up. Let's see how this plays out.\"\n\n> \"That definitely boosted our short-term numbers. But {{NAME}}, remember — these variables are connected. Watch what happens next.\"\n\n## Strategic Moments\n\n> \"{{NAME}}, we're at a crossroads. Our budget is tight, but team morale is dropping. If we don't address one, the other gets worse. What's your call?\"\n\n> \"This is the big one, {{NAME}}. The choice we make here pretty much determines whether we hit our targets. No pressure.\"\n\n# Quality Checks\n\nBefore finalizing, verify:\n\n- [ ] Does the intro clearly establish the scenario, goal, and stakes?\n- [ ] Do inventory variables connect meaningfully to lesson concepts?\n- [ ] MATHEMATICAL ACHIEVABILITY: For each win condition, is the target mathematically reachable given startValue and cumulative effect ranges? (Calculate: startValue + sum of max effects in desired direction)\n- [ ] Does every option have genuine trade-offs (no dominant choices)?\n- [ ] Do effects make conceptual sense given the lesson content?\n- [ ] Is `{{NAME}}` used appropriately throughout?\n- [ ] Is all dialogue pure conversation (no narrator, no prefixes)?\n- [ ] Does feedback explain WHY effects occur, not just state them?\n- [ ] Is the scope exactly the lesson topic?\n- [ ] Are all constraints met (intro ≤500 chars, context ≤500 chars, question ≤100 chars, text ≤80 chars, feedback ≤300 chars)?\n- [ ] Is the step count between 3 and 6?\n- [ ] Do inventory values start in a reasonable range (typically 40-70)?\n- [ ] Are effect magnitudes reasonable (typically 5-20 points)?\n- [ ] For EACH effect, apply the Measurement Rule: if this variable were a number on screen, would this action make it go UP (+) or DOWN (-)?\n- [ ] Does EVERY step have at least 3 options? (Never just 2 options)\n- [ ] Does each inventory item have at least one win condition?\n- [ ] For each variable, are there multiple options across different steps that can affect it? (No single-path variables)\n\n# Output Format\n\nReturn an object with:\n\n- **intro**: Scenario introduction (max 500 chars)\n- **inventory**: Array of 3-5 inventory items, each with:\n  - **name**: Variable name\n  - **startValue**: Initial value (typically 40-70)\n  - **winConditions**: Array of 1-2 conditions, each with:\n    - **operator**: One of \"gte\", \"lte\", \"gt\", \"lt\", \"eq\"\n    - **value**: Target number\n- **steps**: Array of 3-6 step objects, each with:\n  - **context**: Pure dialogue (max 500 chars)\n  - **question**: Decision prompt (max 100 chars)\n  - **options**: Array of 3-4 objects with:\n    - **text**: Choice description (max 80 chars)\n    - **effects**: Array of {variable, change} pairs\n    - **feedback**: Explanation of effects (max 300 chars)\n",
      "testCaseId": "en-biology-ecosystem-balance-1",
      "userPrompt": "LESSON_TITLE: Ecosystem Balance and Management\nLESSON_DESCRIPTION: Applying ecological principles to make informed ecosystem management decisions\nCHAPTER_TITLE: Ecosystem Dynamics\nCOURSE_TITLE: Ecology and Conservation\nLANGUAGE: en\nEXPLANATION_STEPS:\n1. Interconnected Networks: Ecosystems are interconnected networks. Removing one species affects others through food webs. Keystone species have disproportionate impact — their loss cascades through the system.\n2. Carrying Capacity: Carrying capacity is the maximum population an environment can sustain. Exceed it, and resources deplete, populations crash. Stay well below, and you're not maximizing the ecosystem's potential.\n3. Biodiversity and Resilience: Biodiversity provides resilience. More species means more ways to respond to change. Monocultures are efficient but fragile. Diverse systems are robust but complex to manage.\n4. Trophic Cascades: Trophic cascades occur when changes at one level ripple through others. Remove predators, and prey populations explode, overgrazing vegetation, affecting everything that depends on those plants.\n5. Ecological Succession: Ecological succession is the process of change over time. Pioneer species prepare the way for later ones. Managing ecosystems means deciding where in succession you want to be."
    },
    {
      "duration": 33054.885166,
      "inputTokens": 3597,
      "output": "{\n  \"intro\": \"{{NAME}}, a planta está rodando uma reação gasosa reversível para maximizar o rendimento de produto. Só que o cliente quer mais produção hoje, o financeiro quer menos custo e a segurança está de olho na pressão. Você vai ajustar condições usando Le Chatelier sem estourar o orçamento nem o risco. O que você muda primeiro?\",\n  \"inventory\": [\n    {\n      \"name\": \"Rendimento de Produto (%)\",\n      \"startValue\": 55,\n      \"winConditions\": [\n        {\n          \"operator\": \"gte\",\n          \"value\": 70\n        }\n      ]\n    },\n    {\n      \"name\": \"Custo Operacional\",\n      \"startValue\": 55,\n      \"winConditions\": [\n        {\n          \"operator\": \"lte\",\n          \"value\": 70\n        }\n      ]\n    },\n    {\n      \"name\": \"Risco de Segurança\",\n      \"startValue\": 45,\n      \"winConditions\": [\n        {\n          \"operator\": \"lte\",\n          \"value\": 65\n        }\n      ]\n    },\n    {\n      \"name\": \"Tempo para Estabilizar\",\n      \"startValue\": 60,\n      \"winConditions\": [\n        {\n          \"operator\": \"lte\",\n          \"value\": 55\n        }\n      ]\n    }\n  ],\n  \"steps\": [\n    {\n      \"context\": \"{{NAME}}, nosso equilíbrio é em fase gasosa e o lado dos produtos tem menos mols de gás. Se a gente mexer na pressão agora, mexe no rendimento — mas a equipe de segurança já está sensível com qualquer aumento.\",\n      \"options\": [\n        {\n          \"effects\": [\n            {\n              \"change\": 12,\n              \"variable\": \"Rendimento de Produto (%)\"\n            },\n            {\n              \"change\": 10,\n              \"variable\": \"Risco de Segurança\"\n            },\n            {\n              \"change\": 8,\n              \"variable\": \"Custo Operacional\"\n            }\n          ],\n          \"feedback\": \"Aumentar a pressão favorece o lado com menos mols gasosos, então empurra para produtos e sobe o rendimento. Mas pressão maior eleva risco de falha/escape e custa mais energia de compressão.\",\n          \"text\": \"Aumentar a pressão do reator (compressão)\"\n        },\n        {\n          \"effects\": [\n            {\n              \"change\": -8,\n              \"variable\": \"Rendimento de Produto (%)\"\n            },\n            {\n              \"change\": -10,\n              \"variable\": \"Risco de Segurança\"\n            },\n            {\n              \"change\": -6,\n              \"variable\": \"Custo Operacional\"\n            }\n          ],\n          \"feedback\": \"Diminuir a pressão favorece o lado com mais mols de gás, então puxa o equilíbrio para reagentes e reduz rendimento. Em compensação, baixa risco e reduz gasto com compressão.\",\n          \"text\": \"Diminuir a pressão para aliviar operação\"\n        },\n        {\n          \"effects\": [\n            {\n              \"change\": 0,\n              \"variable\": \"Rendimento de Produto (%)\"\n            },\n            {\n              \"change\": -6,\n              \"variable\": \"Risco de Segurança\"\n            },\n            {\n              \"change\": 4,\n              \"variable\": \"Custo Operacional\"\n            }\n          ],\n          \"feedback\": \"Adicionar gás inerte a volume constante não desloca o equilíbrio (pressões parciais efetivas não mudam o K), mas aumenta inventário/pressão total e complexidade de controle, elevando custo e afetando segurança.\",\n          \"text\": \"Adicionar gás inerte para estabilizar controle\"\n        },\n        {\n          \"effects\": [\n            {\n              \"change\": 0,\n              \"variable\": \"Rendimento de Produto (%)\"\n            },\n            {\n              \"change\": -10,\n              \"variable\": \"Custo Operacional\"\n            },\n            {\n              \"change\": 3,\n              \"variable\": \"Tempo para Estabilizar\"\n            }\n          ],\n          \"feedback\": \"Não mexer nas variáveis de equilíbrio mantém o rendimento, mas otimizar utilidades e perdas reduz custo. Sem intervenção no equilíbrio, o sistema pode demorar mais para “assentar” no ponto atual.\",\n          \"text\": \"Manter pressão e focar em eficiência de utilidades\"\n        }\n      ],\n      \"question\": \"Qual ajuste de pressão você faz?\"\n    },\n    {\n      \"context\": \"Ok, agora sobre composição: temos um pouco de produto acumulando na linha e isso está freando a conversão. Dá pra mexer na concentração, mas qualquer manobra mexe com custo e estabilidade do processo.\",\n      \"options\": [\n        {\n          \"effects\": [\n            {\n              \"change\": 10,\n              \"variable\": \"Rendimento de Produto (%)\"\n            },\n            {\n              \"change\": 9,\n              \"variable\": \"Custo Operacional\"\n            },\n            {\n              \"change\": 5,\n              \"variable\": \"Risco de Segurança\"\n            }\n          ],\n          \"feedback\": \"Adicionar reagente desloca o equilíbrio para consumir o que foi adicionado, favorecendo produtos. Mas você paga mais matéria-prima e aumenta vazão/inventário, elevando complexidade e risco.\",\n          \"text\": \"Aumentar alimentação de reagente limitante\"\n        },\n        {\n          \"effects\": [\n            {\n              \"change\": 12,\n              \"variable\": \"Rendimento de Produto (%)\"\n            },\n            {\n              \"change\": 6,\n              \"variable\": \"Custo Operacional\"\n            },\n            {\n              \"change\": 3,\n              \"variable\": \"Risco de Segurança\"\n            }\n          ],\n          \"feedback\": \"Remover produto desloca o equilíbrio para formar mais produto (Le Chatelier). Exige separação/condensação extra (custo) e mais equipamentos/linhas ativas aumentam risco operacional.\",\n          \"text\": \"Remover produto continuamente (separação in situ)\"\n        },\n        {\n          \"effects\": [\n            {\n              \"change\": -10,\n              \"variable\": \"Custo Operacional\"\n            },\n            {\n              \"change\": -4,\n              \"variable\": \"Risco de Segurança\"\n            },\n            {\n              \"change\": -4,\n              \"variable\": \"Rendimento de Produto (%)\"\n            }\n          ],\n          \"feedback\": \"Reduzir a taxa de produção diminui consumo e esforço de separação, baixando custo e risco. Só que, com menos remoção/impulso operacional, você perde conversão efetiva e o rendimento cai.\",\n          \"text\": \"Reduzir vazão para economizar e operar folgado\"\n        },\n        {\n          \"effects\": [\n            {\n              \"change\": 0,\n              \"variable\": \"Rendimento de Produto (%)\"\n            },\n            {\n              \"change\": -6,\n              \"variable\": \"Custo Operacional\"\n            },\n            {\n              \"change\": 6,\n              \"variable\": \"Tempo para Estabilizar\"\n            }\n          ],\n          \"feedback\": \"“Esperar equalizar” evita intervenções e economiza recursos no curto prazo, mas não cria nenhum deslocamento favorável; o sistema pode levar mais tempo para estabilizar em um ponto útil.\",\n          \"text\": \"Não mexer na composição e esperar estabilizar\"\n        }\n      ],\n      \"question\": \"Como você usa concentração a seu favor?\"\n    },\n    {\n      \"context\": \"Agora vem a parte que dá confusão: temperatura. A reação principal é exotérmica. Se você aquece ou esfria, você não só desloca o equilíbrio — você muda o K. E isso ainda impacta consumo de energia e segurança térmica.\",\n      \"options\": [\n        {\n          \"effects\": [\n            {\n              \"change\": -10,\n              \"variable\": \"Rendimento de Produto (%)\"\n            },\n            {\n              \"change\": 8,\n              \"variable\": \"Custo Operacional\"\n            },\n            {\n              \"change\": 6,\n              \"variable\": \"Risco de Segurança\"\n            },\n            {\n              \"change\": -4,\n              \"variable\": \"Tempo para Estabilizar\"\n            }\n          ],\n          \"feedback\": \"Em reação exotérmica, aumentar temperatura favorece reagentes (equilíbrio vai contra a formação de produto), então o rendimento cai. Você gasta mais energia e aumenta risco térmico, mas a cinética fica mais rápida e estabiliza antes.\",\n          \"text\": \"Aumentar a temperatura para acelerar a cinética\"\n        },\n        {\n          \"effects\": [\n            {\n              \"change\": 12,\n              \"variable\": \"Rendimento de Produto (%)\"\n            },\n            {\n              \"change\": 7,\n              \"variable\": \"Custo Operacional\"\n            },\n            {\n              \"change\": -3,\n              \"variable\": \"Risco de Segurança\"\n            },\n            {\n              \"change\": 5,\n              \"variable\": \"Tempo para Estabilizar\"\n            }\n          ],\n          \"feedback\": \"Para reação exotérmica, reduzir temperatura favorece produtos, aumentando rendimento. Porém resfriar custa energia/utilidades e pode tornar a cinética mais lenta, aumentando o tempo para estabilizar; o risco térmico tende a cair.\",\n          \"text\": \"Diminuir a temperatura para favorecer produtos\"\n        },\n        {\n          \"effects\": [\n            {\n              \"change\": 0,\n              \"variable\": \"Rendimento de Produto (%)\"\n            },\n            {\n              \"change\": -6,\n              \"variable\": \"Custo Operacional\"\n            },\n            {\n              \"change\": -2,\n              \"variable\": \"Risco de Segurança\"\n            },\n            {\n              \"change\": 4,\n              \"variable\": \"Tempo para Estabilizar\"\n            }\n          ],\n          \"feedback\": \"Manter a temperatura e melhorar a troca térmica reduz gasto energético e risco de sobreaquecimento. Sem ajustar T para deslocar o equilíbrio, você não ganha rendimento e pode demorar mais para atingir o regime ideal.\",\n          \"text\": \"Manter temperatura e otimizar integração térmica\"\n        },\n        {\n          \"effects\": [\n            {\n              \"change\": 5,\n              \"variable\": \"Rendimento de Produto (%)\"\n            },\n            {\n              \"change\": 10,\n              \"variable\": \"Custo Operacional\"\n            },\n            {\n              \"change\": -6,\n              \"variable\": \"Tempo para Estabilizar\"\n            }\n          ],\n          \"feedback\": \"Catalisador não desloca o equilíbrio, mas ajuda a chegar nele mais rápido. Em prática, isso melhora conversão por reduzir limitações cinéticas/tempo morto, mas tem custo de catalisador e regeneração.\",\n          \"text\": \"Trocar/regenerar catalisador para chegar ao equilíbrio mais rápido\"\n        }\n      ],\n      \"question\": \"Qual estratégia de temperatura/catalisador você escolhe?\"\n    },\n    {\n      \"context\": \"Estamos perto do fim do turno, {{NAME}}. Precisamos travar um plano de controle: dá pra mirar rendimento máximo, ou operar mais conservador e garantir que nada saia do trilho. O diretor vai olhar números e incidentes.\",\n      \"options\": [\n        {\n          \"effects\": [\n            {\n              \"change\": 8,\n              \"variable\": \"Rendimento de Produto (%)\"\n            },\n            {\n              \"change\": 8,\n              \"variable\": \"Risco de Segurança\"\n            },\n            {\n              \"change\": 6,\n              \"variable\": \"Custo Operacional\"\n            },\n            {\n              \"change\": -3,\n              \"variable\": \"Tempo para Estabilizar\"\n            }\n          ],\n          \"feedback\": \"Operar no limite (mais pressão, separação agressiva e ajustes rápidos) tende a aumentar rendimento e reduzir tempo de resposta, mas eleva risco e custo por estresse de equipamentos e maior consumo de utilidades.\",\n          \"text\": \"Operar no limite seguro para espremer rendimento\"\n        },\n        {\n          \"effects\": [\n            {\n              \"change\": -6,\n              \"variable\": \"Rendimento de Produto (%)\"\n            },\n            {\n              \"change\": -10,\n              \"variable\": \"Risco de Segurança\"\n            },\n            {\n              \"change\": -6,\n              \"variable\": \"Custo Operacional\"\n            },\n            {\n              \"change\": 3,\n              \"variable\": \"Tempo para Estabilizar\"\n            }\n          ],\n          \"feedback\": \"Uma estratégia conservadora reduz risco e custo (menos estresse, menos energia e menos manobras). A desvantagem é menor deslocamento favorável e mais chance de demorar para “fechar” no ponto de produção.\",\n          \"text\": \"Priorizar segurança e estabilidade, aceitando menos produção\"\n        },\n        {\n          \"effects\": [\n            {\n              \"change\": 6,\n              \"variable\": \"Rendimento de Produto (%)\"\n            },\n            {\n              \"change\": 6,\n              \"variable\": \"Custo Operacional\"\n            },\n            {\n              \"change\": -4,\n              \"variable\": \"Risco de Segurança\"\n            },\n            {\n              \"change\": 2,\n              \"variable\": \"Tempo para Estabilizar\"\n            }\n          ],\n          \"feedback\": \"Ajustes moderados com foco em remoção de produto e controles bem sintonizados tendem a aumentar rendimento sem pressionar tanto a operação. Ainda custa mais e pode demorar um pouco para estabilizar, mas reduz risco relativo.\",\n          \"text\": \"Balancear: remoção de produto + controle mais fino\"\n        },\n        {\n          \"effects\": [\n            {\n              \"change\": 0,\n              \"variable\": \"Rendimento de Produto (%)\"\n            },\n            {\n              \"change\": -4,\n              \"variable\": \"Custo Operacional\"\n            },\n            {\n              \"change\": -4,\n              \"variable\": \"Risco de Segurança\"\n            },\n            {\n              \"change\": 6,\n              \"variable\": \"Tempo para Estabilizar\"\n            }\n          ],\n          \"feedback\": \"Congelar mudanças evita surpresas e reduz gasto com manobras e alarmes. Só que, sem interferir, o tempo para estabilizar pode subir e você deixa rendimento “na mesa”.\",\n          \"text\": \"Congelar setpoints e evitar novas perturbações\"\n        }\n      ],\n      \"question\": \"Qual plano você fecha para o resto do turno?\"\n    }\n  ]\n}",
      "outputTokens": 2143,
      "systemPrompt": "# Role\n\nYou are an expert educational game designer creating a **Challenge** activity for a learning app. Your mission is to design a strategic simulation where learners make decisions that affect inventory variables, navigating trade-offs to meet win conditions using the lesson's concepts.\n\nYou specialize in crafting game-like experiences that test strategic thinking and problem-solving — not just knowledge recall, but the ability to apply concepts under constraints.\n\n# The Art of Strategic Learning\n\nA great Challenge activity doesn't quiz — it simulates. Learners face realistic constraints where every choice has consequences. They must think strategically about trade-offs, just like real-world decision-making.\n\n## Why Trade-Off-Based Scenarios Work\n\n1. **Authentic Complexity**: Real problems have multiple variables that interact. Improving one often affects another.\n\n2. **Strategic Reasoning**: Learners must think several steps ahead, considering how choices compound.\n\n3. **No \"Right Answer\"**: When every option has pros and cons, learners engage with the WHY behind principles.\n\n4. **Memorable Stakes**: Managing resources and meeting goals creates emotional investment in outcomes.\n\n## The Trade-Off Principle\n\nEvery great Challenge activity creates genuine dilemmas:\n\n- **No Perfect Options**: Each choice improves some variables while affecting others\n- **Interconnected Systems**: Variables influence each other meaningfully\n- **Strategic Planning**: Success requires thinking beyond the immediate step\n- **Concept Application**: Understanding the lesson's principles helps navigate trade-offs\n\n# Inputs\n\n- `LESSON_TITLE`: The topic to create a challenge around\n- `LESSON_DESCRIPTION`: Additional context about what this lesson covers\n- `CHAPTER_TITLE`: The chapter context (for understanding scope)\n- `COURSE_TITLE`: The course context (for understanding audience level)\n- `LANGUAGE`: Output language\n- `EXPLANATION_STEPS`: Array of {title, text} from all explanation activities (Background, Explanation, Mechanics, Examples) the learner completed before this one\n\n## Language Guidelines\n\n- `en`: Use US English unless the content is region-specific\n- `pt`: Use Brazilian Portuguese unless the content is region-specific\n- `es`: Use Latin American Spanish unless the content is region-specific\n\n# Requirements\n\n## Introduction\n\nThe `intro` field sets the scene (max 500 characters). It should:\n\n- Establish the scenario and the learner's role\n- Explain what they're trying to achieve\n- Create stakes that feel meaningful\n- Use `{{NAME}}` to personalize\n\n## Inventory Design\n\nDesign 3-5 inventory items. Each item includes:\n\n- **name**: Variable name (intuitive, e.g., \"Budget\", \"Team Morale\", \"Code Quality\")\n- **startValue**: Initial value (typically 40-70, leaving room for gains and losses)\n- **winConditions**: Array of 1-2 conditions the learner must meet for this variable\n\nEach variable must:\n\n- **Represent lesson concepts**: Connect to something the learner studied\n- **Have clear meanings**: Names should be intuitive and unambiguous\n- **Interact meaningfully**: Actions that help one variable should plausibly affect others\n- **Name precisely**: Use specific names (e.g., \"Quantity Demanded\" not \"Market Demand\")\n\n### Win Conditions Structure\n\nEach inventory item's `winConditions` array defines success criteria:\n\n- **operator**: `gte` (>=), `lte` (<=), `gt` (>), `lt` (<), `eq` (==)\n- **value**: Target number the variable must meet\n\n**Common patterns:**\n\n- **Minimum threshold**: `[{ \"operator\": \"gte\", \"value\": 30 }]` — \"Don't let Budget drop below 30\"\n- **Maximum threshold**: `[{ \"operator\": \"lte\", \"value\": 70 }]` — \"Keep Risk below 70\"\n- **Range constraint** (two conditions): `[{ \"operator\": \"gte\", \"value\": 20 }, { \"operator\": \"lte\", \"value\": 80 }]` — \"Keep Budget balanced\"\n\n**Example inventory item:**\n\n```json\n{\n  \"name\": \"Budget\",\n  \"startValue\": 50,\n  \"winConditions\": [\n    { \"operator\": \"gte\", \"value\": 20 },\n    { \"operator\": \"lte\", \"value\": 80 }\n  ]\n}\n```\n\n### Win Condition Achievability Check\n\n**MANDATORY**: Before finalizing, verify each win condition is mathematically achievable:\n\n1. Start with `startValue`, calculate achievable range based on cumulative effects\n2. For `gte` conditions: Target ≤ `startValue + (steps × max_positive_effect_per_step)`\n3. For `lte` conditions: Target ≥ `startValue + (steps × max_negative_effect_per_step)`\n4. Leave margin for strategic flexibility — don't require perfect play to win\n\n**Common mistake**: Setting `lte` targets too LOW or `gte` targets too HIGH. If a variable starts at 55 with max -15 per step across 4 steps, minimum achievable is -5. A target of `lte 5` requires dropping 50 points — verify your effects allow this!\n\n## Step Structure\n\nEach step must have:\n\n- **context**: Maximum 500 characters. Pure dialogue from your colleague setting up the decision. Use a conversational style: no narrator, no character prefixes.\n- **question**: Maximum 100 characters. A clear question about what to do.\n- **options**: **EXACTLY 3-4 choices** (never fewer than 3), each with:\n  - **text**: The choice description (max 80 characters)\n  - **effects**: Array of {variable, change} pairs showing how this choice affects inventory\n  - **feedback**: Why this choice has these effects — max 300 characters. Should explain the reasoning, not just state the outcome.\n\n**CRITICAL**: Every step MUST have at least 3 options. Having only 2 options is a format violation.\n\n## Step Count\n\n- Minimum: 3 steps\n- Maximum: 6 steps\n\n## Tone & Style\n\n- **Pure dialogue**: NO narrator, NO character prefixes, NO action descriptions\n- **Natural conversation**: Colleagues working through a problem together\n- **Professional but warm**: Light humor when appropriate\n- **Second-person immersion**: The colleague speaks TO the learner\n- **Strategic framing**: Dialogue should hint at trade-offs without giving away optimal choices\n\n## The {{NAME}} Placeholder\n\nUse `{{NAME}}` wherever the learner's name should appear. For example:\n\n- \"{{NAME}}, we need to make a call here.\"\n- \"Good thinking, {{NAME}}. But we should consider the trade-offs.\"\n\n## Effect Design\n\nEvery option must:\n\n- **Have meaningful effects**: At least 1-2 variables should change\n- **Show trade-offs**: Most options should help some variables while hurting others\n- **Use realistic magnitudes**: Changes of 5-20 points are typical; dramatic swings (30+) should be rare\n- **Connect to lesson concepts**: The REASON for effects should reflect lesson principles\n\nExample effects structure:\n\n```json\n{\n  \"effects\": [\n    { \"variable\": \"Budget\", \"change\": -15 },\n    { \"variable\": \"Quality\", \"change\": 10 }\n  ]\n}\n```\n\n## Effect Direction: The Measurement Rule\n\n**ONE RULE**: The sign reflects whether the MEASURED NUMBER goes up or down.\n\n### The Algorithm\n\nFor EVERY effect, apply this test:\n\n1. Imagine a meter/gauge displaying the variable's current value as a number\n2. After this action, will the number on that meter be HIGHER or LOWER?\n3. Higher → positive (+) / Lower → negative (-)\n\nThat's it. Ignore whether the outcome is \"good\" or \"bad\" for the player.\n\n### Why This Works\n\nVariables measure QUANTITIES. The sign indicates CHANGE IN QUANTITY:\n\n- Cost measures dollars spent → spending less → number goes DOWN → negative\n- Time measures duration → finishing faster → number goes DOWN → negative\n- Quality measures goodness → better work → number goes UP → positive\n- Risk measures danger level → safer choice → number goes DOWN → negative\n\n### Self-Check\n\nBefore finalizing each effect, ask:\n\n> \"If this variable were displayed as a number on screen, would this action make that number go UP or DOWN?\"\n\n- UP → use positive (+)\n- DOWN → use negative (-)\n\nThe player's happiness about the outcome is IRRELEVANT to the sign.\n\n## What to Avoid\n\n- **Dominant options**: No choice should be obviously best across all variables\n- **Trivial decisions**: Every step should require real thought about trade-offs\n- **Disconnected variables**: Effects should make conceptual sense\n- **Extreme swings**: Avoid changes that guarantee win/loss in one step\n- **Narrator text or descriptions**: Keep it pure dialogue\n- **Quiz-style questions**: This tests strategic thinking and problem-solving, not recall\n- **Inverted effect signs**: Never confuse \"good outcome\" with \"positive change\". Apply the Measurement Rule: would the NUMBER go up or down?\n- **Single-path variables**: NEVER create a variable that can only be improved by ONE option in the entire game. Every win condition variable MUST be influenceable by options in multiple steps. Otherwise, that option becomes mandatory and removes player agency\n\n## Scope\n\n- **Stay focused**: The scenario should require THIS lesson's concepts to navigate well\n- **Meaningful variables**: Each inventory variable should connect to lesson principles\n- **Realistic trade-offs**: The trade-offs should reflect how these concepts work in practice\n\n## Relationship to Previous Activities\n\nThe learner has already completed:\n\n- **Background**: WHY this exists (origin story, problems solved, historical context)\n- **Explanation**: WHAT it is (core concepts, components, definitions)\n- **Mechanics**: HOW it works (processes in action, cause-effect chains)\n- **Examples**: WHERE it appears (real-world contexts, applications)\n- **Story**: WHEN to apply this (dialogue-based problem solving)\n\nYour Challenge activity is the capstone: **CAN YOU HANDLE THIS?** It tests whether learners can apply concepts strategically under constraints. This is the most challenging activity — it should feel like a real test of understanding.\n\n- Background: \"WHY did we need this?\"\n- Explanation: \"WHAT exactly is it?\"\n- Mechanics: \"HOW does it actually work?\"\n- Examples: \"WHERE will I encounter this?\"\n- Story: \"WHEN do I apply this?\"\n- **Challenge: \"CAN I navigate complex trade-offs using this?\"**\n\n# Structure Guide\n\nA typical Challenge follows this arc:\n\n1. **Setup**: Establish the scenario, variables, and goal in the intro\n2. **Initial Decision**: First choice with clear trade-offs to teach the mechanics\n3. **Escalating Complexity**: Middle decisions where variables interact more\n4. **Critical Choice**: A pivotal decision that significantly affects outcomes\n5. **Resolution Setup**: Final decision that determines if win conditions are met\n\nNote: The challenge should feel winnable but require understanding the lesson's principles to succeed consistently.\n\n# Dialogue Tone Examples\n\n## Setting Up Trade-Offs\n\n> \"{{NAME}}, here's our situation. We can push for faster delivery, but that means cutting corners on testing. Or we take our time and risk missing the window. What's our priority?\"\n\n> \"The client wants both lower costs AND higher quality. {{NAME}}, we both know we can't maximize both. Where do we compromise?\"\n\n## Explaining Consequences\n\n> \"Interesting choice, {{NAME}}. Going that route saved us time, but I'm already seeing signs of technical debt building up. Let's see how this plays out.\"\n\n> \"That definitely boosted our short-term numbers. But {{NAME}}, remember — these variables are connected. Watch what happens next.\"\n\n## Strategic Moments\n\n> \"{{NAME}}, we're at a crossroads. Our budget is tight, but team morale is dropping. If we don't address one, the other gets worse. What's your call?\"\n\n> \"This is the big one, {{NAME}}. The choice we make here pretty much determines whether we hit our targets. No pressure.\"\n\n# Quality Checks\n\nBefore finalizing, verify:\n\n- [ ] Does the intro clearly establish the scenario, goal, and stakes?\n- [ ] Do inventory variables connect meaningfully to lesson concepts?\n- [ ] MATHEMATICAL ACHIEVABILITY: For each win condition, is the target mathematically reachable given startValue and cumulative effect ranges? (Calculate: startValue + sum of max effects in desired direction)\n- [ ] Does every option have genuine trade-offs (no dominant choices)?\n- [ ] Do effects make conceptual sense given the lesson content?\n- [ ] Is `{{NAME}}` used appropriately throughout?\n- [ ] Is all dialogue pure conversation (no narrator, no prefixes)?\n- [ ] Does feedback explain WHY effects occur, not just state them?\n- [ ] Is the scope exactly the lesson topic?\n- [ ] Are all constraints met (intro ≤500 chars, context ≤500 chars, question ≤100 chars, text ≤80 chars, feedback ≤300 chars)?\n- [ ] Is the step count between 3 and 6?\n- [ ] Do inventory values start in a reasonable range (typically 40-70)?\n- [ ] Are effect magnitudes reasonable (typically 5-20 points)?\n- [ ] For EACH effect, apply the Measurement Rule: if this variable were a number on screen, would this action make it go UP (+) or DOWN (-)?\n- [ ] Does EVERY step have at least 3 options? (Never just 2 options)\n- [ ] Does each inventory item have at least one win condition?\n- [ ] For each variable, are there multiple options across different steps that can affect it? (No single-path variables)\n\n# Output Format\n\nReturn an object with:\n\n- **intro**: Scenario introduction (max 500 chars)\n- **inventory**: Array of 3-5 inventory items, each with:\n  - **name**: Variable name\n  - **startValue**: Initial value (typically 40-70)\n  - **winConditions**: Array of 1-2 conditions, each with:\n    - **operator**: One of \"gte\", \"lte\", \"gt\", \"lt\", \"eq\"\n    - **value**: Target number\n- **steps**: Array of 3-6 step objects, each with:\n  - **context**: Pure dialogue (max 500 chars)\n  - **question**: Decision prompt (max 100 chars)\n  - **options**: Array of 3-4 objects with:\n    - **text**: Choice description (max 80 chars)\n    - **effects**: Array of {variable, change} pairs\n    - **feedback**: Explanation of effects (max 300 chars)\n",
      "testCaseId": "pt-chemistry-reaction-equilibrium-1",
      "userPrompt": "LESSON_TITLE: Equilibrio Quimico na Pratica\nLESSON_DESCRIPTION: Aplicando o principio de Le Chatelier para otimizar reacoes quimicas e processos industriais\nCHAPTER_TITLE: Equilibrio Quimico\nCOURSE_TITLE: Quimica Geral II\nLANGUAGE: pt\nEXPLANATION_STEPS:\n1. Principio de Le Chatelier: O principio de Le Chatelier diz que um sistema em equilibrio responde a perturbacoes minimizando a mudanca. Adicione reagente, o equilibrio desloca para consumir esse reagente.\n2. Efeito da Concentracao: Mudancas de concentracao deslocam o equilibrio. Adicionar reagentes desloca para produtos. Remover produtos tambem desloca para produtos. O sistema busca restaurar o equilibrio.\n3. Efeito da Pressao: A pressao afeta equilibrios gasosos. Aumentar pressao favorece o lado com menos moles de gas. Diminuir pressao favorece o lado com mais moles. Gases inertes nao afetam.\n4. Efeito da Temperatura: Temperatura e diferente — ela muda a constante de equilibrio. Reacoes exotermicas: aumento de temperatura desloca para reagentes. Reacoes endotermicas: aumento favorece produtos.\n5. Papel dos Catalisadores: Catalisadores aceleram ambas as direcoes igualmente. Eles nao deslocam o equilibrio — apenas ajudam a alcancar o equilibrio mais rapido. Util para processos industriais."
    },
    {
      "duration": 38771.925166,
      "inputTokens": 3598,
      "output": "{\n  \"intro\": \"{{NAME}}, mañana presentamos el diseño de un sistema energético para una planta aislada. Tu trabajo es lograr la energía útil requerida sin pasarte de masa ni de costo, y manteniendo las pérdidas bajo control. Si fallamos, la planta no cumple producción y nos cancelan el contrato. ¿Optimización realista, no magia?\",\n  \"inventory\": [\n    {\n      \"name\": \"Energia util entregada\",\n      \"startValue\": 55,\n      \"winConditions\": [\n        {\n          \"operator\": \"gte\",\n          \"value\": 70\n        }\n      ]\n    },\n    {\n      \"name\": \"Perdidas termicas acumuladas\",\n      \"startValue\": 45,\n      \"winConditions\": [\n        {\n          \"operator\": \"lte\",\n          \"value\": 55\n        }\n      ]\n    },\n    {\n      \"name\": \"Masa y volumen del sistema\",\n      \"startValue\": 50,\n      \"winConditions\": [\n        {\n          \"operator\": \"lte\",\n          \"value\": 65\n        }\n      ]\n    },\n    {\n      \"name\": \"Costo total del proyecto\",\n      \"startValue\": 55,\n      \"winConditions\": [\n        {\n          \"operator\": \"lte\",\n          \"value\": 70\n        }\n      ]\n    }\n  ],\n  \"steps\": [\n    {\n      \"context\": \"{{NAME}}, primero tenemos que escoger la arquitectura base. Podemos ir con una cadena larga de conversiones “flexible”, o simplificar para no acumular pérdidas. Pero simplificar a veces exige componentes más caros o difíciles de integrar.\",\n      \"options\": [\n        {\n          \"effects\": [\n            {\n              \"change\": 12,\n              \"variable\": \"Energia util entregada\"\n            },\n            {\n              \"change\": 10,\n              \"variable\": \"Perdidas termicas acumuladas\"\n            },\n            {\n              \"change\": 5,\n              \"variable\": \"Masa y volumen del sistema\"\n            },\n            {\n              \"change\": 5,\n              \"variable\": \"Costo total del proyecto\"\n            }\n          ],\n          \"feedback\": \"Una cadena larga (más etapas) suele dar flexibilidad, pero cada conversión añade pérdidas. Terminas metiendo más hardware y sube masa y costo, aunque puedas “exprimir” algo más de energía útil a corto plazo.\",\n          \"text\": \"Cadena larga: fuente→DC→batería→AC→motores\"\n        },\n        {\n          \"effects\": [\n            {\n              \"change\": 8,\n              \"variable\": \"Energia util entregada\"\n            },\n            {\n              \"change\": -8,\n              \"variable\": \"Perdidas termicas acumuladas\"\n            },\n            {\n              \"change\": -3,\n              \"variable\": \"Masa y volumen del sistema\"\n            },\n            {\n              \"change\": 10,\n              \"variable\": \"Costo total del proyecto\"\n            }\n          ],\n          \"feedback\": \"Reducir conversiones baja pérdidas en cadena (eficiencia total mejora). Pero integrar equipos “directos” y de alta eficiencia suele costar más por electrónica/potencia específica, aunque reduzcas masa por menos componentes.\",\n          \"text\": \"Simplificar conversiones y usar electrónica de alta eficiencia\"\n        },\n        {\n          \"effects\": [\n            {\n              \"change\": 5,\n              \"variable\": \"Energia util entregada\"\n            },\n            {\n              \"change\": -4,\n              \"variable\": \"Perdidas termicas acumuladas\"\n            },\n            {\n              \"change\": 2,\n              \"variable\": \"Masa y volumen del sistema\"\n            },\n            {\n              \"change\": -5,\n              \"variable\": \"Costo total del proyecto\"\n            }\n          ],\n          \"feedback\": \"Una arquitectura estándar y barata reduce costo y mantiene pérdidas moderadas, pero no es lo más eficiente ni lo más compacto. Ganas confiabilidad logística, pero sacrificas desempeño máximo.\",\n          \"text\": \"Arquitectura estándar “probada” con componentes económicos\"\n        }\n      ],\n      \"question\": \"¿Qué arquitectura base elegimos?\"\n    },\n    {\n      \"context\": \"Bien, ahora el cliente exige respaldo: 2 horas sin generación. El almacenamiento no es gratis, {{NAME}}: cargar/descargar pierde energía y además pesa. Pero sin almacenamiento, cualquier variación nos mata la entrega útil.\",\n      \"options\": [\n        {\n          \"effects\": [\n            {\n              \"change\": 10,\n              \"variable\": \"Energia util entregada\"\n            },\n            {\n              \"change\": 8,\n              \"variable\": \"Perdidas termicas acumuladas\"\n            },\n            {\n              \"change\": 12,\n              \"variable\": \"Masa y volumen del sistema\"\n            },\n            {\n              \"change\": 10,\n              \"variable\": \"Costo total del proyecto\"\n            }\n          ],\n          \"feedback\": \"Más batería amortigua picos y ayuda a cumplir energía útil, pero el ciclo carga/descarga tiene pérdidas (sube calor) y la densidad energética de baterías es limitada: crece masa/volumen y también el costo.\",\n          \"text\": \"Batería grande para cubrir todo el respaldo\"\n        },\n        {\n          \"effects\": [\n            {\n              \"change\": 6,\n              \"variable\": \"Energia util entregada\"\n            },\n            {\n              \"change\": 3,\n              \"variable\": \"Perdidas termicas acumuladas\"\n            },\n            {\n              \"change\": 5,\n              \"variable\": \"Masa y volumen del sistema\"\n            },\n            {\n              \"change\": 4,\n              \"variable\": \"Costo total del proyecto\"\n            }\n          ],\n          \"feedback\": \"Un tamaño intermedio reduce el castigo de masa y de pérdidas por ciclos, pero igual te da margen operativo. No es el mejor en nada, pero evita extremos y mantiene el sistema manejable.\",\n          \"text\": \"Batería mediana + estrategia de gestión de carga\"\n        },\n        {\n          \"effects\": [\n            {\n              \"change\": 2,\n              \"variable\": \"Energia util entregada\"\n            },\n            {\n              \"change\": -2,\n              \"variable\": \"Perdidas termicas acumuladas\"\n            },\n            {\n              \"change\": -5,\n              \"variable\": \"Masa y volumen del sistema\"\n            },\n            {\n              \"change\": -3,\n              \"variable\": \"Costo total del proyecto\"\n            }\n          ],\n          \"feedback\": \"Minimizar almacenamiento reduce peso, volumen y pérdidas asociadas. Pero te deja con poco colchón: ante variaciones de carga o generación, la energía útil entregada sufre.\",\n          \"text\": \"Almacenamiento mínimo y operación “justo a tiempo”\"\n        },\n        {\n          \"effects\": [\n            {\n              \"change\": 8,\n              \"variable\": \"Energia util entregada\"\n            },\n            {\n              \"change\": 5,\n              \"variable\": \"Perdidas termicas acumuladas\"\n            },\n            {\n              \"change\": 3,\n              \"variable\": \"Masa y volumen del sistema\"\n            },\n            {\n              \"change\": 12,\n              \"variable\": \"Costo total del proyecto\"\n            }\n          ],\n          \"feedback\": \"Un sistema híbrido reduce parte del peso frente a solo baterías, pero agrega equipos y control, y el almacenamiento alternativo también tiene pérdidas. Suele mejorar entrega útil con costo alto por complejidad.\",\n          \"text\": \"Híbrido: batería pequeña + otro almacenamiento (volante/agua)\"\n        }\n      ],\n      \"question\": \"¿Qué estrategia de almacenamiento implementamos?\"\n    },\n    {\n      \"context\": \"Siguiente dilema, {{NAME}}: elegir la fuente principal. Alta densidad energética facilita logística, pero puede traer calor residual y equipos de conversión. La opción “limpia” suele exigir más superficie/masa o más electrónica.\",\n      \"options\": [\n        {\n          \"effects\": [\n            {\n              \"change\": 12,\n              \"variable\": \"Energia util entregada\"\n            },\n            {\n              \"change\": 6,\n              \"variable\": \"Perdidas termicas acumuladas\"\n            },\n            {\n              \"change\": -4,\n              \"variable\": \"Masa y volumen del sistema\"\n            },\n            {\n              \"change\": 6,\n              \"variable\": \"Costo total del proyecto\"\n            }\n          ],\n          \"feedback\": \"Un combustible de alta densidad energética reduce masa/volumen por kWh almacenado y facilita cumplir energía útil. Pero hay pérdidas por combustión y conversión a electricidad, elevando calor y requiriendo más sistemas auxiliares.\",\n          \"text\": \"Fuente de alta densidad energética (combustible + generador)\"\n        },\n        {\n          \"effects\": [\n            {\n              \"change\": 6,\n              \"variable\": \"Energia util entregada\"\n            },\n            {\n              \"change\": -3,\n              \"variable\": \"Perdidas termicas acumuladas\"\n            },\n            {\n              \"change\": 8,\n              \"variable\": \"Masa y volumen del sistema\"\n            },\n            {\n              \"change\": 8,\n              \"variable\": \"Costo total del proyecto\"\n            }\n          ],\n          \"feedback\": \"Más renovable y conversión directa reduce pérdidas térmicas en operación, pero para garantizar energía útil necesitas más superficie/equipos y electrónica, elevando masa/volumen y costo.\",\n          \"text\": \"Renovable dominante + sobredimensionamiento para días malos\"\n        },\n        {\n          \"effects\": [\n            {\n              \"change\": 8,\n              \"variable\": \"Energia util entregada\"\n            },\n            {\n              \"change\": 2,\n              \"variable\": \"Perdidas termicas acumuladas\"\n            },\n            {\n              \"change\": 2,\n              \"variable\": \"Masa y volumen del sistema\"\n            },\n            {\n              \"change\": 2,\n              \"variable\": \"Costo total del proyecto\"\n            }\n          ],\n          \"feedback\": \"Un mix balanceado reduce dependencias: no tan pesado como renovable puro, no tan caliente como solo combustible. Las pérdidas quedan moderadas porque aún hay varias etapas, pero no te vas a extremos.\",\n          \"text\": \"Mix balanceado (renovable + generador de apoyo)\"\n        }\n      ],\n      \"question\": \"¿Cuál será la fuente principal del sistema?\"\n    },\n    {\n      \"context\": \"Última, {{NAME}}. En pruebas de integración vemos calor en inversores y motores. Podemos atacar pérdidas con mejores componentes o con menos conversiones, pero eso cuesta. O podemos aceptar calor y sobredimensionar enfriamiento, que también pesa.\",\n      \"options\": [\n        {\n          \"effects\": [\n            {\n              \"change\": 6,\n              \"variable\": \"Energia util entregada\"\n            },\n            {\n              \"change\": -10,\n              \"variable\": \"Perdidas termicas acumuladas\"\n            },\n            {\n              \"change\": 3,\n              \"variable\": \"Masa y volumen del sistema\"\n            },\n            {\n              \"change\": 12,\n              \"variable\": \"Costo total del proyecto\"\n            }\n          ],\n          \"feedback\": \"Mejorar eficiencia real (electrónica/motores premium) baja calor perdido y sube energía útil. Pero esos componentes cuestan y a veces requieren empaques más robustos, elevando algo la masa.\",\n          \"text\": \"Componentes premium para subir eficiencia (menos calor)\"\n        },\n        {\n          \"effects\": [\n            {\n              \"change\": 4,\n              \"variable\": \"Energia util entregada\"\n            },\n            {\n              \"change\": -8,\n              \"variable\": \"Perdidas termicas acumuladas\"\n            },\n            {\n              \"change\": -2,\n              \"variable\": \"Masa y volumen del sistema\"\n            },\n            {\n              \"change\": 6,\n              \"variable\": \"Costo total del proyecto\"\n            }\n          ],\n          \"feedback\": \"Reducir etapas elimina pérdidas en cadena y simplifica hardware, bajando masa. Requiere rediseño y controles, así que sube costo, pero suele ser una forma muy “termódinámica” de ganar eficiencia total.\",\n          \"text\": \"Rediseñar para eliminar una conversión completa\"\n        },\n        {\n          \"effects\": [\n            {\n              \"change\": 2,\n              \"variable\": \"Energia util entregada\"\n            },\n            {\n              \"change\": 6,\n              \"variable\": \"Perdidas termicas acumuladas\"\n            },\n            {\n              \"change\": 8,\n              \"variable\": \"Masa y volumen del sistema\"\n            },\n            {\n              \"change\": -4,\n              \"variable\": \"Costo total del proyecto\"\n            }\n          ],\n          \"feedback\": \"Aceptar pérdidas y solo poner enfriamiento/barato baja costo inmediato, pero el calor perdido sigue existiendo (suben pérdidas acumuladas) y el sistema se vuelve más voluminoso por disipadores y ductos.\",\n          \"text\": \"Mantener diseño y añadir enfriamiento económico\"\n        },\n        {\n          \"effects\": [\n            {\n              \"change\": -2,\n              \"variable\": \"Energia util entregada\"\n            },\n            {\n              \"change\": -4,\n              \"variable\": \"Perdidas termicas acumuladas\"\n            },\n            {\n              \"change\": 0,\n              \"variable\": \"Masa y volumen del sistema\"\n            },\n            {\n              \"change\": -6,\n              \"variable\": \"Costo total del proyecto\"\n            }\n          ],\n          \"feedback\": \"Recortar demanda con gestión de carga reduce energía requerida y por tanto pérdidas y costo operativo. Pero también baja la energía útil entregada al proceso: puede afectar producción si te pasas.\",\n          \"text\": \"Gestión de carga: recortar picos aunque baje producción\"\n        }\n      ],\n      \"question\": \"¿Cómo controlamos las pérdidas sin romper el proyecto?\"\n    }\n  ]\n}",
      "outputTokens": 2924,
      "systemPrompt": "# Role\n\nYou are an expert educational game designer creating a **Challenge** activity for a learning app. Your mission is to design a strategic simulation where learners make decisions that affect inventory variables, navigating trade-offs to meet win conditions using the lesson's concepts.\n\nYou specialize in crafting game-like experiences that test strategic thinking and problem-solving — not just knowledge recall, but the ability to apply concepts under constraints.\n\n# The Art of Strategic Learning\n\nA great Challenge activity doesn't quiz — it simulates. Learners face realistic constraints where every choice has consequences. They must think strategically about trade-offs, just like real-world decision-making.\n\n## Why Trade-Off-Based Scenarios Work\n\n1. **Authentic Complexity**: Real problems have multiple variables that interact. Improving one often affects another.\n\n2. **Strategic Reasoning**: Learners must think several steps ahead, considering how choices compound.\n\n3. **No \"Right Answer\"**: When every option has pros and cons, learners engage with the WHY behind principles.\n\n4. **Memorable Stakes**: Managing resources and meeting goals creates emotional investment in outcomes.\n\n## The Trade-Off Principle\n\nEvery great Challenge activity creates genuine dilemmas:\n\n- **No Perfect Options**: Each choice improves some variables while affecting others\n- **Interconnected Systems**: Variables influence each other meaningfully\n- **Strategic Planning**: Success requires thinking beyond the immediate step\n- **Concept Application**: Understanding the lesson's principles helps navigate trade-offs\n\n# Inputs\n\n- `LESSON_TITLE`: The topic to create a challenge around\n- `LESSON_DESCRIPTION`: Additional context about what this lesson covers\n- `CHAPTER_TITLE`: The chapter context (for understanding scope)\n- `COURSE_TITLE`: The course context (for understanding audience level)\n- `LANGUAGE`: Output language\n- `EXPLANATION_STEPS`: Array of {title, text} from all explanation activities (Background, Explanation, Mechanics, Examples) the learner completed before this one\n\n## Language Guidelines\n\n- `en`: Use US English unless the content is region-specific\n- `pt`: Use Brazilian Portuguese unless the content is region-specific\n- `es`: Use Latin American Spanish unless the content is region-specific\n\n# Requirements\n\n## Introduction\n\nThe `intro` field sets the scene (max 500 characters). It should:\n\n- Establish the scenario and the learner's role\n- Explain what they're trying to achieve\n- Create stakes that feel meaningful\n- Use `{{NAME}}` to personalize\n\n## Inventory Design\n\nDesign 3-5 inventory items. Each item includes:\n\n- **name**: Variable name (intuitive, e.g., \"Budget\", \"Team Morale\", \"Code Quality\")\n- **startValue**: Initial value (typically 40-70, leaving room for gains and losses)\n- **winConditions**: Array of 1-2 conditions the learner must meet for this variable\n\nEach variable must:\n\n- **Represent lesson concepts**: Connect to something the learner studied\n- **Have clear meanings**: Names should be intuitive and unambiguous\n- **Interact meaningfully**: Actions that help one variable should plausibly affect others\n- **Name precisely**: Use specific names (e.g., \"Quantity Demanded\" not \"Market Demand\")\n\n### Win Conditions Structure\n\nEach inventory item's `winConditions` array defines success criteria:\n\n- **operator**: `gte` (>=), `lte` (<=), `gt` (>), `lt` (<), `eq` (==)\n- **value**: Target number the variable must meet\n\n**Common patterns:**\n\n- **Minimum threshold**: `[{ \"operator\": \"gte\", \"value\": 30 }]` — \"Don't let Budget drop below 30\"\n- **Maximum threshold**: `[{ \"operator\": \"lte\", \"value\": 70 }]` — \"Keep Risk below 70\"\n- **Range constraint** (two conditions): `[{ \"operator\": \"gte\", \"value\": 20 }, { \"operator\": \"lte\", \"value\": 80 }]` — \"Keep Budget balanced\"\n\n**Example inventory item:**\n\n```json\n{\n  \"name\": \"Budget\",\n  \"startValue\": 50,\n  \"winConditions\": [\n    { \"operator\": \"gte\", \"value\": 20 },\n    { \"operator\": \"lte\", \"value\": 80 }\n  ]\n}\n```\n\n### Win Condition Achievability Check\n\n**MANDATORY**: Before finalizing, verify each win condition is mathematically achievable:\n\n1. Start with `startValue`, calculate achievable range based on cumulative effects\n2. For `gte` conditions: Target ≤ `startValue + (steps × max_positive_effect_per_step)`\n3. For `lte` conditions: Target ≥ `startValue + (steps × max_negative_effect_per_step)`\n4. Leave margin for strategic flexibility — don't require perfect play to win\n\n**Common mistake**: Setting `lte` targets too LOW or `gte` targets too HIGH. If a variable starts at 55 with max -15 per step across 4 steps, minimum achievable is -5. A target of `lte 5` requires dropping 50 points — verify your effects allow this!\n\n## Step Structure\n\nEach step must have:\n\n- **context**: Maximum 500 characters. Pure dialogue from your colleague setting up the decision. Use a conversational style: no narrator, no character prefixes.\n- **question**: Maximum 100 characters. A clear question about what to do.\n- **options**: **EXACTLY 3-4 choices** (never fewer than 3), each with:\n  - **text**: The choice description (max 80 characters)\n  - **effects**: Array of {variable, change} pairs showing how this choice affects inventory\n  - **feedback**: Why this choice has these effects — max 300 characters. Should explain the reasoning, not just state the outcome.\n\n**CRITICAL**: Every step MUST have at least 3 options. Having only 2 options is a format violation.\n\n## Step Count\n\n- Minimum: 3 steps\n- Maximum: 6 steps\n\n## Tone & Style\n\n- **Pure dialogue**: NO narrator, NO character prefixes, NO action descriptions\n- **Natural conversation**: Colleagues working through a problem together\n- **Professional but warm**: Light humor when appropriate\n- **Second-person immersion**: The colleague speaks TO the learner\n- **Strategic framing**: Dialogue should hint at trade-offs without giving away optimal choices\n\n## The {{NAME}} Placeholder\n\nUse `{{NAME}}` wherever the learner's name should appear. For example:\n\n- \"{{NAME}}, we need to make a call here.\"\n- \"Good thinking, {{NAME}}. But we should consider the trade-offs.\"\n\n## Effect Design\n\nEvery option must:\n\n- **Have meaningful effects**: At least 1-2 variables should change\n- **Show trade-offs**: Most options should help some variables while hurting others\n- **Use realistic magnitudes**: Changes of 5-20 points are typical; dramatic swings (30+) should be rare\n- **Connect to lesson concepts**: The REASON for effects should reflect lesson principles\n\nExample effects structure:\n\n```json\n{\n  \"effects\": [\n    { \"variable\": \"Budget\", \"change\": -15 },\n    { \"variable\": \"Quality\", \"change\": 10 }\n  ]\n}\n```\n\n## Effect Direction: The Measurement Rule\n\n**ONE RULE**: The sign reflects whether the MEASURED NUMBER goes up or down.\n\n### The Algorithm\n\nFor EVERY effect, apply this test:\n\n1. Imagine a meter/gauge displaying the variable's current value as a number\n2. After this action, will the number on that meter be HIGHER or LOWER?\n3. Higher → positive (+) / Lower → negative (-)\n\nThat's it. Ignore whether the outcome is \"good\" or \"bad\" for the player.\n\n### Why This Works\n\nVariables measure QUANTITIES. The sign indicates CHANGE IN QUANTITY:\n\n- Cost measures dollars spent → spending less → number goes DOWN → negative\n- Time measures duration → finishing faster → number goes DOWN → negative\n- Quality measures goodness → better work → number goes UP → positive\n- Risk measures danger level → safer choice → number goes DOWN → negative\n\n### Self-Check\n\nBefore finalizing each effect, ask:\n\n> \"If this variable were displayed as a number on screen, would this action make that number go UP or DOWN?\"\n\n- UP → use positive (+)\n- DOWN → use negative (-)\n\nThe player's happiness about the outcome is IRRELEVANT to the sign.\n\n## What to Avoid\n\n- **Dominant options**: No choice should be obviously best across all variables\n- **Trivial decisions**: Every step should require real thought about trade-offs\n- **Disconnected variables**: Effects should make conceptual sense\n- **Extreme swings**: Avoid changes that guarantee win/loss in one step\n- **Narrator text or descriptions**: Keep it pure dialogue\n- **Quiz-style questions**: This tests strategic thinking and problem-solving, not recall\n- **Inverted effect signs**: Never confuse \"good outcome\" with \"positive change\". Apply the Measurement Rule: would the NUMBER go up or down?\n- **Single-path variables**: NEVER create a variable that can only be improved by ONE option in the entire game. Every win condition variable MUST be influenceable by options in multiple steps. Otherwise, that option becomes mandatory and removes player agency\n\n## Scope\n\n- **Stay focused**: The scenario should require THIS lesson's concepts to navigate well\n- **Meaningful variables**: Each inventory variable should connect to lesson principles\n- **Realistic trade-offs**: The trade-offs should reflect how these concepts work in practice\n\n## Relationship to Previous Activities\n\nThe learner has already completed:\n\n- **Background**: WHY this exists (origin story, problems solved, historical context)\n- **Explanation**: WHAT it is (core concepts, components, definitions)\n- **Mechanics**: HOW it works (processes in action, cause-effect chains)\n- **Examples**: WHERE it appears (real-world contexts, applications)\n- **Story**: WHEN to apply this (dialogue-based problem solving)\n\nYour Challenge activity is the capstone: **CAN YOU HANDLE THIS?** It tests whether learners can apply concepts strategically under constraints. This is the most challenging activity — it should feel like a real test of understanding.\n\n- Background: \"WHY did we need this?\"\n- Explanation: \"WHAT exactly is it?\"\n- Mechanics: \"HOW does it actually work?\"\n- Examples: \"WHERE will I encounter this?\"\n- Story: \"WHEN do I apply this?\"\n- **Challenge: \"CAN I navigate complex trade-offs using this?\"**\n\n# Structure Guide\n\nA typical Challenge follows this arc:\n\n1. **Setup**: Establish the scenario, variables, and goal in the intro\n2. **Initial Decision**: First choice with clear trade-offs to teach the mechanics\n3. **Escalating Complexity**: Middle decisions where variables interact more\n4. **Critical Choice**: A pivotal decision that significantly affects outcomes\n5. **Resolution Setup**: Final decision that determines if win conditions are met\n\nNote: The challenge should feel winnable but require understanding the lesson's principles to succeed consistently.\n\n# Dialogue Tone Examples\n\n## Setting Up Trade-Offs\n\n> \"{{NAME}}, here's our situation. We can push for faster delivery, but that means cutting corners on testing. Or we take our time and risk missing the window. What's our priority?\"\n\n> \"The client wants both lower costs AND higher quality. {{NAME}}, we both know we can't maximize both. Where do we compromise?\"\n\n## Explaining Consequences\n\n> \"Interesting choice, {{NAME}}. Going that route saved us time, but I'm already seeing signs of technical debt building up. Let's see how this plays out.\"\n\n> \"That definitely boosted our short-term numbers. But {{NAME}}, remember — these variables are connected. Watch what happens next.\"\n\n## Strategic Moments\n\n> \"{{NAME}}, we're at a crossroads. Our budget is tight, but team morale is dropping. If we don't address one, the other gets worse. What's your call?\"\n\n> \"This is the big one, {{NAME}}. The choice we make here pretty much determines whether we hit our targets. No pressure.\"\n\n# Quality Checks\n\nBefore finalizing, verify:\n\n- [ ] Does the intro clearly establish the scenario, goal, and stakes?\n- [ ] Do inventory variables connect meaningfully to lesson concepts?\n- [ ] MATHEMATICAL ACHIEVABILITY: For each win condition, is the target mathematically reachable given startValue and cumulative effect ranges? (Calculate: startValue + sum of max effects in desired direction)\n- [ ] Does every option have genuine trade-offs (no dominant choices)?\n- [ ] Do effects make conceptual sense given the lesson content?\n- [ ] Is `{{NAME}}` used appropriately throughout?\n- [ ] Is all dialogue pure conversation (no narrator, no prefixes)?\n- [ ] Does feedback explain WHY effects occur, not just state them?\n- [ ] Is the scope exactly the lesson topic?\n- [ ] Are all constraints met (intro ≤500 chars, context ≤500 chars, question ≤100 chars, text ≤80 chars, feedback ≤300 chars)?\n- [ ] Is the step count between 3 and 6?\n- [ ] Do inventory values start in a reasonable range (typically 40-70)?\n- [ ] Are effect magnitudes reasonable (typically 5-20 points)?\n- [ ] For EACH effect, apply the Measurement Rule: if this variable were a number on screen, would this action make it go UP (+) or DOWN (-)?\n- [ ] Does EVERY step have at least 3 options? (Never just 2 options)\n- [ ] Does each inventory item have at least one win condition?\n- [ ] For each variable, are there multiple options across different steps that can affect it? (No single-path variables)\n\n# Output Format\n\nReturn an object with:\n\n- **intro**: Scenario introduction (max 500 chars)\n- **inventory**: Array of 3-5 inventory items, each with:\n  - **name**: Variable name\n  - **startValue**: Initial value (typically 40-70)\n  - **winConditions**: Array of 1-2 conditions, each with:\n    - **operator**: One of \"gte\", \"lte\", \"gt\", \"lt\", \"eq\"\n    - **value**: Target number\n- **steps**: Array of 3-6 step objects, each with:\n  - **context**: Pure dialogue (max 500 chars)\n  - **question**: Decision prompt (max 100 chars)\n  - **options**: Array of 3-4 objects with:\n    - **text**: Choice description (max 80 chars)\n    - **effects**: Array of {variable, change} pairs\n    - **feedback**: Explanation of effects (max 300 chars)\n",
      "testCaseId": "es-physics-energy-conservation-1",
      "userPrompt": "LESSON_TITLE: Conservacion de Energia en Sistemas Reales\nLESSON_DESCRIPTION: Aplicando principios de conservacion de energia para disenar y optimizar sistemas energeticos\nCHAPTER_TITLE: Energia y Trabajo\nCOURSE_TITLE: Fisica Aplicada\nLANGUAGE: es\nEXPLANATION_STEPS:\n1. Conservacion de la Energia: La energia no se crea ni se destruye, solo se transforma. En cada conversion, la energia total se conserva, pero la energia util disminuye. Parte siempre se convierte en calor no aprovechable.\n2. Eficiencia Energetica: La eficiencia mide cuanta energia de entrada se convierte en trabajo util. Ningun proceso es 100% eficiente — siempre hay perdidas. La segunda ley de la termodinamica lo garantiza.\n3. Perdidas en Cadena: Las cadenas de conversion acumulan perdidas. Si cada paso es 90% eficiente, tres pasos dan 0.9³ = 73% eficiencia total. Menos conversiones significa menos perdidas.\n4. Costo del Almacenamiento: El almacenamiento de energia tiene su propio costo energetico. Cargar y descargar baterias pierde energia. Bombear agua cuesta arriba para hidroelectrica tambien. El almacenamiento no es gratis.\n5. Densidad Energetica: La densidad energetica importa. Combustibles fosiles almacenan mucha energia por kilogramo. Las baterias almacenan menos. Esto afecta que es practico para cada aplicacion."
    }
  ],
  "taskId": "activity-challenge"
}