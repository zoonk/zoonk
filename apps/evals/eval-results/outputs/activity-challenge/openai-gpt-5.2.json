{
  "generatedAt": "2026-01-17T18:43:42.695Z",
  "modelId": "openai/gpt-5.2",
  "outputs": [
    {
      "duration": 31117.580958,
      "inputTokens": 3607,
      "output": "{\n  \"intro\": \"{{NAME}}, our search service is getting hammered after a marketing launch. You’re the engineer on call: pick algorithm and data-structure strategies that keep responses fast without blowing memory or making worst-case outages likely. Hit the performance targets before the SLA review tomorrow.\",\n  \"inventory\": [\n    {\n      \"name\": \"Response Speed\",\n      \"startValue\": 55,\n      \"winConditions\": [\n        {\n          \"operator\": \"gte\",\n          \"value\": 70\n        }\n      ]\n    },\n    {\n      \"name\": \"Memory Headroom\",\n      \"startValue\": 60,\n      \"winConditions\": [\n        {\n          \"operator\": \"gte\",\n          \"value\": 35\n        }\n      ]\n    },\n    {\n      \"name\": \"Worst-Case Safety\",\n      \"startValue\": 50,\n      \"winConditions\": [\n        {\n          \"operator\": \"gte\",\n          \"value\": 55\n        }\n      ]\n    },\n    {\n      \"name\": \"Delivery Confidence\",\n      \"startValue\": 55,\n      \"winConditions\": [\n        {\n          \"operator\": \"gte\",\n          \"value\": 60\n        }\n      ]\n    }\n  ],\n  \"steps\": [\n    {\n      \"context\": \"Traffic is spiky and users complain about slow searches. We can change the lookup strategy today, but every approach has a cost. What direction do you want to take first, {{NAME}}?\",\n      \"options\": [\n        {\n          \"effects\": [\n            {\n              \"change\": 15,\n              \"variable\": \"Response Speed\"\n            },\n            {\n              \"change\": -15,\n              \"variable\": \"Memory Headroom\"\n            },\n            {\n              \"change\": -5,\n              \"variable\": \"Worst-Case Safety\"\n            }\n          ],\n          \"feedback\": \"Indexing in a hash-based structure makes lookups close to O(1) on average, so speed jumps. But it consumes extra memory, and collision/pathological patterns can still hurt worst-case behavior.\",\n          \"text\": \"Add a hash index for lookups (avg O(1))\"\n        },\n        {\n          \"effects\": [\n            {\n              \"change\": 10,\n              \"variable\": \"Worst-Case Safety\"\n            },\n            {\n              \"change\": -5,\n              \"variable\": \"Response Speed\"\n            },\n            {\n              \"change\": 10,\n              \"variable\": \"Memory Headroom\"\n            }\n          ],\n          \"feedback\": \"A sorted array with binary search keeps space low and gives predictable O(log n) lookups. It’s slower than ideal constant-time average, but worst-case is stable and memory stays comfortable.\",\n          \"text\": \"Use sorted arrays + binary search (O(log n), low space)\"\n        },\n        {\n          \"effects\": [\n            {\n              \"change\": 12,\n              \"variable\": \"Response Speed\"\n            },\n            {\n              \"change\": -8,\n              \"variable\": \"Worst-Case Safety\"\n            },\n            {\n              \"change\": 5,\n              \"variable\": \"Delivery Confidence\"\n            }\n          ],\n          \"feedback\": \"A clever heuristic can be very fast on typical data, but it risks nasty inputs pushing you toward O(n²)-like behavior. It’s also quick to ship because it’s mostly code-level tuning.\",\n          \"text\": \"Ship a heuristic fast-path for common queries\"\n        }\n      ],\n      \"question\": \"What’s our first move for search performance?\"\n    },\n    {\n      \"context\": \"Now we need to handle frequent inserts as new items stream in. The current dynamic array sometimes stalls during growth. We can redesign around that, but it will ripple through the code. How do we handle the insert workload?\",\n      \"options\": [\n        {\n          \"effects\": [\n            {\n              \"change\": 8,\n              \"variable\": \"Response Speed\"\n            },\n            {\n              \"change\": -10,\n              \"variable\": \"Memory Headroom\"\n            },\n            {\n              \"change\": 5,\n              \"variable\": \"Worst-Case Safety\"\n            }\n          ],\n          \"feedback\": \"Preallocating capacity reduces resize events, so inserts stay near O(1) amortized and latency spikes shrink. The trade-off is extra unused memory reserved up front.\",\n          \"text\": \"Preallocate capacity to reduce resizes (amortized win)\"\n        },\n        {\n          \"effects\": [\n            {\n              \"change\": 12,\n              \"variable\": \"Worst-Case Safety\"\n            },\n            {\n              \"change\": -10,\n              \"variable\": \"Response Speed\"\n            },\n            {\n              \"change\": 8,\n              \"variable\": \"Memory Headroom\"\n            }\n          ],\n          \"feedback\": \"A linked structure avoids big O(n) resize copies, improving worst-case spikes, and uses memory more incrementally. But pointer chasing and cache misses often slow typical operations.\",\n          \"text\": \"Switch to a linked structure to avoid resize stalls\"\n        },\n        {\n          \"effects\": [\n            {\n              \"change\": 12,\n              \"variable\": \"Delivery Confidence\"\n            },\n            {\n              \"change\": -7,\n              \"variable\": \"Worst-Case Safety\"\n            },\n            {\n              \"change\": 5,\n              \"variable\": \"Response Speed\"\n            }\n          ],\n          \"feedback\": \"Rate-limiting reduces pressure quickly and is easy to deploy, boosting confidence for the deadline. But it doesn’t fix the underlying worst-case behavior, and some requests still hit slow paths.\",\n          \"text\": \"Add throttling and keep the current structure for now\"\n        },\n        {\n          \"effects\": [\n            {\n              \"change\": 15,\n              \"variable\": \"Response Speed\"\n            },\n            {\n              \"change\": -18,\n              \"variable\": \"Memory Headroom\"\n            },\n            {\n              \"change\": -5,\n              \"variable\": \"Delivery Confidence\"\n            }\n          ],\n          \"feedback\": \"Caching recent results is a classic time-space trade-off: big speedups by avoiding recomputation. But caches eat memory and introduce invalidation complexity, which can hurt ship confidence.\",\n          \"text\": \"Add aggressive caching of recent queries\"\n        }\n      ],\n      \"question\": \"How do we handle insert pressure without breaking the SLA?\"\n    },\n    {\n      \"context\": \"Sorting is now a bottleneck in a background job that feeds the index. The dataset distribution is unknown; sometimes it’s nearly sorted, sometimes it’s adversarial. We need to pick a sorting strategy. What do you choose, {{NAME}}?\",\n      \"options\": [\n        {\n          \"effects\": [\n            {\n              \"change\": 12,\n              \"variable\": \"Response Speed\"\n            },\n            {\n              \"change\": -15,\n              \"variable\": \"Worst-Case Safety\"\n            },\n            {\n              \"change\": 8,\n              \"variable\": \"Delivery Confidence\"\n            }\n          ],\n          \"feedback\": \"Quicksort tends to be very fast in practice and is easy to integrate, improving throughput. But without safeguards it can degrade to O(n²) on unlucky/adversarial inputs, hurting worst-case safety.\",\n          \"text\": \"Use Quicksort for typical performance\"\n        },\n        {\n          \"effects\": [\n            {\n              \"change\": 10,\n              \"variable\": \"Worst-Case Safety\"\n            },\n            {\n              \"change\": -5,\n              \"variable\": \"Response Speed\"\n            },\n            {\n              \"change\": -5,\n              \"variable\": \"Memory Headroom\"\n            }\n          ],\n          \"feedback\": \"A guaranteed O(n log n) algorithm reduces tail-risk and makes performance predictable. Many worst-case-safe approaches pay with extra memory or constant factors, so speed and headroom dip a bit.\",\n          \"text\": \"Use a worst-case O(n log n) sort (guaranteed bounds)\"\n        },\n        {\n          \"effects\": [\n            {\n              \"change\": 8,\n              \"variable\": \"Response Speed\"\n            },\n            {\n              \"change\": 6,\n              \"variable\": \"Worst-Case Safety\"\n            },\n            {\n              \"change\": -5,\n              \"variable\": \"Delivery Confidence\"\n            }\n          ],\n          \"feedback\": \"Introsort-style behavior keeps Quicksort’s speed but switches strategies when partitions look bad, protecting worst-case. The extra engineering and testing lowers delivery confidence for tomorrow.\",\n          \"text\": \"Implement an introspective hybrid: fast avg + safe worst-case\"\n        },\n        {\n          \"effects\": [\n            {\n              \"change\": 8,\n              \"variable\": \"Memory Headroom\"\n            },\n            {\n              \"change\": -8,\n              \"variable\": \"Response Speed\"\n            },\n            {\n              \"change\": 5,\n              \"variable\": \"Delivery Confidence\"\n            }\n          ],\n          \"feedback\": \"Sorting smaller batches reduces peak memory and is straightforward operationally, but repeated overhead and less global ordering can add work, slowing the end-to-end pipeline.\",\n          \"text\": \"Sort in smaller batches to cap memory peaks\"\n        }\n      ],\n      \"question\": \"Which sorting approach fits our constraints?\"\n    },\n    {\n      \"context\": \"One more issue: the product team wants a new feature that changes query patterns, and we don’t know the new distribution yet. We can invest in measurement or gamble on assumptions. How do we proceed, {{NAME}}?\",\n      \"options\": [\n        {\n          \"effects\": [\n            {\n              \"change\": 10,\n              \"variable\": \"Worst-Case Safety\"\n            },\n            {\n              \"change\": 5,\n              \"variable\": \"Response Speed\"\n            },\n            {\n              \"change\": -5,\n              \"variable\": \"Delivery Confidence\"\n            }\n          ],\n          \"feedback\": \"Profiling and collecting distribution data lets you choose algorithms based on realistic average vs worst-case behavior. It improves decisions, but takes time to instrument, lowering near-term delivery confidence.\",\n          \"text\": \"Instrument and profile real query distributions\"\n        },\n        {\n          \"effects\": [\n            {\n              \"change\": 12,\n              \"variable\": \"Delivery Confidence\"\n            },\n            {\n              \"change\": -10,\n              \"variable\": \"Worst-Case Safety\"\n            },\n            {\n              \"change\": 5,\n              \"variable\": \"Response Speed\"\n            }\n          ],\n          \"feedback\": \"Optimizing for the expected case can boost speed quickly and keeps the roadmap moving. But if the new distribution is adversarial, worst-case blowups become more likely.\",\n          \"text\": \"Optimize for the expected case and ship\"\n        },\n        {\n          \"effects\": [\n            {\n              \"change\": 10,\n              \"variable\": \"Worst-Case Safety\"\n            },\n            {\n              \"change\": -5,\n              \"variable\": \"Response Speed\"\n            },\n            {\n              \"change\": 5,\n              \"variable\": \"Delivery Confidence\"\n            }\n          ],\n          \"feedback\": \"Adding guardrails (caps, fallbacks, timeouts) limits tail latency and protects SLAs. It can add a bit of overhead, but it’s a pragmatic balance between performance and safety.\",\n          \"text\": \"Add safeguards and fallbacks for pathological inputs\"\n        },\n        {\n          \"effects\": [\n            {\n              \"change\": 10,\n              \"variable\": \"Memory Headroom\"\n            },\n            {\n              \"change\": 8,\n              \"variable\": \"Response Speed\"\n            },\n            {\n              \"change\": -8,\n              \"variable\": \"Worst-Case Safety\"\n            }\n          ],\n          \"feedback\": \"More caching and precomputation can hide slow algorithms under typical load, trading memory for speed. But when caches miss or skew, the underlying worst-case still bites harder.\",\n          \"text\": \"Lean into precomputation/caching to mask slow paths\"\n        }\n      ],\n      \"question\": \"Do we measure, gamble, or build guardrails?\"\n    }\n  ]\n}",
      "outputTokens": 1706,
      "systemPrompt": "# Role\n\nYou are an expert educational game designer creating a **Challenge** activity for a learning app. Your mission is to design a strategic simulation where learners make decisions that affect inventory variables, navigating trade-offs to meet win conditions using the lesson's concepts.\n\nYou specialize in crafting game-like experiences that test strategic thinking and problem-solving — not just knowledge recall, but the ability to apply concepts under constraints.\n\n# The Art of Strategic Learning\n\nA great Challenge activity doesn't quiz — it simulates. Learners face realistic constraints where every choice has consequences. They must think strategically about trade-offs, just like real-world decision-making.\n\n## Why Trade-Off-Based Scenarios Work\n\n1. **Authentic Complexity**: Real problems have multiple variables that interact. Improving one often affects another.\n\n2. **Strategic Reasoning**: Learners must think several steps ahead, considering how choices compound.\n\n3. **No \"Right Answer\"**: When every option has pros and cons, learners engage with the WHY behind principles.\n\n4. **Memorable Stakes**: Managing resources and meeting goals creates emotional investment in outcomes.\n\n## The Trade-Off Principle\n\nEvery great Challenge activity creates genuine dilemmas:\n\n- **No Perfect Options**: Each choice improves some variables while affecting others\n- **Interconnected Systems**: Variables influence each other meaningfully\n- **Strategic Planning**: Success requires thinking beyond the immediate step\n- **Concept Application**: Understanding the lesson's principles helps navigate trade-offs\n\n# Inputs\n\n- `LESSON_TITLE`: The topic to create a challenge around\n- `LESSON_DESCRIPTION`: Additional context about what this lesson covers\n- `CHAPTER_TITLE`: The chapter context (for understanding scope)\n- `COURSE_TITLE`: The course context (for understanding audience level)\n- `LANGUAGE`: Output language\n- `EXPLANATION_STEPS`: Array of {title, text} from all explanation activities (Background, Explanation, Mechanics, Examples) the learner completed before this one\n\n## Language Guidelines\n\n- `en`: Use US English unless the content is region-specific\n- `pt`: Use Brazilian Portuguese unless the content is region-specific\n- `es`: Use Latin American Spanish unless the content is region-specific\n\n# Requirements\n\n## Introduction\n\nThe `intro` field sets the scene (max 500 characters). It should:\n\n- Establish the scenario and the learner's role\n- Explain what they're trying to achieve\n- Create stakes that feel meaningful\n- Use `{{NAME}}` to personalize\n\n## Inventory Design\n\nDesign 3-5 inventory items. Each item includes:\n\n- **name**: Variable name (intuitive, e.g., \"Budget\", \"Team Morale\", \"Code Quality\")\n- **startValue**: Initial value (typically 40-70, leaving room for gains and losses)\n- **winConditions**: Array of 1-2 conditions the learner must meet for this variable\n\nEach variable must:\n\n- **Represent lesson concepts**: Connect to something the learner studied\n- **Have clear meanings**: Names should be intuitive and unambiguous\n- **Interact meaningfully**: Actions that help one variable should plausibly affect others\n- **Name precisely**: Use specific names (e.g., \"Quantity Demanded\" not \"Market Demand\")\n\n### Variable Naming Rule: Positive Polarity\n\n**All variables must be named so that HIGHER = BETTER.**\n\nThis simple rule eliminates confusion about effect signs. When all variables are \"good things to have more of,\" the math is intuitive:\n\n- `+` means improvement (good outcome)\n- `-` means worsening (bad outcome)\n\n**Transform negative-polarity concepts into positive-polarity names:**\n\n| Instead of... | Use...              |\n| ------------- | ------------------- |\n| Cost          | Budget / Funds      |\n| Risk          | Safety / Security   |\n| Time          | Speed / Efficiency  |\n| Debt          | Financial Health    |\n| Errors        | Code Quality        |\n| Stress        | Team Morale         |\n| Waste         | Resource Efficiency |\n\n**The test:** Ask \"Is more of this good?\" If yes, the name works. If no, rename it.\n\n### Win Conditions Structure\n\nEach inventory item's `winConditions` array defines success criteria:\n\n- **operator**: `gte` (>=), `lte` (<=), `gt` (>), `lt` (<), `eq` (==)\n- **value**: Target number the variable must meet\n\n**Common patterns:**\n\n- **Minimum threshold**: `[{ \"operator\": \"gte\", \"value\": 30 }]` — \"Keep Budget above 30\"\n- **Maximum cap** (prevent runaway): `[{ \"operator\": \"lte\", \"value\": 80 }]` — \"Don't overspend on Quality\"\n- **Range constraint** (two conditions): `[{ \"operator\": \"gte\", \"value\": 20 }, { \"operator\": \"lte\", \"value\": 80 }]` — \"Keep Budget balanced\"\n\n**Example inventory item:**\n\n```json\n{\n  \"name\": \"Budget\",\n  \"startValue\": 50,\n  \"winConditions\": [\n    { \"operator\": \"gte\", \"value\": 20 },\n    { \"operator\": \"lte\", \"value\": 80 }\n  ]\n}\n```\n\n### Win Condition Achievability Check\n\n**MANDATORY**: Before finalizing, verify each win condition is mathematically achievable:\n\n1. Start with `startValue`, calculate achievable range based on cumulative effects\n2. For `gte` conditions: Target ≤ `startValue + (steps × max_positive_effect_per_step)`\n3. For `lte` conditions: Target ≥ `startValue + (steps × max_negative_effect_per_step)`\n4. Leave margin for strategic flexibility — don't require perfect play to win\n\n**Common mistake**: Setting `lte` targets too LOW or `gte` targets too HIGH. If a variable starts at 55 with max -15 per step across 4 steps, minimum achievable is -5. A target of `lte 5` requires dropping 50 points — verify your effects allow this!\n\n## Step Structure\n\nEach step must have:\n\n- **context**: Maximum 500 characters. Pure dialogue from your colleague setting up the decision. Use a conversational style: no narrator, no character prefixes.\n- **question**: Maximum 100 characters. A clear question about what to do.\n- **options**: **EXACTLY 3-4 choices** (never fewer than 3), each with:\n  - **text**: The choice description (max 80 characters)\n  - **effects**: Array of {variable, change} pairs showing how this choice affects inventory\n  - **feedback**: Why this choice has these effects — max 300 characters. Should explain the reasoning, not just state the outcome.\n\n**CRITICAL**: Every step MUST have at least 3 options. Having only 2 options is a format violation.\n\n## Step Count\n\n- Minimum: 3 steps\n- Maximum: 6 steps\n\n## Tone & Style\n\n- **Pure dialogue**: NO narrator, NO character prefixes, NO action descriptions\n- **Natural conversation**: Colleagues working through a problem together\n- **Professional but warm**: Light humor when appropriate\n- **Second-person immersion**: The colleague speaks TO the learner\n- **Strategic framing**: Dialogue should hint at trade-offs without giving away optimal choices\n\n## The {{NAME}} Placeholder\n\nUse `{{NAME}}` wherever the learner's name should appear. For example:\n\n- \"{{NAME}}, we need to make a call here.\"\n- \"Good thinking, {{NAME}}. But we should consider the trade-offs.\"\n\n## Effect Design\n\nEvery option must:\n\n- **Have meaningful effects**: At least 1-2 variables should change\n- **Show trade-offs**: Most options should help some variables while hurting others\n- **Use realistic magnitudes**: Changes of 5-20 points are typical; dramatic swings (30+) should be rare\n- **Connect to lesson concepts**: The REASON for effects should reflect lesson principles\n\nExample effects structure:\n\n```json\n{\n  \"effects\": [\n    { \"variable\": \"Budget\", \"change\": -15 },\n    { \"variable\": \"Quality\", \"change\": 10 }\n  ]\n}\n```\n\n## What to Avoid\n\n- **Dominant options**: No choice should be obviously best across all variables. For EACH step, compare options: if one option has BETTER OR EQUAL effects on ALL variables compared to another, it's dominant. Example: Option A (+10 Quality, -5 Budget) vs Option B (+5 Quality, -10 Budget) — A dominates B. Fix by giving B something A lacks, like +5 Morale.\n- **Trivial decisions**: Every step should require real thought about trade-offs\n- **Disconnected variables**: Effects should make conceptual sense\n- **Extreme swings**: Avoid changes that guarantee win/loss in one step\n- **Narrator text or descriptions**: Keep it pure dialogue\n- **Quiz-style questions**: This tests strategic thinking and problem-solving, not recall\n- **Negative-polarity variables**: Never name variables where \"more is worse\" (like \"Cost\" or \"Risk\"). Use the transform table to rename them (Budget, Safety, etc.)\n- **Single-path variables**: NEVER create a variable that can only be improved by ONE option in the entire game. Every win condition variable MUST be influenceable by options in multiple steps. Otherwise, that option becomes mandatory and removes player agency\n\n## Scope\n\n- **Stay focused**: The scenario should require THIS lesson's concepts to navigate well\n- **Meaningful variables**: Each inventory variable should connect to lesson principles\n- **Realistic trade-offs**: The trade-offs should reflect how these concepts work in practice\n\n## Relationship to Previous Activities\n\nThe learner has already completed:\n\n- **Background**: WHY this exists (origin story, problems solved, historical context)\n- **Explanation**: WHAT it is (core concepts, components, definitions)\n- **Mechanics**: HOW it works (processes in action, cause-effect chains)\n- **Examples**: WHERE it appears (real-world contexts, applications)\n- **Story**: WHEN to apply this (dialogue-based problem solving)\n\nYour Challenge activity is the capstone: **CAN YOU HANDLE THIS?** It tests whether learners can apply concepts strategically under constraints. This is the most challenging activity — it should feel like a real test of understanding.\n\n- Background: \"WHY did we need this?\"\n- Explanation: \"WHAT exactly is it?\"\n- Mechanics: \"HOW does it actually work?\"\n- Examples: \"WHERE will I encounter this?\"\n- Story: \"WHEN do I apply this?\"\n- **Challenge: \"CAN I navigate complex trade-offs using this?\"**\n\n# Structure Guide\n\nA typical Challenge follows this arc:\n\n1. **Setup**: Establish the scenario, variables, and goal in the intro\n2. **Initial Decision**: First choice with clear trade-offs to teach the mechanics\n3. **Escalating Complexity**: Middle decisions where variables interact more\n4. **Critical Choice**: A pivotal decision that significantly affects outcomes\n5. **Resolution Setup**: Final decision that determines if win conditions are met\n\nNote: The challenge should feel winnable but require understanding the lesson's principles to succeed consistently.\n\n# Dialogue Tone Examples\n\n## Setting Up Trade-Offs\n\n> \"{{NAME}}, here's our situation. We can push for faster delivery, but that means cutting corners on testing. Or we take our time and risk missing the window. What's our priority?\"\n\n> \"The client wants both lower costs AND higher quality. {{NAME}}, we both know we can't maximize both. Where do we compromise?\"\n\n## Explaining Consequences\n\n> \"Interesting choice, {{NAME}}. Going that route saved us time, but I'm already seeing signs of technical debt building up. Let's see how this plays out.\"\n\n> \"That definitely boosted our short-term numbers. But {{NAME}}, remember — these variables are connected. Watch what happens next.\"\n\n## Strategic Moments\n\n> \"{{NAME}}, we're at a crossroads. Our budget is tight, but team morale is dropping. If we don't address one, the other gets worse. What's your call?\"\n\n> \"This is the big one, {{NAME}}. The choice we make here pretty much determines whether we hit our targets. No pressure.\"\n\n# Quality Checks\n\nBefore finalizing, verify:\n\n- [ ] Does the intro clearly establish the scenario, goal, and stakes?\n- [ ] Do inventory variables connect meaningfully to lesson concepts?\n- [ ] POSITIVE POLARITY: For each variable, is \"more\" always better? (Budget not Cost, Safety not Risk, Speed not Time)\n- [ ] MATHEMATICAL ACHIEVABILITY: For each win condition, is the target mathematically reachable given startValue and cumulative effect ranges?\n- [ ] Does every option have genuine trade-offs (no dominant choices)?\n- [ ] Do effects make conceptual sense given the lesson content?\n- [ ] Is `{{NAME}}` used appropriately throughout?\n- [ ] Is all dialogue pure conversation (no narrator, no prefixes)?\n- [ ] Does feedback explain WHY effects occur, not just state them?\n- [ ] Is the scope exactly the lesson topic?\n- [ ] Are all constraints met (intro ≤500 chars, context ≤500 chars, question ≤100 chars, text ≤80 chars, feedback ≤300 chars)?\n- [ ] Is the step count between 3 and 6?\n- [ ] Do inventory values start in a reasonable range (typically 40-70)?\n- [ ] Are effect magnitudes reasonable (typically 5-20 points)?\n- [ ] Does EVERY step have at least 3 options? (Never just 2 options)\n- [ ] Does each inventory item have at least one win condition?\n- [ ] For each variable, are there multiple options across different steps that can affect it? (No single-path variables)\n- [ ] DOMINANT OPTIONS: For each step, is there any option that beats another on ALL variables? If so, fix it by giving the weaker option a unique advantage.\n\n# Output Format\n\nReturn an object with:\n\n- **intro**: Scenario introduction (max 500 chars)\n- **inventory**: Array of 3-5 inventory items, each with:\n  - **name**: Variable name\n  - **startValue**: Initial value (typically 40-70)\n  - **winConditions**: Array of 1-2 conditions, each with:\n    - **operator**: One of \"gte\", \"lte\", \"gt\", \"lt\", \"eq\"\n    - **value**: Target number\n- **steps**: Array of 3-6 step objects, each with:\n  - **context**: Pure dialogue (max 500 chars)\n  - **question**: Decision prompt (max 100 chars)\n  - **options**: Array of 3-4 objects with:\n    - **text**: Choice description (max 80 chars)\n    - **effects**: Array of {variable, change} pairs\n    - **feedback**: Explanation of effects (max 300 chars)\n",
      "testCaseId": "en-cs-algorithm-complexity-1",
      "userPrompt": "LESSON_TITLE: Algorithm Complexity Trade-offs\nLESSON_DESCRIPTION: Understanding and applying algorithm complexity analysis to make informed trade-offs in software design\nCHAPTER_TITLE: Algorithm Analysis\nCOURSE_TITLE: Data Structures and Algorithms\nLANGUAGE: en\nEXPLANATION_STEPS:\n1. Time Complexity: Time complexity measures how execution time grows with input size. O(n) means linear growth — double the input, double the time. O(n²) means quadratic — double the input, quadruple the time.\n2. Space Complexity: Space complexity measures memory usage growth. Some algorithms trade time for space — storing precomputed results to avoid recalculation. Others trade space for time — using less memory but computing more.\n3. Time-Space Trade-off: The time-space trade-off is fundamental. Hash tables give O(1) lookup but use extra memory. Binary search uses O(1) space but requires sorted data. Choose based on constraints.\n4. Amortized Analysis: Amortized analysis looks at average performance over many operations. ArrayList append is usually O(1), but occasionally O(n) when resizing. Amortized, it's still O(1).\n5. Case Analysis: Best, average, and worst case can differ dramatically. Quicksort averages O(n log n) but worst-cases to O(n²). Know your data distribution to choose wisely."
    },
    {
      "duration": 38996.434250000006,
      "inputTokens": 3574,
      "output": "{\n  \"intro\": \"{{NAME}}, you’re running pricing for a bottled cold-brew brand about to launch in 2 new neighborhoods. We need a price and production plan that avoids ugly surpluses or shortages while keeping profits and customer goodwill strong. Four decisions, real trade-offs—hit the targets by launch day.\",\n  \"inventory\": [\n    {\n      \"name\": \"Profit Potential\",\n      \"startValue\": 55,\n      \"winConditions\": [\n        {\n          \"operator\": \"gte\",\n          \"value\": 65\n        }\n      ]\n    },\n    {\n      \"name\": \"Market Balance\",\n      \"startValue\": 50,\n      \"winConditions\": [\n        {\n          \"operator\": \"gte\",\n          \"value\": 60\n        }\n      ]\n    },\n    {\n      \"name\": \"Customer Goodwill\",\n      \"startValue\": 60,\n      \"winConditions\": [\n        {\n          \"operator\": \"gte\",\n          \"value\": 55\n        }\n      ]\n    },\n    {\n      \"name\": \"Supply Flexibility\",\n      \"startValue\": 50,\n      \"winConditions\": [\n        {\n          \"operator\": \"gte\",\n          \"value\": 55\n        }\n      ]\n    }\n  ],\n  \"steps\": [\n    {\n      \"context\": \"We need an opening price for launch. Our data says demand is fairly elastic in Neighborhood A and more inelastic in Neighborhood B. One price for both to keep things simple. Where do you want to start, {{NAME}}?\",\n      \"options\": [\n        {\n          \"effects\": [\n            {\n              \"change\": 15,\n              \"variable\": \"Profit Potential\"\n            },\n            {\n              \"change\": -12,\n              \"variable\": \"Market Balance\"\n            },\n            {\n              \"change\": -10,\n              \"variable\": \"Customer Goodwill\"\n            }\n          ],\n          \"feedback\": \"A higher price boosts margin, but with elastic demand you’ll see a bigger drop in quantity demanded. That mismatch can leave supply ahead of demand (surplus) and customers may feel we’re overpriced.\",\n          \"text\": \"Premium price above likely equilibrium\"\n        },\n        {\n          \"effects\": [\n            {\n              \"change\": 8,\n              \"variable\": \"Market Balance\"\n            },\n            {\n              \"change\": 6,\n              \"variable\": \"Customer Goodwill\"\n            },\n            {\n              \"change\": -6,\n              \"variable\": \"Profit Potential\"\n            }\n          ],\n          \"feedback\": \"Pricing near equilibrium helps quantity supplied and demanded align, reducing surplus/shortage risk. Customers see it as fair, but the margin per bottle is lower, so profit potential rises less.\",\n          \"text\": \"Price near estimated equilibrium\"\n        },\n        {\n          \"effects\": [\n            {\n              \"change\": -14,\n              \"variable\": \"Market Balance\"\n            },\n            {\n              \"change\": 10,\n              \"variable\": \"Customer Goodwill\"\n            },\n            {\n              \"change\": -4,\n              \"variable\": \"Profit Potential\"\n            },\n            {\n              \"change\": 5,\n              \"variable\": \"Supply Flexibility\"\n            }\n          ],\n          \"feedback\": \"A low price increases quantity demanded (movement along the demand curve), risking a shortage if supply can’t keep up. Goodwill rises, but stockouts hurt balance; you may need flexible supply to respond.\",\n          \"text\": \"Penetration price below likely equilibrium\"\n        }\n      ],\n      \"question\": \"What launch price strategy should we use?\"\n    },\n    {\n      \"context\": \"Heads up: our bean supplier just warned of higher transport costs next month. That’s a supply-side factor, so it could shift the supply curve. We can react now, but each move has consequences. What’s your play, {{NAME}}?\",\n      \"options\": [\n        {\n          \"effects\": [\n            {\n              \"change\": 12,\n              \"variable\": \"Supply Flexibility\"\n            },\n            {\n              \"change\": 6,\n              \"variable\": \"Market Balance\"\n            },\n            {\n              \"change\": -10,\n              \"variable\": \"Profit Potential\"\n            }\n          ],\n          \"feedback\": \"Investing in backup suppliers and faster logistics makes supply more responsive, reducing shortage risk when costs rise. But it’s expensive up front, so profit potential takes a hit.\",\n          \"text\": \"Secure backup supplier + faster logistics\"\n        },\n        {\n          \"effects\": [\n            {\n              \"change\": 10,\n              \"variable\": \"Profit Potential\"\n            },\n            {\n              \"change\": -8,\n              \"variable\": \"Customer Goodwill\"\n            },\n            {\n              \"change\": -6,\n              \"variable\": \"Market Balance\"\n            }\n          ],\n          \"feedback\": \"Passing costs into price can protect margins, but it moves you up the demand curve—lower quantity demanded—raising surplus risk if production plans don’t adjust. Customers may react negatively to a hike.\",\n          \"text\": \"Pre-announce a price increase to offset costs\"\n        },\n        {\n          \"effects\": [\n            {\n              \"change\": 7,\n              \"variable\": \"Profit Potential\"\n            },\n            {\n              \"change\": 7,\n              \"variable\": \"Customer Goodwill\"\n            },\n            {\n              \"change\": -10,\n              \"variable\": \"Supply Flexibility\"\n            }\n          ],\n          \"feedback\": \"If you improve perceived value, demand can shift right without changing price. That supports sales and margin, but it doesn’t fix the supply-side constraint—less flexibility means higher stockout risk if demand rises.\",\n          \"text\": \"Run a value-focused campaign instead of changing price\"\n        },\n        {\n          \"effects\": [\n            {\n              \"change\": 12,\n              \"variable\": \"Market Balance\"\n            },\n            {\n              \"change\": 4,\n              \"variable\": \"Profit Potential\"\n            },\n            {\n              \"change\": -8,\n              \"variable\": \"Customer Goodwill\"\n            }\n          ],\n          \"feedback\": \"Tightening orders reduces the chance of surplus if costs push supply left, improving balance and protecting some profit. But if customers see empty shelves or limited availability, goodwill can drop.\",\n          \"text\": \"Cut production orders to avoid surplus risk\"\n        }\n      ],\n      \"question\": \"How do we handle the expected supply shift?\"\n    },\n    {\n      \"context\": \"Early sales data is in: Neighborhood A is reacting strongly to price changes—more elastic than we thought. Neighborhood B is steady. We can’t reprint everything easily, but we can tweak strategy. What do you want to optimize for, {{NAME}}?\",\n      \"options\": [\n        {\n          \"effects\": [\n            {\n              \"change\": 12,\n              \"variable\": \"Market Balance\"\n            },\n            {\n              \"change\": 8,\n              \"variable\": \"Customer Goodwill\"\n            },\n            {\n              \"change\": -10,\n              \"variable\": \"Profit Potential\"\n            }\n          ],\n          \"feedback\": \"Lowering price in an elastic segment raises quantity demanded significantly, reducing surplus and boosting goodwill. The trade-off is lower margin, so profit potential drops.\",\n          \"text\": \"Targeted couponing aimed at Neighborhood A\"\n        },\n        {\n          \"effects\": [\n            {\n              \"change\": 14,\n              \"variable\": \"Profit Potential\"\n            },\n            {\n              \"change\": -10,\n              \"variable\": \"Customer Goodwill\"\n            },\n            {\n              \"change\": -8,\n              \"variable\": \"Market Balance\"\n            }\n          ],\n          \"feedback\": \"Keeping price high preserves margin, and in the inelastic area sales won’t fall much. But elastic customers cut back sharply, increasing imbalance and potential leftover inventory, plus fairness concerns.\",\n          \"text\": \"Hold price; lean into premium positioning\"\n        },\n        {\n          \"effects\": [\n            {\n              \"change\": 10,\n              \"variable\": \"Market Balance\"\n            },\n            {\n              \"change\": 8,\n              \"variable\": \"Supply Flexibility\"\n            },\n            {\n              \"change\": -6,\n              \"variable\": \"Profit Potential\"\n            }\n          ],\n          \"feedback\": \"Improving forecasting and smaller batch runs help match quantity supplied to shifting quantity demanded—better equilibrium tracking. It costs efficiency and scale, so profit potential declines a bit.\",\n          \"text\": \"Shift to smaller batches + better demand forecasting\"\n        },\n        {\n          \"effects\": [\n            {\n              \"change\": 12,\n              \"variable\": \"Profit Potential\"\n            },\n            {\n              \"change\": 10,\n              \"variable\": \"Supply Flexibility\"\n            },\n            {\n              \"change\": -12,\n              \"variable\": \"Market Balance\"\n            }\n          ],\n          \"feedback\": \"Expanding output can capture more sales if demand is there, but if elastic demand stays weak at this price, you’ll create surplus. Flexibility rises from added capacity, yet balance may suffer.\",\n          \"text\": \"Increase production to “grow into” demand\"\n        }\n      ],\n      \"question\": \"How do we respond to the elasticity surprise?\"\n    },\n    {\n      \"context\": \"Last call before launch week: we’re seeing either sell-outs in some stores or unsold cases in others, depending on the day. We need one operational policy to keep us close to equilibrium without blowing up trust. What do you choose, {{NAME}}?\",\n      \"options\": [\n        {\n          \"effects\": [\n            {\n              \"change\": 15,\n              \"variable\": \"Market Balance\"\n            },\n            {\n              \"change\": 8,\n              \"variable\": \"Supply Flexibility\"\n            },\n            {\n              \"change\": -8,\n              \"variable\": \"Profit Potential\"\n            }\n          ],\n          \"feedback\": \"Dynamic restocking and quick reallocations help reduce both shortages and surpluses—closer to equilibrium day-to-day. The logistics spend trims profit potential, but it stabilizes the market outcome.\",\n          \"text\": \"Dynamic restocking + reallocate inventory across stores\"\n        },\n        {\n          \"effects\": [\n            {\n              \"change\": 16,\n              \"variable\": \"Profit Potential\"\n            },\n            {\n              \"change\": -14,\n              \"variable\": \"Customer Goodwill\"\n            },\n            {\n              \"change\": -8,\n              \"variable\": \"Market Balance\"\n            }\n          ],\n          \"feedback\": \"Raising price during sell-outs moves up the demand curve, reducing quantity demanded and protecting margins. But customers may feel gouged, and you can overshoot into surplus if demand cools.\",\n          \"text\": \"Raise prices in stores that sell out quickly\"\n        },\n        {\n          \"effects\": [\n            {\n              \"change\": 12,\n              \"variable\": \"Customer Goodwill\"\n            },\n            {\n              \"change\": 10,\n              \"variable\": \"Market Balance\"\n            },\n            {\n              \"change\": -10,\n              \"variable\": \"Profit Potential\"\n            }\n          ],\n          \"feedback\": \"A consistent availability promise pushes you to prioritize meeting quantity demanded, reducing shortage-driven frustration and smoothing balance. It typically requires discounts, extra handling, or inefficiencies that lower profit.\",\n          \"text\": \"Guarantee availability: prioritize no stockouts\"\n        },\n        {\n          \"effects\": [\n            {\n              \"change\": 14,\n              \"variable\": \"Profit Potential\"\n            },\n            {\n              \"change\": 6,\n              \"variable\": \"Customer Goodwill\"\n            },\n            {\n              \"change\": -10,\n              \"variable\": \"Supply Flexibility\"\n            }\n          ],\n          \"feedback\": \"Simplifying to fewer delivery days cuts operational cost and can boost profit potential, and customers may like predictability. But lower flexibility makes it harder to respond to demand shifts, risking imbalance.\",\n          \"text\": \"Simplify operations: fewer delivery days, fixed quantities\"\n        }\n      ],\n      \"question\": \"What policy keeps us closest to equilibrium this week?\"\n    }\n  ]\n}",
      "outputTokens": 1703,
      "systemPrompt": "# Role\n\nYou are an expert educational game designer creating a **Challenge** activity for a learning app. Your mission is to design a strategic simulation where learners make decisions that affect inventory variables, navigating trade-offs to meet win conditions using the lesson's concepts.\n\nYou specialize in crafting game-like experiences that test strategic thinking and problem-solving — not just knowledge recall, but the ability to apply concepts under constraints.\n\n# The Art of Strategic Learning\n\nA great Challenge activity doesn't quiz — it simulates. Learners face realistic constraints where every choice has consequences. They must think strategically about trade-offs, just like real-world decision-making.\n\n## Why Trade-Off-Based Scenarios Work\n\n1. **Authentic Complexity**: Real problems have multiple variables that interact. Improving one often affects another.\n\n2. **Strategic Reasoning**: Learners must think several steps ahead, considering how choices compound.\n\n3. **No \"Right Answer\"**: When every option has pros and cons, learners engage with the WHY behind principles.\n\n4. **Memorable Stakes**: Managing resources and meeting goals creates emotional investment in outcomes.\n\n## The Trade-Off Principle\n\nEvery great Challenge activity creates genuine dilemmas:\n\n- **No Perfect Options**: Each choice improves some variables while affecting others\n- **Interconnected Systems**: Variables influence each other meaningfully\n- **Strategic Planning**: Success requires thinking beyond the immediate step\n- **Concept Application**: Understanding the lesson's principles helps navigate trade-offs\n\n# Inputs\n\n- `LESSON_TITLE`: The topic to create a challenge around\n- `LESSON_DESCRIPTION`: Additional context about what this lesson covers\n- `CHAPTER_TITLE`: The chapter context (for understanding scope)\n- `COURSE_TITLE`: The course context (for understanding audience level)\n- `LANGUAGE`: Output language\n- `EXPLANATION_STEPS`: Array of {title, text} from all explanation activities (Background, Explanation, Mechanics, Examples) the learner completed before this one\n\n## Language Guidelines\n\n- `en`: Use US English unless the content is region-specific\n- `pt`: Use Brazilian Portuguese unless the content is region-specific\n- `es`: Use Latin American Spanish unless the content is region-specific\n\n# Requirements\n\n## Introduction\n\nThe `intro` field sets the scene (max 500 characters). It should:\n\n- Establish the scenario and the learner's role\n- Explain what they're trying to achieve\n- Create stakes that feel meaningful\n- Use `{{NAME}}` to personalize\n\n## Inventory Design\n\nDesign 3-5 inventory items. Each item includes:\n\n- **name**: Variable name (intuitive, e.g., \"Budget\", \"Team Morale\", \"Code Quality\")\n- **startValue**: Initial value (typically 40-70, leaving room for gains and losses)\n- **winConditions**: Array of 1-2 conditions the learner must meet for this variable\n\nEach variable must:\n\n- **Represent lesson concepts**: Connect to something the learner studied\n- **Have clear meanings**: Names should be intuitive and unambiguous\n- **Interact meaningfully**: Actions that help one variable should plausibly affect others\n- **Name precisely**: Use specific names (e.g., \"Quantity Demanded\" not \"Market Demand\")\n\n### Variable Naming Rule: Positive Polarity\n\n**All variables must be named so that HIGHER = BETTER.**\n\nThis simple rule eliminates confusion about effect signs. When all variables are \"good things to have more of,\" the math is intuitive:\n\n- `+` means improvement (good outcome)\n- `-` means worsening (bad outcome)\n\n**Transform negative-polarity concepts into positive-polarity names:**\n\n| Instead of... | Use...              |\n| ------------- | ------------------- |\n| Cost          | Budget / Funds      |\n| Risk          | Safety / Security   |\n| Time          | Speed / Efficiency  |\n| Debt          | Financial Health    |\n| Errors        | Code Quality        |\n| Stress        | Team Morale         |\n| Waste         | Resource Efficiency |\n\n**The test:** Ask \"Is more of this good?\" If yes, the name works. If no, rename it.\n\n### Win Conditions Structure\n\nEach inventory item's `winConditions` array defines success criteria:\n\n- **operator**: `gte` (>=), `lte` (<=), `gt` (>), `lt` (<), `eq` (==)\n- **value**: Target number the variable must meet\n\n**Common patterns:**\n\n- **Minimum threshold**: `[{ \"operator\": \"gte\", \"value\": 30 }]` — \"Keep Budget above 30\"\n- **Maximum cap** (prevent runaway): `[{ \"operator\": \"lte\", \"value\": 80 }]` — \"Don't overspend on Quality\"\n- **Range constraint** (two conditions): `[{ \"operator\": \"gte\", \"value\": 20 }, { \"operator\": \"lte\", \"value\": 80 }]` — \"Keep Budget balanced\"\n\n**Example inventory item:**\n\n```json\n{\n  \"name\": \"Budget\",\n  \"startValue\": 50,\n  \"winConditions\": [\n    { \"operator\": \"gte\", \"value\": 20 },\n    { \"operator\": \"lte\", \"value\": 80 }\n  ]\n}\n```\n\n### Win Condition Achievability Check\n\n**MANDATORY**: Before finalizing, verify each win condition is mathematically achievable:\n\n1. Start with `startValue`, calculate achievable range based on cumulative effects\n2. For `gte` conditions: Target ≤ `startValue + (steps × max_positive_effect_per_step)`\n3. For `lte` conditions: Target ≥ `startValue + (steps × max_negative_effect_per_step)`\n4. Leave margin for strategic flexibility — don't require perfect play to win\n\n**Common mistake**: Setting `lte` targets too LOW or `gte` targets too HIGH. If a variable starts at 55 with max -15 per step across 4 steps, minimum achievable is -5. A target of `lte 5` requires dropping 50 points — verify your effects allow this!\n\n## Step Structure\n\nEach step must have:\n\n- **context**: Maximum 500 characters. Pure dialogue from your colleague setting up the decision. Use a conversational style: no narrator, no character prefixes.\n- **question**: Maximum 100 characters. A clear question about what to do.\n- **options**: **EXACTLY 3-4 choices** (never fewer than 3), each with:\n  - **text**: The choice description (max 80 characters)\n  - **effects**: Array of {variable, change} pairs showing how this choice affects inventory\n  - **feedback**: Why this choice has these effects — max 300 characters. Should explain the reasoning, not just state the outcome.\n\n**CRITICAL**: Every step MUST have at least 3 options. Having only 2 options is a format violation.\n\n## Step Count\n\n- Minimum: 3 steps\n- Maximum: 6 steps\n\n## Tone & Style\n\n- **Pure dialogue**: NO narrator, NO character prefixes, NO action descriptions\n- **Natural conversation**: Colleagues working through a problem together\n- **Professional but warm**: Light humor when appropriate\n- **Second-person immersion**: The colleague speaks TO the learner\n- **Strategic framing**: Dialogue should hint at trade-offs without giving away optimal choices\n\n## The {{NAME}} Placeholder\n\nUse `{{NAME}}` wherever the learner's name should appear. For example:\n\n- \"{{NAME}}, we need to make a call here.\"\n- \"Good thinking, {{NAME}}. But we should consider the trade-offs.\"\n\n## Effect Design\n\nEvery option must:\n\n- **Have meaningful effects**: At least 1-2 variables should change\n- **Show trade-offs**: Most options should help some variables while hurting others\n- **Use realistic magnitudes**: Changes of 5-20 points are typical; dramatic swings (30+) should be rare\n- **Connect to lesson concepts**: The REASON for effects should reflect lesson principles\n\nExample effects structure:\n\n```json\n{\n  \"effects\": [\n    { \"variable\": \"Budget\", \"change\": -15 },\n    { \"variable\": \"Quality\", \"change\": 10 }\n  ]\n}\n```\n\n## What to Avoid\n\n- **Dominant options**: No choice should be obviously best across all variables. For EACH step, compare options: if one option has BETTER OR EQUAL effects on ALL variables compared to another, it's dominant. Example: Option A (+10 Quality, -5 Budget) vs Option B (+5 Quality, -10 Budget) — A dominates B. Fix by giving B something A lacks, like +5 Morale.\n- **Trivial decisions**: Every step should require real thought about trade-offs\n- **Disconnected variables**: Effects should make conceptual sense\n- **Extreme swings**: Avoid changes that guarantee win/loss in one step\n- **Narrator text or descriptions**: Keep it pure dialogue\n- **Quiz-style questions**: This tests strategic thinking and problem-solving, not recall\n- **Negative-polarity variables**: Never name variables where \"more is worse\" (like \"Cost\" or \"Risk\"). Use the transform table to rename them (Budget, Safety, etc.)\n- **Single-path variables**: NEVER create a variable that can only be improved by ONE option in the entire game. Every win condition variable MUST be influenceable by options in multiple steps. Otherwise, that option becomes mandatory and removes player agency\n\n## Scope\n\n- **Stay focused**: The scenario should require THIS lesson's concepts to navigate well\n- **Meaningful variables**: Each inventory variable should connect to lesson principles\n- **Realistic trade-offs**: The trade-offs should reflect how these concepts work in practice\n\n## Relationship to Previous Activities\n\nThe learner has already completed:\n\n- **Background**: WHY this exists (origin story, problems solved, historical context)\n- **Explanation**: WHAT it is (core concepts, components, definitions)\n- **Mechanics**: HOW it works (processes in action, cause-effect chains)\n- **Examples**: WHERE it appears (real-world contexts, applications)\n- **Story**: WHEN to apply this (dialogue-based problem solving)\n\nYour Challenge activity is the capstone: **CAN YOU HANDLE THIS?** It tests whether learners can apply concepts strategically under constraints. This is the most challenging activity — it should feel like a real test of understanding.\n\n- Background: \"WHY did we need this?\"\n- Explanation: \"WHAT exactly is it?\"\n- Mechanics: \"HOW does it actually work?\"\n- Examples: \"WHERE will I encounter this?\"\n- Story: \"WHEN do I apply this?\"\n- **Challenge: \"CAN I navigate complex trade-offs using this?\"**\n\n# Structure Guide\n\nA typical Challenge follows this arc:\n\n1. **Setup**: Establish the scenario, variables, and goal in the intro\n2. **Initial Decision**: First choice with clear trade-offs to teach the mechanics\n3. **Escalating Complexity**: Middle decisions where variables interact more\n4. **Critical Choice**: A pivotal decision that significantly affects outcomes\n5. **Resolution Setup**: Final decision that determines if win conditions are met\n\nNote: The challenge should feel winnable but require understanding the lesson's principles to succeed consistently.\n\n# Dialogue Tone Examples\n\n## Setting Up Trade-Offs\n\n> \"{{NAME}}, here's our situation. We can push for faster delivery, but that means cutting corners on testing. Or we take our time and risk missing the window. What's our priority?\"\n\n> \"The client wants both lower costs AND higher quality. {{NAME}}, we both know we can't maximize both. Where do we compromise?\"\n\n## Explaining Consequences\n\n> \"Interesting choice, {{NAME}}. Going that route saved us time, but I'm already seeing signs of technical debt building up. Let's see how this plays out.\"\n\n> \"That definitely boosted our short-term numbers. But {{NAME}}, remember — these variables are connected. Watch what happens next.\"\n\n## Strategic Moments\n\n> \"{{NAME}}, we're at a crossroads. Our budget is tight, but team morale is dropping. If we don't address one, the other gets worse. What's your call?\"\n\n> \"This is the big one, {{NAME}}. The choice we make here pretty much determines whether we hit our targets. No pressure.\"\n\n# Quality Checks\n\nBefore finalizing, verify:\n\n- [ ] Does the intro clearly establish the scenario, goal, and stakes?\n- [ ] Do inventory variables connect meaningfully to lesson concepts?\n- [ ] POSITIVE POLARITY: For each variable, is \"more\" always better? (Budget not Cost, Safety not Risk, Speed not Time)\n- [ ] MATHEMATICAL ACHIEVABILITY: For each win condition, is the target mathematically reachable given startValue and cumulative effect ranges?\n- [ ] Does every option have genuine trade-offs (no dominant choices)?\n- [ ] Do effects make conceptual sense given the lesson content?\n- [ ] Is `{{NAME}}` used appropriately throughout?\n- [ ] Is all dialogue pure conversation (no narrator, no prefixes)?\n- [ ] Does feedback explain WHY effects occur, not just state them?\n- [ ] Is the scope exactly the lesson topic?\n- [ ] Are all constraints met (intro ≤500 chars, context ≤500 chars, question ≤100 chars, text ≤80 chars, feedback ≤300 chars)?\n- [ ] Is the step count between 3 and 6?\n- [ ] Do inventory values start in a reasonable range (typically 40-70)?\n- [ ] Are effect magnitudes reasonable (typically 5-20 points)?\n- [ ] Does EVERY step have at least 3 options? (Never just 2 options)\n- [ ] Does each inventory item have at least one win condition?\n- [ ] For each variable, are there multiple options across different steps that can affect it? (No single-path variables)\n- [ ] DOMINANT OPTIONS: For each step, is there any option that beats another on ALL variables? If so, fix it by giving the weaker option a unique advantage.\n\n# Output Format\n\nReturn an object with:\n\n- **intro**: Scenario introduction (max 500 chars)\n- **inventory**: Array of 3-5 inventory items, each with:\n  - **name**: Variable name\n  - **startValue**: Initial value (typically 40-70)\n  - **winConditions**: Array of 1-2 conditions, each with:\n    - **operator**: One of \"gte\", \"lte\", \"gt\", \"lt\", \"eq\"\n    - **value**: Target number\n- **steps**: Array of 3-6 step objects, each with:\n  - **context**: Pure dialogue (max 500 chars)\n  - **question**: Decision prompt (max 100 chars)\n  - **options**: Array of 3-4 objects with:\n    - **text**: Choice description (max 80 chars)\n    - **effects**: Array of {variable, change} pairs\n    - **feedback**: Explanation of effects (max 300 chars)\n",
      "testCaseId": "en-economics-supply-demand-1",
      "userPrompt": "LESSON_TITLE: Supply and Demand in Practice\nLESSON_DESCRIPTION: Applying supply and demand principles to make strategic pricing and market decisions\nCHAPTER_TITLE: Market Dynamics\nCOURSE_TITLE: Microeconomics Fundamentals\nLANGUAGE: en\nEXPLANATION_STEPS:\n1. The Demand Curve: Demand curves slope downward — as price rises, quantity demanded falls. This reflects the law of demand: people buy less when things cost more, all else equal.\n2. The Supply Curve: Supply curves slope upward — as price rises, quantity supplied increases. Higher prices incentivize producers to make more. Lower prices make production less worthwhile.\n3. Market Equilibrium: Equilibrium occurs where supply meets demand. At this price, quantity supplied equals quantity demanded. Prices above equilibrium create surplus; prices below create shortage.\n4. Price Elasticity: Price elasticity measures responsiveness to price changes. Elastic demand (>1) means sales drop sharply with price increases. Inelastic demand (<1) means sales barely change.\n5. Shifts vs. Movements: Shifts vs. movements: A change in price moves along the curve. Changes in other factors (income, preferences, costs) shift the entire curve. This distinction is crucial."
    },
    {
      "duration": 38932.903999999995,
      "inputTokens": 3582,
      "output": "{\n  \"intro\": \"{{NAME}}, you’re advising a regional park as drought pressure and tourism rise. We need a management plan that keeps the food web stable, prevents overshoot past carrying capacity, and builds resilience before the next shock. Hit the targets without “solving” one problem by breaking another.\",\n  \"inventory\": [\n    {\n      \"name\": \"Food Web Stability\",\n      \"startValue\": 55,\n      \"winConditions\": [\n        {\n          \"operator\": \"gte\",\n          \"value\": 65\n        }\n      ]\n    },\n    {\n      \"name\": \"Habitat Capacity Buffer\",\n      \"startValue\": 50,\n      \"winConditions\": [\n        {\n          \"operator\": \"gte\",\n          \"value\": 55\n        }\n      ]\n    },\n    {\n      \"name\": \"Biodiversity Resilience\",\n      \"startValue\": 52,\n      \"winConditions\": [\n        {\n          \"operator\": \"gte\",\n          \"value\": 65\n        }\n      ]\n    },\n    {\n      \"name\": \"Community Support\",\n      \"startValue\": 58,\n      \"winConditions\": [\n        {\n          \"operator\": \"gte\",\n          \"value\": 60\n        }\n      ]\n    }\n  ],\n  \"steps\": [\n    {\n      \"context\": \"{{NAME}}, the monitoring team flagged a predator decline. Deer are already browsing young saplings hard. If we wait, we risk a trophic cascade, but people get nervous when we intervene with predators.\",\n      \"options\": [\n        {\n          \"effects\": [\n            {\n              \"change\": 12,\n              \"variable\": \"Food Web Stability\"\n            },\n            {\n              \"change\": -5,\n              \"variable\": \"Community Support\"\n            },\n            {\n              \"change\": -3,\n              \"variable\": \"Habitat Capacity Buffer\"\n            }\n          ],\n          \"feedback\": \"Restoring a top predator can dampen runaway herbivores and stabilize multiple trophic levels. It can also trigger public concern and short-term stress on habitat as animals redistribute and conflict risk rises.\",\n          \"text\": \"Reintroduce a small predator cohort with tracking collars\"\n        },\n        {\n          \"effects\": [\n            {\n              \"change\": 6,\n              \"variable\": \"Habitat Capacity Buffer\"\n            },\n            {\n              \"change\": -6,\n              \"variable\": \"Food Web Stability\"\n            },\n            {\n              \"change\": 4,\n              \"variable\": \"Community Support\"\n            }\n          ],\n          \"feedback\": \"Reducing deer numbers relieves pressure on vegetation, helping resources recover and raising the buffer under carrying capacity. But it doesn’t rebuild predator-driven regulation, so the food web stays less stable long-term, even if the public prefers it.\",\n          \"text\": \"Increase controlled culls to cut herbivore pressure fast\"\n        },\n        {\n          \"effects\": [\n            {\n              \"change\": 9,\n              \"variable\": \"Food Web Stability\"\n            },\n            {\n              \"change\": 7,\n              \"variable\": \"Community Support\"\n            },\n            {\n              \"change\": -4,\n              \"variable\": \"Habitat Capacity Buffer\"\n            }\n          ],\n          \"feedback\": \"Nonlethal measures can reduce browsing hotspots and smooth conflict, which helps stability and public buy-in. But fencing and deterrents can concentrate animals elsewhere and fragment access to forage, reducing the effective capacity buffer.\",\n          \"text\": \"Use fencing and deterrents to protect regeneration areas\"\n        },\n        {\n          \"effects\": [\n            {\n              \"change\": 8,\n              \"variable\": \"Biodiversity Resilience\"\n            },\n            {\n              \"change\": -4,\n              \"variable\": \"Food Web Stability\"\n            },\n            {\n              \"change\": -2,\n              \"variable\": \"Community Support\"\n            }\n          ],\n          \"feedback\": \"Adding diverse native plants increases functional diversity and resilience, but it takes time to influence population dynamics. In the short term, you’re not addressing the predator-herbivore imbalance directly, and stakeholders may see it as too indirect.\",\n          \"text\": \"Prioritize native understory restoration over animal intervention\"\n        }\n      ],\n      \"question\": \"How do we respond to the predator decline?\"\n    },\n    {\n      \"context\": \"We’ve got a drought forecast, {{NAME}}. If we run close to carrying capacity and water drops, everything crashes. But if we clamp down too hard, we lose visitor revenue and local support for conservation.\",\n      \"options\": [\n        {\n          \"effects\": [\n            {\n              \"change\": 12,\n              \"variable\": \"Habitat Capacity Buffer\"\n            },\n            {\n              \"change\": -6,\n              \"variable\": \"Community Support\"\n            },\n            {\n              \"change\": -3,\n              \"variable\": \"Food Web Stability\"\n            }\n          ],\n          \"feedback\": \"Limiting water access and reducing pressure keeps populations from overshooting resources, increasing your buffer for drought. But it’s unpopular and can disrupt movement patterns, creating short-term instability as animals concentrate in fewer areas.\",\n          \"text\": \"Restrict access to sensitive areas and reduce watering points\"\n        },\n        {\n          \"effects\": [\n            {\n              \"change\": 8,\n              \"variable\": \"Community Support\"\n            },\n            {\n              \"change\": -6,\n              \"variable\": \"Habitat Capacity Buffer\"\n            },\n            {\n              \"change\": 2,\n              \"variable\": \"Food Web Stability\"\n            }\n          ],\n          \"feedback\": \"Keeping areas open maintains goodwill and funding, and stable routines can reduce conflict. But higher use and continued resource draw pushes you closer to carrying capacity—dangerous heading into drought.\",\n          \"text\": \"Keep tourism access open and maintain current water support\"\n        },\n        {\n          \"effects\": [\n            {\n              \"change\": 10,\n              \"variable\": \"Habitat Capacity Buffer\"\n            },\n            {\n              \"change\": 6,\n              \"variable\": \"Biodiversity Resilience\"\n            },\n            {\n              \"change\": -4,\n              \"variable\": \"Community Support\"\n            }\n          ],\n          \"feedback\": \"Removing invasives and restoring riparian zones boosts water retention and habitat quality, effectively increasing capacity and adding resilience through more niches. It requires closures and visible disturbance now, which can frustrate visitors.\",\n          \"text\": \"Launch riparian restoration and invasive removal with temporary closures\"\n        },\n        {\n          \"effects\": [\n            {\n              \"change\": 9,\n              \"variable\": \"Biodiversity Resilience\"\n            },\n            {\n              \"change\": 4,\n              \"variable\": \"Community Support\"\n            },\n            {\n              \"change\": -5,\n              \"variable\": \"Food Web Stability\"\n            }\n          ],\n          \"feedback\": \"Supplementing diverse seed sources can improve long-term resilience and is easy to message publicly. But adding plant resources without fixing consumer pressure can shift diets and distributions unpredictably, adding short-term instability to the web.\",\n          \"text\": \"Seed diverse native species broadly to prep for drought\"\n        }\n      ],\n      \"question\": \"What’s our drought-prep move?\"\n    },\n    {\n      \"context\": \"Succession is the next debate, {{NAME}}. Some staff want frequent burns to keep open grassland for grazers and views. Others want to let shrubs and young forest return for nesting birds and moisture retention. Different endpoints, different risks.\",\n      \"options\": [\n        {\n          \"effects\": [\n            {\n              \"change\": 10,\n              \"variable\": \"Biodiversity Resilience\"\n            },\n            {\n              \"change\": 6,\n              \"variable\": \"Habitat Capacity Buffer\"\n            },\n            {\n              \"change\": -4,\n              \"variable\": \"Community Support\"\n            }\n          ],\n          \"feedback\": \"Letting later-successional habitats develop can increase structural diversity and water retention, improving resilience and capacity. It can reduce open vistas and change recreation patterns, so support may dip unless you communicate benefits well.\",\n          \"text\": \"Let succession proceed; focus on habitat complexity\"\n        },\n        {\n          \"effects\": [\n            {\n              \"change\": 9,\n              \"variable\": \"Community Support\"\n            },\n            {\n              \"change\": 5,\n              \"variable\": \"Food Web Stability\"\n            },\n            {\n              \"change\": -6,\n              \"variable\": \"Biodiversity Resilience\"\n            }\n          ],\n          \"feedback\": \"Maintaining early succession keeps landscapes predictable for visitors and can stabilize grazer-focused food chains. But frequent disturbance can simplify habitat and reduce niche diversity, lowering resilience to shocks like drought or disease.\",\n          \"text\": \"Use frequent prescribed burns to maintain early-succession grassland\"\n        },\n        {\n          \"effects\": [\n            {\n              \"change\": 7,\n              \"variable\": \"Biodiversity Resilience\"\n            },\n            {\n              \"change\": 5,\n              \"variable\": \"Food Web Stability\"\n            },\n            {\n              \"change\": -5,\n              \"variable\": \"Habitat Capacity Buffer\"\n            }\n          ],\n          \"feedback\": \"Creating a mosaic supports multiple successional stages, spreading risk and supporting more species interactions. The trade-off is less contiguous high-quality habitat in any one type, which can reduce the immediate capacity buffer.\",\n          \"text\": \"Create a patchwork mosaic: burn some areas, protect others\"\n        },\n        {\n          \"effects\": [\n            {\n              \"change\": 8,\n              \"variable\": \"Community Support\"\n            },\n            {\n              \"change\": 6,\n              \"variable\": \"Biodiversity Resilience\"\n            },\n            {\n              \"change\": -6,\n              \"variable\": \"Food Web Stability\"\n            }\n          ],\n          \"feedback\": \"Fast replanting after disturbance looks decisive and helps public confidence, and targeted plantings can add diversity. But heavy-handed planting can bypass natural succession cues and create mismatches with herbivores and predators, destabilizing interactions.\",\n          \"text\": \"Actively replant targeted species after disturbances\"\n        }\n      ],\n      \"question\": \"Which succession strategy do we choose?\"\n    },\n    {\n      \"context\": \"One more curveball, {{NAME}}: anglers are pushing to stock a popular sport fish in the main lake. It could fund conservation, but introducing a new predator can reshape the aquatic web fast—and that lake feeds the wetlands downstream.\",\n      \"options\": [\n        {\n          \"effects\": [\n            {\n              \"change\": 10,\n              \"variable\": \"Community Support\"\n            },\n            {\n              \"change\": -8,\n              \"variable\": \"Food Web Stability\"\n            },\n            {\n              \"change\": -4,\n              \"variable\": \"Biodiversity Resilience\"\n            }\n          ],\n          \"feedback\": \"Stocking boosts recreation and funding support, but a new predator can trigger aquatic trophic cascades, reducing native prey and simplifying the system. Once established, reversing impacts is hard, lowering resilience.\",\n          \"text\": \"Approve stocking this season with minimal restrictions\"\n        },\n        {\n          \"effects\": [\n            {\n              \"change\": 7,\n              \"variable\": \"Food Web Stability\"\n            },\n            {\n              \"change\": 5,\n              \"variable\": \"Biodiversity Resilience\"\n            },\n            {\n              \"change\": -4,\n              \"variable\": \"Community Support\"\n            }\n          ],\n          \"feedback\": \"Saying no avoids introducing a disruptive species, protecting stability and native diversity. The trade-off is political: stakeholders may feel ignored, reducing support and future funding.\",\n          \"text\": \"Decline stocking; focus on native fish recovery instead\"\n        },\n        {\n          \"effects\": [\n            {\n              \"change\": 6,\n              \"variable\": \"Community Support\"\n            },\n            {\n              \"change\": 6,\n              \"variable\": \"Food Web Stability\"\n            },\n            {\n              \"change\": -3,\n              \"variable\": \"Habitat Capacity Buffer\"\n            }\n          ],\n          \"feedback\": \"A pilot with strict controls limits ecosystem exposure while showing responsiveness, supporting stability and buy-in. Monitoring and controlled access can still concentrate use around the lake, putting localized pressure on habitat resources.\",\n          \"text\": \"Run a tightly controlled pilot with monitoring and catch limits\"\n        },\n        {\n          \"effects\": [\n            {\n              \"change\": 8,\n              \"variable\": \"Biodiversity Resilience\"\n            },\n            {\n              \"change\": 4,\n              \"variable\": \"Community Support\"\n            },\n            {\n              \"change\": -5,\n              \"variable\": \"Food Web Stability\"\n            }\n          ],\n          \"feedback\": \"Improving shoreline habitat helps native species and can be framed as a win for anglers over time. But habitat work can temporarily disturb feeding and spawning patterns, and without direct predator/prey management, short-term stability may wobble.\",\n          \"text\": \"Invest in shoreline habitat upgrades instead of stocking\"\n        }\n      ],\n      \"question\": \"How do we handle the sport-fish pressure?\"\n    }\n  ]\n}",
      "outputTokens": 1876,
      "systemPrompt": "# Role\n\nYou are an expert educational game designer creating a **Challenge** activity for a learning app. Your mission is to design a strategic simulation where learners make decisions that affect inventory variables, navigating trade-offs to meet win conditions using the lesson's concepts.\n\nYou specialize in crafting game-like experiences that test strategic thinking and problem-solving — not just knowledge recall, but the ability to apply concepts under constraints.\n\n# The Art of Strategic Learning\n\nA great Challenge activity doesn't quiz — it simulates. Learners face realistic constraints where every choice has consequences. They must think strategically about trade-offs, just like real-world decision-making.\n\n## Why Trade-Off-Based Scenarios Work\n\n1. **Authentic Complexity**: Real problems have multiple variables that interact. Improving one often affects another.\n\n2. **Strategic Reasoning**: Learners must think several steps ahead, considering how choices compound.\n\n3. **No \"Right Answer\"**: When every option has pros and cons, learners engage with the WHY behind principles.\n\n4. **Memorable Stakes**: Managing resources and meeting goals creates emotional investment in outcomes.\n\n## The Trade-Off Principle\n\nEvery great Challenge activity creates genuine dilemmas:\n\n- **No Perfect Options**: Each choice improves some variables while affecting others\n- **Interconnected Systems**: Variables influence each other meaningfully\n- **Strategic Planning**: Success requires thinking beyond the immediate step\n- **Concept Application**: Understanding the lesson's principles helps navigate trade-offs\n\n# Inputs\n\n- `LESSON_TITLE`: The topic to create a challenge around\n- `LESSON_DESCRIPTION`: Additional context about what this lesson covers\n- `CHAPTER_TITLE`: The chapter context (for understanding scope)\n- `COURSE_TITLE`: The course context (for understanding audience level)\n- `LANGUAGE`: Output language\n- `EXPLANATION_STEPS`: Array of {title, text} from all explanation activities (Background, Explanation, Mechanics, Examples) the learner completed before this one\n\n## Language Guidelines\n\n- `en`: Use US English unless the content is region-specific\n- `pt`: Use Brazilian Portuguese unless the content is region-specific\n- `es`: Use Latin American Spanish unless the content is region-specific\n\n# Requirements\n\n## Introduction\n\nThe `intro` field sets the scene (max 500 characters). It should:\n\n- Establish the scenario and the learner's role\n- Explain what they're trying to achieve\n- Create stakes that feel meaningful\n- Use `{{NAME}}` to personalize\n\n## Inventory Design\n\nDesign 3-5 inventory items. Each item includes:\n\n- **name**: Variable name (intuitive, e.g., \"Budget\", \"Team Morale\", \"Code Quality\")\n- **startValue**: Initial value (typically 40-70, leaving room for gains and losses)\n- **winConditions**: Array of 1-2 conditions the learner must meet for this variable\n\nEach variable must:\n\n- **Represent lesson concepts**: Connect to something the learner studied\n- **Have clear meanings**: Names should be intuitive and unambiguous\n- **Interact meaningfully**: Actions that help one variable should plausibly affect others\n- **Name precisely**: Use specific names (e.g., \"Quantity Demanded\" not \"Market Demand\")\n\n### Variable Naming Rule: Positive Polarity\n\n**All variables must be named so that HIGHER = BETTER.**\n\nThis simple rule eliminates confusion about effect signs. When all variables are \"good things to have more of,\" the math is intuitive:\n\n- `+` means improvement (good outcome)\n- `-` means worsening (bad outcome)\n\n**Transform negative-polarity concepts into positive-polarity names:**\n\n| Instead of... | Use...              |\n| ------------- | ------------------- |\n| Cost          | Budget / Funds      |\n| Risk          | Safety / Security   |\n| Time          | Speed / Efficiency  |\n| Debt          | Financial Health    |\n| Errors        | Code Quality        |\n| Stress        | Team Morale         |\n| Waste         | Resource Efficiency |\n\n**The test:** Ask \"Is more of this good?\" If yes, the name works. If no, rename it.\n\n### Win Conditions Structure\n\nEach inventory item's `winConditions` array defines success criteria:\n\n- **operator**: `gte` (>=), `lte` (<=), `gt` (>), `lt` (<), `eq` (==)\n- **value**: Target number the variable must meet\n\n**Common patterns:**\n\n- **Minimum threshold**: `[{ \"operator\": \"gte\", \"value\": 30 }]` — \"Keep Budget above 30\"\n- **Maximum cap** (prevent runaway): `[{ \"operator\": \"lte\", \"value\": 80 }]` — \"Don't overspend on Quality\"\n- **Range constraint** (two conditions): `[{ \"operator\": \"gte\", \"value\": 20 }, { \"operator\": \"lte\", \"value\": 80 }]` — \"Keep Budget balanced\"\n\n**Example inventory item:**\n\n```json\n{\n  \"name\": \"Budget\",\n  \"startValue\": 50,\n  \"winConditions\": [\n    { \"operator\": \"gte\", \"value\": 20 },\n    { \"operator\": \"lte\", \"value\": 80 }\n  ]\n}\n```\n\n### Win Condition Achievability Check\n\n**MANDATORY**: Before finalizing, verify each win condition is mathematically achievable:\n\n1. Start with `startValue`, calculate achievable range based on cumulative effects\n2. For `gte` conditions: Target ≤ `startValue + (steps × max_positive_effect_per_step)`\n3. For `lte` conditions: Target ≥ `startValue + (steps × max_negative_effect_per_step)`\n4. Leave margin for strategic flexibility — don't require perfect play to win\n\n**Common mistake**: Setting `lte` targets too LOW or `gte` targets too HIGH. If a variable starts at 55 with max -15 per step across 4 steps, minimum achievable is -5. A target of `lte 5` requires dropping 50 points — verify your effects allow this!\n\n## Step Structure\n\nEach step must have:\n\n- **context**: Maximum 500 characters. Pure dialogue from your colleague setting up the decision. Use a conversational style: no narrator, no character prefixes.\n- **question**: Maximum 100 characters. A clear question about what to do.\n- **options**: **EXACTLY 3-4 choices** (never fewer than 3), each with:\n  - **text**: The choice description (max 80 characters)\n  - **effects**: Array of {variable, change} pairs showing how this choice affects inventory\n  - **feedback**: Why this choice has these effects — max 300 characters. Should explain the reasoning, not just state the outcome.\n\n**CRITICAL**: Every step MUST have at least 3 options. Having only 2 options is a format violation.\n\n## Step Count\n\n- Minimum: 3 steps\n- Maximum: 6 steps\n\n## Tone & Style\n\n- **Pure dialogue**: NO narrator, NO character prefixes, NO action descriptions\n- **Natural conversation**: Colleagues working through a problem together\n- **Professional but warm**: Light humor when appropriate\n- **Second-person immersion**: The colleague speaks TO the learner\n- **Strategic framing**: Dialogue should hint at trade-offs without giving away optimal choices\n\n## The {{NAME}} Placeholder\n\nUse `{{NAME}}` wherever the learner's name should appear. For example:\n\n- \"{{NAME}}, we need to make a call here.\"\n- \"Good thinking, {{NAME}}. But we should consider the trade-offs.\"\n\n## Effect Design\n\nEvery option must:\n\n- **Have meaningful effects**: At least 1-2 variables should change\n- **Show trade-offs**: Most options should help some variables while hurting others\n- **Use realistic magnitudes**: Changes of 5-20 points are typical; dramatic swings (30+) should be rare\n- **Connect to lesson concepts**: The REASON for effects should reflect lesson principles\n\nExample effects structure:\n\n```json\n{\n  \"effects\": [\n    { \"variable\": \"Budget\", \"change\": -15 },\n    { \"variable\": \"Quality\", \"change\": 10 }\n  ]\n}\n```\n\n## What to Avoid\n\n- **Dominant options**: No choice should be obviously best across all variables. For EACH step, compare options: if one option has BETTER OR EQUAL effects on ALL variables compared to another, it's dominant. Example: Option A (+10 Quality, -5 Budget) vs Option B (+5 Quality, -10 Budget) — A dominates B. Fix by giving B something A lacks, like +5 Morale.\n- **Trivial decisions**: Every step should require real thought about trade-offs\n- **Disconnected variables**: Effects should make conceptual sense\n- **Extreme swings**: Avoid changes that guarantee win/loss in one step\n- **Narrator text or descriptions**: Keep it pure dialogue\n- **Quiz-style questions**: This tests strategic thinking and problem-solving, not recall\n- **Negative-polarity variables**: Never name variables where \"more is worse\" (like \"Cost\" or \"Risk\"). Use the transform table to rename them (Budget, Safety, etc.)\n- **Single-path variables**: NEVER create a variable that can only be improved by ONE option in the entire game. Every win condition variable MUST be influenceable by options in multiple steps. Otherwise, that option becomes mandatory and removes player agency\n\n## Scope\n\n- **Stay focused**: The scenario should require THIS lesson's concepts to navigate well\n- **Meaningful variables**: Each inventory variable should connect to lesson principles\n- **Realistic trade-offs**: The trade-offs should reflect how these concepts work in practice\n\n## Relationship to Previous Activities\n\nThe learner has already completed:\n\n- **Background**: WHY this exists (origin story, problems solved, historical context)\n- **Explanation**: WHAT it is (core concepts, components, definitions)\n- **Mechanics**: HOW it works (processes in action, cause-effect chains)\n- **Examples**: WHERE it appears (real-world contexts, applications)\n- **Story**: WHEN to apply this (dialogue-based problem solving)\n\nYour Challenge activity is the capstone: **CAN YOU HANDLE THIS?** It tests whether learners can apply concepts strategically under constraints. This is the most challenging activity — it should feel like a real test of understanding.\n\n- Background: \"WHY did we need this?\"\n- Explanation: \"WHAT exactly is it?\"\n- Mechanics: \"HOW does it actually work?\"\n- Examples: \"WHERE will I encounter this?\"\n- Story: \"WHEN do I apply this?\"\n- **Challenge: \"CAN I navigate complex trade-offs using this?\"**\n\n# Structure Guide\n\nA typical Challenge follows this arc:\n\n1. **Setup**: Establish the scenario, variables, and goal in the intro\n2. **Initial Decision**: First choice with clear trade-offs to teach the mechanics\n3. **Escalating Complexity**: Middle decisions where variables interact more\n4. **Critical Choice**: A pivotal decision that significantly affects outcomes\n5. **Resolution Setup**: Final decision that determines if win conditions are met\n\nNote: The challenge should feel winnable but require understanding the lesson's principles to succeed consistently.\n\n# Dialogue Tone Examples\n\n## Setting Up Trade-Offs\n\n> \"{{NAME}}, here's our situation. We can push for faster delivery, but that means cutting corners on testing. Or we take our time and risk missing the window. What's our priority?\"\n\n> \"The client wants both lower costs AND higher quality. {{NAME}}, we both know we can't maximize both. Where do we compromise?\"\n\n## Explaining Consequences\n\n> \"Interesting choice, {{NAME}}. Going that route saved us time, but I'm already seeing signs of technical debt building up. Let's see how this plays out.\"\n\n> \"That definitely boosted our short-term numbers. But {{NAME}}, remember — these variables are connected. Watch what happens next.\"\n\n## Strategic Moments\n\n> \"{{NAME}}, we're at a crossroads. Our budget is tight, but team morale is dropping. If we don't address one, the other gets worse. What's your call?\"\n\n> \"This is the big one, {{NAME}}. The choice we make here pretty much determines whether we hit our targets. No pressure.\"\n\n# Quality Checks\n\nBefore finalizing, verify:\n\n- [ ] Does the intro clearly establish the scenario, goal, and stakes?\n- [ ] Do inventory variables connect meaningfully to lesson concepts?\n- [ ] POSITIVE POLARITY: For each variable, is \"more\" always better? (Budget not Cost, Safety not Risk, Speed not Time)\n- [ ] MATHEMATICAL ACHIEVABILITY: For each win condition, is the target mathematically reachable given startValue and cumulative effect ranges?\n- [ ] Does every option have genuine trade-offs (no dominant choices)?\n- [ ] Do effects make conceptual sense given the lesson content?\n- [ ] Is `{{NAME}}` used appropriately throughout?\n- [ ] Is all dialogue pure conversation (no narrator, no prefixes)?\n- [ ] Does feedback explain WHY effects occur, not just state them?\n- [ ] Is the scope exactly the lesson topic?\n- [ ] Are all constraints met (intro ≤500 chars, context ≤500 chars, question ≤100 chars, text ≤80 chars, feedback ≤300 chars)?\n- [ ] Is the step count between 3 and 6?\n- [ ] Do inventory values start in a reasonable range (typically 40-70)?\n- [ ] Are effect magnitudes reasonable (typically 5-20 points)?\n- [ ] Does EVERY step have at least 3 options? (Never just 2 options)\n- [ ] Does each inventory item have at least one win condition?\n- [ ] For each variable, are there multiple options across different steps that can affect it? (No single-path variables)\n- [ ] DOMINANT OPTIONS: For each step, is there any option that beats another on ALL variables? If so, fix it by giving the weaker option a unique advantage.\n\n# Output Format\n\nReturn an object with:\n\n- **intro**: Scenario introduction (max 500 chars)\n- **inventory**: Array of 3-5 inventory items, each with:\n  - **name**: Variable name\n  - **startValue**: Initial value (typically 40-70)\n  - **winConditions**: Array of 1-2 conditions, each with:\n    - **operator**: One of \"gte\", \"lte\", \"gt\", \"lt\", \"eq\"\n    - **value**: Target number\n- **steps**: Array of 3-6 step objects, each with:\n  - **context**: Pure dialogue (max 500 chars)\n  - **question**: Decision prompt (max 100 chars)\n  - **options**: Array of 3-4 objects with:\n    - **text**: Choice description (max 80 chars)\n    - **effects**: Array of {variable, change} pairs\n    - **feedback**: Explanation of effects (max 300 chars)\n",
      "testCaseId": "en-biology-ecosystem-balance-1",
      "userPrompt": "LESSON_TITLE: Ecosystem Balance and Management\nLESSON_DESCRIPTION: Applying ecological principles to make informed ecosystem management decisions\nCHAPTER_TITLE: Ecosystem Dynamics\nCOURSE_TITLE: Ecology and Conservation\nLANGUAGE: en\nEXPLANATION_STEPS:\n1. Interconnected Networks: Ecosystems are interconnected networks. Removing one species affects others through food webs. Keystone species have disproportionate impact — their loss cascades through the system.\n2. Carrying Capacity: Carrying capacity is the maximum population an environment can sustain. Exceed it, and resources deplete, populations crash. Stay well below, and you're not maximizing the ecosystem's potential.\n3. Biodiversity and Resilience: Biodiversity provides resilience. More species means more ways to respond to change. Monocultures are efficient but fragile. Diverse systems are robust but complex to manage.\n4. Trophic Cascades: Trophic cascades occur when changes at one level ripple through others. Remove predators, and prey populations explode, overgrazing vegetation, affecting everything that depends on those plants.\n5. Ecological Succession: Ecological succession is the process of change over time. Pioneer species prepare the way for later ones. Managing ecosystems means deciding where in succession you want to be."
    },
    {
      "duration": 39444.603166,
      "inputTokens": 3634,
      "output": "{\n  \"intro\": \"{{NAME}}, você está no turno da planta química tentando maximizar a produção de amônia sem estourar energia nem perder estabilidade. O reator está em equilíbrio e qualquer “ajuste” desloca o sistema. Seu objetivo é aumentar o rendimento final e manter a operação segura e econômica. Qual alavanca você puxa primeiro?\",\n  \"inventory\": [\n    {\n      \"name\": \"Rendimento de Amônia\",\n      \"startValue\": 55,\n      \"winConditions\": [\n        {\n          \"operator\": \"gte\",\n          \"value\": 75\n        }\n      ]\n    },\n    {\n      \"name\": \"Eficiência Energética\",\n      \"startValue\": 60,\n      \"winConditions\": [\n        {\n          \"operator\": \"gte\",\n          \"value\": 45\n        }\n      ]\n    },\n    {\n      \"name\": \"Estabilidade Operacional\",\n      \"startValue\": 58,\n      \"winConditions\": [\n        {\n          \"operator\": \"gte\",\n          \"value\": 45\n        }\n      ]\n    },\n    {\n      \"name\": \"Saúde do Catalisador\",\n      \"startValue\": 62,\n      \"winConditions\": [\n        {\n          \"operator\": \"gte\",\n          \"value\": 45\n        }\n      ]\n    }\n  ],\n  \"steps\": [\n    {\n      \"context\": \"{{NAME}}, o analisador está mostrando equilíbrio no reator do processo de Haber. A diretoria quer mais NH3 hoje, mas sem “gambiarras” que derrubem a planta depois. Podemos mexer em pressão, alimentação e separação. O que você prefere atacar primeiro?\",\n      \"options\": [\n        {\n          \"effects\": [\n            {\n              \"change\": 12,\n              \"variable\": \"Rendimento de Amônia\"\n            },\n            {\n              \"change\": -10,\n              \"variable\": \"Eficiência Energética\"\n            },\n            {\n              \"change\": -6,\n              \"variable\": \"Estabilidade Operacional\"\n            }\n          ],\n          \"feedback\": \"Aumentar a pressão desloca o equilíbrio para o lado com menos mols gasosos (produtos), elevando NH3. Mas comprimir custa energia e aumenta estresse mecânico/operacional.\",\n          \"text\": \"Aumentar a pressão do reator\"\n        },\n        {\n          \"effects\": [\n            {\n              \"change\": 10,\n              \"variable\": \"Rendimento de Amônia\"\n            },\n            {\n              \"change\": -6,\n              \"variable\": \"Eficiência Energética\"\n            },\n            {\n              \"change\": -4,\n              \"variable\": \"Estabilidade Operacional\"\n            }\n          ],\n          \"feedback\": \"Adicionar N2/H2 (reagentes) desloca o equilíbrio para consumir o excesso e formar mais NH3. Porém, mais vazão/compressão e controle de mistura exigem energia e estabilidade de operação.\",\n          \"text\": \"Aumentar a alimentação de N2 e H2\"\n        },\n        {\n          \"effects\": [\n            {\n              \"change\": 9,\n              \"variable\": \"Rendimento de Amônia\"\n            },\n            {\n              \"change\": -3,\n              \"variable\": \"Eficiência Energética\"\n            },\n            {\n              \"change\": -5,\n              \"variable\": \"Estabilidade Operacional\"\n            }\n          ],\n          \"feedback\": \"Remover NH3 à medida que se forma (condensação/separação) “puxa” o equilíbrio para produtos. Só que intensificar separação exige refrigeração/controle e pode instabilizar o loop.\",\n          \"text\": \"Intensificar a remoção/condensação de NH3\"\n        },\n        {\n          \"effects\": [\n            {\n              \"change\": 2,\n              \"variable\": \"Rendimento de Amônia\"\n            },\n            {\n              \"change\": 6,\n              \"variable\": \"Eficiência Energética\"\n            },\n            {\n              \"change\": 2,\n              \"variable\": \"Saúde do Catalisador\"\n            }\n          ],\n          \"feedback\": \"Catalisador não muda o equilíbrio; ele só ajuda a chegar mais rápido. Melhorar distribuição térmica e evitar hotspots reduz perdas energéticas e protege o catalisador, mas o ganho imediato de equilíbrio é pequeno.\",\n          \"text\": \"Otimizar leito catalítico (sem mudar T/P)\"\n        }\n      ],\n      \"question\": \"Qual ajuste inicial você faz para aumentar NH3 sem “quebrar” o resto?\"\n    },\n    {\n      \"context\": \"Beleza. Agora a discussão virou temperatura. O time de utilidades quer subir a temperatura pra acelerar a taxa. O pessoal de equilíbrio lembra que temperatura mexe no K. E amônia… é uma reação exotérmica. Como você quer operar?\",\n      \"options\": [\n        {\n          \"effects\": [\n            {\n              \"change\": 10,\n              \"variable\": \"Rendimento de Amônia\"\n            },\n            {\n              \"change\": -6,\n              \"variable\": \"Eficiência Energética\"\n            },\n            {\n              \"change\": -3,\n              \"variable\": \"Estabilidade Operacional\"\n            }\n          ],\n          \"feedback\": \"Em reação exotérmica, reduzir a temperatura favorece produtos no equilíbrio (mais NH3). O custo é mais resfriamento e possível queda de taxa/controle mais sensível.\",\n          \"text\": \"Reduzir a temperatura para favorecer produtos\"\n        },\n        {\n          \"effects\": [\n            {\n              \"change\": -8,\n              \"variable\": \"Rendimento de Amônia\"\n            },\n            {\n              \"change\": 4,\n              \"variable\": \"Eficiência Energética\"\n            },\n            {\n              \"change\": 2,\n              \"variable\": \"Estabilidade Operacional\"\n            }\n          ],\n          \"feedback\": \"Aumentar a temperatura em reação exotérmica desloca o equilíbrio para reagentes (menos NH3), mas pode reduzir necessidade de resfriamento e facilitar estabilidade por evitar condensação indesejada em pontos frios.\",\n          \"text\": \"Aumentar a temperatura para ganhar velocidade\"\n        },\n        {\n          \"effects\": [\n            {\n              \"change\": 4,\n              \"variable\": \"Rendimento de Amônia\"\n            },\n            {\n              \"change\": 2,\n              \"variable\": \"Eficiência Energética\"\n            },\n            {\n              \"change\": 3,\n              \"variable\": \"Estabilidade Operacional\"\n            }\n          ],\n          \"feedback\": \"Um ajuste moderado busca um compromisso: não perde muito no equilíbrio e pode melhorar a operação com menos variação térmica, reduzindo oscilações e consumo extremo de utilidades.\",\n          \"text\": \"Ajuste moderado buscando compromisso\"\n        },\n        {\n          \"effects\": [\n            {\n              \"change\": 3,\n              \"variable\": \"Rendimento de Amônia\"\n            },\n            {\n              \"change\": -2,\n              \"variable\": \"Eficiência Energética\"\n            },\n            {\n              \"change\": -2,\n              \"variable\": \"Saúde do Catalisador\"\n            }\n          ],\n          \"feedback\": \"Não desloca o equilíbrio, mas aumenta a velocidade de atingir o equilíbrio. A operação pode produzir mais por tempo em transientes, porém maior atividade pode elevar sinterização/envenenamento e exigir mais controle.\",\n          \"text\": \"Aumentar carga/atividade catalítica (mais rápido, mesmo equilíbrio)\"\n        }\n      ],\n      \"question\": \"Como você ajusta a temperatura considerando Le Chatelier e operação?\"\n    },\n    {\n      \"context\": \"Tem outra sugestão da equipe: “vamos injetar gás inerte pra aumentar a pressão total sem mexer no compressor”. Parece esperto, mas eu tô com o pé atrás. Outra alternativa é mexer no volume efetivo (pressão) de verdade, ou atuar na separação. O que você decide?\",\n      \"options\": [\n        {\n          \"effects\": [\n            {\n              \"change\": 0,\n              \"variable\": \"Rendimento de Amônia\"\n            },\n            {\n              \"change\": 2,\n              \"variable\": \"Eficiência Energética\"\n            },\n            {\n              \"change\": -3,\n              \"variable\": \"Estabilidade Operacional\"\n            }\n          ],\n          \"feedback\": \"Adicionar gás inerte a volume constante aumenta a pressão total, mas não muda as pressões parciais relativas da forma que deslocaria o equilíbrio para NH3. Pode atrapalhar controle e circulação, com pouco ganho químico.\",\n          \"text\": \"Adicionar gás inerte (Ar) no loop\"\n        },\n        {\n          \"effects\": [\n            {\n              \"change\": 8,\n              \"variable\": \"Rendimento de Amônia\"\n            },\n            {\n              \"change\": -7,\n              \"variable\": \"Eficiência Energética\"\n            },\n            {\n              \"change\": -4,\n              \"variable\": \"Estabilidade Operacional\"\n            }\n          ],\n          \"feedback\": \"Aumentar a pressão por compressão real eleva pressões parciais e favorece o lado com menos mols gasosos, aumentando NH3. Cobra em energia e exige operação mais rígida.\",\n          \"text\": \"Aumentar pressão por compressão real\"\n        },\n        {\n          \"effects\": [\n            {\n              \"change\": 7,\n              \"variable\": \"Rendimento de Amônia\"\n            },\n            {\n              \"change\": -4,\n              \"variable\": \"Eficiência Energética\"\n            },\n            {\n              \"change\": -2,\n              \"variable\": \"Estabilidade Operacional\"\n            }\n          ],\n          \"feedback\": \"Melhorar a condensação/remoção do NH3 reduz sua concentração no sistema, puxando o equilíbrio para produtos. Precisa de mais refrigeração, mas costuma ser mais “direto” que mexer no reator.\",\n          \"text\": \"Melhorar a separação para remover mais NH3\"\n        },\n        {\n          \"effects\": [\n            {\n              \"change\": 4,\n              \"variable\": \"Rendimento de Amônia\"\n            },\n            {\n              \"change\": 1,\n              \"variable\": \"Eficiência Energética\"\n            },\n            {\n              \"change\": -5,\n              \"variable\": \"Saúde do Catalisador\"\n            }\n          ],\n          \"feedback\": \"Recircular mais sem purga aumenta reagentes disponíveis, mas também acumula impurezas/venenos no loop. Isso pode degradar o catalisador e reduzir desempenho ao longo do tempo.\",\n          \"text\": \"Aumentar recirculação e reduzir purga\"\n        }\n      ],\n      \"question\": \"Qual caminho você escolhe: inerte, pressão real, separação ou recirculação?\"\n    },\n    {\n      \"context\": \"Última decisão do turno, {{NAME}}. O laboratório detectou traços de CO/umidade na alimentação. Dá pra manter rodando e “corrigir depois”, ou parar pra regenerar/ativar o catalisador, ou reforçar a purificação com custo energético. O que você faz pra fechar o dia batendo meta?\",\n      \"options\": [\n        {\n          \"effects\": [\n            {\n              \"change\": 8,\n              \"variable\": \"Saúde do Catalisador\"\n            },\n            {\n              \"change\": -6,\n              \"variable\": \"Rendimento de Amônia\"\n            },\n            {\n              \"change\": 3,\n              \"variable\": \"Estabilidade Operacional\"\n            }\n          ],\n          \"feedback\": \"Regenerar/ativar melhora muito a saúde do catalisador e reduz risco de perda de atividade, mas derruba produção imediata por tempo de parada/queda de carga.\",\n          \"text\": \"Parar curto e regenerar/reativar catalisador\"\n        },\n        {\n          \"effects\": [\n            {\n              \"change\": 6,\n              \"variable\": \"Rendimento de Amônia\"\n            },\n            {\n              \"change\": -6,\n              \"variable\": \"Eficiência Energética\"\n            },\n            {\n              \"change\": 2,\n              \"variable\": \"Estabilidade Operacional\"\n            }\n          ],\n          \"feedback\": \"Aumentar purificação remove venenos e estabiliza o processo, sustentando rendimento. O trade-off é energia extra em secagem/absorção/compressores.\",\n          \"text\": \"Reforçar purificação da alimentação\"\n        },\n        {\n          \"effects\": [\n            {\n              \"change\": 10,\n              \"variable\": \"Rendimento de Amônia\"\n            },\n            {\n              \"change\": -10,\n              \"variable\": \"Saúde do Catalisador\"\n            },\n            {\n              \"change\": -6,\n              \"variable\": \"Estabilidade Operacional\"\n            }\n          ],\n          \"feedback\": \"Ignorar impurezas mantém produção agora, mas CO/umidade envenenam o catalisador e aumentam instabilidade no controle. Você paga a conta depois com queda de performance e risco operacional.\",\n          \"text\": \"Manter rodando e adiar a correção\"\n        },\n        {\n          \"effects\": [\n            {\n              \"change\": 4,\n              \"variable\": \"Rendimento de Amônia\"\n            },\n            {\n              \"change\": 2,\n              \"variable\": \"Eficiência Energética\"\n            },\n            {\n              \"change\": -4,\n              \"variable\": \"Estabilidade Operacional\"\n            }\n          ],\n          \"feedback\": \"Aumentar a purga ajuda a remover inertes/impurezas do loop sem grande investimento, mas desperdiça reagentes e pode causar oscilações no balanço do sistema.\",\n          \"text\": \"Aumentar purga do loop para expulsar impurezas\"\n        }\n      ],\n      \"question\": \"Como você lida com as impurezas para fechar o turno com segurança?\"\n    }\n  ]\n}",
      "outputTokens": 2096,
      "systemPrompt": "# Role\n\nYou are an expert educational game designer creating a **Challenge** activity for a learning app. Your mission is to design a strategic simulation where learners make decisions that affect inventory variables, navigating trade-offs to meet win conditions using the lesson's concepts.\n\nYou specialize in crafting game-like experiences that test strategic thinking and problem-solving — not just knowledge recall, but the ability to apply concepts under constraints.\n\n# The Art of Strategic Learning\n\nA great Challenge activity doesn't quiz — it simulates. Learners face realistic constraints where every choice has consequences. They must think strategically about trade-offs, just like real-world decision-making.\n\n## Why Trade-Off-Based Scenarios Work\n\n1. **Authentic Complexity**: Real problems have multiple variables that interact. Improving one often affects another.\n\n2. **Strategic Reasoning**: Learners must think several steps ahead, considering how choices compound.\n\n3. **No \"Right Answer\"**: When every option has pros and cons, learners engage with the WHY behind principles.\n\n4. **Memorable Stakes**: Managing resources and meeting goals creates emotional investment in outcomes.\n\n## The Trade-Off Principle\n\nEvery great Challenge activity creates genuine dilemmas:\n\n- **No Perfect Options**: Each choice improves some variables while affecting others\n- **Interconnected Systems**: Variables influence each other meaningfully\n- **Strategic Planning**: Success requires thinking beyond the immediate step\n- **Concept Application**: Understanding the lesson's principles helps navigate trade-offs\n\n# Inputs\n\n- `LESSON_TITLE`: The topic to create a challenge around\n- `LESSON_DESCRIPTION`: Additional context about what this lesson covers\n- `CHAPTER_TITLE`: The chapter context (for understanding scope)\n- `COURSE_TITLE`: The course context (for understanding audience level)\n- `LANGUAGE`: Output language\n- `EXPLANATION_STEPS`: Array of {title, text} from all explanation activities (Background, Explanation, Mechanics, Examples) the learner completed before this one\n\n## Language Guidelines\n\n- `en`: Use US English unless the content is region-specific\n- `pt`: Use Brazilian Portuguese unless the content is region-specific\n- `es`: Use Latin American Spanish unless the content is region-specific\n\n# Requirements\n\n## Introduction\n\nThe `intro` field sets the scene (max 500 characters). It should:\n\n- Establish the scenario and the learner's role\n- Explain what they're trying to achieve\n- Create stakes that feel meaningful\n- Use `{{NAME}}` to personalize\n\n## Inventory Design\n\nDesign 3-5 inventory items. Each item includes:\n\n- **name**: Variable name (intuitive, e.g., \"Budget\", \"Team Morale\", \"Code Quality\")\n- **startValue**: Initial value (typically 40-70, leaving room for gains and losses)\n- **winConditions**: Array of 1-2 conditions the learner must meet for this variable\n\nEach variable must:\n\n- **Represent lesson concepts**: Connect to something the learner studied\n- **Have clear meanings**: Names should be intuitive and unambiguous\n- **Interact meaningfully**: Actions that help one variable should plausibly affect others\n- **Name precisely**: Use specific names (e.g., \"Quantity Demanded\" not \"Market Demand\")\n\n### Variable Naming Rule: Positive Polarity\n\n**All variables must be named so that HIGHER = BETTER.**\n\nThis simple rule eliminates confusion about effect signs. When all variables are \"good things to have more of,\" the math is intuitive:\n\n- `+` means improvement (good outcome)\n- `-` means worsening (bad outcome)\n\n**Transform negative-polarity concepts into positive-polarity names:**\n\n| Instead of... | Use...              |\n| ------------- | ------------------- |\n| Cost          | Budget / Funds      |\n| Risk          | Safety / Security   |\n| Time          | Speed / Efficiency  |\n| Debt          | Financial Health    |\n| Errors        | Code Quality        |\n| Stress        | Team Morale         |\n| Waste         | Resource Efficiency |\n\n**The test:** Ask \"Is more of this good?\" If yes, the name works. If no, rename it.\n\n### Win Conditions Structure\n\nEach inventory item's `winConditions` array defines success criteria:\n\n- **operator**: `gte` (>=), `lte` (<=), `gt` (>), `lt` (<), `eq` (==)\n- **value**: Target number the variable must meet\n\n**Common patterns:**\n\n- **Minimum threshold**: `[{ \"operator\": \"gte\", \"value\": 30 }]` — \"Keep Budget above 30\"\n- **Maximum cap** (prevent runaway): `[{ \"operator\": \"lte\", \"value\": 80 }]` — \"Don't overspend on Quality\"\n- **Range constraint** (two conditions): `[{ \"operator\": \"gte\", \"value\": 20 }, { \"operator\": \"lte\", \"value\": 80 }]` — \"Keep Budget balanced\"\n\n**Example inventory item:**\n\n```json\n{\n  \"name\": \"Budget\",\n  \"startValue\": 50,\n  \"winConditions\": [\n    { \"operator\": \"gte\", \"value\": 20 },\n    { \"operator\": \"lte\", \"value\": 80 }\n  ]\n}\n```\n\n### Win Condition Achievability Check\n\n**MANDATORY**: Before finalizing, verify each win condition is mathematically achievable:\n\n1. Start with `startValue`, calculate achievable range based on cumulative effects\n2. For `gte` conditions: Target ≤ `startValue + (steps × max_positive_effect_per_step)`\n3. For `lte` conditions: Target ≥ `startValue + (steps × max_negative_effect_per_step)`\n4. Leave margin for strategic flexibility — don't require perfect play to win\n\n**Common mistake**: Setting `lte` targets too LOW or `gte` targets too HIGH. If a variable starts at 55 with max -15 per step across 4 steps, minimum achievable is -5. A target of `lte 5` requires dropping 50 points — verify your effects allow this!\n\n## Step Structure\n\nEach step must have:\n\n- **context**: Maximum 500 characters. Pure dialogue from your colleague setting up the decision. Use a conversational style: no narrator, no character prefixes.\n- **question**: Maximum 100 characters. A clear question about what to do.\n- **options**: **EXACTLY 3-4 choices** (never fewer than 3), each with:\n  - **text**: The choice description (max 80 characters)\n  - **effects**: Array of {variable, change} pairs showing how this choice affects inventory\n  - **feedback**: Why this choice has these effects — max 300 characters. Should explain the reasoning, not just state the outcome.\n\n**CRITICAL**: Every step MUST have at least 3 options. Having only 2 options is a format violation.\n\n## Step Count\n\n- Minimum: 3 steps\n- Maximum: 6 steps\n\n## Tone & Style\n\n- **Pure dialogue**: NO narrator, NO character prefixes, NO action descriptions\n- **Natural conversation**: Colleagues working through a problem together\n- **Professional but warm**: Light humor when appropriate\n- **Second-person immersion**: The colleague speaks TO the learner\n- **Strategic framing**: Dialogue should hint at trade-offs without giving away optimal choices\n\n## The {{NAME}} Placeholder\n\nUse `{{NAME}}` wherever the learner's name should appear. For example:\n\n- \"{{NAME}}, we need to make a call here.\"\n- \"Good thinking, {{NAME}}. But we should consider the trade-offs.\"\n\n## Effect Design\n\nEvery option must:\n\n- **Have meaningful effects**: At least 1-2 variables should change\n- **Show trade-offs**: Most options should help some variables while hurting others\n- **Use realistic magnitudes**: Changes of 5-20 points are typical; dramatic swings (30+) should be rare\n- **Connect to lesson concepts**: The REASON for effects should reflect lesson principles\n\nExample effects structure:\n\n```json\n{\n  \"effects\": [\n    { \"variable\": \"Budget\", \"change\": -15 },\n    { \"variable\": \"Quality\", \"change\": 10 }\n  ]\n}\n```\n\n## What to Avoid\n\n- **Dominant options**: No choice should be obviously best across all variables. For EACH step, compare options: if one option has BETTER OR EQUAL effects on ALL variables compared to another, it's dominant. Example: Option A (+10 Quality, -5 Budget) vs Option B (+5 Quality, -10 Budget) — A dominates B. Fix by giving B something A lacks, like +5 Morale.\n- **Trivial decisions**: Every step should require real thought about trade-offs\n- **Disconnected variables**: Effects should make conceptual sense\n- **Extreme swings**: Avoid changes that guarantee win/loss in one step\n- **Narrator text or descriptions**: Keep it pure dialogue\n- **Quiz-style questions**: This tests strategic thinking and problem-solving, not recall\n- **Negative-polarity variables**: Never name variables where \"more is worse\" (like \"Cost\" or \"Risk\"). Use the transform table to rename them (Budget, Safety, etc.)\n- **Single-path variables**: NEVER create a variable that can only be improved by ONE option in the entire game. Every win condition variable MUST be influenceable by options in multiple steps. Otherwise, that option becomes mandatory and removes player agency\n\n## Scope\n\n- **Stay focused**: The scenario should require THIS lesson's concepts to navigate well\n- **Meaningful variables**: Each inventory variable should connect to lesson principles\n- **Realistic trade-offs**: The trade-offs should reflect how these concepts work in practice\n\n## Relationship to Previous Activities\n\nThe learner has already completed:\n\n- **Background**: WHY this exists (origin story, problems solved, historical context)\n- **Explanation**: WHAT it is (core concepts, components, definitions)\n- **Mechanics**: HOW it works (processes in action, cause-effect chains)\n- **Examples**: WHERE it appears (real-world contexts, applications)\n- **Story**: WHEN to apply this (dialogue-based problem solving)\n\nYour Challenge activity is the capstone: **CAN YOU HANDLE THIS?** It tests whether learners can apply concepts strategically under constraints. This is the most challenging activity — it should feel like a real test of understanding.\n\n- Background: \"WHY did we need this?\"\n- Explanation: \"WHAT exactly is it?\"\n- Mechanics: \"HOW does it actually work?\"\n- Examples: \"WHERE will I encounter this?\"\n- Story: \"WHEN do I apply this?\"\n- **Challenge: \"CAN I navigate complex trade-offs using this?\"**\n\n# Structure Guide\n\nA typical Challenge follows this arc:\n\n1. **Setup**: Establish the scenario, variables, and goal in the intro\n2. **Initial Decision**: First choice with clear trade-offs to teach the mechanics\n3. **Escalating Complexity**: Middle decisions where variables interact more\n4. **Critical Choice**: A pivotal decision that significantly affects outcomes\n5. **Resolution Setup**: Final decision that determines if win conditions are met\n\nNote: The challenge should feel winnable but require understanding the lesson's principles to succeed consistently.\n\n# Dialogue Tone Examples\n\n## Setting Up Trade-Offs\n\n> \"{{NAME}}, here's our situation. We can push for faster delivery, but that means cutting corners on testing. Or we take our time and risk missing the window. What's our priority?\"\n\n> \"The client wants both lower costs AND higher quality. {{NAME}}, we both know we can't maximize both. Where do we compromise?\"\n\n## Explaining Consequences\n\n> \"Interesting choice, {{NAME}}. Going that route saved us time, but I'm already seeing signs of technical debt building up. Let's see how this plays out.\"\n\n> \"That definitely boosted our short-term numbers. But {{NAME}}, remember — these variables are connected. Watch what happens next.\"\n\n## Strategic Moments\n\n> \"{{NAME}}, we're at a crossroads. Our budget is tight, but team morale is dropping. If we don't address one, the other gets worse. What's your call?\"\n\n> \"This is the big one, {{NAME}}. The choice we make here pretty much determines whether we hit our targets. No pressure.\"\n\n# Quality Checks\n\nBefore finalizing, verify:\n\n- [ ] Does the intro clearly establish the scenario, goal, and stakes?\n- [ ] Do inventory variables connect meaningfully to lesson concepts?\n- [ ] POSITIVE POLARITY: For each variable, is \"more\" always better? (Budget not Cost, Safety not Risk, Speed not Time)\n- [ ] MATHEMATICAL ACHIEVABILITY: For each win condition, is the target mathematically reachable given startValue and cumulative effect ranges?\n- [ ] Does every option have genuine trade-offs (no dominant choices)?\n- [ ] Do effects make conceptual sense given the lesson content?\n- [ ] Is `{{NAME}}` used appropriately throughout?\n- [ ] Is all dialogue pure conversation (no narrator, no prefixes)?\n- [ ] Does feedback explain WHY effects occur, not just state them?\n- [ ] Is the scope exactly the lesson topic?\n- [ ] Are all constraints met (intro ≤500 chars, context ≤500 chars, question ≤100 chars, text ≤80 chars, feedback ≤300 chars)?\n- [ ] Is the step count between 3 and 6?\n- [ ] Do inventory values start in a reasonable range (typically 40-70)?\n- [ ] Are effect magnitudes reasonable (typically 5-20 points)?\n- [ ] Does EVERY step have at least 3 options? (Never just 2 options)\n- [ ] Does each inventory item have at least one win condition?\n- [ ] For each variable, are there multiple options across different steps that can affect it? (No single-path variables)\n- [ ] DOMINANT OPTIONS: For each step, is there any option that beats another on ALL variables? If so, fix it by giving the weaker option a unique advantage.\n\n# Output Format\n\nReturn an object with:\n\n- **intro**: Scenario introduction (max 500 chars)\n- **inventory**: Array of 3-5 inventory items, each with:\n  - **name**: Variable name\n  - **startValue**: Initial value (typically 40-70)\n  - **winConditions**: Array of 1-2 conditions, each with:\n    - **operator**: One of \"gte\", \"lte\", \"gt\", \"lt\", \"eq\"\n    - **value**: Target number\n- **steps**: Array of 3-6 step objects, each with:\n  - **context**: Pure dialogue (max 500 chars)\n  - **question**: Decision prompt (max 100 chars)\n  - **options**: Array of 3-4 objects with:\n    - **text**: Choice description (max 80 chars)\n    - **effects**: Array of {variable, change} pairs\n    - **feedback**: Explanation of effects (max 300 chars)\n",
      "testCaseId": "pt-chemistry-reaction-equilibrium-1",
      "userPrompt": "LESSON_TITLE: Equilibrio Quimico na Pratica\nLESSON_DESCRIPTION: Aplicando o principio de Le Chatelier para otimizar reacoes quimicas e processos industriais\nCHAPTER_TITLE: Equilibrio Quimico\nCOURSE_TITLE: Quimica Geral II\nLANGUAGE: pt\nEXPLANATION_STEPS:\n1. Principio de Le Chatelier: O principio de Le Chatelier diz que um sistema em equilibrio responde a perturbacoes minimizando a mudanca. Adicione reagente, o equilibrio desloca para consumir esse reagente.\n2. Efeito da Concentracao: Mudancas de concentracao deslocam o equilibrio. Adicionar reagentes desloca para produtos. Remover produtos tambem desloca para produtos. O sistema busca restaurar o equilibrio.\n3. Efeito da Pressao: A pressao afeta equilibrios gasosos. Aumentar pressao favorece o lado com menos moles de gas. Diminuir pressao favorece o lado com mais moles. Gases inertes nao afetam.\n4. Efeito da Temperatura: Temperatura e diferente — ela muda a constante de equilibrio. Reacoes exotermicas: aumento de temperatura desloca para reagentes. Reacoes endotermicas: aumento favorece produtos.\n5. Papel dos Catalisadores: Catalisadores aceleram ambas as direcoes igualmente. Eles nao deslocam o equilibrio — apenas ajudam a alcancar o equilibrio mais rapido. Util para processos industriais."
    },
    {
      "duration": 32891.546375000005,
      "inputTokens": 3635,
      "output": "{\n  \"intro\": \"{{NAME}}, tenemos que diseñar el sistema energético de un dron de rescate para operar 2 horas y volver con margen. La energía total se conserva, pero las pérdidas por calor y conversiones nos pueden dejar sin empuje. Mantén la Energía Útil alta, la Eficiencia en buen nivel, el Margen de Almacenamiento sano y el Peso Energético bajo control.\",\n  \"inventory\": [\n    {\n      \"name\": \"Energía Útil Disponible\",\n      \"startValue\": 60,\n      \"winConditions\": [\n        {\n          \"operator\": \"gte\",\n          \"value\": 55\n        }\n      ]\n    },\n    {\n      \"name\": \"Eficiencia de Conversión Total\",\n      \"startValue\": 55,\n      \"winConditions\": [\n        {\n          \"operator\": \"gte\",\n          \"value\": 55\n        }\n      ]\n    },\n    {\n      \"name\": \"Margen de Almacenamiento Confiable\",\n      \"startValue\": 50,\n      \"winConditions\": [\n        {\n          \"operator\": \"gte\",\n          \"value\": 45\n        }\n      ]\n    },\n    {\n      \"name\": \"Ligereza del Paquete Energético\",\n      \"startValue\": 50,\n      \"winConditions\": [\n        {\n          \"operator\": \"gte\",\n          \"value\": 45\n        }\n      ]\n    }\n  ],\n  \"steps\": [\n    {\n      \"context\": \"{{NAME}}, primera decisión: la arquitectura. Podemos ir directo del almacenaje al motor, o meter más etapas para “limpiar” la energía. Cada conversión se cobra una parte en calor.\",\n      \"options\": [\n        {\n          \"effects\": [\n            {\n              \"change\": 10,\n              \"variable\": \"Eficiencia de Conversión Total\"\n            },\n            {\n              \"change\": 5,\n              \"variable\": \"Energía Útil Disponible\"\n            },\n            {\n              \"change\": 5,\n              \"variable\": \"Ligereza del Paquete Energético\"\n            },\n            {\n              \"change\": -5,\n              \"variable\": \"Margen de Almacenamiento Confiable\"\n            }\n          ],\n          \"feedback\": \"Menos pasos de conversión significa menos pérdidas en cadena. Un bus DC directo suele ser eficiente y más liviano, pero requiere un BMS/control robusto; si lo simplificas demasiado, baja la confiabilidad del almacenamiento.\",\n          \"text\": \"Arquitectura de pocas conversiones (directo a motor)\"\n        },\n        {\n          \"effects\": [\n            {\n              \"change\": 10,\n              \"variable\": \"Margen de Almacenamiento Confiable\"\n            },\n            {\n              \"change\": -10,\n              \"variable\": \"Eficiencia de Conversión Total\"\n            },\n            {\n              \"change\": -5,\n              \"variable\": \"Energía Útil Disponible\"\n            },\n            {\n              \"change\": -5,\n              \"variable\": \"Ligereza del Paquete Energético\"\n            }\n          ],\n          \"feedback\": \"Agregar etapas (reguladores, convertidores, redundancia) mejora estabilidad y protección del almacenaje, pero cada etapa disipa calor: baja eficiencia total y reduce energía útil; además añade masa.\",\n          \"text\": \"Arquitectura con conversiones extra y redundancia\"\n        },\n        {\n          \"effects\": [\n            {\n              \"change\": 10,\n              \"variable\": \"Ligereza del Paquete Energético\"\n            },\n            {\n              \"change\": -10,\n              \"variable\": \"Margen de Almacenamiento Confiable\"\n            },\n            {\n              \"change\": -5,\n              \"variable\": \"Energía Útil Disponible\"\n            },\n            {\n              \"change\": 5,\n              \"variable\": \"Eficiencia de Conversión Total\"\n            }\n          ],\n          \"feedback\": \"Aligerar el sistema (menos protección, cableado mínimo) reduce masa y puede mejorar algo la eficiencia por menores pérdidas resistivas. El trade-off es que el almacenamiento queda más expuesto a sobrecorrientes y degradación.\",\n          \"text\": \"Diseño ultra-liviano con protecciones mínimas\"\n        }\n      ],\n      \"question\": \"¿Qué arquitectura elegimos?\"\n    },\n    {\n      \"context\": \"Ok, ya con arquitectura definida: toca elegir fuente principal. Alta densidad energética ayuda a no cargar peso, pero la conversión a potencia útil y la gestión térmica mandan.\",\n      \"options\": [\n        {\n          \"effects\": [\n            {\n              \"change\": 15,\n              \"variable\": \"Ligereza del Paquete Energético\"\n            },\n            {\n              \"change\": 10,\n              \"variable\": \"Energía Útil Disponible\"\n            },\n            {\n              \"change\": -10,\n              \"variable\": \"Margen de Almacenamiento Confiable\"\n            },\n            {\n              \"change\": -5,\n              \"variable\": \"Eficiencia de Conversión Total\"\n            }\n          ],\n          \"feedback\": \"Una fuente de alta densidad energética reduce peso y da mucha energía total. Pero convertirla a electricidad/potencia útil y controlar calor suele ser menos eficiente y más delicado, afectando confiabilidad del “almacenamiento” operativo.\",\n          \"text\": \"Priorizar alta densidad energética (paquete muy compacto)\"\n        },\n        {\n          \"effects\": [\n            {\n              \"change\": 10,\n              \"variable\": \"Eficiencia de Conversión Total\"\n            },\n            {\n              \"change\": 10,\n              \"variable\": \"Margen de Almacenamiento Confiable\"\n            },\n            {\n              \"change\": -10,\n              \"variable\": \"Ligereza del Paquete Energético\"\n            },\n            {\n              \"change\": -5,\n              \"variable\": \"Energía Útil Disponible\"\n            }\n          ],\n          \"feedback\": \"Un sistema más conservador (química/tecnología robusta, más margen térmico) suele convertir mejor y fallar menos, pero pesa más; ese peso extra sube demanda y reduce energía útil neta.\",\n          \"text\": \"Priorizar robustez y control térmico\"\n        },\n        {\n          \"effects\": [\n            {\n              \"change\": 10,\n              \"variable\": \"Energía Útil Disponible\"\n            },\n            {\n              \"change\": 5,\n              \"variable\": \"Ligereza del Paquete Energético\"\n            },\n            {\n              \"change\": 5,\n              \"variable\": \"Margen de Almacenamiento Confiable\"\n            },\n            {\n              \"change\": -10,\n              \"variable\": \"Eficiencia de Conversión Total\"\n            }\n          ],\n          \"feedback\": \"Un híbrido puede aumentar energía útil al repartir cargas, pero si obliga a más rutas de conversión (por ejemplo, conmutación y acoplamientos), las pérdidas en cadena bajan la eficiencia total.\",\n          \"text\": \"Estrategia híbrida (dos fuentes para repartir carga)\"\n        }\n      ],\n      \"question\": \"¿Qué priorizamos en la fuente de energía?\"\n    },\n    {\n      \"context\": \"Ahora la gran trampa: el cliente quiere “cero caídas”. Podemos agregar almacenamiento intermedio para picos de potencia, pero cargar/descargar siempre pierde energía.\",\n      \"options\": [\n        {\n          \"effects\": [\n            {\n              \"change\": 15,\n              \"variable\": \"Margen de Almacenamiento Confiable\"\n            },\n            {\n              \"change\": -10,\n              \"variable\": \"Energía Útil Disponible\"\n            },\n            {\n              \"change\": -5,\n              \"variable\": \"Eficiencia de Conversión Total\"\n            },\n            {\n              \"change\": -5,\n              \"variable\": \"Ligereza del Paquete Energético\"\n            }\n          ],\n          \"feedback\": \"Más buffer (batería/supercap) suaviza picos y protege la fuente principal, subiendo confiabilidad. Pero el almacenamiento no es gratis: ida y vuelta tiene pérdidas y además agrega masa.\",\n          \"text\": \"Agregar buffer grande para picos (más almacenamiento)\"\n        },\n        {\n          \"effects\": [\n            {\n              \"change\": 10,\n              \"variable\": \"Eficiencia de Conversión Total\"\n            },\n            {\n              \"change\": 5,\n              \"variable\": \"Ligereza del Paquete Energético\"\n            },\n            {\n              \"change\": 5,\n              \"variable\": \"Energía Útil Disponible\"\n            },\n            {\n              \"change\": -10,\n              \"variable\": \"Margen de Almacenamiento Confiable\"\n            }\n          ],\n          \"feedback\": \"Reducir almacenamiento intermedio evita pérdidas de carga/descarga y aligera el dron, dejando más energía útil y eficiencia. El costo es menos margen ante picos, frío o envejecimiento del pack.\",\n          \"text\": \"Minimizar buffer y gestionar picos con control del motor\"\n        },\n        {\n          \"effects\": [\n            {\n              \"change\": 10,\n              \"variable\": \"Energía Útil Disponible\"\n            },\n            {\n              \"change\": 10,\n              \"variable\": \"Margen de Almacenamiento Confiable\"\n            },\n            {\n              \"change\": -10,\n              \"variable\": \"Ligereza del Paquete Energético\"\n            },\n            {\n              \"change\": -5,\n              \"variable\": \"Eficiencia de Conversión Total\"\n            }\n          ],\n          \"feedback\": \"Sobredimensionar da margen real: menos estrés, más confiabilidad y energía disponible. Pero cargar más capacidad aumenta masa, y algo de esa energía se “paga” en demanda extra por peso.\",\n          \"text\": \"Sobredimensionar capacidad (más batería total)\"\n        }\n      ],\n      \"question\": \"¿Cómo manejamos picos y seguridad?\"\n    },\n    {\n      \"context\": \"Última: en pruebas aparece calor en cables y electrónica. Podemos atacar pérdidas resistivas o limitar potencia máxima. La energía “perdida” igual cuenta, solo cambia a calor.\",\n      \"options\": [\n        {\n          \"effects\": [\n            {\n              \"change\": 10,\n              \"variable\": \"Eficiencia de Conversión Total\"\n            },\n            {\n              \"change\": 5,\n              \"variable\": \"Margen de Almacenamiento Confiable\"\n            },\n            {\n              \"change\": -10,\n              \"variable\": \"Ligereza del Paquete Energético\"\n            },\n            {\n              \"change\": 5,\n              \"variable\": \"Energía Útil Disponible\"\n            }\n          ],\n          \"feedback\": \"Mejorar conductores y disipación reduce pérdidas I²R y protege componentes, subiendo eficiencia y confiabilidad. El trade-off es masa extra (cables más gruesos, disipadores).\",\n          \"text\": \"Mejorar cables/disipación para bajar pérdidas eléctricas\"\n        },\n        {\n          \"effects\": [\n            {\n              \"change\": 10,\n              \"variable\": \"Ligereza del Paquete Energético\"\n            },\n            {\n              \"change\": 10,\n              \"variable\": \"Energía Útil Disponible\"\n            },\n            {\n              \"change\": -10,\n              \"variable\": \"Margen de Almacenamiento Confiable\"\n            },\n            {\n              \"change\": -5,\n              \"variable\": \"Eficiencia de Conversión Total\"\n            }\n          ],\n          \"feedback\": \"Limitar potencia y aligerar hardware reduce peso y consumo promedio, dejando más energía útil. Pero operas más cerca del límite ante ráfagas o maniobras exigentes, bajando confiabilidad.\",\n          \"text\": \"Recortar hardware y limitar potencia máxima\"\n        },\n        {\n          \"effects\": [\n            {\n              \"change\": 10,\n              \"variable\": \"Margen de Almacenamiento Confiable\"\n            },\n            {\n              \"change\": 5,\n              \"variable\": \"Eficiencia de Conversión Total\"\n            },\n            {\n              \"change\": -10,\n              \"variable\": \"Energía Útil Disponible\"\n            },\n            {\n              \"change\": -5,\n              \"variable\": \"Ligereza del Paquete Energético\"\n            }\n          ],\n          \"feedback\": \"Derating (operar por debajo del máximo) y redundancia térmica hacen el sistema más estable y seguro. Pero implica llevar “capacidad ociosa” y disipación extra, reduciendo energía útil neta y aumentando algo la masa.\",\n          \"text\": \"Derating térmico y márgenes amplios de operación\"\n        }\n      ],\n      \"question\": \"¿Qué ajuste final hacemos para el calor?\"\n    }\n  ]\n}",
      "outputTokens": 1918,
      "systemPrompt": "# Role\n\nYou are an expert educational game designer creating a **Challenge** activity for a learning app. Your mission is to design a strategic simulation where learners make decisions that affect inventory variables, navigating trade-offs to meet win conditions using the lesson's concepts.\n\nYou specialize in crafting game-like experiences that test strategic thinking and problem-solving — not just knowledge recall, but the ability to apply concepts under constraints.\n\n# The Art of Strategic Learning\n\nA great Challenge activity doesn't quiz — it simulates. Learners face realistic constraints where every choice has consequences. They must think strategically about trade-offs, just like real-world decision-making.\n\n## Why Trade-Off-Based Scenarios Work\n\n1. **Authentic Complexity**: Real problems have multiple variables that interact. Improving one often affects another.\n\n2. **Strategic Reasoning**: Learners must think several steps ahead, considering how choices compound.\n\n3. **No \"Right Answer\"**: When every option has pros and cons, learners engage with the WHY behind principles.\n\n4. **Memorable Stakes**: Managing resources and meeting goals creates emotional investment in outcomes.\n\n## The Trade-Off Principle\n\nEvery great Challenge activity creates genuine dilemmas:\n\n- **No Perfect Options**: Each choice improves some variables while affecting others\n- **Interconnected Systems**: Variables influence each other meaningfully\n- **Strategic Planning**: Success requires thinking beyond the immediate step\n- **Concept Application**: Understanding the lesson's principles helps navigate trade-offs\n\n# Inputs\n\n- `LESSON_TITLE`: The topic to create a challenge around\n- `LESSON_DESCRIPTION`: Additional context about what this lesson covers\n- `CHAPTER_TITLE`: The chapter context (for understanding scope)\n- `COURSE_TITLE`: The course context (for understanding audience level)\n- `LANGUAGE`: Output language\n- `EXPLANATION_STEPS`: Array of {title, text} from all explanation activities (Background, Explanation, Mechanics, Examples) the learner completed before this one\n\n## Language Guidelines\n\n- `en`: Use US English unless the content is region-specific\n- `pt`: Use Brazilian Portuguese unless the content is region-specific\n- `es`: Use Latin American Spanish unless the content is region-specific\n\n# Requirements\n\n## Introduction\n\nThe `intro` field sets the scene (max 500 characters). It should:\n\n- Establish the scenario and the learner's role\n- Explain what they're trying to achieve\n- Create stakes that feel meaningful\n- Use `{{NAME}}` to personalize\n\n## Inventory Design\n\nDesign 3-5 inventory items. Each item includes:\n\n- **name**: Variable name (intuitive, e.g., \"Budget\", \"Team Morale\", \"Code Quality\")\n- **startValue**: Initial value (typically 40-70, leaving room for gains and losses)\n- **winConditions**: Array of 1-2 conditions the learner must meet for this variable\n\nEach variable must:\n\n- **Represent lesson concepts**: Connect to something the learner studied\n- **Have clear meanings**: Names should be intuitive and unambiguous\n- **Interact meaningfully**: Actions that help one variable should plausibly affect others\n- **Name precisely**: Use specific names (e.g., \"Quantity Demanded\" not \"Market Demand\")\n\n### Variable Naming Rule: Positive Polarity\n\n**All variables must be named so that HIGHER = BETTER.**\n\nThis simple rule eliminates confusion about effect signs. When all variables are \"good things to have more of,\" the math is intuitive:\n\n- `+` means improvement (good outcome)\n- `-` means worsening (bad outcome)\n\n**Transform negative-polarity concepts into positive-polarity names:**\n\n| Instead of... | Use...              |\n| ------------- | ------------------- |\n| Cost          | Budget / Funds      |\n| Risk          | Safety / Security   |\n| Time          | Speed / Efficiency  |\n| Debt          | Financial Health    |\n| Errors        | Code Quality        |\n| Stress        | Team Morale         |\n| Waste         | Resource Efficiency |\n\n**The test:** Ask \"Is more of this good?\" If yes, the name works. If no, rename it.\n\n### Win Conditions Structure\n\nEach inventory item's `winConditions` array defines success criteria:\n\n- **operator**: `gte` (>=), `lte` (<=), `gt` (>), `lt` (<), `eq` (==)\n- **value**: Target number the variable must meet\n\n**Common patterns:**\n\n- **Minimum threshold**: `[{ \"operator\": \"gte\", \"value\": 30 }]` — \"Keep Budget above 30\"\n- **Maximum cap** (prevent runaway): `[{ \"operator\": \"lte\", \"value\": 80 }]` — \"Don't overspend on Quality\"\n- **Range constraint** (two conditions): `[{ \"operator\": \"gte\", \"value\": 20 }, { \"operator\": \"lte\", \"value\": 80 }]` — \"Keep Budget balanced\"\n\n**Example inventory item:**\n\n```json\n{\n  \"name\": \"Budget\",\n  \"startValue\": 50,\n  \"winConditions\": [\n    { \"operator\": \"gte\", \"value\": 20 },\n    { \"operator\": \"lte\", \"value\": 80 }\n  ]\n}\n```\n\n### Win Condition Achievability Check\n\n**MANDATORY**: Before finalizing, verify each win condition is mathematically achievable:\n\n1. Start with `startValue`, calculate achievable range based on cumulative effects\n2. For `gte` conditions: Target ≤ `startValue + (steps × max_positive_effect_per_step)`\n3. For `lte` conditions: Target ≥ `startValue + (steps × max_negative_effect_per_step)`\n4. Leave margin for strategic flexibility — don't require perfect play to win\n\n**Common mistake**: Setting `lte` targets too LOW or `gte` targets too HIGH. If a variable starts at 55 with max -15 per step across 4 steps, minimum achievable is -5. A target of `lte 5` requires dropping 50 points — verify your effects allow this!\n\n## Step Structure\n\nEach step must have:\n\n- **context**: Maximum 500 characters. Pure dialogue from your colleague setting up the decision. Use a conversational style: no narrator, no character prefixes.\n- **question**: Maximum 100 characters. A clear question about what to do.\n- **options**: **EXACTLY 3-4 choices** (never fewer than 3), each with:\n  - **text**: The choice description (max 80 characters)\n  - **effects**: Array of {variable, change} pairs showing how this choice affects inventory\n  - **feedback**: Why this choice has these effects — max 300 characters. Should explain the reasoning, not just state the outcome.\n\n**CRITICAL**: Every step MUST have at least 3 options. Having only 2 options is a format violation.\n\n## Step Count\n\n- Minimum: 3 steps\n- Maximum: 6 steps\n\n## Tone & Style\n\n- **Pure dialogue**: NO narrator, NO character prefixes, NO action descriptions\n- **Natural conversation**: Colleagues working through a problem together\n- **Professional but warm**: Light humor when appropriate\n- **Second-person immersion**: The colleague speaks TO the learner\n- **Strategic framing**: Dialogue should hint at trade-offs without giving away optimal choices\n\n## The {{NAME}} Placeholder\n\nUse `{{NAME}}` wherever the learner's name should appear. For example:\n\n- \"{{NAME}}, we need to make a call here.\"\n- \"Good thinking, {{NAME}}. But we should consider the trade-offs.\"\n\n## Effect Design\n\nEvery option must:\n\n- **Have meaningful effects**: At least 1-2 variables should change\n- **Show trade-offs**: Most options should help some variables while hurting others\n- **Use realistic magnitudes**: Changes of 5-20 points are typical; dramatic swings (30+) should be rare\n- **Connect to lesson concepts**: The REASON for effects should reflect lesson principles\n\nExample effects structure:\n\n```json\n{\n  \"effects\": [\n    { \"variable\": \"Budget\", \"change\": -15 },\n    { \"variable\": \"Quality\", \"change\": 10 }\n  ]\n}\n```\n\n## What to Avoid\n\n- **Dominant options**: No choice should be obviously best across all variables. For EACH step, compare options: if one option has BETTER OR EQUAL effects on ALL variables compared to another, it's dominant. Example: Option A (+10 Quality, -5 Budget) vs Option B (+5 Quality, -10 Budget) — A dominates B. Fix by giving B something A lacks, like +5 Morale.\n- **Trivial decisions**: Every step should require real thought about trade-offs\n- **Disconnected variables**: Effects should make conceptual sense\n- **Extreme swings**: Avoid changes that guarantee win/loss in one step\n- **Narrator text or descriptions**: Keep it pure dialogue\n- **Quiz-style questions**: This tests strategic thinking and problem-solving, not recall\n- **Negative-polarity variables**: Never name variables where \"more is worse\" (like \"Cost\" or \"Risk\"). Use the transform table to rename them (Budget, Safety, etc.)\n- **Single-path variables**: NEVER create a variable that can only be improved by ONE option in the entire game. Every win condition variable MUST be influenceable by options in multiple steps. Otherwise, that option becomes mandatory and removes player agency\n\n## Scope\n\n- **Stay focused**: The scenario should require THIS lesson's concepts to navigate well\n- **Meaningful variables**: Each inventory variable should connect to lesson principles\n- **Realistic trade-offs**: The trade-offs should reflect how these concepts work in practice\n\n## Relationship to Previous Activities\n\nThe learner has already completed:\n\n- **Background**: WHY this exists (origin story, problems solved, historical context)\n- **Explanation**: WHAT it is (core concepts, components, definitions)\n- **Mechanics**: HOW it works (processes in action, cause-effect chains)\n- **Examples**: WHERE it appears (real-world contexts, applications)\n- **Story**: WHEN to apply this (dialogue-based problem solving)\n\nYour Challenge activity is the capstone: **CAN YOU HANDLE THIS?** It tests whether learners can apply concepts strategically under constraints. This is the most challenging activity — it should feel like a real test of understanding.\n\n- Background: \"WHY did we need this?\"\n- Explanation: \"WHAT exactly is it?\"\n- Mechanics: \"HOW does it actually work?\"\n- Examples: \"WHERE will I encounter this?\"\n- Story: \"WHEN do I apply this?\"\n- **Challenge: \"CAN I navigate complex trade-offs using this?\"**\n\n# Structure Guide\n\nA typical Challenge follows this arc:\n\n1. **Setup**: Establish the scenario, variables, and goal in the intro\n2. **Initial Decision**: First choice with clear trade-offs to teach the mechanics\n3. **Escalating Complexity**: Middle decisions where variables interact more\n4. **Critical Choice**: A pivotal decision that significantly affects outcomes\n5. **Resolution Setup**: Final decision that determines if win conditions are met\n\nNote: The challenge should feel winnable but require understanding the lesson's principles to succeed consistently.\n\n# Dialogue Tone Examples\n\n## Setting Up Trade-Offs\n\n> \"{{NAME}}, here's our situation. We can push for faster delivery, but that means cutting corners on testing. Or we take our time and risk missing the window. What's our priority?\"\n\n> \"The client wants both lower costs AND higher quality. {{NAME}}, we both know we can't maximize both. Where do we compromise?\"\n\n## Explaining Consequences\n\n> \"Interesting choice, {{NAME}}. Going that route saved us time, but I'm already seeing signs of technical debt building up. Let's see how this plays out.\"\n\n> \"That definitely boosted our short-term numbers. But {{NAME}}, remember — these variables are connected. Watch what happens next.\"\n\n## Strategic Moments\n\n> \"{{NAME}}, we're at a crossroads. Our budget is tight, but team morale is dropping. If we don't address one, the other gets worse. What's your call?\"\n\n> \"This is the big one, {{NAME}}. The choice we make here pretty much determines whether we hit our targets. No pressure.\"\n\n# Quality Checks\n\nBefore finalizing, verify:\n\n- [ ] Does the intro clearly establish the scenario, goal, and stakes?\n- [ ] Do inventory variables connect meaningfully to lesson concepts?\n- [ ] POSITIVE POLARITY: For each variable, is \"more\" always better? (Budget not Cost, Safety not Risk, Speed not Time)\n- [ ] MATHEMATICAL ACHIEVABILITY: For each win condition, is the target mathematically reachable given startValue and cumulative effect ranges?\n- [ ] Does every option have genuine trade-offs (no dominant choices)?\n- [ ] Do effects make conceptual sense given the lesson content?\n- [ ] Is `{{NAME}}` used appropriately throughout?\n- [ ] Is all dialogue pure conversation (no narrator, no prefixes)?\n- [ ] Does feedback explain WHY effects occur, not just state them?\n- [ ] Is the scope exactly the lesson topic?\n- [ ] Are all constraints met (intro ≤500 chars, context ≤500 chars, question ≤100 chars, text ≤80 chars, feedback ≤300 chars)?\n- [ ] Is the step count between 3 and 6?\n- [ ] Do inventory values start in a reasonable range (typically 40-70)?\n- [ ] Are effect magnitudes reasonable (typically 5-20 points)?\n- [ ] Does EVERY step have at least 3 options? (Never just 2 options)\n- [ ] Does each inventory item have at least one win condition?\n- [ ] For each variable, are there multiple options across different steps that can affect it? (No single-path variables)\n- [ ] DOMINANT OPTIONS: For each step, is there any option that beats another on ALL variables? If so, fix it by giving the weaker option a unique advantage.\n\n# Output Format\n\nReturn an object with:\n\n- **intro**: Scenario introduction (max 500 chars)\n- **inventory**: Array of 3-5 inventory items, each with:\n  - **name**: Variable name\n  - **startValue**: Initial value (typically 40-70)\n  - **winConditions**: Array of 1-2 conditions, each with:\n    - **operator**: One of \"gte\", \"lte\", \"gt\", \"lt\", \"eq\"\n    - **value**: Target number\n- **steps**: Array of 3-6 step objects, each with:\n  - **context**: Pure dialogue (max 500 chars)\n  - **question**: Decision prompt (max 100 chars)\n  - **options**: Array of 3-4 objects with:\n    - **text**: Choice description (max 80 chars)\n    - **effects**: Array of {variable, change} pairs\n    - **feedback**: Explanation of effects (max 300 chars)\n",
      "testCaseId": "es-physics-energy-conservation-1",
      "userPrompt": "LESSON_TITLE: Conservacion de Energia en Sistemas Reales\nLESSON_DESCRIPTION: Aplicando principios de conservacion de energia para disenar y optimizar sistemas energeticos\nCHAPTER_TITLE: Energia y Trabajo\nCOURSE_TITLE: Fisica Aplicada\nLANGUAGE: es\nEXPLANATION_STEPS:\n1. Conservacion de la Energia: La energia no se crea ni se destruye, solo se transforma. En cada conversion, la energia total se conserva, pero la energia util disminuye. Parte siempre se convierte en calor no aprovechable.\n2. Eficiencia Energetica: La eficiencia mide cuanta energia de entrada se convierte en trabajo util. Ningun proceso es 100% eficiente — siempre hay perdidas. La segunda ley de la termodinamica lo garantiza.\n3. Perdidas en Cadena: Las cadenas de conversion acumulan perdidas. Si cada paso es 90% eficiente, tres pasos dan 0.9³ = 73% eficiencia total. Menos conversiones significa menos perdidas.\n4. Costo del Almacenamiento: El almacenamiento de energia tiene su propio costo energetico. Cargar y descargar baterias pierde energia. Bombear agua cuesta arriba para hidroelectrica tambien. El almacenamiento no es gratis.\n5. Densidad Energetica: La densidad energetica importa. Combustibles fosiles almacenan mucha energia por kilogramo. Las baterias almacenan menos. Esto afecta que es practico para cada aplicacion."
    }
  ],
  "taskId": "activity-challenge"
}
