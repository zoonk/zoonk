{
  "generatedAt": "2026-01-17T19:14:28.971Z",
  "modelId": "openai/gpt-5.2",
  "outputs": [
    {
      "duration": 30141.788959,
      "inputTokens": 2057,
      "output": "{\n  \"dimensions\": [\n    \"Latency Under Load\",\n    \"Memory Footprint\",\n    \"Engineering Risk\"\n  ],\n  \"intro\": \"{{NAME}}, we’re about to launch a “Trending Now” service. Product wants snappy results at peak traffic, Infra is worried about memory, and you’re on the hook if it melts down at 2 a.m. You’ll make a few design calls where time, space, and risk pull in different directions.\",\n  \"reflection\": \"You balanced latency, memory, and risk without a single universally “best” path. Complexity analysis is about predicting how choices behave as inputs grow: time-space trade-offs, amortized costs that hide spikes, and worst-case cliffs that can turn “fast on average” into “down in production.” The right pick depends on constraints and data patterns, not just big-O bragging rights.\",\n  \"scenes\": [\n    {\n      \"context\": \"{{NAME}}, our endpoint needs to return the top 50 trending items from up to a million events per minute. We can compute on demand or maintain state as events stream in. What’s your instinct?\",\n      \"options\": [\n        {\n          \"consequence\": \"Calls stay simple, but under peak traffic the repeated work piles up. It’s fine at small n, but latency grows linearly with each request’s scan.\",\n          \"dimension\": \"Latency Under Load\",\n          \"impact\": \"negative\",\n          \"text\": \"Compute trending on demand by scanning recent events\"\n        },\n        {\n          \"consequence\": \"Requests get fast because you’re reusing work, but you’re paying in memory and complexity. If the cache gets big, you’ll fight evictions and stale data.\",\n          \"dimension\": \"Memory Footprint\",\n          \"impact\": \"negative\",\n          \"text\": \"Keep an in-memory cache updated as events arrive\"\n        },\n        {\n          \"consequence\": \"Latency improves and memory stays controlled, but you accept approximate answers. When the data distribution shifts, you may undercount long-tail items.\",\n          \"dimension\": \"Engineering Risk\",\n          \"impact\": \"neutral\",\n          \"text\": \"Use an approximate sketch (e.g., heavy hitters)\"\n        },\n        {\n          \"consequence\": \"Predictable memory and durability, but every read now depends on storage latency and load. If the store is hot, you’ll feel it immediately.\",\n          \"dimension\": \"Latency Under Load\",\n          \"impact\": \"neutral\",\n          \"text\": \"Precompute periodically and store results in a DB table\"\n        }\n      ],\n      \"question\": \"How do we produce the trending list?\"\n    },\n    {\n      \"context\": \"{{NAME}}, for lookups we need to map itemId to stats constantly. We can use a hash map, a sorted structure, or keep arrays indexed by ID. Which direction do you want?\",\n      \"options\": [\n        {\n          \"consequence\": \"Lookups are typically O(1), which helps latency a lot, but memory grows with the number of active items and you’ll pay for overhead and resizing.\",\n          \"dimension\": \"Memory Footprint\",\n          \"impact\": \"negative\",\n          \"text\": \"Use a hash table for itemId -> stats\"\n        },\n        {\n          \"consequence\": \"Memory is tighter and ordering comes “for free,” but operations cost O(log n). Under heavy write rates, that log factor can show up.\",\n          \"dimension\": \"Latency Under Load\",\n          \"impact\": \"negative\",\n          \"text\": \"Use a balanced tree (ordered map)\"\n        },\n        {\n          \"consequence\": \"Fast and compact if IDs are dense, but if IDs are sparse you waste huge memory. Also, resizing a giant array is painful.\",\n          \"dimension\": \"Memory Footprint\",\n          \"impact\": \"negative\",\n          \"text\": \"Use an array indexed by itemId\"\n        },\n        {\n          \"consequence\": \"You avoid a big in-memory index, but every lookup can become a query. It reduces memory pressure while increasing tail latency risk.\",\n          \"dimension\": \"Latency Under Load\",\n          \"impact\": \"negative\",\n          \"text\": \"Query stats from storage on demand\"\n        }\n      ],\n      \"question\": \"What data structure backs item lookups?\"\n    },\n    {\n      \"context\": \"{{NAME}}, we’re about to pick a sort strategy to produce the top 50. Average traffic is fine, but Black Friday load is brutal. Do we optimize for average speed or worst-case safety?\",\n      \"options\": [\n        {\n          \"consequence\": \"Great average performance, but a bad input pattern can push you toward O(n²). If that coincides with peak load, it’s a rough day.\",\n          \"dimension\": \"Engineering Risk\",\n          \"impact\": \"negative\",\n          \"text\": \"Use quicksort and trust average-case\"\n        },\n        {\n          \"consequence\": \"You get dependable O(n log n) worst-case, but constant factors can be higher. Some runs will be slower than quicksort’s average.\",\n          \"dimension\": \"Latency Under Load\",\n          \"impact\": \"neutral\",\n          \"text\": \"Use mergesort/heapsort for worst-case guarantees\"\n        },\n        {\n          \"consequence\": \"For top-50 you avoid fully sorting, improving time. But correctness depends on careful implementation and edge cases around ties.\",\n          \"dimension\": \"Engineering Risk\",\n          \"impact\": \"neutral\",\n          \"text\": \"Use selection/heap: keep only top 50\"\n        },\n        {\n          \"consequence\": \"It’s simple and predictable, but rebuilding every time can be expensive. As n grows, you’ll feel the repeated O(n log n).\",\n          \"dimension\": \"Latency Under Load\",\n          \"impact\": \"negative\",\n          \"text\": \"Always fully sort the candidate list\"\n        }\n      ],\n      \"question\": \"How do we handle ranking under load?\"\n    },\n    {\n      \"context\": \"{{NAME}}, we’re seeing occasional latency spikes. Profiling shows the dynamic array that stores recent events sometimes resizes and copies a lot. It’s amortized O(1), but the spikes are real. What do we do?\",\n      \"options\": [\n        {\n          \"consequence\": \"Most operations stay fast, but you still get periodic stalls. Amortized analysis says it’s fine; users experiencing spikes disagree.\",\n          \"dimension\": \"Latency Under Load\",\n          \"impact\": \"negative\",\n          \"text\": \"Keep it as-is and accept amortized behavior\"\n        },\n        {\n          \"consequence\": \"Fewer spikes and steadier latency, but you may over-allocate memory. If traffic drops, you’re paying for unused capacity.\",\n          \"dimension\": \"Memory Footprint\",\n          \"impact\": \"negative\",\n          \"text\": \"Pre-size aggressively based on expected peak\"\n        },\n        {\n          \"consequence\": \"More stable memory usage, but per-event overhead rises and you add complexity. Also, iteration becomes less cache-friendly.\",\n          \"dimension\": \"Latency Under Load\",\n          \"impact\": \"neutral\",\n          \"text\": \"Switch to a linked structure or segmented buffers\"\n        },\n        {\n          \"consequence\": \"You reduce worst spikes, but you might introduce more frequent small allocations and GC pressure. Tail latency could still suffer.\",\n          \"dimension\": \"Engineering Risk\",\n          \"impact\": \"neutral\",\n          \"text\": \"Tune growth factor and add pooling\"\n        }\n      ],\n      \"question\": \"How do we manage amortized resize spikes?\"\n    },\n    {\n      \"context\": \"{{NAME}}, SRE wants a hard guarantee: “No request should exceed 200ms.” You can enforce safeguards, but each has a cost. What’s our protection plan?\",\n      \"options\": [\n        {\n          \"consequence\": \"Latency becomes predictable, but results may be stale or approximate during spikes. Product will notice the occasional weird ranking.\",\n          \"dimension\": \"Engineering Risk\",\n          \"impact\": \"neutral\",\n          \"text\": \"Cap work per request; degrade gracefully\"\n        },\n        {\n          \"consequence\": \"Worst-case latency improves, but memory and background work increase. If memory pressure hits, you’ll trade one failure mode for another.\",\n          \"dimension\": \"Memory Footprint\",\n          \"impact\": \"negative\",\n          \"text\": \"Precompute more and cache aggressively\"\n        },\n        {\n          \"consequence\": \"You reduce exposure to worst-case inputs, but you’re betting on assumptions about the data distribution. When patterns change, performance can regress.\",\n          \"dimension\": \"Engineering Risk\",\n          \"impact\": \"negative\",\n          \"text\": \"Optimize for average case; monitor and react\"\n        },\n        {\n          \"consequence\": \"You protect the system, but you’re dropping or delaying user requests. Reliability looks better while user experience takes the hit.\",\n          \"dimension\": \"Latency Under Load\",\n          \"impact\": \"positive\",\n          \"text\": \"Add backpressure and rate limiting\"\n        }\n      ],\n      \"question\": \"How do we meet a strict tail-latency SLO?\"\n    }\n  ]\n}",
      "outputTokens": 1523,
      "systemPrompt": "# Role\n\nYou are an expert educational game designer creating a **Challenge** activity for a learning app. Your mission is to design a choose-your-own-adventure scenario where learners make strategic decisions with meaningful consequences, using the lesson's concepts.\n\nYou specialize in crafting narrative experiences that test strategic thinking — not knowledge recall, but the ability to apply concepts and understand trade-offs.\n\n# Why Narrative Challenges Work\n\nGreat challenges don't quiz — they immerse. Learners face realistic scenarios where every choice has consequences. They experience trade-offs firsthand, making the lesson's principles memorable.\n\n- **No \"Right Answer\"**: Every option has pros and cons. Learners engage with WHY, not just WHAT.\n- **Consequences Over Scores**: Instead of winning or losing, learners see the natural results of their choices.\n- **Strategic Thinking**: Understanding the lesson helps navigate trade-offs, but different strategies lead to different outcomes.\n\n# Inputs\n\n- `LESSON_TITLE`: The topic to create a challenge around\n- `LESSON_DESCRIPTION`: Additional context about what this lesson covers\n- `CHAPTER_TITLE`: The chapter context (for understanding scope)\n- `COURSE_TITLE`: The course context (for understanding audience level)\n- `LANGUAGE`: Output language\n- `EXPLANATION_STEPS`: What the learner has already studied\n\n## Language Guidelines\n\n- `en`: Use US English unless the content is region-specific\n- `pt`: Use Brazilian Portuguese unless the content is region-specific\n- `es`: Use Latin American Spanish unless the content is region-specific\n\n# Requirements\n\n## Introduction\n\nThe `intro` field sets the scene (max 500 characters). It should:\n\n- Establish the scenario and the learner's role\n- Explain what they're navigating (a project, situation, decision-making process)\n- Create stakes that feel meaningful\n- Use `{{NAME}}` to personalize\n\n## Dimensions\n\nDefine 2-4 dimensions that choices will affect. These are the trade-off axes — things the learner must balance. Examples:\n\n- \"Speed\" vs \"Quality\"\n- \"Cost\" vs \"Reliability\"\n- \"Short-term gains\" vs \"Long-term sustainability\"\n\nDimensions should:\n\n- Connect to the lesson's core concepts\n- Create natural tension (improving one often affects another)\n- Be intuitive and clearly named\n\n## Scenes\n\nCreate 4-6 scenes. Each scene presents a decision point with 3-4 options.\n\n### Scene Structure\n\n- **context**: Maximum 500 characters. Pure dialogue from a colleague setting up the decision. Conversational, no narrator.\n- **question**: Maximum 100 characters. What needs to be decided.\n- **options**: 3-4 choices, each with:\n  - **text**: The choice (max 80 characters)\n  - **consequence**: What happens as a result (max 300 characters). Shown after choosing. Explains the outcome narratively.\n  - **impact**: Is this `\"positive\"`, `\"neutral\"`, or `\"negative\"` for the dimension?\n  - **dimension**: Which dimension this primarily affects (must be one from your dimensions list)\n\n### Option Design\n\nEvery option should:\n\n- Be a legitimate choice (no obviously wrong answers)\n- Have a clear consequence that connects to lesson concepts\n- Affect one of the defined dimensions\n- Teach something about trade-offs when the consequence is revealed\n\n**No option should be universally best.** If one choice seems obviously superior, give it a meaningful drawback in its consequence.\n\n## Reflection\n\nThe `reflection` field (max 500 characters) provides closing insight after all scenes. It should:\n\n- Acknowledge that different approaches have merit\n- Connect the experience back to the lesson's key principles\n- Help learners understand how the concepts apply in practice\n\n## Tone & Style\n\n- **Pure dialogue**: NO narrator, NO character prefixes, NO action descriptions\n- **Natural conversation**: Colleagues working through a problem together\n- **Professional but warm**: Light humor when appropriate\n- **Second-person immersion**: The colleague speaks TO the learner\n- **Use `{{NAME}}`** to personalize dialogue\n\n## What to Avoid\n\n- **Quiz-style questions**: This tests strategic thinking, not recall\n- **Obviously correct answers**: Every option should have genuine trade-offs\n- **Narrator text**: Keep it pure dialogue in context\n- **Disconnected consequences**: Consequences should relate to lesson concepts\n- **Too many dimensions**: 2-4 is enough; more creates confusion\n\n## Relationship to Previous Activities\n\nThe learner has completed:\n\n- **Background**: WHY this exists\n- **Explanation**: WHAT it is\n- **Mechanics**: HOW it works\n- **Examples**: WHERE it appears\n- **Story**: WHEN to apply this\n\nYour Challenge activity is the capstone: **CAN YOU NAVIGATE THIS?** It tests whether learners can apply concepts strategically. This should feel like a meaningful simulation, not a test.\n\n# Example\n\nFor a lesson on \"Technical Debt\":\n\n**Dimensions:** `[\"Code Quality\", \"Delivery Speed\", \"Team Morale\"]`\n\n**Scene 1:**\n\n```json\n{\n  \"context\": \"{{NAME}}, we've got a deadline crunch. The feature works but the code is messy. Ship it now or clean it up first?\",\n  \"question\": \"How do we handle this?\",\n  \"options\": [\n    {\n      \"text\": \"Ship it now, refactor later\",\n      \"consequence\": \"Feature launched on time! But the messy code made the next sprint's work harder. The team spent extra hours untangling dependencies.\",\n      \"impact\": \"negative\",\n      \"dimension\": \"Code Quality\"\n    },\n    {\n      \"text\": \"Take two more days to refactor\",\n      \"consequence\": \"The code is clean and maintainable. Stakeholders weren't thrilled about the delay, but future changes will be much easier.\",\n      \"impact\": \"positive\",\n      \"dimension\": \"Code Quality\"\n    },\n    {\n      \"text\": \"Split the team — half ships, half refactors\",\n      \"consequence\": \"Shipped on time with partial cleanup. Neither task got full attention, and the team felt stretched thin.\",\n      \"impact\": \"negative\",\n      \"dimension\": \"Team Morale\"\n    }\n  ]\n}\n```\n\n# Quality Checks\n\nBefore finalizing, verify:\n\n- [ ] Does the intro establish a clear, engaging scenario?\n- [ ] Are dimensions connected to lesson concepts?\n- [ ] Does every option have a meaningful consequence?\n- [ ] Are consequences connected to lesson principles?\n- [ ] Is there no obviously \"best\" option in each scene?\n- [ ] Is `{{NAME}}` used appropriately?\n- [ ] Is all dialogue pure conversation (no narrator)?\n- [ ] Does the reflection tie the experience back to the lesson?\n- [ ] Are all constraints met (intro ≤500, context ≤500, question ≤100, text ≤80, consequence ≤300, reflection ≤500)?\n- [ ] Is the scene count between 4 and 6?\n- [ ] Does every scene have 3-4 options?\n\n# Output Format\n\nReturn an object with:\n\n- **intro**: Scenario introduction (max 500 chars)\n- **dimensions**: Array of 2-4 dimension names that choices will affect\n- **scenes**: Array of 4-6 scene objects, each with:\n  - **context**: Pure dialogue (max 500 chars)\n  - **question**: Decision prompt (max 100 chars)\n  - **options**: Array of 3-4 objects with:\n    - **text**: Choice description (max 80 chars)\n    - **consequence**: What happens (max 300 chars)\n    - **impact**: One of \"positive\", \"neutral\", \"negative\"\n    - **dimension**: Which dimension this affects\n- **reflection**: Closing insight connecting to lesson (max 500 chars)\n",
      "testCaseId": "en-cs-algorithm-complexity-1",
      "userPrompt": "LESSON_TITLE: Algorithm Complexity Trade-offs\nLESSON_DESCRIPTION: Understanding and applying algorithm complexity analysis to make informed trade-offs in software design\nCHAPTER_TITLE: Algorithm Analysis\nCOURSE_TITLE: Data Structures and Algorithms\nLANGUAGE: en\nEXPLANATION_STEPS:\n1. Time Complexity: Time complexity measures how execution time grows with input size. O(n) means linear growth — double the input, double the time. O(n²) means quadratic — double the input, quadruple the time.\n2. Space Complexity: Space complexity measures memory usage growth. Some algorithms trade time for space — storing precomputed results to avoid recalculation. Others trade space for time — using less memory but computing more.\n3. Time-Space Trade-off: The time-space trade-off is fundamental. Hash tables give O(1) lookup but use extra memory. Binary search uses O(1) space but requires sorted data. Choose based on constraints.\n4. Amortized Analysis: Amortized analysis looks at average performance over many operations. ArrayList append is usually O(1), but occasionally O(n) when resizing. Amortized, it's still O(1).\n5. Case Analysis: Best, average, and worst case can differ dramatically. Quicksort averages O(n log n) but worst-cases to O(n²). Know your data distribution to choose wisely."
    },
    {
      "duration": 34729.613,
      "inputTokens": 2024,
      "output": "{\n  \"dimensions\": [\n    \"Profit Margin\",\n    \"Sales Volume\",\n    \"Customer Trust\",\n    \"Operational Strain\"\n  ],\n  \"intro\": \"{{NAME}}, you’re pricing lead at a fast-growing cold-brew company. A competitor just changed prices, your costs are moving, and retailers want answers. You’ll make pricing and production calls while balancing margin, volume, trust, and your team’s capacity.\",\n  \"reflection\": \"You just navigated movements along curves (price changes) versus shifts (costs, preferences, competitors). Higher prices can raise margin but risk volume when demand is elastic; lower prices can boost volume but create shortages and strain if supply can’t scale. Equilibrium isn’t a target you “pick” once—it’s something you manage as conditions shift, while protecting trust and capacity.\",\n  \"scenes\": [\n    {\n      \"context\": \"{{NAME}}, the competitor dropped their price 15% this morning. Retailers are asking if we’ll match it by Friday. If we don’t, they’ll ‘reconsider shelf space.’ What’s our move?\",\n      \"options\": [\n        {\n          \"consequence\": \"Your margin per bottle improves, and operations stays calm. But with shoppers sensitive to price, some switch to the cheaper competitor, and a few retailers reduce your facings.\",\n          \"dimension\": \"Profit Margin\",\n          \"impact\": \"positive\",\n          \"text\": \"Hold price; emphasize quality and brand\"\n        },\n        {\n          \"consequence\": \"Unit sales stabilize and retailers relax. But you’re moving down along the demand curve—margin compresses fast, and you’ll need higher volume just to break even.\",\n          \"dimension\": \"Sales Volume\",\n          \"impact\": \"positive\",\n          \"text\": \"Match the competitor’s price cut\"\n        },\n        {\n          \"consequence\": \"You keep a premium price while reducing sticker shock. Customers like the deal, but redemption spikes create forecasting headaches and you still sacrifice margin on promo units.\",\n          \"dimension\": \"Customer Trust\",\n          \"impact\": \"neutral\",\n          \"text\": \"Keep price; run short-term coupons\"\n        },\n        {\n          \"consequence\": \"Some customers pay more without noticing, but price-sensitive buyers churn hard. You look out of touch compared to the competitor, and retailers demand stronger promos later.\",\n          \"dimension\": \"Customer Trust\",\n          \"impact\": \"negative\",\n          \"text\": \"Raise price slightly to signal premium positioning\"\n        }\n      ],\n      \"question\": \"How do you respond to the competitor’s price cut?\"\n    },\n    {\n      \"context\": \"{{NAME}}, our supplier emailed: bean costs jump 12% next month. That’s a supply shift—our costs rise. Finance wants a plan today so we don’t get blindsided on margins.\",\n      \"options\": [\n        {\n          \"consequence\": \"Margins recover quickly. But customers feel the increase immediately, and if demand is elastic in grocery aisles, volume drops more than finance expected.\",\n          \"dimension\": \"Profit Margin\",\n          \"impact\": \"positive\",\n          \"text\": \"Pass most of the cost increase into price\"\n        },\n        {\n          \"consequence\": \"Shelf price stays stable and volume holds. But margin takes the hit, and if the cost hike lasts, you’ll be funding sales with shrinking profit.\",\n          \"dimension\": \"Profit Margin\",\n          \"impact\": \"negative\",\n          \"text\": \"Absorb the cost increase to protect volume\"\n        },\n        {\n          \"consequence\": \"You reduce the cost per unit without changing price. A few loyal customers complain about taste, and reviews get more mixed—trust becomes the constraint, not supply.\",\n          \"dimension\": \"Customer Trust\",\n          \"impact\": \"negative\",\n          \"text\": \"Reformulate slightly to lower costs\"\n        },\n        {\n          \"consequence\": \"You buy time and reduce risk. But you may overpay if costs fall later, and you tie up cash that could’ve funded marketing or capacity upgrades.\",\n          \"dimension\": \"Operational Strain\",\n          \"impact\": \"neutral\",\n          \"text\": \"Lock in a long-term contract at a fixed price\"\n        }\n      ],\n      \"question\": \"How do you handle the cost-driven supply shift?\"\n    },\n    {\n      \"context\": \"{{NAME}}, a fitness influencer posted a viral video calling our cold brew ‘the clean caffeine.’ Orders are spiking online—this is a demand shift, not just a price move. Ops asks what to do before we run out.\",\n      \"options\": [\n        {\n          \"consequence\": \"You capture some extra profit while demand is high. But the higher price triggers backlash online, and if buyers are elastic, the spike cools faster than it started.\",\n          \"dimension\": \"Profit Margin\",\n          \"impact\": \"positive\",\n          \"text\": \"Raise price to ration demand\"\n        },\n        {\n          \"consequence\": \"You sell out in days, which looks ‘hot’ at first. Then customers get annoyed by empty shelves and delays, and the influencer buzz turns into ‘can’t find it anywhere.’\",\n          \"dimension\": \"Customer Trust\",\n          \"impact\": \"negative\",\n          \"text\": \"Keep price and accept stockouts\"\n        },\n        {\n          \"consequence\": \"You keep most customers happy by staying in stock. But you push the team hard, incur overtime and expedite fees, and quality slips a bit under speed pressure.\",\n          \"dimension\": \"Operational Strain\",\n          \"impact\": \"negative\",\n          \"text\": \"Ramp production aggressively with overtime\"\n        },\n        {\n          \"consequence\": \"You ride the demand shift without breaking operations. But limiting availability leaves money on the table, and some customers move on before you scale up.\",\n          \"dimension\": \"Operational Strain\",\n          \"impact\": \"positive\",\n          \"text\": \"Allocate inventory to best channels; grow capacity slowly\"\n        }\n      ],\n      \"question\": \"Demand just shifted up—how do you respond?\"\n    },\n    {\n      \"context\": \"{{NAME}}, sales data came in. In convenience stores, a $0.25 increase barely changed units. In grocery, the same increase cut units sharply. Leadership wants one national price ‘for simplicity.’\",\n      \"options\": [\n        {\n          \"consequence\": \"Easy to manage and message. But you misprice at least one segment: either you leave profit on the table in inelastic channels or you lose volume in elastic ones.\",\n          \"dimension\": \"Operational Strain\",\n          \"impact\": \"positive\",\n          \"text\": \"Set one national price using the overall average\"\n        },\n        {\n          \"consequence\": \"You price closer to each segment’s elasticity: higher where demand is inelastic, lower where it’s elastic. But retailers compare notes, and you’ll spend time defending the differences.\",\n          \"dimension\": \"Profit Margin\",\n          \"impact\": \"positive\",\n          \"text\": \"Use channel-specific pricing\"\n        },\n        {\n          \"consequence\": \"You reduce the perceived jump and keep grocery volume steadier. But smaller sizes raise packaging and handling costs, and some customers feel ‘shrinkflated.’\",\n          \"dimension\": \"Customer Trust\",\n          \"impact\": \"neutral\",\n          \"text\": \"Keep price; reduce bottle size slightly\"\n        },\n        {\n          \"consequence\": \"You keep customers and retailers calm across channels. But repeated promos train buyers to wait for deals, making future demand more elastic and margins harder to defend.\",\n          \"dimension\": \"Customer Trust\",\n          \"impact\": \"negative\",\n          \"text\": \"Keep list price; rely on frequent promotions\"\n        }\n      ],\n      \"question\": \"How do you use the elasticity insight in pricing?\"\n    },\n    {\n      \"context\": \"{{NAME}}, after your changes, warehouses report pallets piling up in two regions while another region is out of stock. Retailers are calling it ‘unreliable.’ We need a policy for the next quarter.\",\n      \"options\": [\n        {\n          \"consequence\": \"You move surplus fast and reduce waste. But discounting teaches buyers to expect markdowns, and stores in short regions get frustrated watching others get deals.\",\n          \"dimension\": \"Sales Volume\",\n          \"impact\": \"positive\",\n          \"text\": \"Discount in surplus regions to clear inventory\"\n        },\n        {\n          \"consequence\": \"Shortages ease and service levels improve. But overtime and rush freight spike costs, and the team’s burnout risk rises if this becomes the norm.\",\n          \"dimension\": \"Operational Strain\",\n          \"impact\": \"negative\",\n          \"text\": \"Increase supply with rush production and expedited shipping\"\n        },\n        {\n          \"consequence\": \"You stabilize availability and rebuild retailer confidence. But investing in flexibility costs money upfront, and if demand cools, you’ll have paid for capacity you don’t use.\",\n          \"dimension\": \"Customer Trust\",\n          \"impact\": \"positive\",\n          \"text\": \"Invest in forecasting and flexible distribution capacity\"\n        },\n        {\n          \"consequence\": \"You protect margin by not overreacting. But surplus becomes stale, stockouts continue, and retailers start replacing you with brands that can meet equilibrium more reliably.\",\n          \"dimension\": \"Sales Volume\",\n          \"impact\": \"negative\",\n          \"text\": \"Do nothing; wait for the market to ‘self-correct’\"\n        }\n      ],\n      \"question\": \"How do you address surplus in some regions and shortages in others?\"\n    }\n  ]\n}",
      "outputTokens": 1566,
      "systemPrompt": "# Role\n\nYou are an expert educational game designer creating a **Challenge** activity for a learning app. Your mission is to design a choose-your-own-adventure scenario where learners make strategic decisions with meaningful consequences, using the lesson's concepts.\n\nYou specialize in crafting narrative experiences that test strategic thinking — not knowledge recall, but the ability to apply concepts and understand trade-offs.\n\n# Why Narrative Challenges Work\n\nGreat challenges don't quiz — they immerse. Learners face realistic scenarios where every choice has consequences. They experience trade-offs firsthand, making the lesson's principles memorable.\n\n- **No \"Right Answer\"**: Every option has pros and cons. Learners engage with WHY, not just WHAT.\n- **Consequences Over Scores**: Instead of winning or losing, learners see the natural results of their choices.\n- **Strategic Thinking**: Understanding the lesson helps navigate trade-offs, but different strategies lead to different outcomes.\n\n# Inputs\n\n- `LESSON_TITLE`: The topic to create a challenge around\n- `LESSON_DESCRIPTION`: Additional context about what this lesson covers\n- `CHAPTER_TITLE`: The chapter context (for understanding scope)\n- `COURSE_TITLE`: The course context (for understanding audience level)\n- `LANGUAGE`: Output language\n- `EXPLANATION_STEPS`: What the learner has already studied\n\n## Language Guidelines\n\n- `en`: Use US English unless the content is region-specific\n- `pt`: Use Brazilian Portuguese unless the content is region-specific\n- `es`: Use Latin American Spanish unless the content is region-specific\n\n# Requirements\n\n## Introduction\n\nThe `intro` field sets the scene (max 500 characters). It should:\n\n- Establish the scenario and the learner's role\n- Explain what they're navigating (a project, situation, decision-making process)\n- Create stakes that feel meaningful\n- Use `{{NAME}}` to personalize\n\n## Dimensions\n\nDefine 2-4 dimensions that choices will affect. These are the trade-off axes — things the learner must balance. Examples:\n\n- \"Speed\" vs \"Quality\"\n- \"Cost\" vs \"Reliability\"\n- \"Short-term gains\" vs \"Long-term sustainability\"\n\nDimensions should:\n\n- Connect to the lesson's core concepts\n- Create natural tension (improving one often affects another)\n- Be intuitive and clearly named\n\n## Scenes\n\nCreate 4-6 scenes. Each scene presents a decision point with 3-4 options.\n\n### Scene Structure\n\n- **context**: Maximum 500 characters. Pure dialogue from a colleague setting up the decision. Conversational, no narrator.\n- **question**: Maximum 100 characters. What needs to be decided.\n- **options**: 3-4 choices, each with:\n  - **text**: The choice (max 80 characters)\n  - **consequence**: What happens as a result (max 300 characters). Shown after choosing. Explains the outcome narratively.\n  - **impact**: Is this `\"positive\"`, `\"neutral\"`, or `\"negative\"` for the dimension?\n  - **dimension**: Which dimension this primarily affects (must be one from your dimensions list)\n\n### Option Design\n\nEvery option should:\n\n- Be a legitimate choice (no obviously wrong answers)\n- Have a clear consequence that connects to lesson concepts\n- Affect one of the defined dimensions\n- Teach something about trade-offs when the consequence is revealed\n\n**No option should be universally best.** If one choice seems obviously superior, give it a meaningful drawback in its consequence.\n\n## Reflection\n\nThe `reflection` field (max 500 characters) provides closing insight after all scenes. It should:\n\n- Acknowledge that different approaches have merit\n- Connect the experience back to the lesson's key principles\n- Help learners understand how the concepts apply in practice\n\n## Tone & Style\n\n- **Pure dialogue**: NO narrator, NO character prefixes, NO action descriptions\n- **Natural conversation**: Colleagues working through a problem together\n- **Professional but warm**: Light humor when appropriate\n- **Second-person immersion**: The colleague speaks TO the learner\n- **Use `{{NAME}}`** to personalize dialogue\n\n## What to Avoid\n\n- **Quiz-style questions**: This tests strategic thinking, not recall\n- **Obviously correct answers**: Every option should have genuine trade-offs\n- **Narrator text**: Keep it pure dialogue in context\n- **Disconnected consequences**: Consequences should relate to lesson concepts\n- **Too many dimensions**: 2-4 is enough; more creates confusion\n\n## Relationship to Previous Activities\n\nThe learner has completed:\n\n- **Background**: WHY this exists\n- **Explanation**: WHAT it is\n- **Mechanics**: HOW it works\n- **Examples**: WHERE it appears\n- **Story**: WHEN to apply this\n\nYour Challenge activity is the capstone: **CAN YOU NAVIGATE THIS?** It tests whether learners can apply concepts strategically. This should feel like a meaningful simulation, not a test.\n\n# Example\n\nFor a lesson on \"Technical Debt\":\n\n**Dimensions:** `[\"Code Quality\", \"Delivery Speed\", \"Team Morale\"]`\n\n**Scene 1:**\n\n```json\n{\n  \"context\": \"{{NAME}}, we've got a deadline crunch. The feature works but the code is messy. Ship it now or clean it up first?\",\n  \"question\": \"How do we handle this?\",\n  \"options\": [\n    {\n      \"text\": \"Ship it now, refactor later\",\n      \"consequence\": \"Feature launched on time! But the messy code made the next sprint's work harder. The team spent extra hours untangling dependencies.\",\n      \"impact\": \"negative\",\n      \"dimension\": \"Code Quality\"\n    },\n    {\n      \"text\": \"Take two more days to refactor\",\n      \"consequence\": \"The code is clean and maintainable. Stakeholders weren't thrilled about the delay, but future changes will be much easier.\",\n      \"impact\": \"positive\",\n      \"dimension\": \"Code Quality\"\n    },\n    {\n      \"text\": \"Split the team — half ships, half refactors\",\n      \"consequence\": \"Shipped on time with partial cleanup. Neither task got full attention, and the team felt stretched thin.\",\n      \"impact\": \"negative\",\n      \"dimension\": \"Team Morale\"\n    }\n  ]\n}\n```\n\n# Quality Checks\n\nBefore finalizing, verify:\n\n- [ ] Does the intro establish a clear, engaging scenario?\n- [ ] Are dimensions connected to lesson concepts?\n- [ ] Does every option have a meaningful consequence?\n- [ ] Are consequences connected to lesson principles?\n- [ ] Is there no obviously \"best\" option in each scene?\n- [ ] Is `{{NAME}}` used appropriately?\n- [ ] Is all dialogue pure conversation (no narrator)?\n- [ ] Does the reflection tie the experience back to the lesson?\n- [ ] Are all constraints met (intro ≤500, context ≤500, question ≤100, text ≤80, consequence ≤300, reflection ≤500)?\n- [ ] Is the scene count between 4 and 6?\n- [ ] Does every scene have 3-4 options?\n\n# Output Format\n\nReturn an object with:\n\n- **intro**: Scenario introduction (max 500 chars)\n- **dimensions**: Array of 2-4 dimension names that choices will affect\n- **scenes**: Array of 4-6 scene objects, each with:\n  - **context**: Pure dialogue (max 500 chars)\n  - **question**: Decision prompt (max 100 chars)\n  - **options**: Array of 3-4 objects with:\n    - **text**: Choice description (max 80 chars)\n    - **consequence**: What happens (max 300 chars)\n    - **impact**: One of \"positive\", \"neutral\", \"negative\"\n    - **dimension**: Which dimension this affects\n- **reflection**: Closing insight connecting to lesson (max 500 chars)\n",
      "testCaseId": "en-economics-supply-demand-1",
      "userPrompt": "LESSON_TITLE: Supply and Demand in Practice\nLESSON_DESCRIPTION: Applying supply and demand principles to make strategic pricing and market decisions\nCHAPTER_TITLE: Market Dynamics\nCOURSE_TITLE: Microeconomics Fundamentals\nLANGUAGE: en\nEXPLANATION_STEPS:\n1. The Demand Curve: Demand curves slope downward — as price rises, quantity demanded falls. This reflects the law of demand: people buy less when things cost more, all else equal.\n2. The Supply Curve: Supply curves slope upward — as price rises, quantity supplied increases. Higher prices incentivize producers to make more. Lower prices make production less worthwhile.\n3. Market Equilibrium: Equilibrium occurs where supply meets demand. At this price, quantity supplied equals quantity demanded. Prices above equilibrium create surplus; prices below create shortage.\n4. Price Elasticity: Price elasticity measures responsiveness to price changes. Elastic demand (>1) means sales drop sharply with price increases. Inelastic demand (<1) means sales barely change.\n5. Shifts vs. Movements: Shifts vs. movements: A change in price moves along the curve. Changes in other factors (income, preferences, costs) shift the entire curve. This distinction is crucial."
    },
    {
      "duration": 34539.403791000004,
      "inputTokens": 2032,
      "output": "{\n  \"dimensions\": [\n    \"Ecosystem Stability\",\n    \"Biodiversity & Resilience\",\n    \"Community Support\",\n    \"Speed of Visible Results\"\n  ],\n  \"intro\": \"{{NAME}}, the county hired you to manage Pine River Reserve after a rough year—wildfire scars, noisy visitors, and wildlife swings. You’ve got one season to set a direction that holds up long-term, keeps locals on your side, and avoids triggering a cascade you can’t undo.\",\n  \"reflection\": \"You probably felt the tension: fast wins can trade away stability, and simple plans can weaken resilience. Ecosystem management is steering networks—watching carrying capacity, preventing trophic cascades, and using succession on purpose. Different strategies can work, but they change who benefits, how soon results appear, and how robust the system is when the next shock hits.\",\n  \"scenes\": [\n    {\n      \"context\": \"{{NAME}}, the deer are everywhere. Rangers say the understory is getting hammered, and songbirds are disappearing. We can’t do nothing, but whatever we do will be controversial.\",\n      \"options\": [\n        {\n          \"consequence\": \"Deer numbers drop fast and shrubs rebound. But removing top predators can shift behavior in ways that are hard to predict, and you may be stuck repeating culls if food plants recover too well.\",\n          \"dimension\": \"Ecosystem Stability\",\n          \"impact\": \"neutral\",\n          \"text\": \"Start a targeted deer cull near overbrowsed areas\"\n        },\n        {\n          \"consequence\": \"Predators begin shaping deer behavior, and vegetation gets a chance to recover in a more self-sustaining way. The downside is slow timelines and strong pushback from residents worried about pets and safety.\",\n          \"dimension\": \"Ecosystem Stability\",\n          \"impact\": \"positive\",\n          \"text\": \"Reintroduce a small predator population with monitoring\"\n        },\n        {\n          \"consequence\": \"Vegetation gets immediate protection, and the public likes a nonlethal move. But fenced patches can shift grazing pressure elsewhere, fragment habitat, and create a “whack-a-mole” maintenance burden.\",\n          \"dimension\": \"Speed of Visible Results\",\n          \"impact\": \"positive\",\n          \"text\": \"Install exclosures to protect key regeneration zones\"\n        },\n        {\n          \"consequence\": \"You avoid backlash and costs now, but browsing continues, seedlings fail, and you risk a trophic cascade where plant loss reshapes insects, birds, and stream shade. Fixing it later will be harder.\",\n          \"dimension\": \"Ecosystem Stability\",\n          \"impact\": \"negative\",\n          \"text\": \"Hold off and gather more data for a full year\"\n        }\n      ],\n      \"question\": \"How do you address deer overpopulation?\"\n    },\n    {\n      \"context\": \"{{NAME}}, after the wildfire, invasive grass is racing in on the south slope. It’s cheap to seed one fast-growing grass, but some staff want a diverse native mix even if it’s pricey and slower.\",\n      \"options\": [\n        {\n          \"consequence\": \"The slope greens up quickly and erosion slows. But a near-monoculture can be fragile, limiting habitat options and making the site vulnerable to pests, drought, or another fire cycle.\",\n          \"dimension\": \"Speed of Visible Results\",\n          \"impact\": \"positive\",\n          \"text\": \"Seed one fast-cover grass to stabilize soil fast\"\n        },\n        {\n          \"consequence\": \"You rebuild multiple niches, improving resilience and future habitat. The trade-off is complexity: sourcing, planting, and establishment are slower, and the public may not see quick progress.\",\n          \"dimension\": \"Biodiversity & Resilience\",\n          \"impact\": \"positive\",\n          \"text\": \"Plant a diverse native mix across the whole slope\"\n        },\n        {\n          \"consequence\": \"You get quick stabilization where it matters most while letting other zones transition naturally. But patchy outcomes can confuse stakeholders and require careful boundary decisions to avoid invasives spreading.\",\n          \"dimension\": \"Ecosystem Stability\",\n          \"impact\": \"neutral\",\n          \"text\": \"Use diverse mix in hotspots; let low-risk areas succeed naturally\"\n        },\n        {\n          \"consequence\": \"The invasives keep momentum, potentially setting the site into an undesirable successional track that’s costly to reverse later. You save money now but may pay much more in control efforts.\",\n          \"dimension\": \"Ecosystem Stability\",\n          \"impact\": \"negative\",\n          \"text\": \"Do minimal seeding and focus on trail repairs instead\"\n        }\n      ],\n      \"question\": \"What’s your post-fire restoration approach?\"\n    },\n    {\n      \"context\": \"{{NAME}}, our lake is getting algae blooms. Fish are stressed, visitors are complaining, and the town wants a quick fix. The question is whether we treat symptoms or change the nutrient inputs.\",\n      \"options\": [\n        {\n          \"consequence\": \"Water clears quickly and complaints drop. But it’s a recurring expense and can disrupt food webs if the treatment affects plankton communities that everything else depends on.\",\n          \"dimension\": \"Speed of Visible Results\",\n          \"impact\": \"positive\",\n          \"text\": \"Apply a short-term lake treatment to suppress blooms\"\n        },\n        {\n          \"consequence\": \"Reducing nutrients tackles the root cause and improves long-term stability. The downside is slow visible change and friction with landowners who feel targeted by new restrictions.\",\n          \"dimension\": \"Ecosystem Stability\",\n          \"impact\": \"positive\",\n          \"text\": \"Push upstream nutrient controls with landowner agreements\"\n        },\n        {\n          \"consequence\": \"You get targeted gains and shared ownership, but coordination takes time and results can be uneven. If one partner drops out, the system may slide back toward blooms.\",\n          \"dimension\": \"Community Support\",\n          \"impact\": \"positive\",\n          \"text\": \"Launch a joint watershed plan with farmers and the town\"\n        },\n        {\n          \"consequence\": \"You avoid conflict now, but blooms intensify, oxygen crashes become more likely, and fish kills could trigger emergency actions later. Public trust may drop if you look unresponsive.\",\n          \"dimension\": \"Community Support\",\n          \"impact\": \"negative\",\n          \"text\": \"Wait for more sampling before changing anything\"\n        }\n      ],\n      \"question\": \"How do you respond to recurring algae blooms?\"\n    },\n    {\n      \"context\": \"{{NAME}}, visitor pressure is spiking. People want more trails and a new campground. Rangers say sensitive nesting areas can’t take it. We can redesign access, but it affects revenue and goodwill.\",\n      \"options\": [\n        {\n          \"consequence\": \"You protect nesting success and reduce disturbance, which supports long-term stability. But some visitors feel shut out, and local businesses complain about fewer peak-season bookings.\",\n          \"dimension\": \"Ecosystem Stability\",\n          \"impact\": \"positive\",\n          \"text\": \"Close sensitive zones seasonally and enforce quiet buffers\"\n        },\n        {\n          \"consequence\": \"You keep everyone happy in the short term and boost revenue. But higher disturbance can push key species out, and once wildlife declines, the “nature draw” that fuels visits can fade.\",\n          \"dimension\": \"Community Support\",\n          \"impact\": \"positive\",\n          \"text\": \"Approve expansion with minimal restrictions\"\n        },\n        {\n          \"consequence\": \"You concentrate use where the ecosystem can handle it and keep access open. The trade-off is upfront cost and the risk that concentrated traffic exceeds local carrying capacity if demand keeps rising.\",\n          \"dimension\": \"Ecosystem Stability\",\n          \"impact\": \"neutral\",\n          \"text\": \"Build one durable trail loop and limit access elsewhere\"\n        },\n        {\n          \"consequence\": \"You gain buy-in and reduce conflict, but the process is slow. Meanwhile, unmanaged use continues, potentially causing damage that’s hard to reverse by the time the plan lands.\",\n          \"dimension\": \"Speed of Visible Results\",\n          \"impact\": \"negative\",\n          \"text\": \"Pause decisions and run a public planning process first\"\n        }\n      ],\n      \"question\": \"How will you manage surging recreation demand?\"\n    },\n    {\n      \"context\": \"{{NAME}}, the board wants a headline metric for ‘success’ this year. Staff are split: pick one flagship species, or track a broader set of indicators that reflect the whole network.\",\n      \"options\": [\n        {\n          \"consequence\": \"You get a clear story and easier fundraising. But optimizing for one species can hide trade-offs—like boosting its habitat while quietly reducing diversity or destabilizing other trophic levels.\",\n          \"dimension\": \"Speed of Visible Results\",\n          \"impact\": \"positive\",\n          \"text\": \"Choose one flagship species and manage around it\"\n        },\n        {\n          \"consequence\": \"You see the system more honestly—population swings, vegetation recovery, water quality, and predator-prey balance. The downside is slower, messier communication and more data work.\",\n          \"dimension\": \"Ecosystem Stability\",\n          \"impact\": \"positive\",\n          \"text\": \"Use multi-indicator monitoring across trophic levels\"\n        },\n        {\n          \"consequence\": \"You focus on prevention and resilience with fewer data demands, but early warning signals may be missed. If a cascade starts, you might notice only after impacts are visible.\",\n          \"dimension\": \"Biodiversity & Resilience\",\n          \"impact\": \"neutral\",\n          \"text\": \"Track habitat quality and diversity instead of species counts\"\n        },\n        {\n          \"consequence\": \"You can show quick progress, but you risk managing to the metric—tweaking easy numbers while underlying carrying capacity or succession trends drift in the wrong direction.\",\n          \"dimension\": \"Community Support\",\n          \"impact\": \"positive\",\n          \"text\": \"Report simple visitor-friendly metrics (clarity, trail ratings)\"\n        }\n      ],\n      \"question\": \"What will you measure and report as success?\"\n    }\n  ]\n}",
      "outputTokens": 1680,
      "systemPrompt": "# Role\n\nYou are an expert educational game designer creating a **Challenge** activity for a learning app. Your mission is to design a choose-your-own-adventure scenario where learners make strategic decisions with meaningful consequences, using the lesson's concepts.\n\nYou specialize in crafting narrative experiences that test strategic thinking — not knowledge recall, but the ability to apply concepts and understand trade-offs.\n\n# Why Narrative Challenges Work\n\nGreat challenges don't quiz — they immerse. Learners face realistic scenarios where every choice has consequences. They experience trade-offs firsthand, making the lesson's principles memorable.\n\n- **No \"Right Answer\"**: Every option has pros and cons. Learners engage with WHY, not just WHAT.\n- **Consequences Over Scores**: Instead of winning or losing, learners see the natural results of their choices.\n- **Strategic Thinking**: Understanding the lesson helps navigate trade-offs, but different strategies lead to different outcomes.\n\n# Inputs\n\n- `LESSON_TITLE`: The topic to create a challenge around\n- `LESSON_DESCRIPTION`: Additional context about what this lesson covers\n- `CHAPTER_TITLE`: The chapter context (for understanding scope)\n- `COURSE_TITLE`: The course context (for understanding audience level)\n- `LANGUAGE`: Output language\n- `EXPLANATION_STEPS`: What the learner has already studied\n\n## Language Guidelines\n\n- `en`: Use US English unless the content is region-specific\n- `pt`: Use Brazilian Portuguese unless the content is region-specific\n- `es`: Use Latin American Spanish unless the content is region-specific\n\n# Requirements\n\n## Introduction\n\nThe `intro` field sets the scene (max 500 characters). It should:\n\n- Establish the scenario and the learner's role\n- Explain what they're navigating (a project, situation, decision-making process)\n- Create stakes that feel meaningful\n- Use `{{NAME}}` to personalize\n\n## Dimensions\n\nDefine 2-4 dimensions that choices will affect. These are the trade-off axes — things the learner must balance. Examples:\n\n- \"Speed\" vs \"Quality\"\n- \"Cost\" vs \"Reliability\"\n- \"Short-term gains\" vs \"Long-term sustainability\"\n\nDimensions should:\n\n- Connect to the lesson's core concepts\n- Create natural tension (improving one often affects another)\n- Be intuitive and clearly named\n\n## Scenes\n\nCreate 4-6 scenes. Each scene presents a decision point with 3-4 options.\n\n### Scene Structure\n\n- **context**: Maximum 500 characters. Pure dialogue from a colleague setting up the decision. Conversational, no narrator.\n- **question**: Maximum 100 characters. What needs to be decided.\n- **options**: 3-4 choices, each with:\n  - **text**: The choice (max 80 characters)\n  - **consequence**: What happens as a result (max 300 characters). Shown after choosing. Explains the outcome narratively.\n  - **impact**: Is this `\"positive\"`, `\"neutral\"`, or `\"negative\"` for the dimension?\n  - **dimension**: Which dimension this primarily affects (must be one from your dimensions list)\n\n### Option Design\n\nEvery option should:\n\n- Be a legitimate choice (no obviously wrong answers)\n- Have a clear consequence that connects to lesson concepts\n- Affect one of the defined dimensions\n- Teach something about trade-offs when the consequence is revealed\n\n**No option should be universally best.** If one choice seems obviously superior, give it a meaningful drawback in its consequence.\n\n## Reflection\n\nThe `reflection` field (max 500 characters) provides closing insight after all scenes. It should:\n\n- Acknowledge that different approaches have merit\n- Connect the experience back to the lesson's key principles\n- Help learners understand how the concepts apply in practice\n\n## Tone & Style\n\n- **Pure dialogue**: NO narrator, NO character prefixes, NO action descriptions\n- **Natural conversation**: Colleagues working through a problem together\n- **Professional but warm**: Light humor when appropriate\n- **Second-person immersion**: The colleague speaks TO the learner\n- **Use `{{NAME}}`** to personalize dialogue\n\n## What to Avoid\n\n- **Quiz-style questions**: This tests strategic thinking, not recall\n- **Obviously correct answers**: Every option should have genuine trade-offs\n- **Narrator text**: Keep it pure dialogue in context\n- **Disconnected consequences**: Consequences should relate to lesson concepts\n- **Too many dimensions**: 2-4 is enough; more creates confusion\n\n## Relationship to Previous Activities\n\nThe learner has completed:\n\n- **Background**: WHY this exists\n- **Explanation**: WHAT it is\n- **Mechanics**: HOW it works\n- **Examples**: WHERE it appears\n- **Story**: WHEN to apply this\n\nYour Challenge activity is the capstone: **CAN YOU NAVIGATE THIS?** It tests whether learners can apply concepts strategically. This should feel like a meaningful simulation, not a test.\n\n# Example\n\nFor a lesson on \"Technical Debt\":\n\n**Dimensions:** `[\"Code Quality\", \"Delivery Speed\", \"Team Morale\"]`\n\n**Scene 1:**\n\n```json\n{\n  \"context\": \"{{NAME}}, we've got a deadline crunch. The feature works but the code is messy. Ship it now or clean it up first?\",\n  \"question\": \"How do we handle this?\",\n  \"options\": [\n    {\n      \"text\": \"Ship it now, refactor later\",\n      \"consequence\": \"Feature launched on time! But the messy code made the next sprint's work harder. The team spent extra hours untangling dependencies.\",\n      \"impact\": \"negative\",\n      \"dimension\": \"Code Quality\"\n    },\n    {\n      \"text\": \"Take two more days to refactor\",\n      \"consequence\": \"The code is clean and maintainable. Stakeholders weren't thrilled about the delay, but future changes will be much easier.\",\n      \"impact\": \"positive\",\n      \"dimension\": \"Code Quality\"\n    },\n    {\n      \"text\": \"Split the team — half ships, half refactors\",\n      \"consequence\": \"Shipped on time with partial cleanup. Neither task got full attention, and the team felt stretched thin.\",\n      \"impact\": \"negative\",\n      \"dimension\": \"Team Morale\"\n    }\n  ]\n}\n```\n\n# Quality Checks\n\nBefore finalizing, verify:\n\n- [ ] Does the intro establish a clear, engaging scenario?\n- [ ] Are dimensions connected to lesson concepts?\n- [ ] Does every option have a meaningful consequence?\n- [ ] Are consequences connected to lesson principles?\n- [ ] Is there no obviously \"best\" option in each scene?\n- [ ] Is `{{NAME}}` used appropriately?\n- [ ] Is all dialogue pure conversation (no narrator)?\n- [ ] Does the reflection tie the experience back to the lesson?\n- [ ] Are all constraints met (intro ≤500, context ≤500, question ≤100, text ≤80, consequence ≤300, reflection ≤500)?\n- [ ] Is the scene count between 4 and 6?\n- [ ] Does every scene have 3-4 options?\n\n# Output Format\n\nReturn an object with:\n\n- **intro**: Scenario introduction (max 500 chars)\n- **dimensions**: Array of 2-4 dimension names that choices will affect\n- **scenes**: Array of 4-6 scene objects, each with:\n  - **context**: Pure dialogue (max 500 chars)\n  - **question**: Decision prompt (max 100 chars)\n  - **options**: Array of 3-4 objects with:\n    - **text**: Choice description (max 80 chars)\n    - **consequence**: What happens (max 300 chars)\n    - **impact**: One of \"positive\", \"neutral\", \"negative\"\n    - **dimension**: Which dimension this affects\n- **reflection**: Closing insight connecting to lesson (max 500 chars)\n",
      "testCaseId": "en-biology-ecosystem-balance-1",
      "userPrompt": "LESSON_TITLE: Ecosystem Balance and Management\nLESSON_DESCRIPTION: Applying ecological principles to make informed ecosystem management decisions\nCHAPTER_TITLE: Ecosystem Dynamics\nCOURSE_TITLE: Ecology and Conservation\nLANGUAGE: en\nEXPLANATION_STEPS:\n1. Interconnected Networks: Ecosystems are interconnected networks. Removing one species affects others through food webs. Keystone species have disproportionate impact — their loss cascades through the system.\n2. Carrying Capacity: Carrying capacity is the maximum population an environment can sustain. Exceed it, and resources deplete, populations crash. Stay well below, and you're not maximizing the ecosystem's potential.\n3. Biodiversity and Resilience: Biodiversity provides resilience. More species means more ways to respond to change. Monocultures are efficient but fragile. Diverse systems are robust but complex to manage.\n4. Trophic Cascades: Trophic cascades occur when changes at one level ripple through others. Remove predators, and prey populations explode, overgrazing vegetation, affecting everything that depends on those plants.\n5. Ecological Succession: Ecological succession is the process of change over time. Pioneer species prepare the way for later ones. Managing ecosystems means deciding where in succession you want to be."
    },
    {
      "duration": 37100.114333,
      "inputTokens": 2084,
      "output": "{\n  \"dimensions\": [\n    \"Rendimento de Produto\",\n    \"Custo Operacional\",\n    \"Segurança e Conformidade\",\n    \"Estabilidade do Processo\"\n  ],\n  \"intro\": \"{{NAME}}, a planta quer aumentar a produção sem trocar o reator. Você vai ajustar condições de uma reação em equilíbrio para bater a meta de rendimento, sem estourar custos nem criar risco operacional. Cada mudança mexe no equilíbrio e na rotina da equipe. Vamos decidir em tempo real.\",\n  \"reflection\": \"{{NAME}}, deu pra ver que “empurrar” o equilíbrio costuma cobrar um preço: mais custo, mais risco ou menos estabilidade. Concentração e remoção de produto tendem a aumentar rendimento, pressão ajuda quando há menos mols gasosos nos produtos, e temperatura muda K (não é só “acelerar”). Catalisador é ótimo pra chegar mais rápido, mas não faz milagre no equilíbrio — ele só reduz o tempo e a dor operacional.\",\n  \"scenes\": [\n    {\n      \"context\": \"{{NAME}}, o relatório mostra que a conversão estacionou. A diretoria quer mais produto já. A primeira alavanca é a composição da alimentação. O que você prefere mexer primeiro?\",\n      \"options\": [\n        {\n          \"consequence\": \"A conversão sobe porque o sistema tenta consumir o reagente extra. Só que você aumenta consumo e pode precisar recuperar o excesso no separador, elevando custo e inventário.\",\n          \"dimension\": \"Custo Operacional\",\n          \"impact\": \"negative\",\n          \"text\": \"Aumentar bastante a concentração do reagente limitante\"\n        },\n        {\n          \"consequence\": \"A conversão melhora, mas devagar. O time ganha tempo pra ajustar controle e separação sem sobrecarregar utilidades, só que a meta pode demorar a aparecer.\",\n          \"dimension\": \"Estabilidade do Processo\",\n          \"impact\": \"positive\",\n          \"text\": \"Aumentar reagente aos poucos, em rampa controlada\"\n        },\n        {\n          \"consequence\": \"Ajuda a puxar o equilíbrio para produtos sem despejar mais reagente. O lado ruim é que o separador vira gargalo e qualquer instabilidade na remoção “devolve” produto ao reator.\",\n          \"dimension\": \"Rendimento de Produto\",\n          \"impact\": \"positive\",\n          \"text\": \"Remover o produto continuamente (purga/extração)\"\n        },\n        {\n          \"consequence\": \"A reação fica mais previsível e fácil de operar, mas você abre mão do empurrão de Le Chatelier e tende a manter o rendimento atual, frustrando a diretoria.\",\n          \"dimension\": \"Custo Operacional\",\n          \"impact\": \"positive\",\n          \"text\": \"Manter composição e focar em reduzir perdas e reciclos\"\n        }\n      ],\n      \"question\": \"Qual ajuste de composição você escolhe?\"\n    },\n    {\n      \"context\": \"{{NAME}}, sobre pressão: a reação é gasosa e o pessoal da utilidade disse que dá pra subir a pressão do reator, mas o compressor já trabalha perto do limite. Qual caminho você quer?\",\n      \"options\": [\n        {\n          \"consequence\": \"Se o lado dos produtos tiver menos mols de gás, você ganha rendimento. Em troca, cresce o estresse mecânico, o consumo elétrico e a exigência de inspeções e válvulas calibradas.\",\n          \"dimension\": \"Rendimento de Produto\",\n          \"impact\": \"positive\",\n          \"text\": \"Aumentar pressão para favorecer o lado com menos mols gasosos\"\n        },\n        {\n          \"consequence\": \"Você ganha estabilidade e reduz risco de trips e vazamentos, mas se a estequiometria favorece pressão alta, o rendimento fica para trás e o separador pode sofrer com mais gás não reagido.\",\n          \"dimension\": \"Segurança e Conformidade\",\n          \"impact\": \"positive\",\n          \"text\": \"Manter a pressão atual e priorizar margem de operação\"\n        },\n        {\n          \"consequence\": \"Pode aumentar a conversão por deslocar para o lado com mais mols gasosos (se for o caso) e aliviar compressor. Só que a taxa de reação pode cair e você pode precisar de mais volume/tempo de residência.\",\n          \"dimension\": \"Rendimento de Produto\",\n          \"impact\": \"negative\",\n          \"text\": \"Reduzir a pressão para aliviar utilidades\"\n        },\n        {\n          \"consequence\": \"Operacionalmente é simples, mas não muda o equilíbrio. Serve mais como ajuste de controle/arraste, e pode virar “complexidade sem ganho” se não houver gargalo real.\",\n          \"dimension\": \"Estabilidade do Processo\",\n          \"impact\": \"neutral\",\n          \"text\": \"Adicionar gás inerte para ajudar controle de vazão\"\n        }\n      ],\n      \"question\": \"Como você vai tratar a pressão do sistema?\"\n    },\n    {\n      \"context\": \"{{NAME}}, agora a temperatura. A equipe lembra que aquecer costuma “acelerar tudo”, mas você sabe que temperatura muda o equilíbrio dependendo de ser exotérmica ou endotérmica. O que você faz com o setpoint?\",\n      \"options\": [\n        {\n          \"consequence\": \"Você aumenta a velocidade e chega ao equilíbrio mais rápido, mas se a reação for exotérmica, o equilíbrio pode ir para reagentes e o rendimento cair mesmo com operação mais ágil.\",\n          \"dimension\": \"Rendimento de Produto\",\n          \"impact\": \"negative\",\n          \"text\": \"Aumentar a temperatura para ganhar taxa de reação\"\n        },\n        {\n          \"consequence\": \"Se a reação for exotérmica, isso favorece produtos e pode elevar o rendimento. O trade-off é menor taxa e risco de acúmulo de reagentes, exigindo mais tempo de residência.\",\n          \"dimension\": \"Rendimento de Produto\",\n          \"impact\": \"positive\",\n          \"text\": \"Diminuir a temperatura para favorecer o equilíbrio (se exotérmica)\"\n        },\n        {\n          \"consequence\": \"Você cria uma janela de testes e observa a resposta do sistema sem apostar tudo. Demora mais para otimizar, mas reduz retrabalho e evita decisões irreversíveis em produção.\",\n          \"dimension\": \"Estabilidade do Processo\",\n          \"impact\": \"positive\",\n          \"text\": \"Rodar uma varredura controlada de temperatura e medir conversão\"\n        },\n        {\n          \"consequence\": \"Você ganha robustez e evita overshoot térmico, mas pode perder oportunidade de deslocar o equilíbrio. A planta fica “segura”, só que a meta pode continuar distante.\",\n          \"dimension\": \"Segurança e Conformidade\",\n          \"impact\": \"positive\",\n          \"text\": \"Manter temperatura e reforçar controle térmico (malha/alarme)\"\n        }\n      ],\n      \"question\": \"Qual estratégia de temperatura você adota?\"\n    },\n    {\n      \"context\": \"{{NAME}}, manutenção trouxe um catalisador novo. Eles juram que “vai aumentar a conversão”, e o comercial quer anunciar ganho. Você aprova como?\",\n      \"options\": [\n        {\n          \"consequence\": \"O reator atinge o equilíbrio muito mais rápido e você pode aumentar vazão sem perder tanto em conversão por cinética. Mas o rendimento de equilíbrio não muda e você cria expectativa errada nos stakeholders.\",\n          \"dimension\": \"Estabilidade do Processo\",\n          \"impact\": \"positive\",\n          \"text\": \"Instalar catalisador para reduzir tempo de residência e aumentar throughput\"\n        },\n        {\n          \"consequence\": \"Você melhora controle e coleta dados sem parar a planta inteira. Em contrapartida, metade do time fica presa em testes e a melhora pode parecer pequena no curto prazo.\",\n          \"dimension\": \"Segurança e Conformidade\",\n          \"impact\": \"positive\",\n          \"text\": \"Fazer teste piloto/side-stream antes de trocar tudo\"\n        },\n        {\n          \"consequence\": \"Você evita custo e risco de troca, mantendo previsibilidade. Só que se a limitação for cinética, você continua operando “lento” e pode precisar de mudanças mais caras em pressão/temperatura.\",\n          \"dimension\": \"Custo Operacional\",\n          \"impact\": \"positive\",\n          \"text\": \"Não trocar catalisador; otimizar condições com o que já existe\"\n        },\n        {\n          \"consequence\": \"Você tenta forçar resultado mexendo em T e P junto com o catalisador. Pode entregar ganho rápido, mas aumenta chance de instabilidade e deixa difícil saber o que realmente causou o efeito.\",\n          \"dimension\": \"Estabilidade do Processo\",\n          \"impact\": \"negative\",\n          \"text\": \"Trocar catalisador e fazer grandes ajustes de T e P ao mesmo tempo\"\n        }\n      ],\n      \"question\": \"Como você vai usar o catalisador?\"\n    },\n    {\n      \"context\": \"{{NAME}}, o gerente pergunta: “Qual é o plano final pra bater a meta sem virar bombeiro todo dia?” Você precisa escolher uma filosofia de operação para o trimestre.\",\n      \"options\": [\n        {\n          \"consequence\": \"Rendimento sobe, mas o OPEX cresce e a planta fica sensível a qualquer variação de matéria-prima. Você vai depender de controle e manutenção bem afinados para não oscilar.\",\n          \"dimension\": \"Rendimento de Produto\",\n          \"impact\": \"positive\",\n          \"text\": \"Maximizar deslocamento: mais reagente + remoção de produto\"\n        },\n        {\n          \"consequence\": \"A operação fica estável e previsível, com menos paradas e menos retrabalho. O rendimento melhora pouco; o ganho vem mais de disponibilidade e consistência do que de equilíbrio.\",\n          \"dimension\": \"Estabilidade do Processo\",\n          \"impact\": \"positive\",\n          \"text\": \"Operar no “sweet spot” estável e ganhar por disponibilidade\"\n        },\n        {\n          \"consequence\": \"Você reduz risco e melhora auditorias, mas abre mão de agressividade. Se o mercado apertar, pode faltar competitividade por menor produção por hora.\",\n          \"dimension\": \"Segurança e Conformidade\",\n          \"impact\": \"positive\",\n          \"text\": \"Priorizar segurança: margens largas em pressão e temperatura\"\n        },\n        {\n          \"consequence\": \"Você corta custo direto, mas pode sacrificar conversão e sobrecarregar reciclos, o que volta como custo indireto. Se o equilíbrio precisa de “empurrão”, a economia vira perda de produção.\",\n          \"dimension\": \"Custo Operacional\",\n          \"impact\": \"positive\",\n          \"text\": \"Priorizar custo: limitar utilidades e aceitar menor conversão\"\n        }\n      ],\n      \"question\": \"Qual filosofia de operação você vai defender?\"\n    }\n  ]\n}",
      "outputTokens": 1870,
      "systemPrompt": "# Role\n\nYou are an expert educational game designer creating a **Challenge** activity for a learning app. Your mission is to design a choose-your-own-adventure scenario where learners make strategic decisions with meaningful consequences, using the lesson's concepts.\n\nYou specialize in crafting narrative experiences that test strategic thinking — not knowledge recall, but the ability to apply concepts and understand trade-offs.\n\n# Why Narrative Challenges Work\n\nGreat challenges don't quiz — they immerse. Learners face realistic scenarios where every choice has consequences. They experience trade-offs firsthand, making the lesson's principles memorable.\n\n- **No \"Right Answer\"**: Every option has pros and cons. Learners engage with WHY, not just WHAT.\n- **Consequences Over Scores**: Instead of winning or losing, learners see the natural results of their choices.\n- **Strategic Thinking**: Understanding the lesson helps navigate trade-offs, but different strategies lead to different outcomes.\n\n# Inputs\n\n- `LESSON_TITLE`: The topic to create a challenge around\n- `LESSON_DESCRIPTION`: Additional context about what this lesson covers\n- `CHAPTER_TITLE`: The chapter context (for understanding scope)\n- `COURSE_TITLE`: The course context (for understanding audience level)\n- `LANGUAGE`: Output language\n- `EXPLANATION_STEPS`: What the learner has already studied\n\n## Language Guidelines\n\n- `en`: Use US English unless the content is region-specific\n- `pt`: Use Brazilian Portuguese unless the content is region-specific\n- `es`: Use Latin American Spanish unless the content is region-specific\n\n# Requirements\n\n## Introduction\n\nThe `intro` field sets the scene (max 500 characters). It should:\n\n- Establish the scenario and the learner's role\n- Explain what they're navigating (a project, situation, decision-making process)\n- Create stakes that feel meaningful\n- Use `{{NAME}}` to personalize\n\n## Dimensions\n\nDefine 2-4 dimensions that choices will affect. These are the trade-off axes — things the learner must balance. Examples:\n\n- \"Speed\" vs \"Quality\"\n- \"Cost\" vs \"Reliability\"\n- \"Short-term gains\" vs \"Long-term sustainability\"\n\nDimensions should:\n\n- Connect to the lesson's core concepts\n- Create natural tension (improving one often affects another)\n- Be intuitive and clearly named\n\n## Scenes\n\nCreate 4-6 scenes. Each scene presents a decision point with 3-4 options.\n\n### Scene Structure\n\n- **context**: Maximum 500 characters. Pure dialogue from a colleague setting up the decision. Conversational, no narrator.\n- **question**: Maximum 100 characters. What needs to be decided.\n- **options**: 3-4 choices, each with:\n  - **text**: The choice (max 80 characters)\n  - **consequence**: What happens as a result (max 300 characters). Shown after choosing. Explains the outcome narratively.\n  - **impact**: Is this `\"positive\"`, `\"neutral\"`, or `\"negative\"` for the dimension?\n  - **dimension**: Which dimension this primarily affects (must be one from your dimensions list)\n\n### Option Design\n\nEvery option should:\n\n- Be a legitimate choice (no obviously wrong answers)\n- Have a clear consequence that connects to lesson concepts\n- Affect one of the defined dimensions\n- Teach something about trade-offs when the consequence is revealed\n\n**No option should be universally best.** If one choice seems obviously superior, give it a meaningful drawback in its consequence.\n\n## Reflection\n\nThe `reflection` field (max 500 characters) provides closing insight after all scenes. It should:\n\n- Acknowledge that different approaches have merit\n- Connect the experience back to the lesson's key principles\n- Help learners understand how the concepts apply in practice\n\n## Tone & Style\n\n- **Pure dialogue**: NO narrator, NO character prefixes, NO action descriptions\n- **Natural conversation**: Colleagues working through a problem together\n- **Professional but warm**: Light humor when appropriate\n- **Second-person immersion**: The colleague speaks TO the learner\n- **Use `{{NAME}}`** to personalize dialogue\n\n## What to Avoid\n\n- **Quiz-style questions**: This tests strategic thinking, not recall\n- **Obviously correct answers**: Every option should have genuine trade-offs\n- **Narrator text**: Keep it pure dialogue in context\n- **Disconnected consequences**: Consequences should relate to lesson concepts\n- **Too many dimensions**: 2-4 is enough; more creates confusion\n\n## Relationship to Previous Activities\n\nThe learner has completed:\n\n- **Background**: WHY this exists\n- **Explanation**: WHAT it is\n- **Mechanics**: HOW it works\n- **Examples**: WHERE it appears\n- **Story**: WHEN to apply this\n\nYour Challenge activity is the capstone: **CAN YOU NAVIGATE THIS?** It tests whether learners can apply concepts strategically. This should feel like a meaningful simulation, not a test.\n\n# Example\n\nFor a lesson on \"Technical Debt\":\n\n**Dimensions:** `[\"Code Quality\", \"Delivery Speed\", \"Team Morale\"]`\n\n**Scene 1:**\n\n```json\n{\n  \"context\": \"{{NAME}}, we've got a deadline crunch. The feature works but the code is messy. Ship it now or clean it up first?\",\n  \"question\": \"How do we handle this?\",\n  \"options\": [\n    {\n      \"text\": \"Ship it now, refactor later\",\n      \"consequence\": \"Feature launched on time! But the messy code made the next sprint's work harder. The team spent extra hours untangling dependencies.\",\n      \"impact\": \"negative\",\n      \"dimension\": \"Code Quality\"\n    },\n    {\n      \"text\": \"Take two more days to refactor\",\n      \"consequence\": \"The code is clean and maintainable. Stakeholders weren't thrilled about the delay, but future changes will be much easier.\",\n      \"impact\": \"positive\",\n      \"dimension\": \"Code Quality\"\n    },\n    {\n      \"text\": \"Split the team — half ships, half refactors\",\n      \"consequence\": \"Shipped on time with partial cleanup. Neither task got full attention, and the team felt stretched thin.\",\n      \"impact\": \"negative\",\n      \"dimension\": \"Team Morale\"\n    }\n  ]\n}\n```\n\n# Quality Checks\n\nBefore finalizing, verify:\n\n- [ ] Does the intro establish a clear, engaging scenario?\n- [ ] Are dimensions connected to lesson concepts?\n- [ ] Does every option have a meaningful consequence?\n- [ ] Are consequences connected to lesson principles?\n- [ ] Is there no obviously \"best\" option in each scene?\n- [ ] Is `{{NAME}}` used appropriately?\n- [ ] Is all dialogue pure conversation (no narrator)?\n- [ ] Does the reflection tie the experience back to the lesson?\n- [ ] Are all constraints met (intro ≤500, context ≤500, question ≤100, text ≤80, consequence ≤300, reflection ≤500)?\n- [ ] Is the scene count between 4 and 6?\n- [ ] Does every scene have 3-4 options?\n\n# Output Format\n\nReturn an object with:\n\n- **intro**: Scenario introduction (max 500 chars)\n- **dimensions**: Array of 2-4 dimension names that choices will affect\n- **scenes**: Array of 4-6 scene objects, each with:\n  - **context**: Pure dialogue (max 500 chars)\n  - **question**: Decision prompt (max 100 chars)\n  - **options**: Array of 3-4 objects with:\n    - **text**: Choice description (max 80 chars)\n    - **consequence**: What happens (max 300 chars)\n    - **impact**: One of \"positive\", \"neutral\", \"negative\"\n    - **dimension**: Which dimension this affects\n- **reflection**: Closing insight connecting to lesson (max 500 chars)\n",
      "testCaseId": "pt-chemistry-reaction-equilibrium-1",
      "userPrompt": "LESSON_TITLE: Equilibrio Quimico na Pratica\nLESSON_DESCRIPTION: Aplicando o principio de Le Chatelier para otimizar reacoes quimicas e processos industriais\nCHAPTER_TITLE: Equilibrio Quimico\nCOURSE_TITLE: Quimica Geral II\nLANGUAGE: pt\nEXPLANATION_STEPS:\n1. Principio de Le Chatelier: O principio de Le Chatelier diz que um sistema em equilibrio responde a perturbacoes minimizando a mudanca. Adicione reagente, o equilibrio desloca para consumir esse reagente.\n2. Efeito da Concentracao: Mudancas de concentracao deslocam o equilibrio. Adicionar reagentes desloca para produtos. Remover produtos tambem desloca para produtos. O sistema busca restaurar o equilibrio.\n3. Efeito da Pressao: A pressao afeta equilibrios gasosos. Aumentar pressao favorece o lado com menos moles de gas. Diminuir pressao favorece o lado com mais moles. Gases inertes nao afetam.\n4. Efeito da Temperatura: Temperatura e diferente — ela muda a constante de equilibrio. Reacoes exotermicas: aumento de temperatura desloca para reagentes. Reacoes endotermicas: aumento favorece produtos.\n5. Papel dos Catalisadores: Catalisadores aceleram ambas as direcoes igualmente. Eles nao deslocam o equilibrio — apenas ajudam a alcancar o equilibrio mais rapido. Util para processos industriais."
    },
    {
      "duration": 40172.35625,
      "inputTokens": 2085,
      "output": "{\n  \"dimensions\": [\n    \"Eficiencia total\",\n    \"Complejidad de la cadena\",\n    \"Flexibilidad operativa\",\n    \"Costo energético del almacenamiento\"\n  ],\n  \"intro\": \"{{NAME}}, mañana presentas el diseño de un sistema energético para una planta que quiere bajar su factura y emisiones. El director te pide “máximo ahorro sin parar producción”. Vas a decidir conversiones, almacenamiento y tecnologías, sabiendo que cada paso pierde energía y nada es 100% eficiente.\",\n  \"reflection\": \"{{NAME}}, tus decisiones mostraron el corazón de la conservación en sistemas reales: la energía se conserva, pero la útil se degrada en cada conversión. Menos pasos suele mejorar la eficiencia, pero reduce flexibilidad. El almacenamiento ayuda a operar mejor, aunque “cobra” pérdidas. Diseñar bien es elegir dónde aceptar pérdidas para ganar estabilidad, costo o practicidad.\",\n  \"scenes\": [\n    {\n      \"context\": \"{{NAME}}, tenemos vapor residual del proceso y también picos de demanda eléctrica. Si intentamos aprovecharlo todo, la cadena se vuelve larga; si simplificamos, dejamos energía “tirada” como calor. ¿Qué priorizamos en el concepto base?\",\n      \"options\": [\n        {\n          \"consequence\": \"Aprovechas calor que antes se perdía y reduces consumo de red. Pero agregas equipos y etapas; cada conversión mete pérdidas y mantenimiento, y la eficiencia real depende de operar cerca del punto óptimo.\",\n          \"dimension\": \"Complejidad de la cadena\",\n          \"impact\": \"negative\",\n          \"text\": \"Armar una cadena completa: vapor→turbina→generador→batería→cargas\"\n        },\n        {\n          \"consequence\": \"Menos etapas, menos pérdidas acumuladas y un sistema más predecible. A cambio, parte del calor residual queda sin uso y el ahorro total depende de cuánto coincida la generación con la demanda real.\",\n          \"dimension\": \"Eficiencia total\",\n          \"impact\": \"positive\",\n          \"text\": \"Simplificar: vapor→turbina→cargas críticas, sin almacenamiento\"\n        },\n        {\n          \"consequence\": \"No generas electricidad, pero desplazas consumo de gas o electricidad en calentamiento. Es eficiente por tener pocas conversiones, aunque no te ayuda tanto en los picos eléctricos del turno noche.\",\n          \"dimension\": \"Eficiencia total\",\n          \"impact\": \"neutral\",\n          \"text\": \"Usar el vapor directo para precalentar y proceso; nada de turbina\"\n        },\n        {\n          \"consequence\": \"Ganas control: cargas baterías en horas baratas y cubres picos. Pero pagas doble pérdida (cargar/descargar) y, si además vienes de una turbina, la energía útil cae más rápido de lo que el equipo espera.\",\n          \"dimension\": \"Costo energético del almacenamiento\",\n          \"impact\": \"negative\",\n          \"text\": \"Priorizar baterías para picos; la turbina solo cuando sobre energía\"\n        }\n      ],\n      \"question\": \"¿Cuál será el enfoque base del sistema?\"\n    },\n    {\n      \"context\": \"{{NAME}}, el jefe de mantenimiento dice que si metemos demasiadas conversiones no habrá repuestos ni tiempo. Pero finanzas insiste en que el retorno debe verse en 18 meses. ¿Cómo armamos el mapa de conversiones?\",\n      \"options\": [\n        {\n          \"consequence\": \"Reduces eslabones y pérdidas acumuladas; el rendimiento global suele subir. Pero sacrificas oportunidades de recuperar energía de baja calidad y de ajustar a cambios futuros en operación.\",\n          \"dimension\": \"Complejidad de la cadena\",\n          \"impact\": \"positive\",\n          \"text\": \"Recortar etapas: solo una conversión principal y distribución directa\"\n        },\n        {\n          \"consequence\": \"Tu eficiencia teórica se ve bien en la hoja de cálculo, pero en operación real aparecen pérdidas extra por control, arranques y desajustes. Aun así, podrías captar más energía si todo se mantiene afinado.\",\n          \"dimension\": \"Eficiencia total\",\n          \"impact\": \"neutral\",\n          \"text\": \"Optimizar varias etapas con controles finos y puntos de operación\"\n        },\n        {\n          \"consequence\": \"Aseguras continuidad y facilidad de reparación, con menos sorpresas. Pero el ahorro energético será más moderado y quizá cueste justificarlo si el precio de energía baja.\",\n          \"dimension\": \"Flexibilidad operativa\",\n          \"impact\": \"positive\",\n          \"text\": \"Diseño robusto y simple, aunque no capture toda la energía residual\"\n        },\n        {\n          \"consequence\": \"Ganas el “sí” de finanzas rápido, pero si la operación cambia, el sistema puede quedar sobredimensionado o subutilizado. Terminas con equipos que funcionan lejos de su eficiencia óptima.\",\n          \"dimension\": \"Flexibilidad operativa\",\n          \"impact\": \"negative\",\n          \"text\": \"Diseñar solo para el escenario actual y máxima carga\"\n        }\n      ],\n      \"question\": \"¿Cómo balanceas eficiencia vs. operabilidad en la cadena?\"\n    },\n    {\n      \"context\": \"{{NAME}}, producción quiere almacenar energía para cubrir paros de red y picos. El proveedor de baterías promete milagros, y el de bombeo hidráulico dice que su sistema dura décadas. ¿Qué estrategia de almacenamiento propones?\",\n      \"options\": [\n        {\n          \"consequence\": \"Cubres picos con respuesta rápida y mejoras continuidad. Pero cada ciclo pierde energía y, si ciclas mucho, el “costo energético” del almacenamiento se vuelve visible en la factura.\",\n          \"dimension\": \"Costo energético del almacenamiento\",\n          \"impact\": \"negative\",\n          \"text\": \"Baterías para picos diarios y respaldo corto\"\n        },\n        {\n          \"consequence\": \"Bajas la necesidad de almacenamiento, porque mueves consumo en vez de guardar energía. Pero requiere coordinación con producción y no todas las cargas pueden desplazarse sin afectar calidad o entregas.\",\n          \"dimension\": \"Eficiencia total\",\n          \"impact\": \"positive\",\n          \"text\": \"Gestionar demanda: desplazar cargas en vez de almacenar\"\n        },\n        {\n          \"consequence\": \"Útil si ya tienes desnivel e infraestructura; buena para energía por muchas horas. Pero bombear y turbinar tiene pérdidas, y la inversión/espacio pueden ser un freno si el sitio no acompaña.\",\n          \"dimension\": \"Costo energético del almacenamiento\",\n          \"impact\": \"neutral\",\n          \"text\": \"Bombeo hidráulico (si el sitio lo permite) para respaldo largo\"\n        },\n        {\n          \"consequence\": \"Ganas flexibilidad sin sobredimensionar, usando almacenamiento solo cuando aporta valor. A cambio, la operación es más compleja y si el pronóstico falla podrías comprar energía cara o desperdiciar excedentes.\",\n          \"dimension\": \"Flexibilidad operativa\",\n          \"impact\": \"positive\",\n          \"text\": \"Enfoque híbrido: poco almacenamiento + pronóstico + reglas de uso\"\n        }\n      ],\n      \"question\": \"¿Qué rol tendrá el almacenamiento en el diseño?\"\n    },\n    {\n      \"context\": \"{{NAME}}, hay debate sobre cambiar parte del sistema a baterías móviles para montacargas y equipos. Seguridad dice que es viable, pero logística teme peso y autonomía. ¿Cómo decides con la densidad energética en mente?\",\n      \"options\": [\n        {\n          \"consequence\": \"Operación más limpia y silenciosa, y controlas mejor el consumo. Pero la baja densidad energética te obliga a más peso, tiempos de carga y baterías extra; la energía “útil” disponible por kg limita turnos largos.\",\n          \"dimension\": \"Flexibilidad operativa\",\n          \"impact\": \"neutral\",\n          \"text\": \"Electrificar todo con baterías, aceptando más peso y recargas\"\n        },\n        {\n          \"consequence\": \"Mantienes autonomía alta con poco peso y recarga rápida. Pero dependes de combustible y pierdes oportunidades de usar energía recuperada del proceso; además, el calor residual sigue siendo una pérdida no aprovechada.\",\n          \"dimension\": \"Eficiencia total\",\n          \"impact\": \"neutral\",\n          \"text\": \"Mantener combustión donde se necesita alta autonomía\"\n        },\n        {\n          \"consequence\": \"Usas baterías donde la densidad no te castiga (rutas cortas) y reservas alta densidad para lo pesado. Pero administrar dos tecnologías complica mantenimiento y compras, y puedes perder economías de escala.\",\n          \"dimension\": \"Flexibilidad operativa\",\n          \"impact\": \"positive\",\n          \"text\": \"Estrategia mixta según perfil de uso (corto vs. largo)\"\n        },\n        {\n          \"consequence\": \"Evitas parar por falta de autonomía, pero introduces más ciclos de carga/descarga y mayor inventario de baterías. La energía se conserva, sí, pero el sistema paga pérdidas repetidas en cada intercambio.\",\n          \"dimension\": \"Costo energético del almacenamiento\",\n          \"impact\": \"negative\",\n          \"text\": \"Baterías intercambiables para no detener operación\"\n        }\n      ],\n      \"question\": \"¿Cómo aplicas densidad energética a la electrificación interna?\"\n    },\n    {\n      \"context\": \"{{NAME}}, ya casi cerramos. El director pregunta: “¿Qué KPI defendemos en la presentación?” Marketing quiere hablar de energía recuperada; operaciones de estabilidad; tú sabes que las pérdidas se esconden en la cadena. ¿Qué métrica lidera?\",\n      \"options\": [\n        {\n          \"consequence\": \"Te obliga a contar todas las pérdidas en cadena y evita vender humo. Pero es más difícil de explicar y puede verse “menos espectacular” que hablar de energía recuperada bruta.\",\n          \"dimension\": \"Eficiencia total\",\n          \"impact\": \"positive\",\n          \"text\": \"Eficiencia global del sistema (entrada→trabajo útil en cargas)\"\n        },\n        {\n          \"consequence\": \"Alinea al equipo con continuidad y evita soluciones frágiles. Pero podrías aceptar ineficiencias grandes “por si acaso”, y terminar pagando energía extra para ganar tranquilidad.\",\n          \"dimension\": \"Flexibilidad operativa\",\n          \"impact\": \"positive\",\n          \"text\": \"Confiabilidad y capacidad de cubrir picos sin parar producción\"\n        },\n        {\n          \"consequence\": \"Suena impresionante y ayuda a conseguir aprobación inicial. Pero puede ocultar que recuperar energía en una cadena larga deja poco trabajo útil al final; el ahorro real puede decepcionar.\",\n          \"dimension\": \"Complejidad de la cadena\",\n          \"impact\": \"negative\",\n          \"text\": \"kWh recuperados del calor residual como KPI principal\"\n        },\n        {\n          \"consequence\": \"Cierra con números claros para finanzas y disciplina el diseño. Pero si solo miras costo, podrías elegir opciones con más pérdidas o menor resiliencia cuando cambien precios o condiciones de operación.\",\n          \"dimension\": \"Eficiencia total\",\n          \"impact\": \"neutral\",\n          \"text\": \"Costo por kWh útil entregado (incluyendo pérdidas y ciclos)\"\n        }\n      ],\n      \"question\": \"¿Qué KPI guía la decisión final y el relato?\"\n    }\n  ]\n}",
      "outputTokens": 1969,
      "systemPrompt": "# Role\n\nYou are an expert educational game designer creating a **Challenge** activity for a learning app. Your mission is to design a choose-your-own-adventure scenario where learners make strategic decisions with meaningful consequences, using the lesson's concepts.\n\nYou specialize in crafting narrative experiences that test strategic thinking — not knowledge recall, but the ability to apply concepts and understand trade-offs.\n\n# Why Narrative Challenges Work\n\nGreat challenges don't quiz — they immerse. Learners face realistic scenarios where every choice has consequences. They experience trade-offs firsthand, making the lesson's principles memorable.\n\n- **No \"Right Answer\"**: Every option has pros and cons. Learners engage with WHY, not just WHAT.\n- **Consequences Over Scores**: Instead of winning or losing, learners see the natural results of their choices.\n- **Strategic Thinking**: Understanding the lesson helps navigate trade-offs, but different strategies lead to different outcomes.\n\n# Inputs\n\n- `LESSON_TITLE`: The topic to create a challenge around\n- `LESSON_DESCRIPTION`: Additional context about what this lesson covers\n- `CHAPTER_TITLE`: The chapter context (for understanding scope)\n- `COURSE_TITLE`: The course context (for understanding audience level)\n- `LANGUAGE`: Output language\n- `EXPLANATION_STEPS`: What the learner has already studied\n\n## Language Guidelines\n\n- `en`: Use US English unless the content is region-specific\n- `pt`: Use Brazilian Portuguese unless the content is region-specific\n- `es`: Use Latin American Spanish unless the content is region-specific\n\n# Requirements\n\n## Introduction\n\nThe `intro` field sets the scene (max 500 characters). It should:\n\n- Establish the scenario and the learner's role\n- Explain what they're navigating (a project, situation, decision-making process)\n- Create stakes that feel meaningful\n- Use `{{NAME}}` to personalize\n\n## Dimensions\n\nDefine 2-4 dimensions that choices will affect. These are the trade-off axes — things the learner must balance. Examples:\n\n- \"Speed\" vs \"Quality\"\n- \"Cost\" vs \"Reliability\"\n- \"Short-term gains\" vs \"Long-term sustainability\"\n\nDimensions should:\n\n- Connect to the lesson's core concepts\n- Create natural tension (improving one often affects another)\n- Be intuitive and clearly named\n\n## Scenes\n\nCreate 4-6 scenes. Each scene presents a decision point with 3-4 options.\n\n### Scene Structure\n\n- **context**: Maximum 500 characters. Pure dialogue from a colleague setting up the decision. Conversational, no narrator.\n- **question**: Maximum 100 characters. What needs to be decided.\n- **options**: 3-4 choices, each with:\n  - **text**: The choice (max 80 characters)\n  - **consequence**: What happens as a result (max 300 characters). Shown after choosing. Explains the outcome narratively.\n  - **impact**: Is this `\"positive\"`, `\"neutral\"`, or `\"negative\"` for the dimension?\n  - **dimension**: Which dimension this primarily affects (must be one from your dimensions list)\n\n### Option Design\n\nEvery option should:\n\n- Be a legitimate choice (no obviously wrong answers)\n- Have a clear consequence that connects to lesson concepts\n- Affect one of the defined dimensions\n- Teach something about trade-offs when the consequence is revealed\n\n**No option should be universally best.** If one choice seems obviously superior, give it a meaningful drawback in its consequence.\n\n## Reflection\n\nThe `reflection` field (max 500 characters) provides closing insight after all scenes. It should:\n\n- Acknowledge that different approaches have merit\n- Connect the experience back to the lesson's key principles\n- Help learners understand how the concepts apply in practice\n\n## Tone & Style\n\n- **Pure dialogue**: NO narrator, NO character prefixes, NO action descriptions\n- **Natural conversation**: Colleagues working through a problem together\n- **Professional but warm**: Light humor when appropriate\n- **Second-person immersion**: The colleague speaks TO the learner\n- **Use `{{NAME}}`** to personalize dialogue\n\n## What to Avoid\n\n- **Quiz-style questions**: This tests strategic thinking, not recall\n- **Obviously correct answers**: Every option should have genuine trade-offs\n- **Narrator text**: Keep it pure dialogue in context\n- **Disconnected consequences**: Consequences should relate to lesson concepts\n- **Too many dimensions**: 2-4 is enough; more creates confusion\n\n## Relationship to Previous Activities\n\nThe learner has completed:\n\n- **Background**: WHY this exists\n- **Explanation**: WHAT it is\n- **Mechanics**: HOW it works\n- **Examples**: WHERE it appears\n- **Story**: WHEN to apply this\n\nYour Challenge activity is the capstone: **CAN YOU NAVIGATE THIS?** It tests whether learners can apply concepts strategically. This should feel like a meaningful simulation, not a test.\n\n# Example\n\nFor a lesson on \"Technical Debt\":\n\n**Dimensions:** `[\"Code Quality\", \"Delivery Speed\", \"Team Morale\"]`\n\n**Scene 1:**\n\n```json\n{\n  \"context\": \"{{NAME}}, we've got a deadline crunch. The feature works but the code is messy. Ship it now or clean it up first?\",\n  \"question\": \"How do we handle this?\",\n  \"options\": [\n    {\n      \"text\": \"Ship it now, refactor later\",\n      \"consequence\": \"Feature launched on time! But the messy code made the next sprint's work harder. The team spent extra hours untangling dependencies.\",\n      \"impact\": \"negative\",\n      \"dimension\": \"Code Quality\"\n    },\n    {\n      \"text\": \"Take two more days to refactor\",\n      \"consequence\": \"The code is clean and maintainable. Stakeholders weren't thrilled about the delay, but future changes will be much easier.\",\n      \"impact\": \"positive\",\n      \"dimension\": \"Code Quality\"\n    },\n    {\n      \"text\": \"Split the team — half ships, half refactors\",\n      \"consequence\": \"Shipped on time with partial cleanup. Neither task got full attention, and the team felt stretched thin.\",\n      \"impact\": \"negative\",\n      \"dimension\": \"Team Morale\"\n    }\n  ]\n}\n```\n\n# Quality Checks\n\nBefore finalizing, verify:\n\n- [ ] Does the intro establish a clear, engaging scenario?\n- [ ] Are dimensions connected to lesson concepts?\n- [ ] Does every option have a meaningful consequence?\n- [ ] Are consequences connected to lesson principles?\n- [ ] Is there no obviously \"best\" option in each scene?\n- [ ] Is `{{NAME}}` used appropriately?\n- [ ] Is all dialogue pure conversation (no narrator)?\n- [ ] Does the reflection tie the experience back to the lesson?\n- [ ] Are all constraints met (intro ≤500, context ≤500, question ≤100, text ≤80, consequence ≤300, reflection ≤500)?\n- [ ] Is the scene count between 4 and 6?\n- [ ] Does every scene have 3-4 options?\n\n# Output Format\n\nReturn an object with:\n\n- **intro**: Scenario introduction (max 500 chars)\n- **dimensions**: Array of 2-4 dimension names that choices will affect\n- **scenes**: Array of 4-6 scene objects, each with:\n  - **context**: Pure dialogue (max 500 chars)\n  - **question**: Decision prompt (max 100 chars)\n  - **options**: Array of 3-4 objects with:\n    - **text**: Choice description (max 80 chars)\n    - **consequence**: What happens (max 300 chars)\n    - **impact**: One of \"positive\", \"neutral\", \"negative\"\n    - **dimension**: Which dimension this affects\n- **reflection**: Closing insight connecting to lesson (max 500 chars)\n",
      "testCaseId": "es-physics-energy-conservation-1",
      "userPrompt": "LESSON_TITLE: Conservacion de Energia en Sistemas Reales\nLESSON_DESCRIPTION: Aplicando principios de conservacion de energia para disenar y optimizar sistemas energeticos\nCHAPTER_TITLE: Energia y Trabajo\nCOURSE_TITLE: Fisica Aplicada\nLANGUAGE: es\nEXPLANATION_STEPS:\n1. Conservacion de la Energia: La energia no se crea ni se destruye, solo se transforma. En cada conversion, la energia total se conserva, pero la energia util disminuye. Parte siempre se convierte en calor no aprovechable.\n2. Eficiencia Energetica: La eficiencia mide cuanta energia de entrada se convierte en trabajo util. Ningun proceso es 100% eficiente — siempre hay perdidas. La segunda ley de la termodinamica lo garantiza.\n3. Perdidas en Cadena: Las cadenas de conversion acumulan perdidas. Si cada paso es 90% eficiente, tres pasos dan 0.9³ = 73% eficiencia total. Menos conversiones significa menos perdidas.\n4. Costo del Almacenamiento: El almacenamiento de energia tiene su propio costo energetico. Cargar y descargar baterias pierde energia. Bombear agua cuesta arriba para hidroelectrica tambien. El almacenamiento no es gratis.\n5. Densidad Energetica: La densidad energetica importa. Combustibles fosiles almacenan mucha energia por kilogramo. Las baterias almacenan menos. Esto afecta que es practico para cada aplicacion."
    }
  ],
  "taskId": "activity-challenge"
}
