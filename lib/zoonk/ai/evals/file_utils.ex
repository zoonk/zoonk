defmodule Zoonk.AI.Evals.FileUtils do
  @moduledoc false
  require Logger

  @doc """
  Stores the output generated by an AI model.

  We use these outputs to evaluate the model's performance
  and to compare it against other models.

  ## Examples

      iex> store_model_output("openai/gpt-4.1-mini", :recommend_courses, "test_1.json", %{})
      :ok

  """
  def store_model_output(model, prompt, filename, data) do
    Logger.info("Storing model output for #{model} in #{filename}")

    model_name = String.replace(model, "/", "_")
    prompt = prompt_name(prompt)

    dir = Path.join(["priv", "evals", "models", model_name, prompt])
    File.mkdir_p!(dir)

    file_path = Path.join(dir, filename)
    file_content = Jason.encode!(data, pretty: true)

    File.write!(file_path, file_content)

    Logger.info("Stored model output in #{file_path}")
  end

  defp prompt_name(prompt) when is_atom(prompt), do: Atom.to_string(prompt)
  defp prompt_name(prompt) when is_binary(prompt), do: prompt
end
